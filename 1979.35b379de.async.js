(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[1979],{81618:function(nn){"use strict";(function(ye,fe){nn.exports=fe()})(this,function(){function ye(Fe){var _e=[];return Fe.AMapUI&&_e.push(fe(Fe.AMapUI)),Fe.Loca&&_e.push(Le(Fe.Loca)),Promise.all(_e)}function fe(Fe){return new Promise(function(_e,Ge){var ot=[];if(Fe.plugins)for(var ft=0;ft<Fe.plugins.length;ft+=1)y.AMapUI.plugins.indexOf(Fe.plugins[ft])==-1&&ot.push(Fe.plugins[ft]);if(Ae.AMapUI===J.failed)Ge("\u524D\u6B21\u8BF7\u6C42 AMapUI \u5931\u8D25");else if(Ae.AMapUI===J.notload){Ae.AMapUI=J.loading,y.AMapUI.version=Fe.version||y.AMapUI.version,ft=y.AMapUI.version;var kt=document.body||document.head,ar=document.createElement("script");ar.type="text/javascript",ar.src="https://webapi.amap.com/ui/"+ft+"/main.js",ar.onerror=function(xt){Ae.AMapUI=J.failed,Ge("\u8BF7\u6C42 AMapUI \u5931\u8D25")},ar.onload=function(){if(Ae.AMapUI=J.loaded,ot.length)window.AMapUI.loadUI(ot,function(){for(var xt=0,Jt=ot.length;xt<Jt;xt++){var Gt=ot[xt].split("/").slice(-1)[0];window.AMapUI[Gt]=arguments[xt]}for(_e();T.AMapUI.length;)T.AMapUI.splice(0,1)[0]()});else for(_e();T.AMapUI.length;)T.AMapUI.splice(0,1)[0]()},kt.appendChild(ar)}else Ae.AMapUI===J.loaded?Fe.version&&Fe.version!==y.AMapUI.version?Ge("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):ot.length?window.AMapUI.loadUI(ot,function(){for(var xt=0,Jt=ot.length;xt<Jt;xt++){var Gt=ot[xt].split("/").slice(-1)[0];window.AMapUI[Gt]=arguments[xt]}_e()}):_e():Fe.version&&Fe.version!==y.AMapUI.version?Ge("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):T.AMapUI.push(function(xt){xt?Ge(xt):ot.length?window.AMapUI.loadUI(ot,function(){for(var Jt=0,Gt=ot.length;Jt<Gt;Jt++){var wt=ot[Jt].split("/").slice(-1)[0];window.AMapUI[wt]=arguments[Jt]}_e()}):_e()})})}function Le(Fe){return new Promise(function(_e,Ge){if(y.AMap.version.startsWith("2.0"))Ge("Loca \u6682\u4E0D\u9002\u914D JSAPI 2.0,\u8BF7\u4F7F\u7528 1.4.15");else if(Ae.Loca===J.failed)Ge("\u524D\u6B21\u8BF7\u6C42 Loca \u5931\u8D25");else if(Ae.Loca===J.notload){Ae.Loca=J.loading,y.Loca.version=Fe.version||y.Loca.version;var ot=y.Loca.version,ft=y.key,kt=document.body||document.head,ar=document.createElement("script");ar.type="text/javascript",ar.src="https://webapi.amap.com/loca?v="+ot+"&key="+ft,ar.onerror=function(xt){Ae.Loca=J.failed,Ge("\u8BF7\u6C42 AMapUI \u5931\u8D25")},ar.onload=function(){for(Ae.Loca=J.loaded,_e();T.Loca.length;)T.Loca.splice(0,1)[0]()},kt.appendChild(ar)}else Ae.Loca===J.loaded?Fe.version&&Fe.version!==y.Loca.version?Ge("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):_e():Fe.version&&Fe.version!==y.Loca.version?Ge("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):T.Loca.push(function(xt){xt?Ge(xt):Ge()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var J;(function(Fe){Fe.notload="notload",Fe.loading="loading",Fe.loaded="loaded",Fe.failed="failed"})(J||(J={}));var y={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},Ae={AMap:J.notload,AMapUI:J.notload,Loca:J.notload},T={AMap:[],AMapUI:[],Loca:[]},ce=[],pe=function(Fe){typeof Fe=="function"&&(Ae.AMap===J.loaded?Fe(window.AMap):ce.push(Fe))};return{load:function(Fe){return new Promise(function(_e,Ge){if(Ae.AMap==J.failed)Ge("");else if(Ae.AMap==J.notload){var ot=Fe.key,ft=Fe.version,kt=Fe.plugins;ot?(window.AMap&&location.host!=="lbs.amap.com"&&Ge("\u7981\u6B62\u591A\u79CDAPI\u52A0\u8F7D\u65B9\u5F0F\u6DF7\u7528"),y.key=ot,y.AMap.version=ft||y.AMap.version,y.AMap.plugins=kt||y.AMap.plugins,Ae.AMap=J.loading,ft=document.body||document.head,window.___onAPILoaded=function(xt){if(delete window.___onAPILoaded,xt)Ae.AMap=J.failed,Ge(xt);else for(Ae.AMap=J.loaded,ye(Fe).then(function(){_e(window.AMap)}).catch(Ge);ce.length;)ce.splice(0,1)[0]()},kt=document.createElement("script"),kt.type="text/javascript",kt.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+y.AMap.version+"&key="+ot+"&plugin="+y.AMap.plugins.join(","),kt.onerror=function(xt){Ae.AMap=J.failed,Ge(xt)},ft.appendChild(kt)):Ge("\u8BF7\u586B\u5199key")}else if(Ae.AMap==J.loaded)if(Fe.key&&Fe.key!==y.key)Ge("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(Fe.version&&Fe.version!==y.AMap.version)Ge("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{if(ot=[],Fe.plugins)for(ft=0;ft<Fe.plugins.length;ft+=1)y.AMap.plugins.indexOf(Fe.plugins[ft])==-1&&ot.push(Fe.plugins[ft]);ot.length?window.AMap.plugin(ot,function(){ye(Fe).then(function(){_e(window.AMap)}).catch(Ge)}):ye(Fe).then(function(){_e(window.AMap)}).catch(Ge)}else if(Fe.key&&Fe.key!==y.key)Ge("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(Fe.version&&Fe.version!==y.AMap.version)Ge("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{var ar=[];if(Fe.plugins)for(ft=0;ft<Fe.plugins.length;ft+=1)y.AMap.plugins.indexOf(Fe.plugins[ft])==-1&&ar.push(Fe.plugins[ft]);pe(function(){ar.length?window.AMap.plugin(ar,function(){ye(Fe).then(function(){_e(window.AMap)}).catch(Ge)}):ye(Fe).then(function(){_e(window.AMap)}).catch(Ge)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,y={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},Ae={AMap:J.notload,AMapUI:J.notload,Loca:J.notload},T={AMap:[],AMapUI:[],Loca:[]}}}})},21979:function(nn,ye,fe){"use strict";fe.d(ye,{zP:function(){return BL},JE:function(){return pL},ns:function(){return FL}});var Le={};fe.r(Le),fe.d(Le,{add:function(){return $v},adjoint:function(){return Up},clone:function(){return Nv},copy:function(){return Nf},create:function(){return Ho},determinant:function(){return Sd},equals:function(){return Jh},exactEquals:function(){return Kv},frob:function(){return Yv},fromQuat:function(){return Gv},fromQuat2:function(){return jv},fromRotation:function(){return Ku},fromRotationTranslation:function(){return Vv},fromRotationTranslationScale:function(){return Kh},fromRotationTranslationScaleOrigin:function(){return Qh},fromScaling:function(){return Uv},fromTranslation:function(){return tv},fromValues:function(){return Ed},fromXRotation:function(){return Cd},fromYRotation:function(){return Zv},fromZRotation:function(){return Pc},frustum:function(){return Hv},getRotation:function(){return qh},getScaling:function(){return mh},getTranslation:function(){return vh},identity:function(){return zp},invert:function(){return ph},lookAt:function(){return Ad},mul:function(){return H0},multiply:function(){return Lu},multiplyScalar:function(){return qv},multiplyScalarAndAdd:function(){return Vp},ortho:function(){return Wv},orthoNO:function(){return Lc},orthoZO:function(){return av},perspective:function(){return wd},perspectiveFromFieldOfView:function(){return iv},perspectiveNO:function(){return rv},perspectiveZO:function(){return nv},rotate:function(){return Zp},rotateX:function(){return dh},rotateY:function(){return Yh},rotateZ:function(){return $h},scale:function(){return zf},set:function(){return zv},str:function(){return ov},sub:function(){return Qv},subtract:function(){return Td},targetTo:function(){return Xv},translate:function(){return kc},transpose:function(){return Ic}});var J=fe(67294),y=(0,J.createContext)({});function Ae(){return(0,J.useContext)(y)}var T=fe(96156),ce=fe(28481),pe={},Fe={},_e=function(i){return Fe[i]},Ge=function(i,r){Fe[i]=r},ot=function(i){return pe[i]},ft=function(i,r){pe[i]=r},kt={},ar={},xt=34,Jt=10,Gt=13;function wt(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function Bt(e,i){var r=wt(e);return function(n,t){return i(r(n),t,e)}}function gr(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var t in n)t in i||r.push(i[t]=t)}),r}function K(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function ur(e){return e<0?"-"+K(-e,6):e>9999?"+"+K(e,6):K(e,4)}function Tt(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),t=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":ur(e.getUTCFullYear(),4)+"-"+K(e.getUTCMonth()+1,2)+"-"+K(e.getUTCDate(),2)+(t?"T"+K(i,2)+":"+K(r,2)+":"+K(n,2)+"."+K(t,3)+"Z":n?"T"+K(i,2)+":"+K(r,2)+":"+K(n,2)+"Z":r||i?"T"+K(i,2)+":"+K(r,2)+"Z":"")}function ht(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(C,A){var P,O,D=t(C,function(N,j){if(P)return P(N,j-1);O=N,P=A?Bt(N,A):wt(N)});return D.columns=O||[],D}function t(C,A){var P=[],O=C.length,D=0,N=0,j,ae=O<=0,re=!1;C.charCodeAt(O-1)===Jt&&--O,C.charCodeAt(O-1)===Gt&&--O;function Te(){if(ae)return ar;if(re)return re=!1,kt;var Ke,gt=D,lt;if(C.charCodeAt(gt)===xt){for(;D++<O&&C.charCodeAt(D)!==xt||C.charCodeAt(++D)===xt;);return(Ke=D)>=O?ae=!0:(lt=C.charCodeAt(D++))===Jt?re=!0:lt===Gt&&(re=!0,C.charCodeAt(D)===Jt&&++D),C.slice(gt+1,Ke-1).replace(/""/g,'"')}for(;D<O;){if((lt=C.charCodeAt(Ke=D++))===Jt)re=!0;else if(lt===Gt)re=!0,C.charCodeAt(D)===Jt&&++D;else if(lt!==r)continue;return C.slice(gt,Ke)}return ae=!0,C.slice(gt,O)}for(;(j=Te())!==ar;){for(var Re=[];j!==kt&&j!==ar;)Re.push(j),j=Te();A&&(Re=A(Re,N++))==null||P.push(Re)}return P}function o(C,A){return C.map(function(P){return A.map(function(O){return b(P[O])}).join(e)})}function u(C,A){return A==null&&(A=gr(C)),[A.map(b).join(e)].concat(o(C,A)).join(`
`)}function c(C,A){return A==null&&(A=gr(C)),o(C,A).join(`
`)}function p(C){return C.map(m).join(`
`)}function m(C){return C.map(b).join(e)}function b(C){return C==null?"":C instanceof Date?Tt(C):i.test(C+="")?'"'+C.replace(/"/g,'""')+'"':C}return{parse:n,parseRows:t,format:u,formatBody:c,formatRows:p,formatRow:m,formatValue:b}}var Ot=ht(","),pt=Ot.parse,lr=Ot.parseRows,Br=Ot.format,q=Ot.formatBody,ge=Ot.formatRows,Q=Ot.formatRow,Me=Ot.formatValue,ee=fe(85061),oe=fe(28991),bt=fe(38163),Nt=fe.n(bt),jt=63710088e-1,Qt={centimeters:jt*100,centimetres:jt*100,degrees:jt/111325,feet:jt*3.28084,inches:jt*39.37,kilometers:jt/1e3,kilometres:jt/1e3,meters:jt,metres:jt,miles:jt/1609.344,millimeters:jt*1e3,millimetres:jt*1e3,nauticalmiles:jt/1852,radians:1,yards:jt*1.0936},ln={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/jt,yards:1.0936133},Dr={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function oi(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function Zn(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return Vn(i).geometry;case"LineString":return Hi(i).geometry;case"Polygon":return Ci(i).geometry;case"MultiPoint":return ri(i).geometry;case"MultiLineString":return Xn(i).geometry;case"MultiPolygon":return po(i).geometry;default:throw new Error(e+" is invalid")}}function Vn(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ye(e[0])||!Ye(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return oi(n,i,r)}function Xi(e,i,r){return r===void 0&&(r={}),hi(e.map(function(n){return Vn(n,i)}),r)}function Ci(e,i,r){r===void 0&&(r={});for(var n=0,t=e;n<t.length;n++){var o=t[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var c={type:"Polygon",coordinates:e};return oi(c,i,r)}function fi(e,i,r){return r===void 0&&(r={}),hi(e.map(function(n){return Ci(n,i)}),r)}function Hi(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return oi(n,i,r)}function Ni(e,i,r){return r===void 0&&(r={}),hi(e.map(function(n){return Hi(n,i)}),r)}function hi(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function Xn(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return oi(n,i,r)}function ri(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return oi(n,i,r)}function po(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return oi(n,i,r)}function Ha(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return oi(n,i,r)}function wa(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function Et(e,i){i===void 0&&(i="kilometers");var r=Qt[i];if(!r)throw new Error(i+" units is invalid");return e*r}function me(e,i){i===void 0&&(i="kilometers");var r=Qt[i];if(!r)throw new Error(i+" units is invalid");return e/r}function se(e,i){return z(me(e,i))}function Se(e){var i=e%360;return i<0&&(i+=360),i}function z(e){var i=e%(2*Math.PI);return i*180/Math.PI}function qe(e){var i=e%360;return i*Math.PI/180}function qt(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Et(me(e,i),r)}function Or(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=Dr[i];if(!n)throw new Error("invalid original units");var t=Dr[r];if(!t)throw new Error("invalid final units");return e/n*t}function Ye(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Mt(e){return!!e&&e.constructor===Object}function pr(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!Ye(i))throw new Error("bbox must only contain numbers")})}function Mr(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Zr(e,i,r){if(e!==null)for(var n,t,o,u,c,p,m,b=0,C=0,A,P=e.type,O=P==="FeatureCollection",D=P==="Feature",N=O?e.features.length:1,j=0;j<N;j++){m=O?e.features[j].geometry:D?e.geometry:e,A=m?m.type==="GeometryCollection":!1,c=A?m.geometries.length:1;for(var ae=0;ae<c;ae++){var re=0,Te=0;if(u=A?m.geometries[ae]:m,u!==null){p=u.coordinates;var Re=u.type;switch(b=r&&(Re==="Polygon"||Re==="MultiPolygon")?1:0,Re){case null:break;case"Point":if(i(p,C,j,re,Te)===!1)return!1;C++,re++;break;case"LineString":case"MultiPoint":for(n=0;n<p.length;n++){if(i(p[n],C,j,re,Te)===!1)return!1;C++,Re==="MultiPoint"&&re++}Re==="LineString"&&re++;break;case"Polygon":case"MultiLineString":for(n=0;n<p.length;n++){for(t=0;t<p[n].length-b;t++){if(i(p[n][t],C,j,re,Te)===!1)return!1;C++}Re==="MultiLineString"&&re++,Re==="Polygon"&&Te++}Re==="Polygon"&&re++;break;case"MultiPolygon":for(n=0;n<p.length;n++){for(Te=0,t=0;t<p[n].length;t++){for(o=0;o<p[n][t].length-b;o++){if(i(p[n][t][o],C,j,re,Te)===!1)return!1;C++}Te++}re++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(Zr(u.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function qr(e,i,r,n){var t=r;return Zr(e,function(o,u,c,p,m){u===0&&r===void 0?t=o:t=i(t,o,u,c,p,m)},n),t}function jn(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function Nn(e,i,r){var n=r;return jn(e,function(t,o){o===0&&r===void 0?n=t:n=i(n,t,o)}),n}function en(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function pi(e,i,r){var n=r;return en(e,function(t,o){o===0&&r===void 0?n=t:n=i(n,t,o)}),n}function si(e){var i=[];return Zr(e,function(r){i.push(r)}),i}function ra(e,i){var r,n,t,o,u,c,p,m,b,C,A=0,P=e.type==="FeatureCollection",O=e.type==="Feature",D=P?e.features.length:1;for(r=0;r<D;r++){for(c=P?e.features[r].geometry:O?e.geometry:e,m=P?e.features[r].properties:O?e.properties:{},b=P?e.features[r].bbox:O?e.bbox:void 0,C=P?e.features[r].id:O?e.id:void 0,p=c?c.type==="GeometryCollection":!1,u=p?c.geometries.length:1,t=0;t<u;t++){if(o=p?c.geometries[t]:c,o===null){if(i(null,A,m,b,C)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(o,A,m,b,C)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(i(o.geometries[n],A,m,b,C)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}A++}}function Aa(e,i,r){var n=r;return ra(e,function(t,o,u,c,p){o===0&&r===void 0?n=t:n=i(n,t,o,u,c,p)}),n}function va(e,i){ra(e,function(r,n,t,o,u){var c=r===null?null:r.type;switch(c){case null:case"Point":case"LineString":case"Polygon":return i(oi(r,t,{bbox:o,id:u}),n,0)===!1?!1:void 0}var p;switch(c){case"MultiPoint":p="Point";break;case"MultiLineString":p="LineString";break;case"MultiPolygon":p="Polygon";break}for(var m=0;m<r.coordinates.length;m++){var b=r.coordinates[m],C={type:p,coordinates:b};if(i(oi(C,t),n,m)===!1)return!1}})}function xa(e,i,r){var n=r;return va(e,function(t,o,u){o===0&&u===0&&r===void 0?n=t:n=i(n,t,o,u)}),n}function Ki(e,i){va(e,function(r,n,t){var o=0;if(!!r.geometry){var u=r.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var c,p=0,m=0,b=0;if(Zr(r,function(C,A,P,O,D){if(c===void 0||n>p||O>m||D>b){c=C,p=n,m=O,b=D,o=0;return}var N=lineString([c,C],r.properties);if(i(N,n,t,D,o)===!1)return!1;o++,c=C})===!1)return!1}}})}function Y(e,i,r){var n=r,t=!1;return Ki(e,function(o,u,c,p,m){t===!1&&r===void 0?n=o:n=i(n,o,u,c,p,m),t=!0}),n}function ie(e,i){if(!e)throw new Error("geojson is required");va(e,function(r,n,t){if(r.geometry!==null){var o=r.geometry.type,u=r.geometry.coordinates;switch(o){case"LineString":if(i(r,n,t,0,0)===!1)return!1;break;case"Polygon":for(var c=0;c<u.length;c++)if(i(lineString(u[c],r.properties),n,t,c)===!1)return!1;break}}})}function de(e,i,r){var n=r;return ie(e,function(t,o,u,c){o===0&&r===void 0?n=t:n=i(n,t,o,u,c)}),n}function Ce(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,t=i.geometryIndex||0,o=i.segmentIndex||0,u=i.properties,c;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,c=e.features[r].geometry;break;case"Feature":u=u||e.properties,c=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":c=e;break;default:throw new Error("geojson is invalid")}if(c===null)return null;var p=c.coordinates;switch(c.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=p.length+o-1),lineString([p[o],p[o+1]],u,i);case"Polygon":return t<0&&(t=p.length+t),o<0&&(o=p[t].length+o-1),lineString([p[t][o],p[t][o+1]],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o-1),lineString([p[n][o],p[n][o+1]],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),t<0&&(t=p[n].length+t),o<0&&(o=p[n][t].length-o-1),lineString([p[n][t][o],p[n][t][o+1]],u,i)}throw new Error("geojson is invalid")}function Ze(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,t=i.geometryIndex||0,o=i.coordIndex||0,u=i.properties,c;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,c=e.features[r].geometry;break;case"Feature":u=u||e.properties,c=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":c=e;break;default:throw new Error("geojson is invalid")}if(c===null)return null;var p=c.coordinates;switch(c.type){case"Point":return point(p,u,i);case"MultiPoint":return n<0&&(n=p.length+n),point(p[n],u,i);case"LineString":return o<0&&(o=p.length+o),point(p[o],u,i);case"Polygon":return t<0&&(t=p.length+t),o<0&&(o=p[t].length+o),point(p[t][o],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o),point(p[n][o],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),t<0&&(t=p[n].length+t),o<0&&(o=p[n][t].length-o),point(p[n][t][o],u,i)}throw new Error("geojson is invalid")}function et(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function dt(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function be(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return be(e[0]);throw new Error("coordinates must only contain numbers")}function He(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function Rt(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function kr(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,t=e.features;n<t.length;n++){var o=t[n];if(!o||o.type!=="Feature"||!o.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!o.geometry||o.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+o.geometry.type)}}function Xt(e){return e.type==="Feature"?e.geometry:e}function er(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function Pr(e,i){var r=i.x,n=i.y,t=i.x1,o=i.y1,u=i.coordinates,c=i.geometry,p=[];if(!Array.isArray(e))return{dataArray:[]};if(c)return e.filter(function(ae){return ae[c]&&ae[c].type&&ae[c].coordinates&&ae[c].coordinates.length>0}).forEach(function(ae,re){var Te=(0,oe.Z)({},ae[c]),Re=Nt()(Te,!0);va(Re,function(Ke){var gt=dt(Ke),lt=(0,oe.Z)((0,oe.Z)({},ae),{},{_id:re,coordinates:gt});p.push(lt)})}),{dataArray:p};for(var m=0;m<e.length;m++){var b=e[m],C=[];if(u){var A="Polygon";Array.isArray(u[0])||(A="Point"),Array.isArray(u[0])&&!Array.isArray(u[0][0])&&(A="LineString");var P={type:A,coordinates:(0,ee.Z)(b[u])},O=Nt()(P,!0);C=O.coordinates}else if(r&&n&&t&&o){var D=[parseFloat(b[r]),parseFloat(b[n])],N=[parseFloat(b[t]),parseFloat(b[o])];C=[D,N]}else r&&n&&(C=[parseFloat(b[r]),parseFloat(b[n])]);var j=(0,oe.Z)((0,oe.Z)({},b),{},{_id:m,coordinates:C});p.push(j)}return{dataArray:p}}function Ln(e,i){var r=pt(e);return Pr(r,i)}function An(e){for(var i=e.toString(),r=5381,n=i.length;n;)r=r*33^i.charCodeAt(--n);return r>>>0}function Ht(e,i){return i===void 0?null:i==="id"&&e.id?e.id:e[i]?e[i]:e.properties&&e.properties[i]?An(e.properties[i]+"")%1000019:null}function xn(e,i){var r=[],n={};return e.features?(e.features=e.features.filter(function(t){var o=t.geometry;return t!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),Nt()(e,!0),e.features.length===0?{dataArray:[],featureKeys:n}:(va(e,function(t,o){var u=Ht(t,i==null?void 0:i.featureId);u===null&&(u=o);var c=u,p=dt(t),m=(0,oe.Z)((0,oe.Z)({},t.properties),{},{coordinates:p,_id:c});r.push(m)}),{dataArray:r,featureKeys:n})):(e.features=[],{dataArray:[]})}function sn(e){var i=131,r=137,n=0;e+="x";for(var t=Math.floor(9007199254740991/r),o=0;o<e.length;o++)n>t&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(o);return n}function pn(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var bi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function yn(e){this.message=e}yn.prototype=new Error,yn.prototype.name="InvalidCharacterError";function Pi(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new yn("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,t,o,u=0;o=i.charAt(u++);~o&&(t=n%4?t*64+o:o,n++%4)?r+=String.fromCharCode(255&t>>(-2*n&6)):0)o=bi.indexOf(o);return r}function aa(e){e=String(e);for(var i,r,n,t,o="",u=0,c=e.length%3;u<e.length;){if((r=e.charCodeAt(u++))>255||(n=e.charCodeAt(u++))>255||(t=e.charCodeAt(u++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|t,o+=bi.charAt(i>>18&63)+bi.charAt(i>>12&63)+bi.charAt(i>>6&63)+bi.charAt(i&63)}return c?o.slice(0,c-3)+"===".substring(c):o}var vt=fe(6610),yt=fe(5991),Ii=function(){function e(i,r){(0,vt.Z)(this,e),this.buffers=i,this.type=r}return(0,yt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,t){throw new Error("not implemented")}}]),e}(),ui,Qi=function(){return ui||(ui=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof fe.g!="undefined"?fe.g:{})};ui=Qi();var Ji;typeof window=="undefined"?Ji={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ji=window;var oa=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Ri=oa?my.getSystemInfoSync().pixelRatio:Ji.devicePixelRatio,hr=fe(10379),_r=fe(46070),at=fe(77608),Ta=(0,yt.Z)(function e(i,r){(0,vt.Z)(this,e),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),$e=fe(63349);function ks(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ls(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var m=r.next();return o=m.done,m},e:function(m){u=!0,c=m},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function ls(e,i){if(!!e){if(typeof e=="string")return ia(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ia(e,i)}}function ia(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Us=new WeakMap,Ja=function(){function e(){(0,vt.Z)(this,e),Us.set(this,{})}return(0,yt.Z)(e,[{key:"addEventListener",value:function(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=Us.get(this);o||(o={}),o[r]||(o[r]=[]),o[r].push(n),Us.set(this,o),t.capture,t.once,t.passive}},{key:"removeEventListener",value:function(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=Us.get(this);if(o){var u=o[r];if(u&&u.length>0){for(var c=u.length;c--;c>0)if(u[c]===n){u.splice(c,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=Us.get(this)[r.type];if(n){var t=ks(n),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u(r)}}catch(c){t.e(c)}finally{t.f()}}}}]),e}();function Wa(e){var i=eo();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function eo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sa=function(e){(0,hr.Z)(r,e);var i=Wa(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),n.childNodes=[],n}return(0,yt.Z)(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var o=this.childNodes.findIndex(function(u){return u===t});return o>-1?this.childNodes.splice(o,1):null}}]),r}(Ja);function Xo(e){var i=rs();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function rs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bu=function(e){(0,hr.Z)(r,e);var i=Xo(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),n.className="",n.children=[],n}return(0,yt.Z)(r,[{key:"setAttribute",value:function(t,o){this[t]=o}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,o){this[t]=o}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(sa),To=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Mo,fa,to,Yo;if(To){var qa=my.getSystemInfoSync();Mo=qa.screenWidth,fa=qa.screenHeight,to=qa.windowWidth,Yo=qa.windowHeight}else{var $s=Ji.innerWidth,Ll=Ji.innerHeight;Mo=$s,fa=Ll,to=$s,Yo=Ll}var ns={width:Mo,height:fa,availWidth:to,availHeight:Yo,availLeft:0,availTop:0},he=ns.availWidth,Pe=ns.availHeight,ct={style:[]};function Yt(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return ct}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return ct}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function Yr(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:he+"px",height:Pe+"px",margin:"0px",padding:"0px"})}function Gn(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=he,e.clientHeight=Pe),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function Oi(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=he,e.offsetHeight=Pe)}function uo(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=he,e.scrollHeight=Pe)}function Na(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Ka(e){var i=is();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function is(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Uo(){}var vo=function(e){(0,hr.Z)(r,e);var i=Ka(r);function r(){var n,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return(0,vt.Z)(this,r),n=i.call(this),n.className="",n.children=[],n.focus=Uo,n.blur=Uo,n.insertBefore=Uo,n.appendChild=Uo,n.removeChild=Uo,n.remove=Uo,n.innerHTML="",n.tagName=t.toUpperCase(),Yt((0,$e.Z)(n),o),Yr((0,$e.Z)(n)),Na((0,$e.Z)(n)),Gn((0,$e.Z)(n)),Oi((0,$e.Z)(n)),uo((0,$e.Z)(n)),n}return(0,yt.Z)(r)}(bu);function Ps(e){var i=Ls();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function Ls(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rs=function(e){(0,hr.Z)(r,e);var i=Ps(r);function r(n){return(0,vt.Z)(this,r),i.call(this,n)}return(0,yt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(vo);function qs(e){var i=uu();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function uu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gs=function(e){(0,hr.Z)(r,e);var i=qs(r);function r(){return(0,vt.Z)(this,r),i.call(this,"video")}return(0,yt.Z)(r)}(Rs),zi={},Pa={};function Nc(e,i){zi=e,zi.id=i,"tagName"in zi||(zi.tagName="CANVAS"),zi.type="canvas",Mixin.parentNode(zi),Mixin.style(zi),Mixin.classList(zi),Mixin.clientRegion(zi),Mixin.offsetRegion(zi),zi.focus=function(){},zi.blur=function(){}}function cf(e,i){var r=1024,n=1024;Pa={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in Pa||(Pa.tagName="CANVAS"),Mixin.parentNode(Pa),Mixin.style(Pa),Mixin.classList(Pa),Mixin.clientRegion(Pa),Mixin.offsetRegion(Pa),Pa.getContext=function(t){if(t==="2d")return e},Pa.focus=function(){},Pa.blur=function(){}}function Os(){return zi}function ff(){return Pa}var ml=(0,yt.Z)(function e(){(0,vt.Z)(this,e);var i=Os(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Yt(r),Na(r),Object.assign(r,{addEventListener:function(t,o){r["on".concat(t)]=o.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r}),el={href:"",protocol:"",host:""};function Ks(e){var i=Rl();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function Rl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x=function(e){(0,hr.Z)(r,e);var i=Ks(r);function r(){return(0,vt.Z)(this,r),i.call(this,"body",0)}return(0,yt.Z)(r,[{key:"addEventListener",value:function(t,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(t,o,u){}},{key:"dispatchEvent",value:function(t){}}]),r}(vo),I=function(e){(0,hr.Z)(r,e);var i=Ks(r);function r(){return(0,vt.Z)(this,r),i.call(this,"html",0)}return(0,yt.Z)(r,[{key:"addEventListener",value:function(t,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(t,o){}},{key:"dispatchEvent",value:function(t){}}]),r}(vo),U={},R={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:el,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new ml:i==="video"?new gs:new vo(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){U[i]||(U[i]=[]),U[i].push(r)},removeEventListener:function(i,r){var n=U[i];if(n&&n.length>0){for(var t=n.length;t--;t>0)if(n[t]===r){n.splice(t,1);break}}},dispatchEvent:function(i){var r=i.type,n=U[r];if(n)for(var t=0;t<n.length;t++)n[t](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new Ta(i)}};R.documentElement=new I,R.head=new vo("head"),R.body=new x;var ne=Object,ke=fe(90484),it=function(){function e(){(0,vt.Z)(this,e);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,ke.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,yt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),Pt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Lt,yr,Lr;if(Pt){var Hn=my.getSystemInfoSync();Lt=Hn.system,yr=Hn.platform,Lr=Hn.language}else{var Jn={versions:function(){var e=Ji.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ji.navigator.browserLanguage||Ji.navigator.language).toLowerCase()};Jn.versions.android?yr="android":Jn.versions.trident?yr="IE":Jn.versions.presto?yr="Opera":Jn.versions.webKit?yr="webKit":Jn.versions.gecko?yr="Firefox":Jn.versions.mobile?yr="mobile":Jn.versions.ios?yr="ios":Jn.versions.iPhone?yr="iPhone":Jn.versions.iPad?yr="ipad":Jn.versions.webApp?yr="webApp":Jn.versions.weixin?yr="weixin":Jn.versions.qq&&(yr="qq"),Lt=Ji.navigator.userAgent,Lr=Jn.language}var vi=Lt.toLowerCase().indexOf("android")!==-1,Yi=vi?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",ba="Mozilla/5.0 (".concat(Yi,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Lr),Ra={platform:yr,language:Lr,appVersion:"5.0 (".concat(Yi,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:ba},$i={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},ys=0,lu=0;function gl(e){var i=Date.now(),r=Math.max(ys+23,i);return lu=setTimeout(function(){e(ys=r)},r-i),lu}function hf(e){var i=Os();return i.requestAnimationFrame?i.requestAnimationFrame(e):gl(e)}function yl(e){var i=Os();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var zc=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,vt.Z)(this,e),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,yt.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],t=r.type,o=Fu(n),u="data:".concat(t,";base64, ");return u+o}}]),e}();function Fu(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,t=0;t<n;t++)i+=String.fromCharCode(r[t]);return aa(i)}var Bu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},Nu={};function mo(e){var i=Gf();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function Gf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uc=new Map,_s=new Map,pf=new Map,tl={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function Qs(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Hf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,Qs.call(this,"readystatechange",i)}var Zs=function(e){(0,hr.Z)(r,e);var i=mo(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Uc.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,yt.Z)(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=pf.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=_s.get("responseHeader");return Object.keys(t).map(function(o){return"".concat(o,": ").concat(t[o])}).join(`
`)}},{key:"getResponseHeader",value:function(t){return _s.get("responseHeader")[t]}},{key:"open",value:function(t,o,u){this._method=t,this._url=o}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(t,o){var u=Uc.get("requestHeader");u[t]=o,Uc.set("requestHeader",u)}},{key:"addEventListener",value:function(t,o){var u=this;typeof o=="function"&&(this["on"+t]=function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};c.target=c.target||u,o.call(u,c)})}},{key:"removeEventListener",value:function(t,o){this["on"+t]===o&&(this["on"+t]=null)}}]),r}(Ja);Zs.UNSEND=0,Zs.OPENED=1,Zs.HEADERS_RECEIVED=2,Zs.LOADING=3,Zs.DONE=4;function Ma(e){var i=Ol();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function Ol(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bh=function(e){(0,hr.Z)(r,e);var i=Ma(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.touches=[],t.targetTouches=[],t.changedTouches=[],t.target=Os(),t.currentTarget=Os(),t}return(0,yt.Z)(r)}(Ta);function zu(e){var i=e||{},r=i.x,n=r===void 0?0:r,t=i.y,o=t===void 0?0:t,u=i.clientX,c=u===void 0?0:u,p=i.clientY,m=p===void 0?0:p;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=o):(e.x=c,e.y=m)}function Zc(e){return function(i){var r=new bh(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return zu(n)}),r.touches.forEach(function(n){return zu(n)}),r.targetTouches.forEach(function(n){return zu(n)}),R.dispatchEvent(r)}}function fp(e){return function(i){i.type=e,R.dispatchEvent(i)}}var hp=Zc("touchstart"),Wf=Zc("touchmove"),Vc=Zc("touchend"),lc=fp("mapCameaParams");function Dl(e){var i=Fl();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function Fl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _l=function(e){(0,hr.Z)(r,e);var i=Dl(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.target=Os(),t.currentTarget=Os(),t}return(0,yt.Z)(r)}(Ta),xl=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],bl=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],Js="touch";function df(e,i,r){for(var n=new _l(e),t=0;t<xl.length;t++){var o=xl[t];n[o]=i[o]||bl[t]}return n.type=e,n.target=Os(),n.currentTarget=Os(),n.buttons=vf(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=El(i),n.pointerType=Js,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function vf(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var Bl=null;function El(e){return Bl===e.identifier}function cc(e){Bl===null&&(Bl=e.identifier)}function jc(e){Bl===e.identifier&&(Bl=null)}function fc(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var t=r[n];n===0&&e==="pointerdown"?cc(t):(e==="pointerup"||e==="pointercancel")&&jc(t);var o=df(e,t,i);R.dispatchEvent(o)}}}var mf=fc("pointerdown"),pp=fc("pointermove"),gf=fc("pointerup");function Sl(e){var i=yf();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function yf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xf=function(e){(0,hr.Z)(r,e);var i=Sl(r);function r(n){return(0,vt.Z)(this,r),i.call(this,n)}return(0,yt.Z)(r)}(Ta);function Uu(e){return function(i){i.type=e,R.dispatchEvent(i)}}var Eh=Uu("mousedown"),Sh=Uu("mousemove"),Ch=Uu("mouseup"),Nl=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,wh=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),as=Nl||wh,Qa={atob:Pi,btoa:aa,devicePixelRatio:Ri,Blob:Ii,document:R,Element:bu,Event:Ta,EventTarget:Ja,HTMLCanvasElement:ne,HTMLElement:vo,HTMLMediaElement:Rs,HTMLVideoElement:gs,Image:ml,ImageData:it,navigator:Ra,Node:sa,requestAnimationFrame:hf,cancelAnimationFrame:yl,screen:ns,XMLHttpRequest:Zs,performance:$i,URL:zc,WebGLRenderingContext:Bu,WebGL2RenderingContext:Nu,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};R.addEventListener(i,r,n)},removeEventListener:function(i,r,n){R.removeEventListener(i,r)},dispatchEvent:function(i){R.dispatchEvent(i)},innerWidth:ns.availWidth,innerHeight:ns.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},ha=as?Qa:Ji,zl=as?Zs:Ji.XMLHttpRequest,rl=as?el:Ji.location;function qi(e){var i=e;return typeof e=="string"&&(i=ha.document.getElementById(e)),i}function Oa(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Fs(e){return Oa(e).split(/\s+/)}function Gc(e){var i,r,n=ha==null||(i=ha.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var t in e)if(e[t]&&e[t]in n)return e[t];return e[0]}function Ia(e,i,r){var n=ha.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function Zu(e){var i=e.parentNode;i&&i.removeChild(e)}function Ul(e,i){if(e.classList!==void 0)for(var r=Fs(i),n=0,t=r.length;n<t;n++)e.classList.add(r[n]);else if(!Wc(e,i)){var o=Eu(e);hc(e,(o?o+" ":"")+i)}}function Hc(e,i){e.classList!==void 0?e.classList.remove(i):hc(e,Oa((" "+Eu(e)+" ").replace(" "+i+" "," ")))}function Wc(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=Eu(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function hc(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function Eu(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Io(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var pc=Gc(["transform","WebkitTransform"]);function Zl(e,i){e.style[pc]=i}function ko(){if(typeof Event=="function")ha.dispatchEvent(new Event("resize"));else{var e=ha.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,ha,0),ha.dispatchEvent(e)}}function Rn(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function lo(){var e,i=ha.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(t){var o=t.split("="),u=(0,ce.Z)(o,1),c=u[0];return c==="initial-scale"});return n?n.split("=")[1]*1:1}var Da=lo()<1?1:ha.devicePixelRatio;function Vl(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function cu(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function Ds(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function _f(e){if(e.length===0)throw new Error("mean requires at least one data point");return Ds(e)/e.length}function dn(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,t=1,o=1;o<e.length+1;o++)e[o]!==i?(t>n&&(n=t,r=i),t=1,i=e[o]):t++;return r*1}var dc={min:cu,max:Vl,mean:_f,sum:Ds,mode:dn};function vc(e,i){return e.map(function(r){return r[i]})}function Cl(e,i){return dc[e](i)}var za=fe(14665);function Bs(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var Xc=fe(51814);function xs(e,i,r){return(0,Xc.Z)()?xs=Reflect.construct.bind():xs=function(t,o,u){var c=[null];c.push.apply(c,o);var p=Function.bind.apply(t,c),m=new p;return u&&(0,za.Z)(m,u.prototype),m},xs.apply(null,arguments)}function bs(e){var i=typeof Map=="function"?new Map:void 0;return bs=function(n){if(n===null||!Bs(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,t)}function t(){return xs(n,arguments,(0,at.Z)(this).constructor)}return t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),(0,za.Z)(t,n)},bs(e)}function Vu(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function Ah(){return typeof importScripts=="function"}var xf=Ah()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href};function Yf(e){var i=$f();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function $f(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vs=function(e){(0,hr.Z)(r,e);var i=Yf(r);function r(n,t,o,u){var c;return(0,vt.Z)(this,r),c=i.call(this,"AJAXError: ".concat(t," (").concat(n,"): ").concat(o)),c.status=n,c.statusText=t,c.url=o,c.body=u,c}return(0,yt.Z)(r)}(bs(Error));function eu(e,i){var r=Array.isArray(e.url)?e.url[0]:e.url,n=new Request(r,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:getReferrer(),signal:e==null?void 0:e.signal});return e.type==="json"&&n.headers.set("Accept","application/json"),fetch(n).then(function(t){return t.ok?(e.type==="arrayBuffer"?t.arrayBuffer():e.type==="json"?t.json():t.text()).then(function(o){i(null,o,t.headers.get("Cache-Control"),t.headers.get("Expires"))}).catch(function(o){i(new Error(o.message))}):t.blob().then(function(o){return i(new Vs(t.status,t.statusText,r.toString(),o))})}).catch(function(t){i(new Error(t.message))})}function Di(e,i){var r=new zl,n=Array.isArray(e.url)?e.url[0]:e.url;r.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(r.responseType="arraybuffer");for(var t in e.headers)e.headers.hasOwnProperty(t)&&r.setRequestHeader(t,e.headers[t]);return e.type==="json"&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials=e.credentials==="include",r.onerror=function(){i(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||r.status===0)&&r.response!==null){var o=r.response;if(e.type==="json")try{o=JSON.parse(r.response)}catch(c){return i(c)}i(null,o,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"),r)}else{var u=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});i(new Vs(r.status,r.statusText,n.toString(),u))}},r.send(e.body),r}function Su(e){return new Promise(function(i,r){Di(e,function(n,t,o,u,c){n?r({err:n,data:null,xhr:c}):i({err:null,data:t,cacheControl:o,expires:u,xhr:c})})})}function js(e,i){return Di(e,i)}var cs=function(i,r){return js(_objectSpread(_objectSpread({},i),{},{type:"json"}),r)},ju=function(i,r){return js((0,oe.Z)((0,oe.Z)({},i),{},{type:"arrayBuffer"}),r)},jl=function(i,r){return js(_objectSpread(_objectSpread({},i),{},{method:"POST"}),r)};function tu(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var Es="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function fu(e,i){var r=new ha.Image,n=ha.URL||ha.webkitURL;r.crossOrigin="anonymous",r.onload=function(){i(null,r),n.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(function(){r.src=Es})},r.onerror=function(){return i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var t=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?n.createObjectURL(t):Es}function Yn(e,i){var r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then(function(n){i(null,n)}).catch(function(n){i(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var zn=function(i,r){return ju(i,function(n,t){if(n)r(n);else if(t){var o=typeof createImageBitmap=="function";o?Yn(t,r):fu(t,r)}})};function Gl(e){return typeof e=="number"}var $o=2*Math.PI*6378137/2;function hu(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;qo(i,n)}),i}function qo(e,i){return Array.isArray(i[0])?i.forEach(function(r){qo(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function Gu(e,i){return Yc(e,i)}function Yc(e,i){return Array.isArray(e[0])?e.map(function(r){return Yc(r,i)}):i(e)}function Hl(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=Wl(e,i);var n=e[0],t=e[1],o=n*$o/180,u=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return u=u*$o/180,r.enable&&(o=Number(o.toFixed(r.decimal)),u=Number(u.toFixed(r.decimal))),e.length===3?[o,u,e[2]]:[o,u]}function Ea(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],t=r/$o*180,o=n/$o*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),i!=null&&(t=Number(t.toFixed(i)),o=Number(o.toFixed(i))),e.length===3?[t,o,e[2]]:[t,o]}function Ua(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function qf(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function Wl(e,i){if(i===!1)return e;var r=Ua(e[0]),n=qf(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function Xa(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,t=Math.PI/180,o=e[0]*t,u=r*t;u=Math.log(Math.tan(Math.PI/4+u/2));var c=.5/Math.PI,p=.5,m=-.5/Math.PI;return t=.5,o=n*(c*o+p),u=n*(m*u+t),[Math.floor(o),Math.floor(u)]}function Hu(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,t=.5,o=256<<20,u=_slicedToArray(e,2),c=u[0],p=u[1];c=(c/o-r)/i,p=(p/o-t)/n,p=(Math.atan(Math.pow(Math.E,p))-Math.PI/4)*2,t=Math.PI/180;var m=p/t,b=c/t;return[b,m]}function os(e,i){var r=85.0511287798,n=Math.PI/180,t=6378137;return i=Math.max(Math.min(r,i),-r),e*=n,i*=n,i=Math.log(Math.tan(Math.PI/4+i/2)),[e*t,i*t]}function wl(e,i){var r=Math.PI/180,n=6378137,t=e/n/r,o=2*(Math.atan(Math.exp(i/n))-Math.PI/4)/r;return[t,o]}function Cu(e,i,r){var n=qe(i[1]-e[1]),t=qe(i[0]-e[0]),o=qe(e[1]),u=qe(i[1]),c=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(t/2),2)*Math.cos(o)*Math.cos(u);return Et(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),r="meters")}function bf(e){var i=Math.PI/180,r=85.0511287798,n=6378137,t=Math.max(Math.min(r,e[1]),-r),o=Math.sin(t*i),u=n*e[0]*i,c=n*Math.log((1+o)/(1-o))/2;return[u,c]}function pu(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function Al(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function Xl(e){return[[e[0],e[1]],[e[2],e[3]]]}function Yl(e){var i=Tl(e,[0,0]);return[e[0]/i,e[1]/i]}function Tl(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Kf(e,i){return e[0]*i[0]+e[1]*i[1]}function nl(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function $l(e,i){return Math.acos(Kf(e,i)/(nl(e)*nl(i)))*180/Math.PI}function Ef(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function ql(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,t=[],o=0;o<e.length-1;o++){var u=e[o],c=e[o+1],p=Tl(u,c);n+=p;var m=[u[0]-c[0],u[1]-c[1]],b=Ef(r,m);if(o>0){var C=t[o-1].rotation;C-b>360-C+b&&(b=b+360)}t.push({start:u,end:c,dis:p,rotation:b,duration:0})}return t.map(function(A){A.duration=i*(A.dis/n)}),t}}function go(e){if(Gl(e[0]))return e;if(Gl(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Gl(e[0][0][0])){var i=e,r=0,n=0,t=0;return i.forEach(function(o){o.forEach(function(u){r+=u[0],n+=u[1],t++})}),[r/t,n/t,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function Sf(e){for(var i=e[0],r=e[1],n=e[0],t=e[1],o=0,u=0,c=0,p=0;p<e.length;p+=2){var m=e[p],b=e[p+1];m&&b&&(i=Math.max(m,i),r=Math.max(b,r),n=Math.min(m,n),t=Math.min(b,t),o+=m,u+=b,c++)}return{center:[o/c,u/c],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-t,2))/2}}var $c=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,vt.Z)(this,e),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,yt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(t){return t===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function Ml(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var qc=null,f=fe(2650);function d(e){return typeof e=="string"?!!f.ZP(e):!1}function h(e){var i=f.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function g(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],t=i+r*256+n*65536-1;return t}function S(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function M(e){var i=ha.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;var n=null;if(e.weights){var t=0;e.weights.map(function(A,P){var O=e.colors[P]||"rgba(0, 0, 0, 0)",D=t+A;r.fillStyle=O,r.fillRect(t*256,0,D*256,1),t=D})}else{for(var o=r.createLinearGradient(0,0,256,1),u=e.positions[0],c=e.positions[e.positions.length-1],p=0;p<e.colors.length;++p){var m=(e.positions[p]-u)/(c-u);o.addColorStop(m,e.colors[p])}r.fillStyle=o,r.fillRect(0,0,256,1)}if(as)return n=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),i=null,r=null,{data:n,width:256,height:1};n=r.getImageData(0,0,256,1).data;for(var b=r.createImageData(256,1),C=0;C<b.data.length;C+=4)b.data[C+0]=n[C+0],b.data[C+1]=n[C+1],b.data[C+2]=n[C+2],b.data[C+3]=n[C+3];return i=null,r=null,b}var k;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(k||(k={}));var F={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function G(e,i,r){var n=e.classList;for(var t in F)F.hasOwnProperty(t)&&n.remove("l7-".concat(r,"-anchor-").concat(t));n.add("l7-".concat(r,"-anchor-").concat(i))}function X(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var ue=fe(92137),Ee=fe(87757),te=fe.n(Ee);function je(e,i){if(!e)throw new Error(i||"web worker helper assertion failed.")}var ze={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},nt=ze.self||ze.window||{},Be=ze.window||ze.self||{},rt=ze.self||ze.window||{},mt=ze.document||{},Dt=typeof importScripts=="function",fr=typeof window!="undefined"&&typeof window.orientation!="undefined",nr=function(){function e(i,r){var n=this;this.name=i,this.workerThread=r,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(t,o){n.resolve=t,n.reject=o})}return e.prototype.postMessage=function(i,r){this.workerThread.postMessage({source:"Main thread",type:i,payload:r})},e.prototype.done=function(i){je(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(i)},e.prototype.error=function(i){je(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(i)},e}(),dr=nr,Ir=new Map;function tn(e){je(e.source&&!e.url||!e.source&&e.url);var i=Ir.get(e.source||e.url);return i||(e.url&&(i=$r(e.url),Ir.set(e.url,i)),e.source&&(i=bn(e.source),Ir.set(e.source,i))),je(i),i}function $r(e){if(!e.startsWith("http"))return e;var i=Qn(e);return bn(i)}function bn(e){var i=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(i)}function Qn(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function $n(e,i,r){i===void 0&&(i=!0);var n=r||new Set;if(e){if(ei(e))n.add(e);else if(ei(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(i&&typeof e=="object")for(var t in e)$n(e[t],i,n)}}return r===void 0?Array.from(n):[]}function ei(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var Fi=function(){},Cn=function(){function e(i){this.terminated=!1,this.loadableURL="";var r=i.name,n=i.source,t=i.url;je(n||t),this.name=r,this.source=n,this.url=t,this.onMessage=Fi,this.onError=function(o){return console.log(o)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=Fi,this.onError=Fi,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(i,r){r=r||$n(i),this.worker.postMessage(i,r)},e.prototype.getErrorFromErrorEvent=function(i){var r="Failed to load ";return r+="worker "+this.name+" from "+this.url+". ",i.message&&(r+=i.message+" in "),i.lineno&&(r+=":"+i.lineno+":"+i.colno),new Error(r)},e.prototype.createBrowserWorker=function(){var i=this;this.loadableURL=tn({source:this.source,url:this.url});var r=new Worker(this.loadableURL,{name:this.name});return r.onmessage=function(n){n.data?i.onMessage(n.data):i.onError(new Error("No data received"))},r.onerror=function(n){i.onError(i.getErrorFromErrorEvent(n)),i.terminated=!0},r.onmessageerror=function(n){return console.error("worker "+i.name+", message error: "+n)},r},e}(),Ei=Cn,Si=function(){return Si=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},Si.apply(this,arguments)},mi=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function c(b){try{m(n.next(b))}catch(C){u(C)}}function p(b){try{m(n.throw(b))}catch(C){u(C)}}function m(b){b.done?o(b.value):t(b.value).then(c,p)}m((n=n.apply(e,i||[])).next())})},ai=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function c(m){return function(b){return p([m,b])}}function p(m){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=m[0]&2?t.return:m[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,m[1])).done)return o;switch(t=0,o&&(m=[m[0]&2,o.value]),m[0]){case 0:case 1:o=m;break;case 4:return r.label++,{value:m[1],done:!1};case 5:r.label++,t=m[1],m=[0];continue;case 7:m=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(m[0]===6||m[0]===2)){r=0;continue}if(m[0]===3&&(!o||m[1]>o[0]&&m[1]<o[3])){r.label=m[1];break}if(m[0]===6&&r.label<o[1]){r.label=o[1],o=m;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(m);break}o[2]&&r.ops.pop(),r.trys.pop();continue}m=i.call(e,r)}catch(b){m=[6,b],t=0}finally{n=o=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},Ti=function(){function e(i){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=i.source,this.url=i.url,this.setProps(i)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(i){return i.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(i){this.props=Si(Si({},this.props),i),i.name!==void 0&&(this.name=i.name),i.maxConcurrency!==void 0&&(this.maxConcurrency=i.maxConcurrency),i.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=i.maxMobileConcurrency),i.reuseWorkers!==void 0&&(this.reuseWorkers=i.reuseWorkers),i.onDebug!==void 0&&(this.onDebug=i.onDebug)},e.prototype.startJob=function(i,r,n){return r===void 0&&(r=function(t,o,u){return t.done(u)}),n===void 0&&(n=function(t,o){return t.error(o)}),mi(this,void 0,void 0,function(){var t,o=this;return ai(this,function(u){switch(u.label){case 0:return t=new Promise(function(c){return o.jobQueue.push({name:i,onMessage:r,onError:n,onStart:c}),o}),this.startQueuedJob(),[4,t];case 1:return[2,u.sent()]}})})},e.prototype.startQueuedJob=function(){return mi(this,void 0,void 0,function(){var i,r,n;return ai(this,function(t){switch(t.label){case 0:if(!this.jobQueue.length)return[2];if(i=this.getAvailableWorker(),!i)return[2];if(r=this.jobQueue.shift(),!r)return[3,4];this.onDebug({message:"Starting job",name:r.name,backlog:this.jobQueue.length,workerThread:i}),n=new dr(r.name,i),i.onMessage=function(o){return r.onMessage(n,o.type,o.payload)},i.onError=function(o){return r.onError(n,o)},r.onStart(n),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,n.result];case 2:return t.sent(),[3,4];case 3:return this.returnWorkerToQueue(i),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(i){var r=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();r?(i.destroy(),this.count--):this.idleQueue.push(i),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var i=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Ei({name:i,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return fr?this.maxMobileConcurrency:this.maxConcurrency},e}(),li=Ti,ti=function(){return ti=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},ti.apply(this,arguments)},bo=function(e){var i=typeof Symbol=="function"&&Symbol.iterator,r=i&&e[i],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},ro={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},Ko=function(){function e(i){this.workerPools=new Map,this.props=ti({},ro),this.setProps(i),this.workerPools=new Map}return e.isSupported=function(){return Ei.isSupported()},e.getWorkerFarm=function(i){return i===void 0&&(i={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(i),e.workerFarm},e.prototype.destroy=function(){var i,r;try{for(var n=bo(this.workerPools.values()),t=n.next();!t.done;t=n.next()){var o=t.value;o.destroy()}}catch(u){i={error:u}}finally{try{t&&!t.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}},e.prototype.setProps=function(i){var r,n;this.props=ti(ti({},this.props),i);try{for(var t=bo(this.workerPools.values()),o=t.next();!o.done;o=t.next()){var u=o.value;u.setProps(this.getWorkerPoolProps())}}catch(c){r={error:c}}finally{try{o&&!o.done&&(n=t.return)&&n.call(t)}finally{if(r)throw r.error}}},e.prototype.getWorkerPool=function(i){var r=i.name,n=i.source,t=i.url,o=this.workerPools.get(r);return o||(o=new li({name:r,source:n,url:t}),o.setProps(this.getWorkerPoolProps()),this.workerPools.set(r,o)),o},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),Qo=Ko,Ya=new Map,yo=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(i){self.onmessage=function(r){if(!!fs(r)){var n=r.data,t=n.type,o=n.payload;i(t,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(i){var r=Ya.get(i);r||(r=function(n){if(!!fs(n)){var t=n.data,o=t.type,u=t.payload;i(o,u)}}),self.addEventListener("message",r)},e.removeEventListener=function(i){var r=Ya.get(i);Ya.delete(i),self.removeEventListener("message",r)},e.postMessage=function(i,r){if(self){var n={source:"Worker thread",type:i,payload:r},t=$n(r);self.postMessage(n,t)}},e}(),Eo=yo;function fs(e){var i=e.type,r=e.data;return i==="message"&&r&&typeof r.source=="string"&&r.source==="Main thread"}function il(e){return JSON.parse(Ss(e))}function Ss(e){var i=new Set;return JSON.stringify(e,function(r,n){if(typeof n=="object"&&n!==null){if(i.has(n))try{return JSON.parse(JSON.stringify(n))}catch(t){return}i.add(n)}return n})}function wu(e){return""+e.name}function du(e,i){i===void 0&&(i={});var r=i[e.id]||{},n=e.name+".worker.js",t=r.workerUrl;return i._workerType==="test"&&(t=e.module+"/dist/"+n),t||(t="https://unpkg.com/"+e.module+"/dist/"+n),assert(t),t}var Kl=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function c(b){try{m(n.next(b))}catch(C){u(C)}}function p(b){try{m(n.throw(b))}catch(C){u(C)}}function m(b){b.done?o(b.value):t(b.value).then(c,p)}m((n=n.apply(e,i||[])).next())})},Il=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function c(m){return function(b){return p([m,b])}}function p(m){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=m[0]&2?t.return:m[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,m[1])).done)return o;switch(t=0,o&&(m=[m[0]&2,o.value]),m[0]){case 0:case 1:o=m;break;case 4:return r.label++,{value:m[1],done:!1};case 5:r.label++,t=m[1],m=[0];continue;case 7:m=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(m[0]===6||m[0]===2)){r=0;continue}if(m[0]===3&&(!o||m[1]>o[0]&&m[1]<o[3])){r.label=m[1];break}if(m[0]===6&&r.label<o[1]){r.label=o[1],o=m;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(m);break}o[2]&&r.ops.pop(),r.trys.pop();continue}m=i.call(e,r)}catch(b){m=[6,b],t=0}finally{n=o=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}};function al(e,i){return WorkerFarm.isSupported()?e.worker&&(i==null?void 0:i.worker):!1}function mc(e,i,r,n){return r===void 0&&(r={}),n===void 0&&(n={}),Kl(this,void 0,void 0,function(){var t,o,u,c,p,m,b,C;return Il(this,function(A){switch(A.label){case 0:return t=getWorkerName(e),o=getWorkerURL(e,r),u=WorkerFarm.getWorkerFarm(r),c=u.getWorkerPool({name:t,url:o}),p=r.jobName||e.name,[4,c.startJob(p,gc.bind(null,n))];case 1:return m=A.sent(),b=removeNontransferableOptions(r),m.postMessage("process",{input:i,options:b}),[4,m.result];case 2:return C=A.sent(),[2,C.result]}})})}function gc(e,i,r,n){return Kl(this,void 0,void 0,function(){var t,o,u,c,p,m,b;return Il(this,function(C){switch(C.label){case 0:switch(t=r,t){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return i.done(n),[3,9];case 2:return i.error(new Error(n.error)),[3,9];case 3:o=n.id,u=n.input,c=n.options,C.label=4;case 4:return C.trys.push([4,6,,7]),e.process?[4,e.process(u,c)]:(i.postMessage("error",{id:o,error:"Worker not set up to process on main thread"}),[2]);case 5:return p=C.sent(),i.postMessage("done",{id:o,result:p}),[3,7];case 6:return m=C.sent(),b=m instanceof Error?m.message:"unknown error",i.postMessage("error",{id:o,error:b}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+r),C.label=9;case 9:return[2]}})})}var vu=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(i){return this.enqueue(i)},e.prototype.enqueue=function(i){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var r=this._settlers.shift();i instanceof Error?r.reject(i):r.resolve({value:i})}else this._values.push(i)},e.prototype.close=function(){for(;this._settlers.length>0;){var i=this._settlers.shift();i.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var i=this;if(this._values.length>0){var r=this._values.shift();return r instanceof Error?Promise.reject(r):Promise.resolve({done:!1,value:r})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,t){i._settlers.push({resolve:n,reject:t})})},e}(),Ql=vu,Au=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function c(b){try{m(n.next(b))}catch(C){u(C)}}function p(b){try{m(n.throw(b))}catch(C){u(C)}}function m(b){b.done?o(b.value):t(b.value).then(c,p)}m((n=n.apply(e,i||[])).next())})},Po=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function c(m){return function(b){return p([m,b])}}function p(m){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=m[0]&2?t.return:m[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,m[1])).done)return o;switch(t=0,o&&(m=[m[0]&2,o.value]),m[0]){case 0:case 1:o=m;break;case 4:return r.label++,{value:m[1],done:!1};case 5:r.label++,t=m[1],m=[0];continue;case 7:m=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(m[0]===6||m[0]===2)){r=0;continue}if(m[0]===3&&(!o||m[1]>o[0]&&m[1]<o[3])){r.label=m[1];break}if(m[0]===6&&r.label<o[1]){r.label=o[1],o=m;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(m);break}o[2]&&r.ops.pop(),r.trys.pop();continue}m=i.call(e,r)}catch(b){m=[6,b],t=0}finally{n=o=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},Wu=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e[Symbol.asyncIterator],r;return i?i.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(u){return new Promise(function(c,p){u=e[o](u),t(c,p,u.done,u.value)})}}function t(o,u,c,p){Promise.resolve(p).then(function(m){o({value:m,done:c})},u)}},ol=0,mu,ua;function Gs(e,i){var r=this;if(typeof self!="undefined"){var n={process:Cs};Eo.onmessage=function(t,o){return Au(r,void 0,void 0,function(){var u,c,p,m,b,C,A,P,O,D,N;return Po(this,function(j){switch(j.label){case 0:switch(j.trys.push([0,19,,20]),u=t,u){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},n)];case 2:return c=j.sent(),Eo.postMessage("done",{result:c}),[3,18];case 3:if(!i)throw new Error("Worker does not support batched processing");mu=new Ql,ua=o.options||{},p=i(mu,ua,n),j.label=4;case 4:j.trys.push([4,9,10,15]),m=Wu(p),j.label=5;case 5:return[4,m.next()];case 6:if(b=j.sent(),!!b.done)return[3,8];C=b.value,Eo.postMessage("output-batch",{result:C}),j.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return A=j.sent(),D={error:A},[3,15];case 10:return j.trys.push([10,,13,14]),b&&!b.done&&(N=m.return)?[4,N.call(m)]:[3,12];case 11:j.sent(),j.label=12;case 12:return[3,14];case 13:if(D)throw D.error;return[7];case 14:return[7];case 15:return Eo.postMessage("done",{}),[3,18];case 16:return mu.push(o.input),[3,18];case 17:return mu.close(),[3,18];case 18:return[3,20];case 19:return P=j.sent(),O=P instanceof Error?P.message:"",Eo.postMessage("error",{error:O}),[3,20];case 20:return[2]}})})}}}function Cs(e,i){return i===void 0&&(i={}),new Promise(function(r,n){var t=ol++,o=function(c,p){if(p.id===t)switch(c){case"done":Eo.removeEventListener(o),r(p.result);break;case"error":Eo.removeEventListener(o),n(p.error);break;default:}};Eo.addEventListener(o);var u={id:t,input:e,options:i};Eo.postMessage("process",u)})}var Xu=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function c(b){try{m(n.next(b))}catch(C){u(C)}}function p(b){try{m(n.throw(b))}catch(C){u(C)}}function m(b){b.done?o(b.value):t(b.value).then(c,p)}m((n=n.apply(e,i||[])).next())})},yc=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function c(m){return function(b){return p([m,b])}}function p(m){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=m[0]&2?t.return:m[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,m[1])).done)return o;switch(t=0,o&&(m=[m[0]&2,o.value]),m[0]){case 0:case 1:o=m;break;case 4:return r.label++,{value:m[1],done:!1};case 5:r.label++,t=m[1],m=[0];continue;case 7:m=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(m[0]===6||m[0]===2)){r=0;continue}if(m[0]===3&&(!o||m[1]>o[0]&&m[1]<o[3])){r.label=m[1];break}if(m[0]===6&&r.label<o[1]){r.label=o[1],o=m;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(m);break}o[2]&&r.ops.pop(),r.trys.pop();continue}m=i.call(e,r)}catch(b){m=[6,b],t=0}finally{n=o=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},Jl={};function Qf(e,i,r){return i===void 0&&(i=null),r===void 0&&(r={}),Xu(this,void 0,void 0,function(){return yc(this,function(n){switch(n.label){case 0:return i&&(e=ru(e,i,r)),Jl[e]=Jl[e]||_c(e),[4,Jl[e]];case 1:return[2,n.sent()]}})})}function ru(e,i,r){if(e.startsWith("http"))return e;var n=r.modules||{};return n[e]?n[e]:r.CDN?(assert(r.CDN.startsWith("http")),r.CDN+"/"+i+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+i+"/src/libs/"+e}function _c(e){return Xu(this,void 0,void 0,function(){var i,r,n;return yc(this,function(t){switch(t.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return i=t.sent(),[4,i.arrayBuffer()];case 2:return[2,t.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return r=t.sent(),[4,r.text()];case 5:return n=t.sent(),[2,gu(n,e)]}})})}function gu(e,i){if(isWorker)return eval.call(global,e),null;var r=document.createElement("script");r.id=i;try{r.appendChild(document.createTextNode(e))}catch(n){r.text=e}return document.body.appendChild(r),null}var ec="0.0.3",Cf={id:"null",name:"null",module:"web-worker-helper",options:{}};function nu(e){var i=e.color;return!i||!i.length?[1,1,1,1]:i}function Lo(e,i,r){return r.length===2?[r[0],r[1],0]:[r[0],r[1],r[2]]}function tc(e){var i=e.filter;return i?[1]:[0]}function Kc(e,i){return[i]}var Th=fe(9187),Hs=fe.n(Th),jr=fe(31437),wf=jr.create(),Qc=jr.create(),So=jr.create(),sl=jr.create(),Jc=jr.create();function ul(e,i,r,n,t){jr.add(e,r,n),jr.normalize(e,e),i=jr.fromValues(-e[1],e[0]);var o=jr.fromValues(-r[1],r[0]);return[t/jr.dot(i,o),i]}function Tu(e,i){return jr.set(e,-i[1],i[0])}function ef(e,i,r){return jr.sub(e,i,r),jr.normalize(e,e),e}function dp(e,i){return e[0]===i[0]&&e[1]===i[1]}function Jf(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var vp=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,vt.Z)(this,e),(0,T.Z)(this,"lastFlip",-1),(0,T.Z)(this,"miter",jr.fromValues(0,0)),(0,T.Z)(this,"started",!1),(0,T.Z)(this,"dash",!1),(0,T.Z)(this,"totalDistance",0),(0,T.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,yt.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,c=1;c<o;c++){var p,m,b,C=r[c-1];C.push((p=n[c-1][2])!==null&&p!==void 0?p:0);var A=n[c-1],P=r[c];P.push((m=n[c][2])!==null&&m!==void 0?m:0);var O=n[c],D=c<r.length-1?[].concat((0,ee.Z)(r[c+1]),[(b=n[c+1][2])!==null&&b!==void 0?b:0]):null,N=c<n.length-1?n[c+1]:null,j=this.segment_gaode2(t,u,C,P,D,A,O,N);u+=j}if(this.dash)for(var ae=0;ae<t.positions.length/6;ae++)t.positions[ae*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,c=1;c<o;c++){var p,m,b,C=r[c-1];C.push((p=n[c-1][2])!==null&&p!==void 0?p:0);var A=n[c-1],P=r[c];P.push((m=n[c][2])!==null&&m!==void 0?m:0);var O=n[c],D=c<r.length-1?[].concat((0,ee.Z)(r[c+1]),[(b=n[c+1][2])!==null&&b!==void 0?b:0]):null,N=c<n.length-1?n[c+1]:null,j=this.simpleSegment(t,u,C,P,D,A,O,N);u+=j}if(this.dash)for(var ae=0;ae<t.positions.length/6;ae++)t.positions[ae*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var c=r[u-1],p=r[u],m=u<r.length-1?r[u+1]:null,b=this.segment(n,o,c,p,m);o+=b}if(this.dash)for(var C=0;C<n.positions.length/6;C++)n.positions[C*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var c=r[u-1],p=r[u],m=u<r.length-1?r[u+1]:null,b=this.simpleSegment(n,o,c,p,m);o+=b}if(this.dash)for(var C=0;C<n.positions.length/6;C++)n.positions[C*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,t,o,u,c,p,m){var b=0,C=r.indices,A=r.positions,P=r.normals,O=this.cap==="square",D=this.join==="bevel",N=Xa([p[0],p[1]]),j=Xa([c[0],c[1]]);ef(So,o,t);var ae=0;if(this.dash&&(ae=this.lineSegmentDistance(N,j),this.totalDistance+=ae),this.normal||(this.normal=jr.create(),Tu(this.normal,So)),!this.started)if(this.started=!0,O){var re=jr.create(),Te=jr.create();jr.add(re,this.normal,So),jr.add(Te,this.normal,So),P.push(Te[0],Te[1],0),P.push(re[0],re[1],0),A.push(t[0],t[1],t[2]|0,this.totalDistance-ae,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),A.push(t[0],t[1],t[2]|0,this.totalDistance-ae,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,P,t,this.normal,this.thickness,this.totalDistance-ae);if(C.push(n+0,n+1,n+2),u){dp(o,u)&&jr.add(u,o,jr.normalize(u,jr.subtract(u,o,t))),ef(sl,u,o);var gt=ul(Jc,jr.create(),So,sl,this.thickness),lt=(0,ce.Z)(gt,2),Ut=lt[0],or=lt[1],cr=jr.dot(Jc,this.normal)<0?-1:1,Tr=D;if(!Tr&&this.join==="miter"){var Sn=Ut;Sn>this.miterLimit&&(Tr=!0)}Tr?(P.push(this.normal[0],this.normal[1],0),P.push(or[0],or[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,C.push.apply(C,(0,ee.Z)(this.lastFlip!==-cr?[n,n+2,n+3]:[n+2,n+1,n+3])),C.push(n+2,n+3,n+4),Tu(wf,sl),jr.copy(this.normal,wf),P.push(this.normal[0],this.normal[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b+=3):(this.extrusions(A,P,o,or,Ut,this.totalDistance),C.push.apply(C,(0,ee.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),cr=-1,jr.copy(this.normal,or),b+=2),this.lastFlip=cr}else{if(Tu(this.normal,So),O){var Re=jr.create(),Ke=jr.create();jr.sub(Ke,So,this.normal),jr.add(Re,So,this.normal),P.push(Ke[0],Ke[1],0),P.push(Re[0],Re[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,P,o,this.normal,this.thickness,this.totalDistance);C.push.apply(C,(0,ee.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),b+=2}return b}},{key:"simpleSegment",value:function(r,n,t,o,u){var c=0,p=r.indices,m=r.positions,b=r.normals,C=Xa([o[0],o[1]]),A=Xa([t[0],t[1]]);ef(So,C,A);var P=0;if(this.dash&&(P=this.lineSegmentDistance(C,A),this.totalDistance+=P),this.normal||(this.normal=jr.create(),Tu(this.normal,So)),this.started||(this.started=!0,this.extrusions(m,b,t,this.normal,this.thickness,this.totalDistance-P)),p.push(n+0,n+1,n+2),!u)Tu(this.normal,So),this.extrusions(m,b,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,ee.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),c+=2;else{var O=Xa([u[0],u[1]]);dp(C,O)&&jr.add(O,C,jr.normalize(O,jr.subtract(O,C,A))),ef(sl,O,C);var D=ul(Jc,jr.create(),So,sl,this.thickness),N=(0,ce.Z)(D,2),j=N[0],ae=N[1],re=jr.dot(Jc,this.normal)<0?-1:1;this.extrusions(m,b,o,ae,j,this.totalDistance),p.push.apply(p,(0,ee.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),re=-1,jr.copy(this.normal,ae),c+=2,this.lastFlip=re}return c}},{key:"segment",value:function(r,n,t,o,u){var c=0,p=r.indices,m=r.positions,b=r.normals,C=this.cap==="square",A=this.join==="bevel",P=Xa([o[0],o[1]]),O=Xa([t[0],t[1]]);ef(So,P,O);var D=0;if(this.dash&&(D=this.lineSegmentDistance(P,O),this.totalDistance+=D),this.normal||(this.normal=jr.create(),Tu(this.normal,So)),!this.started)if(this.started=!0,C){var N=jr.create(),j=jr.create();jr.add(N,this.normal,So),jr.add(j,this.normal,So),b.push(j[0],j[1],0),b.push(N[0],N[1],0),m.push(t[0],t[1],t[2]|0,this.totalDistance-D,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),m.push(t[0],t[1],t[2]|0,this.totalDistance-D,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(m,b,t,this.normal,this.thickness,this.totalDistance-D);if(p.push(n+0,n+1,n+2),u){var Te=Xa([u[0],u[1]]);dp(P,Te)&&jr.add(Te,P,jr.normalize(Te,jr.subtract(Te,P,O))),ef(sl,Te,P);var Re=ul(Jc,jr.create(),So,sl,this.thickness),Ke=(0,ce.Z)(Re,2),gt=Ke[0],lt=Ke[1],Ut=jr.dot(Jc,this.normal)<0?-1:1,or=A;if(!or&&this.join==="miter"){var cr=gt;cr>this.miterLimit&&(or=!0)}or?(b.push(this.normal[0],this.normal[1],0),b.push(lt[0],lt[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Ut,o[2]|0),this.complex.indexes.push(this.currentIndex),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Ut,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,ee.Z)(this.lastFlip!==-Ut?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),Tu(wf,sl),jr.copy(this.normal,wf),b.push(this.normal[0],this.normal[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Ut,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c+=3):(this.extrusions(m,b,o,lt,gt,this.totalDistance),p.push.apply(p,(0,ee.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ut=-1,jr.copy(this.normal,lt),c+=2),this.lastFlip=Ut}else{if(Tu(this.normal,So),C){var ae=jr.create(),re=jr.create();jr.sub(re,So,this.normal),jr.add(ae,So,this.normal),b.push(re[0],re[1],0),b.push(ae[0],ae[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(m,b,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,ee.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),c+=2}return c}},{key:"extrusions",value:function(r,n,t,o,u,c){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(t[0],t[1],t[2]|0,c,-u,t[2]|0),this.complex.indexes.push(this.currentIndex),r.push(t[0],t[1],t[2]|0,c,u,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var t=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(t*t+o*o)}}]),e}();function mp(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,t=new vp({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=r;Array.isArray(u[0][0])||(u=[r]);for(var c=0;c<o.length;c++){var p=o[c],m=u[c];t.extrude_gaode2(p,m)}}else{var b=i;b[0]&&!Array.isArray(b[0][0])&&(b=[i]),b.forEach(function(A){t.extrude(A)})}var C=t.complex;return{vertices:C.positions,indices:C.indices,normals:C.normals,indexes:C.indexes,size:6}}function Mh(e){var i=go(e.coordinates);return{vertices:[].concat((0,ee.Z)(i),(0,ee.Z)(i),(0,ee.Z)(i),(0,ee.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function gp(e){var i=e.coordinates,r=Hs().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:Hs()(n,o,t),vertices:n,size:t}}var yp=function(){var e=(0,ue.Z)(te().mark(function i(r){var n,t,o,u,c,p,m,b,C;return te().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u=r.iconMap,c={a_Color:nu,a_Position:Lo,filter:tc,a_vertexId:Kc,a_PickingColor:function(D){var N=D.id;return o?S(N):[0,0,0]},a_DistanceAndIndex:function(D,N,j,ae,re,Te){return Te===void 0?[j[3],10]:[j[3],Te]},a_Total_Distance:function(D,N,j){return[j[5]]},a_Size:function(D){var N=D.size,j=N===void 0?1:N;return Array.isArray(j)?[j[0],j[1]]:[j,0]},a_Normal:function(D,N,j,ae,re){return re},a_Miter:function(D,N,j){return[j[4]]},a_iconMapUV:function(D){var N=D.texture,j=u[N]||{x:0,y:0},ae=j.x,re=j.y;return[ae,re]}},p={sizePerElement:0,elements:[]},m=0,b=[],C=3,t.forEach(function(O,D){var N=mp(O),j=N.indices,ae=N.vertices,re=N.normals,Te=N.size,Re=N.indexes;j.forEach(function(Ut){b.push(Ut+m)}),C=Te;var Ke=ae.length/Te;p.sizePerElement=C,p.elements.push({featureIdx:D,vertices:ae,normals:re,offset:m}),m+=Ke;for(var gt=function(or){var cr=(re==null?void 0:re.slice(or*3,or*3+3))||[],Tr=ae.slice(or*Te,or*Te+Te),Sn=0;Re&&Re[or]!==void 0&&(Sn=Re[or]),n.forEach(function(Un){if(Un&&c[Un.name]){var Vi;(Vi=Un.buffer.data).push.apply(Vi,(0,ee.Z)(c[Un.name](O,D,Tr,or,cr,Sn)))}})},lt=0;lt<Ke;lt++)gt(lt)}),P.abrupt("return",{descriptors:n,featureLayout:p,indices:b});case 8:case"end":return P.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),$d=function(){var e=(0,ue.Z)(te().mark(function i(r){var n,t,o,u,c,p,m,b,C;return te().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u=r.shape2d,c={a_Color:nu,a_Position:Lo,filter:tc,a_vertexId:Kc,a_PickingColor:function(D){var N=D.id;return o?S(N):[0,0,0]},a_Shape:function(D){var N=D.shape,j=N===void 0?2:N,ae=u.indexOf(j);return[ae]},a_Extrude:function(D,N,j,ae){var re=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Te=ae%4*3;return[re[Te],re[Te+1],re[Te+2]]},a_Size:function(D){var N=D.size,j=N===void 0?5:N;return Array.isArray(j)?[j[0]]:[j]}},p={sizePerElement:0,elements:[]},m=0,b=[],C=3,t.forEach(function(O,D){var N=Mh(O),j=N.indices,ae=N.vertices,re=N.normals,Te=N.size,Re=N.indexes;j.forEach(function(Ut){b.push(Ut+m)}),C=Te;var Ke=ae.length/Te;p.sizePerElement=C,p.elements.push({featureIdx:D,vertices:ae,normals:re,offset:m}),m+=Ke;for(var gt=function(or){var cr=(re==null?void 0:re.slice(or*3,or*3+3))||[],Tr=ae.slice(or*Te,or*Te+Te),Sn=0;Re&&Re[or]!==void 0&&(Sn=Re[or]),n.forEach(function(Un){if(Un&&c[Un.name]){var Vi;(Vi=Un.buffer.data).push.apply(Vi,(0,ee.Z)(c[Un.name](O,D,Tr,or,cr,Sn)))}})},lt=0;lt<Ke;lt++)gt(lt)}),P.abrupt("return",{descriptors:n,featureLayout:p,indices:b});case 8:case"end":return P.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),Af=function(){var e=(0,ue.Z)(te().mark(function i(r){var n,t,o,u,c,p,m,b;return te().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u={a_Color:nu,a_Position:Lo,filter:tc,a_vertexId:Kc,a_PickingColor:function(O){var D=O.id;return o?S(D):[0,0,0]}},c={sizePerElement:0,elements:[]},p=0,m=[],b=3,t.forEach(function(P,O){var D=gp(P),N=D.indices,j=D.vertices,ae=D.normals,re=D.size,Te=D.indexes;N.forEach(function(lt){m.push(lt+p)}),b=re;var Re=j.length/re;c.sizePerElement=b,c.elements.push({featureIdx:O,vertices:j,normals:ae,offset:p}),p+=Re;for(var Ke=function(Ut){var or=(ae==null?void 0:ae.slice(Ut*3,Ut*3+3))||[],cr=j.slice(Ut*re,Ut*re+re),Tr=0;Te&&Te[Ut]!==void 0&&(Tr=Te[Ut]),n.forEach(function(Sn){if(Sn&&u[Sn.name]){var Un;(Un=Sn.buffer.data).push.apply(Un,(0,ee.Z)(u[Sn.name](P,O,cr,Ut,or,Tr)))}})},gt=0;gt<Re;gt++)Ke(gt)}),A.abrupt("return",{descriptors:n,featureLayout:c,indices:m});case 8:case"end":return A.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),ud={pointFill:$d,line:yp,polygonFill:Af},Ro=(0,oe.Z)({},ud);function Ih(e){return kh.apply(this,arguments)}function kh(){return kh=(0,ue.Z)(te().mark(function e(i){var r,n;return te().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(r=i.workerType,n=i.data,!Ro[r]){o.next=3;break}return o.abrupt("return",Ro[r](n));case 3:return o.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(r,'" non-existent.'))));case 4:case"end":return o.stop()}},e)})),kh.apply(this,arguments)}Gs(Ih);var eh=new Map;function Ph(e,i){eh.set(e,i)}function th(e){var i=eh.get(e);return i}var Lh=`var L7=function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var o=e&&e.prototype instanceof h?e:h,i=Object.create(o.prototype),a=new O(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return T()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=w(a,r);if(u){if(u===l)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=f(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(t,r,a),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function p(){}function v(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(S([])));g&&g!==e&&n.call(g,i)&&(d=g);var m=v.prototype=h.prototype=Object.create(d);function x(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,u){var s=f(t[o],t,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=f(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return p.prototype=v,s(m,"constructor",v),s(v,"constructor",p),p.displayName=s(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,s(t,u,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},x(b.prototype),s(b.prototype,a,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(m),s(m,u,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function n(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function u(t){n(a,o,i,u,s,"next",t)}function s(t){n(a,o,i,u,s,"throw",t)}u(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f(t);if(e){var o=f(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function b(t,e){return t(e={exports:{}},e.exports),e.exports}var w,E,A=function(t){return t&&t.Math==Math&&t},O=A("object"==typeof globalThis&&globalThis)||A("object"==typeof window&&window)||A("object"==typeof self&&self)||A("object"==typeof x&&x)||function(){return this}()||Function("return this")(),S=Object.defineProperty,T=function(t,e){try{S(O,t,{value:e,configurable:!0,writable:!0})}catch(r){O[t]=e}return e},k=O["__core-js_shared__"]||T("__core-js_shared__",{}),I=b((function(t){(t.exports=function(t,e){return k[t]||(k[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.24.1",mode:"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.24.1/LICENSE",source:"https://github.com/zloirock/core-js"})})),j=function(t){try{return!!t()}catch(t){return!0}},P=!j((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),_=Function.prototype,M=_.bind,L=_.call,R=P&&M.bind(L,L),C=P?function(t){return t&&R(t)}:function(t){return t&&function(){return L.apply(t,arguments)}},N=TypeError,D=function(t){if(null==t)throw N("Can't call method on "+t);return t},F=Object,W=function(t){return F(D(t))},z=C({}.hasOwnProperty),B=Object.hasOwn||function(t,e){return z(W(t),e)},U=0,G=Math.random(),V=C(1..toString),q=function(t){return"Symbol("+(void 0===t?"":t)+")_"+V(++U+G,36)},H=function(t){return"function"==typeof t},Z=function(t){return H(t)?t:void 0},Y=function(t,e){return arguments.length<2?Z(O[t]):O[t]&&O[t][e]},$=Y("navigator","userAgent")||"",K=O.process,Q=O.Deno,X=K&&K.versions||Q&&Q.version,J=X&&X.v8;J&&(E=(w=J.split("."))[0]>0&&w[0]<4?1:+(w[0]+w[1])),!E&&$&&(!(w=$.match(/Edge\\/(\\d+)/))||w[1]>=74)&&(w=$.match(/Chrome\\/(\\d+)/))&&(E=+w[1]);var tt=E,et=!!Object.getOwnPropertySymbols&&!j((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&tt&&tt<41})),rt=et&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,nt=I("wks"),ot=O.Symbol,it=ot&&ot.for,at=rt?ot:ot&&ot.withoutSetter||q,ut=function(t){if(!B(nt,t)||!et&&"string"!=typeof nt[t]){var e="Symbol."+t;et&&B(ot,t)?nt[t]=ot[t]:nt[t]=rt&&it?it(e):at(e)}return nt[t]},st={};st[ut("toStringTag")]="z";var ct="[object z]"===String(st),ft=!j((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),lt=function(t){return"object"==typeof t?null!==t:H(t)},ht=O.document,pt=lt(ht)&&lt(ht.createElement),vt=function(t){return pt?ht.createElement(t):{}},dt=!ft&&!j((function(){return 7!=Object.defineProperty(vt("div"),"a",{get:function(){return 7}}).a})),yt=ft&&j((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),gt=String,mt=TypeError,xt=function(t){if(lt(t))return t;throw mt(gt(t)+" is not an object")},bt=Function.prototype.call,wt=P?bt.bind(bt):function(){return bt.apply(bt,arguments)},Et=C({}.isPrototypeOf),At=Object,Ot=rt?function(t){return"symbol"==typeof t}:function(t){var e=Y("Symbol");return H(e)&&Et(e.prototype,At(t))},St=String,Tt=function(t){try{return St(t)}catch(t){return"Object"}},kt=TypeError,It=function(t){if(H(t))return t;throw kt(Tt(t)+" is not a function")},jt=function(t,e){var r=t[e];return null==r?void 0:It(r)},Pt=TypeError,_t=TypeError,Mt=ut("toPrimitive"),Lt=function(t,e){if(!lt(t)||Ot(t))return t;var r,n=jt(t,Mt);if(n){if(void 0===e&&(e="default"),r=wt(n,t,e),!lt(r)||Ot(r))return r;throw _t("Can't convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var r,n;if("string"===e&&H(r=t.toString)&&!lt(n=wt(r,t)))return n;if(H(r=t.valueOf)&&!lt(n=wt(r,t)))return n;if("string"!==e&&H(r=t.toString)&&!lt(n=wt(r,t)))return n;throw Pt("Can't convert object to primitive value")}(t,e)},Rt=function(t){var e=Lt(t,"string");return Ot(e)?e:e+""},Ct=TypeError,Nt=Object.defineProperty,Dt=Object.getOwnPropertyDescriptor,Ft={f:ft?yt?function(t,e,r){if(xt(t),e=Rt(e),xt(r),"function"==typeof t&&"prototype"===e&&"value"in r&&"writable"in r&&!r.writable){var n=Dt(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return Nt(t,e,r)}:Nt:function(t,e,r){if(xt(t),e=Rt(e),xt(r),dt)try{return Nt(t,e,r)}catch(t){}if("get"in r||"set"in r)throw Ct("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},Wt=Function.prototype,zt=ft&&Object.getOwnPropertyDescriptor,Bt=B(Wt,"name"),Ut={EXISTS:Bt,PROPER:Bt&&"something"===function(){}.name,CONFIGURABLE:Bt&&(!ft||ft&&zt(Wt,"name").configurable)},Gt=C(Function.toString);H(k.inspectSource)||(k.inspectSource=function(t){return Gt(t)});var Vt,qt,Ht,Zt=k.inspectSource,Yt=O.WeakMap,$t=H(Yt)&&/native code/.test(Zt(Yt)),Kt=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Qt=ft?function(t,e,r){return Ft.f(t,e,Kt(1,r))}:function(t,e,r){return t[e]=r,t},Xt=I("keys"),Jt=function(t){return Xt[t]||(Xt[t]=q(t))},te={},ee=O.TypeError,re=O.WeakMap;if($t||k.state){var ne=k.state||(k.state=new re),oe=C(ne.get),ie=C(ne.has),ae=C(ne.set);Vt=function(t,e){if(ie(ne,t))throw new ee("Object already initialized");return e.facade=t,ae(ne,t,e),e},qt=function(t){return oe(ne,t)||{}},Ht=function(t){return ie(ne,t)}}else{var ue=Jt("state");te[ue]=!0,Vt=function(t,e){if(B(t,ue))throw new ee("Object already initialized");return e.facade=t,Qt(t,ue,e),e},qt=function(t){return B(t,ue)?t[ue]:{}},Ht=function(t){return B(t,ue)}}var se={set:Vt,get:qt,has:Ht,enforce:function(t){return Ht(t)?qt(t):Vt(t,{})},getterFor:function(t){return function(e){var r;if(!lt(e)||(r=qt(e)).type!==t)throw ee("Incompatible receiver, "+t+" required");return r}}},ce=b((function(t){var e=Ut.CONFIGURABLE,r=se.enforce,n=se.get,o=Object.defineProperty,i=ft&&!j((function(){return 8!==o((function(){}),"length",{value:8}).length})),a=String(String).split("String"),u=t.exports=function(t,n,u){"Symbol("===String(n).slice(0,7)&&(n="["+String(n).replace(/^Symbol\\(([^)]*)\\)/,"$1")+"]"),u&&u.getter&&(n="get "+n),u&&u.setter&&(n="set "+n),(!B(t,"name")||e&&t.name!==n)&&(ft?o(t,"name",{value:n,configurable:!0}):t.name=n),i&&u&&B(u,"arity")&&t.length!==u.arity&&o(t,"length",{value:u.arity});try{u&&B(u,"constructor")&&u.constructor?ft&&o(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var s=r(t);return B(s,"source")||(s.source=a.join("string"==typeof n?n:"")),t};Function.prototype.toString=u((function(){return H(this)&&n(this).source||Zt(this)}),"toString")})),fe=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if(H(r)&&ce(r,i,n),n.global)o?t[e]=r:T(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:Ft.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},le=C({}.toString),he=C("".slice),pe=function(t){return he(le(t),8,-1)},ve=ut("toStringTag"),de=Object,ye="Arguments"==pe(function(){return arguments}()),ge=ct?pe:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=de(t),ve))?r:ye?pe(e):"Object"==(n=pe(e))&&H(e.callee)?"Arguments":n},me=ct?{}.toString:function(){return"[object "+ge(this)+"]"};ct||fe(Object.prototype,"toString",me,{unsafe:!0});var xe={}.propertyIsEnumerable,be=Object.getOwnPropertyDescriptor,we={f:be&&!xe.call({1:2},1)?function(t){var e=be(this,t);return!!e&&e.enumerable}:xe},Ee=Object,Ae=C("".split),Oe=j((function(){return!Ee("z").propertyIsEnumerable(0)}))?function(t){return"String"==pe(t)?Ae(t,""):Ee(t)}:Ee,Se=function(t){return Oe(D(t))},Te=Object.getOwnPropertyDescriptor,ke={f:ft?Te:function(t,e){if(t=Se(t),e=Rt(e),dt)try{return Te(t,e)}catch(t){}if(B(t,e))return Kt(!wt(we.f,t,e),t[e])}},Ie=Math.ceil,je=Math.floor,Pe=Math.trunc||function(t){var e=+t;return(e>0?je:Ie)(e)},_e=function(t){var e=+t;return e!=e||0===e?0:Pe(e)},Me=Math.max,Le=Math.min,Re=function(t,e){var r=_e(t);return r<0?Me(r+e,0):Le(r,e)},Ce=Math.min,Ne=function(t){return t>0?Ce(_e(t),9007199254740991):0},De=function(t){return Ne(t.length)},Fe=function(t){return function(e,r,n){var o,i=Se(e),a=De(i),u=Re(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},We={includes:Fe(!0),indexOf:Fe(!1)},ze=We.indexOf,Be=C([].push),Ue=function(t,e){var r,n=Se(t),o=0,i=[];for(r in n)!B(te,r)&&B(n,r)&&Be(i,r);for(;e.length>o;)B(n,r=e[o++])&&(~ze(i,r)||Be(i,r));return i},Ge=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ve=Ge.concat("length","prototype"),qe={f:Object.getOwnPropertyNames||function(t){return Ue(t,Ve)}},He={f:Object.getOwnPropertySymbols},Ze=C([].concat),Ye=Y("Reflect","ownKeys")||function(t){var e=qe.f(xt(t)),r=He.f;return r?Ze(e,r(t)):e},$e=function(t,e,r){for(var n=Ye(e),o=Ft.f,i=ke.f,a=0;a<n.length;a++){var u=n[a];B(t,u)||r&&B(r,u)||o(t,u,i(e,u))}},Ke=/#|\\.prototype\\./,Qe=function(t,e){var r=Je[Xe(t)];return r==er||r!=tr&&(H(e)?j(e):!!e)},Xe=Qe.normalize=function(t){return String(t).replace(Ke,".").toLowerCase()},Je=Qe.data={},tr=Qe.NATIVE="N",er=Qe.POLYFILL="P",rr=Qe,nr=ke.f,or=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?O:c?O[u]||T(u,{}):(O[u]||{}).prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(a=nr(r,n))&&a.value:r[n],!rr(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;$e(i,o)}(t.sham||o&&o.sham)&&Qt(i,"sham",!0),fe(r,n,i,t)}},ir="process"==pe(O.process),ar=String,ur=TypeError,sr=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=C(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return xt(r),function(t){if("object"==typeof t||H(t))return t;throw ur("Can't set "+ar(t)+" as a prototype")}(n),e?t(r,n):r.__proto__=n,r}}():void 0),cr=Ft.f,fr=ut("toStringTag"),lr=function(t,e,r){t&&!r&&(t=t.prototype),t&&!B(t,fr)&&cr(t,fr,{configurable:!0,value:e})},hr=ut("species"),pr=function(t){var e=Y(t),r=Ft.f;ft&&e&&!e[hr]&&r(e,hr,{configurable:!0,get:function(){return this}})},vr=TypeError,dr=function(t,e){if(Et(e,t))return t;throw vr("Incorrect invocation")},yr=function(){},gr=[],mr=Y("Reflect","construct"),xr=/^\\s*(?:class|function)\\b/,br=C(xr.exec),wr=!xr.exec(yr),Er=function(t){if(!H(t))return!1;try{return mr(yr,gr,t),!0}catch(t){return!1}},Ar=function(t){if(!H(t))return!1;switch(ge(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return wr||!!br(xr,Zt(t))}catch(t){return!0}};Ar.sham=!0;var Or,Sr,Tr,kr,Ir=!mr||j((function(){var t;return Er(Er.call)||!Er(Object)||!Er((function(){t=!0}))||t}))?Ar:Er,jr=TypeError,Pr=function(t){if(Ir(t))return t;throw jr(Tt(t)+" is not a constructor")},_r=ut("species"),Mr=function(t,e){var r,n=xt(t).constructor;return void 0===n||null==(r=xt(n)[_r])?e:Pr(r)},Lr=Function.prototype,Rr=Lr.apply,Cr=Lr.call,Nr="object"==typeof Reflect&&Reflect.apply||(P?Cr.bind(Rr):function(){return Cr.apply(Rr,arguments)}),Dr=C(C.bind),Fr=function(t,e){return It(t),void 0===e?t:P?Dr(t,e):function(){return t.apply(e,arguments)}},Wr=Y("document","documentElement"),zr=C([].slice),Br=TypeError,Ur=function(t,e){if(t<e)throw Br("Not enough arguments");return t},Gr=/(?:ipad|iphone|ipod).*applewebkit/i.test($),Vr=O.setImmediate,qr=O.clearImmediate,Hr=O.process,Zr=O.Dispatch,Yr=O.Function,$r=O.MessageChannel,Kr=O.String,Qr=0,Xr={};try{Or=O.location}catch(t){}var Jr=function(t){if(B(Xr,t)){var e=Xr[t];delete Xr[t],e()}},tn=function(t){return function(){Jr(t)}},en=function(t){Jr(t.data)},rn=function(t){O.postMessage(Kr(t),Or.protocol+"//"+Or.host)};Vr&&qr||(Vr=function(t){Ur(arguments.length,1);var e=H(t)?t:Yr(t),r=zr(arguments,1);return Xr[++Qr]=function(){Nr(e,void 0,r)},Sr(Qr),Qr},qr=function(t){delete Xr[t]},ir?Sr=function(t){Hr.nextTick(tn(t))}:Zr&&Zr.now?Sr=function(t){Zr.now(tn(t))}:$r&&!Gr?(kr=(Tr=new $r).port2,Tr.port1.onmessage=en,Sr=Fr(kr.postMessage,kr)):O.addEventListener&&H(O.postMessage)&&!O.importScripts&&Or&&"file:"!==Or.protocol&&!j(rn)?(Sr=rn,O.addEventListener("message",en,!1)):Sr="onreadystatechange"in vt("script")?function(t){Wr.appendChild(vt("script")).onreadystatechange=function(){Wr.removeChild(this),Jr(t)}}:function(t){setTimeout(tn(t),0)});var nn,on,an,un,sn,cn,fn,ln,hn={set:Vr,clear:qr},pn=/ipad|iphone|ipod/i.test($)&&void 0!==O.Pebble,vn=/web0s(?!.*chrome)/i.test($),dn=ke.f,yn=hn.set,gn=O.MutationObserver||O.WebKitMutationObserver,mn=O.document,xn=O.process,bn=O.Promise,wn=dn(O,"queueMicrotask"),En=wn&&wn.value;En||(nn=function(){var t,e;for(ir&&(t=xn.domain)&&t.exit();on;){e=on.fn,on=on.next;try{e()}catch(t){throw on?un():an=void 0,t}}an=void 0,t&&t.enter()},Gr||ir||vn||!gn||!mn?!pn&&bn&&bn.resolve?((fn=bn.resolve(void 0)).constructor=bn,ln=Fr(fn.then,fn),un=function(){ln(nn)}):ir?un=function(){xn.nextTick(nn)}:(yn=Fr(yn,O),un=function(){yn(nn)}):(sn=!0,cn=mn.createTextNode(""),new gn(nn).observe(cn,{characterData:!0}),un=function(){cn.data=sn=!sn}));var An=En||function(t){var e={fn:t,next:void 0};an&&(an.next=e),on||(on=e,un()),an=e},On=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Sn=function(){this.head=null,this.tail=null};Sn.prototype={add:function(t){var e={item:t,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var Tn,kn,In,jn=Sn,Pn=O.Promise,_n="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Mn=!_n&&!ir&&"object"==typeof window&&"object"==typeof document,Ln=(Pn&&Pn.prototype,ut("species")),Rn=!1,Cn=H(O.PromiseRejectionEvent),Nn={CONSTRUCTOR:rr("Promise",(function(){var t=Zt(Pn),e=t!==String(Pn);if(!e&&66===tt)return!0;if(!tt||tt<51||!/native code/.test(t)){var r=new Pn((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[Ln]=n,!(Rn=r.then((function(){}))instanceof n))return!0}return!e&&(Mn||_n)&&!Cn})),REJECTION_EVENT:Cn,SUBCLASSING:Rn},Dn=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw TypeError("Bad Promise constructor");e=t,r=n})),this.resolve=It(e),this.reject=It(r)},Fn={f:function(t){return new Dn(t)}},Wn=hn.set,zn=Nn.CONSTRUCTOR,Bn=Nn.REJECTION_EVENT,Un=Nn.SUBCLASSING,Gn=se.getterFor("Promise"),Vn=se.set,qn=Pn&&Pn.prototype,Hn=Pn,Zn=qn,Yn=O.TypeError,$n=O.document,Kn=O.process,Qn=Fn.f,Xn=Qn,Jn=!!($n&&$n.createEvent&&O.dispatchEvent),to=function(t){var e;return!(!lt(t)||!H(e=t.then))&&e},eo=function(t,e){var r,n,o,i=e.value,a=1==e.state,u=a?t.ok:t.fail,s=t.resolve,c=t.reject,f=t.domain;try{u?(a||(2===e.rejection&&ao(e),e.rejection=1),!0===u?r=i:(f&&f.enter(),r=u(i),f&&(f.exit(),o=!0)),r===t.promise?c(Yn("Promise-chain cycle")):(n=to(r))?wt(n,r,s,c):s(r)):c(i)}catch(t){f&&!o&&f.exit(),c(t)}},ro=function(t,e){t.notified||(t.notified=!0,An((function(){for(var r,n=t.reactions;r=n.get();)eo(r,t);t.notified=!1,e&&!t.rejection&&oo(t)})))},no=function(t,e,r){var n,o;Jn?((n=$n.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),O.dispatchEvent(n)):n={promise:e,reason:r},!Bn&&(o=O["on"+t])?o(n):"unhandledrejection"===t&&function(t,e){var r=O.console;r&&r.error&&(1==arguments.length?r.error(t):r.error(t,e))}("Unhandled promise rejection",r)},oo=function(t){wt(Wn,O,(function(){var e,r=t.facade,n=t.value;if(io(t)&&(e=On((function(){ir?Kn.emit("unhandledRejection",n,r):no("unhandledrejection",r,n)})),t.rejection=ir||io(t)?2:1,e.error))throw e.value}))},io=function(t){return 1!==t.rejection&&!t.parent},ao=function(t){wt(Wn,O,(function(){var e=t.facade;ir?Kn.emit("rejectionHandled",e):no("rejectionhandled",e,t.value)}))},uo=function(t,e,r){return function(n){t(e,n,r)}},so=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,ro(t,!0))},co=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw Yn("Promise can't be resolved itself");var n=to(e);n?An((function(){var r={done:!1};try{wt(n,e,uo(co,r,t),uo(so,r,t))}catch(e){so(r,e,t)}})):(t.value=e,t.state=1,ro(t,!1))}catch(e){so({done:!1},e,t)}}};if(zn&&(Zn=(Hn=function(t){dr(this,Zn),It(t),wt(Tn,this);var e=Gn(this);try{t(uo(co,e),uo(so,e))}catch(t){so(e,t)}}).prototype,(Tn=function(t){Vn(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new jn,rejection:!1,state:0,value:void 0})}).prototype=fe(Zn,"then",(function(t,e){var r=Gn(this),n=Qn(Mr(this,Hn));return r.parent=!0,n.ok=!H(t)||t,n.fail=H(e)&&e,n.domain=ir?Kn.domain:void 0,0==r.state?r.reactions.add(n):An((function(){eo(n,r)})),n.promise})),kn=function(){var t=new Tn,e=Gn(t);this.promise=t,this.resolve=uo(co,e),this.reject=uo(so,e)},Fn.f=Qn=function(t){return t===Hn||void 0===t?new kn(t):Xn(t)},H(Pn)&&qn!==Object.prototype)){In=qn.then,Un||fe(qn,"then",(function(t,e){var r=this;return new Hn((function(t,e){wt(In,r,t,e)})).then(t,e)}),{unsafe:!0});try{delete qn.constructor}catch(t){}sr&&sr(qn,Zn)}or({global:!0,constructor:!0,wrap:!0,forced:zn},{Promise:Hn}),lr(Hn,"Promise",!1),pr("Promise");var fo={},lo=ut("iterator"),ho=Array.prototype,po=function(t){return void 0!==t&&(fo.Array===t||ho[lo]===t)},vo=ut("iterator"),yo=function(t){if(null!=t)return jt(t,vo)||jt(t,"@@iterator")||fo[ge(t)]},go=TypeError,mo=function(t,e){var r=arguments.length<2?yo(t):e;if(It(r))return xt(wt(r,t));throw go(Tt(t)+" is not iterable")},xo=function(t,e,r){var n,o;xt(t);try{if(!(n=jt(t,"return"))){if("throw"===e)throw r;return r}n=wt(n,t)}catch(t){o=!0,n=t}if("throw"===e)throw r;if(o)throw n;return xt(n),r},bo=TypeError,wo=function(t,e){this.stopped=t,this.result=e},Eo=wo.prototype,Ao=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),d=Fr(e,f),y=function(t){return n&&xo(n,"normal",t),new wo(!0,t)},g=function(t){return l?(xt(t),v?d(t[0],t[1],y):d(t[0],t[1])):v?d(t,y):d(t)};if(h)n=t.iterator;else if(p)n=t;else{if(!(o=yo(t)))throw bo(Tt(t)+" is not iterable");if(po(o)){for(i=0,a=De(t);a>i;i++)if((u=g(t[i]))&&Et(Eo,u))return u;return new wo(!1)}n=mo(t,o)}for(s=h?t.next:n.next;!(c=wt(s,n)).done;){try{u=g(c.value)}catch(t){xo(n,"throw",t)}if("object"==typeof u&&u&&Et(Eo,u))return u}return new wo(!1)},Oo=ut("iterator"),So=!1;try{var To=0,ko={next:function(){return{done:!!To++}},return:function(){So=!0}};ko[Oo]=function(){return this},Array.from(ko,(function(){throw 2}))}catch(t){}var Io=function(t,e){if(!e&&!So)return!1;var r=!1;try{var n={};n[Oo]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},jo=Nn.CONSTRUCTOR||!Io((function(t){Pn.all(t).then(void 0,(function(){}))}));or({target:"Promise",stat:!0,forced:jo},{all:function(t){var e=this,r=Fn.f(e),n=r.resolve,o=r.reject,i=On((function(){var r=It(e.resolve),i=[],a=0,u=1;Ao(t,(function(t){var s=a++,c=!1;u++,wt(r,e,t).then((function(t){c||(c=!0,i[s]=t,--u||n(i))}),o)})),--u||n(i)}));return i.error&&o(i.value),r.promise}});var Po=Nn.CONSTRUCTOR,_o=Pn&&Pn.prototype;if(or({target:"Promise",proto:!0,forced:Po,real:!0},{catch:function(t){return this.then(void 0,t)}}),H(Pn)){var Mo=Y("Promise").prototype.catch;_o.catch!==Mo&&fe(_o,"catch",Mo,{unsafe:!0})}or({target:"Promise",stat:!0,forced:jo},{race:function(t){var e=this,r=Fn.f(e),n=r.reject,o=On((function(){var o=It(e.resolve);Ao(t,(function(t){wt(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}}),or({target:"Promise",stat:!0,forced:Nn.CONSTRUCTOR},{reject:function(t){var e=Fn.f(this);return wt(e.reject,void 0,t),e.promise}});var Lo=Nn.CONSTRUCTOR;Y("Promise");function Ro(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}or({target:"Promise",stat:!0,forced:Lo},{resolve:function(t){return function(t,e){if(xt(t),lt(e)&&e.constructor===t)return e;var r=Fn.f(t);return(0,r.resolve)(e),r.promise}(this,t)}});var Co="undefined"!=typeof window&&void 0!==window.orientation,No=function(){function t(t,e){var r=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){r.resolve=t,r.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){Ro(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){Ro(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),Do=new Map;function Fo(t){Ro(t.source&&!t.url||!t.source&&t.url);var e=Do.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return Wo((e=t,"try {\\n  importScripts('"+e+"');\\n} catch (error) {\\n  console.error(error);\\n  throw error;\\n}"));var e}(t.url),Do.set(t.url,e)),t.source&&(e=Wo(t.source),Do.set(t.source,e))),Ro(e),e}function Wo(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function zo(t,e,r){void 0===e&&(e=!0);var n=r||new Set;if(t){if(Bo(t))n.add(t);else if(Bo(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var o in t)zo(t[o],e,n)}else;return void 0===r?Array.from(n):[]}function Bo(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var Uo=function(){},Go=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,r=t.source,n=t.url;Ro(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=Uo,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=Uo,this.onError=Uo,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||zo(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=Fo({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e},t}(),Vo=self&&self.__assign||function(){return(Vo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},qo=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},Ho=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Zo=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=Vo(Vo({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,r){return void 0===e&&(e=function(t,e,r){return t.done(r)}),void 0===r&&(r=function(t,e){return t.error(e)}),qo(this,void 0,void 0,(function(){var n,o=this;return Ho(this,(function(i){switch(i.label){case 0:return n=new Promise((function(n){return o.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),o})),this.startQueuedJob(),[4,n];case 1:return[2,i.sent()]}}))}))},t.prototype.startQueuedJob=function(){return qo(this,void 0,void 0,(function(){var t,e,r;return Ho(this,(function(n){switch(n.label){case 0:if(!this.jobQueue.length)return[2];if(!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),r=new No(e.name,t),t.onMessage=function(t){return e.onMessage(r,t.type,t.payload)},t.onError=function(t){return e.onError(r,t)},e.onStart(r),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,r.result];case 2:return n.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Go({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return Co?this.maxMobileConcurrency:this.maxConcurrency},t}(),Yo=self&&self.__assign||function(){return(Yo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},$o=self&&self.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ko={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},Qo=(function(){function t(t){this.workerPools=new Map,this.props=Yo({},Ko),this.setProps(t),this.workerPools=new Map}t.isSupported=function(){return Go.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var r=$o(this.workerPools.values()),n=r.next();!n.done;n=r.next()){n.value.destroy()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,r;this.props=Yo(Yo({},this.props),t);try{for(var n=$o(this.workerPools.values()),o=n.next();!o.done;o=n.next()){o.value.setProps(this.getWorkerPoolProps())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,r=t.source,n=t.url,o=this.workerPools.get(e);return o||((o=new Zo({name:e,source:r,url:n})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,o)),o},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),Xo=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(Jo(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=Qo.get(t);e||(e=function(e){if(Jo(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=Qo.get(t);Qo.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var r={source:"Worker thread",type:t,payload:e},n=zo(e);self.postMessage(r,n)}},t}();function Jo(t){var e=t.type,r=t.data;return"message"===e&&r&&"string"==typeof r.source&&"Main thread"===r.source}self&&self.__awaiter,self&&self.__generator;var ti,ei,ri=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,r){t._settlers.push({resolve:e,reject:r})}))},t}(),ni=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},oi=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ii=self&&self.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,o){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,o,(e=t[r](e)).done,e.value)}))}}},ai=0;function ui(t,e){var r=this;if("undefined"!=typeof self){var n={process:si};Xo.onmessage=function(o,i){return ni(r,void 0,void 0,(function(){var r,a,u,s,c,f,l,h,p,v;return oi(this,(function(d){switch(d.label){case 0:switch(d.trys.push([0,19,,20]),o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(i.input,i.options||{},n)];case 2:return r=d.sent(),Xo.postMessage("done",{result:r}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");ti=new ri,ei=i.options||{},a=e(ti,ei,n),d.label=4;case 4:d.trys.push([4,9,10,15]),u=ii(a),d.label=5;case 5:return[4,u.next()];case 6:if((s=d.sent()).done)return[3,8];c=s.value,Xo.postMessage("output-batch",{result:c}),d.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return f=d.sent(),p={error:f},[3,15];case 10:return d.trys.push([10,,13,14]),s&&!s.done&&(v=u.return)?[4,v.call(u)]:[3,12];case 11:d.sent(),d.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return Xo.postMessage("done",{}),[3,18];case 16:return ti.push(i.input),[3,18];case 17:return ti.close(),[3,18];case 18:return[3,20];case 19:return l=d.sent(),h=l instanceof Error?l.message:"",Xo.postMessage("error",{error:h}),[3,20];case 20:return[2]}}))}))}}}function si(t,e){return void 0===e&&(e={}),new Promise((function(r,n){var o=ai++,i=function(t,e){if(e.id===o)switch(t){case"done":Xo.removeEventListener(i),r(e.result);break;case"error":Xo.removeEventListener(i),n(e.error)}};Xo.addEventListener(i);var a={id:o,input:t,options:e};Xo.postMessage("process",a)}))}self&&self.__awaiter,self&&self.__generator;var ci={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},fi=vt("span").classList,li=fi&&fi.constructor&&fi.constructor.prototype,hi=li===Object.prototype?void 0:li,pi=Array.isArray||function(t){return"Array"==pe(t)},vi=ut("species"),di=Array,yi=function(t,e){return new(function(t){var e;return pi(t)&&(e=t.constructor,(Ir(e)&&(e===di||pi(e.prototype))||lt(e)&&null===(e=e[vi]))&&(e=void 0)),void 0===e?di:e}(t))(0===e?0:e)},gi=C([].push),mi=function(t){var e=1==t,r=2==t,n=3==t,o=4==t,i=6==t,a=7==t,u=5==t||i;return function(s,c,f,l){for(var h,p,v=W(s),d=Oe(v),y=Fr(c,f),g=De(d),m=0,x=l||yi,b=e?x(s,g):r||a?x(s,0):void 0;g>m;m++)if((u||m in d)&&(p=y(h=d[m],m,v),t))if(e)b[m]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return m;case 2:gi(b,h)}else switch(t){case 4:return!1;case 7:gi(b,h)}return i?-1:n||o?o:b}},xi={forEach:mi(0),map:mi(1),filter:mi(2),some:mi(3),every:mi(4),find:mi(5),findIndex:mi(6),filterReject:mi(7)},bi=function(t,e){var r=[][t];return!!r&&j((function(){r.call(null,e||function(){return 1},1)}))},wi=xi.forEach,Ei=bi("forEach")?[].forEach:function(t){return wi(this,t,arguments.length>1?arguments[1]:void 0)},Ai=function(t){if(t&&t.forEach!==Ei)try{Qt(t,"forEach",Ei)}catch(e){t.forEach=Ei}};for(var Oi in ci)ci[Oi]&&Ai(O[Oi]&&O[Oi].prototype);Ai(hi);var Si=function(t,e,r){var n=Rt(e);n in t?Ft.f(t,n,Kt(0,r)):t[n]=r},Ti=ut("species"),ki=function(t){return tt>=51||!j((function(){var e=[];return(e.constructor={})[Ti]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},Ii=ki("slice"),ji=ut("species"),Pi=Array,_i=Math.max;or({target:"Array",proto:!0,forced:!Ii},{slice:function(t,e){var r,n,o,i=Se(this),a=De(i),u=Re(t,a),s=Re(void 0===e?a:e,a);if(pi(i)&&(r=i.constructor,(Ir(r)&&(r===Pi||pi(r.prototype))||lt(r)&&null===(r=r[ji]))&&(r=void 0),r===Pi||void 0===r))return zr(i,u,s);for(n=new(void 0===r?Pi:r)(_i(s-u,0)),o=0;u<s;u++,o++)u in i&&Si(n,o,i[u]);return n.length=o,n}});var Mi=Ut.EXISTS,Li=Ft.f,Ri=Function.prototype,Ci=C(Ri.toString),Ni=/function\\b(?:\\s|\\/\\*[\\S\\s]*?\\*\\/|\\/\\/[^\\n\\r]*[\\n\\r]+)*([^\\s(/]*)/,Di=C(Ni.exec);ft&&!Mi&&Li(Ri,"name",{configurable:!0,get:function(){try{return Di(Ni,Ci(this))[1]}catch(t){return""}}});var Fi=xi.map,Wi=ki("map");or({target:"Array",proto:!0,forced:!Wi},{map:function(t){return Fi(this,t,arguments.length>1?arguments[1]:void 0)}});var zi,Bi=Object.keys||function(t){return Ue(t,Ge)},Ui={f:ft&&!yt?Object.defineProperties:function(t,e){xt(t);for(var r,n=Se(e),o=Bi(e),i=o.length,a=0;i>a;)Ft.f(t,r=o[a++],n[r]);return t}},Gi=Jt("IE_PROTO"),Vi=function(){},qi=function(t){return"<script>"+t+"<\\/script>"},Hi=function(t){t.write(qi("")),t.close();var e=t.parentWindow.Object;return t=null,e},Zi=function(){try{zi=new ActiveXObject("htmlfile")}catch(t){}var t,e;Zi="undefined"!=typeof document?document.domain&&zi?Hi(zi):((e=vt("iframe")).style.display="none",Wr.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(qi("document.F=Object")),t.close(),t.F):Hi(zi);for(var r=Ge.length;r--;)delete Zi.prototype[Ge[r]];return Zi()};te[Gi]=!0;var Yi=Object.create||function(t,e){var r;return null!==t?(Vi.prototype=xt(t),r=new Vi,Vi.prototype=null,r[Gi]=t):r=Zi(),void 0===e?r:Ui.f(r,e)},$i=Ft.f,Ki=ut("unscopables"),Qi=Array.prototype;null==Qi[Ki]&&$i(Qi,Ki,{configurable:!0,value:Yi(null)});var Xi,Ji,ta,ea=function(t){Qi[Ki][t]=!0},ra=!j((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),na=Jt("IE_PROTO"),oa=Object,ia=oa.prototype,aa=ra?oa.getPrototypeOf:function(t){var e=W(t);if(B(e,na))return e[na];var r=e.constructor;return H(r)&&e instanceof r?r.prototype:e instanceof oa?ia:null},ua=ut("iterator"),sa=!1;[].keys&&("next"in(ta=[].keys())?(Ji=aa(aa(ta)))!==Object.prototype&&(Xi=Ji):sa=!0),(null==Xi||j((function(){var t={};return Xi[ua].call(t)!==t})))&&(Xi={}),H(Xi[ua])||fe(Xi,ua,(function(){return this}));var ca={IteratorPrototype:Xi,BUGGY_SAFARI_ITERATORS:sa},fa=ca.IteratorPrototype,la=function(){return this},ha=Ut.PROPER,pa=Ut.CONFIGURABLE,va=ca.IteratorPrototype,da=ca.BUGGY_SAFARI_ITERATORS,ya=ut("iterator"),ga=function(){return this},ma=function(t,e,r,n,o,i,a){!function(t,e,r,n){var o=e+" Iterator";t.prototype=Yi(fa,{next:Kt(+!n,r)}),lr(t,o,!1),fo[o]=la}(r,e,n);var u,s,c,f=function(t){if(t===o&&d)return d;if(!da&&t in p)return p[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},l=e+" Iterator",h=!1,p=t.prototype,v=p[ya]||p["@@iterator"]||o&&p[o],d=!da&&v||f(o),y="Array"==e&&p.entries||v;if(y&&(u=aa(y.call(new t)))!==Object.prototype&&u.next&&(aa(u)!==va&&(sr?sr(u,va):H(u[ya])||fe(u,ya,ga)),lr(u,l,!0)),ha&&"values"==o&&v&&"values"!==v.name&&(pa?Qt(p,"name","values"):(h=!0,d=function(){return wt(v,this)})),o)if(s={values:f("values"),keys:i?d:f("keys"),entries:f("entries")},a)for(c in s)(da||h||!(c in p))&&fe(p,c,s[c]);else or({target:e,proto:!0,forced:da||h},s);return p[ya]!==d&&fe(p,ya,d,{name:o}),fo[e]=d,s},xa=Ft.f,ba=se.set,wa=se.getterFor("Array Iterator"),Ea=ma(Array,"Array",(function(t,e){ba(this,{type:"Array Iterator",target:Se(t),index:0,kind:e})}),(function(){var t=wa(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:e[n],done:!1}:{value:[n,e[n]],done:!1}}),"values"),Aa=fo.Arguments=fo.Array;if(ea("keys"),ea("values"),ea("entries"),ft&&"values"!==Aa.name)try{xa(Aa,"name",{value:"values"})}catch(t){}var Oa,Sa,Ta,ka="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Ia=Ft.f,ja=se.enforce,Pa=se.get,_a=O.Int8Array,Ma=_a&&_a.prototype,La=O.Uint8ClampedArray,Ra=La&&La.prototype,Ca=_a&&aa(_a),Na=Ma&&aa(Ma),Da=Object.prototype,Fa=O.TypeError,Wa=ut("toStringTag"),za=q("TYPED_ARRAY_TAG"),Ba=ka&&!!sr&&"Opera"!==ge(O.opera),Ua=!1,Ga={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Va={BigInt64Array:8,BigUint64Array:8},qa=function(t){var e=aa(t);if(lt(e)){var r=Pa(e);return r&&B(r,"TypedArrayConstructor")?r.TypedArrayConstructor:qa(e)}},Ha=function(t){if(!lt(t))return!1;var e=ge(t);return B(Ga,e)||B(Va,e)};for(Oa in Ga)(Ta=(Sa=O[Oa])&&Sa.prototype)?ja(Ta).TypedArrayConstructor=Sa:Ba=!1;for(Oa in Va)(Ta=(Sa=O[Oa])&&Sa.prototype)&&(ja(Ta).TypedArrayConstructor=Sa);if((!Ba||!H(Ca)||Ca===Function.prototype)&&(Ca=function(){throw Fa("Incorrect invocation")},Ba))for(Oa in Ga)O[Oa]&&sr(O[Oa],Ca);if((!Ba||!Na||Na===Da)&&(Na=Ca.prototype,Ba))for(Oa in Ga)O[Oa]&&sr(O[Oa].prototype,Na);if(Ba&&aa(Ra)!==Na&&sr(Ra,Na),ft&&!B(Na,Wa))for(Oa in Ua=!0,Ia(Na,Wa,{get:function(){return lt(this)?this[za]:void 0}}),Ga)O[Oa]&&Qt(O[Oa],za,Oa);var Za={NATIVE_ARRAY_BUFFER_VIEWS:Ba,TYPED_ARRAY_TAG:Ua&&za,aTypedArray:function(t){if(Ha(t))return t;throw Fa("Target is not a typed array")},aTypedArrayConstructor:function(t){if(H(t)&&(!sr||Et(Ca,t)))return t;throw Fa(Tt(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(ft){if(r)for(var o in Ga){var i=O[o];if(i&&B(i.prototype,t))try{delete i.prototype[t]}catch(r){try{i.prototype[t]=e}catch(t){}}}Na[t]&&!r||fe(Na,t,r?e:Ba&&Ma[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(ft){if(sr){if(r)for(n in Ga)if((o=O[n])&&B(o,t))try{delete o[t]}catch(t){}if(Ca[t]&&!r)return;try{return fe(Ca,t,r?e:Ba&&Ca[t]||e)}catch(t){}}for(n in Ga)!(o=O[n])||o[t]&&!r||fe(o,t,e)}},getTypedArrayConstructor:qa,isView:function(t){if(!lt(t))return!1;var e=ge(t);return"DataView"===e||B(Ga,e)||B(Va,e)},isTypedArray:Ha,TypedArray:Ca,TypedArrayPrototype:Na},Ya=Za.NATIVE_ARRAY_BUFFER_VIEWS,$a=O.ArrayBuffer,Ka=O.Int8Array,Qa=!Ya||!j((function(){Ka(1)}))||!j((function(){new Ka(-1)}))||!Io((function(t){new Ka,new Ka(null),new Ka(1.5),new Ka(t)}),!0)||j((function(){return 1!==new Ka(new $a(2),1,void 0).length})),Xa=function(t,e,r){for(var n in e)fe(t,n,e[n],r);return t},Ja=RangeError,tu=function(t){if(void 0===t)return 0;var e=_e(t),r=Ne(e);if(e!==r)throw Ja("Wrong length or index");return r},eu=Array,ru=Math.abs,nu=Math.pow,ou=Math.floor,iu=Math.log,au=Math.LN2,uu=function(t,e,r){var n,o,i,a=eu(r),u=8*r-e-1,s=(1<<u)-1,c=s>>1,f=23===e?nu(2,-24)-nu(2,-77):0,l=t<0||0===t&&1/t<0?1:0,h=0;for((t=ru(t))!=t||t===1/0?(o=t!=t?1:0,n=s):(n=ou(iu(t)/au),t*(i=nu(2,-n))<1&&(n--,i*=2),(t+=n+c>=1?f/i:f*nu(2,1-c))*i>=2&&(n++,i/=2),n+c>=s?(o=0,n=s):n+c>=1?(o=(t*i-1)*nu(2,e),n+=c):(o=t*nu(2,c-1)*nu(2,e),n=0));e>=8;)a[h++]=255&o,o/=256,e-=8;for(n=n<<e|o,u+=e;u>0;)a[h++]=255&n,n/=256,u-=8;return a[--h]|=128*l,a},su=function(t,e){var r,n=t.length,o=8*n-e-1,i=(1<<o)-1,a=i>>1,u=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;u>0;)f=256*f+t[s--],u-=8;for(r=f&(1<<-u)-1,f>>=-u,u+=e;u>0;)r=256*r+t[s--],u-=8;if(0===f)f=1-a;else{if(f===i)return r?NaN:c?-1/0:1/0;r+=nu(2,e),f-=a}return(c?-1:1)*r*nu(2,f-e)},cu=function(t){for(var e=W(this),r=De(e),n=arguments.length,o=Re(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,a=void 0===i?r:Re(i,r);a>o;)e[o++]=t;return e},fu=Array,lu=Math.max,hu=function(t,e,r){for(var n=De(t),o=Re(e,n),i=Re(void 0===r?n:r,n),a=fu(lu(i-o,0)),u=0;o<i;o++,u++)Si(a,u,t[o]);return a.length=u,a},pu=qe.f,vu=Ft.f,du=Ut.PROPER,yu=Ut.CONFIGURABLE,gu=se.get,mu=se.set,xu=O.ArrayBuffer,bu=xu,wu=bu&&bu.prototype,Eu=O.DataView,Au=Eu&&Eu.prototype,Ou=Object.prototype,Su=O.Array,Tu=O.RangeError,ku=C(cu),Iu=C([].reverse),ju=uu,Pu=su,_u=function(t){return[255&t]},Mu=function(t){return[255&t,t>>8&255]},Lu=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Ru=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Cu=function(t){return ju(t,23,4)},Nu=function(t){return ju(t,52,8)},Du=function(t,e){vu(t.prototype,e,{get:function(){return gu(this)[e]}})},Fu=function(t,e,r,n){var o=tu(r),i=gu(t);if(o+e>i.byteLength)throw Tu("Wrong index");var a=gu(i.buffer).bytes,u=o+i.byteOffset,s=hu(a,u,u+e);return n?s:Iu(s)},Wu=function(t,e,r,n,o,i){var a=tu(r),u=gu(t);if(a+e>u.byteLength)throw Tu("Wrong index");for(var s=gu(u.buffer).bytes,c=a+u.byteOffset,f=n(+o),l=0;l<e;l++)s[c+l]=f[i?l:e-l-1]};if(ka){var zu=du&&"ArrayBuffer"!==xu.name;if(j((function(){xu(1)}))&&j((function(){new xu(-1)}))&&!j((function(){return new xu,new xu(1.5),new xu(NaN),zu&&!yu})))zu&&yu&&Qt(xu,"name","ArrayBuffer");else{(bu=function(t){return dr(this,wu),new xu(tu(t))}).prototype=wu;for(var Bu,Uu=pu(xu),Gu=0;Uu.length>Gu;)(Bu=Uu[Gu++])in bu||Qt(bu,Bu,xu[Bu]);wu.constructor=bu}sr&&aa(Au)!==Ou&&sr(Au,Ou);var Vu=new Eu(new bu(2)),qu=C(Au.setInt8);Vu.setInt8(0,2147483648),Vu.setInt8(1,2147483649),!Vu.getInt8(0)&&Vu.getInt8(1)||Xa(Au,{setInt8:function(t,e){qu(this,t,e<<24>>24)},setUint8:function(t,e){qu(this,t,e<<24>>24)}},{unsafe:!0})}else wu=(bu=function(t){dr(this,wu);var e=tu(t);mu(this,{bytes:ku(Su(e),0),byteLength:e}),ft||(this.byteLength=e)}).prototype,Au=(Eu=function(t,e,r){dr(this,Au),dr(t,wu);var n=gu(t).byteLength,o=_e(e);if(o<0||o>n)throw Tu("Wrong offset");if(o+(r=void 0===r?n-o:Ne(r))>n)throw Tu("Wrong length");mu(this,{buffer:t,byteLength:r,byteOffset:o}),ft||(this.buffer=t,this.byteLength=r,this.byteOffset=o)}).prototype,ft&&(Du(bu,"byteLength"),Du(Eu,"buffer"),Du(Eu,"byteLength"),Du(Eu,"byteOffset")),Xa(Au,{getInt8:function(t){return Fu(this,1,t)[0]<<24>>24},getUint8:function(t){return Fu(this,1,t)[0]},getInt16:function(t){var e=Fu(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Fu(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Ru(Fu(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return Ru(Fu(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return Pu(Fu(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return Pu(Fu(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){Wu(this,1,t,_u,e)},setUint8:function(t,e){Wu(this,1,t,_u,e)},setInt16:function(t,e){Wu(this,2,t,Mu,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){Wu(this,2,t,Mu,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){Wu(this,4,t,Lu,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){Wu(this,4,t,Lu,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){Wu(this,4,t,Cu,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){Wu(this,8,t,Nu,e,arguments.length>2?arguments[2]:void 0)}});lr(bu,"ArrayBuffer"),lr(Eu,"DataView");var Hu={ArrayBuffer:bu,DataView:Eu},Zu=Math.floor,Yu=Number.isInteger||function(t){return!lt(t)&&isFinite(t)&&Zu(t)===t},$u=RangeError,Ku=RangeError,Qu=function(t,e){var r=function(t){var e=_e(t);if(e<0)throw $u("The argument can't be less than 0");return e}(t);if(r%e)throw Ku("Wrong offset");return r},Xu=Za.aTypedArrayConstructor,Ju=function(t){var e,r,n,o,i,a,u=Pr(this),s=W(t),c=arguments.length,f=c>1?arguments[1]:void 0,l=void 0!==f,h=yo(s);if(h&&!po(h))for(a=(i=mo(s,h)).next,s=[];!(o=wt(a,i)).done;)s.push(o.value);for(l&&c>2&&(f=Fr(f,arguments[2])),r=De(s),n=new(Xu(u))(r),e=0;r>e;e++)n[e]=l?f(s[e],e):s[e];return n},ts=function(t,e,r){var n,o;return sr&&H(n=e.constructor)&&n!==r&&lt(o=n.prototype)&&o!==r.prototype&&sr(t,o),t},es=b((function(t){var e=qe.f,r=xi.forEach,n=se.get,o=se.set,i=se.enforce,a=Ft.f,u=ke.f,s=Math.round,c=O.RangeError,f=Hu.ArrayBuffer,l=f.prototype,h=Hu.DataView,p=Za.NATIVE_ARRAY_BUFFER_VIEWS,v=Za.TYPED_ARRAY_TAG,d=Za.TypedArray,y=Za.TypedArrayPrototype,g=Za.aTypedArrayConstructor,m=Za.isTypedArray,x=function(t,e){g(t);for(var r=0,n=e.length,o=new t(n);n>r;)o[r]=e[r++];return o},b=function(t,e){a(t,e,{get:function(){return n(this)[e]}})},w=function(t){var e;return Et(l,t)||"ArrayBuffer"==(e=ge(t))||"SharedArrayBuffer"==e},E=function(t,e){return m(t)&&!Ot(e)&&e in t&&Yu(+e)&&e>=0},A=function(t,e){return e=Rt(e),E(t,e)?Kt(2,t[e]):u(t,e)},S=function(t,e,r){return e=Rt(e),!(E(t,e)&&lt(r)&&B(r,"value"))||B(r,"get")||B(r,"set")||r.configurable||B(r,"writable")&&!r.writable||B(r,"enumerable")&&!r.enumerable?a(t,e,r):(t[e]=r.value,t)};ft?(p||(ke.f=A,Ft.f=S,b(y,"buffer"),b(y,"byteOffset"),b(y,"byteLength"),b(y,"length")),or({target:"Object",stat:!0,forced:!p},{getOwnPropertyDescriptor:A,defineProperty:S}),t.exports=function(t,u,l){var g=t.match(/\\d+$/)[0]/8,b=t+(l?"Clamped":"")+"Array",E="get"+t,A="set"+t,S=O[b],T=S,k=T&&T.prototype,I={},j=function(t,e){a(t,e,{get:function(){return function(t,e){var r=n(t);return r.view[E](e*g+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,r){var o=n(t);l&&(r=(r=s(r))<0?0:r>255?255:255&r),o.view[A](e*g+o.byteOffset,r,!0)}(this,e,t)},enumerable:!0})};p?Qa&&(T=u((function(t,e,r,n){return dr(t,k),ts(lt(e)?w(e)?void 0!==n?new S(e,Qu(r,g),n):void 0!==r?new S(e,Qu(r,g)):new S(e):m(e)?x(T,e):wt(Ju,T,e):new S(tu(e)),t,T)})),sr&&sr(T,d),r(e(S),(function(t){t in T||Qt(T,t,S[t])})),T.prototype=k):(T=u((function(t,e,r,n){dr(t,k);var i,a,u,s=0,l=0;if(lt(e)){if(!w(e))return m(e)?x(T,e):wt(Ju,T,e);i=e,l=Qu(r,g);var p=e.byteLength;if(void 0===n){if(p%g)throw c("Wrong length");if((a=p-l)<0)throw c("Wrong length")}else if((a=Ne(n)*g)+l>p)throw c("Wrong length");u=a/g}else u=tu(e),i=new f(a=u*g);for(o(t,{buffer:i,byteOffset:l,byteLength:a,length:u,view:new h(i)});s<u;)j(t,s++)})),sr&&sr(T,d),k=T.prototype=Yi(y)),k.constructor!==T&&Qt(k,"constructor",T),i(k).TypedArrayConstructor=T,v&&Qt(k,v,b);var P=T!=S;I[b]=T,or({global:!0,constructor:!0,forced:P,sham:!p},I),"BYTES_PER_ELEMENT"in T||Qt(T,"BYTES_PER_ELEMENT",g),"BYTES_PER_ELEMENT"in k||Qt(k,"BYTES_PER_ELEMENT",g),pr(b)}):t.exports=function(){}}));es("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}),!0);var rs=TypeError,ns=function(t,e){if(!delete t[e])throw rs("Cannot delete property "+Tt(e)+" of "+Tt(t))},os=Math.min,is=C([].copyWithin||function(t,e){var r=W(this),n=De(r),o=Re(t,n),i=Re(e,n),a=arguments.length>2?arguments[2]:void 0,u=os((void 0===a?n:Re(a,n))-i,n-o),s=1;for(i<o&&o<i+u&&(s=-1,i+=u-1,o+=u-1);u-- >0;)i in r?r[o]=r[i]:ns(r,o),o+=s,i+=s;return r}),as=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("copyWithin",(function(t,e){return is(as(this),t,e,arguments.length>2?arguments[2]:void 0)}));var us=xi.every,ss=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("every",(function(t){return us(ss(this),t,arguments.length>1?arguments[1]:void 0)}));var cs=TypeError,fs=function(t){var e=Lt(t,"number");if("number"==typeof e)throw cs("Can't convert number to bigint");return BigInt(e)},ls=Za.aTypedArray,hs=Za.exportTypedArrayMethod,ps=C("".slice);hs("fill",(function(t){var e=arguments.length;ls(this);var r="Big"===ps(ge(this),0,3)?fs(t):+t;return wt(cu,this,r,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),j((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})));var vs=Za.aTypedArrayConstructor,ds=Za.getTypedArrayConstructor,ys=function(t){return vs(Mr(t,ds(t)))},gs=function(t,e){return function(t,e){for(var r=0,n=De(e),o=new t(n);n>r;)o[r]=e[r++];return o}(ys(t),e)},ms=xi.filter,xs=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("filter",(function(t){var e=ms(xs(this),t,arguments.length>1?arguments[1]:void 0);return gs(this,e)}));var bs=xi.find,ws=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("find",(function(t){return bs(ws(this),t,arguments.length>1?arguments[1]:void 0)}));var Es=xi.findIndex,As=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("findIndex",(function(t){return Es(As(this),t,arguments.length>1?arguments[1]:void 0)}));var Os=xi.forEach,Ss=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("forEach",(function(t){Os(Ss(this),t,arguments.length>1?arguments[1]:void 0)}));var Ts=We.includes,ks=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("includes",(function(t){return Ts(ks(this),t,arguments.length>1?arguments[1]:void 0)}));var Is=We.indexOf,js=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("indexOf",(function(t){return Is(js(this),t,arguments.length>1?arguments[1]:void 0)}));var Ps=ut("iterator"),_s=O.Uint8Array,Ms=C(Ea.values),Ls=C(Ea.keys),Rs=C(Ea.entries),Cs=Za.aTypedArray,Ns=Za.exportTypedArrayMethod,Ds=_s&&_s.prototype,Fs=!j((function(){Ds[Ps].call([1])})),Ws=!!Ds&&Ds.values&&Ds[Ps]===Ds.values&&"values"===Ds.values.name,zs=function(){return Ms(Cs(this))};Ns("entries",(function(){return Rs(Cs(this))}),Fs),Ns("keys",(function(){return Ls(Cs(this))}),Fs),Ns("values",zs,Fs||!Ws,{name:"values"}),Ns(Ps,zs,Fs||!Ws,{name:"values"});var Bs=Za.aTypedArray,Us=Za.exportTypedArrayMethod,Gs=C([].join);Us("join",(function(t){return Gs(Bs(this),t)}));var Vs=Math.min,qs=[].lastIndexOf,Hs=!!qs&&1/[1].lastIndexOf(1,-0)<0,Zs=bi("lastIndexOf"),Ys=Hs||!Zs?function(t){if(Hs)return Nr(qs,this,arguments)||0;var e=Se(this),r=De(e),n=r-1;for(arguments.length>1&&(n=Vs(n,_e(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}:qs,$s=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return Nr(Ys,$s(this),e>1?[t,arguments[1]]:[t])}));var Ks=xi.map,Qs=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("map",(function(t){return Ks(Qs(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(ys(t))(e)}))}));var Xs=TypeError,Js=function(t){return function(e,r,n,o){It(r);var i=W(e),a=Oe(i),u=De(i),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw Xs("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},tc={left:Js(!1),right:Js(!0)},ec=tc.left,rc=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return ec(rc(this),t,e,e>1?arguments[1]:void 0)}));var nc=tc.right,oc=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return nc(oc(this),t,e,e>1?arguments[1]:void 0)}));var ic=Za.aTypedArray,ac=Za.exportTypedArrayMethod,uc=Math.floor;ac("reverse",(function(){for(var t,e=ic(this).length,r=uc(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this}));var sc=O.RangeError,cc=O.Int8Array,fc=cc&&cc.prototype,lc=fc&&fc.set,hc=Za.aTypedArray,pc=Za.exportTypedArrayMethod,vc=!j((function(){var t=new Uint8ClampedArray(2);return wt(lc,t,{length:1,0:3},1),3!==t[1]})),dc=vc&&Za.NATIVE_ARRAY_BUFFER_VIEWS&&j((function(){var t=new cc(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));pc("set",(function(t){hc(this);var e=Qu(arguments.length>1?arguments[1]:void 0,1),r=W(t);if(vc)return wt(lc,this,r,e);var n=this.length,o=De(r),i=0;if(o+e>n)throw sc("Wrong length");for(;i<o;)this[e+i]=r[i++]}),!vc||dc);var yc=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("slice",(function(t,e){for(var r=zr(yc(this),t,e),n=ys(this),o=0,i=r.length,a=new n(i);i>o;)a[o]=r[o++];return a}),j((function(){new Int8Array(1).slice()})));var gc=xi.some,mc=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("some",(function(t){return gc(mc(this),t,arguments.length>1?arguments[1]:void 0)}));var xc=Math.floor,bc=function(t,e){var r=t.length,n=xc(r/2);return r<8?wc(t,e):Ec(t,bc(hu(t,0,n),e),bc(hu(t,n),e),e)},wc=function(t,e){for(var r,n,o=t.length,i=1;i<o;){for(n=i,r=t[i];n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==i++&&(t[n]=r)}return t},Ec=function(t,e,r,n){for(var o=e.length,i=r.length,a=0,u=0;a<o||u<i;)t[a+u]=a<o&&u<i?n(e[a],r[u])<=0?e[a++]:r[u++]:a<o?e[a++]:r[u++];return t},Ac=bc,Oc=$.match(/firefox\\/(\\d+)/i),Sc=!!Oc&&+Oc[1],Tc=/MSIE|Trident/.test($),kc=$.match(/AppleWebKit\\/(\\d+)\\./),Ic=!!kc&&+kc[1],jc=Za.aTypedArray,Pc=Za.exportTypedArrayMethod,_c=O.Uint16Array,Mc=_c&&C(_c.prototype.sort),Lc=!(!Mc||j((function(){Mc(new _c(2),null)}))&&j((function(){Mc(new _c(2),{})}))),Rc=!!Mc&&!j((function(){if(tt)return tt<74;if(Sc)return Sc<67;if(Tc)return!0;if(Ic)return Ic<602;var t,e,r=new _c(516),n=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,n[t]=t-2*e+3;for(Mc(r,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==n[t])return!0}));Pc("sort",(function(t){return void 0!==t&&It(t),Rc?Mc(this,t):Ac(jc(this),function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t))}),!Rc||Lc);var Cc=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("subarray",(function(t,e){var r=Cc(this),n=r.length,o=Re(t,n);return new(ys(r))(r.buffer,r.byteOffset+o*r.BYTES_PER_ELEMENT,Ne((void 0===e?n:Re(e,n))-o))}));var Nc=O.Int8Array,Dc=Za.aTypedArray,Fc=Za.exportTypedArrayMethod,Wc=[].toLocaleString,zc=!!Nc&&j((function(){Wc.call(new Nc(1))}));Fc("toLocaleString",(function(){return Nr(Wc,zc?zr(Dc(this)):Dc(this),zr(arguments))}),j((function(){return[1,2].toLocaleString()!=new Nc([1,2]).toLocaleString()}))||!j((function(){Nc.prototype.toLocaleString.call([1,2])})));var Bc=Za.exportTypedArrayMethod,Uc=O.Uint8Array,Gc=Uc&&Uc.prototype||{},Vc=[].toString,qc=C([].join);j((function(){Vc.call({})}))&&(Vc=function(){return qc(this)});var Hc=Gc.toString!=Vc;Bc("toString",Vc,Hc);var Zc,Yc,$c=String,Kc=function(t){if("Symbol"===ge(t))throw TypeError("Cannot convert a Symbol value to a string");return $c(t)},Qc=function(){var t=xt(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},Xc=O.RegExp,Jc=j((function(){var t=Xc("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),tf=Jc||j((function(){return!Xc("a","y").sticky})),ef={BROKEN_CARET:Jc||j((function(){var t=Xc("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:tf,UNSUPPORTED_Y:Jc},rf=O.RegExp,nf=j((function(){var t=rf(".","s");return!(t.dotAll&&t.exec("\\n")&&"s"===t.flags)})),of=O.RegExp,af=j((function(){var t=of("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),uf=se.get,sf=I("native-string-replace",String.prototype.replace),cf=RegExp.prototype.exec,ff=cf,lf=C("".charAt),hf=C("".indexOf),pf=C("".replace),vf=C("".slice),df=(Yc=/b*/g,wt(cf,Zc=/a/,"a"),wt(cf,Yc,"a"),0!==Zc.lastIndex||0!==Yc.lastIndex),yf=ef.BROKEN_CARET,gf=void 0!==/()??/.exec("")[1];(df||gf||yf||nf||af)&&(ff=function(t){var e,r,n,o,i,a,u,s=this,c=uf(s),f=Kc(t),l=c.raw;if(l)return l.lastIndex=s.lastIndex,e=wt(ff,l,f),s.lastIndex=l.lastIndex,e;var h=c.groups,p=yf&&s.sticky,v=wt(Qc,s),d=s.source,y=0,g=f;if(p&&(v=pf(v,"y",""),-1===hf(v,"g")&&(v+="g"),g=vf(f,s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\\n"!==lf(f,s.lastIndex-1))&&(d="(?: "+d+")",g=" "+g,y++),r=new RegExp("^(?:"+d+")",v)),gf&&(r=new RegExp("^"+d+"$(?!\\\\s)",v)),df&&(n=s.lastIndex),o=wt(cf,p?r:s,g),p?o?(o.input=vf(o.input,y),o[0]=vf(o[0],y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:df&&o&&(s.lastIndex=s.global?o.index+o[0].length:n),gf&&o&&o.length>1&&wt(sf,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&h)for(o.groups=a=Yi(null),i=0;i<h.length;i++)a[(u=h[i])[0]]=o[u[1]];return o});var mf=ff;or({target:"RegExp",proto:!0,forced:/./.exec!==mf},{exec:mf});var xf,bf=ut("species"),wf=RegExp.prototype,Ef=function(t,e,r,n){var o=ut(t),i=!j((function(){var e={};return e[o]=function(){return 7},7!=""[t](e)})),a=i&&!j((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[bf]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return e=!0,null},r[o](""),!e}));if(!i||!a||r){var u=C(/./[o]),s=e(o,""[t],(function(t,e,r,n,o){var a=C(t),s=e.exec;return s===mf||s===wf.exec?i&&!o?{done:!0,value:u(e,r,n)}:{done:!0,value:a(r,e,n)}:{done:!1}}));fe(String.prototype,t,s[0]),fe(wf,o,s[1])}n&&Qt(wf[o],"sham",!0)},Af=C("".charAt),Of=C("".charCodeAt),Sf=C("".slice),Tf=function(t){return function(e,r){var n,o,i=Kc(D(e)),a=_e(r),u=i.length;return a<0||a>=u?t?"":void 0:(n=Of(i,a))<55296||n>56319||a+1===u||(o=Of(i,a+1))<56320||o>57343?t?Af(i,a):n:t?Sf(i,a,a+2):o-56320+(n-55296<<10)+65536}},kf={codeAt:Tf(!1),charAt:Tf(!0)},If=kf.charAt,jf=function(t,e,r){return e+(r?If(t,e).length:1)},Pf=Math.floor,_f=C("".charAt),Mf=C("".replace),Lf=C("".slice),Rf=/\\$([$&'\`]|\\d{1,2}|<[^>]*>)/g,Cf=/\\$([$&'\`]|\\d{1,2})/g,Nf=function(t,e,r,n,o,i){var a=r+t.length,u=n.length,s=Cf;return void 0!==o&&(o=W(o),s=Rf),Mf(i,s,(function(i,s){var c;switch(_f(s,0)){case"$":return"$";case"&":return t;case"\`":return Lf(e,0,r);case"'":return Lf(e,a);case"<":c=o[Lf(s,1,-1)];break;default:var f=+s;if(0===f)return i;if(f>u){var l=Pf(f/10);return 0===l?i:l<=u?void 0===n[l-1]?_f(s,1):n[l-1]+_f(s,1):i}c=n[f-1]}return void 0===c?"":c}))},Df=TypeError,Ff=function(t,e){var r=t.exec;if(H(r)){var n=wt(r,t,e);return null!==n&&xt(n),n}if("RegExp"===pe(t))return wt(mf,t,e);throw Df("RegExp#exec called on incompatible receiver")},Wf=ut("replace"),zf=Math.max,Bf=Math.min,Uf=C([].concat),Gf=C([].push),Vf=C("".indexOf),qf=C("".slice),Hf="$0"==="a".replace(/./,"$0"),Zf=!!/./[Wf]&&""===/./[Wf]("a","$0");function Yf(t){this.message=t}Ef("replace",(function(t,e,r){var n=Zf?"$":"$0";return[function(t,r){var n=D(this),o=null==t?void 0:jt(t,Wf);return o?wt(o,t,n,r):wt(e,Kc(n),t,r)},function(t,o){var i=xt(this),a=Kc(t);if("string"==typeof o&&-1===Vf(o,n)&&-1===Vf(o,"$<")){var u=r(e,i,a,o);if(u.done)return u.value}var s=H(o);s||(o=Kc(o));var c=i.global;if(c){var f=i.unicode;i.lastIndex=0}for(var l=[];;){var h=Ff(i,a);if(null===h)break;if(Gf(l,h),!c)break;""===Kc(h[0])&&(i.lastIndex=jf(a,Ne(i.lastIndex),f))}for(var p,v="",d=0,y=0;y<l.length;y++){for(var g=Kc((h=l[y])[0]),m=zf(Bf(_e(h.index),a.length),0),x=[],b=1;b<h.length;b++)Gf(x,void 0===(p=h[b])?p:String(p));var w=h.groups;if(s){var E=Uf([g],x,m,a);void 0!==w&&Gf(E,w);var A=Kc(Nr(o,void 0,E))}else A=Nf(g,a,m,x,w,o);m>=d&&(v+=qf(a,d,m)+A,d=m+g.length)}return v+qf(a,d)}]}),!!j((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!Hf||Zf),Yf.prototype=new Error,Yf.prototype.name="InvalidCharacterError",or({global:!0},{globalThis:O}),xf="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,r){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:xf.devicePixelRatio;var $f=TypeError,Kf=function(t){if(t>9007199254740991)throw $f("Maximum allowed index exceeded");return t},Qf=ki("splice"),Xf=Math.max,Jf=Math.min;or({target:"Array",proto:!0,forced:!Qf},{splice:function(t,e){var r,n,o,i,a,u,s=W(this),c=De(s),f=Re(t,c),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=c-f):(r=l-2,n=Jf(Xf(_e(e),0),c-f)),Kf(c+r-n),o=yi(s,n),i=0;i<n;i++)(a=f+i)in s&&Si(o,i,s[a]);if(o.length=n,r<n){for(i=f;i<c-n;i++)u=i+r,(a=i+n)in s?s[u]=s[a]:ns(s,u);for(i=c;i>c-n+r;i--)ns(s,i-1)}else if(r>n)for(i=c-n;i>f;i--)u=i+r-1,(a=i+n-1)in s?s[u]=s[a]:ns(s,u);for(i=0;i<r;i++)s[i+f]=arguments[i+2];return s.length=c-n+r,o}});var tl=u((function t(e,r){i(this,t),s(this,"cancelBubble",void 0),s(this,"cancelable",void 0),s(this,"target",void 0),s(this,"currentTarget",void 0),s(this,"preventDefault",void 0),s(this,"stopPropagation",void 0),s(this,"type",void 0),s(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),el=Object.assign,rl=Object.defineProperty,nl=C([].concat),ol=!el||j((function(){if(ft&&1!==el({b:1},el(rl({},"a",{enumerable:!0,get:function(){rl(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol();return t[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=el({},t)[r]||"abcdefghijklmnopqrst"!=Bi(el({},e)).join("")}))?function(t,e){for(var r=W(t),n=arguments.length,o=1,i=He.f,a=we.f;n>o;)for(var u,s=Oe(arguments[o++]),c=i?nl(Bi(s),i(s)):Bi(s),f=c.length,l=0;f>l;)u=c[l++],ft&&!wt(a,s,u)||(r[u]=s[u]);return r}:el;or({target:"Object",stat:!0,arity:2,forced:Object.assign!==ol},{assign:ol});var il=xi.findIndex,al=!0;"findIndex"in[]&&Array(1).findIndex((function(){al=!1})),or({target:"Array",proto:!0,forced:al},{findIndex:function(t){return il(this,t,arguments.length>1?arguments[1]:void 0)}}),ea("findIndex");var ul=kf.charAt,sl=se.set,cl=se.getterFor("String Iterator");ma(String,"String",(function(t){sl(this,{type:"String Iterator",string:Kc(t),index:0})}),(function(){var t,e=cl(this),r=e.string,n=e.index;return n>=r.length?{value:void 0,done:!0}:(t=ul(r,n),e.index+=t.length,{value:t,done:!1})}));var fl=qe.f,ll="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],hl={f:function(t){return ll&&"Window"==pe(t)?function(t){try{return fl(t)}catch(t){return hu(ll)}}(t):fl(Se(t))}},pl=j((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),vl=Object.isExtensible,dl=j((function(){vl(1)}))||pl?function(t){return!!lt(t)&&((!pl||"ArrayBuffer"!=pe(t))&&(!vl||vl(t)))}:vl,yl=!j((function(){return Object.isExtensible(Object.preventExtensions({}))})),gl=b((function(t){var e=Ft.f,r=!1,n=q("meta"),o=0,i=function(t){e(t,n,{value:{objectID:"O"+o++,weakData:{}}})},a=t.exports={enable:function(){a.enable=function(){},r=!0;var t=qe.f,e=C([].splice),o={};o[n]=1,t(o).length&&(qe.f=function(r){for(var o=t(r),i=0,a=o.length;i<a;i++)if(o[i]===n){e(o,i,1);break}return o},or({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:hl.f}))},fastKey:function(t,e){if(!lt(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!B(t,n)){if(!dl(t))return"F";if(!e)return"E";i(t)}return t[n].objectID},getWeakData:function(t,e){if(!B(t,n)){if(!dl(t))return!0;if(!e)return!1;i(t)}return t[n].weakData},onFreeze:function(t){return yl&&r&&dl(t)&&!B(t,n)&&i(t),t}};te[n]=!0})),ml=(gl.enable,gl.fastKey,gl.getWeakData,gl.onFreeze,function(t,e,r){var n=-1!==t.indexOf("Map"),o=-1!==t.indexOf("Weak"),i=n?"set":"add",a=O[t],u=a&&a.prototype,s=a,c={},f=function(t){var e=C(u[t]);fe(u,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!lt(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return o&&!lt(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!lt(t))&&e(this,0===t?0:t)}:function(t,r){return e(this,0===t?0:t,r),this})};if(rr(t,!H(a)||!(o||u.forEach&&!j((function(){(new a).entries().next()})))))s=r.getConstructor(e,t,n,i),gl.enable();else if(rr(t,!0)){var l=new s,h=l[i](o?{}:-0,1)!=l,p=j((function(){l.has(1)})),v=Io((function(t){new a(t)})),d=!o&&j((function(){for(var t=new a,e=5;e--;)t[i](e,e);return!t.has(-0)}));v||((s=e((function(t,e){dr(t,u);var r=ts(new a,t,s);return null!=e&&Ao(e,r[i],{that:r,AS_ENTRIES:n}),r}))).prototype=u,u.constructor=s),(p||d)&&(f("delete"),f("has"),n&&f("get")),(d||h)&&f(i),o&&u.clear&&delete u.clear}return c[t]=s,or({global:!0,constructor:!0,forced:s!=a},c),lr(s,t),o||r.setStrong(s,t,n),s}),xl=gl.getWeakData,bl=se.set,wl=se.getterFor,El=xi.find,Al=xi.findIndex,Ol=C([].splice),Sl=0,Tl=function(t){return t.frozen||(t.frozen=new kl)},kl=function(){this.entries=[]},Il=function(t,e){return El(t.entries,(function(t){return t[0]===e}))};kl.prototype={get:function(t){var e=Il(this,t);if(e)return e[1]},has:function(t){return!!Il(this,t)},set:function(t,e){var r=Il(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=Al(this.entries,(function(e){return e[0]===t}));return~e&&Ol(this.entries,e,1),!!~e}};var jl,Pl={getConstructor:function(t,e,r,n){var o=t((function(t,o){dr(t,i),bl(t,{type:e,id:Sl++,frozen:void 0}),null!=o&&Ao(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=wl(e),u=function(t,e,r){var n=a(t),o=xl(xt(e),!0);return!0===o?Tl(n).set(e,r):o[n.id]=r,t};return Xa(i,{delete:function(t){var e=a(this);if(!lt(t))return!1;var r=xl(t);return!0===r?Tl(e).delete(t):r&&B(r,e.id)&&delete r[e.id]},has:function(t){var e=a(this);if(!lt(t))return!1;var r=xl(t);return!0===r?Tl(e).has(t):r&&B(r,e.id)}}),Xa(i,r?{get:function(t){var e=a(this);if(lt(t)){var r=xl(t);return!0===r?Tl(e).get(t):r?r[e.id]:void 0}},set:function(t,e){return u(this,t,e)}}:{add:function(t){return u(this,t,!0)}}),o}},_l=se.enforce,Ml=!O.ActiveXObject&&"ActiveXObject"in O,Ll=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Rl=ml("WeakMap",Ll,Pl);if($t&&Ml){jl=Pl.getConstructor(Ll,"WeakMap",!0),gl.enable();var Cl=Rl.prototype,Nl=C(Cl.delete),Dl=C(Cl.has),Fl=C(Cl.get),Wl=C(Cl.set);Xa(Cl,{delete:function(t){if(lt(t)&&!dl(t)){var e=_l(this);return e.frozen||(e.frozen=new jl),Nl(this,t)||e.frozen.delete(t)}return Nl(this,t)},has:function(t){if(lt(t)&&!dl(t)){var e=_l(this);return e.frozen||(e.frozen=new jl),Dl(this,t)||e.frozen.has(t)}return Dl(this,t)},get:function(t){if(lt(t)&&!dl(t)){var e=_l(this);return e.frozen||(e.frozen=new jl),Dl(this,t)?Fl(this,t):e.frozen.get(t)}return Fl(this,t)},set:function(t,e){if(lt(t)&&!dl(t)){var r=_l(this);r.frozen||(r.frozen=new jl),Dl(this,t)?Wl(this,t,e):r.frozen.set(t,e)}else Wl(this,t,e);return this}})}var zl=ut("iterator"),Bl=ut("toStringTag"),Ul=Ea.values,Gl=function(t,e){if(t){if(t[zl]!==Ul)try{Qt(t,zl,Ul)}catch(e){t[zl]=Ul}if(t[Bl]||Qt(t,Bl,e),ci[e])for(var r in Ea)if(t[r]!==Ea[r])try{Qt(t,r,Ea[r])}catch(e){t[r]=Ea[r]}}};for(var Vl in ci)Gl(O[Vl]&&O[Vl].prototype,Vl);Gl(hi,"DOMTokenList");var ql,Hl,Zl,Yl,$l=new WeakMap,Kl=function(){function t(){i(this,t),$l.set(this,{})}return u(t,[{key:"addEventListener",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=$l.get(this);n||(n={}),n[t]||(n[t]=[]),n[t].push(e),$l.set(this,n),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,e){var r=$l.get(this);if(r){var n=r[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}}},{key:"dispatchEvent",value:function(t){var e=$l.get(this)[t.type];if(e){var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(e);try{for(n.s();!(r=n.n()).done;){(0,r.value)(t)}}catch(t){n.e(t)}finally{n.f()}}}}]),t}(),Ql=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),t.className="",t.children=[],t}return u(r,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"childNodes",void 0),t.childNodes=[],t}return u(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),r}(Kl));if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Xl=my.getSystemInfoSync();ql=Xl.screenWidth,Hl=Xl.screenHeight,Zl=Xl.windowWidth,Yl=Xl.windowHeight}else{var Jl=xf.innerWidth,th=xf.innerHeight;ql=Jl,Hl=th,Zl=Jl,Yl=th}var eh={width:ql,height:Hl,availWidth:Zl,availHeight:Yl,availLeft:0,availTop:0},rh=eh.availWidth,nh=eh.availHeight,oh={style:[]};function ih(t,e){var r,n;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return oh}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r}));"parentElement"in t||(n=0===e?function(){return null}:1===e?function(){return oh}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:n}))}function ah(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:rh+"px",height:nh+"px",margin:"0px",padding:"0px"})}function uh(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=rh,t.clientHeight=nh),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function sh(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=rh,t.offsetHeight=nh)}function ch(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=rh,t.scrollHeight=nh)}function fh(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function lh(){}var hh=function(t){c(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),s(h(t),"focus",void 0),s(h(t),"blur",void 0),s(h(t),"insertBefore",void 0),s(h(t),"appendChild",void 0),s(h(t),"removeChild",void 0),s(h(t),"remove",void 0),s(h(t),"innerHTML",void 0),s(h(t),"tagName",void 0),t.className="",t.children=[],t.focus=lh,t.blur=lh,t.insertBefore=lh,t.appendChild=lh,t.removeChild=lh,t.remove=lh,t.innerHTML="",t.tagName=n.toUpperCase(),ih(h(t),o),ah(h(t)),fh(h(t)),uh(h(t)),sh(h(t)),ch(h(t)),t}return u(r)}(Ql),ph=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"video")}return u(r)}(function(t){c(r,t);var e=v(r);function r(t){return i(this,r),e.call(this,t)}return u(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(hh)),vh={};function dh(){return vh}var yh=u((function t(){i(this,t);var e=dh(),r=e.createImage&&e.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=t.prototype),ih(r),fh(r),Object.assign(r,{addEventListener:function(t,e){r["on".concat(t)]=e.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r})),gh={href:"",protocol:"",host:""},mh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"body",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,r){}},{key:"dispatchEvent",value:function(t){}}]),r}(hh),xh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"html",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),r}(hh),bh={},wh={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:gh,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new yh:"video"===t?new ph:new hh(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,r){bh[t]||(bh[t]=[]),bh[t].push(e)},removeEventListener:function(t,e){var r=bh[t];if(r&&r.length>0)for(var n=r.length;n--;n>0)if(r[n]===e){r.splice(n,1);break}},dispatchEvent:function(t){var e=t.type,r=bh[e];if(r)for(var n=0;n<r.length;n++)r[n](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new tl(t)}};wh.documentElement=new xh,wh.head=new hh("head"),wh.body=new mh,Ef("match",(function(t,e,r){return[function(e){var r=D(this),n=null==e?void 0:jt(e,t);return n?wt(n,e,r):new RegExp(e)[t](Kc(r))},function(t){var n=xt(this),o=Kc(t),i=r(e,n,o);if(i.done)return i.value;if(!n.global)return Ff(n,o);var a=n.unicode;n.lastIndex=0;for(var u,s=[],c=0;null!==(u=Ff(n,o));){var f=Kc(u[0]);s[c]=f,""===f&&(n.lastIndex=jf(o,Ne(n.lastIndex),a)),c++}return 0===c?null:s}]}));var Eh,Ah,Oh=ut("isConcatSpreadable"),Sh=tt>=51||!j((function(){var t=[];return t[Oh]=!1,t.concat()[0]!==t})),Th=ki("concat"),kh=function(t){if(!lt(t))return!1;var e=t[Oh];return void 0!==e?!!e:pi(t)};if(or({target:"Array",proto:!0,arity:1,forced:!Sh||!Th},{concat:function(t){var e,r,n,o,i,a=W(this),u=yi(a,0),s=0;for(e=-1,n=arguments.length;e<n;e++)if(kh(i=-1===e?a:arguments[e]))for(o=De(i),Kf(s+o),r=0;r<o;r++,s++)r in i&&Si(u,s,i[r]);else Kf(s+1),Si(u,s++,i);return u.length=s,u}}),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Ih=my.getSystemInfoSync();Eh=Ih.system,Ih.platform,Ih.language}else{var jh={versions:(Ah=xf.navigator.userAgent,{trident:Ah.indexOf("Trident")>-1,presto:Ah.indexOf("Presto")>-1,webKit:Ah.indexOf("AppleWebKit")>-1,gecko:Ah.indexOf("Gecko")>-1&&-1===Ah.indexOf("KHTML"),mobile:!!Ah.match(/AppleWebKit.*Mobile.*/),ios:!!Ah.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Ah.indexOf("Android")>-1||Ah.indexOf("Linux")>-1,iPhone:Ah.indexOf("iPhone")>-1,iPad:Ah.indexOf("iPad")>-1,webApp:-1===Ah.indexOf("Safari"),weixin:Ah.indexOf("MicroMessenger")>-1,qq:" qq"===Ah.match(/\\sQQ/i)}),language:(xf.navigator.browserLanguage||xf.navigator.language).toLowerCase()};jh.versions.android?"android":jh.versions.trident?"IE":jh.versions.presto?"Opera":jh.versions.webKit?"webKit":jh.versions.gecko?"Firefox":jh.versions.mobile?"mobile":jh.versions.ios?"ios":jh.versions.iPhone?"iPhone":jh.versions.iPad?"ipad":jh.versions.webApp?"webApp":jh.versions.weixin?"weixin":jh.versions.qq&&"qq",Eh=xf.navigator.userAgent,jh.language}Eh.toLowerCase().indexOf("android");es("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}));var Ph=Ft.f,_h=gl.fastKey,Mh=se.set,Lh=se.getterFor;ml("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(t,e,r,n){var o=t((function(t,o){dr(t,i),Mh(t,{type:e,index:Yi(null),first:void 0,last:void 0,size:0}),ft||(t.size=0),null!=o&&Ao(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Lh(e),u=function(t,e,r){var n,o,i=a(t),u=s(t,e);return u?u.value=r:(i.last=u={index:o=_h(e,!0),key:e,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=u),n&&(n.next=u),ft?i.size++:t.size++,"F"!==o&&(i.index[o]=u)),t},s=function(t,e){var r,n=a(t),o=_h(e);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==e)return r};return Xa(i,{clear:function(){for(var t=a(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,ft?t.size=0:this.size=0},delete:function(t){var e=a(this),r=s(this,t);if(r){var n=r.next,o=r.previous;delete e.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),e.first==r&&(e.first=n),e.last==r&&(e.last=o),ft?e.size--:this.size--}return!!r},forEach:function(t){for(var e,r=a(this),n=Fr(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:r.first;)for(n(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!s(this,t)}}),Xa(i,r?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return u(this,0===t?0:t,e)}}:{add:function(t){return u(this,t=0===t?0:t,t)}}),ft&&Ph(i,"size",{get:function(){return a(this).size}}),o},setStrong:function(t,e,r){var n=e+" Iterator",o=Lh(e),i=Lh(n);ma(t,e,(function(t,e){Mh(this,{type:n,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=i(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?"keys"==e?{value:r.key,done:!1}:"values"==e?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),pr(e)}});var Rh=C([].join),Ch=Oe!=Object,Nh=bi("join",",");or({target:"Array",proto:!0,forced:Ch||!Nh},{join:function(t){return Rh(Se(this),void 0===t?",":t)}});var Dh=j((function(){Bi(1)}));or({target:"Object",stat:!0,forced:Dh},{keys:function(t){return Bi(W(t))}});var Fh=new Map,Wh=new Map,zh=new Map,Bh=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"onabort",void 0),s(h(t),"onerror",void 0),s(h(t),"onload",void 0),s(h(t),"onloadstart",void 0),s(h(t),"onprogress",void 0),s(h(t),"ontimeout",void 0),s(h(t),"onloadend",void 0),s(h(t),"onreadystatechange",void 0),s(h(t),"readyState",void 0),s(h(t),"response",void 0),s(h(t),"responseText",void 0),s(h(t),"_responseType",void 0),s(h(t),"responseXML",void 0),s(h(t),"status",void 0),s(h(t),"statusText",void 0),s(h(t),"upload",void 0),s(h(t),"withCredentials",void 0),s(h(t),"timeout",void 0),s(h(t),"_url",void 0),s(h(t),"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Fh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return u(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=zh.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Wh.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\\n")}},{key:"getResponseHeader",value:function(t){return Wh.get("responseHeader")[t]}},{key:"open",value:function(t,e,r){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var r=Fh.get("requestHeader");r[t]=e,Fh.set("requestHeader",r)}},{key:"addEventListener",value:function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||r,e.call(r,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),r}(Kl);s(Bh,"UNSEND",void 0),s(Bh,"OPENED",void 0),s(Bh,"HEADERS_RECEIVED",void 0),s(Bh,"LOADING",void 0),s(Bh,"DONE",void 0),Bh.UNSEND=0,Bh.OPENED=1,Bh.HEADERS_RECEIVED=2,Bh.LOADING=3,Bh.DONE=4;var Uh="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,Gh="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),Vh=Uh||Gh;Vh||xf.XMLHttpRequest,Vh||xf.location;function qh(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}var Hh=xi.filter,Zh=ki("filter");function Yh(t,e){var r=t.color;return r&&r.length?r:[1,1,1,1]}function $h(t,e,r){return 2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]]}function Kh(t,e){return t.filter?[1]:[0]}function Qh(t,e,r,n){return[e]}or({target:"Array",proto:!0,forced:!Zh},{filter:function(t){return Hh(this,t,arguments.length>1?arguments[1]:void 0)}});var Xh=tp,Jh=tp;function tp(t,e,r){r=r||2;var n,o,i,a,u,s,c,f=e&&e.length,l=f?e[0]*r:t.length,h=ep(t,0,l,r,!0),p=[];if(!h||h.next===h.prev)return p;if(f&&(h=function(t,e,r,n){var o,i,a,u,s,c=[];for(o=0,i=e.length;o<i;o++)a=e[o]*n,u=o<i-1?e[o+1]*n:t.length,(s=ep(t,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(hp(s));for(c.sort(sp),o=0;o<c.length;o++)r=cp(c[o],r);return r}(t,e,h,r)),t.length>80*r){n=i=t[0],o=a=t[1];for(var v=r;v<l;v+=r)(u=t[v])<n&&(n=u),(s=t[v+1])<o&&(o=s),u>i&&(i=u),s>a&&(a=s);c=0!==(c=Math.max(i-n,a-o))?32767/c:0}return np(h,p,r,n,o,c,0),p}function ep(t,e,r,n,o){var i,a;if(o===Sp(t,e,r,n)>0)for(i=e;i<r;i+=n)a=Ep(i,t[i],t[i+1],a);else for(i=r-n;i>=e;i-=n)a=Ep(i,t[i],t[i+1],a);return a&&yp(a,a.next)&&(Ap(a),a=a.next),a}function rp(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!yp(n,n.next)&&0!==dp(n.prev,n,n.next))n=n.next;else{if(Ap(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function np(t,e,r,n,o,i,a){if(t){!a&&i&&function(t,e,r,n){var o=t;do{0===o.z&&(o.z=lp(o.x,o.y,e,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,r,n,o,i,a,u,s,c=1;do{for(r=t,t=null,i=null,a=0;r;){for(a++,n=r,u=0,e=0;e<c&&(u++,n=n.nextZ);e++);for(s=c;u>0||s>0&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(o=r,r=r.nextZ,u--):(o=n,n=n.nextZ,s--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(t,n,o,i);for(var u,s,c=t;t.prev!==t.next;)if(u=t.prev,s=t.next,i?ip(t,n,o,i):op(t))e.push(u.i/r|0),e.push(t.i/r|0),e.push(s.i/r|0),Ap(t),t=s.next,c=s.next;else if((t=s)===c){a?1===a?np(t=ap(rp(t),e,r),e,r,n,o,i,2):2===a&&up(t,e,r,n,o,i):np(rp(t),e,r,n,o,i,1);break}}}function op(t){var e=t.prev,r=t,n=t.next;if(dp(e,r,n)>=0)return!1;for(var o=e.x,i=r.x,a=n.x,u=e.y,s=r.y,c=n.y,f=o<i?o<a?o:a:i<a?i:a,l=u<s?u<c?u:c:s<c?s:c,h=o>i?o>a?o:a:i>a?i:a,p=u>s?u>c?u:c:s>c?s:c,v=n.next;v!==e;){if(v.x>=f&&v.x<=h&&v.y>=l&&v.y<=p&&pp(o,u,i,s,a,c,v.x,v.y)&&dp(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function ip(t,e,r,n){var o=t.prev,i=t,a=t.next;if(dp(o,i,a)>=0)return!1;for(var u=o.x,s=i.x,c=a.x,f=o.y,l=i.y,h=a.y,p=u<s?u<c?u:c:s<c?s:c,v=f<l?f<h?f:h:l<h?l:h,d=u>s?u>c?u:c:s>c?s:c,y=f>l?f>h?f:h:l>h?l:h,g=lp(p,v,e,r,n),m=lp(d,y,e,r,n),x=t.prevZ,b=t.nextZ;x&&x.z>=g&&b&&b.z<=m;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&pp(u,f,s,l,c,h,x.x,x.y)&&dp(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&pp(u,f,s,l,c,h,b.x,b.y)&&dp(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;x&&x.z>=g;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&pp(u,f,s,l,c,h,x.x,x.y)&&dp(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=m;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&pp(u,f,s,l,c,h,b.x,b.y)&&dp(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function ap(t,e,r){var n=t;do{var o=n.prev,i=n.next.next;!yp(o,i)&&gp(o,n,n.next,i)&&bp(o,i)&&bp(i,o)&&(e.push(o.i/r|0),e.push(n.i/r|0),e.push(i.i/r|0),Ap(n),Ap(n.next),n=t=i),n=n.next}while(n!==t);return rp(n)}function up(t,e,r,n,o,i){var a=t;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&vp(a,u)){var s=wp(a,u);return a=rp(a,a.next),s=rp(s,s.next),np(a,e,r,n,o,i,0),void np(s,e,r,n,o,i,0)}u=u.next}a=a.next}while(a!==t)}function sp(t,e){return t.x-e.x}function cp(t,e){var r=function(t,e){var r,n=e,o=t.x,i=t.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=o&&u>a&&(a=u,r=n.x<n.next.x?n:n.next,u===o))return r}n=n.next}while(n!==e);if(!r)return null;var s,c=r,f=r.x,l=r.y,h=1/0;n=r;do{o>=n.x&&n.x>=f&&o!==n.x&&pp(i<l?o:a,i,f,l,i<l?a:o,i,n.x,n.y)&&(s=Math.abs(i-n.y)/(o-n.x),bp(n,t)&&(s<h||s===h&&(n.x>r.x||n.x===r.x&&fp(r,n)))&&(r=n,h=s)),n=n.next}while(n!==c);return r}(t,e);if(!r)return e;var n=wp(r,t);return rp(n,n.next),rp(r,r.next)}function fp(t,e){return dp(t.prev,t,e.prev)<0&&dp(e.next,t,t.next)<0}function lp(t,e,r,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function hp(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function pp(t,e,r,n,o,i,a,u){return(o-a)*(e-u)>=(t-a)*(i-u)&&(t-a)*(n-u)>=(r-a)*(e-u)&&(r-a)*(i-u)>=(o-a)*(n-u)}function vp(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&gp(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(bp(t,e)&&bp(e,t)&&function(t,e){var r=t,n=!1,o=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(dp(t.prev,t,e.prev)||dp(t,e.prev,e))||yp(t,e)&&dp(t.prev,t,t.next)>0&&dp(e.prev,e,e.next)>0)}function dp(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function yp(t,e){return t.x===e.x&&t.y===e.y}function gp(t,e,r,n){var o=xp(dp(t,e,r)),i=xp(dp(t,e,n)),a=xp(dp(r,n,t)),u=xp(dp(r,n,e));return o!==i&&a!==u||(!(0!==o||!mp(t,r,e))||(!(0!==i||!mp(t,n,e))||(!(0!==a||!mp(r,t,n))||!(0!==u||!mp(r,e,n)))))}function mp(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function xp(t){return t>0?1:t<0?-1:0}function bp(t,e){return dp(t.prev,t,t.next)<0?dp(t,e,t.next)>=0&&dp(t,t.prev,e)>=0:dp(t,e,t.prev)<0||dp(t,t.next,e)<0}function wp(t,e){var r=new Op(t.i,t.x,t.y),n=new Op(e.i,e.x,e.y),o=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function Ep(t,e,r,n){var o=new Op(t,e,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Ap(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Op(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Sp(t,e,r,n){for(var o=0,i=e,a=r-n;i<r;i+=n)o+=(t[a]-t[i])*(t[i+1]+t[a+1]),a=i;return o}tp.deviation=function(t,e,r,n){var o=e&&e.length,i=o?e[0]*r:t.length,a=Math.abs(Sp(t,0,i,r));if(o)for(var u=0,s=e.length;u<s;u++){var c=e[u]*r,f=u<s-1?e[u+1]*r:t.length;a-=Math.abs(Sp(t,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;l+=Math.abs((t[h]-t[v])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[v+1]-t[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},tp.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var i=0;i<t[o].length;i++)for(var a=0;a<e;a++)r.vertices.push(t[o][i][a]);o>0&&(n+=t[o-1].length,r.holes.push(n))}return r},Xh.default=Jh;var Tp=C(1..valueOf),kp=C("".replace),Ip="[\\t\\n\\v\\f\\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\\u2028\\u2029\\ufeff]",jp=RegExp("^"+Ip+Ip+"*"),Pp=RegExp(Ip+Ip+"*$"),_p=function(t){return function(e){var r=Kc(D(e));return 1&t&&(r=kp(r,jp,"")),2&t&&(r=kp(r,Pp,"")),r}},Mp={start:_p(1),end:_p(2),trim:_p(3)},Lp=qe.f,Rp=ke.f,Cp=Ft.f,Np=Mp.trim,Dp=O.Number,Fp=Dp.prototype,Wp=O.TypeError,zp=C("".slice),Bp=C("".charCodeAt),Up=function(t){var e=Lt(t,"number");return"bigint"==typeof e?e:Gp(e)},Gp=function(t){var e,r,n,o,i,a,u,s,c=Lt(t,"number");if(Ot(c))throw Wp("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=Np(c),43===(e=Bp(c,0))||45===e){if(88===(r=Bp(c,2))||120===r)return NaN}else if(48===e){switch(Bp(c,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(a=(i=zp(c,2)).length,u=0;u<a;u++)if((s=Bp(i,u))<48||s>o)return NaN;return parseInt(i,n)}return+c};if(rr("Number",!Dp(" 0o1")||!Dp("0b1")||Dp("+0x1"))){for(var Vp,qp=function(t){var e=arguments.length<1?0:Dp(Up(t)),r=this;return Et(Fp,r)&&j((function(){Tp(r)}))?ts(Object(e),r,qp):e},Hp=ft?Lp(Dp):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),Zp=0;Hp.length>Zp;Zp++)B(Dp,Vp=Hp[Zp])&&!B(qp,Vp)&&Cp(qp,Vp,Rp(Dp,Vp));qp.prototype=Fp,Fp.constructor=qp,fe(O,"Number",qp,{constructor:!0})}var Yp=RangeError,$p=RangeError,Kp=String,Qp=Math.floor,Xp=C((function(t){var e=Kc(D(this)),r="",n=_e(t);if(n<0||n==1/0)throw Yp("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(r+=e);return r})),Jp=C("".slice),tv=C(1..toFixed),ev=function(t,e,r){return 0===e?r:e%2==1?ev(t,e-1,r*t):ev(t*t,e/2,r)},rv=function(t,e,r){for(var n=-1,o=r;++n<6;)o+=e*t[n],t[n]=o%1e7,o=Qp(o/1e7)},nv=function(t,e){for(var r=6,n=0;--r>=0;)n+=t[r],t[r]=Qp(n/e),n=n%e*1e7},ov=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var n=Kp(t[e]);r=""===r?n:r+Xp("0",7-n.length)+n}return r},iv=j((function(){return"0.000"!==tv(8e-5,3)||"1"!==tv(.9,0)||"1.25"!==tv(1.255,2)||"1000000000000000128"!==tv(0xde0b6b3a7640080,0)}))||!j((function(){tv({})}));function av(t){return"number"==typeof t}function uv(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),r=Math.PI/180,n=t[0]*r,o=e*r;o=Math.log(Math.tan(Math.PI/4+o/2));return n=(256<<20)*(.5/Math.PI*n+.5),o=(256<<20)*(-.5/Math.PI*o+(r=.5)),[Math.floor(n),Math.floor(o)]}or({target:"Number",proto:!0,forced:iv},{toFixed:function(t){var e,r,n,o,i=Tp(this),a=_e(t),u=[0,0,0,0,0,0],s="",c="0";if(a<0||a>20)throw $p("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return Kp(i);if(i<0&&(s="-",i=-i),i>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(i*ev(2,69,1))-69)<0?i*ev(2,-e,1):i/ev(2,e,1),r*=4503599627370496,(e=52-e)>0){for(rv(u,0,r),n=a;n>=7;)rv(u,1e7,0),n-=7;for(rv(u,ev(10,n,1),0),n=e-1;n>=23;)nv(u,1<<23),n-=23;nv(u,1<<n),rv(u,1,1),nv(u,2),c=ov(u)}else rv(u,0,r),rv(u,1<<-e,0),c=ov(u)+Xp("0",a);return c=a>0?s+((o=c.length)<=a?"0."+Xp("0",a-o)+c:Jp(c,0,o-a)+"."+Jp(c,o-a)):s+c}});var sv,cv=/"/g,fv=C("".replace);or({target:"String",proto:!0,forced:(sv="sub",j((function(){var t=""[sv]('"');return t!==t.toLowerCase()||t.split('"').length>3})))},{sub:function(){return t="sub",e="",r="",n=Kc(D(this)),o="<"+t,""!==e&&(o+=" "+e+'="'+fv(Kc(r),cv,"&quot;")+'"'),o+">"+n+"</"+t+">";var t,e,r,n,o}});var lv=RegExp.prototype,hv=Ut.PROPER,pv=RegExp.prototype.toString,vv=j((function(){return"/a/b"!=pv.call({source:"a",flags:"b"})})),dv=hv&&"toString"!=pv.name;(vv||dv)&&fe(RegExp.prototype,"toString",(function(){var t=xt(this);return"/"+Kc(t.source)+"/"+Kc(function(t){var e=t.flags;return void 0!==e||"flags"in lv||B(t,"flags")||!Et(lv,t)?e:wt(Qc,t)}(t))}),{unsafe:!0});var yv="undefined"!=typeof Float32Array?Float32Array:Array;function gv(){var t=new yv(2);return yv!=Float32Array&&(t[0]=0,t[1]=0),t}function mv(t,e){var r=new yv(2);return r[0]=t,r[1]=e,r}function xv(t,e){return t[0]=e[0],t[1]=e[1],t}function bv(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function wv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Ev(t,e){var r=e[0],n=e[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function Av(t,e){return t[0]*e[0]+t[1]*e[1]}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Ov,Sv=wv,Tv=(Ov=gv(),gv()),kv=(gv(),gv()),Iv=gv(),jv=gv();function Pv(t,e,r,n,o){return bv(t,r,n),Ev(t,t),[o/Av(e=mv(-t[1],t[0]),mv(-r[1],r[0])),e]}function _v(t,e){return function(t,e,r){return t[0]=e,t[1]=r,t}(t,-e[1],e[0])}function Mv(t,e,r){return Sv(t,e,r),Ev(t,t),t}function Lv(t,e){return t[0]===e[0]&&t[1]===e[1]}var Rv=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),s(this,"complex",void 0),s(this,"join",void 0),s(this,"cap",void 0),s(this,"miterLimit",void 0),s(this,"thickness",void 0),s(this,"normal",void 0),s(this,"lastFlip",-1),s(this,"miter",mv(0,0)),s(this,"started",!1),s(this,"dash",!1),s(this,"totalDistance",0),s(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return u(t,[{key:"extrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.segment_gaode2(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.simpleSegment(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.segment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.simpleSegment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,r,n,o,i,a,u){var s=0,c=t.indices,f=t.positions,l=t.normals,h="square"===this.cap,p="bevel"===this.join,v=uv([a[0],a[1]]),g=uv([i[0],i[1]]);Mv(kv,n,r);var m=0;if(this.dash&&(m=this.lineSegmentDistance(v,g),this.totalDistance+=m),this.normal||(this.normal=gv(),_v(this.normal,kv)),!this.started)if(this.started=!0,h){var x=gv(),b=gv();bv(x,this.normal,kv),bv(b,this.normal,kv),l.push(b[0],b[1],0),l.push(x[0],x[1],0),f.push(r[0],r[1],0|r[2],this.totalDistance-m,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),f.push(r[0],r[1],0|r[2],this.totalDistance-m,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,r,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),o){Lv(n,o)&&bv(o,n,Ev(o,wv(o,n,r))),Mv(Iv,o,n);var w=d(Pv(jv,gv(),kv,Iv,this.thickness),2),E=w[0],A=w[1],O=Av(jv,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join)E>this.miterLimit&&(S=!0);S?(l.push(this.normal[0],this.normal[1],0),l.push(A[0],A[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,y(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),_v(Tv,Iv),xv(this.normal,Tv),l.push(this.normal[0],this.normal[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(f,l,n,A,E,this.totalDistance),c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,xv(this.normal,A),s+=2),this.lastFlip=O}else{if(_v(this.normal,kv),h){var T=gv(),k=gv();Sv(k,kv,this.normal),bv(T,kv,this.normal),l.push(k[0],k[1],0),l.push(T[0],T[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,n,this.normal,this.thickness,this.totalDistance);c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"simpleSegment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c=uv([n[0],n[1]]),f=uv([r[0],r[1]]);Mv(kv,c,f);var l=0;if(this.dash&&(l=this.lineSegmentDistance(c,f),this.totalDistance+=l),this.normal||(this.normal=gv(),_v(this.normal,kv)),this.started||(this.started=!0,this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-l)),a.push(e+0,e+1,e+2),o){var h=uv([o[0],o[1]]);Lv(c,h)&&bv(h,c,Ev(h,wv(h,c,f))),Mv(Iv,h,c);var p=d(Pv(jv,gv(),kv,Iv,this.thickness),2),v=p[0],g=p[1];Av(jv,this.normal);this.extrusions(u,s,n,g,v,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,xv(this.normal,g),i+=2,this.lastFlip=-1}else _v(this.normal,kv),this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2;return i}},{key:"segment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c="square"===this.cap,f="bevel"===this.join,l=uv([n[0],n[1]]),h=uv([r[0],r[1]]);Mv(kv,l,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(l,h),this.totalDistance+=p),this.normal||(this.normal=gv(),_v(this.normal,kv)),!this.started)if(this.started=!0,c){var v=gv(),g=gv();bv(v,this.normal,kv),bv(g,this.normal,kv),s.push(g[0],g[1],0),s.push(v[0],v[1],0),u.push(r[0],r[1],0|r[2],this.totalDistance-p,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),u.push(r[0],r[1],0|r[2],this.totalDistance-p,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),o){var m=uv([o[0],o[1]]);Lv(l,m)&&bv(m,l,Ev(m,wv(m,l,h))),Mv(Iv,m,l);var x=d(Pv(jv,gv(),kv,Iv,this.thickness),2),b=x[0],w=x[1],E=Av(jv,this.normal)<0?-1:1,A=f;if(!A&&"miter"===this.join)b>this.miterLimit&&(A=!0);A?(s.push(this.normal[0],this.normal[1],0),s.push(w[0],w[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,y(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),_v(Tv,Iv),xv(this.normal,Tv),s.push(this.normal[0],this.normal[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,i+=3):(this.extrusions(u,s,n,w,b,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,xv(this.normal,w),i+=2),this.lastFlip=E}else{if(_v(this.normal,kv),c){var O=gv(),S=gv();Sv(S,kv,this.normal),bv(O,kv,this.normal),s.push(S[0],S[1],0),s.push(O[0],O[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance);a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2}return i}},{key:"extrusions",value:function(t,e,r,n,o,i){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(r[0],r[1],0|r[2],i,-o,0|r[2]),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],0|r[2],i,o,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}}]),t}();function Cv(t){var e=t.coordinates,r=t.originCoordinates,n=t.version,o=new Rv({dash:!0,join:"bevel"});if("GAODE2.x"===n){var i=e;Array.isArray(i[0][0])||(i=[e]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<i.length;u++){var s=i[u],c=a[u];o.extrude_gaode2(s,c)}}else{var f=e;f[0]&&!Array.isArray(f[0][0])&&(f=[e]),f.forEach((function(t){o.extrude(t)}))}var l=o.complex;return{vertices:l.positions,indices:l.indices,normals:l.normals,indexes:l.indexes,size:6}}function Nv(t){var e=function(t){if(av(t[0]))return t;if(av(t[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(av(t[0][0][0])){var e=0,r=0,n=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],r+=t[1],n++}))})),[e/n,r/n,0]}throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}(t.coordinates);return{vertices:[].concat(y(e),y(e),y(e),y(e)),indices:[0,1,2,2,3,0],size:e.length}}function Dv(t){var e=t.coordinates,r=Xh.flatten(e),n=r.vertices,o=r.dimensions,i=r.holes;return{indices:Xh(n,i,o),vertices:n,size:o}}var Fv=function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.iconMap,u={a_Color:Yh,a_Position:$h,filter:Kh,a_vertexId:Qh,a_PickingColor:function(t){var e=t.id;return i?qh(e):[0,0,0]},a_DistanceAndIndex:function(t,e,r,n,o,i){return void 0===i?[r[3],10]:[r[3],i]},a_Total_Distance:function(t,e,r,n){return[r[5]]},a_Size:function(t){var e=t.size,r=void 0===e?1:e;return Array.isArray(r)?[r[0],r[1]]:[r,0]},a_Normal:function(t,e,r,n,o){return o},a_Miter:function(t,e,r){return[r[4]]},a_iconMapUV:function(t){var e=t.texture,r=a[e]||{x:0,y:0};return[r.x,r.y]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Cv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size,p=r.indexes;o.forEach((function(t){f.push(t+c)})),l=h;var v=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=v;for(var d=function(r){var o=(null==a?void 0:a.slice(3*r,3*r+3))||[],s=i.slice(r*h,r*h+h),c=0;p&&void 0!==p[r]&&(c=p[r]),n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,s,r,o,c)))}))},g=0;g<v;g++)d(g)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Wv={pointFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.shape2d,u={a_Color:Yh,a_Position:$h,filter:Kh,a_vertexId:Qh,a_PickingColor:function(t){var e=t.id;return i?qh(e):[0,0,0]},a_Shape:function(t){var e=t.shape,r=void 0===e?2:e;return[a.indexOf(r)]},a_Extrude:function(t,e,r,n){var o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],i=n%4*3;return[o[i],o[i+1],o[i+2]]},a_Size:function(t){var e=t.size,r=void 0===e?5:e;return Array.isArray(r)?[r[0]]:[r]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Nv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size;o.forEach((function(t){f.push(t+c)})),l=h;var p=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=p;for(var v=function(r){var o=[],a=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,a,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),line:Fv,polygonFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a={a_Color:Yh,a_Position:$h,filter:Kh,a_vertexId:Qh,a_PickingColor:function(t){var e=t.id;return i?qh(e):[0,0,0]}},u={sizePerElement:0,elements:[]},s=0,c=[],f=3,o.forEach((function(t,e){var r=Dv(t),o=r.indices,i=r.vertices,l=r.normals,h=r.size;o.forEach((function(t){c.push(t+s)})),f=h;var p=i.length/h;u.sizePerElement=f,u.elements.push({featureIdx:e,vertices:i,normals:l,offset:s}),s+=p;for(var v=function(r){var o=[],u=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&a[n.name]&&(i=n.buffer.data).push.apply(i,y(a[n.name](t,e,u,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},zv=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Wv);function Bv(t){return Uv.apply(this,arguments)}function Uv(){return(Uv=o(r().mark((function t(e){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.workerType,o=e.data,!zv[n]){t.next=3;break}return t.abrupt("return",zv[n](o));case 3:return t.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(n,'" non-existent.'))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return ui(Bv),t.WorkerSourceMap=Wv,t.createWorker=ui,t.worker=Bv,t}({});
`,rc="l7-worker",xc=3,Tf=!0;function rh(e){Ph(rc,e)}function Rh(){var e=th(rc);if(!e)throw new Error("get worker failed by workerName: ".concat(rc,"."));return e}function bc(e,i){return Mf.apply(this,arguments)}function Mf(){return Mf=(0,ue.Z)(te().mark(function e(i,r){var n,t,o,u,c;return te().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return n=Rh(),t=Qo.getWorkerFarm({maxConcurrency:xc,reuseWorkers:Tf}),o=t.getWorkerPool({name:rc,source:n}),m.next=5,o.startJob(rc,function(b,C,A){return b.done(A)});case 5:return u=m.sent,u.postMessage("process",{input:{workerType:i,data:r}}),m.next=9,u.result;case 9:return c=m.sent,m.abrupt("return",c.result);case 11:case"end":return m.stop()}},e)})),Mf.apply(this,arguments)}rh(Lh);var ll={BACK:1029,FRONT:1028};function Ec(e){switch(e){case"GAODE1.x":return ll.BACK;case"GAODE2.x":return ll.BACK;case"MAPBOX":return ll.FRONT;case"SIMPLE":return ll.FRONT;case"GLOBEL":return ll.BACK;case"L7MAP":return ll.FRONT;default:return ll.FRONT}}function nh(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function If(e){var i=[],r=/\{([a-z])-([a-z])\}/.exec(e);if(r){var n=r[1].charCodeAt(0),t=r[2].charCodeAt(0),o;for(o=n;o<=t;++o)i.push(e.replace(r[0],String.fromCharCode(o)));return i}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){for(var u=parseInt(r[2],10),c=parseInt(r[1],10);c<=u;c++)i.push(e.replace(r[0],c.toString()));return i}return i.push(e),i}function ws(e,i){if(!e||!e.length)throw new Error("url is not allowed to be empty");var r=i.x,n=i.y,t=i.z,o=If(e),u=Math.abs(r+n)%o.length,c=o[u];return c.replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,t.toString()).replace(/\{-y\}/g,(Math.pow(2,t)-n-1).toString())}var kl;(function(e){e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace"})(kl||(kl={}));var Ns;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(Ns||(Ns={}));function ih(e,i){i===void 0&&(i={});var r=Number(e[0]),n=Number(e[1]),t=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var u=[r,n],c=[r,o],p=[t,o],m=[t,n];return Ci([[u,m,p,c,u]],i.properties,{bbox:e,id:i.id})}var kf=0,ah=1,Mu=2;function tf(e){e.forEach(function(i){i.isCurrent&&(i.isVisible=i.isLoaded)})}function ld(e){e.forEach(function(i){i.properties.state=kf}),e.forEach(function(i){i.isCurrent&&!_p(i)&&xp(i)}),e.forEach(function(i){i.isVisible=Boolean(i.properties.state&Mu)})}function Oh(e){e.forEach(function(r){r.properties.state=kf}),e.forEach(function(r){r.isCurrent&&_p(r)});var i=e.slice().sort(function(r,n){return r.z-n.z});i.forEach(function(r){r.isVisible=Boolean(r.properties.state&Mu),r.children.length&&(r.isVisible||r.properties.state&ah)?r.children.forEach(function(n){n.properties.state=ah}):r.isCurrent&&xp(r)})}function _p(e){for(;e;){if(e.isLoaded)return e.properties.state|=Mu,!0;e=e.parent}return!1}function xp(e){e.children.forEach(function(i){i.isLoaded?i.properties.state|=Mu:xp(i)})}var oh,Yu=256,bp=[-Infinity,-Infinity,Infinity,Infinity],Dh=.2,Pf=5,cl=(oh={},(0,T.Z)(oh,kl.Realtime,tf),(0,T.Z)(oh,kl.Overlap,ld),(0,T.Z)(oh,kl.Replace,Oh),oh),cd=function(){};function Ep(e,i,r){var n=Math.floor((e+180)/360*Math.pow(2,r)),t=Math.floor((1-Math.log(Math.tan(i*Math.PI/180)+1/Math.cos(i*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,t]}function fl(e,i,r){var n=e/Math.pow(2,r)*360-180,t=Math.PI-2*Math.PI*i/Math.pow(2,r),o=180/Math.PI*Math.atan(.5*(Math.exp(t)-Math.exp(-t)));return[n,o]}var Lf=function(i,r,n){var t=fl(i,r,n),o=(0,ce.Z)(t,2),u=o[0],c=o[1],p=fl(i+1,r+1,n),m=(0,ce.Z)(p,2),b=m[0],C=m[1];return[u,C,b,c]};function rf(e){var i=e.zoom,r=e.latLonBounds,n=e.maxZoom,t=n===void 0?Infinity:n,o=e.minZoom,u=o===void 0?0:o,c=e.zoomOffset,p=c===void 0?0:c,m=e.extent,b=m===void 0?bp:m,C=Math.ceil(i)+p;if(Number.isFinite(u)&&C<u)return[];Number.isFinite(t)&&C>t&&(C=t);for(var A=(0,ce.Z)(r,4),P=A[0],O=A[1],D=A[2],N=A[3],j=[Math.max(P,b[0]),Math.max(O,b[1]),Math.min(D,b[2]),Math.min(N,b[3])],ae=[],re=Ep(j[0],j[1],C),Te=(0,ce.Z)(re,2),Re=Te[0],Ke=Te[1],gt=Ep(j[2],j[3],C),lt=(0,ce.Z)(gt,2),Ut=lt[0],or=lt[1],cr=Re;cr<=Ut;cr++)for(var Tr=or;Tr<=Ke;Tr++)ae.push({x:cr,y:Tr,z:C});var Sn=(Ut+Re)/2,Un=(Ke+or)/2,Vi=function(ho,Ao){return Math.abs(ho-Sn)+Math.abs(Ao-Un)};return ae.sort(function(Ba,ho){return Vi(Ba.x,Ba.y)-Vi(ho.x,ho.y)}),ae}var Sc=function(i,r,n){var t=Math.pow(2,n),o=t-1,u=t,c=i,p=r;return c<0?c=c+u:c>o&&(c=c%u),{warpX:c,warpY:p}},iu=fe(26729),sh=fe.n(iu);function Fh(e){var i=Sp();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function Sp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sa=function(e){(0,hr.Z)(r,e);var i=Fh(r);function r(n){var t;(0,vt.Z)(this,r),t=i.call(this),(0,T.Z)((0,$e.Z)(t),"tileSize",256),(0,T.Z)((0,$e.Z)(t),"isVisible",!1),(0,T.Z)((0,$e.Z)(t),"isCurrent",!1),(0,T.Z)((0,$e.Z)(t),"isVisibleChange",!1),(0,T.Z)((0,$e.Z)(t),"layerIDList",[]),(0,T.Z)((0,$e.Z)(t),"loadedLayers",0),(0,T.Z)((0,$e.Z)(t),"parent",null),(0,T.Z)((0,$e.Z)(t),"children",[]),(0,T.Z)((0,$e.Z)(t),"loadedChilds",0),(0,T.Z)((0,$e.Z)(t),"data",null),(0,T.Z)((0,$e.Z)(t),"properties",{}),(0,T.Z)((0,$e.Z)(t),"loadDataId",0);var o=n.x,u=n.y,c=n.z,p=n.tileSize;return t.x=o,t.y=u,t.z=c,t.tileSize=p,t}return(0,yt.Z)(r,[{key:"isLoading",get:function(){return this.loadStatus===Ns.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Ns.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Ns.Failure}},{key:"isCancelled",get:function(){return this.loadStatus===Ns.Cancelled}},{key:"isDone",get:function(){return[Ns.Loaded,Ns.Cancelled,Ns.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Lf(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=(0,ce.Z)(this.bounds,4),o=t[0],u=t[1],c=t[2],p=t[3],m=[(c-o)/2,(p-u)/2],b=ih(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:m,meta:`
      `.concat(this.key,`
      `)}});return b}},{key:"key",get:function(){var t="".concat(this.x,",").concat(this.y,",").concat(this.z);return t}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,ue.Z)(te().mark(function o(u){var c,p,m,b,C,A,P,O,D,N,j,ae,re,Te,Re,Ke;return te().wrap(function(lt){for(;;)switch(lt.prev=lt.next){case 0:return c=u.getData,p=u.onLoad,m=u.onError,this.loadDataId++,b=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Ns.Loading,C=null,lt.prev=7,P=this.x,O=this.y,D=this.z,N=this.bounds,j=this.tileSize,ae=Sc(P,O,D),re=ae.warpX,Te=ae.warpY,Re=this.abortController.signal,Ke={x:re,y:Te,z:D,bounds:N,tileSize:j,signal:Re},lt.next=14,c(Ke,this);case 14:C=lt.sent,lt.next=20;break;case 17:lt.prev=17,lt.t0=lt.catch(7),A=lt.t0;case 20:if(b===this.loadDataId){lt.next=22;break}return lt.abrupt("return");case 22:if(!(this.isCancelled&&!C)){lt.next=24;break}return lt.abrupt("return");case 24:if(!(A||!C)){lt.next=28;break}return this.loadStatus=Ns.Failure,m(A,this),lt.abrupt("return");case 28:this.loadStatus=Ns.Loaded,this.data=C,p(this);case 31:case"end":return lt.stop()}},o,this,[[7,17]])}));function t(o){return n.apply(this,arguments)}return t}()},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Ns.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),r}(iu.EventEmitter),Cc=function(i,r){var n=Xl(i),t=pu(n,r),o=360*3-180,u=85.0511287798065,c=[Math.max(t[0][0],-o),Math.max(t[0][1],-u),Math.min(t[1][0],o),Math.min(t[1][1],u)];return c},Zo=function(i,r){var n=Xl(i),t=Xl(r),o=Al(n,t);return o},Er=fe(96486);function nc(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=fd(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var m=r.next();return o=m.done,m},e:function(m){u=!0,c=m},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function fd(e,i){if(!!e){if(typeof e=="string")return hd(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hd(e,i)}}function hd(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function qd(e){var i=Kd();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function Kd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cp=function(e){(0,hr.Z)(r,e);var i=qd(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this),(0,T.Z)((0,$e.Z)(t),"currentTiles",[]),(0,T.Z)((0,$e.Z)(t),"cacheTiles",new Map),(0,T.Z)((0,$e.Z)(t),"throttleUpdate",(0,Er.throttle)(function(o,u){t.update(o,u)},16)),(0,T.Z)((0,$e.Z)(t),"onTileLoad",function(o){t.emit("tile-loaded",o),t.updateTileVisible()}),(0,T.Z)((0,$e.Z)(t),"onTileError",function(o,u){t.emit("tile-error",{error:o,tile:u}),t.updateTileVisible()}),(0,T.Z)((0,$e.Z)(t),"onTileUnload",function(o){t.emit("tile-unload",o)}),t.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:bp,getTileData:cd,updateStrategy:kl.Replace},t.updateOptions(n),t}return(0,yt.Z)(r,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(t){return t.isDone})}},{key:"tiles",get:function(){var t=Array.from(this.cacheTiles.values()).sort(function(o,u){return o.z-u.z});return t}},{key:"updateOptions",value:function(t){var o=t.minZoom===void 0?this.options.minZoom:Math.ceil(t.minZoom),u=t.maxZoom===void 0?this.options.maxZoom:Math.floor(t.maxZoom);this.options=(0,oe.Z)((0,oe.Z)((0,oe.Z)({},this.options),t),{},{minZoom:o,maxZoom:u})}},{key:"update",value:function(t,o){var u=this,c=Math.ceil(t);if(!(this.lastViewStates&&this.lastViewStates.zoom===c&&Zo(this.lastViewStates.latLonBoundsBuffer,o))){var p=Cc(o,Dh);this.lastViewStates={zoom:c,latLonBounds:o,latLonBoundsBuffer:p};var m=!1,b=this.getTileIndices(c,p);this.currentTiles=b.map(function(C){var A=C.x,P=C.y,O=C.z,D=u.getTile(A,P,O);if(D){var N,j,ae=((N=D)===null||N===void 0?void 0:N.isFailure)||((j=D)===null||j===void 0?void 0:j.isCancelled);return ae&&D.loadData({getData:u.options.getTileData,onLoad:u.onTileLoad,onError:u.onTileError}),D}return D=u.createTile(A,P,O),m=!0,D}),m&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var t=nc(this.cacheTiles),o;try{for(t.s();!(o=t.n()).done;){var u=(0,ce.Z)(o.value,2),c=u[0],p=u[1];this.currentTiles.includes(p)||(this.cacheTiles.delete(c),this.onTileUnload(p)),this.onTileUnload(p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(m){t.e(m)}finally{t.f()}}},{key:"pruneRequests",value:function(){var t=[],o=nc(this.cacheTiles.values()),u;try{for(o.s();!(u=o.n()).done;){var c=u.value;c.isLoading&&!c.isCurrent&&!c.isVisible&&t.push(c)}}catch(m){o.e(m)}finally{o.f()}for(;t.length>0;){var p=t.shift();p.abortLoad()}}},{key:"getTileByLngLat",value:function(t,o,u){var c=this.options.zoomOffset,p=Math.ceil(u)+c,m=Ep(t,o,p),b=this.tiles.filter(function(C){return C.key==="".concat(m[0],",").concat(m[1],",").concat(p)});return b[0]}},{key:"destroy",value:function(){var t=nc(this.cacheTiles.values()),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u.isLoading&&u.abortLoad()}}catch(c){t.e(c)}finally{t.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var t=this.options.updateStrategy,o=new Map,u=nc(this.cacheTiles.values()),c;try{for(u.s();!(c=u.n()).done;){var p=c.value;o.set(p.key,p.isVisible),p.isCurrent=!1,p.isVisible=!1}}catch(O){u.e(O)}finally{u.f()}var m=nc(this.currentTiles),b;try{for(m.s();!(b=m.n()).done;){var C=b.value;C.isCurrent=!0,C.isVisible=!0}}catch(O){m.e(O)}finally{m.f()}var A=Array.from(this.cacheTiles.values());typeof t=="function"?t(A):cl[t](A);var P=!1;Array.from(this.cacheTiles.values()).forEach(function(O){O.isVisible!==o.get(O.key)?(O.isVisibleChange=!0,P=!0):O.isVisibleChange=!1}),P&&this.emit("tile-update")}},{key:"getTileIndices",value:function(t,o){var u=this.options,c=u.tileSize,p=u.extent,m=u.zoomOffset,b=Math.floor(this.options.maxZoom),C=Math.ceil(this.options.minZoom),A=rf({maxZoom:b,minZoom:C,zoomOffset:m,tileSize:c,zoom:t,latLonBounds:o,extent:p});return A}},{key:"getTileId",value:function(t,o,u){var c="".concat(t,",").concat(o,",").concat(u);return c}},{key:"getTile",value:function(t,o,u){var c=this.getTileId(t,o,u),p=this.cacheTiles.get(c);return p}},{key:"createTile",value:function(t,o,u){var c=this.getTileId(t,o,u),p=new Sa({x:t,y:o,z:u,tileSize:this.options.tileSize});return this.cacheTiles.set(c,p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),p}},{key:"resizeCacheTiles",value:function(){var t=Pf*this.currentTiles.length,o=this.cacheTiles.size>t;if(o){var u=nc(this.cacheTiles),c;try{for(u.s();!(c=u.n()).done;){var p=(0,ce.Z)(c.value,2),m=p[0],b=p[1];if(!b.isVisible&&!this.currentTiles.includes(b)&&(this.cacheTiles.delete(m),this.onTileUnload(b)),this.cacheTiles.size<=t)break}}catch(C){u.e(C)}finally{u.f()}}}},{key:"rebuildTileTree",value:function(){var t=nc(this.cacheTiles.values()),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u.parent=null,u.children.length=0}}catch(C){t.e(C)}finally{t.f()}var c=nc(this.cacheTiles.values()),p;try{for(c.s();!(p=c.n()).done;){var m=p.value,b=this.getNearestAncestor(m.x,m.y,m.z);m.parent=b,b!=null&&b.children&&b.children.push(m)}}catch(C){c.e(C)}finally{c.f()}}},{key:"getNearestAncestor",value:function(t,o,u){for(;u>this.options.minZoom;){t=Math.floor(t/2),o=Math.floor(o/2),u=u-1;var c=this.getTile(t,o,u);if(c)return c}return null}}]),r}(sh()),pd;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(pd||(pd={}));function Lv(e,i,r,n,t){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,c=r;return u&&(c=Math.round(r*(o-1))/(o-1)),n?Rf(e,i,c,n,t):Rf(e,i,c,.314,t)}function wc(e,i){var r=1-i;return(e[0]*r+e[1]*i)*r+(e[1]*r+e[2]*i)*i}function dd(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function wp(e,i,r){var n=[i[0]-e[0],i[1]-e[1]],t=dd(n,[0,0]),o=Math.atan2(n[1],n[0]),u=t/2/Math.cos(r),c=o+r,p=[u*Math.cos(c)+e[0],u*Math.sin(c)+e[1]];return p}function Rf(e,i,r,n,t){if(t===Version["GAODE2.x"]){var o=amap2Project(e[0],e[1]),u=amap2Project(i[0],i[1]),c=wp(o,u,n),p=[o[0],c[0],u[0]],m=[o[1],c[1],u[1]];return[].concat(_toConsumableArray(amap2UnProject(wc(p,r),wc(m,r))),[0])}else{var b=wp(e,i,n),C=[e[0],b[0],i[0]],A=[e[1],b[1],i[1]];return[wc(C,r),wc(A,r),0]}}function Za(e,i,r,n,t){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,c=r;return u&&(c=Math.round(r*29)/29),Tp(e,i,c,t)}function Ap(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=calDistance(r,[0,0]),t=Math.atan2(r[1],r[0]),o=.314,u=n/2/Math.cos(o),c=t+o,p=[u*Math.cos(c)+e[0],u*Math.sin(c)+e[1]];return p}function Pl(e,i){var r=1-i;return(e[0]*r+e[1]*i)*r+(e[1]*r+e[2]*i)*i}function Of(e,i){var r=[e[0]-i[0],e[1]-i[1]],n=[Math.sin(r[0]/2),Math.sin(r[1]/2)],t=n[1]*n[1]+Math.cos(e[1])*Math.cos(i[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t))}function Tp(e,i,r,n){var t=[degreesToRadians(e[0]),degreesToRadians(e[1])],o=[degreesToRadians(i[0]),degreesToRadians(i[1])];if(n==="GAODE2.x"){var u=Ap(t,o),c=[t[0],u[0],o[0]],p=[t[1],u[1],o[1]];return[Pl(c,r),Pl(p,r),0]}else{var m=Of(t,o);if(Math.abs(m-Math.PI)<.001)return[(1-r)*t[0]+r*o[0],(1-r)*t[1]+r*o[1]];var b=Math.sin((1-r)*m)/Math.sin(m),C=Math.sin(r*m)/Math.sin(m),A=[Math.sin(t[0]),Math.sin(t[1])],P=[Math.cos(t[0]),Math.cos(t[1])],O=[Math.sin(o[0]),Math.sin(o[1])],D=[Math.cos(o[0]),Math.cos(o[1])],N=b*P[1]*P[0]+C*D[1]*D[0],j=b*P[1]*A[0]+C*D[1]*O[0],ae=b*A[1]+C*O[1];return[radiansToDegrees(Math.atan2(j,N)),radiansToDegrees(Math.atan2(ae,Math.sqrt(N*N+j*j)))]}}function Rv(e,i){for(var r=0,n=[],t=0;t<e.length-1;t++){var o=e[t],u=e[t+1],c=we(o,u),p=r;r+=c,n.push({p1:o,p2:u,totalDistance:r,distance:c,lastTotalDistance:p})}for(var m=r*i,b,C,A=0;A<n.length;A++){var P=n[A].totalDistance;if(P>m){var O=n[A].p1,D=n[A].p2,N=(m-n[A].lastTotalDistance)/n[A].distance,j=Z(D,O,N);b=j[0],C=j[1];break}}return{_lng:b,_lat:C,_height:0}}function Z(e,i,r){return[e[0]*r+i[0]*(1-r),e[1]*r+i[1]*(1-r)]}function we(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Xe(e,i){var r=i.featureId,n=e.data.dataArray;return typeof r=="number"&&(n=n.filter(function(t){var o=t._id;return o===r})),n.map(function(t){var o=br(t,i);return _objectSpread(_objectSpread({},t),o)})}function Kt(e,i){return new Promise(function(r){e.inited?r(Xe(e,i)):e.once("update",function(){r(Xe(e,i))})})}function br(e,i){var r=i.offset,n=i.shape,t=i.thetaOffset,o=i.mapVersion,u=i.segmentNumber,c=u===void 0?30:u,p=i.autoFit,m=p===void 0?!0:p,b=e.coordinates;if(n==="line")return pathLineAtOffset(b,r);var C=b[0],A=b[1],P;typeof t=="string"?P=e[t]||0:P=t;var O;switch(n){case"arc":O=arcLineAtOffset;break;case"greatcircle":O=greatCircleLineAtOffset;break;default:O=arcLineAtOffset}var D=O(C,A,r,P,o,c,m),N=_slicedToArray(D,3),j=N[0],ae=N[1],re=N[2];return{_lng:j,_lat:ae,_height:re}}function $t(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,t=new Promise(function(u){e instanceof HTMLImageElement||Vu(e)?u([e]):mr(e,function(c){u(c)})}),o={originData:e,images:t,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return o}function mr(e,i){var r=e,n=[];if(typeof r=="string")zn({url:r},function(u,c){c&&(n.push(c),i(n))});else{var t=r.length,o=0;r.forEach(function(u){zn({url:u},function(c,p){o++,p&&n.push(p),o===t&&i(n)})})}return $t}var Ar=fe(38929),Rr=fe(3614),Nr=fe.n(Rr),Gr={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function Wr(e,i,r){var n=e/Math.pow(2,r)*360-180,t=Math.PI-2*Math.PI*i/Math.pow(2,r),o=180/Math.PI*Math.atan(.5*(Math.exp(t)-Math.exp(-t)));return[n,o]}var un=function(){var e=(0,ue.Z)(te().mark(function i(r,n,t){var o;return te().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=ws(r,n),c.abrupt("return",new Promise(function(p){var m=ju({url:o},function(b,C){if(b||!C)p({layers:{}});else{for(var A=new Ar.VectorTile(new(Nr())(C)),P=0,O=Object.keys(A.layers);P<O.length;P++){for(var D=O[P],N=[],j=A.layers[D],ae=0;ae<A.layers[D].length;ae++){var re=A.layers[D].feature(ae),Te=re.toGeoJSON(n.x,n.y,n.z);N.push(Te)}j.features=N}p(A)}});t.xhrCancel=function(){return m.abort()}}));case 2:case"end":return c.stop()}},i)}));return function(r,n,t){return e.apply(this,arguments)}}();function Fr(e,i){var r=Array.isArray(e)?e[0]:e,n=function(u,c){return un(r,u,c)},t=(0,oe.Z)((0,oe.Z)((0,oe.Z)({},Gr),i),{},{getTileData:n});return{data:r,dataArray:[],tilesetOptions:t,isTile:!0}}function Vr(e,i,r,n){for(var t=n,o=r-i>>1,u=r-i,c,p=e[i],m=e[i+1],b=e[r],C=e[r+1],A=i+3;A<r;A+=3){var P=Ct(e[A],e[A+1],p,m,b,C);if(P>t)c=A,t=P;else if(P===t){var O=Math.abs(A-o);O<u&&(c=A,u=O)}}t>n&&(c-i>3&&Vr(e,i,c,n),e[c+2]=t,r-c>3&&Vr(e,c,r,n))}function Ct(e,i,r,n,t,o){var u=t-r,c=o-n;if(u!==0||c!==0){var p=((e-r)*u+(i-n)*c)/(u*u+c*c);p>1?(r=t,n=o):p>0&&(r+=u*p,n+=c*p)}return u=e-r,c=i-n,u*u+c*c}function rr(e,i,r,n){var t={id:typeof e=="undefined"?null:e,type:i,geometry:r,tags:n,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return zr(t),t}function zr(e){var i=e.geometry,r=e.type;if(r==="Point"||r==="MultiPoint"||r==="LineString")rn(e,i);else if(r==="Polygon"||r==="MultiLineString")for(var n=0;n<i.length;n++)rn(e,i[n]);else if(r==="MultiPolygon")for(n=0;n<i.length;n++)for(var t=0;t<i[n].length;t++)rn(e,i[n][t])}function rn(e,i){for(var r=0;r<i.length;r+=3)e.minX=Math.min(e.minX,i[r]),e.minY=Math.min(e.minY,i[r+1]),e.maxX=Math.max(e.maxX,i[r]),e.maxY=Math.max(e.maxY,i[r+1])}function Cr(e,i){var r=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)Hr(r,e.features[n],i,n);else e.type==="Feature"?Hr(r,e,i):Hr(r,{geometry:e},i);return r}function Hr(e,i,r,n){if(!!i.geometry){var t=i.geometry.coordinates,o=i.geometry.type,u=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),c=[],p=i.id;if(r.promoteId?p=i.properties[r.promoteId]:r.generateId&&(p=n||0),o==="Point")vn(t,c);else if(o==="MultiPoint")for(var m=0;m<t.length;m++)vn(t[m],c);else if(o==="LineString")qn(t,c,u,!1);else if(o==="MultiLineString")if(r.lineMetrics){for(m=0;m<t.length;m++)c=[],qn(t[m],c,u,!1),e.push(rr(p,"LineString",c,i.properties));return}else vr(t,c,u,!1);else if(o==="Polygon")vr(t,c,u,!0);else if(o==="MultiPolygon")for(m=0;m<t.length;m++){var b=[];vr(t[m],b,u,!0),c.push(b)}else if(o==="GeometryCollection"){for(m=0;m<i.geometry.geometries.length;m++)Hr(e,{id:p,geometry:i.geometry.geometries[m],properties:i.properties},r,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(rr(p,o,c,i.properties))}}function vn(e,i){i.push(xr(e[0])),i.push(On(e[1])),i.push(0)}function qn(e,i,r,n){for(var t,o,u=0,c=0;c<e.length;c++){var p=xr(e[c][0]),m=On(e[c][1]);i.push(p),i.push(m),i.push(0),c>0&&(n?u+=(t*m-p*o)/2:u+=Math.sqrt(Math.pow(p-t,2)+Math.pow(m-o,2))),t=p,o=m}var b=i.length-3;i[2]=1,Vr(i,0,b,r),i[b+2]=1,i.size=Math.abs(u),i.start=0,i.end=i.size}function vr(e,i,r,n){for(var t=0;t<e.length;t++){var o=[];qn(e[t],o,r,n),i.push(o)}}function xr(e){return e/360+.5}function On(e){var i=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+i)/(1-i))/Math.PI;return r<0?0:r>1?1:r}function Kr(e,i,r,n,t,o,u,c){if(r/=i,n/=i,o>=r&&u<n)return e;if(u<r||o>=n)return null;for(var p=[],m=0;m<e.length;m++){var b=e[m],C=b.geometry,A=b.type,P=t===0?b.minX:b.minY,O=t===0?b.maxX:b.maxY;if(P>=r&&O<n){p.push(b);continue}else if(O<r||P>=n)continue;var D=[];if(A==="Point"||A==="MultiPoint")Ur(C,D,r,n,t);else if(A==="LineString")cn(C,D,r,n,t,!1,c.lineMetrics);else if(A==="MultiLineString")Ai(C,D,r,n,t,!1);else if(A==="Polygon")Ai(C,D,r,n,t,!0);else if(A==="MultiPolygon")for(var N=0;N<C.length;N++){var j=[];Ai(C[N],j,r,n,t,!0),j.length&&D.push(j)}if(D.length){if(c.lineMetrics&&A==="LineString"){for(N=0;N<D.length;N++)p.push(rr(b.id,A,D[N],b.tags));continue}(A==="LineString"||A==="MultiLineString")&&(D.length===1?(A="LineString",D=D[0]):A="MultiLineString"),(A==="Point"||A==="MultiPoint")&&(A=D.length===3?"Point":"MultiPoint"),p.push(rr(b.id,A,D,b.tags))}}return p.length?p:null}function Ur(e,i,r,n,t){for(var o=0;o<e.length;o+=3){var u=e[o+t];u>=r&&u<=n&&(i.push(e[o]),i.push(e[o+1]),i.push(e[o+2]))}}function cn(e,i,r,n,t,o,u){for(var c=mn(e),p=t===0?fn:En,m=e.start,b,C,A=0;A<e.length-3;A+=3){var P=e[A],O=e[A+1],D=e[A+2],N=e[A+3],j=e[A+4],ae=t===0?P:O,re=t===0?N:j,Te=!1;u&&(b=Math.sqrt(Math.pow(P-N,2)+Math.pow(O-j,2))),ae<r?re>r&&(C=p(c,P,O,N,j,r),u&&(c.start=m+b*C)):ae>n?re<n&&(C=p(c,P,O,N,j,n),u&&(c.start=m+b*C)):gi(c,P,O,D),re<r&&ae>=r&&(C=p(c,P,O,N,j,r),Te=!0),re>n&&ae<=n&&(C=p(c,P,O,N,j,n),Te=!0),!o&&Te&&(u&&(c.end=m+b*C),i.push(c),c=mn(e)),u&&(m+=b)}var Re=e.length-3;P=e[Re],O=e[Re+1],D=e[Re+2],ae=t===0?P:O,ae>=r&&ae<=n&&gi(c,P,O,D),Re=c.length-3,o&&Re>=3&&(c[Re]!==c[0]||c[Re+1]!==c[1])&&gi(c,c[0],c[1],c[2]),c.length&&i.push(c)}function mn(e){var i=[];return i.size=e.size,i.start=e.start,i.end=e.end,i}function Ai(e,i,r,n,t,o){for(var u=0;u<e.length;u++)cn(e[u],i,r,n,t,o,!1)}function gi(e,i,r,n){e.push(i),e.push(r),e.push(n)}function fn(e,i,r,n,t,o){var u=(o-i)/(n-i);return e.push(o),e.push(r+(t-r)*u),e.push(1),u}function En(e,i,r,n,t,o){var u=(o-r)/(t-r);return e.push(i+(n-i)*u),e.push(o),e.push(1),u}function di(e,i){var r=i.buffer/i.extent,n=e,t=Kr(e,1,-1-r,r,0,-1,2,i),o=Kr(e,1,1-r,2+r,0,-1,2,i);return(t||o)&&(n=Kr(e,1,-r,1+r,0,-1,2,i)||[],t&&(n=wi(t,1).concat(n)),o&&(n=n.concat(wi(o,-1)))),n}function wi(e,i){for(var r=[],n=0;n<e.length;n++){var t=e[n],o=t.type,u;if(o==="Point"||o==="MultiPoint"||o==="LineString")u=Ui(t.geometry,i);else if(o==="MultiLineString"||o==="Polygon"){u=[];for(var c=0;c<t.geometry.length;c++)u.push(Ui(t.geometry[c],i))}else if(o==="MultiPolygon")for(u=[],c=0;c<t.geometry.length;c++){for(var p=[],m=0;m<t.geometry[c].length;m++)p.push(Ui(t.geometry[c][m],i));u.push(p)}r.push(rr(t.id,o,u,t.tags))}return r}function Ui(e,i){var r=[];r.size=e.size,e.start!==void 0&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+i,e[n+1],e[n+2]);return r}function no(e,i){if(e.transformed)return e;var r=1<<e.z,n=e.x,t=e.y,o,u,c;for(o=0;o<e.features.length;o++){var p=e.features[o],m=p.geometry,b=p.type;if(p.geometry=[],b===1)for(u=0;u<m.length;u+=2)p.geometry.push(co(m[u],m[u+1],i,r,n,t));else for(u=0;u<m.length;u++){var C=[];for(c=0;c<m[u].length;c+=2)C.push(co(m[u][c],m[u][c+1],i,r,n,t));p.geometry.push(C)}}return e.transformed=!0,e}function co(e,i,r,n,t,o){return[Math.round(r*(e*n-t)),Math.round(r*(i*n-o))]}function ji(e,i,r,n,t){for(var o=i===t.maxZoom?0:t.tolerance/((1<<i)*t.extent),u={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:i,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},c=0;c<e.length;c++){u.numFeatures++,hs(u,e[c],o,t);var p=e[c].minX,m=e[c].minY,b=e[c].maxX,C=e[c].maxY;p<u.minX&&(u.minX=p),m<u.minY&&(u.minY=m),b>u.maxX&&(u.maxX=b),C>u.maxY&&(u.maxY=C)}return u}function hs(e,i,r,n){var t=i.geometry,o=i.type,u=[];if(o==="Point"||o==="MultiPoint")for(var c=0;c<t.length;c+=3)u.push(t[c]),u.push(t[c+1]),e.numPoints++,e.numSimplified++;else if(o==="LineString")Va(u,t,e,r,!1,!1);else if(o==="MultiLineString"||o==="Polygon")for(c=0;c<t.length;c++)Va(u,t[c],e,r,o==="Polygon",c===0);else if(o==="MultiPolygon")for(var p=0;p<t.length;p++){var m=t[p];for(c=0;c<m.length;c++)Va(u,m[c],e,r,!0,c===0)}if(u.length){var b=i.tags||null;if(o==="LineString"&&n.lineMetrics){b={};for(var C in i.tags)b[C]=i.tags[C];b.mapbox_clip_start=t.start/t.size,b.mapbox_clip_end=t.end/t.size}var A={geometry:u,type:o==="Polygon"||o==="MultiPolygon"?3:o==="LineString"||o==="MultiLineString"?2:1,tags:b};i.id!==null&&(A.id=i.id),e.features.push(A)}}function Va(e,i,r,n,t,o){var u=n*n;if(n>0&&i.size<(t?u:n)){r.numPoints+=i.length/3;return}for(var c=[],p=0;p<i.length;p+=3)(n===0||i[p+2]>u)&&(r.numSimplified++,c.push(i[p]),c.push(i[p+1])),r.numPoints++;t&&ss(c,o),e.push(c)}function ss(e,i){for(var r=0,n=0,t=e.length,o=t-2;n<t;o=n,n+=2)r+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(r>0===i)for(n=0,t=e.length;n<t/2;n+=2){var u=e[n],c=e[n+1];e[n]=e[t-2-n],e[n+1]=e[t-1-n],e[t-2-n]=u,e[t-1-n]=c}}function Oo(e,i){return new Do(e,i)}function Do(e,i){i=this.options=As(Object.create(this.options),i);var r=i.debug;if(r&&console.time("preprocess data"),i.maxZoom<0||i.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(i.promoteId&&i.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=Cr(e,i);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",i.indexMaxZoom,i.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=di(n,i),n.length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}Do.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Do.prototype.splitTile=function(e,i,r,n,t,o,u){for(var c=[e,i,r,n],p=this.options,m=p.debug;c.length;){n=c.pop(),r=c.pop(),i=c.pop(),e=c.pop();var b=1<<i,C=Fo(i,r,n),A=this.tiles[C];if(!A&&(m>1&&console.time("creation"),A=this.tiles[C]=ji(e,i,r,n,p),this.tileCoords.push({z:i,x:r,y:n}),m)){m>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",i,r,n,A.numFeatures,A.numPoints,A.numSimplified),console.timeEnd("creation"));var P="z"+i;this.stats[P]=(this.stats[P]||0)+1,this.total++}if(A.source=e,t){if(i===p.maxZoom||i===t)continue;var O=1<<t-i;if(r!==Math.floor(o/O)||n!==Math.floor(u/O))continue}else if(i===p.indexMaxZoom||A.numPoints<=p.indexMaxPoints)continue;if(A.source=null,e.length!==0){m>1&&console.time("clipping");var D=.5*p.buffer/p.extent,N=.5-D,j=.5+D,ae=1+D,re,Te,Re,Ke,gt,lt;re=Te=Re=Ke=null,gt=Kr(e,b,r-D,r+j,0,A.minX,A.maxX,p),lt=Kr(e,b,r+N,r+ae,0,A.minX,A.maxX,p),e=null,gt&&(re=Kr(gt,b,n-D,n+j,1,A.minY,A.maxY,p),Te=Kr(gt,b,n+N,n+ae,1,A.minY,A.maxY,p),gt=null),lt&&(Re=Kr(lt,b,n-D,n+j,1,A.minY,A.maxY,p),Ke=Kr(lt,b,n+N,n+ae,1,A.minY,A.maxY,p),lt=null),m>1&&console.timeEnd("clipping"),c.push(re||[],i+1,r*2,n*2),c.push(Te||[],i+1,r*2,n*2+1),c.push(Re||[],i+1,r*2+1,n*2),c.push(Ke||[],i+1,r*2+1,n*2+1)}}},Do.prototype.getTile=function(e,i,r){var n=this.options,t=n.extent,o=n.debug;if(e<0||e>24)return null;var u=1<<e;i=(i%u+u)%u;var c=Fo(e,i,r);if(this.tiles[c])return no(this.tiles[c],t);o>1&&console.log("drilling down to z%d-%d-%d",e,i,r);for(var p=e,m=i,b=r,C;!C&&p>0;)p--,m=Math.floor(m/2),b=Math.floor(b/2),C=this.tiles[Fo(p,m,b)];return!C||!C.source?null:(o>1&&console.log("found parent tile z%d-%d-%d",p,m,b),o>1&&console.time("drilling down"),this.splitTile(C.source,p,m,b,e,i,r),o>1&&console.timeEnd("drilling down"),this.tiles[c]?no(this.tiles[c],t):null)};function Fo(e,i,r){return((1<<e)*r+i)*32+e}function As(e,i){for(var r in i)e[r]=i[r];return e}var _o={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function Mi(e){for(var i=0,r=0,n=e.length,t=n-1,o,u;r<n;t=r++)o=e[r],u=e[t],i+=(u.x-o.x)*(o.y+u.y);return i}function Jo(e){var i=e.length;if(i<=1)return[e];for(var r=[],n,t,o=0;o<i;o++){var u=Mi(e[o]);u!==0&&(t===void 0&&(t=u<0),t===u<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}var la=["Unknown","Point","LineString","Polygon"];function ps(e,i,r,n,t){var o=t.geometry,u=t.type,c=t.tags,p=t.id,m=e*Math.pow(2,n),b=e*i,C=e*r,A=la[u],P,O;function D(ae){for(var re=0;re<ae.length;re++){var Te=ae[re];if(Te[3])break;var Re=180-(Te[1]+C)*360/m,Ke=(Te[0]+b)*360/m-180,gt=360/Math.PI*Math.atan(Math.exp(Re*Math.PI/180))-90;ae[re]=[Ke,gt,0,1]}}switch(u){case 1:var N=[];for(P=0;P<o.length;P++)N[P]=o[P][0];o=N,D(o);break;case 2:for(P=0;P<o.length;P++)D(o[P]);break;case 3:for(o=Jo(o),P=0;P<o.length;P++)for(O=0;O<o[P].length;O++)D(o[P][O]);break}o.length===1?o=o[0]:A="Multi"+A;var j={type:"Feature",geometry:{type:A,coordinates:o},properties:c,id:p,tileOrigin:[0,0],coord:""};return j}var _i=function(){var e=(0,ue.Z)(te().mark(function i(r,n,t,o){return te().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",new Promise(function(p){var m=n.getTile(r.z,r.x,r.y),b=[];m.features.map(function(A){var P=ps(o,t.x,t.y,t.z,A);b.push(P)});var C={layers:{geojsonvt:{features:b}}};p(C)}));case 1:case"end":return c.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}();function Gi(e){var i={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"||(e.geojsonvtOptions.maxZoom&&(i.maxZoom=e.geojsonvtOptions.maxZoom),e.geojsonvtOptions.indexMaxZoom&&(i.indexMaxZoom=e.geojsonvtOptions.indexMaxZoom),e.geojsonvtOptions.indexMaxPoints&&(i.indexMaxPoints=e.geojsonvtOptions.indexMaxPoints),e.geojsonvtOptions.tolerance&&(i.tolerance=e.geojsonvtOptions.tolerance),e.geojsonvtOptions.extent&&(i.extent=e.geojsonvtOptions.extent),e.geojsonvtOptions.buffer&&(i.buffer=e.geojsonvtOptions.buffer),e.geojsonvtOptions.lineMetrics&&(i.lineMetrics=e.geojsonvtOptions.lineMetrics),e.geojsonvtOptions.promoteId&&(i.promoteId=e.geojsonvtOptions.promoteId),e.geojsonvtOptions.generateId&&(i.generateId=e.geojsonvtOptions.generateId),e.geojsonvtOptions.debug&&(i.debug=e.geojsonvtOptions.debug)),i}function ma(e,i){var r=Gi(i),n=r.extent||4096,t=Oo(e,r),o=function(p,m){return _i(m,t,p,n)},u=(0,oe.Z)((0,oe.Z)((0,oe.Z)({},_o),i),{},{getTileData:o});return{data:e,dataArray:[],tilesetOptions:u,isTile:!0}}function Bo(e,i,r){switch(e){case"+":return i+r;case"-":return i-r;case"*":return i*r;case"/":return i/r;case"%":return i%r;case"^":return Math.pow(i,r);case"abs":return Math.abs(i);case"floor":return Math.floor(i);case"round":return Math.round(i);case"ceil":return Math.ceil(i);case"sin":return Math.sin(i);case"cos":return Math.cos(i);case"atan":return r===-1?Math.atan(i):Math.atan2(i,r);default:return console.warn("Calculate symbol err! Return default 0"),0}}function Iu(e,i){for(var r=i[0],n=r.width,t=r.height,o=i.map(function(P){return P.rasterData}),u=n*t,c=[],p=JSON.stringify(e),m=0;m<u;m++){var b=JSON.parse(p),C=Ne(b,o,m);if(typeof C=="number")c.push(C);else{var A=zt(b);c.push(A)}}return c}function Ne(e,i,r){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return i[e[1]][r]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,t){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[t]=i[n[1]][r]}catch(o){console.warn("Raster Data err!"),e[t]=0}break;default:Ne(n,i,r)}})}function tr(e){var i=(0,ce.Z)(e,3),r=i[0],n=i[1],t=n===void 0?-1:n,o=i[2],u=o===void 0?-1:o;if(r===void 0)return console.warn("Express err!"),["+",0,0];var c=r.replace(/\s+/g,"");return[c,t,u]}function zt(e){var i=tr(e),r=i[0],n=i[1],t=i[2];return Array.isArray(n)&&(n=zt(e[1])),Array.isArray(t)&&(t=zt(e[2])),Bo(r,n,t)}function Tn(e,i,r){return Zi.apply(this,arguments)}function Zi(){return Zi=(0,ue.Z)(te().mark(function e(i,r,n){var t,o,u,c,p,m,b,C,A,P,O,D,N,j;return te().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:if(i.length!==0){re.next=2;break}return re.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return re.next=4,Promise.all(i.map(function(Te){var Re=Te.data,Ke=Te.bands,gt=Ke===void 0?[0]:Ke;return r(Re,gt)}));case 4:t=re.sent,t=t.flat(),o=t[0],u=o.width,c=o.height,m=void 0,b=void 0,C=void 0,re.t0=(0,ke.Z)(n),re.next=re.t0==="function"?13:re.t0==="object"?15:17;break;case 13:return p=n(t),re.abrupt("break",18);case 15:return Array.isArray(n)?p=Iu(n,t):(A=De(n,t),P=xe(A),O=P.data,D=P.channelRMax,N=P.channelGMax,j=P.channelBMax,p=O,m=D,b=N,C=j),re.abrupt("break",18);case 17:p=t[0].rasterData;case 18:return re.abrupt("return",{rasterData:p,width:u,height:c,channelR:m,channelG:b,channelB:C});case 19:case"end":return re.stop()}},e)})),Zi.apply(this,arguments)}function De(e,i){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var r=Iu(e.r||["band",0],i),n=Iu(e.g||["band",0],i),t=Iu(e.b||["band",0],i);return[r,n,t]}function xe(e){for(var i=e[0],r=e[1],n=e[2],t=[],o=-Infinity,u=-Infinity,c=-Infinity,p=0;p<i.length;p++)t.push(i[p]),o=Math.max(o,i[p]),t.push(r[p]),u=Math.max(u,i[p]),t.push(n[p]),c=Math.max(c,i[p]);return{data:t,channelRMax:o,channelGMax:u,channelBMax:c}}function tt(e,i,r,n){return At.apply(this,arguments)}function At(){return At=(0,ue.Z)(te().mark(function e(i,r,n,t){var o,u,c,p,m,b;return te().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,Tn(i,r,n);case 2:o=A.sent,u=o.rasterData,c=o.width,p=o.height,m=0,b=8e3,t(null,{data:u,width:c,height:p,min:m,max:b});case 9:case"end":return A.stop()}},e)})),At.apply(this,arguments)}function Wt(e,i){return e.map(function(r){return r[i]*1})}function ut(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function We(e){return Array.isArray(e)?e.length===0?!1:!!ut(e[0]):!1}function _t(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function Ie(e,i){var r=i.extent,n=i.width,t=i.height,o=i.min,u=i.max,c=i.format,p=i.operation,m,b,C;if(c===void 0||_t(e))m=Array.from(e),b=n,C=t;else{var A=Array.isArray(e)?e:[e];m=Tn(A,c,p)}var P={_id:1,dataArray:[{_id:1,data:m,width:b,height:C,min:o,max:u,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return P}function Je(e,i){var r=i.extent,n=i.width,t=i.height,o=i.min,u=i.max,c=i.format,p=i.operation,m,b,C;if(c===void 0||_t(e))m=Array.from(e),b=n,C=t;else{var A=Array.isArray(e)?e:[e];m=Tn(A,c,p)}var P={_id:1,dataArray:[{_id:1,data:m,width:b,height:C,min:o,max:u,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return P}var Oe;(function(e){e.IMAGE="image",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb"})(Oe||(Oe={}));function It(e,i){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(r){return ws(r,i)}):e.map(function(r){return{url:ws(r.url,i),bands:r.bands||[0]}}):ws(e,i)}function Zt(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(i){return{url:i,bands:[0]}}):e}function wr(e,i){e.xhrCancel=function(){i.map(function(r){r.abort()})}}var an=function(){var e=(0,ue.Z)(te().mark(function i(r,n,t,o,u){var c,p,m,b,C,A;return te().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(c=Zt(n.url),!(c.length>1)){O.next=15;break}return O.next=4,on(c,n);case 4:if(p=O.sent,m=p.rasterFiles,b=p.xhrList,C=p.errList,wr(r,b),!(C.length>0)){O.next=12;break}return t(C,null),O.abrupt("return");case 12:tt(m,o,u,t),O.next=17;break;case 15:A=ju(n,function(D,N){if(D)t(D);else if(N){var j=[{data:N,bands:c[0].bands}];tt(j,o,u,t)}}),wr(r,[A]);case 17:case"end":return O.stop()}},i)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}();function on(e,i){return _n.apply(this,arguments)}function _n(){return _n=(0,ue.Z)(te().mark(function e(i,r){var n,t,o,u,c,p,m,b,C,A,P;return te().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:n=[],t=[],o=[],u=0;case 4:if(!(u<i.length)){D.next=20;break}return c=i[u],p=(0,oe.Z)((0,oe.Z)({},r),{},{url:c.url}),m=c.bands,D.next=10,Su((0,oe.Z)((0,oe.Z)({},p),{},{type:"arrayBuffer"}));case 10:b=D.sent,C=b.err,A=b.data,P=b.xhr,C&&o.push(C),t.push(P),n.push({data:A,bands:m});case 17:u++,D.next=4;break;case 20:return D.abrupt("return",{rasterFiles:n,xhrList:t,errList:o});case 21:case"end":return D.stop()}},e)})),_n.apply(this,arguments)}var Qr=function(){var e=(0,ue.Z)(te().mark(function i(r,n,t,o,u){var c;return te().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return c={url:It(r,n)},m.abrupt("return",new Promise(function(b,C){an(t,c,function(A,P){A?C(A):P&&b(P)},o,u)}));case 2:case"end":return m.stop()}},i)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}(),Bn=function(){var e=(0,ue.Z)(te().mark(function i(r,n,t){var o;return te().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=ws(Array.isArray(r)?r[0]:r,n),c.abrupt("return",new Promise(function(p,m){var b=zn({url:o},function(C,A){C?m(C):A&&p(A)});t.xhrCancel=function(){return b.abort()}}));case 2:case"end":return c.stop()}},i)}));return function(r,n,t){return e.apply(this,arguments)}}(),wn=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},Fn={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},Dn=[Oe.ARRAYBUFFER,Oe.RGB];function kn(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function ci(e,i){if(kn(e))throw new Error("tile server url is error");var r=(i==null?void 0:i.dataType)||Oe.IMAGE;r===Oe.RGB&&(r=Oe.ARRAYBUFFER);var n=function(u,c){switch(r){case Oe.IMAGE:return Bn(e,u,c);case Oe.ARRAYBUFFER:return Qr(e,u,c,(i==null?void 0:i.format)||wn,i==null?void 0:i.operation);default:return Bn(e,u,c)}},t=(0,oe.Z)((0,oe.Z)((0,oe.Z)({},Fn),i),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:t,isTile:!0}}var ka={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},ds=function(){var e=(0,ue.Z)(te().mark(function i(r){return te().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(o){var u=(0,ce.Z)(r.bounds,4),c=u[0],p=u[1],m=u[2],b=u[3],C={layers:{testTile:{features:[{type:"Feature",properties:{key:r.x+"/"+r.y+"/"+r.z,textLng:(c+m)/2,textLat:(p+b)/2},geometry:{type:"LineString",coordinates:[[m,b],[m,p],[c,p],[c,p]]}}]}}};o(C)}));case 1:case"end":return t.stop()}},i)}));return function(r){return e.apply(this,arguments)}}();function ja(e,i){var r=function(o){return ds(o)},n=(0,oe.Z)((0,oe.Z)((0,oe.Z)({},ka),i),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var pa=fe(34155);function $u(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function c(b){try{m(n.next(b))}catch(C){u(C)}}function p(b){try{m(n.throw(b))}catch(C){u(C)}}function m(b){b.done?o(b.value):t(b.value).then(c,p)}m((n=n.apply(e,i||[])).next())})}function Ts(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function c(m){return function(b){return p([m,b])}}function p(m){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=m[0]&2?t.return:m[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,m[1])).done)return o;switch(t=0,o&&(m=[m[0]&2,o.value]),m[0]){case 0:case 1:o=m;break;case 4:return r.label++,{value:m[1],done:!1};case 5:r.label++,t=m[1],m=[0];continue;case 7:m=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(m[0]===6||m[0]===2)){r=0;continue}if(m[0]===3&&(!o||m[1]>o[0]&&m[1]<o[3])){r.label=m[1];break}if(m[0]===6&&r.label<o[1]){r.label=o[1],o=m;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(m);break}o[2]&&r.ops.pop(),r.trys.pop();continue}m=i.call(e,r)}catch(b){m=[6,b],t=0}finally{n=o=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}}function ku(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),t,o=[],u;try{for(;(i===void 0||i-- >0)&&!(t=n.next()).done;)o.push(t.value)}catch(c){u={error:c}}finally{try{t&&!t.done&&(r=n.return)&&r.call(n)}finally{if(u)throw u.error}}return o}function au(e,i,r){if(r||arguments.length===2)for(var n=0,t=i.length,o;n<t;n++)(o||!(n in i))&&(o||(o=Array.prototype.slice.call(i,0,n)),o[n]=i[n]);return e.concat(o||Array.prototype.slice.call(i))}function uh(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ou={exports:{}},hl={exports:{}},ic={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default})(ic,ic.exports);var Pu={},Vo={exports:{}},lh={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],t=arguments.length;t--;)n[t]=arguments[t];var o=n.pop();return r.call(this,n,o)}},e.exports=i.default})(lh,lh.exports);var yu={};Object.defineProperty(yu,"__esModule",{value:!0}),yu.fallback=ch,yu.wrap=Ac;var vd=yu.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,md=yu.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Qd=yu.hasNextTick=typeof pa=="object"&&typeof pa.nextTick=="function";function ch(e){setTimeout(e,0)}function Ac(e){return function(i){for(var r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];return e(function(){return i.apply(void 0,r)})}}var Bh;vd?Bh=queueMicrotask:md?Bh=setImmediate:Qd?Bh=pa.nextTick:Bh=ch,yu.default=Ac(Bh),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=p;var r=lh.exports,n=c(r),t=yu,o=c(t),u=Pu;function c(C){return C&&C.__esModule?C:{default:C}}function p(C){return(0,u.isAsync)(C)?function(){for(var A=[],P=arguments.length;P--;)A[P]=arguments[P];var O=A.pop(),D=C.apply(this,A);return m(D,O)}:(0,n.default)(function(A,P){var O;try{O=C.apply(this,A)}catch(D){return P(D)}if(O&&typeof O.then=="function")return m(O,P);P(null,O)})}function m(C,A){return C.then(function(P){b(A,null,P)},function(P){b(A,P&&P.message?P:new Error(P))})}function b(C,A,P){try{C(A,P)}catch(O){(0,o.default)(function(D){throw D},O)}}e.exports=i.default}(Vo,Vo.exports),Object.defineProperty(Pu,"__esModule",{value:!0}),Pu.isAsyncIterable=Pu.isAsyncGenerator=Pu.isAsync=void 0;var Ov=Vo.exports,G0=Ms(Ov);function Ms(e){return e&&e.__esModule?e:{default:e}}function nf(e){return e[Symbol.toStringTag]==="AsyncFunction"}function Dv(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function a(e){return typeof e[Symbol.asyncIterator]=="function"}function s(e){if(typeof e!="function")throw new Error("expected a function");return nf(e)?(0,G0.default)(e):e}Pu.default=s,Pu.isAsync=nf,Pu.isAsyncGenerator=Dv,Pu.isAsyncIterable=a;var l={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,t){if(t===void 0&&(t=n.length),!t)throw new Error("arity is undefined");function o(){for(var u=this,c=[],p=arguments.length;p--;)c[p]=arguments[p];return typeof c[t-1]=="function"?n.apply(this,c):new Promise(function(m,b){c[t-1]=function(C){for(var A=[],P=arguments.length-1;P-- >0;)A[P]=arguments[P+1];if(C)return b(C);m(A.length>1?A:A[0])},n.apply(u,c)})}return o}e.exports=i.default})(l,l.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=ic.exports,n=p(r),t=Pu,o=p(t),u=l.exports,c=p(u);function p(m){return m&&m.__esModule?m:{default:m}}i.default=(0,c.default)(function(m,b,C){var A=(0,n.default)(b)?[]:{};m(b,function(P,O,D){(0,o.default)(P)(function(N){for(var j,ae=[],re=arguments.length-1;re-- >0;)ae[re]=arguments[re+1];ae.length<2&&(j=ae,ae=j[0]),A[O]=ae,D(N)})},function(P){return C(P,A)})},3),e.exports=i.default}(hl,hl.exports);var v={exports:{}},_={exports:{}},E={exports:{}},w={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function t(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(n!==null){var c=n;n=null,c.apply(this,o)}}return Object.assign(t,n),t}e.exports=i.default})(w,w.exports);var L={exports:{}},B={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default})(B,B.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=b;var r=ic.exports,n=u(r),t=B.exports,o=u(t);function u(C){return C&&C.__esModule?C:{default:C}}function c(C){var A=-1,P=C.length;return function(){return++A<P?{value:C[A],key:A}:null}}function p(C){var A=-1;return function(){var O=C.next();return O.done?null:(A++,{value:O.value,key:A})}}function m(C){var A=C?Object.keys(C):[],P=-1,O=A.length;return function D(){var N=A[++P];return N==="__proto__"?D():P<O?{value:C[N],key:N}:null}}function b(C){if((0,n.default)(C))return c(C);var A=(0,o.default)(C);return A?p(A):m(C)}e.exports=i.default}(L,L.exports);var V={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var t=[],o=arguments.length;o--;)t[o]=arguments[o];if(n===null)throw new Error("Callback was already called.");var u=n;n=null,u.apply(this,t)}}e.exports=i.default})(V,V.exports);var W={exports:{}},$={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default})($,$.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=o;var r=$.exports,n=t(r);function t(u){return u&&u.__esModule?u:{default:u}}function o(u,c,p,m){var b=!1,C=!1,A=!1,P=0,O=0;function D(){P>=c||A||b||(A=!0,u.next().then(function(ae){var re=ae.value,Te=ae.done;if(!(C||b)){if(A=!1,Te){b=!0,P<=0&&m(null);return}P++,p(re,O,N),O++,D()}}).catch(j))}function N(ae,re){if(P-=1,!C){if(ae)return j(ae);if(ae===!1){b=!0,C=!0;return}if(re===n.default||b&&P<=0)return b=!0,m(null);D()}}function j(ae){C||(A=!1,b=!0,m(ae))}D()}e.exports=i.default}(W,W.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=w.exports,n=P(r),t=L.exports,o=P(t),u=V.exports,c=P(u),p=Pu,m=W.exports,b=P(m),C=$.exports,A=P(C);function P(O){return O&&O.__esModule?O:{default:O}}i.default=function(O){return function(D,N,j){if(j=(0,n.default)(j),O<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!D)return j(null);if((0,p.isAsyncGenerator)(D))return(0,b.default)(D,O,N,j);if((0,p.isAsyncIterable)(D))return(0,b.default)(D[Symbol.asyncIterator](),O,N,j);var ae=(0,o.default)(D),re=!1,Te=!1,Re=0,Ke=!1;function gt(Ut,or){if(!Te)if(Re-=1,Ut)re=!0,j(Ut);else if(Ut===!1)re=!0,Te=!0;else{if(or===A.default||re&&Re<=0)return re=!0,j(null);Ke||lt()}}function lt(){for(Ke=!0;Re<O&&!re;){var Ut=ae();if(Ut===null){re=!0,Re<=0&&j(null);return}Re+=1,N(Ut.value,Ut.key,(0,c.default)(gt))}Ke=!1}lt()}},e.exports=i.default}(E,E.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=E.exports,n=p(r),t=Pu,o=p(t),u=l.exports,c=p(u);function p(b){return b&&b.__esModule?b:{default:b}}function m(b,C,A,P){return(0,n.default)(C)(b,(0,o.default)(A),P)}i.default=(0,c.default)(m,4),e.exports=i.default}(_,_.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=_.exports,n=u(r),t=l.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function c(p,m,b){return(0,n.default)(p,1,m,b)}i.default=(0,o.default)(c,3),e.exports=i.default}(v,v.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=c;var r=hl.exports,n=u(r),t=v.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function c(p,m){return(0,n.default)(o.default,p,m)}e.exports=i.default}(ou,ou.exports);var le=uh(ou.exports),ve=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,le(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(t){r.apply(void 0,au([],ku(n.args),!1)),t(null,i)})},e}(),Ue={exports:{}},Ve={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=ic.exports,n=N(r),t=$.exports,o=N(t),u=_.exports,c=N(u),p=w.exports,m=N(p),b=V.exports,C=N(b),A=Pu,P=N(A),O=l.exports,D=N(O);function N(Te){return Te&&Te.__esModule?Te:{default:Te}}function j(Te,Re,Ke){Ke=(0,m.default)(Ke);var gt=0,lt=0,Ut=Te.length,or=!1;Ut===0&&Ke(null);function cr(Tr,Sn){Tr===!1&&(or=!0),or!==!0&&(Tr?Ke(Tr):(++lt===Ut||Sn===o.default)&&Ke(null))}for(;gt<Ut;gt++)Re(Te[gt],gt,(0,C.default)(cr))}function ae(Te,Re,Ke){return(0,c.default)(Te,Infinity,Re,Ke)}function re(Te,Re,Ke){var gt=(0,n.default)(Te)?j:ae;return gt(Te,(0,P.default)(Re),Ke)}i.default=(0,D.default)(re,3),e.exports=i.default})(Ve,Ve.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=c;var r=Ve.exports,n=u(r),t=hl.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function c(p,m){return(0,o.default)(n.default,p,m)}e.exports=i.default}(Ue,Ue.exports);var st=uh(Ue.exports),Qe=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return st(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return $u(n,void 0,void 0,function(){return Ts(this,function(o){switch(o.label){case 0:return[4,r()];case 1:return o.sent(),t(null,i),[2]}})})})},e}(),St={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=w.exports,n=b(r),t=V.exports,o=b(t),u=Pu,c=b(u),p=l.exports,m=b(p);function b(A){return A&&A.__esModule?A:{default:A}}function C(A,P){if(P=(0,n.default)(P),!Array.isArray(A))return P(new Error("First argument to waterfall must be an array of functions"));if(!A.length)return P();var O=0;function D(j){var ae=(0,c.default)(A[O++]);ae.apply(void 0,j.concat([(0,o.default)(N)]))}function N(j){for(var ae=[],re=arguments.length-1;re-- >0;)ae[re]=arguments[re+1];if(j!==!1){if(j||O===A.length)return P.apply(void 0,[j].concat(ae));D(ae)}}D([])}i.default=(0,m.default)(C),e.exports=i.default})(St,St.exports);var Vt=uh(St.exports),ir=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return Vt(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var t=r();n(t?null:!1,t)}):this.tasks.push(function(n,t){var o=r();t(o?null:!1,i)})},e}(),sr=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return le(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var t=r();n(t,i)})},e}(),Sr=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,le(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return $u(n,void 0,void 0,function(){return Ts(this,function(o){switch(o.label){case 0:return[4,r.apply(void 0,au([],ku(this.args),!1))];case 1:return o.sent(),t(null,i),[2]}})})})},e}(),Xr=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,le(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return $u(n,void 0,void 0,function(){var o;return Ts(this,function(u){switch(u.label){case 0:return[4,r.apply(void 0,au([],ku(this.args),!1))];case 1:return o=u.sent(),t(o,i),[2]}})})})},e}(),hn=fe(69848),Kn=fe.n(hn);function Mn(e,i){var r=i.radius,n=r===void 0?40:r,t=i.maxZoom,o=t===void 0?18:t,u=i.minZoom,c=u===void 0?0:u,p=i.zoom,m=p===void 0?2:p;if(e.pointIndex){var b=e.pointIndex.getClusters(e.extent,Math.floor(m));return e.dataArray=ni(b),e}var C=new(Kn())({radius:n,minZoom:c,maxZoom:o}),A={type:"FeatureCollection",features:[]};return A.features=e.dataArray.map(function(P){return{type:"Feature",geometry:{type:"Point",coordinates:P.coordinates},properties:(0,oe.Z)({},P)}}),C.load(A.features),C}function ni(e){return e.map(function(i,r){return(0,oe.Z)({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function Pn(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Bi(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function yi(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,t=1;t<e.length;t++)n=i+e[t]*1,Math.abs(i)>=Math.abs(e[t])?r+=i-n+e[t]:r+=e[t]-n+i,i=n;return i+r*1}function Wn(e){if(e.length===0)throw new Error("mean requires at least one data point");return yi(e)/e.length}var Wi={min:Bi,max:Pn,mean:Wn,sum:yi};function Li(e){var i=ca();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function ca(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function ii(e,i){if(Array.isArray(i))return i}var ga=function(e){(0,hr.Z)(r,e);var i=Li(r);function r(n,t){var o;return(0,vt.Z)(this,r),o=i.call(this),(0,T.Z)((0,$e.Z)(o),"type","source"),(0,T.Z)((0,$e.Z)(o),"inited",!1),(0,T.Z)((0,$e.Z)(o),"hooks",{init:new ve}),(0,T.Z)((0,$e.Z)(o),"parser",{type:"geojson"}),(0,T.Z)((0,$e.Z)(o),"transforms",[]),(0,T.Z)((0,$e.Z)(o),"cluster",!1),(0,T.Z)((0,$e.Z)(o),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,T.Z)((0,$e.Z)(o),"invalidExtent",!1),(0,T.Z)((0,$e.Z)(o),"dataArrayChanged",!1),(0,T.Z)((0,$e.Z)(o),"cfg",{}),o.originData=n,o.initCfg(t),o.init(),o}return(0,yt.Z)(r,[{key:"getClusters",value:function(t){return this.clusterIndex.getClusters(this.caculClusterExtent(2),t)}},{key:"getClustersLeaves",value:function(t){return this.clusterIndex.getLeaves(t,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(t){var o=this,u=this.clusterOptions,c=u.method,p=c===void 0?"sum":c,m=u.field,b=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(t));this.clusterOptions.zoom=t,b.forEach(function(C){C.id||(C.properties.point_count=1)}),(m||(0,Er.isFunction)(p))&&(b=b.map(function(C){var A=C.id;if(A){var P=o.clusterIndex.getLeaves(A,Infinity),O=P.map(function(j){return j.properties}),D;if((0,Er.isString)(p)&&m){var N=Wt(O,m);D=Wi[p](N)}(0,Er.isFunction)(p)&&(D=p(O)),C.properties.stat=D}else C.properties.point_count=1;return C})),this.data=_e("geojson")({type:"FeatureCollection",features:b}),this.executeTrans()}},{key:"getFeatureById",value:function(t){var o=this.parser,u=o.type,c=u===void 0?"geojson":u,p=o.geometry;if(c==="geojson"&&!this.cluster){var m=t<this.originData.features.length?this.originData.features[t]:"null",b=(0,Er.cloneDeep)(m);if(b!=null&&b.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var C=this.data.dataArray.find(function(A){return A._id===t});b.properties=C}return b}else return c==="json"&&p?this.data.dataArray.find(function(A){return A._id===t}):t<this.data.dataArray.length?this.data.dataArray[t]:"null"}},{key:"updateFeaturePropertiesById",value:function(t,o){this.data.dataArray=this.data.dataArray.map(function(u){return u._id===t?(0,oe.Z)((0,oe.Z)({},u),o):u}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(t,o){var u=this.data.dataArray.find(function(c){return c[t]===o});return u==null?void 0:u._id}},{key:"setData",value:function(t,o){this.originData=t,this.dataArrayChanged=!1,this.initCfg(o),this.init()}},{key:"destroy",value:function(){var t;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(t=this.tileset)===null||t===void 0||t.destroy()}},{key:"handleData",value:function(){var t=this;return new Promise(function(o,u){try{t.excuteParser(),t.initCluster(),t.executeTrans(),o({})}catch(c){u(c)}})}},{key:"initCfg",value:function(t){this.cfg=(0,Er.mergeWith)(this.cfg,t,ii);var o=this.cfg;o&&(o.parser&&(this.parser=o.parser),o.transforms&&(this.transforms=o.transforms),this.cluster=o.cluster||!1,o.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,oe.Z)((0,oe.Z)({},this.clusterOptions),o.clusterOptions)))}},{key:"init",value:function(){var t=this;this.inited=!1,this.handleData().then(function(){t.inited=!0,t.emit("update")})}},{key:"excuteParser",value:function(){var t=this.parser,o=t.type||"geojson",u=_e(o);this.data=u(this.originData,t),this.tileset=this.initTileset(),!t.cancelExtent&&(this.extent=hu(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(t){this.center=[(t[0]+t[2])/2,(t[1]+t[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var t=this.data.tilesetOptions;if(!!t){if(this.tileset)return this.tileset.updateOptions(t),this.tileset;var o=new Cp((0,oe.Z)({},t));return o}}},{key:"executeTrans",value:function(){var t=this,o=this.transforms;o.forEach(function(u){var c=u.type,p=ot(c)(t.data,u);Object.assign(t.data,p)})}},{key:"initCluster",value:function(){if(!!this.cluster){var t=this.clusterOptions||{};this.clusterIndex=Mn(this.data,t)}}},{key:"caculClusterExtent",value:function(t){var o=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(o=pu(Xl(this.extent),t)),o[0].concat(o[1])}}]),r}(iu.EventEmitter);function fo(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Co(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=wo(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var m=r.next();return o=m.done,m},e:function(m){u=!0,c=m},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function wo(e,i){if(!!e){if(typeof e=="string")return io(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return io(e,i)}}function io(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var xo=6378e3;function vs(e,i){var r=e.dataArray,n=i.size,t=n===void 0?10:n,o=t/(2*Math.PI*xo)*(256<<20)/2,u=ms(r,t),c=u.gridHash,p=u.gridOffset,m=jo(c,p,i);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:m}}function ms(e,i){var r=Infinity,n=-Infinity,t,o=Co(e),u;try{for(o.s();!(u=o.n()).done;){var c=u.value;t=c.coordinates[1],Number.isFinite(t)&&(r=t<r?t:r,n=t>n?t:n)}}catch(re){o.e(re)}finally{o.f()}var p=(r+n)/2,m=Ws(i,p);if(m.xOffset<=0||m.yOffset<=0)return{gridHash:{},gridOffset:m};var b={},C=Co(e),A;try{for(C.s();!(A=C.n()).done;){var P=A.value,O=P.coordinates[1],D=P.coordinates[0];if(Number.isFinite(O)&&Number.isFinite(D)){var N=Math.floor((O+90)/m.yOffset),j=Math.floor((D+180)/m.xOffset),ae="".concat(N,"-").concat(j);b[ae]=b[ae]||{count:0,points:[]},b[ae].count+=1,b[ae].points.push(P)}}}catch(re){C.e(re)}finally{C.f()}return{gridHash:b,gridOffset:m}}function Ws(e,i){var r=Is(e),n=Xs(i,e);return{yOffset:r,xOffset:n}}function Is(e){return e/xo*(180/Math.PI)}function Xs(e,i){return i/xo*(180/Math.PI)/Math.cos(e*Math.PI/180)}function jo(e,i,r){return Object.keys(e).reduce(function(n,t,o){var u=t.split("-"),c=parseInt(u[0],10),p=parseInt(u[1],10),m={};if(r.field&&r.method){var b=vc(e[t].points,r.field);m[r.method]=dc[r.method](b)}return Object.assign(m,{_id:o,coordinates:Xa([-180+i.xOffset*(p+.5),-90+i.yOffset*(c+.5)]),rawData:e[t].points,count:e[t].count}),n.push(m),n},[])}var No=Math.PI/3,ea=[0,No,2*No,3*No,4*No,5*No];function Ga(e){return e[0]}function Fa(e){return e[1]}function da(){var e=0,i=0,r=1,n=1,t=Ga,o=Fa,u,c,p;function m(C){var A={},P=[],O,D=C.length;for(O=0;O<D;++O)if(!(isNaN(j=+t.call(null,N=C[O],O,C))||isNaN(ae=+o.call(null,N,O,C)))){var N,j,ae,re=Math.round(ae=ae/p),Te=Math.round(j=j/c-(re&1)/2),Re=ae-re;if(Math.abs(Re)*3>1){var Ke=j-Te,gt=Te+(j<Te?-1:1)/2,lt=re+(ae<re?-1:1),Ut=j-gt,or=ae-lt;Ke*Ke+Re*Re>Ut*Ut+or*or&&(Te=gt+(re&1?1:-1)/2,re=lt)}var cr=Te+"-"+re,Tr=A[cr];Tr?Tr.push(N):(P.push(Tr=A[cr]=[N]),Tr.x=(Te+(re&1)/2)*c,Tr.y=re*p)}return P}function b(C){var A=0,P=0;return ea.map(function(O){var D=Math.sin(O)*C,N=-Math.cos(O)*C,j=D-A,ae=N-P;return A=D,P=N,[j,ae]})}return m.hexagon=function(C){return"m"+b(C==null?u:+C).join("l")+"z"},m.centers=function(){for(var C=[],A=Math.round(i/p),P=Math.round(e/c),O=A*p;O<n+u;O+=p,++A)for(var D=P*c+(A&1)*c/2;D<r+c/2;D+=c)C.push([D,O]);return C},m.mesh=function(){var C=b(u).slice(0,4).join("l");return m.centers().map(function(A){return"M"+A+"m"+C}).join("")},m.x=function(C){return arguments.length?(t=C,m):t},m.y=function(C){return arguments.length?(o=C,m):o},m.radius=function(C){return arguments.length?(u=+C,c=u*2*Math.sin(No),p=u*1.5,m):u},m.size=function(C){return arguments.length?(e=i=0,r=+C[0],n=+C[1],m):[r-e,n-i]},m.extent=function(C){return arguments.length?(e=+C[0][0],i=+C[0][1],r=+C[1][0],n=+C[1][1],m):[[e,i],[r,n]]},m.radius(1)}var su=6378e3;function zs(e,i){var r=e.dataArray,n=i.size,t=n===void 0?10:n,o=i.method,u=o===void 0?"sum":o,c=t/(2*Math.PI*su)*(256<<20)/2,p=r.map(function(A){var P=Xa(A.coordinates),O=(0,ce.Z)(P,2),D=O[0],N=O[1];return(0,oe.Z)((0,oe.Z)({},A),{},{coordinates:[D,N]})}),m=da().radius(c).x(function(A){return A.coordinates[0]}).y(function(A){return A.coordinates[1]}),b=m(p),C={dataArray:b.map(function(A,P){var O;if(i.field&&u){var D=vc(A,i.field);A[u]=dc[u](D)}return O={},(0,T.Z)(O,i.method,A[u]),(0,T.Z)(O,"count",A.length),(0,T.Z)(O,"rawData",A),(0,T.Z)(O,"coordinates",[A.x,A.y]),(0,T.Z)(O,"_id",P),O}),radius:c,xOffset:c,yOffset:c,type:"hexagon"};return C}function ao(e,i){var r=i.sourceField,n=i.targetField,t=i.data,o={};return t.forEach(function(u){o[u[r]]=u}),e.dataArray=e.dataArray.map(function(u){var c=u[n];return(0,oe.Z)((0,oe.Z)({},u),o[c])}),e}function es(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Ge("rasterTile",ci),Ge("mvt",Fr),Ge("geojsonvt",ma),Ge("testTile",ja),Ge("geojson",xn),Ge("image",$t),Ge("csv",Ln),Ge("json",Pr),Ge("raster",Ie),Ge("rasterRgb",Je),ft("cluster",Mn),ft("filter",fo),ft("join",ao),ft("map",es),ft("grid",vs),ft("hexagon",zs);var us=ga,Ca=fe(28660),Jr=fe(86700),qu=fe(84879),Ft={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Go=fe(31745),Tc=fe.n(Go);function pl(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Nh(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var m=r.next();return o=m.done,m},e:function(m){u=!0,c=m},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function Nh(e,i){if(!!e){if(typeof e=="string")return Df(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Df(e,i)}}function Df(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Mc=30;function af(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,t=e.buffer,o=e.maxCanvasWidth,u=e.mapping,c=u===void 0?{}:u,p=e.xOffset,m=p===void 0?0:p,b=e.yOffset,C=b===void 0?0:b,A=0,P=m;Array.from(i).forEach(function(D,N){if(!c[D]){var j=r(D,N);P+Mc>o&&(P=0,A++),c[D]={x:P,y:C+A*Mc,width:Mc,height:Mc,advance:j},P+=Mc}});var O=n+t*2;return{mapping:c,xOffset:P,yOffset:C+A*O,canvasHeight:fh(C+(A+1)*O)}}function zh(e,i,r){var n=0,t=0,o=0,u=[],c={},p=pl(e),m;try{for(p.s();!(m=p.n()).done;){var b=m.value;if(!c[b.id]){var C=b.size;n+C+i>r&&(Mp(c,u,t),n=0,t=o+t+i,o=0,u=[]),u.push({icon:b,xOffset:n}),n=n+C+i,o=Math.max(o,C)}}}catch(P){p.e(P)}finally{p.f()}u.length>0&&Mp(c,u,t);var A=fh(o+t+i);return{mapping:c,canvasHeight:A}}function Mp(e,i,r){var n=pl(i),t;try{for(n.s();!(t=n.n()).done;){var o=t.value,u=o.icon,c=o.xOffset;e[u.id]=(0,oe.Z)((0,oe.Z)({},u),{},{x:c,y:r,image:u.image,width:u.width,height:u.height})}}catch(p){n.e(p)}finally{n.f()}}function fh(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Uh,Ip;function kp(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=of(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var m=r.next();return o=m.done,m},e:function(m){u=!0,c=m},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function of(e,i){if(!!e){if(typeof e=="string")return Zh(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zh(e,i)}}function Zh(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Vh(e){var i=Ff();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function Ff(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jh=Wh(),gd="sans-serif",yd="normal",Pp=24,Lp=3,_d=.25,Rp=8,Gh=1024,Op=1,Dp=1,Hh=3,Jd=null;function Wh(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function Xh(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function Bf(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var Fp=(Uh=(0,Jr.b2)(),Uh(Ip=function(e){(0,hr.Z)(r,e);var i=Vh(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"fontAtlas",void 0),(0,T.Z)((0,$e.Z)(n),"iconFontMap",void 0),(0,T.Z)((0,$e.Z)(n),"iconFontGlyphs",{}),(0,T.Z)((0,$e.Z)(n),"fontOptions",void 0),(0,T.Z)((0,$e.Z)(n),"key",void 0),(0,T.Z)((0,$e.Z)(n),"cache",new $c(Hh)),n}return(0,yt.Z)(r,[{key:"scale",get:function(){return Dp}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:gd,fontWeight:yd,characterSet:jh,fontSize:Pp,buffer:Lp,sdf:!0,cutoff:_d,radius:Rp,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var o=this;t.forEach(function(u){o.iconFontGlyphs[u.name]=u.unicode})}},{key:"addIconFont",value:function(t,o){this.iconFontMap.set(t,o)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=(0,oe.Z)((0,oe.Z)({},this.fontOptions),t),this.key=this.getKey();var o=this.getNewChars(this.key,this.fontOptions.characterSet),u=this.cache.get(this.key);if(!(u&&o.length===0)){var c=this.generateFontAtlas(this.key,o,u);this.fontAtlas=c,this.cache.set(this.key,c)}}},{key:"addFontFace",value:function(t,o){var u=this,c=document.createElement("style");c.type="text/css",c.innerText=`
        @font-face{
            font-family: '`.concat(t,`';
            src: url('`).concat(o,`') format('woff2'),
            url('`).concat(o,`') format('woff'),
            url('`).concat(o,`') format('truetype');
        }`),c.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(t),"L7text"),document.fonts.ready.then(function(){u.emit("fontloaded",{fontFamily:t})})}catch(p){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(p)}},document.getElementsByTagName("head")[0].appendChild(c)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,o,u){var c=this.fontOptions,p=c.fontFamily,m=c.fontWeight,b=c.fontSize,C=c.buffer,A=c.sdf,P=c.radius,O=c.cutoff,D=c.iconfont,N=u&&u.data;N||(N=ha.document.createElement("canvas"),N.width=Gh);var j=N.getContext("2d");Xh(j,p,b,m);var ae=af((0,oe.Z)({getFontWidth:function(Wo){return j.measureText(Wo).width},fontHeight:b*Dp,buffer:C,characterSet:o,maxCanvasWidth:Gh},u&&{mapping:u.mapping,xOffset:u.xOffset,yOffset:u.yOffset})),re=ae.mapping,Te=ae.canvasHeight,Re=ae.xOffset,Ke=ae.yOffset,gt=j.getImageData(0,0,N.width,N.height);if(N.height=Te,j.putImageData(gt,0,0),Xh(j,p,b,m),A){var lt=new(Tc())(b,C,P,O,p,m),Ut=j.getImageData(0,0,lt.size,lt.size),or=kp(o),cr;try{for(or.s();!(cr=or.n()).done;){var Tr=cr.value;if(D){var Sn=String.fromCharCode(parseInt(Tr.replace("&#x","").replace(";",""),16)),Un=lt.draw(Sn);Bf(Un,Ut)}else Bf(lt.draw(Tr),Ut);j.putImageData(Ut,re[Tr].x,re[Tr].y)}}catch(Ao){or.e(Ao)}finally{or.f()}}else{var Vi=kp(o),Ba;try{for(Vi.s();!(Ba=Vi.n()).done;){var ho=Ba.value;j.fillText(ho,re[ho].x,re[ho].y+b*Op)}}catch(Ao){Vi.e(Ao)}finally{Vi.f()}}return{xOffset:Re,yOffset:Ke,mapping:re,data:N,width:N.width,height:N.height}}},{key:"getKey",value:function(){return"key";var t,o,u,c,p,m,b,C}},{key:"getNewChars",value:function(t,o){var u=this.cache.get(t);if(!u)return o;var c=[],p=u.mapping,m=new Set(Object.keys(p)),b=new Set(o);return b.forEach(function(C){m.has(C)||c.push(C)}),c}}]),r}(iu.EventEmitter))||Ip),hh,xd;function Fv(e){var i=ev();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function ev(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bv=3,bd=1024,Bp=64,Np=(hh=(0,Jr.b2)(),hh(xd=function(e){(0,hr.Z)(r,e);var i=Fv(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"canvasHeight",128),(0,T.Z)((0,$e.Z)(n),"texture",void 0),(0,T.Z)((0,$e.Z)(n),"canvas",void 0),(0,T.Z)((0,$e.Z)(n),"iconData",void 0),(0,T.Z)((0,$e.Z)(n),"iconMap",void 0),(0,T.Z)((0,$e.Z)(n),"ctx",void 0),(0,T.Z)((0,$e.Z)(n),"loadingImageCount",0),n}return(0,yt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=ha.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(t,o){var u=this,c=new Image;if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:Bp}),this.updateIconMap(),this.loadImage(o).then(function(p){c=p;var m=u.iconData.find(function(b){return b.id===t});m&&(m.image=c,m.width=c.width,m.height=c.height),u.update()})}},{key:"addImageMini",value:function(t,o,u){var c=this,p=u.getSceneConfig().canvas,m=p.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:Bp}),this.updateIconMap(),this.loadImageMini(o,p).then(function(b){m=b;var C=c.iconData.find(function(A){return A.id===t});C&&(C.image=m,C.width=m.width,C.height=m.height),c.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(t){return this.iconMap.hasOwnProperty(t)}},{key:"removeImage",value:function(t){this.hasImage(t)&&(this.iconData=this.iconData.filter(function(o){return o.id!==t}),delete this.iconMap[t],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(t){return new Promise(function(o,u){if(t instanceof HTMLImageElement){o(t);return}var c=new Image;c.crossOrigin="anonymous",c.onload=function(){o(c)},c.onerror=function(){u(new Error("Could not load image at "+t))},c.src=t instanceof File?URL.createObjectURL(t):t})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var t=this;this.canvas.width=bd,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(o){var u=t.iconMap[o],c=u.x,p=u.y,m=u.image,b=u.width,C=b===void 0?64:b,A=u.height,P=A===void 0?64:A,O=Math.max(C,P),D=O/Bp,N=P/D,j=C/D;m&&t.ctx.drawImage(m,c+(Bp-j)/2,p+(Bp-N)/2,j,N)})}},{key:"updateIconMap",value:function(){var t=zh(this.iconData,Bv,bd),o=t.mapping,u=t.canvasHeight;this.iconMap=o,this.canvasHeight=u}},{key:"loadImageMini",value:function(t,o){return new Promise(function(u,c){var p=o.createImage();p.crossOrigin="anonymous",p.onload=function(){u(p)},p.onerror=function(){c(new Error("Could not load image at "+t))},p.src=t})}}]),r}(iu.EventEmitter))||xd),ki=fe(49685);function Ho(){var e=new ki.WT(16);return ki.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Nv(e){var i=new ki.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Nf(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Ed(e,i,r,n,t,o,u,c,p,m,b,C,A,P,O,D){var N=new ki.WT(16);return N[0]=e,N[1]=i,N[2]=r,N[3]=n,N[4]=t,N[5]=o,N[6]=u,N[7]=c,N[8]=p,N[9]=m,N[10]=b,N[11]=C,N[12]=A,N[13]=P,N[14]=O,N[15]=D,N}function zv(e,i,r,n,t,o,u,c,p,m,b,C,A,P,O,D,N){return e[0]=i,e[1]=r,e[2]=n,e[3]=t,e[4]=o,e[5]=u,e[6]=c,e[7]=p,e[8]=m,e[9]=b,e[10]=C,e[11]=A,e[12]=P,e[13]=O,e[14]=D,e[15]=N,e}function zp(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ic(e,i){if(e===i){var r=i[1],n=i[2],t=i[3],o=i[6],u=i[7],c=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=o,e[11]=i[14],e[12]=t,e[13]=u,e[14]=c}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function ph(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=i[4],c=i[5],p=i[6],m=i[7],b=i[8],C=i[9],A=i[10],P=i[11],O=i[12],D=i[13],N=i[14],j=i[15],ae=r*c-n*u,re=r*p-t*u,Te=r*m-o*u,Re=n*p-t*c,Ke=n*m-o*c,gt=t*m-o*p,lt=b*D-C*O,Ut=b*N-A*O,or=b*j-P*O,cr=C*N-A*D,Tr=C*j-P*D,Sn=A*j-P*N,Un=ae*Sn-re*Tr+Te*cr+Re*or-Ke*Ut+gt*lt;return Un?(Un=1/Un,e[0]=(c*Sn-p*Tr+m*cr)*Un,e[1]=(t*Tr-n*Sn-o*cr)*Un,e[2]=(D*gt-N*Ke+j*Re)*Un,e[3]=(A*Ke-C*gt-P*Re)*Un,e[4]=(p*or-u*Sn-m*Ut)*Un,e[5]=(r*Sn-t*or+o*Ut)*Un,e[6]=(N*Te-O*gt-j*re)*Un,e[7]=(b*gt-A*Te+P*re)*Un,e[8]=(u*Tr-c*or+m*lt)*Un,e[9]=(n*or-r*Tr-o*lt)*Un,e[10]=(O*Ke-D*Te+j*ae)*Un,e[11]=(C*Te-b*Ke-P*ae)*Un,e[12]=(c*Ut-u*cr-p*lt)*Un,e[13]=(r*cr-n*Ut+t*lt)*Un,e[14]=(D*re-O*Re-N*ae)*Un,e[15]=(b*Re-C*re+A*ae)*Un,e):null}function Up(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=i[4],c=i[5],p=i[6],m=i[7],b=i[8],C=i[9],A=i[10],P=i[11],O=i[12],D=i[13],N=i[14],j=i[15];return e[0]=c*(A*j-P*N)-C*(p*j-m*N)+D*(p*P-m*A),e[1]=-(n*(A*j-P*N)-C*(t*j-o*N)+D*(t*P-o*A)),e[2]=n*(p*j-m*N)-c*(t*j-o*N)+D*(t*m-o*p),e[3]=-(n*(p*P-m*A)-c*(t*P-o*A)+C*(t*m-o*p)),e[4]=-(u*(A*j-P*N)-b*(p*j-m*N)+O*(p*P-m*A)),e[5]=r*(A*j-P*N)-b*(t*j-o*N)+O*(t*P-o*A),e[6]=-(r*(p*j-m*N)-u*(t*j-o*N)+O*(t*m-o*p)),e[7]=r*(p*P-m*A)-u*(t*P-o*A)+b*(t*m-o*p),e[8]=u*(C*j-P*D)-b*(c*j-m*D)+O*(c*P-m*C),e[9]=-(r*(C*j-P*D)-b*(n*j-o*D)+O*(n*P-o*C)),e[10]=r*(c*j-m*D)-u*(n*j-o*D)+O*(n*m-o*c),e[11]=-(r*(c*P-m*C)-u*(n*P-o*C)+b*(n*m-o*c)),e[12]=-(u*(C*N-A*D)-b*(c*N-p*D)+O*(c*A-p*C)),e[13]=r*(C*N-A*D)-b*(n*N-t*D)+O*(n*A-t*C),e[14]=-(r*(c*N-p*D)-u*(n*N-t*D)+O*(n*p-t*c)),e[15]=r*(c*A-p*C)-u*(n*A-t*C)+b*(n*p-t*c),e}function Sd(e){var i=e[0],r=e[1],n=e[2],t=e[3],o=e[4],u=e[5],c=e[6],p=e[7],m=e[8],b=e[9],C=e[10],A=e[11],P=e[12],O=e[13],D=e[14],N=e[15],j=i*u-r*o,ae=i*c-n*o,re=i*p-t*o,Te=r*c-n*u,Re=r*p-t*u,Ke=n*p-t*c,gt=m*O-b*P,lt=m*D-C*P,Ut=m*N-A*P,or=b*D-C*O,cr=b*N-A*O,Tr=C*N-A*D;return j*Tr-ae*cr+re*or+Te*Ut-Re*lt+Ke*gt}function Lu(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3],c=i[4],p=i[5],m=i[6],b=i[7],C=i[8],A=i[9],P=i[10],O=i[11],D=i[12],N=i[13],j=i[14],ae=i[15],re=r[0],Te=r[1],Re=r[2],Ke=r[3];return e[0]=re*n+Te*c+Re*C+Ke*D,e[1]=re*t+Te*p+Re*A+Ke*N,e[2]=re*o+Te*m+Re*P+Ke*j,e[3]=re*u+Te*b+Re*O+Ke*ae,re=r[4],Te=r[5],Re=r[6],Ke=r[7],e[4]=re*n+Te*c+Re*C+Ke*D,e[5]=re*t+Te*p+Re*A+Ke*N,e[6]=re*o+Te*m+Re*P+Ke*j,e[7]=re*u+Te*b+Re*O+Ke*ae,re=r[8],Te=r[9],Re=r[10],Ke=r[11],e[8]=re*n+Te*c+Re*C+Ke*D,e[9]=re*t+Te*p+Re*A+Ke*N,e[10]=re*o+Te*m+Re*P+Ke*j,e[11]=re*u+Te*b+Re*O+Ke*ae,re=r[12],Te=r[13],Re=r[14],Ke=r[15],e[12]=re*n+Te*c+Re*C+Ke*D,e[13]=re*t+Te*p+Re*A+Ke*N,e[14]=re*o+Te*m+Re*P+Ke*j,e[15]=re*u+Te*b+Re*O+Ke*ae,e}function kc(e,i,r){var n=r[0],t=r[1],o=r[2],u,c,p,m,b,C,A,P,O,D,N,j;return i===e?(e[12]=i[0]*n+i[4]*t+i[8]*o+i[12],e[13]=i[1]*n+i[5]*t+i[9]*o+i[13],e[14]=i[2]*n+i[6]*t+i[10]*o+i[14],e[15]=i[3]*n+i[7]*t+i[11]*o+i[15]):(u=i[0],c=i[1],p=i[2],m=i[3],b=i[4],C=i[5],A=i[6],P=i[7],O=i[8],D=i[9],N=i[10],j=i[11],e[0]=u,e[1]=c,e[2]=p,e[3]=m,e[4]=b,e[5]=C,e[6]=A,e[7]=P,e[8]=O,e[9]=D,e[10]=N,e[11]=j,e[12]=u*n+b*t+O*o+i[12],e[13]=c*n+C*t+D*o+i[13],e[14]=p*n+A*t+N*o+i[14],e[15]=m*n+P*t+j*o+i[15]),e}function zf(e,i,r){var n=r[0],t=r[1],o=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*t,e[5]=i[5]*t,e[6]=i[6]*t,e[7]=i[7]*t,e[8]=i[8]*o,e[9]=i[9]*o,e[10]=i[10]*o,e[11]=i[11]*o,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Zp(e,i,r,n){var t=n[0],o=n[1],u=n[2],c=Math.hypot(t,o,u),p,m,b,C,A,P,O,D,N,j,ae,re,Te,Re,Ke,gt,lt,Ut,or,cr,Tr,Sn,Un,Vi;return c<ki.Ib?null:(c=1/c,t*=c,o*=c,u*=c,p=Math.sin(r),m=Math.cos(r),b=1-m,C=i[0],A=i[1],P=i[2],O=i[3],D=i[4],N=i[5],j=i[6],ae=i[7],re=i[8],Te=i[9],Re=i[10],Ke=i[11],gt=t*t*b+m,lt=o*t*b+u*p,Ut=u*t*b-o*p,or=t*o*b-u*p,cr=o*o*b+m,Tr=u*o*b+t*p,Sn=t*u*b+o*p,Un=o*u*b-t*p,Vi=u*u*b+m,e[0]=C*gt+D*lt+re*Ut,e[1]=A*gt+N*lt+Te*Ut,e[2]=P*gt+j*lt+Re*Ut,e[3]=O*gt+ae*lt+Ke*Ut,e[4]=C*or+D*cr+re*Tr,e[5]=A*or+N*cr+Te*Tr,e[6]=P*or+j*cr+Re*Tr,e[7]=O*or+ae*cr+Ke*Tr,e[8]=C*Sn+D*Un+re*Vi,e[9]=A*Sn+N*Un+Te*Vi,e[10]=P*Sn+j*Un+Re*Vi,e[11]=O*Sn+ae*Un+Ke*Vi,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function dh(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[4],u=i[5],c=i[6],p=i[7],m=i[8],b=i[9],C=i[10],A=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=o*t+m*n,e[5]=u*t+b*n,e[6]=c*t+C*n,e[7]=p*t+A*n,e[8]=m*t-o*n,e[9]=b*t-u*n,e[10]=C*t-c*n,e[11]=A*t-p*n,e}function Yh(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[0],u=i[1],c=i[2],p=i[3],m=i[8],b=i[9],C=i[10],A=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*t-m*n,e[1]=u*t-b*n,e[2]=c*t-C*n,e[3]=p*t-A*n,e[8]=o*n+m*t,e[9]=u*n+b*t,e[10]=c*n+C*t,e[11]=p*n+A*t,e}function $h(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[0],u=i[1],c=i[2],p=i[3],m=i[4],b=i[5],C=i[6],A=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*t+m*n,e[1]=u*t+b*n,e[2]=c*t+C*n,e[3]=p*t+A*n,e[4]=m*t-o*n,e[5]=b*t-u*n,e[6]=C*t-c*n,e[7]=A*t-p*n,e}function tv(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Uv(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ku(e,i,r){var n=r[0],t=r[1],o=r[2],u=Math.hypot(n,t,o),c,p,m;return u<ki.Ib?null:(u=1/u,n*=u,t*=u,o*=u,c=Math.sin(i),p=Math.cos(i),m=1-p,e[0]=n*n*m+p,e[1]=t*n*m+o*c,e[2]=o*n*m-t*c,e[3]=0,e[4]=n*t*m-o*c,e[5]=t*t*m+p,e[6]=o*t*m+n*c,e[7]=0,e[8]=n*o*m+t*c,e[9]=t*o*m-n*c,e[10]=o*o*m+p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Cd(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Zv(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Pc(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Vv(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3],c=n+n,p=t+t,m=o+o,b=n*c,C=n*p,A=n*m,P=t*p,O=t*m,D=o*m,N=u*c,j=u*p,ae=u*m;return e[0]=1-(P+D),e[1]=C+ae,e[2]=A-j,e[3]=0,e[4]=C-ae,e[5]=1-(b+D),e[6]=O+N,e[7]=0,e[8]=A+j,e[9]=O-N,e[10]=1-(b+P),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function jv(e,i){var r=new ki.WT(3),n=-i[0],t=-i[1],o=-i[2],u=i[3],c=i[4],p=i[5],m=i[6],b=i[7],C=n*n+t*t+o*o+u*u;return C>0?(r[0]=(c*u+b*n+p*o-m*t)*2/C,r[1]=(p*u+b*t+m*n-c*o)*2/C,r[2]=(m*u+b*o+c*t-p*n)*2/C):(r[0]=(c*u+b*n+p*o-m*t)*2,r[1]=(p*u+b*t+m*n-c*o)*2,r[2]=(m*u+b*o+c*t-p*n)*2),Vv(e,i,r),e}function vh(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function mh(e,i){var r=i[0],n=i[1],t=i[2],o=i[4],u=i[5],c=i[6],p=i[8],m=i[9],b=i[10];return e[0]=Math.hypot(r,n,t),e[1]=Math.hypot(o,u,c),e[2]=Math.hypot(p,m,b),e}function qh(e,i){var r=new ki.WT(3);mh(r,i);var n=1/r[0],t=1/r[1],o=1/r[2],u=i[0]*n,c=i[1]*t,p=i[2]*o,m=i[4]*n,b=i[5]*t,C=i[6]*o,A=i[8]*n,P=i[9]*t,O=i[10]*o,D=u+b+O,N=0;return D>0?(N=Math.sqrt(D+1)*2,e[3]=.25*N,e[0]=(C-P)/N,e[1]=(A-p)/N,e[2]=(c-m)/N):u>b&&u>O?(N=Math.sqrt(1+u-b-O)*2,e[3]=(C-P)/N,e[0]=.25*N,e[1]=(c+m)/N,e[2]=(A+p)/N):b>O?(N=Math.sqrt(1+b-u-O)*2,e[3]=(A-p)/N,e[0]=(c+m)/N,e[1]=.25*N,e[2]=(C+P)/N):(N=Math.sqrt(1+O-u-b)*2,e[3]=(c-m)/N,e[0]=(A+p)/N,e[1]=(C+P)/N,e[2]=.25*N),e}function Kh(e,i,r,n){var t=i[0],o=i[1],u=i[2],c=i[3],p=t+t,m=o+o,b=u+u,C=t*p,A=t*m,P=t*b,O=o*m,D=o*b,N=u*b,j=c*p,ae=c*m,re=c*b,Te=n[0],Re=n[1],Ke=n[2];return e[0]=(1-(O+N))*Te,e[1]=(A+re)*Te,e[2]=(P-ae)*Te,e[3]=0,e[4]=(A-re)*Re,e[5]=(1-(C+N))*Re,e[6]=(D+j)*Re,e[7]=0,e[8]=(P+ae)*Ke,e[9]=(D-j)*Ke,e[10]=(1-(C+O))*Ke,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Qh(e,i,r,n,t){var o=i[0],u=i[1],c=i[2],p=i[3],m=o+o,b=u+u,C=c+c,A=o*m,P=o*b,O=o*C,D=u*b,N=u*C,j=c*C,ae=p*m,re=p*b,Te=p*C,Re=n[0],Ke=n[1],gt=n[2],lt=t[0],Ut=t[1],or=t[2],cr=(1-(D+j))*Re,Tr=(P+Te)*Re,Sn=(O-re)*Re,Un=(P-Te)*Ke,Vi=(1-(A+j))*Ke,Ba=(N+ae)*Ke,ho=(O+re)*gt,Ao=(N-ae)*gt,Wo=(1-(A+D))*gt;return e[0]=cr,e[1]=Tr,e[2]=Sn,e[3]=0,e[4]=Un,e[5]=Vi,e[6]=Ba,e[7]=0,e[8]=ho,e[9]=Ao,e[10]=Wo,e[11]=0,e[12]=r[0]+lt-(cr*lt+Un*Ut+ho*or),e[13]=r[1]+Ut-(Tr*lt+Vi*Ut+Ao*or),e[14]=r[2]+or-(Sn*lt+Ba*Ut+Wo*or),e[15]=1,e}function Gv(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=r+r,c=n+n,p=t+t,m=r*u,b=n*u,C=n*c,A=t*u,P=t*c,O=t*p,D=o*u,N=o*c,j=o*p;return e[0]=1-C-O,e[1]=b+j,e[2]=A-N,e[3]=0,e[4]=b-j,e[5]=1-m-O,e[6]=P+D,e[7]=0,e[8]=A+N,e[9]=P-D,e[10]=1-m-C,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Hv(e,i,r,n,t,o,u){var c=1/(r-i),p=1/(t-n),m=1/(o-u);return e[0]=o*2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*p,e[6]=0,e[7]=0,e[8]=(r+i)*c,e[9]=(t+n)*p,e[10]=(u+o)*m,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*o*2*m,e[15]=0,e}function rv(e,i,r,n,t){var o=1/Math.tan(i/2),u;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==Infinity?(u=1/(n-t),e[10]=(t+n)*u,e[14]=2*t*n*u):(e[10]=-1,e[14]=-2*n),e}var wd=rv;function nv(e,i,r,n,t){var o=1/Math.tan(i/2),u;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==Infinity?(u=1/(n-t),e[10]=t*u,e[14]=t*n*u):(e[10]=-1,e[14]=-n),e}function iv(e,i,r,n){var t=Math.tan(i.upDegrees*Math.PI/180),o=Math.tan(i.downDegrees*Math.PI/180),u=Math.tan(i.leftDegrees*Math.PI/180),c=Math.tan(i.rightDegrees*Math.PI/180),p=2/(u+c),m=2/(t+o);return e[0]=p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=m,e[6]=0,e[7]=0,e[8]=-((u-c)*p*.5),e[9]=(t-o)*m*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Lc(e,i,r,n,t,o,u){var c=1/(i-r),p=1/(n-t),m=1/(o-u);return e[0]=-2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*m,e[11]=0,e[12]=(i+r)*c,e[13]=(t+n)*p,e[14]=(u+o)*m,e[15]=1,e}var Wv=Lc;function av(e,i,r,n,t,o,u){var c=1/(i-r),p=1/(n-t),m=1/(o-u);return e[0]=-2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=m,e[11]=0,e[12]=(i+r)*c,e[13]=(t+n)*p,e[14]=o*m,e[15]=1,e}function Ad(e,i,r,n){var t,o,u,c,p,m,b,C,A,P,O=i[0],D=i[1],N=i[2],j=n[0],ae=n[1],re=n[2],Te=r[0],Re=r[1],Ke=r[2];return Math.abs(O-Te)<ki.Ib&&Math.abs(D-Re)<ki.Ib&&Math.abs(N-Ke)<ki.Ib?zp(e):(b=O-Te,C=D-Re,A=N-Ke,P=1/Math.hypot(b,C,A),b*=P,C*=P,A*=P,t=ae*A-re*C,o=re*b-j*A,u=j*C-ae*b,P=Math.hypot(t,o,u),P?(P=1/P,t*=P,o*=P,u*=P):(t=0,o=0,u=0),c=C*u-A*o,p=A*t-b*u,m=b*o-C*t,P=Math.hypot(c,p,m),P?(P=1/P,c*=P,p*=P,m*=P):(c=0,p=0,m=0),e[0]=t,e[1]=c,e[2]=b,e[3]=0,e[4]=o,e[5]=p,e[6]=C,e[7]=0,e[8]=u,e[9]=m,e[10]=A,e[11]=0,e[12]=-(t*O+o*D+u*N),e[13]=-(c*O+p*D+m*N),e[14]=-(b*O+C*D+A*N),e[15]=1,e)}function Xv(e,i,r,n){var t=i[0],o=i[1],u=i[2],c=n[0],p=n[1],m=n[2],b=t-r[0],C=o-r[1],A=u-r[2],P=b*b+C*C+A*A;P>0&&(P=1/Math.sqrt(P),b*=P,C*=P,A*=P);var O=p*A-m*C,D=m*b-c*A,N=c*C-p*b;return P=O*O+D*D+N*N,P>0&&(P=1/Math.sqrt(P),O*=P,D*=P,N*=P),e[0]=O,e[1]=D,e[2]=N,e[3]=0,e[4]=C*N-A*D,e[5]=A*O-b*N,e[6]=b*D-C*O,e[7]=0,e[8]=b,e[9]=C,e[10]=A,e[11]=0,e[12]=t,e[13]=o,e[14]=u,e[15]=1,e}function ov(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Yv(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function $v(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function Td(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function qv(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function Vp(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function Kv(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Jh(e,i){var r=e[0],n=e[1],t=e[2],o=e[3],u=e[4],c=e[5],p=e[6],m=e[7],b=e[8],C=e[9],A=e[10],P=e[11],O=e[12],D=e[13],N=e[14],j=e[15],ae=i[0],re=i[1],Te=i[2],Re=i[3],Ke=i[4],gt=i[5],lt=i[6],Ut=i[7],or=i[8],cr=i[9],Tr=i[10],Sn=i[11],Un=i[12],Vi=i[13],Ba=i[14],ho=i[15];return Math.abs(r-ae)<=ki.Ib*Math.max(1,Math.abs(r),Math.abs(ae))&&Math.abs(n-re)<=ki.Ib*Math.max(1,Math.abs(n),Math.abs(re))&&Math.abs(t-Te)<=ki.Ib*Math.max(1,Math.abs(t),Math.abs(Te))&&Math.abs(o-Re)<=ki.Ib*Math.max(1,Math.abs(o),Math.abs(Re))&&Math.abs(u-Ke)<=ki.Ib*Math.max(1,Math.abs(u),Math.abs(Ke))&&Math.abs(c-gt)<=ki.Ib*Math.max(1,Math.abs(c),Math.abs(gt))&&Math.abs(p-lt)<=ki.Ib*Math.max(1,Math.abs(p),Math.abs(lt))&&Math.abs(m-Ut)<=ki.Ib*Math.max(1,Math.abs(m),Math.abs(Ut))&&Math.abs(b-or)<=ki.Ib*Math.max(1,Math.abs(b),Math.abs(or))&&Math.abs(C-cr)<=ki.Ib*Math.max(1,Math.abs(C),Math.abs(cr))&&Math.abs(A-Tr)<=ki.Ib*Math.max(1,Math.abs(A),Math.abs(Tr))&&Math.abs(P-Sn)<=ki.Ib*Math.max(1,Math.abs(P),Math.abs(Sn))&&Math.abs(O-Un)<=ki.Ib*Math.max(1,Math.abs(O),Math.abs(Un))&&Math.abs(D-Vi)<=ki.Ib*Math.max(1,Math.abs(D),Math.abs(Vi))&&Math.abs(N-Ba)<=ki.Ib*Math.max(1,Math.abs(N),Math.abs(Ba))&&Math.abs(j-ho)<=ki.Ib*Math.max(1,Math.abs(j),Math.abs(ho))}var H0=Lu,Qv=Td,Jv,e0,W0=(Jv=(0,Jr.b2)(),Jv(e0=function(){function e(){(0,vt.Z)(this,e),(0,T.Z)(this,"viewport",void 0),(0,T.Z)(this,"overridedViewProjectionMatrix",void 0),(0,T.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,T.Z)(this,"jitteredProjectionMatrix",void 0),(0,T.Z)(this,"viewMatrixInverse",void 0),(0,T.Z)(this,"cameraPosition",void 0)}return(0,yt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Ho(),ph(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,ce.Z)(r,2),t=n[0],o=n[1];return[t,o]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var t=tv(Ho(),[r,n,0]);this.jitteredProjectionMatrix=Lu(Ho(),t,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Lu(Ho(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||e0),t0,r0;function X0(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Y0(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var m=r.next();return o=m.done,m},e:function(m){u=!0,c=m},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function Y0(e,i){if(!!e){if(typeof e=="string")return n0(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n0(e,i)}}function n0(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Rc=(t0=(0,Jr.b2)(),t0(r0=function(){function e(){(0,vt.Z)(this,e),(0,T.Z)(this,"container",void 0),(0,T.Z)(this,"controlCorners",void 0),(0,T.Z)(this,"controlContainer",void 0),(0,T.Z)(this,"scene",void 0),(0,T.Z)(this,"mapsService",void 0),(0,T.Z)(this,"controls",[]),(0,T.Z)(this,"unAddControls",[])}return(0,yt.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(Ft.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var t=n.get(Ft.IMapService);t.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=X0(this.controls),n;try{for(r.s();!(n=r.n()).done;){var t=n.value;t.remove()}}catch(o){r.e(o)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",t=this.controlContainer=Ia("div",n+"control-container",this.container);function o(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],c=u.map(function(p){return n+p}).join(" ");r[u.join("")]=Ia("div",c,t)}o(["top","left"]),o(["top","right"]),o(["bottom","left"]),o(["bottom","right"]),o(["top","center"]),o(["right","center"]),o(["left","center"]),o(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&Zu(this.controlCorners[r]);this.controlContainer&&Zu(this.controlContainer)}}]),e}())||r0),jp,sv,Gp=(jp=(0,Jr.b2)(),jp(sv=function(){function e(){(0,vt.Z)(this,e),(0,T.Z)(this,"container",void 0),(0,T.Z)(this,"scene",void 0),(0,T.Z)(this,"mapsService",void 0),(0,T.Z)(this,"markers",[]),(0,T.Z)(this,"markerLayers",[]),(0,T.Z)(this,"unAddMarkers",[]),(0,T.Z)(this,"unAddMarkerLayers",[])}return(0,yt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Ft.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||sv),uv,qm,Z2=(uv=(0,Jr.b2)(),uv(qm=function(){function e(){(0,vt.Z)(this,e),(0,T.Z)(this,"scene",void 0),(0,T.Z)(this,"popup",void 0),(0,T.Z)(this,"mapsService",void 0),(0,T.Z)(this,"unAddPopup",void 0)}return(0,yt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Ft.IMapService)}}]),e}())||qm),V2={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},j2=V2,Km,Qm,G2={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},H2={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},W2=(Km=(0,Jr.b2)(),Km(Qm=function(){function e(){(0,vt.Z)(this,e),(0,T.Z)(this,"sceneConfigCache",{}),(0,T.Z)(this,"layerConfigCache",{})}return(0,yt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return j2[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=(0,oe.Z)((0,oe.Z)({},G2),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,t){this.layerConfigCache[n]=(0,oe.Z)({},(0,Er.merge)({},this.sceneConfigCache[r],H2,t))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Qm);function na(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function ta(e,i,r,n,t){var o={};return Object.keys(n).forEach(function(u){o[u]=n[u]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(u,c){return c(e,i,u)||u},o),t&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(t):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,i,o),o=null),o}function Jm(){var e=new ki.WT(4);return ki.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function VL(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function X2(e,i,r,n){var t=new ki.WT(4);return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function jL(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function GL(e,i,r,n,t){return e[0]=i,e[1]=r,e[2]=n,e[3]=t,e}function HL(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function WL(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function XL(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function YL(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function $L(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function qL(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function KL(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function QL(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function JL(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function Y2(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function eR(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function tR(e,i){var r=i[0]-e[0],n=i[1]-e[1],t=i[2]-e[2],o=i[3]-e[3];return Math.hypot(r,n,t,o)}function rR(e,i){var r=i[0]-e[0],n=i[1]-e[1],t=i[2]-e[2],o=i[3]-e[3];return r*r+n*n+t*t+o*o}function nR(e){var i=e[0],r=e[1],n=e[2],t=e[3];return Math.hypot(i,r,n,t)}function iR(e){var i=e[0],r=e[1],n=e[2],t=e[3];return i*i+r*r+n*n+t*t}function aR(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function oR(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function sR(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=r*r+n*n+t*t+o*o;return u>0&&(u=1/Math.sqrt(u)),e[0]=r*u,e[1]=n*u,e[2]=t*u,e[3]=o*u,e}function uR(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function lR(e,i,r,n){var t=r[0]*n[1]-r[1]*n[0],o=r[0]*n[2]-r[2]*n[0],u=r[0]*n[3]-r[3]*n[0],c=r[1]*n[2]-r[2]*n[1],p=r[1]*n[3]-r[3]*n[1],m=r[2]*n[3]-r[3]*n[2],b=i[0],C=i[1],A=i[2],P=i[3];return e[0]=C*m-A*p+P*c,e[1]=-(b*m)+A*u-P*o,e[2]=b*p-C*u+P*t,e[3]=-(b*c)+C*o-A*t,e}function cR(e,i,r,n){var t=i[0],o=i[1],u=i[2],c=i[3];return e[0]=t+n*(r[0]-t),e[1]=o+n*(r[1]-o),e[2]=u+n*(r[2]-u),e[3]=c+n*(r[3]-c),e}function fR(e,i){i=i||1;var r,n,t,o,u,c;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,u=r*r+n*n;while(u>=1);do t=glMatrix.RANDOM()*2-1,o=glMatrix.RANDOM()*2-1,c=t*t+o*o;while(c>=1);var p=Math.sqrt((1-u)/c);return e[0]=i*r,e[1]=i*n,e[2]=i*t*p,e[3]=i*o*p,e}function $0(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3];return e[0]=r[0]*n+r[4]*t+r[8]*o+r[12]*u,e[1]=r[1]*n+r[5]*t+r[9]*o+r[13]*u,e[2]=r[2]*n+r[6]*t+r[10]*o+r[14]*u,e[3]=r[3]*n+r[7]*t+r[11]*o+r[15]*u,e}function hR(e,i,r){var n=i[0],t=i[1],o=i[2],u=r[0],c=r[1],p=r[2],m=r[3],b=m*n+c*o-p*t,C=m*t+p*n-u*o,A=m*o+u*t-c*n,P=-u*n-c*t-p*o;return e[0]=b*m+P*-u+C*-p-A*-c,e[1]=C*m+P*-c+A*-u-b*-p,e[2]=A*m+P*-p+b*-c-C*-u,e[3]=i[3],e}function pR(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function dR(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function vR(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function mR(e,i){var r=e[0],n=e[1],t=e[2],o=e[3],u=i[0],c=i[1],p=i[2],m=i[3];return Math.abs(r-u)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-c)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(t-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(p))&&Math.abs(o-m)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))}var gR=null,yR=null,_R=null,xR=null,bR=null,ER=null,SR=null,CR=function(){var e=Jm();return function(i,r,n,t,o,u){var c,p;for(r||(r=4),n||(n=0),t?p=Math.min(t*r+n,i.length):p=i.length,c=n;c<p;c+=r)e[0]=i[c],e[1]=i[c+1],e[2]=i[c+2],e[3]=i[c+3],o(e,e,u),i[c]=e[0],i[c+1]=e[1],i[c+2]=e[2],i[c+3]=e[3];return i}}(),q0=Math.PI/180,$2=512,eg=4003e4;function tg(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,t=n===void 0?0:n,o=e.scale,u=e.highPrecision,c=u===void 0?!1:u,p=e.flipY,m=p===void 0?!1:p;o=o!==void 0?o:Math.pow(2,t);var b={},C=$2*o,A=Math.cos(r*q0),P=C/360,O=P/A,D=C/eg/A;if(b.pixelsPerMeter=[D,-D,D],b.metersPerPixel=[1/D,-1/D,1/D],b.pixelsPerDegree=[P,-O,D],b.degreesPerPixel=[1/P,-1/O,1/D],c){var N=q0*Math.tan(r*q0)/A,j=P*N/2,ae=C/eg*N,re=ae/O*D;b.pixelsPerDegree2=[0,-j,ae],b.pixelsPerMeter2=[re,0,re],m&&(b.pixelsPerDegree2[1]=-b.pixelsPerDegree2[1],b.pixelsPerMeter2[1]=-b.pixelsPerMeter2[1])}return m&&(b.pixelsPerMeter[1]=-b.pixelsPerMeter[1],b.metersPerPixel[1]=-b.metersPerPixel[1],b.pixelsPerDegree[1]=-b.pixelsPerDegree[1],b.degreesPerPixel[1]=-b.degreesPerPixel[1]),b}var Oc;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Oc||(Oc={}));var Hp={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},rg,ng,ig,K0,ag,q2=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],K2=(rg=(0,Jr.b2)(),ng=(0,Jr.f3)(Ft.ICameraService),rg(ig=(K0=function(){function e(){(0,vt.Z)(this,e),(0,T.Z)(this,"needRefresh",!0),na(this,"cameraService",ag,this),(0,T.Z)(this,"coordinateSystem",void 0),(0,T.Z)(this,"viewportCenter",void 0),(0,T.Z)(this,"viewportCenterProjection",void 0),(0,T.Z)(this,"pixelsPerDegree",void 0),(0,T.Z)(this,"pixelsPerDegree2",void 0),(0,T.Z)(this,"pixelsPerMeter",void 0)}return(0,yt.Z)(e,[{key:"refresh",value:function(r){var n=this.cameraService.getZoom(),t=this.cameraService.getZoomScale(),o=r||this.cameraService.getCenter(),u=tg({latitude:o[1],zoom:n}),c=u.pixelsPerMeter,p=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=c,this.pixelsPerDegree=p,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Oc.LNGLAT||this.coordinateSystem===Oc.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Oc.LNGLAT_OFFSET?this.calculateLnglatOffset(o,n):this.coordinateSystem===Oc.P20_OFFSET&&this.calculateLnglatOffset(o,n,t,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,t,o){var u=tg({latitude:r[1],zoom:n,scale:t,flipY:o,highPrecision:!0}),c=u.pixelsPerMeter,p=u.pixelsPerDegree,m=u.pixelsPerDegree2,b=this.cameraService.getViewMatrix(),C=this.cameraService.getProjectionMatrix(),A=Lu([],C,b),P=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=$0([],[P[0],P[1],0,1],A),b=this.cameraService.getViewMatrixUncentered()||b,A=Lu([],C,b),A=Lu([],A,q2),this.cameraService.setViewProjectionMatrix(A),this.pixelsPerMeter=c,this.pixelsPerDegree=p,this.pixelsPerDegree2=m}}]),e}(),ag=ta(K0.prototype,"cameraService",[ng],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K0))||ig),Q2=fe(20396),lv=fe.n(Q2),Ru;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Ru||(Ru={}));var og,sg,ug,Q0,lg;function J2(e){var i=eE();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function eE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tE={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},rE=(og=(0,Jr.b2)(),sg=(0,Jr.f3)(Ft.IMapService),og(ug=(Q0=function(e){(0,hr.Z)(r,e);var i=J2(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"indragging",!1),na((0,$e.Z)(n),"mapService",lg,(0,$e.Z)(n)),(0,T.Z)((0,$e.Z)(n),"hammertime",void 0),(0,T.Z)((0,$e.Z)(n),"lastClickTime",0),(0,T.Z)((0,$e.Z)(n),"lastClickXY",[-1,-1]),(0,T.Z)((0,$e.Z)(n),"clickTimer",void 0),(0,T.Z)((0,$e.Z)(n),"$containter",void 0),(0,T.Z)((0,$e.Z)(n),"onDrag",function(c){var p=n.interactionEvent(c);p.type=tE[p.type],p.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(Ru.Drag,p)}),(0,T.Z)((0,$e.Z)(n),"onHammer",function(c){c.srcEvent.stopPropagation();var p=n.interactionEvent(c);n.emit(Ru.Hover,p)}),(0,T.Z)((0,$e.Z)(n),"onTouch",function(c){var p=c.touches[0];n.onHover({x:p.pageX,y:p.pageY,type:"touch"})}),(0,T.Z)((0,$e.Z)(n),"onHover",function(c){var p=c.clientX,m=c.clientY,b=p,C=m,A=c.type,P=n.mapService.getMapContainer();if(P)if(as)b=b-P.left-0,C=C-P.top-0;else{var O=P.getBoundingClientRect(),D=O.top,N=O.left;b=b-N-P.clientLeft,C=C-D-P.clientTop}var j=n.mapService.containerToLngLat([b,C]);if(A==="click"){if(!as&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(b,C,j);return}if(A==="touch"){n.isDoubleTap(b,C,j);return}A!=="click"&&A!=="dblclick"&&n.emit(Ru.Hover,{x:b,y:C,lngLat:j,type:A,target:c})}),n}return(0,yt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Ru.Hover)}},{key:"triggerHover",value:function(t){var o=t.x,u=t.y;this.emit(Ru.Hover,{x:o,y:u})}},{key:"triggerSelect",value:function(t){this.emit(Ru.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(Ru.Active,{featureId:t})}},{key:"handleMiniEvent",value:function(t){this.onHover({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();if(t)if(as)ha.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=new(lv()).Manager(t);o.add(new(lv()).Tap({event:"dblclick",taps:2})),o.add(new(lv()).Tap({event:"click"})),o.add(new(lv()).Pan({threshold:0,pointers:0})),o.add(new(lv()).Press({})),o.on("dblclick click",this.onHammer),o.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("mousemove",this.onHover),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=o}}},{key:"removeEventListenerOnMap",value:function(){if(as)ha.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(t){var o=t.type,u=t.pointerType,c,p;u==="touch"?(p=Math.floor(t.pointers[0].clientY),c=Math.floor(t.pointers[0].clientX)):(p=Math.floor(t.srcEvent.y),c=Math.floor(t.srcEvent.x));var m=this.mapService.getMapContainer();if(m){var b=m.getBoundingClientRect(),C=b.top,A=b.left;c-=A,p-=C}var P=this.mapService.containerToLngLat([c,p]);return{x:c,y:p,lngLat:P,type:o,target:t.srcEvent}}},{key:"isDoubleTap",value:function(t,o,u){var c=this,p=new Date().getTime(),m="click";p-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-o)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),m="dblclick",this.emit(Ru.Hover,{x:t,y:o,lngLat:u,type:m})):(this.lastClickTime=p,this.lastClickXY=[t,o],this.clickTimer=setTimeout(function(){m="click",c.emit(Ru.Hover,{x:t,y:o,lngLat:u,type:m})},400))}}]),r}(sh()),lg=ta(Q0.prototype,"mapService",[sg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q0))||ug),nE=0;function iE(e){if(as)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(nE++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function aE(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(t){if(t!=null&&t.classList){var o;t==null||(o=t.classList)===null||o===void 0||o.forEach(function(u){(u==="l7-marker"||u==="l7-popup")&&(n=!1)})}}),n}var H;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(H||(H={}));var cg,fg,hg,pg,dg,vg,mg,Wp,gg,yg,_g,xg,bg,oE=(cg=(0,Jr.b2)(),fg=(0,Jr.f3)(Ft.IMapService),hg=(0,Jr.f3)(Ft.IRendererService),pg=(0,Jr.f3)(Ft.IGlobalConfigService),dg=(0,Jr.f3)(Ft.IInteractionService),vg=(0,Jr.f3)(Ft.ILayerService),cg(mg=(Wp=function(){function e(){var i=this;(0,vt.Z)(this,e),(0,T.Z)(this,"pickedColors",void 0),(0,T.Z)(this,"pickedTileLayers",[]),na(this,"mapService",gg,this),na(this,"rendererService",yg,this),na(this,"configService",_g,this),na(this,"interactionService",xg,this),na(this,"layerService",bg,this),(0,T.Z)(this,"pickingFBO",void 0),(0,T.Z)(this,"width",0),(0,T.Z)(this,"height",0),(0,T.Z)(this,"alreadyInPicking",!1),(0,T.Z)(this,"pickBufferScale",1),(0,T.Z)(this,"pickFromPickingFBO",function(r,n){var t=n.x,o=n.y,u=n.lngLat,c=n.type,p=n.target,m=!1,b=i.rendererService,C=b.readPixels,A=b.getContainer,P=i.getContainerSize(A()),O=P.width,D=P.height;O*=Da,D*=Da;var N=r.getLayerConfig(),j=N.enableHighlight,ae=N.enableSelect,re=t*Da,Te=o*Da;if(re>O-1*Da||re<0||Te>D-1*Da||Te<0)return!1;var Re=C({x:Math.floor(re/i.pickBufferScale),y:Math.floor((D-(o+1)*Da)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO});if(i.pickedColors=Re,Re[0]!==0||Re[1]!==0||Re[2]!==0){var Ke=g(Re),gt=r.getSource().getFeatureById(Ke);Ke!==r.getCurrentPickId()&&c==="mousemove"&&(c="mouseenter");var lt={x:t,y:o,type:c,lngLat:u,featureId:Ke,feature:gt,target:p};gt&&(m=!0,r.setCurrentPickId(Ke),i.triggerHoverOnLayer(r,lt))}else{var Ut={x:t,y:o,lngLat:u,type:r.getCurrentPickId()!==null&&c==="mousemove"?"mouseout":"un"+c,featureId:null,target:p,feature:null};i.triggerHoverOnLayer(r,(0,oe.Z)((0,oe.Z)({},Ut),{},{type:"unpick"})),i.triggerHoverOnLayer(r,Ut),r.setCurrentPickId(null)}if(j&&i.highlightPickedFeature(r,Re),ae&&c==="click"&&(Re==null?void 0:Re.toString())!==[0,0,0,0].toString()){var or=g(Re);r.getCurrentSelectedId()===null||or!==r.getCurrentSelectedId()?(i.selectFeature(r,Re),r.setCurrentSelectedId(or)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null)),r.isVector||i.layerService.getLayers().filter(function(cr){return cr.tileLayer}).map(function(cr){cr.tileLayer.clearPickState()})}return m})}return(0,yt.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,t=n.createTexture2D,o=n.createFramebuffer,u=n.getContainer,c=this.getContainerSize(u()),p=c.width,m=c.height;p*=Da,m*=Da,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=o({color:t({width:Math.round(p/this.pickBufferScale),height:Math.round(m/this.pickBufferScale),wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE})}),this.interactionService.on(Ru.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,ue.Z)(te().mark(function n(t,o,u){var c=this,p,m,b;return te().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:p=this.rendererService,m=p.useFramebuffer,b=p.clear,this.resizePickingFBO(),m(this.pickingFBO,function(){b({framebuffer:c.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.hooks.beforePickingEncode.call(),t.renderModels(),t.hooks.afterPickingEncode.call();var P=c.pickBox(t,o);u(P)});case 3:case"end":return A.stop()}},n,this)}));function r(n,t,o){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var t=this,o=n.map(function(or){var cr=or<0?0:or;return Math.floor(cr*Da/t.pickBufferScale)}),u=(0,ce.Z)(o,4),c=u[0],p=u[1],m=u[2],b=u[3],C=this.rendererService,A=C.readPixels,P=C.getContainer,O=this.getContainerSize(P()),D=O.width,N=O.height;if(D*=Da,N*=Da,c>(D-1)*Da/this.pickBufferScale||m<0||p>(N-1)*Da/this.pickBufferScale||b<0)return[];for(var j=Math.min(D/this.pickBufferScale,m)-c,ae=Math.min(N/this.pickBufferScale,b)-p,re=A({x:c,y:Math.floor(N/this.pickBufferScale-(b+1)),width:j,height:ae,data:new Uint8Array(j*ae*4),framebuffer:this.pickingFBO}),Te=[],Re={},Ke=0;Ke<re.length/4;Ke=Ke+1){var gt=re.slice(Ke*4,Ke*4+4),lt=g(gt);if(lt!==-1&&!Re[lt]){var Ut=r.getSource().getFeatureById(lt);Te.push((0,oe.Z)((0,oe.Z)({},Ut),{},{pickedFeatureIdx:lt})),Re[lt]=!0}}return Te}},{key:"handleCursor",value:function(r,n){var t=r.getLayerConfig(),o=t.cursor,u=o===void 0?"":o,c=t.cursorEnabled;if(c){var p=this.mapService.version,m=p==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),b=m==null?void 0:m.style.getPropertyValue("cursor");n==="unmousemove"&&b!==""?m==null||m.style.setProperty("cursor",""):n==="mousemove"&&(m==null||m.style.setProperty("cursor",u))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/Da,height:r.height/Da}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,ue.Z)(te().mark(function n(t){return te().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.isPickingAllLayer()){u.next=2;break}return u.abrupt("return");case 2:return this.alreadyInPicking=!0,u.next=5,this.pickingLayers(t);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),t=n.width,o=n.height;t*=Da,o*=Da,(this.width!==t||this.height!==o)&&(this.pickingFBO.resize({width:Math.round(t/this.pickBufferScale),height:Math.round(o/this.pickBufferScale)}),this.width=t,this.height=o)}},{key:"pickingLayers",value:function(){var i=(0,ue.Z)(te().mark(function n(t){var o=this,u,c,p;return te().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:u=this.rendererService,c=u.useFramebuffer,p=u.clear,this.resizePickingFBO(),c(this.pickingFBO,function(){var C=o.layerService.getRenderList();C.filter(function(A){return A.needPick(t.type)}).reverse().some(function(A){if(p({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.pickedTileLayers.map(function(O){var D;return(D=O.tileLayer)===null||D===void 0?void 0:D.clearPick(t.type)}),A.tileLayer&&A.tileLayer.pickLayers)return A.tileLayer.pickLayers(t);A.hooks.beforePickingEncode.call(),A.masks.length>0&&A.masks.map(function(O){O.hooks.beforeRenderData.call(),O.hooks.beforeRender.call(),O.render(),O.hooks.afterRender.call()}),A.renderModels(!0),A.hooks.afterPickingEncode.call();var P=o.pickFromPickingFBO(A,t);return o.layerService.pickedLayerId=P?+A.id:-1,P&&!A.getLayerConfig().enablePropagation})});case 3:case"end":return b.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){aE(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(r,n){var t=(0,ce.Z)(n,3),o=t[0],u=t[1],c=t[2];r.hooks.beforeHighlight.call([o,u,c])}},{key:"selectFeature",value:function(r,n){var t=(0,ce.Z)(n,3),o=t[0],u=t[1],c=t[2];r.hooks.beforeSelect.call([o,u,c])}}]),e}(),gg=ta(Wp.prototype,"mapService",[fg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yg=ta(Wp.prototype,"rendererService",[hg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_g=ta(Wp.prototype,"configService",[pg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xg=ta(Wp.prototype,"interactionService",[dg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bg=ta(Wp.prototype,"layerService",[vg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wp))||mg),sE=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,vt.Z)(this,e),(0,T.Z)(this,"autoStart",void 0),(0,T.Z)(this,"startTime",0),(0,T.Z)(this,"oldTime",0),(0,T.Z)(this,"running",!1),(0,T.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,yt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),Eg,Sg,Cg,wg,i0,Ag,Tg;function uE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=lE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var m=r.next();return o=m.done,m},e:function(m){u=!0,c=m},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function lE(e,i){if(!!e){if(typeof e=="string")return Mg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Mg(e,i)}}function Mg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var cE=(Eg=(0,Jr.b2)(),Sg=(0,Jr.f3)(Ft.IRendererService),Cg=(0,Jr.f3)(Ft.IMapService),Eg(wg=(i0=function(){function e(){var i=this;(0,vt.Z)(this,e),(0,T.Z)(this,"pickedLayerId",-1),(0,T.Z)(this,"clock",new sE),(0,T.Z)(this,"alreadyInRendering",!1),(0,T.Z)(this,"layers",[]),(0,T.Z)(this,"layerList",[]),(0,T.Z)(this,"layerRenderID",void 0),(0,T.Z)(this,"sceneInited",!1),(0,T.Z)(this,"animateInstanceCount",0),(0,T.Z)(this,"shaderPicking",!0),(0,T.Z)(this,"enableRender",!0),na(this,"renderService",Ag,this),na(this,"mapService",Tg,this),(0,T.Z)(this,"reRender",(0,Er.throttle)(function(){i.updateLayerRenderList(),i.renderLayers()},32)),(0,T.Z)(this,"throttleRenderLayers",(0,Er.throttle)(function(){i.renderLayers()},16))}return(0,yt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"addMask",value:function(r){this.sceneInited&&r.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=this.layers.indexOf(r);t>-1&&this.layers.splice(t,1),n&&this.throttleRenderLayers()}},{key:"remove",value:function(r,n){if(n){var t=n.layerChildren.indexOf(r);t>-1&&n.layerChildren.splice(t,1)}else{var o=this.layers.indexOf(r);o>-1&&this.layers.splice(o,1)}this.updateLayerRenderList(),r.destroy()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var i=(0,ue.Z)(te().mark(function n(){var t,o,u;return te().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){p.next=2;break}return p.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),t=uE(this.layerList),p.prev=5,t.s();case 7:if((o=t.n()).done){p.next=21;break}if(u=o.value,u.hooks.beforeRenderData.call(),u.hooks.beforeRender.call(),u.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),u.masks.map(function(m){m.hooks.beforeRenderData.call(),m.hooks.beforeRender.call(),m.render(),m.hooks.afterRender.call()})),!u.getLayerConfig().enableMultiPassRenderer){p.next=17;break}return p.next=15,u.renderMultiPass();case 15:p.next=18;break;case 17:u.render();case 18:u.hooks.afterRender.call();case 19:p.next=7;break;case 21:p.next=26;break;case 23:p.prev=23,p.t0=p.catch(5),t.e(p.t0);case 26:return p.prev=26,t.f(),p.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return p.stop()}},n,this,[[5,23,26,29]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).sort(function(n,t){return n.zIndex-t.zIndex}).forEach(function(n){r.layerList.push(n)})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var r=h(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=ha.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){ha.cancelAnimationFrame(this.layerRenderID)}}]),e}(),Ag=ta(i0.prototype,"renderService",[Sg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tg=ta(i0.prototype,"mapService",[Cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i0))||wg),sf=fe(81253),fE=function(){function e(i){var r=this;(0,vt.Z)(this,e),(0,T.Z)(this,"name",void 0),(0,T.Z)(this,"type",void 0),(0,T.Z)(this,"scale",void 0),(0,T.Z)(this,"descriptor",void 0),(0,T.Z)(this,"featureBufferLayout",[]),(0,T.Z)(this,"needRescale",!1),(0,T.Z)(this,"needRemapping",!1),(0,T.Z)(this,"needRegenerateVertices",!1),(0,T.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,T.Z)(this,"vertexAttribute",void 0),(0,T.Z)(this,"defaultCallback",function(n){if(n.length===0){var t;return((t=r.scale)===null||t===void 0?void 0:t.defaultValues)||[]}return n.map(function(o,u){var c,p=(c=r.scale)===null||c===void 0?void 0:c.scalers[u].func,m=p(o);return m})}),this.setProps(i)}return(0,yt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var t,o=(t=this.scale)===null||t===void 0?void 0:t.callback.apply(t,(0,ee.Z)(r));if(!(0,Er.isNil)(o))return[o]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),hE=["modelType"],pE=["buffer","update","name"],dE=["buffer","update","name"],vE=["buffer","update","name"],cv,Ig,kg,Pg,J0,Lg,mE=(cv={},(0,T.Z)(cv,H.FLOAT,4),(0,T.Z)(cv,H.UNSIGNED_BYTE,1),(0,T.Z)(cv,H.UNSIGNED_SHORT,2),cv),gE=(Ig=(0,Jr.b2)(),kg=(0,Jr.f3)(Ft.IRendererService),Ig(Pg=(J0=function(){function e(){(0,vt.Z)(this,e),(0,T.Z)(this,"attributesAndIndices",void 0),na(this,"rendererService",Lg,this),(0,T.Z)(this,"attributes",[]),(0,T.Z)(this,"triangulation",void 0),(0,T.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,yt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new fE(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,t){var o=this.getLayerStyleAttribute(r);o||(o=this.registerStyleAttribute((0,oe.Z)((0,oe.Z)({},n),{},{name:r})));var u=n.scale;u&&o&&(o.scale=u,o.needRescale=!0,o.needRemapping=!0,o.needRegenerateVertices=!0,t&&t.featureRange&&(o.featureRange=t.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,t=this.getLayerStyleAttribute(r),o=t==null||(n=t.scale)===null||n===void 0?void 0:n.scalers;return o&&o[0]?o[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,c=this.attributes.find(function(Re){return Re.name===r});if(c&&c.descriptor){var p=c.descriptor,m=p.update,b=p.buffer,C=p.size,A=C===void 0?0:C,P=mE[b.type||H.FLOAT];if(m){var O=this.featureLayout,D=O.elements,N=O.sizePerElement,j=D.slice(t,o);if(!j.length)return;var ae=j[0].offset,re=ae*A*P,Te=j.map(function(Re,Ke){for(var gt=Re.featureIdx,lt=Re.vertices,Ut=Re.normals,or=lt.length/N,cr=[],Tr=0;Tr<or;Tr++){var Sn=Ut?Ut.slice(Tr*3,Tr*3+3):[];cr.push.apply(cr,(0,ee.Z)(m(n[gt],gt,lt.slice(Tr*N,Tr*N+N),Ke,Sn)))}return cr}).reduce(function(Re,Ke){return Re.push.apply(Re,(0,ee.Z)(Ke)),Re},[]);c.vertexAttribute.updateBuffer({data:Te,offset:re}),u==null||u.emit("legend:".concat(r),{type:r,attr:c})}}}},{key:"createAttributesAndIndicesAscy",value:function(r,n,t){var o=this;this.featureLayout={sizePerElement:0,elements:[]};var u=this.attributes.map(function(O){return O.resetDescriptor(),O.descriptor}).filter(function(O){return O}),c=t.modelType,p=(0,sf.Z)(t,hE),m=this.rendererService,b=m.createAttribute,C=m.createBuffer,A=m.createElements,P={};return new Promise(function(O,D){bc(c,(0,oe.Z)({descriptors:o.getDescriptorsWithOutFunc(u),features:r,segmentNumber:n},p)).then(function(N){N.descriptors.forEach(function(ae,re){if(ae){var Te=ae.buffer,Re=ae.update,Ke=ae.name,gt=(0,sf.Z)(ae,pE),lt=b((0,oe.Z)({buffer:C(Te)},gt));P[ae.name||""]=lt,o.attributes[re].vertexAttribute=lt}}),o.featureLayout=N.featureLayout;var j=A({data:N.indices,type:H.UNSIGNED_INT,count:N.indices.length});o.attributesAndIndices={attributes:P,elements:j,count:null},O(o.attributesAndIndices)}).catch(function(N){console.warn(N),D(N)})})}},{key:"createAttributesAndIndices",value:function(r,n,t){var o=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var u=this.attributes.map(function(re){return re.resetDescriptor(),re.descriptor}),c=0,p=0,m=[],b=[],C=[],A=3;r.forEach(function(re,Te){var Re=o.triangulation(re,t),Ke=Re.indices,gt=Re.vertices,lt=Re.normals,Ut=Re.size,or=Re.indexes,cr=Re.count;typeof cr=="number"&&(p+=cr),Ke.forEach(function(Vi){b.push(Vi+c)}),A=Ut;var Tr=gt.length/Ut;o.featureLayout.sizePerElement=A,o.featureLayout.elements.push({featureIdx:Te,vertices:gt,normals:lt,offset:c}),c+=Tr;for(var Sn=function(Ba){var ho=(lt==null?void 0:lt.slice(Ba*3,Ba*3+3))||[],Ao=gt.slice(Ba*Ut,Ba*Ut+Ut),Wo=0;or&&or[Ba]!==void 0&&(Wo=or[Ba]),u.forEach(function(Ju,up){if(Ju&&Ju.update){var lp;(lp=Ju.buffer.data).push.apply(lp,(0,ee.Z)(Ju.update(re,Te,Ao,Ba,ho,Wo)))}})},Un=0;Un<Tr;Un++)Sn(Un)});var P=this.rendererService,O=P.createAttribute,D=P.createBuffer,N=P.createElements,j={};u.forEach(function(re,Te){if(re){var Re=re.buffer,Ke=re.update,gt=re.name,lt=(0,sf.Z)(re,dE),Ut=O((0,oe.Z)({buffer:D(Re)},lt));j[re.name||""]=Ut,o.attributes[Te].vertexAttribute=Ut}});var ae=N({data:b,type:H.UNSIGNED_INT,count:b.length});return this.attributesAndIndices={attributes:j,elements:ae,count:p},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var t=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(P){return P.resetDescriptor(),P.descriptor}),u=0,c=[],p=3;r.forEach(function(P,O){var D=t.triangulation(P),N=D.indices,j=D.vertices,ae=D.normals,re=D.size,Te=D.indexes;N.forEach(function(lt){c.push(lt+u)}),p=re;var Re=j.length/re;t.featureLayout.sizePerElement=p,t.featureLayout.elements.push({featureIdx:O,vertices:j,normals:ae,offset:u}),u+=Re;for(var Ke=function(Ut){var or=(ae==null?void 0:ae.slice(Ut*3,Ut*3+3))||[],cr=j.slice(Ut*re,Ut*re+re),Tr=0;Te&&Te[Ut]!==void 0&&(Tr=Te[Ut]),o.forEach(function(Sn,Un){if(Sn&&Sn.update){var Vi;(Vi=Sn.buffer.data).push.apply(Vi,(0,ee.Z)(Sn.update(P,O,cr,Ut,or,Tr)))}})},gt=0;gt<Re;gt++)Ke(gt)});var m=this.rendererService,b=m.createAttribute,C=m.createBuffer,A={};return o.forEach(function(P,O){if(P){var D=P.buffer,N=P.update,j=P.name,ae=(0,sf.Z)(P,vE),re=b((0,oe.Z)({buffer:C(D)},ae));A[P.name||""]=re,t.attributes[O].vertexAttribute=re}}),{attributes:A}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}},{key:"getDescriptorsWithOutFunc",value:function(r){return r.map(function(n){return{buffer:n.buffer,name:n.name,size:n.size}})}}]),e}(),Lg=ta(J0.prototype,"rendererService",[kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J0))||Pg),Rg=fe(67709),yE=fe.n(Rg),Og,Dg,Fg,Bg,Ng,zg,Ug,Zg,Vg,jg,Gg,Hg,Wg,Xg,Yg,$g,qg,Ou,Kg,Qg,Jg,ey,ty,ry,ny,iy,ay,oy,sy,uy,ly,cy,fy;function _E(e){var i=xE();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function xE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bE=(Og=(0,Jr.b2)(),Dg=(0,Jr.f3)(Ft.SceneID),Fg=(0,Jr.f3)(Ft.IIconService),Bg=(0,Jr.f3)(Ft.IFontService),Ng=(0,Jr.f3)(Ft.IControlService),zg=(0,Jr.f3)(Ft.IGlobalConfigService),Ug=(0,Jr.f3)(Ft.IMapService),Zg=(0,Jr.f3)(Ft.ICoordinateSystemService),Vg=(0,Jr.f3)(Ft.IRendererService),jg=(0,Jr.f3)(Ft.ILayerService),Gg=(0,Jr.f3)(Ft.ICameraService),Hg=(0,Jr.f3)(Ft.IInteractionService),Wg=(0,Jr.f3)(Ft.IPickingService),Xg=(0,Jr.f3)(Ft.IShaderModuleService),Yg=(0,Jr.f3)(Ft.IMarkerService),$g=(0,Jr.f3)(Ft.IPopupService),Og(qg=(Ou=function(e){(0,hr.Z)(r,e);var i=_E(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),(0,T.Z)((0,$e.Z)(n),"destroyed",!1),(0,T.Z)((0,$e.Z)(n),"loaded",!1),na((0,$e.Z)(n),"id",Kg,(0,$e.Z)(n)),na((0,$e.Z)(n),"iconService",Qg,(0,$e.Z)(n)),na((0,$e.Z)(n),"fontService",Jg,(0,$e.Z)(n)),na((0,$e.Z)(n),"controlService",ey,(0,$e.Z)(n)),na((0,$e.Z)(n),"configService",ty,(0,$e.Z)(n)),na((0,$e.Z)(n),"map",ry,(0,$e.Z)(n)),na((0,$e.Z)(n),"coordinateSystemService",ny,(0,$e.Z)(n)),na((0,$e.Z)(n),"rendererService",iy,(0,$e.Z)(n)),na((0,$e.Z)(n),"layerService",ay,(0,$e.Z)(n)),na((0,$e.Z)(n),"cameraService",oy,(0,$e.Z)(n)),na((0,$e.Z)(n),"interactionService",sy,(0,$e.Z)(n)),na((0,$e.Z)(n),"pickingService",uy,(0,$e.Z)(n)),na((0,$e.Z)(n),"shaderModuleService",ly,(0,$e.Z)(n)),na((0,$e.Z)(n),"markerService",cy,(0,$e.Z)(n)),na((0,$e.Z)(n),"popupService",fy,(0,$e.Z)(n)),(0,T.Z)((0,$e.Z)(n),"inited",!1),(0,T.Z)((0,$e.Z)(n),"initPromise",void 0),(0,T.Z)((0,$e.Z)(n),"rendering",!1),(0,T.Z)((0,$e.Z)(n),"$container",void 0),(0,T.Z)((0,$e.Z)(n),"canvas",void 0),(0,T.Z)((0,$e.Z)(n),"markerContainer",void 0),(0,T.Z)((0,$e.Z)(n),"hooks",void 0),(0,T.Z)((0,$e.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),ko(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,T.Z)((0,$e.Z)(n),"handleMapCameraChanged",function(t){n.cameraService.update(t),n.render()}),n.hooks={init:new Sr},n}return(0,yt.Z)(r,[{key:"init",value:function(t){var o=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,ue.Z)(te().mark(function u(){return te().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,new Promise(function(m){o.map.onCameraChanged(function(b){o.cameraService.init(),o.cameraService.update(b),m()}),o.map.init()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.map.addMarkerContainer(),o.markerService.addMarkers(),o.markerService.addMarkerLayers(),o.popupService.initPopup(),o.interactionService.init(),o.interactionService.on(Ru.Drag,o.addSceneEvent.bind(o));case 9:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,ue.Z)(te().mark(function u(){var c,p;return te().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(c=o.map.getOverlayContainer(),c?o.$container=c:o.$container=iE(o.configService.getSceneConfig(o.id).id||""),!o.$container){b.next=12;break}return o.canvas=Ia("canvas","",o.$container),o.setCanvas(),b.next=7,o.rendererService.init(o.canvas,o.configService.getSceneConfig(o.id),t.gl);case 7:o.initContainer(),yE()(o.$container,o.handleWindowResized),ha.matchMedia&&((p=ha.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||p===void 0||p.addListener(o.handleWindowResized)),b.next=13;break;case 12:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 13:o.pickingService.init(o.id);case 14:case"end":return b.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(t){var o=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,ue.Z)(te().mark(function u(){return te().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,new Promise(function(m){o.map.onCameraChanged(function(b){o.cameraService.init(),o.cameraService.update(b),o.map.version!=="GAODE2.x"&&m()}),o.map.initMiniMap()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.interactionService.init(),o.interactionService.on(Ru.Drag,o.addSceneEvent.bind(o));case 5:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,ue.Z)(te().mark(function u(){var c;return te().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(c=t.canvas,o.$container=c||null,!o.$container){m.next=7;break}return m.next=5,o.rendererService.init(t.canvas,o.configService.getSceneConfig(o.id),void 0);case 5:m.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:o.pickingService.init(o.id);case 9:case"end":return m.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(t){this.layerService.sceneService=this,this.layerService.add(t)}},{key:"addMask",value:function(t){this.layerService.sceneService=this,this.layerService.addMask(t)}},{key:"render",value:function(){var n=(0,ue.Z)(te().mark(function o(){return te().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!(this.rendering||this.destroyed)){c.next=2;break}return c.abrupt("return");case 2:if(this.rendering=!0,this.inited){c.next=12;break}return c.next=6,this.initPromise;case 6:this.destroyed&&this.destroy(),this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 12:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 15:case"end":return c.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"addFontFace",value:function(t,o){this.fontService.addFontFace(t,o)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(t){var o,u=(o=this.$container)===null||o===void 0?void 0:o.getElementsByTagName("canvas")[0];this.render();var c=t==="jpg"?u==null?void 0:u.toDataURL("image/jpeg"):u==null?void 0:u.toDataURL("image/png");return c}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var t=this.$container.parentElement;t!==null&&(this.markerContainer=Ia("div","l7-marker-container",t))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var t=this,o,u;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var p;(p=t.$container)===null||p===void 0||p.removeChild(t.canvas),t.canvas=null,t.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Rg.unbind)(this.$container,this.handleWindowResized),ha.matchMedia){var c;(c=ha.matchMedia("screen and (min-resolution: 2dppx)"))===null||c===void 0||c.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var t,o,u=Da,c=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,m=this.canvas;m&&(m.width=c*u,m.height=p*u),this.rendererService.viewport({x:0,y:0,width:u*c,height:u*p})}},{key:"setCanvas",value:function(){var t,o,u=Da,c=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,m=this.canvas;m.width=c*u,m.height=p*u,m.style.width="100%",m.style.height="100%"}},{key:"addSceneEvent",value:function(t){this.emit(t.type,t)}}]),r}(iu.EventEmitter),Kg=ta(Ou.prototype,"id",[Dg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qg=ta(Ou.prototype,"iconService",[Fg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jg=ta(Ou.prototype,"fontService",[Bg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ey=ta(Ou.prototype,"controlService",[Ng],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ty=ta(Ou.prototype,"configService",[zg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ry=ta(Ou.prototype,"map",[Ug],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ny=ta(Ou.prototype,"coordinateSystemService",[Zg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iy=ta(Ou.prototype,"rendererService",[Vg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ay=ta(Ou.prototype,"layerService",[jg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oy=ta(Ou.prototype,"cameraService",[Gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sy=ta(Ou.prototype,"interactionService",[Hg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uy=ta(Ou.prototype,"pickingService",[Wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ly=ta(Ou.prototype,"shaderModuleService",[Xg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cy=ta(Ou.prototype,"markerService",[Yg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fy=ta(Ou.prototype,"popupService",[$g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ou))||qg);function EE(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var SE=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function hy(e){var i={};return e=e.replace(SE,function(r,n,t){var o=t.split(":"),u=o[0].trim(),c="";switch(o.length>1&&(c=o[1].trim()),n){case"bool":c=c==="true";break;case"float":case"int":c=Number(c);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":c?c=c.replace("[","").replace("]","").split(",").reduce(function(p,m){return p.push(Number(m.trim())),p},[]):c=new Array(EE(n)).fill(0);break;default:}return i[u]=c,"uniform ".concat(n," ").concat(u,`;
`)}),{content:e,uniforms:i}}var py,dy,vy="#define PI 3.14159265359",CE=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,wE=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,AE=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,TE=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,ME=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,IE=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,kE=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,PE=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,LE=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,RE=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,OE=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,DE=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,FE=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,BE=/precision\s+(high|low|medium)p\s+float/,NE=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,zE=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,UE=(py=(0,Jr.b2)(),py(dy=function(){function e(){(0,vt.Z)(this,e),(0,T.Z)(this,"moduleCache",{}),(0,T.Z)(this,"rawContentCache",{})}return(0,yt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:vy,fs:vy}),this.registerModule("decode",{vs:CE,fs:""}),this.registerModule("projection",{vs:kE,fs:""}),this.registerModule("project",{vs:IE,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:PE}),this.registerModule("lighting",{vs:AE,fs:""}),this.registerModule("light",{vs:wE,fs:""}),this.registerModule("picking",{vs:ME,fs:TE}),this.registerModule("styleMapping",{vs:LE,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:FE,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:RE,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:OE,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:DE,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var t=n.vs,o=n.fs,u=n.uniforms,c=hy(t),p=c.content,m=c.uniforms,b=hy(o),C=b.content,A=b.uniforms;this.rawContentCache[r]={fs:C,uniforms:(0,oe.Z)((0,oe.Z)((0,oe.Z)({},m),A),u),vs:p}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var t=this.rawContentCache[r].vs,o=this.rawContentCache[r].fs,u=this.processModule(t,[],"vs"),c=u.content,p=u.includeList,m=this.processModule(o,[],"fs"),b=m.content,C=m.includeList,A=b,P=(0,Er.uniq)(p.concat(C).concat(r)).reduce(function(O,D){return(0,oe.Z)((0,oe.Z)({},O),n.rawContentCache[D].uniforms)},{});return BE.test(b)||(A=NE+b),this.moduleCache[r]={fs:A.trim(),uniforms:P,vs:c.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,t){var o=this,u=r.replace(zE,function(c,p){var m=p.split(" "),b=m[0].replace(/"/g,"");if(n.indexOf(b)>-1)return"";var C=o.rawContentCache[b][t];n.push(b);var A=o.processModule(C,n,t),P=A.content;return P});return{content:u,includeList:n}}}]),e}())||dy);function ZE(e,i){for(;!Object.prototype.hasOwnProperty.call(e,i)&&(e=(0,at.Z)(e),e!==null););return e}function Xp(){return typeof Reflect!="undefined"&&Reflect.get?Xp=Reflect.get.bind():Xp=function(i,r,n){var t=ZE(i,r);if(!!t){var o=Object.getOwnPropertyDescriptor(t,r);return o.get?o.get.call(arguments.length<3?i:n):o.value}},Xp.apply(this,arguments)}var ep;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(ep||(ep={}));var gy,yy,a0=(gy=(0,Jr.b2)(),gy(yy=function(){function e(){(0,vt.Z)(this,e),(0,T.Z)(this,"shaderModuleService",void 0),(0,T.Z)(this,"rendererService",void 0),(0,T.Z)(this,"cameraService",void 0),(0,T.Z)(this,"mapService",void 0),(0,T.Z)(this,"interactionService",void 0),(0,T.Z)(this,"layerService",void 0),(0,T.Z)(this,"config",void 0)}return(0,yt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return ep.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Ft.IRendererService),this.cameraService=r.getContainer().get(Ft.ICameraService),this.mapService=r.getContainer().get(Ft.IMapService),this.interactionService=r.getContainer().get(Ft.IInteractionService),this.layerService=r.getContainer().get(Ft.ILayerService),this.shaderModuleService=r.getContainer().get(Ft.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||yy),_y,xy;function VE(e){var i=jE();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function jE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GE=(_y=(0,Jr.b2)(),_y(xy=function(e){(0,hr.Z)(r,e);var i=VE(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(t,o){Xp((0,at.Z)(r.prototype),"init",this).call(this,t,o)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(a0))||xy),by,Ey,Sy,em,Cy;function HE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=WE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var m=r.next();return o=m.done,m},e:function(m){u=!0,c=m},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function WE(e,i){if(!!e){if(typeof e=="string")return wy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wy(e,i)}}function wy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var XE=(by=(0,Jr.b2)(),Ey=(0,Jr.f3)(Ft.IPostProcessor),by(Sy=(em=function(){function e(){(0,vt.Z)(this,e),(0,T.Z)(this,"passes",[]),na(this,"postProcessor",Cy,this),(0,T.Z)(this,"layer",void 0),(0,T.Z)(this,"renderFlag",void 0),(0,T.Z)(this,"width",0),(0,T.Z)(this,"height",0)}return(0,yt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,ue.Z)(te().mark(function n(){var t,o,u;return te().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:t=HE(this.passes),p.prev=1,t.s();case 3:if((o=t.n()).done){p.next=9;break}return u=o.value,p.next=7,u.render(this.layer);case 7:p.next=3;break;case 9:p.next=14;break;case 11:p.prev=11,p.t0=p.catch(1),t.e(p.t0);case 14:return p.prev=14,t.f(),p.finish(14);case 17:return p.next=19,this.postProcessor.render(this.layer);case 19:case"end":return p.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===ep.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,t){r.init(this.layer,n),this.passes.splice(t,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Cy=ta(em.prototype,"postProcessor",[Ey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),em))||Sy),Ay,Ty;function YE(e){var i=$E();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function $E(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qE=(Ay=(0,Jr.b2)(),Ay(Ty=function(e){(0,hr.Z)(r,e);var i=YE(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"pickingFBO",void 0),(0,T.Z)((0,$e.Z)(n),"layer",void 0),(0,T.Z)((0,$e.Z)(n),"width",0),(0,T.Z)((0,$e.Z)(n),"height",0),(0,T.Z)((0,$e.Z)(n),"alreadyInRendering",!1),(0,T.Z)((0,$e.Z)(n),"pickFromPickingFBO",function(c){var p=c.x,m=c.y,b=c.lngLat,C=c.type;if(!(!n.layer.isVisible()||!n.layer.needPick(C))){var A=n.rendererService,P=A.getViewportSize,O=A.readPixels,D=A.useFramebuffer,N=P(),j=N.width,ae=N.height,re=n.layer.getLayerConfig(),Te=re.enableHighlight,Re=re.enableSelect,Ke=p*Da,gt=m*Da;if(!(Ke>j||Ke<0||gt>ae||gt<0)){var lt;D(n.pickingFBO,function(){var Ut;if(lt=O({x:Math.round(Ke),y:Math.round(ae-(m+1)*Da),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),lt[0]!==0||lt[1]!==0||lt[2]!==0){var or=g(lt),cr=n.layer.getSource().getFeatureById(or),Tr={x:p,y:m,type:C,lngLat:b,featureId:or,feature:cr};cr&&(n.layer.setCurrentPickId(or),n.triggerHoverOnLayer(Tr))}else{var Sn={x:p,y:m,lngLat:b,type:n.layer.getCurrentPickId()===null?"un"+C:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,oe.Z)((0,oe.Z)({},Sn),{},{type:"unpick"})),n.triggerHoverOnLayer(Sn),n.layer.setCurrentPickId(null)}Te&&n.highlightPickedFeature(lt),Re&&C==="click"&&((Ut=lt)===null||Ut===void 0?void 0:Ut.toString())!==[0,0,0,0].toString()&&n.selectFeature(lt)})}}}),n}return(0,yt.Z)(r,[{key:"getType",value:function(){return ep.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,o){Xp((0,at.Z)(r.prototype),"init",this).call(this,t,o),this.layer=t;var u=this.rendererService,c=u.createTexture2D,p=u.createFramebuffer,m=u.getViewportSize,b=m(),C=b.width,A=b.height;this.pickingFBO=p({color:c({width:C,height:A,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE})}),this.interactionService.on(Ru.Hover,this.pickFromPickingFBO),this.interactionService.on(Ru.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Ru.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(t){var o=this;if(!this.alreadyInRendering){var u=this.rendererService,c=u.getViewportSize,p=u.useFramebuffer,m=u.clear,b=c(),C=b.width,A=b.height;this.alreadyInRendering=!0,(this.width!==C||this.height!==A)&&(this.pickingFBO.resize({width:C,height:A}),this.width=C,this.height=A),p(this.pickingFBO,function(){m({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var P=o.layer.multiPassRenderer.getRenderFlag();o.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),o.layer.multiPassRenderer.setRenderFlag(P),o.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(t){this.layer.emit(t.type,t)}},{key:"highlightPickedFeature",value:function(t){var o=(0,ce.Z)(t,3),u=o[0],c=o[1],p=o[2];this.layer.hooks.beforeHighlight.call([u,c,p]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(t){var o=(0,ce.Z)(t,3),u=o[0],c=o[1],p=o[2];this.layer.hooks.beforeSelect.call([u,c,p]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(t){var o=t.featureId,u=S(o);this.selectFeature(new Uint8Array(u))}},{key:"highlightFeatureHandle",value:function(t){var o=t.featureId,u=S(o);this.highlightPickedFeature(new Uint8Array(u))}}]),r}(a0))||Ty),My,Iy,ky,tm,Py,KE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,gh=(My=(0,Jr.b2)(),Iy=(0,Jr.f3)(Ft.IShaderModuleService),My(ky=(tm=function(){function e(){(0,vt.Z)(this,e),na(this,"shaderModuleService",Py,this),(0,T.Z)(this,"rendererService",void 0),(0,T.Z)(this,"config",void 0),(0,T.Z)(this,"quad",KE),(0,T.Z)(this,"enabled",!0),(0,T.Z)(this,"renderToScreen",!1),(0,T.Z)(this,"model",void 0),(0,T.Z)(this,"name",void 0),(0,T.Z)(this,"optionsToUpdate",{})}return(0,yt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return ep.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Ft.IRendererService),this.shaderModuleService=r.getContainer().get(Ft.IShaderModuleService);var t=this.rendererService,o=t.createAttribute,u=t.createBuffer,c=t.createModel,p=this.setupShaders(),m=p.vs,b=p.fs,C=p.uniforms;this.model=c({vs:m,fs:b,attributes:{a_Position:o({buffer:u({data:[-4,-4,4,-4,0,4],type:H.FLOAT}),size:2})},uniforms:(0,oe.Z)((0,oe.Z)({u_Texture:null},C),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var t=this,o=r.multiPassRenderer.getPostProcessor(),u=this.rendererService,c=u.useFramebuffer,p=u.getViewportSize,m=u.clear,b=p(),C=b.width,A=b.height;c(this.renderToScreen?null:o.getWriteFBO(),function(){m({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var P=(0,oe.Z)({u_BloomFinal:0,u_Texture:o.getReadFBO(),u_ViewportSize:[C,A]},t.convertOptionsToUniforms(t.optionsToUpdate));n&&(P.u_BloomFinal=1,P.u_Texture2=n),t.model.draw({uniforms:P})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=(0,oe.Z)((0,oe.Z)({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(t){(0,Er.isNil)(r[t])||(n["u_".concat((0,Er.upperFirst)((0,Er.camelCase)(t)))]=r[t])}),n}}]),e}(),Py=ta(tm.prototype,"shaderModuleService",[Iy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tm))||ky),Ly,Ry;function QE(e){var i=JE();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function JE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eS=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,tS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,rS=(Ly=(0,Jr.b2)(),Ly(Ry=function(e){(0,hr.Z)(r,e);var i=QE(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:tS,fs:eS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,c=t.uniforms,p=this.rendererService.getViewportSize(),m=p.width,b=p.height;return{vs:o,fs:u,uniforms:(0,oe.Z)((0,oe.Z)({},c),{},{u_ViewportSize:[m,b]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return(0,Er.isNil)(t.bloomRadius)||(o.u_radius=t.bloomRadius),(0,Er.isNil)(t.bloomIntensity)||(o.u_intensity=t.bloomIntensity),(0,Er.isNil)(t.bloomBaseRadio)||(o.u_baseRadio=t.bloomBaseRadio),o}}]),r}(gh))||Ry),Oy,Dy;function nS(e){var i=iS();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function iS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,oS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,sS=(Oy=(0,Jr.b2)(),Oy(Dy=function(e){(0,hr.Z)(r,e);var i=nS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:oS,fs:aS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,c=t.uniforms,p=this.rendererService.getViewportSize(),m=p.width,b=p.height;return{vs:o,fs:u,uniforms:(0,oe.Z)((0,oe.Z)({},c),{},{u_ViewportSize:[m,b]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return(0,Er.isNil)(t.blurRadius)||(o.u_BlurDir=[t.blurRadius,0]),o}}]),r}(gh))||Dy),Fy,By;function uS(e){var i=lS();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function lS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,fS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,hS=(Fy=(0,Jr.b2)(),Fy(By=function(e){(0,hr.Z)(r,e);var i=uS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:fS,fs:cS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,c=t.uniforms,p=this.rendererService.getViewportSize(),m=p.width,b=p.height;return{vs:o,fs:u,uniforms:(0,oe.Z)((0,oe.Z)({},c),{},{u_ViewportSize:[m,b]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return(0,Er.isNil)(t.blurRadius)||(o.u_BlurDir=[0,t.blurRadius]),o}}]),r}(gh))||By),Ny,zy;function pS(e){var i=dS();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function dS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,mS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,gS=(Ny=(0,Jr.b2)(),Ny(zy=function(e){(0,hr.Z)(r,e);var i=pS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:mS,fs:vS});var t=this.shaderModuleService.getModule("colorhalftone-pass"),o=t.vs,u=t.fs,c=t.uniforms,p=this.rendererService.getViewportSize(),m=p.width,b=p.height;return{vs:o,fs:u,uniforms:(0,oe.Z)((0,oe.Z)({},c),{},{u_ViewportSize:[m,b]})}}}]),r}(gh))||zy),Uy,Zy;function yS(e){var i=_S();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function _S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,bS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ES=(Uy=(0,Jr.b2)(),Uy(Zy=function(e){(0,hr.Z)(r,e);var i=yS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:bS,fs:xS}),this.shaderModuleService.getModule("copy-pass")}}]),r}(gh))||Zy),Vy,jy;function SS(e){var i=CS();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function CS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,AS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,TS=(Vy=(0,Jr.b2)(),Vy(jy=function(e){(0,hr.Z)(r,e);var i=SS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:AS,fs:wS});var t=this.shaderModuleService.getModule("hexagonalpixelate-pass"),o=t.vs,u=t.fs,c=t.uniforms,p=this.rendererService.getViewportSize(),m=p.width,b=p.height;return{vs:o,fs:u,uniforms:(0,oe.Z)((0,oe.Z)({},c),{},{u_ViewportSize:[m,b]})}}}]),r}(gh))||jy),Gy,Hy;function MS(e){var i=IS();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function IS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,PS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,LS=(Gy=(0,Jr.b2)(),Gy(Hy=function(e){(0,hr.Z)(r,e);var i=MS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:PS,fs:kS});var t=this.shaderModuleService.getModule("ink-pass"),o=t.vs,u=t.fs,c=t.uniforms,p=this.rendererService.getViewportSize(),m=p.width,b=p.height;return{vs:o,fs:u,uniforms:(0,oe.Z)((0,oe.Z)({},c),{},{u_ViewportSize:[m,b]})}}}]),r}(gh))||Hy),Wy,Xy;function RS(e){var i=OS();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function OS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,FS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,BS=(Wy=(0,Jr.b2)(),Wy(Xy=function(e){(0,hr.Z)(r,e);var i=RS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:FS,fs:DS}),this.shaderModuleService.getModule("noise-pass")}}]),r}(gh))||Xy),Yy,$y;function NS(e){var i=zS();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function zS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var US=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ZS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,VS=(Yy=(0,Jr.b2)(),Yy($y=function(e){(0,hr.Z)(r,e);var i=NS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:US,fs:ZS}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(gh))||$y),qy,Ky,Qy,Jy,Md,e_,jS=(qy=(0,Jr.b2)(),Ky=(0,Jr.f3)(Ft.IRendererService),Qy=(0,Jr.zY)(),qy(Jy=(Md=function(){function e(){(0,vt.Z)(this,e),na(this,"rendererService",e_,this),(0,T.Z)(this,"passes",[]),(0,T.Z)(this,"readFBO",void 0),(0,T.Z)(this,"writeFBO",void 0)}return(0,yt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,t=r.createTexture2D,o=n(),u=o.width,c=o.height;return t({x:0,y:0,width:u,height:c,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(t){n(r.readFBO,(0,ue.Z)(te().mark(function o(){return te().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:t(r.getCurrentFBOTex());case 1:case"end":return c.stop()}},o)})))})}},{key:"renderBloomPass",value:function(){var i=(0,ue.Z)(te().mark(function n(t,o){var u,c;return te().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.getReadFBOTex();case 2:u=m.sent,c=0;case 4:if(!(c<4)){m.next=11;break}return m.next=7,o.render(t,u);case 7:this.swap(),c++,m.next=4;break;case 11:case"end":return m.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,ue.Z)(te().mark(function n(t){var o,u;return te().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:o=0;case 1:if(!(o<this.passes.length)){p.next=15;break}if(u=this.passes[o],u.setRenderToScreen(this.isLastEnabledPass(o)),u.getName()!=="bloom"){p.next=9;break}return p.next=7,this.renderBloomPass(t,u);case 7:p.next=12;break;case 9:return p.next=11,u.render(t);case 11:o!==this.passes.length-1&&this.swap();case 12:o++,p.next=1;break;case 15:case"end":return p.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,t){r.init(n,t),this.passes.push(r)}},{key:"insert",value:function(r,n,t,o){r.init(t,o),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,t=r.createTexture2D;this.readFBO=n({color:t({width:1,height:1,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE})}),this.writeFBO=n({color:t({width:1,height:1,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),e_=ta(Md.prototype,"rendererService",[Ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ta(Md.prototype,"init",[Qy],Object.getOwnPropertyDescriptor(Md.prototype,"init"),Md.prototype),Md))||Jy),t_,r_;function GS(e){var i=HS();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function HS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WS=(t_=(0,Jr.b2)(),t_(r_=function(e){(0,hr.Z)(r,e);var i=GS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getType",value:function(){return ep.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(t,o){Xp((0,at.Z)(r.prototype),"init",this).call(this,t,o)}},{key:"render",value:function(t){var o=this.rendererService,u=o.useFramebuffer,c=o.clear,p=t.multiPassRenderer.getPostProcessor().getReadFBO();u(p,function(){c({color:[0,0,0,0],depth:1,stencil:0,framebuffer:p}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach(function(m){m.draw({uniforms:t.layerModel.getUninforms()})}),t.multiPassRenderer.setRenderFlag(!0)})}}]),r}(a0))||r_),n_,i_,a_,rm,o_;function XS(e){var i=YS();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function YS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $S=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,s_=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,qS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function u_(e,i){for(var r=0,n=1/i,t=e;t>0;)r=r+n*(t%i),t=Math.floor(t/i),n=n/i;return r}var KS=1,QS=(n_=(0,Jr.b2)(),i_=(0,Jr.f3)(Ft.IShaderModuleService),n_(a_=(rm=function(e){(0,hr.Z)(r,e);var i=XS(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),na((0,$e.Z)(n),"shaderModuleService",o_,(0,$e.Z)(n)),(0,T.Z)((0,$e.Z)(n),"haltonSequence",[]),(0,T.Z)((0,$e.Z)(n),"accumulatingId",0),(0,T.Z)((0,$e.Z)(n),"frame",0),(0,T.Z)((0,$e.Z)(n),"timer",void 0),(0,T.Z)((0,$e.Z)(n),"sampleRenderTarget",void 0),(0,T.Z)((0,$e.Z)(n),"prevRenderTarget",void 0),(0,T.Z)((0,$e.Z)(n),"outputRenderTarget",void 0),(0,T.Z)((0,$e.Z)(n),"copyRenderTarget",void 0),(0,T.Z)((0,$e.Z)(n),"blendModel",void 0),(0,T.Z)((0,$e.Z)(n),"outputModel",void 0),(0,T.Z)((0,$e.Z)(n),"copyModel",void 0),n}return(0,yt.Z)(r,[{key:"getType",value:function(){return ep.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,o){Xp((0,at.Z)(r.prototype),"init",this).call(this,t,o);var u=this.rendererService,c=u.createFramebuffer,p=u.createTexture2D;this.sampleRenderTarget=c({color:p({width:1,height:1,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE})}),this.prevRenderTarget=c({color:p({width:1,height:1,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE})}),this.outputRenderTarget=c({color:p({width:1,height:1,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE})}),this.copyRenderTarget=c({color:p({width:1,height:1,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE})});for(var m=0;m<30;m++)this.haltonSequence.push([u_(m,2),u_(m,3)]);this.blendModel=this.createTriangleModel("blend-pass",$S),this.outputModel=this.createTriangleModel("copy-pass",s_,{blend:{enable:!0,func:{srcRGB:H.ONE,dstRGB:H.ONE_MINUS_SRC_ALPHA,srcAlpha:H.ONE,dstAlpha:H.ONE_MINUS_SRC_ALPHA},equation:{rgb:H.FUNC_ADD,alpha:H.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",s_)}},{key:"render",value:function(t){var o=this,u=this.rendererService,c=u.clear,p=u.getViewportSize,m=u.useFramebuffer,b=p(),C=b.width,A=b.height;this.sampleRenderTarget.resize({width:C,height:A}),this.prevRenderTarget.resize({width:C,height:A}),this.outputRenderTarget.resize({width:C,height:A}),this.copyRenderTarget.resize({width:C,height:A}),this.resetFrame(),this.stopAccumulating();var P=t.multiPassRenderer.getPostProcessor().getReadFBO();m(P,function(){c({color:[0,0,0,0],depth:1,stencil:0,framebuffer:P}),t.multiPassRenderer.setRenderFlag(!1),t.render(),t.multiPassRenderer.setRenderFlag(!0)});var O=function D(N){!o.accumulatingId||N!==o.accumulatingId||o.isFinished()||(o.doRender(t),ha.requestAnimationFrame(function(){D(N)}))};this.accumulatingId=KS++,this.timer=ha.setTimeout(function(){O(o.accumulatingId)},50)}},{key:"doRender",value:function(t){var o=this,u=this.rendererService,c=u.clear,p=u.getViewportSize,m=u.useFramebuffer,b=p(),C=b.width,A=b.height,P=t.getLayerConfig(),O=P.jitterScale,D=O===void 0?1:O,N=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((N[0]*2-1)/C*D,(N[1]*2-1)/A*D),t.multiPassRenderer.setRenderFlag(!1),t.hooks.beforeRender.call(),m(this.sampleRenderTarget,function(){c({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.sampleRenderTarget}),t.render()}),t.hooks.afterRender.call(),t.multiPassRenderer.setRenderFlag(!0);var j=t.getLayerConfig();m(this.outputRenderTarget,function(){o.blendModel.draw({uniforms:{u_opacity:j.opacity||1,u_MixRatio:o.frame===0?1:.9,u_Diffuse1:o.sampleRenderTarget,u_Diffuse2:o.frame===0?t.multiPassRenderer.getPostProcessor().getReadFBO():o.prevRenderTarget}})}),this.frame===0&&c({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(m(this.copyRenderTarget,function(){o.outputModel.draw({uniforms:{u_Texture:o.outputRenderTarget}})}),m(t.multiPassRenderer.getPostProcessor().getReadFBO(),function(){o.copyModel.draw({uniforms:{u_Texture:o.copyRenderTarget}})}),t.multiPassRenderer.getPostProcessor().render(t));var ae=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=ae,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,ha.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,o,u){this.shaderModuleService.registerModule(t,{vs:qS,fs:o});var c=this.shaderModuleService.getModule(t),p=c.vs,m=c.fs,b=c.uniforms,C=this.rendererService,A=C.createAttribute,P=C.createBuffer,O=C.createModel;return O((0,oe.Z)({vs:p,fs:m,attributes:{a_Position:A({buffer:P({data:[-4,-4,4,-4,0,4],type:H.FLOAT}),size:2})},uniforms:(0,oe.Z)({},b),depth:{enable:!1},count:3},u))}}]),r}(a0),o_=ta(rm.prototype,"shaderModuleService",[i_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rm))||a_),fv=new Jr.W2;fv.bind(Ft.IGlobalConfigService).to(W2).inSingletonScope(),(0,Jr.GW)((0,Jr.b2)(),iu.EventEmitter),fv.bind(Ft.IEventEmitter).to(iu.EventEmitter);var l_=(0,qu.Z)(fv,!1),nm=function(i){var r=l_.lazyInject(i);return function(n,t,o){r.call(this,n,t),o&&(o.initializer=function(){return n[t]})}},wR=function(i){var r=l_.lazyMultiInject(i);return function(n,t,o){r.call(this,n,t),o&&(o.initializer=function(){return n[t]})}},ac=fv,JS=0;function eC(){var e=new Jr.W2;return e.parent=fv,e.bind(Ft.SceneID).toConstantValue("".concat(JS++)),e.bind(Ft.IShaderModuleService).to(UE).inSingletonScope(),e.bind(Ft.ILayerService).to(cE).inSingletonScope(),e.bind(Ft.ISceneService).to(bE).inSingletonScope(),e.bind(Ft.ICameraService).to(W0).inSingletonScope(),e.bind(Ft.ICoordinateSystemService).to(K2).inSingletonScope(),e.bind(Ft.IInteractionService).to(rE).inSingletonScope(),e.bind(Ft.IPickingService).to(oE).inSingletonScope(),e.bind(Ft.IControlService).to(Rc).inSingletonScope(),e.bind(Ft.IMarkerService).to(Gp).inSingletonScope(),e.bind(Ft.IIconService).to(Np).inSingletonScope(),e.bind(Ft.IFontService).to(Fp).inSingletonScope(),e.bind(Ft.IPopupService).to(Z2).inSingletonScope(),e.bind(Ft.INormalPass).to(GE).whenTargetNamed("clear"),e.bind(Ft.INormalPass).to(qE).whenTargetNamed("pixelPicking"),e.bind(Ft.INormalPass).to(WS).whenTargetNamed("render"),e.bind(Ft.INormalPass).to(QS).whenTargetNamed("taa"),e.bind(Ft.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(Ft.INormalPass,r)}}),e.bind(Ft.IPostProcessingPass).to(ES).whenTargetNamed("copy"),e.bind(Ft.IPostProcessingPass).to(rS).whenTargetNamed("bloom"),e.bind(Ft.IPostProcessingPass).to(sS).whenTargetNamed("blurH"),e.bind(Ft.IPostProcessingPass).to(hS).whenTargetNamed("blurV"),e.bind(Ft.IPostProcessingPass).to(BS).whenTargetNamed("noise"),e.bind(Ft.IPostProcessingPass).to(VS).whenTargetNamed("sepia"),e.bind(Ft.IPostProcessingPass).to(gS).whenTargetNamed("colorHalftone"),e.bind(Ft.IPostProcessingPass).to(TS).whenTargetNamed("hexagonalPixelate"),e.bind(Ft.IPostProcessingPass).to(LS).whenTargetNamed("ink"),e.bind(Ft.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(Ft.IPostProcessingPass,r);return n.setName(r),n}}),e}function im(e){var i=new Jr.W2;return i.parent=e,i.bind(Ft.IStyleAttributeService).to(gE).inSingletonScope(),i.bind(Ft.IMultiPassRenderer).to(XE).inSingletonScope(),i.bind(Ft.IPostProcessor).to(jS).inSingletonScope(),i}var tC=null;function AR(e){return tC.indexOf(e)}var rC=2,TR=4,nC=64,MR=128,iC=256,aC=512,IR=8192,kR=16384,PR=32768,oC=null,c_=131072,LR=262144,sC=524288,RR=1048576,uC=2097152,OR=4194304,lC=8388608,cC=16777216,fC=null;function o0(e,i){return e=clamp(Math.floor(e),0,255),i=clamp(Math.floor(i),0,255),256*e+i}function DR(e){var i=e.color,r=e.radius,n=e.tileX,t=e.tileY,o=e.shape,u=e.opacity,c=e.stroke,p=e.strokeWidth,m=e.strokeOpacity,b=[],C=[],A=[],P=[o0(i[0],i[1]),o0(i[2],i[3])],O=[o0(c[0],c[1]),o0(c[2],c[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(D){var N=_slicedToArray(D,2),j=N[0],ae=N[1];b.push([].concat(P,[(j+1)*lC+(ae+1)*uC+getShapeIndex(o)*c_+r,(n+512)*sC+(t+512)*nC])),C.push([].concat(O,[p,m])),A.push([u,0,0,0])}),{packedBuffer:b,packedBuffer2:C,packedBuffer3:A}}function FR(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*fC+r*cC+n*c_+r*oC+n*aC+r*iC+n*rC+r}var uf;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(uf||(uf={}));var oo;(function(e){e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging"})(oo||(oo={}));var tp;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(tp||(tp={}));var gn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(gn||(gn={}));var am=["mapload","mapchange","mapAfterFrameChange"],Yp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},s0=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],rp;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(rp||(rp={}));function hC(e){var i=pC();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function pC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dC=0,u0=function(e){(0,hr.Z)(r,e);var i=hC(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this),t.controlOption=(0,oe.Z)((0,oe.Z)({},t.getDefault()),n||{}),t}return(0,yt.Z)(r,[{key:"getDefault",value:function(){return{position:rp.TOPRIGHT,name:"".concat(dC++)}}},{key:"setPosition",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:rp.BOTTOMRIGHT,o=this.controlService;return o&&o.removeControl(this),this.controlOption.position=t,o&&o.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(t){this.mapsService=t.get(Ft.IMapService),this.renderService=t.get(Ft.IRendererService),this.layerService=t.get(Ft.ILayerService),this.controlService=t.get(Ft.IControlService),this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd();var o=this.container,u=this.controlOption.position,c=this.controlService.controlCorners[u];return Ul(o,"l7-control"),u.indexOf("bottom")!==-1?c.insertBefore(o,c.firstChild):c.appendChild(o),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var t=this.container;Ul(t,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var t=this.container;Hc(t,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;Zu(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){var o=this.mapsService.getContainer();o!==null&&o.focus()}}}]),r}(iu.EventEmitter);function vC(e){var i=mC();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function mC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BR=function(e){(0,hr.Z)(r,e);var i=vC(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.layerControlInputs=[],t.layers=[],t.lastZIndex=0,t.handlingClick=!1,t.initLayers(),Ml(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,$e.Z)(t)),t}return(0,yt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:rp.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var t=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(o){o.layer.on("remove",t.onLayerChange),o.layer.on("add",t.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(t,o){return this.addLayer(t,o,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var t=this.renderService.getViewportSize(),o=t.height;Ul(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var u=o-(this.container.offsetTop+50);return u<this.form.clientHeight?(Ul(this.form,"l7-control-layers-scrollbar"),this.form.style.height=u+"px"):Hc(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Hc(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var t=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(o){o.layer.off("remove",t.onLayerChange),o.layer.off("add",t.onLayerChange)}))}},{key:"initLayout",value:function(){var t="l7-control-layers",o=this.container=Ia("div",t),u=this.controlOption.collapsed;o.setAttribute("aria-haspopup","true");var c=this.form=Ia("form",t+"-list");u&&(this.mapsService.on("click",this.collapse),o.addEventListener("mouseenter",this.expand),o.addEventListener("mouseleave",this.collapse)),this.layersLink=Ia("a",t+"-toggle",o);var p=this.layersLink;p.title="Layers",u||this.expand(),this.baseLayersList=Ia("div",t+"-base",c),this.separator=Ia("div",t+"-separator",c),this.overlaysList=Ia("div",t+"-overlays",c),o.appendChild(c)}},{key:"initLayers",value:function(){var t=this,o=this.controlOption,u=o.baseLayers,c=u===void 0?{}:u,p=o.overlayers,m=p===void 0?{}:p;Object.keys(c).forEach(function(b){t.addLayer(c[b],b,!1)}),Object.keys(m).forEach(function(b){t.addLayer(m[b],b,!0)})}},{key:"update",value:function(){if(!this.container)return this;Io(this.baseLayersList),Io(this.overlaysList),this.layerControlInputs=[];var t,o,u,c,p=0;for(u=0;u<this.layers.length;u++)c=this.layers[u],this.addItem(c),o=o||c.overlay,t=t||!c.overlay,p+=c.overlay?0:1;return this.controlOption.hideSingleBase&&(t=t&&p>1,this.baseLayersList.style.display=t?"":"none"),this.separator.style.display=o&&t?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var t=this.layerControlInputs,o,u,c=this.mapsService.getZoom(),p=t.length-1;p>=0;p--)if(o=t[p],u=this.layerService.getLayer(o.layerId),u&&u.inited){var m=u.getMinZoom(),b=u.getMaxZoom();o.disabled=c<m||c>b}}},{key:"addLayer",value:function(t,o,u){this.mapsService&&(t.on("add",this.onLayerChange),t.on("remove",this.onLayerChange)),this.layers.push({layer:t,name:o,overlay:u});var c=this.controlOption,p=c.sortLayers,m=c.sortFunction,b=c.autoZIndex;p&&this.layers.sort(function(C,A){return m(C.layer,A.layer,C.name,A.name)}),b&&t.setZIndex&&(this.lastZIndex++,t.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(t){this.handlingClick||this.update();var o=this.layerService.getLayer(t.target.layerId),u=o!=null&&o.overlay?t.type==="add"?"overlayadd":"overlayremove":t.type==="add"?"baselayerchange":null;u&&this.emit(u,o)}},{key:"createRadioElement",value:function(t,o){var u='<input type="radio" class="l7-control-layers-selector" name="'+t+'"'+(o?' checked="checked"':"")+"/>",c=document.createElement("div");return c.innerHTML=u,c.firstChild}},{key:"addItem",value:function(t){var o=document.createElement("label"),u=this.layerService.getLayer(t.layer.id),c=u&&u.inited&&t.layer.isVisible(),p;t.overlay?(p=document.createElement("input"),p.type="checkbox",p.className="l7-control-layers-selector",p.defaultChecked=c):p=this.createRadioElement("l7-base-layers",c),this.layerControlInputs.push(p),p.layerId=t.layer.id,p.addEventListener("click",this.onInputClick);var m=document.createElement("span");m.innerHTML=" "+t.name;var b=document.createElement("div");o.appendChild(b),b.appendChild(p),b.appendChild(m);var C=t.overlay?this.overlaysList:this.baseLayersList;return C.appendChild(o),this.checkDisabledLayers(),o}},{key:"onInputClick",value:function(){var t=this.layerControlInputs,o,u,c=[],p=[];this.handlingClick=!0;for(var m=t.length-1;m>=0;m--)o=t[m],u=this.layerService.getLayer(o.layerId),o.checked?c.push(u):o.checked||p.push(u);p.forEach(function(b){b.hide()}),c.forEach(function(b){b.show()}),this.handlingClick=!1}}]),r}(u0);function gC(e){var i=yC();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function yC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var f_=function(e){(0,hr.Z)(r,e);var i=gC(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getDefault",value:function(){return{position:rp.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var t="l7-control-logo",o=Ia("div",t),u=Ia("a","l7-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://antv.alipay.com/l7",u.setAttribute("aria-label","AntV logo"),u.setAttribute("rel","noopener nofollow"),o.appendChild(u),o}},{key:"onRemove",value:function(){return null}}]),r}(u0);function _C(e){var i=xC();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function xC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bC=function(e){(0,hr.Z)(r,e);var i=_C(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),Ml(["update"],(0,$e.Z)(t)),t}return(0,yt.Z)(r,[{key:"getDefault",value:function(){return{position:rp.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var t="l7-control-scale",o=Ia("div",t);this.addScales(t+"-line",o);var u=this.controlOption.updateWhenIdle;return this.mapsService.on(u?"moveend":"mapmove",this.update),this.mapsService.on(u?"zoomend":"zoomchange",this.update),this.update(),o}},{key:"onRemove",value:function(){var t=this.controlOption.updateWhenIdle;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var t=this.mapsService,o=this.controlOption.maxWidth,u=t.getSize()[1]/2,c=t.containerToLngLat([0,u]),p=t.containerToLngLat([o,u]),m=Cu([c.lng,c.lat],[p.lng,p.lat]);this.updateScales(m)}},{key:"updateScales",value:function(t){var o=this.controlOption,u=o.metric,c=o.imperial;u&&t&&this.updateMetric(t),c&&t&&this.updateImperial(t)}},{key:"updateMetric",value:function(t){var o=this.getRoundNum(t),u=o<1e3?o+" m":o/1e3+" km";this.updateScale(this.mScale,u,o/t)}},{key:"updateImperial",value:function(t){var o=t*3.2808399,u,c,p;o>5280?(u=o/5280,c=this.getRoundNum(u),this.updateScale(this.iScale,c+" mi",c/u)):(p=this.getRoundNum(o),this.updateScale(this.iScale,p+" ft",p/o))}},{key:"updateScale",value:function(t,o,u){var c=this.controlOption.maxWidth;t.style.width=Math.round(c*u)+"px",t.innerHTML=o}},{key:"getRoundNum",value:function(t){var o=Math.pow(10,(Math.floor(t)+"").length-1),u=t/o;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:1,o*u}},{key:"addScales",value:function(t,o){var u=this.controlOption,c=u.metric,p=u.imperial;c&&(this.mScale=Ia("div",t,o)),p&&(this.iScale=Ia("div",t,o))}}]),r}(u0);function EC(e){var i=SC();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function SC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CC=function(e){(0,hr.Z)(r,e);var i=EC(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),Ml(["updateDisabled","zoomIn","zoomOut"],(0,$e.Z)(t)),t}return(0,yt.Z)(r,[{key:"getDefault",value:function(){return{position:rp.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var t="l7-control-zoom",o=Ia("div",t+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,t+"-in",o,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,t+"-out",o,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),o}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(t,o,u,c,p){var m=Ia("a",u,c);return m.innerHTML=t,m.title=o,m.href="javascript:void(0)",m.addEventListener("click",p),m}},{key:"updateDisabled",value:function(){var t=this.mapsService,o="l7-disabled";Hc(this.zoomInButton,o),Hc(this.zoomOutButton,o),(this.disabled||t.getZoom()<=t.getMinZoom())&&Ul(this.zoomOutButton,o),(this.disabled||t.getZoom()>=t.getMaxZoom())&&Ul(this.zoomInButton,o)}}]),r}(u0);function wC(e){var i=AC();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function AC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h_=function(e){(0,hr.Z)(r,e);var i=wC(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this),(0,T.Z)((0,$e.Z)(t),"added",!1),(0,T.Z)((0,$e.Z)(t),"eventHandle",function(o){t.emit(o.type,{target:o,data:t.markerOption.extData,lngLat:t.lngLat})}),t.markerOption=(0,oe.Z)((0,oe.Z)({},t.getDefault()),n),Ml(["update","onMove","onUp","addDragHandler","onMapClick"],(0,$e.Z)(t)),t.init(),t}return(0,yt.Z)(r,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:k.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(t){this.scene=t,this.mapsService=t.get(Ft.IMapService),this.sceneSerive=t.get(Ft.ISceneService);var o=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var t=this.markerOption.element;return t&&Zu(t),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(t){var o=this;if(!this.added)return this.once("added",function(){o.setElement(t)}),this;var u=this.markerOption.element;return u&&Zu(u),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.update(),this}},{key:"openPopup",value:function(){var t=this;if(!this.added)return this.once("added",function(){t.openPopup()}),this;var o=this.popup;return o?(o.isOpen()||o.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var t=this;this.added||this.once("added",function(){t.closePopup()});var o=this.popup;return o&&o.remove(),this}},{key:"setPopup",value:function(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var t=this.popup;if(t)t.isOpen()?t.remove():t.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(t){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(t){this.markerOption.extData=t}},{key:"update",value:function(){if(!!this.mapsService){var t=this.markerOption,o=t.element,u=t.anchor;this.updatePosition(),Zl(o,"".concat(F[u]))}}},{key:"onMapClick",value:function(t){var o=this.markerOption.element;this.popup&&o&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var t=this.mapsService.getContainer();return{containerHeight:(t==null?void 0:t.scrollHeight)||0,containerWidth:(t==null?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var t=this.markerOption,o=t.element,u=t.offsets,c=this.lngLat,p=c.lng,m=c.lat,b=this.mapsService.lngLatToContainer([p,m]);if(o){o.style.display="block",o.style.whiteSpace="nowrap";var C=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),A=C.containerHeight,P=C.containerWidth,O=C.bounds;if(!O)return;if(Math.abs(O[0][0])>180||Math.abs(O[1][0])>180){if(b.x>P){var D=this.mapsService.lngLatToContainer([p-360,m]);b.x=D.x}if(b.x<0){var N=this.mapsService.lngLatToContainer([p+360,m]);b.x=N.x}}(b.x>P||b.x<0||b.y>A||b.y<0)&&(o.style.display="none"),o.style.left=b.x+u[0]+"px",o.style.top=b.y-u[1]+"px"}}}},{key:"init",value:function(){var t=this,o=this.markerOption.element,u=this.markerOption,c=u.color,p=u.anchor;if(!o){this.defaultMarker=!0,o=Ia("div"),this.markerOption.element=o;var m=document.createElementNS("http://www.w3.org/2000/svg","svg");m.setAttributeNS(null,"display","block"),m.setAttributeNS(null,"height","48px"),m.setAttributeNS(null,"width","48px"),m.setAttributeNS(null,"viewBox","0 0 1024 1024");var b=document.createElementNS("http://www.w3.org/2000/svg","path");b.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),b.setAttributeNS(null,"fill",c),m.appendChild(b),o.appendChild(m)}Ul(o,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(C){var A,P,O=((A=t.markerOption)===null||A===void 0?void 0:A.style)&&((P=t.markerOption)===null||P===void 0?void 0:P.style[C]);o&&(o.style[C]=O)}),o.addEventListener("click",function(C){t.onMapClick(C)}),o.addEventListener("click",this.eventHandle),G(o,p,"marker")}},{key:"registerMarkerEvent",value:function(t){t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var t=this.getElement();t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(t){throw new Error("Method not implemented.")}},{key:"onUp",value:function(t){throw new Error("Method not implemented.")}}]),r}(iu.EventEmitter);function TC(e){var i=MC();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function MC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NR=function(e){(0,hr.Z)(r,e);var i=TC(r);function r(n){var t,o;return(0,vt.Z)(this,r),o=i.call(this),(0,T.Z)((0,$e.Z)(o),"markers",[]),(0,T.Z)((0,$e.Z)(o),"points",[]),(0,T.Z)((0,$e.Z)(o),"clusterMarkers",[]),o.markerLayerOption=(0,Er.merge)(o.getDefault(),n),Ml(["update"],(0,$e.Z)(o)),o.zoom=((t=o.markerLayerOption.clusterOption)===null||t===void 0?void 0:t.zoom)||-99,o}return(0,yt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(t){return this.scene=t,this.mapsService=t.get(Ft.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var t=this.mapsService.getContainer();this.containerSize={containerWidth:(t==null?void 0:t.scrollWidth)||0,containerHeight:(t==null?void 0:t.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(t){var o=this.markerLayerOption.cluster;if(t.getMarkerLayerContainerSize=this.getContainerSize.bind(this),o&&(this.addPoint(t,this.markers.length),this.mapsService)){var u=this.mapsService.getZoom(),c=this.mapsService.getBounds();this.bbox=pu(c,.5),this.zoom=Math.floor(u),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(t)}},{key:"removeMarker",value:function(t){this.markers.indexOf(t);var o=this.markers.indexOf(t);o>-1&&this.markers.splice(o,1)}},{key:"hide",value:function(){this.markers.map(function(t){t.getElement().style.opacity="0"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(t){t.getElement().style.opacity="1"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var t=this.markerLayerOption.cluster;return t?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var t=this;this.getMarkers().forEach(function(o){o.addTo(t.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(t){t.remove()}),this.clusterMarkers.forEach(function(t){t.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(t,o){var u=t.getLnglat(),c=u.lng,p=u.lat,m={geometry:{type:"Point",coordinates:[c,p]},properties:(0,oe.Z)((0,oe.Z)({},t.getExtData()),{},{marker_id:o})};this.points.push(m),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var t=this.markerLayerOption.clusterOption,o=t.radius,u=t.minZoom,c=u===void 0?0:u,p=t.maxZoom;this.clusterIndex=new(Kn())({radius:o,minZoom:c,maxZoom:p}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(t,o){var u=this,c=t[0].concat(t[1]),p=this.clusterIndex.getClusters(c,o);this.clusterMarkers.forEach(function(m){m.remove()}),this.clusterMarkers=[],p.forEach(function(m){var b,C=u.markerLayerOption.clusterOption,A=C.field,P=C.method;if((b=m.properties)!==null&&b!==void 0&&b.cluster_id){var O,D=u.getLeaves((O=m.properties)===null||O===void 0?void 0:O.cluster_id);if(m.properties.clusterData=D,A&&P){var N=D==null?void 0:D.map(function(Re){var Ke=(0,T.Z)({},A,Re.properties[A]);return Ke}),j=vc(N,A),ae=Cl(P,j),re="point_"+P;m.properties[re]=ae.toFixed(2)}}var Te=u.clusterMarker(m);u.clusterMarkers.push(Te),Te.addTo(u.scene)})}},{key:"getLeaves",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return t?this.clusterIndex.getLeaves(t,o,u):null}},{key:"clusterMarker",value:function(t){var o=this.markerLayerOption.clusterOption,u=o,c=u.element,p=c===void 0?this.generateElement.bind(this):c,m=new h_({element:p(t)}).setLnglat({lng:t.geometry.coordinates[0],lat:t.geometry.coordinates[1]});return m}},{key:"normalMarker",value:function(t){var o=t.properties.marker_id;return this.markers[o]}},{key:"update",value:function(){if(!!this.mapsService&&this.markers.length!==0){var t=this.mapsService.getZoom(),o=this.mapsService.getBounds();(!this.bbox||Math.abs(t-this.zoom)>=1||!Al(this.bbox,o))&&(this.bbox=pu(o,.5),this.zoom=Math.floor(t),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(t){var o=Ia("div","l7-marker-cluster"),u=Ia("div","",o),c=Ia("span","",u),p=this.markerLayerOption.clusterOption,m=p.field,b=p.method;t.properties.point_count=t.properties.point_count||1;var C=m&&b?t.properties["point_"+b]||t.properties[m]:t.properties.point_count;return c.textContent=C,o}}]),r}(iu.EventEmitter);function IC(e){var i=kC();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function kC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p_=function(e){(0,hr.Z)(r,e);var i=IC(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this),t.popupOption=(0,oe.Z)((0,oe.Z)({},t.getdefault()),n),Ml(["update","onClickClose","remove"],(0,$e.Z)(t)),t}return(0,yt.Z)(r,[{key:"addTo",value:function(t){var o=this;return this.mapsService=t.get(Ft.IMapService),this.sceneSerive=t.get(Ft.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){o.mapsService.on("click",o.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(t){var o=window.document.createDocumentFragment(),u=window.document.createElement("body"),c;for(u.innerHTML=t;c=u.firstChild,!!c;)o.appendChild(c);return this.setDOMContent(o)}},{key:"setLnglat",value:function(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(t){return this.setDOMContent(window.document.createTextNode(t))}},{key:"setMaxWidth",value:function(t){return this.popupOption.maxWidth=t,this.update(),this}},{key:"setDOMContent",value:function(t){return this.createContent(),this.content.appendChild(t),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&Zu(this.content),this.content=Ia("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Ia("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(t,o,u){var c=window.document.createElement(t);return o!==void 0&&(c.className=o),u&&u.appendChild(c),c}},{key:"removeDom",value:function(t){t.parentNode&&t.parentNode.removeChild(t)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:k.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(t){t.stopPropagation&&t.stopPropagation(),this.remove()}},{key:"update",value:function(){var t=this,o=this.lngLat,u=this.popupOption,c=u.className,p=u.maxWidth,m=u.anchor;if(!(!this.mapsService||!o||!this.content)){var b=this.mapsService.getMarkerContainer();if(!this.container&&b){this.container=this.creatDom("div","l7-popup",b),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),c&&c.split(" ").forEach(function(A){return t.container.classList.add(A)});var C=this.popupOption.stopPropagation;C&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(A){t.container.addEventListener(A,function(P){P.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}p&&this.container.style.maxWidth!==p&&(this.container.style.maxWidth=p),this.updatePosition(),Zl(this.container,"".concat(F[m])),G(this.container,m,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var t=this.lngLat,o=t.lng,u=t.lat,c=this.popupOption.offsets,p=this.mapsService.lngLatToContainer([o,u]);this.container.style.left=p.x+c[0]+"px",this.container.style.top=p.y-c[1]+"px"}}}]),r}(iu.EventEmitter);function PC(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}PC(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
          box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var np,om=(np={},(0,T.Z)(np,uf.additive,{enable:!0,func:{srcRGB:H.ONE,dstRGB:H.ONE,srcAlpha:1,dstAlpha:1}}),(0,T.Z)(np,uf.none,{enable:!1}),(0,T.Z)(np,uf.normal,{enable:!0,func:{srcRGB:H.SRC_ALPHA,dstRGB:H.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,T.Z)(np,uf.subtractive,{enable:!0,func:{srcRGB:H.ONE,dstRGB:H.ONE,srcAlpha:H.ZERO,dstAlpha:H.ONE_MINUS_SRC_COLOR},equation:{rgb:H.FUNC_SUBTRACT,alpha:H.FUNC_SUBTRACT}}),(0,T.Z)(np,uf.max,{enable:!0,func:{srcRGB:H.ONE,dstRGB:H.ONE},equation:{rgb:H.MAX_EXT}}),(0,T.Z)(np,uf.min,{enable:!0,func:{srcRGB:H.ONE,dstRGB:H.ONE},equation:{rgb:H.MIN_EXT}}),np);function dl(e,i,r,n,t){i.updateStyleAttribute(e,r,n,t)}function LC(e,i){i.tileLayer||i.isTileLayer||(e.opacity&&l0("opacity",i,e.opacity),e.strokeWidth&&l0("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&l0("strokeOpacity",i,e.strokeOpacity),e.stroke&&RC("stroke",i,e.stroke),e.offsets&&d_("offsets",i,e.offsets),e.textOffset&&d_("textOffset",i,e.textOffset),e.thetaOffset&&l0("thetaOffset",i,e.thetaOffset))}function l0(e,i,r){(0,Er.isString)(r)?dl(e,i,r,function(n){return n}):(0,Er.isNumber)(r)?dl(e,i,[r],void 0):Array.isArray(r)&&r.length===2?(0,Er.isString)(r[0])&&(0,Er.isFunction)(r[1])||(0,Er.isString)(r[0])&&Array.isArray(r[1])&&(0,Er.isNumber)(r[1][0])&&(0,Er.isNumber)(r[1][1])?dl(e,i,r[0],r[1]):dl(e,i,[1],void 0):dl(e,i,[1],void 0)}function d_(e,i,r){(0,Er.isString)(r)?dl(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&(0,Er.isString)(r[0])&&(0,Er.isFunction)(r[1])?dl(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&(0,Er.isNumber)(r[0])&&(0,Er.isNumber)(r[1])?dl(e,i,r,void 0):dl(e,i,[0,0],void 0)}function RC(e,i,r){(0,Er.isString)(r)?dl(e,i,r,void 0):Array.isArray(r)&&r.length===2&&((0,Er.isString)(r[0])&&(0,Er.isFunction)(r[1])||(0,Er.isString)(r[0])&&Array.isArray(r[1])&&r[1].length>0)?dl(e,i,r[0],r[1]):dl(e,i,"#fff",void 0)}var ts;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(ts||(ts={}));function OC(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=Yl(r),t=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return t}function DC(e,i,r){if(e.length>0&&i.version===ts["GAODE2.x"]){var n=r.coordCenter;typeof e[0].coordinates[0]=="number"?e.filter(function(t){return!t.originCoordinates}).map(function(t){t.version=ts["GAODE2.x"],t.originCoordinates=(0,Er.cloneDeep)(t.coordinates),t.coordinates=i.lngLatToCoordByLayer(t.coordinates,n)}):e.filter(function(t){return!t.originCoordinates}).map(function(t){t.version=ts["GAODE2.x"],t.originCoordinates=(0,Er.cloneDeep)(t.coordinates),t.coordinates=i.lngLatToCoordsByLayer(t.coordinates,n)})}}function FC(e,i){e.length>0&&i.version===ts.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=BC(r.coordinates,i),r.simpleCoordinate=!0)})}function BC(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(t){var o=[];t.map(function(u){o.push(i.simpleMapCoord.unproject(u))}),r.push(o)}),r}else{var n=[];return e.map(function(t){n.push(i.simpleMapCoord.unproject(t))}),n}}function NC(e,i,r){var n;if(!e.scale)return[];var t=(e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers)||[],o=[];t.forEach(function(c){var p,m=c.field;(i.hasOwnProperty(m)||((p=e.scale)===null||p===void 0?void 0:p.type)==="variable")&&o.push(i[m])});var u=e.mapping?e.mapping(o):[];return e.name==="color"&&!d(u[0])?[r]:u}function zC(e,i,r,n,t,o){var u=o==null?void 0:o.getLayerConfig(),c=u.arrow,p=c===void 0?{enable:!1}:c,m=i.map(function(b){var C={id:b._id,coordinates:b.coordinates};if(e.filter(function(O){return O.scale!==void 0}).forEach(function(O){var D=NC(O,b,t);O.needRemapping=!1,O.name==="color"&&(D=D.map(function(N){return h(N)})),C[O.name]=Array.isArray(D)&&D.length===1?D[0]:D,O.name==="shape"&&(C.shape=r.getIconFontKey(C[O.name]))}),C.shape==="line"&&p.enable){var A=C.coordinates,P=OC(A[0],A[1]);C.coordinates.splice(1,0,P,P)}return C});return DC(m,n,o),FC(m,n),m}function UC(e,i,r,n,t,o){var u=new us(t,o),c=e.getBottomColor(),p=n.getLayerStyleAttributes()||[],m=u.data.dataArray,b=m,C=zC(p,b,i,r,c,e);return u.destroy(),C}function v_(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function m_(e,i,r,n){var t=e.multiPassRenderer,o=e.getLayerConfig(),u=o.enableTAA;return u?t.add(n("taa")):t.add(n("render")),v_(i).forEach(function(c){var p=(0,ce.Z)(c,2),m=p[0],b=p[1];t.add(r(m),b)}),t.add(r("copy")),t}var ZC=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function VC(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}ZC.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var jC=["passes"],GC=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber","workerEnabled","workerOptions"],g_,sm,y_;function HC(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=WC(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var m=r.next();return o=m.done,m},e:function(m){u=!0,c=m},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function WC(e,i){if(!!e){if(typeof e=="string")return __(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return __(e,i)}}function __(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function XC(e){var i=YC();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function YC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x_=0,Uf=(g_=nm(Ft.IGlobalConfigService),sm=function(e){(0,hr.Z)(r,e);var i=XC(r);function r(){var n,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,vt.Z)(this,r),n=i.call(this),(0,T.Z)((0,$e.Z)(n),"id","".concat(x_++)),(0,T.Z)((0,$e.Z)(n),"name","".concat(x_)),(0,T.Z)((0,$e.Z)(n),"visible",!0),(0,T.Z)((0,$e.Z)(n),"zIndex",0),(0,T.Z)((0,$e.Z)(n),"inited",!1),(0,T.Z)((0,$e.Z)(n),"layerModelNeedUpdate",!1),(0,T.Z)((0,$e.Z)(n),"pickedFeatureID",null),(0,T.Z)((0,$e.Z)(n),"selectedFeatureID",null),(0,T.Z)((0,$e.Z)(n),"styleNeedUpdate",!1),(0,T.Z)((0,$e.Z)(n),"forceRender",!1),(0,T.Z)((0,$e.Z)(n),"clusterZoom",0),(0,T.Z)((0,$e.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,T.Z)((0,$e.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,T.Z)((0,$e.Z)(n),"hooks",{init:new sr,afterInit:new sr,beforeRender:new sr,beforeRenderData:new ir,afterRender:new ve,beforePickingEncode:new ve,afterPickingEncode:new ve,beforeHighlight:new ve(["pickedColor"]),afterHighlight:new ve,beforeSelect:new ve(["pickedColor"]),afterSelect:new ve,beforeDestroy:new ve,afterDestroy:new ve}),(0,T.Z)((0,$e.Z)(n),"models",[]),(0,T.Z)((0,$e.Z)(n),"modelLoaded",!1),(0,T.Z)((0,$e.Z)(n),"layerChildren",[]),(0,T.Z)((0,$e.Z)(n),"masks",[]),(0,T.Z)((0,$e.Z)(n),"isVector",!1),na((0,$e.Z)(n),"configService",y_,(0,$e.Z)(n)),(0,T.Z)((0,$e.Z)(n),"animateOptions",{enable:!1}),(0,T.Z)((0,$e.Z)(n),"currentPickId",null),(0,T.Z)((0,$e.Z)(n),"pendingStyleAttributes",[]),(0,T.Z)((0,$e.Z)(n),"scaleOptions",{}),(0,T.Z)((0,$e.Z)(n),"animateStatus",!1),(0,T.Z)((0,$e.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,T.Z)((0,$e.Z)(n),"isDestroyed",!1),(0,T.Z)((0,$e.Z)(n),"encodeDataLength",0),(0,T.Z)((0,$e.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var o=n.getLayerConfig();o&&o.autoFit&&n.fitBounds(o.fitBoundsOptions),n.reRender()}),n.name=t.name||n.id,n.zIndex=t.zIndex||0,n.rawConfig=t,n}return(0,yt.Z)(r,[{key:"addMaskLayer",value:function(t){this.masks.push(t)}},{key:"removeMaskLayer",value:function(t){var o=this.masks.indexOf(t);o>-1&&this.masks.splice(o,1),t.destroy()}},{key:"getAttribute",value:function(t){return this.styleAttributeService.getLayerStyleAttribute(t)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(t){var o=this;if(Object.keys(t).map(function(c){c in o.rawConfig&&(o.rawConfig[c]=t[c])}),!this.inited)this.needUpdateConfig=(0,oe.Z)((0,oe.Z)({},this.needUpdateConfig),t);else{var u=this.container.get(Ft.SceneID);LC(t,this),this.configService.setLayerConfig(u,this.id,(0,oe.Z)((0,oe.Z)((0,oe.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(t,o){this.container=t,this.sceneContainer=o}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(t){this.bottomColor=t}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(t){return this.plugins.push(t),this}},{key:"init",value:function(){var t=this,o=this.container.get(Ft.SceneID);this.configService.setLayerConfig(o,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Ft.IIconService),this.fontService=this.container.get(Ft.IFontService),this.rendererService=this.container.get(Ft.IRendererService),this.layerService=this.container.get(Ft.ILayerService),this.interactionService=this.container.get(Ft.IInteractionService),this.pickingService=this.container.get(Ft.IPickingService),this.mapService=this.container.get(Ft.IMapService);var u=this.getLayerConfig(),c=u.enableMultiPassRenderer,p=u.passes;c&&p!==null&&p!==void 0&&p.length&&p.length>0&&this.mapService.on("mapAfterFrameChange",function(){t.renderLayers()}),this.cameraService=this.container.get(Ft.ICameraService),this.coordinateService=this.container.get(Ft.ICoordinateSystemService),this.shaderModuleService=this.container.get(Ft.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Ft.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Ft.IFactoryNormalPass),this.styleAttributeService=this.container.get(Ft.IStyleAttributeService),this.multiPassRenderer=this.container.get(Ft.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(A){var P=A.attributeName,O=A.attributeField,D=A.attributeValues,N=A.updateOptions;t.styleAttributeService.updateStyleAttribute(P,{scale:(0,oe.Z)({field:O},t.splitValuesAndCallbackInAttribute(D,t.getLayerConfig()[P]))},N)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Ft.ILayerPlugin);var m=HC(this.plugins),b;try{for(m.s();!(b=m.n()).done;){var C=b.value;C.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(A){m.e(A)}finally{m.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models.map(function(o){o.updateAttributesAndElements(t.attributes,t.elements)}):console.warn("data error")}},{key:"createModelData",value:function(t,o){var u;if((u=this.layerModel)!==null&&u!==void 0&&u.createModelData)return this.layerModel.createModelData(o);var c=this.calculateEncodeData(t,o),p=this.triangulation;return c&&p?this.styleAttributeService.createAttributesAndIndices(c,p):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(t,o){return this.inited?UC(this,this.fontService,this.mapService,this.styleAttributeService,t,o):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig((0,oe.Z)((0,oe.Z)({},this.getDefaultConfig()),this.rawConfig));var t=this.getLayerConfig(),o=t.animateOption;o!=null&&o.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(t,o,u){return this.updateStyleAttribute("color",t,o,u),this}},{key:"texture",value:function(t,o,u){return this.updateStyleAttribute("texture",t,o,u),this}},{key:"rotate",value:function(t,o,u){return this.updateStyleAttribute("rotate",t,o,u),this}},{key:"size",value:function(t,o,u){return this.updateStyleAttribute("size",t,o,u),this}},{key:"filter",value:function(t,o,u){return this.updateStyleAttribute("filter",t,o,u),this}},{key:"shape",value:function(t,o,u){var c,p,m,b=(c=this.styleAttributeService)===null||c===void 0||(p=c.getLayerStyleAttribute("shape"))===null||p===void 0||(m=p.scale)===null||m===void 0?void 0:m.field,C=t;return this.shapeOption={field:t,values:o},this.updateStyleAttribute("shape",t,o,u),this.tileLayer||VC(this,b,C),this}},{key:"label",value:function(t,o,u){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:o,updateOptions:u}),this}},{key:"animate",value:function(t){var o={};return(0,Er.isObject)(t)?(o.enable=!0,o=(0,oe.Z)((0,oe.Z)({},o),t)):o.enable=t,this.updateLayerConfig({animateOption:o}),this}},{key:"source",value:function(t,o){return(t==null?void 0:t.type)==="source"?(this.setSource(t),this):(this.sourceOption={data:t,options:o},this.clusterZoom=0,this)}},{key:"setData",value:function(t,o){var u=this;return this.inited?this.layerSource.setData(t,o):this.on("inited",function(){var c=u.getSource();c?u.layerSource.setData(t,o):(u.source(new us(t,o)),u.sourceEvent())}),this}},{key:"style",value:function(t){var o=this,u=this.getLayerConfig(),c=t.passes,p=(0,sf.Z)(t,jC);return c&&v_(c).forEach(function(m){var b=o.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(m[0]);b&&b.updateOptions(m[1])}),this.rawConfig=(0,oe.Z)((0,oe.Z)({},this.rawConfig),p),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),u&&u.mask===!0&&t.mask===!1&&(this.clearModels(),this.layerModel.buildModels(function(m){o.models=m})),this}},{key:"scale",value:function(t,o){return(0,Er.isObject)(t)?this.scaleOptions=(0,oe.Z)((0,oe.Z)({},this.scaleOptions),t):this.scaleOptions[t]=o,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer?(this.tileLayer.render(),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(),this)}},{key:"renderMultiPass",value:function(){var n=(0,ue.Z)(te().mark(function o(){return te().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){c.next=2;break}return c.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){c.next=7;break}return c.next=5,this.multiPassRenderer.render();case 5:c.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return c.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"active",value:function(t){var o={};return o.enableHighlight=(0,Er.isObject)(t)?!0:t,(0,Er.isObject)(t)?(o.enableHighlight=!0,t.color&&(o.highlightColor=t.color),t.mix&&(o.activeMix=t.mix)):o.enableHighlight=!!t,this.updateLayerConfig(o),this}},{key:"setActive",value:function(t,o){var u=this;if((0,Er.isObject)(t)){var c=t.x,p=c===void 0?0:c,m=t.y,b=m===void 0?0:m;this.updateLayerConfig({highlightColor:(0,Er.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,Er.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.pick({x:p,y:b})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:(0,Er.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,Er.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(S(t)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"select",value:function(t){var o={};return o.enableSelect=(0,Er.isObject)(t)?!0:t,(0,Er.isObject)(t)?(o.enableSelect=!0,t.color&&(o.selectColor=t.color),t.mix&&(o.selectMix=t.mix)):o.enableSelect=!!t,this.updateLayerConfig(o),this}},{key:"setSelect",value:function(t,o){var u=this;if((0,Er.isObject)(t)){var c=t.x,p=c===void 0?0:c,m=t.y,b=m===void 0?0:m;this.updateLayerConfig({selectColor:(0,Er.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,Er.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.pick({x:p,y:b})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:(0,Er.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,Er.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(S(t)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"setBlend",value:function(t){return this.updateLayerConfig({blend:t}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(t){this.currentPickId=t}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(t){this.selectedFeatureID=t}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var t=this.mapService.getZoom(),o=this.getLayerConfig(),u=o.visible,c=o.minZoom,p=c===void 0?-Infinity:c,m=o.maxZoom,b=m===void 0?Infinity:m;return!!u&&t>=p&&t<=b}},{key:"setMultiPass",value:function(t,o){if(this.updateLayerConfig({enableMultiPassRenderer:t}),o&&this.updateLayerConfig({passes:o}),t){var u=this.getLayerConfig(),c=u.passes,p=c===void 0?[]:c;this.multiPassRenderer=m_(this,p,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var m=this.rendererService.getViewportSize(),b=m.width,C=m.height;this.multiPassRenderer.resize(b,C)}return this}},{key:"setMinZoom",value:function(t){return this.updateLayerConfig({minZoom:t}),this}},{key:"getMinZoom",value:function(){var t=this.getLayerConfig(),o=t.minZoom;return o}},{key:"getMaxZoom",value:function(){var t=this.getLayerConfig(),o=t.maxZoom;return o}},{key:"get",value:function(t){var o=this.getLayerConfig();return o[t]}},{key:"setMaxZoom",value:function(t){return this.updateLayerConfig({maxZoom:t}),this}},{key:"setAutoFit",value:function(t){return this.updateLayerConfig({autoFit:t}),this}},{key:"fitBounds",value:function(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var o=this.getSource(),u=o.extent,c=u.some(function(p){return Math.abs(p)===Infinity});return c?this:(this.mapService.fitBounds([[u[0],u[1]],[u[2],u[3]]],t),this)}},{key:"destroy",value:function(){var t,o,u,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isDestroyed||(this.layerChildren.map(function(p){return p.destroy(!1)}),this.layerChildren=[],this.masks.map(function(p){return p.destroy(!1)}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(t=this.multiPassRenderer)===null||t===void 0||t.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(o=this.layerModel)===null||o===void 0||o.clearModels(c),(u=this.tileLayer)===null||u===void 0||u.destroy(),this.models=[],this.layerService.cleanRemove(this,c),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var t;this.models.forEach(function(o){return o.destroy()}),(t=this.layerModel)===null||t===void 0||t.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(t){return t.needRescale||t.needRemapping||t.needRegenerateVertices}).length}},{key:"setSource",value:function(t){var o=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(){if(o.coordCenter===void 0){var c,p=o.layerSource.center;o.coordCenter=p,((c=o.mapService)===null||c===void 0?void 0:c.setCoordCenter)&&o.mapService.setCoordCenter(p)}o.sourceEvent()})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(t){this.encodedData=t,this.encodeDataLength=t.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(t){return this.styleAttributeService.getLayerAttributeScale(t)}},{key:"getLegend",value:function(t){var o,u,c,p=this.styleAttributeService.getLayerStyleAttribute(t),m=(p==null||(o=p.scale)===null||o===void 0?void 0:o.scalers)||[];return{type:(u=m[0].option)===null||u===void 0?void 0:u.type,field:p==null||(c=p.scale)===null||c===void 0?void 0:c.field,items:this.getLegendItems(t)}}},{key:"getLegendItems",value:function(t){var o=this.styleAttributeService.getLayerAttributeScale(t);if(!o)return[];if(o.invertExtent){var u=o.range().map(function(m){return(0,T.Z)({value:o.invertExtent(m)},t,m)});return u}else if(o.ticks){var c=o.ticks().map(function(m){return(0,T.Z)({value:m},t,o(m))});return c}else if(o!=null&&o.domain){var p=o.domain().filter(function(m){return!(0,Er.isUndefined)(m)}).map(function(m){return(0,T.Z)({value:m},t,o(m))});return p}return[]}},{key:"pick",value:function(t){var o=t.x,u=t.y;this.interactionService.triggerHover({x:o,y:u})}},{key:"boxSelect",value:function(t,o){this.pickingService.boxPickLayer(this,t,o)}},{key:"buildLayerModel",value:function(t){var o=this,u=t.moduleName,c=t.vertexShader,p=t.fragmentShader,m=t.triangulation,b=t.segmentNumber,C=t.workerEnabled,A=C===void 0?!1:C,P=t.workerOptions,O=(0,sf.Z)(t,GC);this.shaderModuleService.registerModule(u,{vs:c,fs:p});var D=this.shaderModuleService.getModule(u),N=D.vs,j=D.fs,ae=D.uniforms,re=this.rendererService.createModel;return new Promise(function(Te,Re){setTimeout(function(){if(P&&P.modelType in ud&&A)o.styleAttributeService.createAttributesAndIndicesAscy(o.encodedData,b,P).then(function(Tr){var Sn=Tr.attributes,Un=Tr.elements,Vi=re((0,oe.Z)({attributes:Sn,uniforms:ae,fs:j,vs:N,elements:Un,blend:om[uf.normal]},O));Te(Vi)}).catch(function(Tr){return Re(Tr)});else{var Ke=o.styleAttributeService.createAttributesAndIndices(o.encodedData,m,b),gt=Ke.attributes,lt=Ke.elements,Ut=Ke.count,or=(0,oe.Z)({attributes:gt,uniforms:ae,fs:j,vs:N,elements:lt,blend:om[uf.normal]},O);Ut&&(or.count=Ut);var cr=re(or);Te(cr)}})})}},{key:"createAttributes",value:function(t){var o=t.triangulation,u=this.styleAttributeService.createAttributes(this.encodedData,o),c=u.attributes;return c}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(t){if(this.rawConfig.usage==="basemap")return!1;var o=this.getLayerConfig(),u=o.enableHighlight,c=u===void 0?!0:u,p=o.enableSelect,m=p===void 0?!0:p,b=this.eventNames().indexOf(t)!==-1||this.eventNames().indexOf("un"+t)!==-1;return(t==="click"||t==="dblclick")&&m&&(b=!0),t==="mousemove"&&(c||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(b=!0),this.isVisible()&&b}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,ue.Z)(te().mark(function o(u){return te().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,u.render();case 2:case"end":return p.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"renderModels",value:function(t){var o=this;return this.encodeDataLength<=0&&!this.forceRender?this:(this.layerModelNeedUpdate&&this.layerModel&&this.layerModel.buildModels(function(u){o.models=u,o.hooks.beforeRender.call(),o.layerModelNeedUpdate=!1}),this.models.forEach(function(u){u.draw({uniforms:o.layerModel.getUninforms()},t)}),this)}},{key:"updateStyleAttribute",value:function(t,o,u,c){this.inited?this.styleAttributeService.updateStyleAttribute(t,{scale:(0,oe.Z)({field:o},this.splitValuesAndCallbackInAttribute(u,this.getLayerConfig()[o]))},c):this.pendingStyleAttributes.push({attributeName:t,attributeField:o,attributeValues:u,updateOptions:c})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(t){console.warn("empty fn")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"dispatchModelLoad",value:function(t){var o=this;this.models.forEach(function(u){return u.destroy()}),this.models=[],this.models=t,this.emit("modelLoaded",null),this.modelLoaded=!0,setTimeout(function(){o.layerService.renderLayers()},32)}},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(t,o){return{values:(0,Er.isFunction)(t)?void 0:t||o,callback:(0,Er.isFunction)(t)?t:void 0}}}]),r}(iu.EventEmitter),y_=ta(sm.prototype,"configService",[g_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sm),b_,um,E_;function $C(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=qC(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var m=r.next();return o=m.done,m},e:function(m){u=!0,c=m},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function qC(e,i){if(!!e){if(typeof e=="string")return S_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return S_(e,i)}}function S_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var ya=(b_=nm(Ft.IGlobalConfigService),um=function(){function e(i){(0,vt.Z)(this,e),na(this,"configService",E_,this),this.layer=i,this.rendererService=i.getContainer().get(Ft.IRendererService),this.pickingService=i.getContainer().get(Ft.IPickingService),this.shaderModuleService=i.getContainer().get(Ft.IShaderModuleService),this.styleAttributeService=i.getContainer().get(Ft.IStyleAttributeService),this.mapService=i.getContainer().get(Ft.IMapService),this.iconService=i.getContainer().get(Ft.IIconService),this.fontService=i.getContainer().get(Ft.IFontService),this.cameraService=i.getContainer().get(Ft.ICameraService),this.layerService=i.getContainer().get(Ft.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:H.NEAREST,min:H.NEAREST,width:1,height:1}))}return(0,yt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertiesExist.hasOpacity,this.stylePropertiesExist.hasStrokeOpacity,this.stylePropertiesExist.hasStrokeWidth,this.stylePropertiesExist.hasStroke,this.stylePropertiesExist.hasOffsets,this.stylePropertiesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return(0,Er.isEqual)(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),(0,Er.isEqual)(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),(0,Er.isEqual)(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),(0,Er.isEqual)(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),(0,Er.isEqual)(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),(0,Er.isEqual)(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!(0,Er.isNumber)(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertiesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!(0,Er.isNumber)(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertiesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!(0,Er.isNumber)(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertiesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertiesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertiesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!(0,Er.isNumber)(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertiesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return(0,Er.isString)(r)?!!(0,f.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=h(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&(0,Er.isNumber)(r[0])&&(0,Er.isNumber)(r[1]))}},{key:"patchMod",value:function(r,n){for(var t=0;t<n;t++)r.push(-1)}},{key:"patchData",value:function(r,n,t){var o=$C(t),u;try{for(o.s();!(u=o.n()).done;){var c=u.value,p=c.attr,m=c.count,b=n[p];b!==void 0?p==="stroke"?r.push.apply(r,(0,ee.Z)(h(b))):p==="offsets"?this.isOffsetStatic(b)?r.push(-b[0],b[1]):r.push(0,0):r.push((0,Er.isNumber)(b)?b:1):this.patchMod(r,m)}}catch(C){o.e(C)}finally{o.f()}}},{key:"calDataFrame",value:function(r,n,t){for(var o=n.length,u=Math.ceil(o*r/this.DATA_TEXTURE_WIDTH),c=u*this.DATA_TEXTURE_WIDTH,p=[],m=0;m<o;m++){var b=n[m];this.patchData(p,b,t)}for(var C=p.length;C<c;C++)p.push(-1);return{data:p,width:this.DATA_TEXTURE_WIDTH,height:u}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,t=n===void 0?"normal":n;return om[uf[t]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(r){throw new Error("Method not implemented.")}},{key:"initModels",value:function(r){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),E_=ta(um.prototype,"configService",[b_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),um),lm=100,zR=36,UR=40;function C_(e){return e/180*Math.acos(-1)}function w_(e){var i=C_(e[0])+Math.PI/2,r=C_(e[1]),n=lm+Math.random()*.4,t=n*Math.cos(r)*Math.cos(i),o=n*Math.cos(r)*Math.sin(i),u=n*Math.sin(r);return[o,u,t]}function ZR(e,i){var r=mat4.create(),n=mat4.create(),t=vec3.fromValues(0,1,0),o=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var u=typeof i.segments!="undefined"?i.segments:32,c=2+u,p=2*c,m=[],b=[],C=[],A=[],P=[],O=[],D=0;D<=c;D++){for(var N=D/c,j=N*Math.PI,ae=0;ae<=p;ae++){var re=ae/p,Te=re*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-j),mat4.identity(r),mat4.rotateY(r,r,Te),vec3.transformMat4(o,t,n),vec3.transformMat4(o,o,r),vec3.scale(o,o,-e),C.push(o.slice()),A.push.apply(A,_toConsumableArray(o.slice())),vec3.normalize(o,o),P.push.apply(P,_toConsumableArray(o.slice())),O.push([re,1-N]),A.push(re,1-N)}if(D>0)for(var Re=C.length,Ke=Re-2*(p+1);Ke+p+2<Re;Ke++)m.push([Ke,Ke+1,Ke+p+1]),b.push(Ke,Ke+1,Ke+p+1),m.push([Ke+p+1,Ke+1,Ke+p+2]),b.push(Ke+p+1,Ke+1,Ke+p+2)}return{cells:m,positions:C,uvs:O,positionsArr:A,indicesArr:b,normalArr:P}}var c0=jr.create(),VR=jr.create(),Ys=jr.create(),ip=jr.create(),Id=jr.create();function cm(e,i,r,n,t){jr.add(e,r,n),jr.normalize(e,e),i=jr.fromValues(-e[1],e[0]);var o=jr.fromValues(-r[1],r[0]);return[t/jr.dot(i,o),i]}function ap(e,i){return jr.set(e,-i[1],i[0])}function kd(e,i,r){return jr.sub(e,i,r),jr.normalize(e,e),e}function fm(e,i){return e[0]===i[0]&&e[1]===i[1]}function jR(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var KC=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,vt.Z)(this,e),(0,T.Z)(this,"lastFlip",-1),(0,T.Z)(this,"miter",jr.fromValues(0,0)),(0,T.Z)(this,"started",!1),(0,T.Z)(this,"dash",!1),(0,T.Z)(this,"totalDistance",0),(0,T.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,yt.Z)(e,[{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var c=r[u-1],p=r[u],m=u<r.length-1?r[u+1]:null,b=this.simpleSegment(n,o,c,p,m);o+=b}if(this.dash)for(var C=0;C<n.positions.length/6;C++)n.positions[C*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,c=1;c<o;c++){var p,m,b,C=r[c-1];C.push((p=n[c-1][2])!==null&&p!==void 0?p:0);var A=n[c-1],P=r[c];P.push((m=n[c][2])!==null&&m!==void 0?m:0);var O=n[c],D=c<r.length-1?[].concat((0,ee.Z)(r[c+1]),[(b=n[c+1][2])!==null&&b!==void 0?b:0]):null,N=c<n.length-1?n[c+1]:null,j=this.simpleSegment(t,u,C,P,D,A,O,N);u+=j}if(this.dash)for(var ae=0;ae<t.positions.length/6;ae++)t.positions[ae*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,c=1;c<o;c++){var p,m,b,C=r[c-1];C.push((p=n[c-1][2])!==null&&p!==void 0?p:0);var A=n[c-1],P=r[c];P.push((m=n[c][2])!==null&&m!==void 0?m:0);var O=n[c],D=c<r.length-1?[].concat((0,ee.Z)(r[c+1]),[(b=n[c+1][2])!==null&&b!==void 0?b:0]):null,N=c<n.length-1?n[c+1]:null,j=this.segment_gaode2(t,u,C,P,D,A,O,N);u+=j}if(this.dash)for(var ae=0;ae<t.positions.length/6;ae++)t.positions[ae*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var c=r[u-1],p=r[u],m=u<r.length-1?r[u+1]:null,b=this.segment(n,o,c,p,m);o+=b}if(this.dash)for(var C=0;C<n.positions.length/6;C++)n.positions[C*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(r,n,t,o,u){var c=0,p=r.indices,m=r.positions,b=r.normals,C=Xa([o[0],o[1]]),A=Xa([t[0],t[1]]);kd(Ys,C,A);var P=0;if(this.dash&&(P=this.lineSegmentDistance(C,A),this.totalDistance+=P),this.normal||(this.normal=jr.create(),ap(this.normal,Ys)),this.started||(this.started=!0,this.extrusions(m,b,t,this.normal,this.thickness,this.totalDistance-P)),p.push(n+0,n+1,n+2),!u)ap(this.normal,Ys),this.extrusions(m,b,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,ee.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),c+=2;else{var O=Xa([u[0],u[1]]);fm(C,O)&&jr.add(O,C,jr.normalize(O,jr.subtract(O,C,A))),kd(ip,O,C);var D=cm(Id,jr.create(),Ys,ip,this.thickness),N=(0,ce.Z)(D,2),j=N[0],ae=N[1],re=jr.dot(Id,this.normal)<0?-1:1;this.extrusions(m,b,o,ae,j,this.totalDistance),p.push.apply(p,(0,ee.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),re=-1,jr.copy(this.normal,ae),c+=2,this.lastFlip=re}return c}},{key:"segment_gaode2",value:function(r,n,t,o,u,c,p,m){var b=0,C=r.indices,A=r.positions,P=r.normals,O=this.cap==="square",D=this.join==="bevel",N=Xa([p[0],p[1]]),j=Xa([c[0],c[1]]);kd(Ys,o,t);var ae=0;if(this.dash&&(ae=this.lineSegmentDistance(N,j),this.totalDistance+=ae),this.normal||(this.normal=jr.create(),ap(this.normal,Ys)),!this.started)if(this.started=!0,O){var re=jr.create(),Te=jr.create();jr.add(re,this.normal,Ys),jr.add(Te,this.normal,Ys),P.push(Te[0],Te[1],0),P.push(re[0],re[1],0),A.push(t[0],t[1],t[2]|0,this.totalDistance-ae,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),A.push(t[0],t[1],t[2]|0,this.totalDistance-ae,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,P,t,this.normal,this.thickness,this.totalDistance-ae);if(C.push(n+0,n+1,n+2),u){fm(o,u)&&jr.add(u,o,jr.normalize(u,jr.subtract(u,o,t))),kd(ip,u,o);var gt=cm(Id,jr.create(),Ys,ip,this.thickness),lt=(0,ce.Z)(gt,2),Ut=lt[0],or=lt[1],cr=jr.dot(Id,this.normal)<0?-1:1,Tr=D;if(!Tr&&this.join==="miter"){var Sn=Ut;Sn>this.miterLimit&&(Tr=!0)}Tr?(P.push(this.normal[0],this.normal[1],0),P.push(or[0],or[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,C.push.apply(C,(0,ee.Z)(this.lastFlip!==-cr?[n,n+2,n+3]:[n+2,n+1,n+3])),C.push(n+2,n+3,n+4),ap(c0,ip),jr.copy(this.normal,c0),P.push(this.normal[0],this.normal[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b+=3):(this.extrusions(A,P,o,or,Ut,this.totalDistance),C.push.apply(C,(0,ee.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),cr=-1,jr.copy(this.normal,or),b+=2),this.lastFlip=cr}else{if(ap(this.normal,Ys),O){var Re=jr.create(),Ke=jr.create();jr.sub(Ke,Ys,this.normal),jr.add(Re,Ys,this.normal),P.push(Ke[0],Ke[1],0),P.push(Re[0],Re[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,P,o,this.normal,this.thickness,this.totalDistance);C.push.apply(C,(0,ee.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),b+=2}return b}},{key:"segment",value:function(r,n,t,o,u){var c=0,p=r.indices,m=r.positions,b=r.normals,C=this.cap==="square",A=this.join==="bevel",P=Xa([o[0],o[1]]),O=Xa([t[0],t[1]]);kd(Ys,P,O);var D=0;if(this.dash&&(D=this.lineSegmentDistance(P,O),this.totalDistance+=D),this.normal||(this.normal=jr.create(),ap(this.normal,Ys)),!this.started)if(this.started=!0,C){var N=jr.create(),j=jr.create();jr.add(N,this.normal,Ys),jr.add(j,this.normal,Ys),b.push(j[0],j[1],0),b.push(N[0],N[1],0),m.push(t[0],t[1],t[2]|0,this.totalDistance-D,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),m.push(t[0],t[1],t[2]|0,this.totalDistance-D,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(m,b,t,this.normal,this.thickness,this.totalDistance-D);if(p.push(n+0,n+1,n+2),u){var Te=Xa([u[0],u[1]]);fm(P,Te)&&jr.add(Te,P,jr.normalize(Te,jr.subtract(Te,P,O))),kd(ip,Te,P);var Re=cm(Id,jr.create(),Ys,ip,this.thickness),Ke=(0,ce.Z)(Re,2),gt=Ke[0],lt=Ke[1],Ut=jr.dot(Id,this.normal)<0?-1:1,or=A;if(!or&&this.join==="miter"){var cr=gt;cr>this.miterLimit&&(or=!0)}or?(b.push(this.normal[0],this.normal[1],0),b.push(lt[0],lt[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Ut,o[2]|0),this.complex.indexes.push(this.currentIndex),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Ut,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,ee.Z)(this.lastFlip!==-Ut?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),ap(c0,ip),jr.copy(this.normal,c0),b.push(this.normal[0],this.normal[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Ut,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c+=3):(this.extrusions(m,b,o,lt,gt,this.totalDistance),p.push.apply(p,(0,ee.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ut=-1,jr.copy(this.normal,lt),c+=2),this.lastFlip=Ut}else{if(ap(this.normal,Ys),C){var ae=jr.create(),re=jr.create();jr.sub(re,Ys,this.normal),jr.add(ae,Ys,this.normal),b.push(re[0],re[1],0),b.push(ae[0],ae[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(m,b,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,ee.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),c+=2}return c}},{key:"extrusions",value:function(r,n,t,o,u,c){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(t[0],t[1],t[2]|0,c,-u,t[2]|0),this.complex.indexes.push(this.currentIndex),r.push(t[0],t[1],t[2]|0,c,u,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var t=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(t*t+o*o)}}]),e}(),_a=fe(77160);function QC(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,t=Hs().flatten(e),o=t.vertices,u=t.dimensions,c=[],p=[],m=0;m<o.length/u;m++)u===2?c.push(o[m*2],o[m*2+1],1):c.push(o[m*3],o[m*3+1],1);var b=Hs()(t.vertices,t.holes,t.dimensions);p.push.apply(p,(0,ee.Z)(b));for(var C=function(O){var D=t.vertices.slice(O*u,(O+1)*u),N=t.vertices.slice((O+1)*u,(O+2)*u);N.length===0&&(N=t.vertices.slice(0,u));var j=c.length/3;c.push(D[0],D[1],1,N[0],N[1],1,D[0],D[1],0,N[0],N[1],0),p.push.apply(p,(0,ee.Z)([0,2,1,2,3,1].map(function(ae){return ae+j})))},A=0;A<n;A++)C(A);return{positions:c,index:p}}function JC(e){var i=Hs().flatten(e),r=Hs()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function A_(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var t=e[0].length,o=Hs().flatten(e),u=o.vertices,c=o.dimensions,p=[],m=[],b=[],C=0;C<u.length/c;C++)c===2?p.push(u[C*2],u[C*2+1],1,-1,-1):p.push(u[C*3],u[C*3+1],1,-1,-1),b.push(0,0,1);var A=Hs()(o.vertices,o.holes,o.dimensions);m.push.apply(m,(0,ee.Z)(A));for(var P=function(N){var j=o.vertices.slice(N*c,(N+1)*c),ae=o.vertices.slice((N+1)*c,(N+2)*c);ae.length===0&&(ae=o.vertices.slice(0,c));var re=p.length/5;p.push(j[0],j[1],1,0,0,ae[0],ae[1],1,.1,0,j[0],j[1],0,0,.8,ae[0],ae[1],0,.1,.8);var Te=ew([ae[0],ae[1],1],[j[0],j[1],0],[j[0],j[1],1],i);b.push.apply(b,(0,ee.Z)(Te).concat((0,ee.Z)(Te),(0,ee.Z)(Te),(0,ee.Z)(Te))),m.push.apply(m,(0,ee.Z)([1,2,0,3,2,1].map(function(Re){return Re+re})))},O=0;O<t;O++)P(O);return{positions:p,index:m,normals:b}}function ew(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,t=_a.create(),o=_a.create(),u=_a.create();n&&(e=Hl(e),i=Hl(i),r=Hl(r));var c=_a.fromValues.apply(_a,(0,ee.Z)(e)),p=_a.fromValues.apply(_a,(0,ee.Z)(i)),m=_a.fromValues.apply(_a,(0,ee.Z)(r));_a.sub(t,m,p),_a.sub(o,c,p),_a.cross(u,t,o);var b=_a.create();return _a.normalize(b,u),b}var Dc,$p;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})($p||($p={}));var qp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(qp||(qp={}));function hv(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],t=0;t<e;t++)n.push(r*t+i*Math.PI/12);var o=n.map(function(u){var c=Math.sin(u+Math.PI/4),p=Math.cos(u+Math.PI/4);return[c,p,0]});return o}function T_(){return hv(30)}function M_(){return hv(4)}function I_(){return hv(3)}function k_(){return hv(6,1)}function P_(){return hv(5)}var Pd=(Dc={},(0,T.Z)(Dc,qp.CIRCLE,T_),(0,T.Z)(Dc,qp.HEXAGON,k_),(0,T.Z)(Dc,qp.TRIANGLE,I_),(0,T.Z)(Dc,qp.SQUARE,M_),(0,T.Z)(Dc,qp.PENTAGON,P_),(0,T.Z)(Dc,$p.CYLINDER,T_),(0,T.Z)(Dc,$p.HEXAGONCOLUMN,k_),(0,T.Z)(Dc,$p.TRIANGLECOLUMN,I_),(0,T.Z)(Dc,$p.SQUARECOLUMN,M_),(0,T.Z)(Dc,$p.PENTAGONCOLUMN,P_),Dc),f0={};function Kp(e){var i=go(e.coordinates);return{vertices:[].concat((0,ee.Z)(i),(0,ee.Z)(i),(0,ee.Z)(i),(0,ee.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function L_(e){var i=go(e.coordinates),r=w_(i);return{vertices:[].concat((0,ee.Z)(r),(0,ee.Z)(r),(0,ee.Z)(r),(0,ee.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function hm(e){var i=e.shape,r=uw(i,!1),n=r.positions,t=r.index,o=r.normals;return{vertices:n,indices:t,normals:o,size:5}}function tw(e){var i=go(e.coordinates);return{vertices:(0,ee.Z)(i),indices:[0],size:i.length}}function Qp(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,t=new KC({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=r;Array.isArray(u[0][0])||(u=[r]);for(var c=0;c<o.length;c++){var p=o[c],m=u[c];t.extrude_gaode2(p,m)}}else{var b=i;b[0]&&!Array.isArray(b[0][0])&&(b=[i]),b.forEach(function(A){t.extrude(A)})}var C=t.complex;return{vertices:C.positions,indices:C.indices,normals:C.normals,indexes:C.indexes,size:6}}function rw(e){var i=e.coordinates,r=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var n=iw(i),t=n.results,o=n.totalDistance;return t.map(function(u){r.push(u[0],u[1],u[2],u[3],0,o)}),{vertices:r,indices:[],normals:[],size:6,count:t.length}}function nw(e){var i=e.coordinates,r=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],size:4,count:0};var n=aw(i),t=n.results;return t.map(function(o){r.push(o[0],o[1],o[2],o[3])}),{vertices:r,indices:[],size:4,count:t.length}}function R_(e,i){var r=i[0]-e[0],n=i[1]-e[1];return Math.sqrt(r*r+n*n)}function Ld(e,i){return e.length<3&&e.push(0),i!==void 0&&e.push(i),e}function iw(e){var i=0;if(e.length<2)return{results:e,totalDistance:0};var r=[],n=Ld(e[0],i);r.push(n);for(var t=1;t<e.length-1;t++){var o=R_(e[t-1],e[t]);i+=o;var u=Ld(e[t],i);r.push(u),r.push(u)}var c=R_(e[e.length-2],e[e.length-1]);return i+=c,r.push(Ld(e[e.length-1],i)),{results:r,totalDistance:i}}function aw(e){if(e.length<2)return{results:e};var i=[],r=Ld(e[0]);i.push(r);for(var n=1;n<e.length-1;n++){var t=Ld(e[n]);i.push(t),i.push(t)}return i.push(Ld(e[e.length-1])),{results:i}}function pv(e){var i=e.coordinates,r=Hs().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:Hs()(n,o,t),vertices:n,size:t}}function ow(e){var i=e.coordinates,r=Hs().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:Hs()(n,o,t),vertices:sw(n),size:t+4}}function sw(e){for(var i=[],r=Sf(e),n=r.center,t=r.radius,o=0;o<e.length;o+=2){var u=e[o],c=e[o+1];i.push.apply(i,[u,c,0].concat((0,ee.Z)(n),[t]))}return i}function O_(e){var i=e.coordinates,r=A_(i,!0),n=r.positions,t=r.index,o=r.normals;return{vertices:n,indices:t,normals:o,size:5}}function D_(e){var i=e.shape,r=cw(i),n=r.positions,t=r.index;return{vertices:n,indices:t,size:3}}function Rd(e){var i=e.coordinates,r=[].concat((0,ee.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,ee.Z)(i[1]),[0,1,0],(0,ee.Z)(i[0]),[0,0,1],(0,ee.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function h0(e,i){for(var r=i||30,n=e.coordinates,t=[],o=[],u=function(m){t.push(m,1,m,n[0][0],n[0][1],n[1][0],n[1][1],m,-1,m,n[0][0],n[0][1],n[1][0],n[1][1]),m!==r-1&&o.push.apply(o,(0,ee.Z)([0,1,2,1,3,2].map(function(b){return m*2+b})))},c=0;c<r;c++)u(c);return{vertices:t,indices:o,size:7}}function F_(e){var i=e.coordinates;i.length===2&&i.push(0);var r=p0(-1,1),n=p0(1,1),t=p0(-1,-1),o=p0(1,-1),u=[].concat((0,ee.Z)(i),(0,ee.Z)(r),(0,ee.Z)(i),(0,ee.Z)(t),(0,ee.Z)(i),(0,ee.Z)(o),(0,ee.Z)(i),(0,ee.Z)(n)),c=[0,1,2,3,0,2];return{vertices:u,indices:c,size:5}}function uw(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(f0&&f0[e])return f0[e];var r=Pd[e]?Pd[e]():Pd.cylinder(),n=A_([r],i);return f0[e]=n,n}function GR(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,t=new Float32Array(e.length/r*3),o,u,c,p=vec3.create(),m=vec3.create(),b=vec3.create(),C=0,A=i.length;C<A;C+=3){o=i[C+0]*3,u=i[C+1]*3,c=i[C+2]*3;var P=[e[o],e[o+1]],O=[e[u],e[u+1]],D=[e[c],e[c+1]];n&&(P=lngLatToMeters(P),O=lngLatToMeters(O),D=lngLatToMeters(D));var N=P,j=_slicedToArray(N,2),ae=j[0],re=j[1],Te=vec3.fromValues(ae,re,e[o+2]),Re=O,Ke=_slicedToArray(Re,2),gt=Ke[0],lt=Ke[1],Ut=vec3.fromValues(gt,lt,e[u+2]),or=D,cr=_slicedToArray(or,2),Tr=cr[0],Sn=cr[1],Un=vec3.fromValues(Tr,Sn,e[c+2]);vec3.sub(p,Un,Ut),vec3.sub(m,Te,Ut),vec3.cross(b,p,m),t[o]+=p[0],t[o+1]+=p[1],t[o+2]+=p[2],t[u]+=p[0],t[u+1]+=p[1],t[u+2]+=p[2],t[c]+=p[0],t[c+1]+=p[1],t[c+2]+=p[2]}return lw(t),t}function lw(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),t=vec3.create();vec3.normalize(t,n),e.set(t,i)}}function HR(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function cw(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=Pd[e]?Pd[e]():Pd.circle(),n=i.indexOf(e)===-1?JC([r]):QC([r]);return n}function p0(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function WR(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function XR(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function fw(e){var i=hw();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function hw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pw=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,dw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,vw=function(e){(0,hr.Z)(r,e);var i=fw(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.baseColor,p=c===void 0?"rgb(16,16,16)":c,m=t.brightColor,b=m===void 0?"rgb(255,176,38)":m,C=t.windowColor,A=C===void 0?"rgb(30,60,89)":C,P=t.time,O=P===void 0?0:P,D=t.sweep,N=D===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:D;return{u_cityCenter:N.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*N.sweepRadius,u_circleSweep:N.enable?1:0,u_circleSweepColor:h(N.sweepColor).slice(0,3),u_circleSweepSpeed:N.sweepSpeed,u_opacity:u,u_baseColor:h(p),u_brightColor:h(b),u_windowColor:h(A),u_time:this.layer.getLayerAnimateTime()||O}}},{key:"calCityGeo",value:function(){var t=(0,ce.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],c=t[2],p=t[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(c+o)/2,(p+u)/2]);var m=this.mapService.lngLatToCoord([c,p]),b=this.mapService.lngLatToCoord([o,u]);this.cityMinSize=Math.sqrt(Math.pow(m[0]-b[0],2)+Math.pow(m[1]-b[1],2))/4}else{var C=c-o,A=p-u;this.cityCenter=[(c+o)/2,(p+u)/2],this.cityMinSize=Math.sqrt(Math.pow(C,2)+Math.pow(A,2))/4}}},{key:"initModels",value:function(t){this.calCityGeo(),this.startModelAnimate(),this.buildModels(t)}},{key:"buildModels",value:function(t){this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:dw,fragmentShader:pw,triangulation:O_,depth:{enable:!0},cull:{enable:!0,face:H.BACK}}).then(function(o){t([o])}).catch(function(o){console.warn(o),t([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o,u,c,p,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o){var u=o.size,c=u===void 0?10:u;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}})}}]),r}(ya);function mw(e){var i=gw();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function gw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yw=function(e){(0,hr.Z)(r,e);var i=mw(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"type","CityBuildingLayer"),n}return(0,yt.Z)(r,[{key:"buildModels",value:function(){var t=this;this.layerModel=new vw(this),this.layerModel.initModels(function(o){t.dispatchModelLoad(o)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"setLight",value:function(t){this.updateLayerConfig({time:t})}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Uf);function _w(e){var i=xw();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function xw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bw=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,Ew=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Sw=function(e){(0,hr.Z)(r,e);var i=_w(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,c=t.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:c||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:bw,fragmentShader:Ew,triangulation:D_,primitive:H.TRIANGLES,depth:{enable:!1},stencil:X(c,m)}).then(function(b){t([b])}).catch(function(b){console.warn(b),t([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:gn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(ya);function Cw(e){var i=ww();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function ww(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Aw=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,Tw=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Mw=function(e){(0,hr.Z)(r,e);var i=Cw(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,c=t.angle;return{u_opacity:o||1,u_coverage:u||1,u_angle:c||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:Aw,fragmentShader:Tw,triangulation:hm,primitive:H.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:X(c,m)}).then(function(b){t([b])}).catch(function(b){console.warn(b),t([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o){var u=o.size;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o,u,c,p,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:gn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(ya);function Iw(e,i){for(var r=[],n=[],t=[],o=e+1,u=i+1,c=e/2,p=i/2,m=0;m<u;m++)for(var b=m-p,C=0;C<o;C++){var A=C-c;n.push(A/c,-b/p,0),t.push(C/e),t.push(1-m/i)}for(var P=0;P<i;P++)for(var O=0;O<e;O++){var D=O+o*P,N=O+o*(P+1),j=O+1+o*(P+1),ae=O+1+o*P;r.push(D,N,ae),r.push(N,j,ae)}return{vertices:n,indices:r,uvs:t}}var B_,N_;function kw(e){var i=Pw();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function Pw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lw=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,Rw=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,Ow=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,Dw=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,Fw=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,Bw=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,z_=(B_=(0,Jr.b2)(),B_(N_=function(e){(0,hr.Z)(r,e);var i=kw(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"render",value:function(){var t=this,o=this.rendererService,u=o.clear,c=o.useFramebuffer;c(this.heatmapFramerBuffer,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.heatmapFramerBuffer}),t.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,ue.Z)(te().mark(function o(u){var c,p,m,b,C,A,P,O,D,N;return te().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return p=this.rendererService,m=p.createFramebuffer,b=p.getViewportSize,C=p.createTexture2D,A=this.styleAttributeService.getLayerStyleAttribute("shape"),P=(A==null||(c=A.scale)===null||c===void 0?void 0:c.field)||"heatmap",this.shapeType=P,ae.next=6,this.buildHeatMapIntensity();case 6:this.intensityModel=ae.sent,this.colorModel=P==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),O=b(),D=O.width,N=O.height,this.heatmapFramerBuffer=m({color:C({width:Math.floor(D/4),height:Math.floor(N/4),wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE,min:H.LINEAR,mag:H.LINEAR}),depth:!1}),this.updateColorTexture(),u([this.intensityModel,this.colorModel]);case 12:case"end":return ae.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:gn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o){var u=o.size,c=u===void 0?1:u;return[c]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,ue.Z)(te().mark(function o(){var u;return te().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=F_,p.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:Bw,fragmentShader:Fw,triangulation:F_,depth:{enable:!1},cull:{enable:!0,face:Ec(this.mapService.version)},blend:{enable:!0,func:{srcRGB:H.ONE,srcAlpha:1,dstRGB:H.ONE,dstAlpha:1}}});case 3:return u=p.sent,p.abrupt("return",u);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildHeatmapColor",value:function(){var t=this.layer.getLayerConfig(),o=t.mask,u=o===void 0?!1:o,c=t.maskInside,p=c===void 0?!0:c;this.shaderModuleService.registerModule("heatmapColor",{vs:Dw,fs:Ow});var m=this.shaderModuleService.getModule("heatmapColor"),b=m.vs,C=m.fs,A=m.uniforms,P=this.rendererService,O=P.createAttribute,D=P.createElements,N=P.createBuffer,j=P.createModel;return j({vs:b,fs:C,attributes:{a_Position:O({buffer:N({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:H.FLOAT}),size:3}),a_Uv:O({buffer:N({data:[0,1,1,1,0,0,1,0],type:H.FLOAT}),size:2})},uniforms:(0,oe.Z)({},A),depth:{enable:!1},blend:this.getBlend(),elements:D({data:[0,2,1,2,3,1],type:H.UNSIGNED_INT,count:6}),stencil:X(u,p)})}},{key:"drawIntensityMode",value:function(){var t,o=this.layer.getLayerConfig(),u=o.opacity,c=o.intensity,p=c===void 0?10:c,m=o.radius,b=m===void 0?5:m;(t=this.intensityModel)===null||t===void 0||t.draw({uniforms:{u_opacity:u||1,u_radius:b,u_intensity:p}})}},{key:"drawColorMode",value:function(){var t,o=this.layer.getLayerConfig(),u=o.opacity;(t=this.colorModel)===null||t===void 0||t.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var t,o=this.layer.getLayerConfig(),u=o.opacity,c=Ho();ph(c,this.cameraService.getViewProjectionMatrixUncentered()),(t=this.colorModel)===null||t===void 0||t.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,ee.Z)(c)}})}},{key:"build3dHeatMap",value:function(){var t=this.layer.getLayerConfig(),o=t.mask,u=o===void 0?!1:o,c=t.maskInside,p=c===void 0?!0:c,m=this.rendererService.getViewportSize,b=m(),C=b.width,A=b.height,P=Iw(C/4,A/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:Rw,fs:Lw});var O=this.shaderModuleService.getModule("heatmap3dColor"),D=O.vs,N=O.fs,j=O.uniforms,ae=this.rendererService,re=ae.createAttribute,Te=ae.createElements,Re=ae.createBuffer,Ke=ae.createModel;return Ke({vs:D,fs:N,attributes:{a_Position:re({buffer:Re({data:P.vertices,type:H.FLOAT}),size:3}),a_Uv:re({buffer:Re({data:P.uvs,type:H.FLOAT}),size:2})},primitive:H.TRIANGLES,uniforms:(0,oe.Z)({},j),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:H.SRC_ALPHA,srcAlpha:1,dstRGB:H.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Te({data:P.indices,type:H.UNSIGNED_INT,count:P.indices.length}),stencil:X(u,p)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var o=this.layer.getLayerConfig(),u=o.rampColors,c=M(u);this.colorTexture=t({data:new Uint8Array(c.data),width:c.width,height:c.height,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE,min:H.NEAREST,mag:H.NEAREST,flipY:!1})}}]),r}(ya))||N_);function Nw(e){var i=zw();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function zw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uw=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Zw=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Vw=function(e){(0,hr.Z)(r,e);var i=Nw(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,c=t.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:c||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:Zw,fragmentShader:Uw,triangulation:D_,depth:{enable:!1},primitive:H.TRIANGLES,blend:this.getBlend(),stencil:X(c,m)}).then(function(b){t([b])}).catch(function(b){console.warn(b),t([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:gn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(ya),jw={heatmap:z_,heatmap3d:z_,grid:Sw,grid3d:Mw,hexagon:Vw},Gw=jw;function Hw(e){var i=Ww();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function Ww(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xw=function(e){(0,hr.Z)(r,e);var i=Hw(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"type","HeatMapLayer"),n}return(0,yt.Z)(r,[{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new Gw[o](this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"renderModels",value:function(){var t=this,o=this.getModelType();return o==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.layerModel.buildModels(function(u){return t.models=u}),this.layerModelNeedUpdate=!1),this.models.forEach(function(u){return u.draw({uniforms:t.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):console.warn("data error")}},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=this.getLayerConfig(),c=u.shape3d,p=this.getSource(),m=p.data.type,b=(o==null||(t=o.scale)===null||t===void 0?void 0:t.field)||"heatmap";return b==="heatmap"||b==="heatmap3d"?"heatmap":m==="hexagon"?(c==null?void 0:c.indexOf(b))===-1?"hexagon":"grid3d":m==="grid"?(c==null?void 0:c.indexOf(b))===-1?"grid":"grid3d":"heatmap"}}]),r}(Uf);function Yw(e){var i=$w();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function $w(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qw=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

uniform float u_pixelConstant;
uniform float u_pixelConstantR;
uniform float u_pixelConstantG;
uniform float u_pixelConstantB;
uniform float u_pixelConstantRGB;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y));

  float r = baseColor.r;
  float g = baseColor.g;
  float b = baseColor.b;

  float value = u_pixelConstant + ((r * u_pixelConstantR + g * u_pixelConstantG + b * u_pixelConstantB) * u_pixelConstantRGB);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
    gl_FragColor = vec4(0, 0, 0, 0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,Kw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Qw=function(e){(0,hr.Z)(r,e);var i=Yw(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.clampLow,c=u===void 0?!0:u,p=t.clampHigh,m=p===void 0?!0:p,b=t.noDataValue,C=b===void 0?-9999999:b,A=t.domain,P=A===void 0?[0,1]:A,O=t.rampColors,D=t.pixelConstant,N=D===void 0?0:D,j=t.pixelConstantR,ae=j===void 0?256*256:j,re=t.pixelConstantG,Te=re===void 0?256:re,Re=t.pixelConstantB,Ke=Re===void 0?1:Re,gt=t.pixelConstantRGB,lt=gt===void 0?.1:gt;return(0,Er.isEqual)(this.rampColors,O)||(this.updateColorTexture(),this.rampColors=O),{u_opacity:o||1,u_texture:this.texture,u_pixelConstant:N,u_pixelConstantR:ae,u_pixelConstantG:Te,u_pixelConstantB:Ke,u_pixelConstantRGB:lt,u_domain:P,u_clampLow:c,u_clampHigh:typeof m!="undefined"?m:c,u_noDataValue:C,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(t){var o=this,u=this.layer.getLayerConfig(),c=u.mask,p=c===void 0?!1:c,m=u.maskInside,b=m===void 0?!0:m,C=u.rampColorsData,A=u.rampColors,P=this.layer.getSource(),O=this.rendererService.createTexture2D;this.texture=O({height:0,width:0}),P.data.images.then(function(N){o.texture=O({data:N[0],width:N[0].width,height:N[0].height}),o.layerService.reRender()});var D=C||M(A);this.colorTexture=O({data:D.data,width:D.width,height:D.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:Kw,fragmentShader:qw,triangulation:Rd,primitive:H.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:X(p,b)}).then(function(N){t([N])}).catch(function(N){console.warn(N),t([])})}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}})}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.rampColors,c=M(u);this.colorTexture=t({data:c.data,width:c.width,height:c.height,flipY:!1})}}]),r}(ya);function Jw(e){var i=eA();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function eA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tA=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,rA=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,nA=function(e){(0,hr.Z)(r,e);var i=Jw(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity;return{u_opacity:o||1,u_texture:this.texture}}},{key:"initModels",value:function(t){var o=this,u=this.layer.getLayerConfig(),c=u.mask,p=c===void 0?!1:c,m=u.maskInside,b=m===void 0?!0:m,C=this.layer.getSource(),A=this.rendererService.createTexture2D;if(this.texture=A({height:0,width:0}),as){var P=this.layerService.sceneService.getSceneConfig().canvas,O=P.createImage();O.crossOrigin="anonymous",O.src=C.data.originData,O.onload=function(){o.texture=A({data:O,width:O.width,height:O.height}),o.layerService.reRender()}}else C.data.images.then(function(D){o.texture=A({data:D[0],width:D[0].width,height:D[0].height,mag:H.LINEAR,min:H.LINEAR}),o.layerService.reRender()});this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:rA,fragmentShader:tA,triangulation:Rd,primitive:H.TRIANGLES,blend:{enable:!0},depth:{enable:!1},stencil:X(p,b)}).then(function(D){t([D])}).catch(function(D){console.warn(D),t([])})}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}})}}]),r}(ya);function iA(e){var i=aA();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function aA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oA=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

uniform float u_pixelConstant;
uniform float u_pixelConstantR;
uniform float u_pixelConstantG;
uniform float u_pixelConstantB;
uniform float u_pixelConstantRGB;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y));

  float r = baseColor.r;
  float g = baseColor.g;
  float b = baseColor.b;

  float value = u_pixelConstant + ((r * u_pixelConstantR + g * u_pixelConstantG + b * u_pixelConstantB) * u_pixelConstantRGB);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
    gl_FragColor = vec4(0, 0, 0, 0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,sA=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,uA=function(e){(0,hr.Z)(r,e);var i=iA(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.opacity,c=o.clampLow,p=c===void 0?!0:c,m=o.clampHigh,b=m===void 0?!0:m,C=o.noDataValue,A=C===void 0?-9999999:C,P=o.domain,O=P===void 0?[0,1]:P,D=o.colorTexture,N=D===void 0?t({height:0,width:0}):D,j=o.pixelConstant,ae=j===void 0?0:j,re=o.pixelConstantR,Te=re===void 0?256*256:re,Re=o.pixelConstantG,Ke=Re===void 0?256:Re,gt=o.pixelConstantB,lt=gt===void 0?1:gt,Ut=o.pixelConstantRGB,or=Ut===void 0?.1:Ut;return{u_opacity:u||1,u_texture:this.texture,u_pixelConstant:ae,u_pixelConstantR:Te,u_pixelConstantG:Ke,u_pixelConstantB:lt,u_pixelConstantRGB:or,u_domain:O,u_clampLow:p,u_clampHigh:typeof b!="undefined"?b:p,u_noDataValue:A,u_colorTexture:N}}},{key:"initModels",value:function(t){var o=this,u=this.layer.getLayerConfig(),c=u.mask,p=c===void 0?!1:c,m=u.maskInside,b=m===void 0?!0:m,C=this.layer.getSource(),A=this.rendererService.createTexture2D;this.texture=A({height:0,width:0}),C.data.images.then(function(P){o.texture=A({data:P[0],width:P[0].width,height:P[0].height}),o.layerService.reRender()}),this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:sA,fragmentShader:oA,triangulation:Rd,primitive:H.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:X(p,b)}).then(function(P){t([P])}).catch(function(P){console.warn(P),t([])})}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}})}}]),r}(ya),lA={image:nA,dataImage:Qw,tileDataImage:uA},cA=lA;function fA(e){var i=hA();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function hA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var U_=function(e){(0,hr.Z)(r,e);var i=fA(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"type","ImageLayer"),n}return(0,yt.Z)(r,[{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new cA[o](this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={image:{},dataImage:{},tileDataImage:{}};return o[t]}},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(t=o.scale)===null||t===void 0?void 0:t.field;return u==="dataImage"?"dataImage":u==="image"?"image":u==="tileDataImage"?"tileDataImage":"image"}}]),r}(Uf);function pA(e,i,r){var n=r.createTexture2D,t=M(e),o=n({data:t.data,width:t.width,height:t.height,flipY:!1});return i.map(function(u){u.updateLayerConfig({colorTexture:o})}),o}function pm(e,i,r){e.map(function(n){i==="mask"?n.style({mask:r}):n.updateLayerConfig((0,T.Z)({},i,r))})}function d0(e,i,r,n){if(Array.isArray(n)){e[r].apply(e,(0,ee.Z)(n));return}if(typeof n=="string"){e[r](n);return}var t=dA(e,i.type,r);if(!n)return e[r](t),e;var o=mA(n,r);o.length===0?e[r](t):e[r].apply(e,(0,ee.Z)(o))}function dA(e,i,r){switch(r){case"size":return 1;case"color":return"#fff";case"shape":return vA(i,e);default:return""}}function vA(e,i){var r,n=i.getAttribute("shape");if(n&&(r=n.scale)!==null&&r!==void 0&&r.field){var t;return((t=n.scale)===null||t===void 0?void 0:t.values)==="text"?[n.scale.field,n.scale.values]:n.scale.field}switch(e){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}function mA(e,i){if(i==="shape")return typeof e=="string"?[e]:e!=null&&e.field?[e==null?void 0:e.field]:[];var r=e,n=r.field,t=r.values,o=r.callback;return n&&t&&Array.isArray(t)?[n,t]:n&&o?[n,o]:n?[n]:[]}function gA(e,i){var r=i.tileLayer.scaleField,n=Object.keys(r);n.map(function(t){e.scale(t,r[t])})}var Z_=["mvt","geojsonvt","testTile"];function yA(e){var i=e.getSource();return Z_.includes(i.parser.type)}function v0(e){return Z_.indexOf(e)>=0}function V_(e,i){i.map(function(r){var n=im(e.sceneContainer);r.setContainer(n,e.sceneContainer),r.init()})}function j_(e,i){var r,n=i.getAttribute("shape");if(n&&(r=n.scale)!==null&&r!==void 0&&r.field){var t;return((t=n.scale)===null||t===void 0?void 0:t.values)==="text"?[n.scale.field,n.scale.values]:n.scale.field}switch(e){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}function G_(e,i){switch(e){case"PolygonLayer":return!0;case"LineLayer":return!0;case"PointLayer":return!1;case"RasterLayer":return i;default:return i}}function YR(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}function dm(e){return e.layerIDList.length===e.loadedLayers}function _A(e){var i=e.children;return i.filter(function(r){return dm(r)}).length===i.length}function xA(e){var i=e.parent;return i?dm(i):!0}function bA(e,i){var r=window.setInterval(function(){var n=dm(e),t=_A(e),o=xA(e);n&&t&&o&&(i(),window.clearInterval(r))},36)}function EA(e,i){e.isVisible?i():bA(e,function(){i()})}function SA(e){var i=!0;return e.map(function(r){r.type!=="PointLayer"&&(i=!1)}),i}function CA(e,i,r){if(i.length!==0){if(SA(i)){pm(i,"visible",e.isVisible),r.reRender();return}EA(e,function(){pm(i,"visible",e.isVisible),r.reRender()})}}function wA(e,i,r,n){var t,o,u,c,p=(e==null||(t=e.bboxPolygon)===null||t===void 0?void 0:t.bbox)||[0,0,10,-10],m=(0,ce.Z)(p,4),b=m[0],C=b===void 0?0:b,A=m[1],P=A===void 0?0:A,O=m[2],D=O===void 0?10:O,N=m[3],j=N===void 0?-10:N,ae=i.lngLatToContainer([C,P]),re=i.lngLatToContainer([D,j]),Te=re.x-ae.x,Re=ae.y-re.y,Ke=[(r-ae.x)/Te,(n-re.y)/Re],gt=(e==null||(o=e.data)===null||o===void 0?void 0:o.width)||1,lt=(e==null||(u=e.data)===null||u===void 0?void 0:u.height)||1,Ut=Math.floor(Ke[0]*gt),or=Math.floor(Ke[1]*lt),cr=Math.max(0,or-1)*gt+Ut,Tr=e==null||(c=e.data)===null||c===void 0?void 0:c.data[cr];return Tr}function $R(e,i,r){var n=r.readPixels,t=r.getContainer,o=e*DOM.DPR,u=i*DOM.DPR,c=AA(t()),p=c.width,m=c.height;if(p*=DOM.DPR,m*=DOM.DPR,o>p-1*DOM.DPR||o<0||u>m-1*DOM.DPR||u<0)return!1;var b=n({x:Math.floor(o),y:Math.floor(m-(i+1)*DOM.DPR),width:1,height:1,data:new Uint8Array(1*1*4)});return b}function AA(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}function TA(e){var i=MA();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function MA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IA=`uniform float u_opacity : 1.0;
varying vec4 v_color;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,kA=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;


#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

void main() {
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // if(u_coord > 0.0) { // \u4F7F\u7528\u7ECF\u7EAC\u5EA6\u5750\u6807
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
  // } else { // \u4F7F\u7528\u504F\u79FB\u5750\u6807
  //   vec2 pointPos = a_Position.xy;
  //   vec4 tileWorld = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  //   vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
  //   tileWorld.xy += pointOffset;

  //   tileWorld.xy += offset;

  //   if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //     // Needs to be divided with project_uCommonUnitsPerMeter
  //     tileWorld.w *= u_PixelsPerMeter.z;
  //   }
  //   gl_Position = u_ViewProjectionMatrix * tileWorld + u_ViewportCenterProjection;
  // }

  setPickingColor(a_PickingColor);
}
`,PA=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,LA=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec3 a_Normal;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_size;

#pragma include "projection"

void main() {

  vec3 size = a_Miter * u_size * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
}
`,vm=function(e){(0,hr.Z)(r,e);var i=TA(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.usage,p=t.color,m=p===void 0?"#fff":p,b=t.size,C=b===void 0?1:b;return{u_opacity:Number(u),u_color:c==="basemap"?h(m):[0,0,0,0],u_size:c==="basemap"?C:1}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(){var n=(0,ue.Z)(te().mark(function o(u){var c,p,m,b,C,A,P,O;return te().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:c=this.layer.getLayerConfig(),p=c.mask,m=p===void 0?!1:p,b=c.maskInside,C=b===void 0?!0:b,A=c.depth,P=A===void 0?!1:A,O=c.usage,this.layer.triangulation=Qp,this.layer.buildLayerModel({moduleName:"lineTile_"+O,vertexShader:O==="basemap"?LA:kA,fragmentShader:O==="basemap"?PA:IA,triangulation:Qp,blend:this.getBlend(),depth:{enable:P},stencil:X(m,C),pick:O!=="basemap"}).then(function(j){u([j])}).catch(function(j){console.warn(j),u([])});case 3:case"end":return N.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig(),o=t.usage;o!=="basemap"&&this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(c){var p=c.size,m=p===void 0?1:p;return Array.isArray(m)?[m[0],m[1]]:[m,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(c,p,m,b,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(c,p,m){return[m[4]]}}})}}]),r}(ya);function RA(e){var i=OA();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function OA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DA=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,FA=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

varying vec4 v_color;

void main() {
  v_color = a_Color; 

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, 0.0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
  }
}
`,BA=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,NA=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, 0.0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
  }
}`,zA=function(e){(0,hr.Z)(r,e);var i=RA(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.usage,p=t.color,m=p===void 0?"#fff":p;return{u_opacity:(0,Er.isNumber)(u)?u:1,u_color:c==="basemap"?h(m):[0,0,0,0]}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"clearModels",value:function(){}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p,b=o.usage;this.layer.buildLayerModel({moduleName:"lineTileSimpleNormal_"+b,vertexShader:b==="basemap"?NA:FA,fragmentShader:b==="basemap"?BA:DA,triangulation:nw,primitive:H.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:X(c,m),pick:!1}).then(function(C){t([C])}).catch(function(C){console.warn(C),t([])})}},{key:"registerBuiltinAttributes",value:function(){}}]),r}(ya);function UA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ZA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var m=r.next();return o=m.done,m},e:function(m){u=!0,c=m},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function ZA(e,i){if(!!e){if(typeof e=="string")return H_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H_(e,i)}}function H_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var VA=function(){function e(i,r,n){(0,vt.Z)(this,e),(0,T.Z)(this,"boxCells",[]);var t=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)t.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,yt.Z)(e,[{key:"insert",value:function(r,n,t,o,u){this.forEachCell(n,t,o,u,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(t),this.bboxes.push(o),this.bboxes.push(u)}},{key:"query",value:function(r,n,t,o,u){return this.queryHitTest(r,n,t,o,!1,u)}},{key:"hitTest",value:function(r,n,t,o,u){return this.queryHitTest(r,n,t,o,!0,u)}},{key:"insertBoxCell",value:function(r,n,t,o,u,c){this.boxCells[u].push(c)}},{key:"queryHitTest",value:function(r,n,t,o,u,c){if(t<0||r>this.width||o<0||n>this.height)return u?!1:[];var p=[];if(r<=0&&n<=0&&this.width<=t&&this.height<=o){if(u)return!0;for(var m=0;m<this.boxKeys.length;m++)p.push({key:this.boxKeys[m],x1:this.bboxes[m*4],y1:this.bboxes[m*4+1],x2:this.bboxes[m*4+2],y2:this.bboxes[m*4+3]});return c?p.filter(c):p}var b={hitTest:u,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,t,o,this.queryCell,p,b,c),u?p.length>0:p}},{key:"queryCell",value:function(r,n,t,o,u,c,p,m){var b=p.seenUids,C=this.boxCells[u];if(C!==null){var A=this.bboxes,P=UA(C),O;try{for(P.s();!(O=P.n()).done;){var D=O.value;if(!b.box[D]){b.box[D]=!0;var N=D*4;if(r<=A[N+2]&&n<=A[N+3]&&t>=A[N+0]&&o>=A[N+1]&&(!m||m(this.boxKeys[D]))){if(p.hitTest)return c.push(!0),!0;c.push({key:this.boxKeys[D],x1:A[N],y1:A[N+1],x2:A[N+2],y2:A[N+3]})}}}}catch(j){P.e(j)}finally{P.f()}}return!1}},{key:"forEachCell",value:function(r,n,t,o,u,c,p,m){for(var b=this.convertToXCellCoord(r),C=this.convertToYCellCoord(n),A=this.convertToXCellCoord(t),P=this.convertToYCellCoord(o),O=b;O<=A;O++)for(var D=C;D<=P;D++){var N=this.xCellCount*D+O;if(u.call(this,r,n,t,o,N,c,p,m))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),jA=VA,W_=function(){function e(i,r){(0,vt.Z)(this,e),(0,T.Z)(this,"viewportPadding",100),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new jA(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,yt.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,t=r.y1+r.anchorPointY+this.viewportPadding,o=r.x2+r.anchorPointX+this.viewportPadding,u=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,t,o,u)||this.grid.hitTest(n,t,o,u)?{box:[]}:{box:[n,t,o,u]}}},{key:"insertCollisionBox",value:function(r,n){var t={featureIndex:n};this.grid.insert(t,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,t){var o=X2(n,t,0,1),u=Jm(),c=Ed.apply(Le,(0,ee.Z)(r));return $0(u,o,c),{x:(u[0]/u[3]+1)/2*this.width+this.viewportPadding,y:(-u[1]/u[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,t,o){return t>=0&&r<this.gridRightBoundary&&o>=0&&n<this.gridBottomBoundary}}]),e}();function X_(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=GA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var m=r.next();return o=m.done,m},e:function(m){u=!0,c=m},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function GA(e,i){if(!!e){if(typeof e=="string")return Y_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Y_(e,i)}}function Y_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function $_(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function q_(e,i,r,n,t){if(!!t){var o=e[n],u=o.glyph;if(u)for(var c=i[u].advance*o.scale,p=(e[n].x+c)*t,m=r;m<=n;m++)e[m].x-=p}}function K_(e,i,r,n,t,o,u){var c=(i-r)*t,p=(-n*u+.5)*o,m=X_(e),b;try{for(m.s();!(b=m.n()).done;){var C=b.value;C.x+=c,C.y+=p}}catch(A){m.e(A)}finally{m.f()}}function HA(e,i,r,n,t,o,u){var c=-8,p=0,m=c,b=0,C=e.positionedGlyphs,A=o==="right"?1:o==="left"?0:.5,P=C.length;r.forEach(function(ae){if(ae.split("").forEach(function(Te){var Re=i[Te],Ke=0;Re&&(C.push({glyph:Te,x:p,y:m+Ke,vertical:!1,scale:1,metrics:Re}),p+=Re.advance+u)}),C.length!==P){var re=p-u;b=Math.max(re,b),q_(C,i,P,C.length-1,A)}p=0,m-=n+5});var O=$_(t),D=O.horizontalAlign,N=O.verticalAlign;K_(C,A,D,N,b,n,r.length);var j=m-c;e.top+=-N*j,e.bottom=e.top-j,e.left+=-D*b,e.right=e.left+b}function WA(e,i,r,n,t,o,u){var c=-8,p=0,m=c,b=0,C=e.positionedGlyphs,A=o==="right"?1:o==="left"?0:.5,P=C.length;r.forEach(function(ae){var re=i[ae],Te=0;if(re&&(C.push({glyph:ae,x:re.advance/2,y:m+Te,vertical:!1,scale:1,metrics:re}),p+=re.advance+u),C.length!==P){var Re=p-u;b=Math.max(Re,b),q_(C,i,P,C.length-1,A)}p=0,m-=n+5});var O=$_(t),D=O.horizontalAlign,N=O.verticalAlign;K_(C,A,D,N,b,n,r.length);var j=m-c;e.top+=-N*j,e.bottom=e.top-j,e.left+=-D*b,e.right=e.left+b}function Q_(e,i,r,n,t,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],c=arguments.length>7?arguments[7]:void 0,p=e.split(`
`),m=[],b={positionedGlyphs:m,top:u[1],bottom:u[1],left:u[0],right:u[0],lineCount:p.length,text:e};return c?WA(b,i,p,r,n,t,o):HA(b,i,p,r,n,t,o),m.length?b:!1}function J_(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,t=n===void 0?[]:n,o=[],u=X_(t),c;try{for(u.s();!(c=u.n()).done;){var p=c.value,m=p.metrics,b=4,C=m.advance*p.scale/2,A=r?[p.x+C,p.y]:[0,0],P=r?[0,0]:[p.x+C+i[0],p.y+i[1]],O=(0-b)*p.scale-C+P[0],D=(0-b)*p.scale+P[1],N=O+m.width*p.scale,j=D+m.height*p.scale,ae={x:O,y:D},re={x:N,y:D},Te={x:O,y:j},Re={x:N,y:j};o.push({tl:ae,tr:re,bl:Te,br:Re,tex:m,glyphOffset:A})}}catch(Ke){u.e(Ke)}finally{u.f()}return o}function XA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=YA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var m=r.next();return o=m.done,m},e:function(m){u=!0,c=m},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function YA(e,i){if(!!e){if(typeof e=="string")return e1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e1(e,i)}}function e1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function $A(e){var i=qA();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function qA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

#pragma include "picking"
void main() {
  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,r1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "projection"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,n1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;

uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;
uniform vec4 u_color;

void main() {
  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  
  gl_FragColor = mix(vec4(u_color.rgb, u_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
}
`,i1=`#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_size;

varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

#pragma include "projection"

void main() {
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = u_size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;

}
`;function a1(e){var i=this,r=e.id,n=[],t=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var o=i.glyphInfoMap[r].centroid,u=o.length===2?[o[0],o[1],0]:o;return i.glyphInfoMap[r].glyphQuads.forEach(function(c,p){n.push.apply(n,(0,ee.Z)(u).concat([c.tex.x,c.tex.y+c.tex.height,c.tl.x,c.tl.y],(0,ee.Z)(u),[c.tex.x+c.tex.width,c.tex.y+c.tex.height,c.tr.x,c.tr.y],(0,ee.Z)(u),[c.tex.x+c.tex.width,c.tex.y,c.br.x,c.br.y],(0,ee.Z)(u),[c.tex.x,c.tex.y,c.bl.x,c.bl.y])),t.push(0+p*4,1+p*4,2+p*4,2+p*4,3+p*4,0+p*4)}),{vertices:n,indices:t,size:7}}var o1=function(e){(0,hr.Z)(r,e);var i=$A(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"glyphInfoMap",{}),(0,T.Z)((0,$e.Z)(n),"currentZoom",-1),(0,T.Z)((0,$e.Z)(n),"textureHeight",0),(0,T.Z)((0,$e.Z)(n),"textCount",0),(0,T.Z)((0,$e.Z)(n),"preTextStyle",{}),(0,T.Z)((0,$e.Z)(n),"buildModels",function(){var c=(0,ue.Z)(te().mark(function p(m){var b,C;return te().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:n.mapping(),b=n.layer.getLayerConfig(),C=b.usage,n.layer.buildLayerModel({moduleName:"pointTileText_"+C,vertexShader:C==="basemap"?i1:r1,fragmentShader:C==="basemap"?n1:t1,triangulation:a1.bind((0,$e.Z)(n)),depth:{enable:!1},blend:n.getBlend(),pick:C!=="basemap"}).then(function(O){m([O])}).catch(function(O){console.warn(O),m([])});case 3:case"end":return P.stop()}},p)}));return function(p){return c.apply(this,arguments)}}()),(0,T.Z)((0,$e.Z)(n),"mapping",function(){n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel()}),n}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.stroke,p=c===void 0?"#fff":c,m=t.strokeWidth,b=m===void 0?0:m,C=t.textAnchor,A=C===void 0?"center":C,P=t.textAllowOverlap,O=P===void 0?!1:P,D=t.halo,N=D===void 0?.5:D,j=t.gamma,ae=j===void 0?2:j,re=t.usage,Te=t.color,Re=Te===void 0?"#fff":Te,Ke=t.size,gt=Ke===void 0?1:Ke,lt=this.fontService,Ut=lt.canvas,or=lt.mapping;return Object.keys(or).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(or).length),this.preTextStyle={textAnchor:A,textAllowOverlap:O},{u_opacity:(0,Er.isNumber)(u)?u:1,u_stroke_width:(0,Er.isNumber)(b)?b:1,u_stroke_color:this.getStrokeColor(p),u_sdf_map:this.texture,u_halo_blur:N,u_gamma_scale:ae,u_sdf_map_size:[Ut.width,Ut.height],u_color:re==="basemap"?h(Re):[0,0,0,0],u_size:re==="basemap"?gt:1}}},{key:"initModels",value:function(t){this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,c=u===void 0?"center":u,p=o.textAllowOverlap,m=p===void 0?!0:p;this.preTextStyle={textAnchor:c,textAllowOverlap:m},this.buildModels(t)}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig(),o=t.usage;this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:gn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(c,p,m){return[m[5],m[6]]}}}),o!=="basemap"&&this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(c){var p=c.size,m=p===void 0?12:p;return Array.isArray(m)?[m[0]]:[m]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:gn.Attribute,descriptor:{name:"a_tex",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(c,p,m){return[m[3],m[4]]}}})}},{key:"textExtent",value:function(){var t=this.mapService.getBounds();return pu(t,.5)}},{key:"initTextFont",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,c=t.fontFamily,p=c===void 0?"sans-serif":c,m=this.layer.getEncodedData(),b=[];m.forEach(function(C){var A=C.shape,P=A===void 0?"":A;P=P.toString();var O=XA(P),D;try{for(O.s();!(D=O.n()).done;){var N=D.value;b.indexOf(N)===-1&&b.push(N)}}catch(j){O.e(j)}finally{O.f()}}),this.fontService.setFontOptions({characterSet:b,fontWeight:u,fontFamily:p,iconfont:!1})}},{key:"generateGlyphLayout",value:function(){var t=this,o=this.fontService.mapping,u=this.layer.getLayerConfig(),c=u.spacing,p=c===void 0?2:c,m=u.textAnchor,b=m===void 0?"center":m,C=this.layer.getEncodedData();this.glyphInfo=C.map(function(A){var P=A.shape,O=P===void 0?"":P,D=A.id,N=A.size,j=N===void 0?1:N,ae=A.textOffset,re=ae===void 0?[0,0]:ae,Te=Q_(O.toString(),o,j,b,"left",p,re,!1),Re=J_(Te,re,!1);return A.shaping=Te,A.glyphQuads=Re,A.centroid=go(A.coordinates),A.originCentroid=A.version==="GAODE2.x"?go(A.originCoordinates):A.originCentroid=A.centroid,t.glyphInfoMap[D]={shaping:Te,glyphQuads:Re,centroid:go(A.coordinates)},A})}},{key:"filterGlyphs",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.padding,c=u===void 0?[4,4]:u,p=o.textAllowOverlap,m=p===void 0?!1:p;if(!m){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var b=this.rendererService.getViewportSize(),C=b.width,A=b.height,P=new W_(C,A),O=this.glyphInfo.filter(function(D){var N=D.shaping,j=D.id,ae=j===void 0?0:j,re=D.version==="GAODE2.x"?D.originCentroid:D.centroid,Te=D.size,Re=Te/24,Ke=t.mapService.lngLatToContainer(re),gt=P.placeCollisionBox({x1:N.left*Re-c[0],x2:N.right*Re+c[0],y1:N.top*Re-c[1],y2:N.bottom*Re+c[1],anchorPointX:Ke.x,anchorPointY:Ke.y}),lt=gt.box;return lt&&lt.length?(P.insertCollisionBox(lt,ae),!0):!1});O.forEach(function(D){t.glyphInfoMap[D.id]=D})}}},{key:"initGlyph",value:function(){this.initTextFont(),this.generateGlyphLayout()}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=t({data:o,mag:H.LINEAR,min:H.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.usage;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointTileText_"+u,vertexShader:u==="basemap"?i1:r1,fragmentShader:u==="basemap"?n1:t1,triangulation:a1.bind(this),depth:{enable:!1},blend:this.getBlend(),pick:u!=="basemap"}).then(function(c){t.layer.models=[c],t.layerService.throttleRenderLayers()}).catch(function(c){console.warn(c),t.layer.models=[]})}}]),r}(ya);function KA(e){var i=QA();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function QA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JA=`uniform float u_additive;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));


  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,eT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping

  v_color = a_Color;
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, 0.0);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width));
  offset = project_pixel(offset);

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
  }

// if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
// } else {

  // vec2 pointPos = a_Position.xy;
  // vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  // vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  // world.xy += offset;
  // world.xy += pointOffset;

  // if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //   // Needs to be divided with project_uCommonUnitsPerMeter
  //   world.w *= u_PixelsPerMeter.z;
  // }

  // gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
// }

 
  setPickingColor(a_PickingColor);


}
`,m0=function(e){(0,hr.Z)(r,e);var i=KA(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.strokeOpacity,p=c===void 0?1:c,m=t.strokeWidth,b=m===void 0?0:m,C=t.stroke,A=C===void 0?"rgba(0,0,0,0)":C,P=t.blend;return{u_additive:P==="additive"?1:0,u_opacity:Number(u),u_stroke_opacity:Number(p),u_stroke_width:Number(b),u_stroke_color:this.getStrokeColor(A)}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Kp)}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.workerEnabled,c=u===void 0?!1:u,p=o.usage;this.layer.triangulation=Kp,this.layer.buildLayerModel({moduleName:"pointTile_"+p,vertexShader:eT,fragmentShader:JA,triangulation:Kp,depth:{enable:!1},cull:{enable:!0,face:Ec(this.mapService.version)},blend:this.getBlend(),workerEnabled:c,workerOptions:{modelType:"pointTile"},pick:p!=="basemap"}).then(function(m){t([m])}).catch(function(m){console.warn(m),t([])})}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(u,c,p,m){var b=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],C=m%4*3;return[b[C],b[C+1],b[C+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?5:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:gn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var c=u.shape,p=c===void 0?2:c,m=t.layer.getLayerConfig().shape2d,b=m.indexOf(p);return[b]}}})}}]),r}(ya);function tT(e){var i=rT();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function rT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nT=`uniform float u_opacity : 1.0;
varying vec4 v_color;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,iT=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

varying vec4 v_color;

#pragma include "projection"
#pragma include "picking"

void main() {
  v_color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  // if(u_coord > 0.0) {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
    }
  // } else {
  //   vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  //   vec2 pointOffset = a_Position.xy *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
  //   world.xy += pointOffset;

  //   if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //     // Needs to be divided with project_uCommonUnitsPerMeter
  //     world.w *= u_PixelsPerMeter.z;
  //   }

  //   gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
  // }

  setPickingColor(a_PickingColor);
}

`,aT=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,oT=`attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}`,s1=function(e){(0,hr.Z)(r,e);var i=tT(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.usage,p=t.color,m=p===void 0?"#fff":p;return{u_opacity:u,u_color:c==="basemap"?h(m):[0,0,0,0]}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p,b=o.usage;this.layer.triangulation=pv,this.layer.buildLayerModel({moduleName:"polygonTile_"+b,vertexShader:b==="basemap"?oT:iT,fragmentShader:b==="basemap"?aT:nT,triangulation:pv,depth:{enable:!1},blend:this.getBlend(),stencil:X(c,m),pick:b!=="basemap"}).then(function(C){t([C])}).catch(function(C){console.warn(C),t([])})}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){}}]),r}(ya);function sT(e){var i=uT();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function uT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lT=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,cT=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,u1=function(e){(0,hr.Z)(r,e);var i=sT(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?0:o,c=t.color,p=c===void 0?"#000":c;return{u_opacity:(0,Er.isNumber)(u)?u:0,u_color:h(p)}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(){var n=(0,ue.Z)(te().mark(function o(u){return te().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:this.layer.buildLayerModel({moduleName:"mask",vertexShader:cT,fragmentShader:lT,triangulation:pv,depth:{enable:!1},blend:this.getBlend(),stencil:{enable:!0,mask:255,func:{cmp:H.ALWAYS,ref:1,mask:255},opFront:{fail:H.REPLACE,zfail:H.REPLACE,zpass:H.REPLACE}},pick:!1}).then(function(m){u([m])}).catch(function(m){console.warn(m),u([])});case 1:case"end":return p.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;t&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(ya);function fT(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=hT(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var m=r.next();return o=m.done,m},e:function(m){u=!0,c=m},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function hT(e,i){if(!!e){if(typeof e=="string")return l1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l1(e,i)}}function l1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function pT(e){var i=dT();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function dT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var g0=function(e){(0,hr.Z)(r,e);var i=pT(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"needListen",!0),(0,T.Z)((0,$e.Z)(n),"isVector",!0),(0,T.Z)((0,$e.Z)(n),"isTileLayer",!0),(0,T.Z)((0,$e.Z)(n),"type",n.layerType||"vectorLayer"),(0,T.Z)((0,$e.Z)(n),"pickedID",null),(0,T.Z)((0,$e.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0,n.reRender()}),n}return(0,yt.Z)(r,[{key:"init",value:function(){var t=this,o=this.container.get(Ft.SceneID);this.configService.setLayerConfig(o,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.type==="PointLayer"&&(this.iconService=this.container.get(Ft.IIconService),this.fontService=this.container.get(Ft.IFontService)),this.rendererService=this.container.get(Ft.IRendererService),this.layerService=this.container.get(Ft.ILayerService),this.mapService=this.container.get(Ft.IMapService),this.cameraService=this.container.get(Ft.ICameraService),this.coordinateService=this.container.get(Ft.ICoordinateSystemService),this.shaderModuleService=this.container.get(Ft.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Ft.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Ft.IFactoryNormalPass),this.styleAttributeService=this.container.get(Ft.IStyleAttributeService),this.pendingStyleAttributes.forEach(function(m){var b=m.attributeName,C=m.attributeField,A=m.attributeValues,P=m.updateOptions;t.styleAttributeService.updateStyleAttribute(b,{scale:(0,oe.Z)({field:C},t.splitValuesAndCallbackInAttribute(A,t.getLayerConfig()[b]))},P)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Ft.ILayerPlugin);var u=fT(this.plugins),c;try{for(u.s();!(c=u.n()).done;){var p=c.value;p.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(m){u.e(m)}finally{u.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this}},{key:"renderModels",value:function(t){var o=this;return this.models.forEach(function(u){u.draw({uniforms:o.layerModel.getUninforms()},t)}),this}},{key:"getPickID",value:function(){return this.pickedID}},{key:"setPickID",value:function(){return this.pickedID}},{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new o(this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"getModelType",value:function(){switch(this.layerType){case"PolygonLayer":return s1;case"LineLayer":return this.getLineModel();case"PointLayer":return this.getPointModel();case"MaskLayer":return u1;default:return m0}}},{key:"getLineModel",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(t=o.scale)===null||t===void 0?void 0:t.field;switch(u){case"tileline":case"line":return vm;case"simple":return zA;default:return vm}}},{key:"getPointModel",value:function(){var t=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,c=t.find(function(m){return m.hasOwnProperty("shape")});if(c){var p=c.shape;return(u==null?void 0:u.indexOf(p))!==-1?m0:o1}else return m0}},{key:"getDefaultConfig",value:function(){return{}}}]),r}(Uf),vT=fe(32676);function mT(e,i,r){r===void 0&&(r={});var n=Xt(e),t=Xt(i),o=vT.union(n.coordinates,t.coordinates);return o.length===0?null:o.length===1?Ci(o[0],r.properties):po(o,r.properties)}var gT=mT;function yT(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return c1(e);case"FeatureCollection":return _T(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return mm(e);default:throw new Error("unknown GeoJSON type")}}function c1(e){var i={type:"Feature"};return Object.keys(e).forEach(function(r){switch(r){case"type":case"properties":case"geometry":return;default:i[r]=e[r]}}),i.properties=f1(e.properties),i.geometry=mm(e.geometry),i}function f1(e){var i={};return e&&Object.keys(e).forEach(function(r){var n=e[r];typeof n=="object"?n===null?i[r]=null:Array.isArray(n)?i[r]=n.map(function(t){return t}):i[r]=f1(n):i[r]=n}),i}function _T(e){var i={type:"FeatureCollection"};return Object.keys(e).forEach(function(r){switch(r){case"type":case"features":return;default:i[r]=e[r]}}),i.features=e.features.map(function(r){return c1(r)}),i}function mm(e){var i={type:e.type};return e.bbox&&(i.bbox=e.bbox),e.type==="GeometryCollection"?(i.geometries=e.geometries.map(function(r){return mm(r)}),i):(i.coordinates=h1(e.coordinates),i)}function h1(e){var i=e;return typeof i[0]!="object"?i.slice():i.map(function(r){return h1(r)})}var xT=yT;function bT(e,i){i===void 0&&(i={});var r=Xt(e);switch(!i.properties&&e.type==="Feature"&&(i.properties=e.properties),r.type){case"Polygon":return ET(r,i);case"MultiPolygon":return ST(r,i);default:throw new Error("invalid poly")}}function ET(e,i){i===void 0&&(i={});var r=Xt(e),n=r.coordinates,t=i.properties?i.properties:e.type==="Feature"?e.properties:{};return p1(n,t)}function ST(e,i){i===void 0&&(i={});var r=Xt(e),n=r.coordinates,t=i.properties?i.properties:e.type==="Feature"?e.properties:{},o=[];return n.forEach(function(u){o.push(p1(u,t))}),hi(o)}function p1(e,i){return e.length>1?Xn(e,i):Hi(e[0],i)}var d1={features:[],featureId:null,vectorTileLayer:null,source:null},Jp=function(){function e(i){(0,vt.Z)(this,e),(0,T.Z)(this,"outSideEventTimer",null),(0,T.Z)(this,"eventCache",{click:0,mousemove:0,mouseup:0,mousedown:0,contextmenu:0}),this.parentLayer=i.parent,this.mapService=i.mapService,this.rendererService=i.rendererService;var r=this.parentLayer.getSource();this.zoomOffset=r.parser.zoomOffset||0,this.tilesetManager=r.tileset}return(0,yt.Z)(e,[{key:"createTile",value:function(r,n){return{layers:[],layerIDList:[]}}},{key:"getFeatureData",value:function(r,n){var t=n.sourceLayer,o=n.featureId,u=n.transforms,c=u===void 0?[]:u,p=n.layerType,m=n.shape;if(!t)return d1;var b=r.data.layers[t],C=b==null?void 0:b.features;if(Array.isArray(C)&&C.length>0){var A=[];p==="LineLayer"&&m==="simple"?C.map(function(O){var D=xT(O);if(D.geometry.type==="MultiPolygon"){var N,j=bT(D).features;(N=A).push.apply(N,(0,ee.Z)(j))}else D.geometry.type==="Polygon"&&(D.geometry.type="MultiLineString"),A.push(D)}):A=C;var P=new us({type:"FeatureCollection",features:A},{parser:{type:"geojson",featureId:o,cancelExtent:!0},transforms:c});return{features:A,featureId:o,vectorTileLayer:b,source:P}}else return d1}},{key:"createLayer",value:function(r){var n=r.L7Layer,t=r.tile,o=r.initOptions,u=r.vectorTileLayer,c=r.source,p=r.needListen,m=p===void 0?!0:p,b=o.mask,C=o.color,A=o.layerType,P=o.size,O=o.shape,D=o.usage,N=o.basemapColor,j=o.basemapSize,ae=n||g0,re=new ae((0,oe.Z)({visible:t.isVisible,tileOrigin:u==null?void 0:u.l7TileOrigin,coord:u==null?void 0:u.l7TileCoord,needListen:m},this.getLayerInitOption(o)));if(A&&(re.type=A),re.isTileLayer=!0,re.isVector&&D!=="basemap"&&(this.emitEvent([re]),re.select(!0)),re.source(c),d0(re,this.parentLayer,"shape",O),D!=="basemap"?(gA(re,this.parentLayer),d0(re,this.parentLayer,"color",C),d0(re,this.parentLayer,"size",P)):re.style({color:N,size:j}),b&&re.isVector){var Te=new g0({layerType:"MaskLayer"}).source({type:"FeatureCollection",features:[t.bboxPolygon]},{parser:{type:"geojson",cancelExtent:!0}});V_(this.parentLayer,[Te]),re.addMaskLayer(Te)}return this.layers=[re],re}},{key:"updateStyle",value:function(r){return""}},{key:"getTile",value:function(r,n){var t=this.mapService.getZoom();return this.tilesetManager.getTileByLngLat(r,n,t)}},{key:"bindVectorEvent",value:function(r){var n=this;r.on("click",function(t){n.eventCache.click=1,n.getFeatureAndEmitEvent("subLayerClick",t)}),r.on("mousemove",function(t){n.eventCache.mousemove=1,n.getFeatureAndEmitEvent("subLayerMouseMove",t)}),r.on("mouseenter",function(t){n.getFeatureAndEmitEvent("subLayerMouseEnter",t)})}},{key:"readRasterTile",value:function(r,n){var t=r.lngLat,o=t.lng,u=t.lat,c=this.getTile(o,u);if(!!c){var p=wA(c,this.mapService,r.x,r.y);r.value=p,this.parentLayer.emit(n,r)}}},{key:"bindRasterEvent",value:function(r){var n=this;r.on("click",function(t){n.eventCache.click=1,n.readRasterTile(t,"subLayerClick")}),r.on("mousemove",function(t){n.eventCache.mousemove=1,n.readRasterTile(t,"subLayerMouseMove")}),r.on("mouseenter",function(t){n.readRasterTile(t,"subLayerMouseMove")})}},{key:"bindCommonEvent",value:function(r){var n=this;r.on("mouseup",function(t){n.eventCache.mouseup=1,n.getFeatureAndEmitEvent("subLayerMouseUp",t)}),r.on("mouseout",function(t){n.getFeatureAndEmitEvent("subLayerMouseOut",t)}),r.on("mousedown",function(t){n.eventCache.mousedown=1,n.getFeatureAndEmitEvent("subLayerMouseDown",t)}),r.on("contextmenu",function(t){n.eventCache.contextmenu=1,n.getFeatureAndEmitEvent("subLayerContextmenu",t)}),r.on("unclick",function(t){return n.handleOutsideEvent("click","subLayerUnClick",r,t)}),r.on("unmouseup",function(t){return n.handleOutsideEvent("mouseup","subLayerUnMouseUp",r,t)}),r.on("unmousedown",function(t){return n.handleOutsideEvent("mousedown","subLayerUnMouseDown",r,t)}),r.on("uncontextmenu",function(t){return n.handleOutsideEvent("contextmenu","subLayerUnContextmenu",r,t)})}},{key:"emitEvent",value:function(r){var n=this;r.map(function(t){t.once("modelLoaded",function(){n.bindVectorEvent(t),n.bindCommonEvent(t)})})}},{key:"emitRasterEvent",value:function(r){var n=this;r.map(function(t){t.once("modelLoaded",function(){n.bindRasterEvent(t),n.bindCommonEvent(t)})})}},{key:"getCombineFeature",value:function(r){var n=null,t=r[0];return r.map(function(o){var u=Ci(o.coordinates);n===null&&(n=u),n=gT(n,u)}),t&&(n.properties=(0,oe.Z)({},t)),n}},{key:"getFeatureAndEmitEvent",value:function(r,n){var t=n.featureId,o=this.getAllFeatures(t);try{n.feature=this.getCombineFeature(o)}catch(u){console.warn("Combine Featuer Err! Return First Feature!"),n.feature=o[0]}this.parentLayer.emit(r,n)}},{key:"getAllFeatures",value:function(r){var n=this.parentLayer.tileLayer.children,t=[];return n.map(function(o){var u=o.getSource();u.data.dataArray.map(function(c){c._id===r&&t.push(c)})}),t}},{key:"getLayerInitOption",value:function(r){var n=(0,oe.Z)({},r);return delete n.color,delete n.shape,delete n.size,delete n.coords,delete n.sourceLayer,delete n.coords,n}},{key:"handleOutsideEvent",value:function(r,n,t,o){var u=this;this.outSideEventTimer&&(clearTimeout(this.outSideEventTimer),this.outSideEventTimer=null),this.outSideEventTimer=setTimeout(function(){u.eventCache[r]>0?u.eventCache[r]=0:u.getFeatureAndEmitEvent(n,o)},64)}}]),e}();function CT(e){var i=wT();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function wT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AT=function(e){(0,hr.Z)(r,e);var i=CT(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.parentLayer=n.parent,t}return(0,yt.Z)(r,[{key:"createTile",value:function(t,o){var u=this.getFeatureData(t,o),c=u.features,p=u.vectorTileLayer,m=u.source;if(c.length===0)return{layers:[],layerIDList:[]};var b=this.createLayer({tile:t,initOptions:o,vectorTileLayer:p,source:m});return{layers:[b],layerIDList:[b.id]}}}]),r}(Jp);function TT(e){var i=MT();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function MT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IT=function(e){(0,hr.Z)(r,e);var i=TT(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.parentLayer=n.parent,t}return(0,yt.Z)(r,[{key:"createTile",value:function(t,o){var u=this.getFeatureData(t,o),c=u.features,p=u.vectorTileLayer,m=u.source;if(c.length===0)return{layers:[],layerIDList:[]};var b=this.createLayer({tile:t,initOptions:o,vectorTileLayer:p,source:m,needListen:!1});return{layers:[b],layerIDList:[b.id]}}}]),r}(Jp);function kT(e){var i=PT();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function PT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LT=function(e){(0,hr.Z)(r,e);var i=kT(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.parentLayer=n.parent,t}return(0,yt.Z)(r,[{key:"createTile",value:function(t,o){var u=this.getFeatureData(t,o),c=u.features,p=u.vectorTileLayer,m=u.source;if(c.length===0)return{layers:[],layerIDList:[]};var b=this.createLayer({tile:t,initOptions:o,vectorTileLayer:p,source:m});return{layers:[b],layerIDList:[b.id]}}}]),r}(Jp);function RT(e){var i=OT();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function OT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DT=function(e){(0,hr.Z)(r,e);var i=RT(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.parentLayer=n.parent,t}return(0,yt.Z)(r,[{key:"createTile",value:function(t,o){var u=this.getFeatureData(t,o),c=u.features,p=u.vectorTileLayer,m=u.source;if(c.length===0)return{layers:[],layerIDList:[]};var b=this.createLayer({tile:t,initOptions:o,vectorTileLayer:p,source:m,needListen:!1});return{layers:[b],layerIDList:[b.id]}}}]),r}(Jp);function FT(e){var i=BT();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function BT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var v1=function(e){(0,hr.Z)(r,e);var i=FT(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.parentLayer=n.parent,t}return(0,yt.Z)(r,[{key:"createTile",value:function(t,o){var u=new us(t.data,{parser:{type:"image",extent:t.bounds}}),c=this.createLayer({L7Layer:U_,tile:t,initOptions:o,source:u});return{layers:[c],layerIDList:[c.id]}}}]),r}(Jp);function NT(e){var i=zT();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function zT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UT=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;



// float getBlurIndusty() {
//   vec2 u_ViewportSize = vec2(1024);

//     float vW = 2.0/u_ViewportSize.x;
//     float vH = 2.0/u_ViewportSize.y;
//     vec2 vUv = v_texCoord;
//     float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
//     float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
//     float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

//     float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
//     float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
//     float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

//     float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
//     float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
//     float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

//     return(
//         i11 + 
//         i12 + 
//         i13 + 
//         i21 + 
//         i21 + 
//         i22 + 
//         i23 + 
//         i31 + 
//         i32 + 
//         i33
//         )/9.0;
// }

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;

  // float value = getBlurIndusty();


  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,ZT=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,VT=function(e){(0,hr.Z)(r,e);var i=NT(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.colorTexture,c=u===void 0?t({data:[],width:0,height:0,flipY:!1}):u,p=o.opacity,m=p===void 0?1:p,b=o.clampLow,C=b===void 0?!0:b,A=o.clampHigh,P=A===void 0?!0:A,O=o.noDataValue,D=O===void 0?-9999999:O,N=o.domain,j=N===void 0?[0,1]:N;return{u_opacity:m||1,u_texture:this.texture,u_domain:j,u_clampLow:C,u_clampHigh:typeof P!="undefined"?P:C,u_noDataValue:D,u_colorTexture:c}}},{key:"initModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p,b=this.layer.getSource(),C=this.rendererService.createTexture2D,A=b.data.dataArray[0];this.texture=C({data:A.data,width:A.width,height:A.height,format:H.LUMINANCE,type:H.FLOAT}),this.layer.buildLayerModel({moduleName:"rasterTileImageData",vertexShader:ZT,fragmentShader:UT,triangulation:Rd,depth:{enable:!1},stencil:X(c,m)}).then(function(P){t([P])}).catch(function(P){console.warn(P),t([])})}},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}})}}]),r}(ya);function jT(e){var i=GT();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function GT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HT=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform float u_channelRMax: 256.;
uniform float u_channelGMax: 256.;
uniform float u_channelBMax: 256.;
varying vec2 v_texCoord;

void main() {
  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;
  gl_FragColor = vec4(rgb.r/u_channelRMax, rgb.g/u_channelGMax, rgb.b/u_channelBMax, u_opacity);
}`,WT=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,m1=function(e){(0,hr.Z)(r,e);var i=jT(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"channelRMax",256),(0,T.Z)((0,$e.Z)(n),"channelGMax",256),(0,T.Z)((0,$e.Z)(n),"channelBMax",256),n}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.channelRMax,p=t.channelGMax,m=t.channelBMax;return{u_opacity:u||1,u_texture:this.texture,u_channelRMax:c!==void 0?c:this.channelRMax,u_channelGMax:p!==void 0?p:this.channelGMax,u_channelBMax:m!==void 0?m:this.channelBMax}}},{key:"getRasterData",value:function(){var n=(0,ue.Z)(te().mark(function o(u){var c,p,m,b,C,A,P;return te().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(!Array.isArray(u.data)){D.next=4;break}return D.abrupt("return",{data:u.data,width:u.width,height:u.height});case 4:return D.next=6,u.data;case 6:return c=D.sent,p=c.rasterData,m=c.width,b=c.height,C=c.channelR,A=c.channelG,P=c.channelB,this.channelRMax=C,this.channelGMax=A,this.channelBMax=P,D.abrupt("return",{data:Array.from(p),width:m,height:b});case 17:case"end":return D.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var n=(0,ue.Z)(te().mark(function o(u){var c,p,m,b,C,A,P,O,D,N,j,ae;return te().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return c=this.layer.getLayerConfig(),p=c.mask,m=p===void 0?!1:p,b=c.maskInside,C=b===void 0?!0:b,A=this.layer.getSource(),P=this.rendererService.createTexture2D,O=A.data.dataArray[0],Te.next=6,this.getRasterData(O);case 6:D=Te.sent,N=D.data,j=D.width,ae=D.height,this.texture=P({data:N,width:j,height:ae,format:H.RGB,type:H.FLOAT}),this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:WT,fragmentShader:HT,triangulation:Rd,primitive:H.TRIANGLES,depth:{enable:!1},stencil:X(m,C)}).then(function(Re){u([Re])}).catch(function(Re){console.warn(Re),u([])});case 12:case"end":return Te.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}})}}]),r}(ya);function XT(e){var i=YT();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function YT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $T=function(e){(0,hr.Z)(r,e);var i=XT(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"type",n.layerType),n}return(0,yt.Z)(r,[{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new o(this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"getModelType",value:function(){return this.layerSource.parser.type==="rasterRgb"?m1:VT}},{key:"getDefaultConfig",value:function(){return{}}}]),r}(Uf);function qT(e){var i=KT();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function KT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QT=function(e){(0,hr.Z)(r,e);var i=qT(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.parentLayer=n.parent,t}return(0,yt.Z)(r,[{key:"createTile",value:function(t,o){var u,c,p,m=o.colorTexture,b=o.opacity,C=o.domain,A=o.clampHigh,P=o.clampLow,O=o.mask,D=t.data;if(!D.data)return console.warn("raster data not exist!"),{layers:[],layerIDList:[]};var N=(u=this.parentLayer)===null||u===void 0||(c=u.getSource())===null||c===void 0||(p=c.parser)===null||p===void 0?void 0:p.dataType,j=new $T({visible:t.isVisible,mask:O}).source(D.data,{parser:{type:N==="rgb"?"rasterRgb":"raster",width:D.width,height:D.height,extent:t.bboxPolygon.bbox}}).style({colorTexture:m,opacity:b,domain:C,clampHigh:A,clampLow:P});return this.emitRasterEvent([j]),{layers:[j],layerIDList:[j.id]}}}]),r}(Jp);function JT(e){var i=eM();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function eM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tM=function(e){(0,hr.Z)(r,e);var i=JT(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.parentLayer=n.parent,t}return(0,yt.Z)(r,[{key:"createTile",value:function(t,o){var u=o.sourceLayer;if(!u)return{layers:[],layerIDList:[]};var c=t.data.layers[u],p=c==null?void 0:c.features;if(p.length===0)return{layers:[],layerIDList:[]};var m=p[0].properties,b=new g0({layerType:"PointLayer",usage:"basemap",needListen:!1}).source([m],{parser:{type:"json",x:"textLng",y:"textLat",cancelExtent:!0}}).shape("key","text").style({size:20,color:"#000",stroke:"#fff",strokeWidth:2}),C=new g0({layerType:"LineLayer",usage:"basemap",needListen:!1}).source({type:"FeatureCollection",features:p},{parser:{type:"geojson",cancelExtent:!0}}).shape("simple").style({color:"#000"});return{layers:[C,b],layerIDList:[C.id,b.id]}}}]),r}(Jp);function rM(e,i){switch(e){case"PolygonLayer":return LT;case"LineLayer":return AT;case"PointLayer":return IT;case"MaskLayer":return DT;case"TileDebugLayer":return tM;case"RasterLayer":return Dn.includes(i.dataType)?QT:v1;default:return console.warn("Current Tile Not Exist!"),v1}}var g1=function(){function e(){(0,vt.Z)(this,e),(0,T.Z)(this,"tileCache",new Map)}return(0,yt.Z)(e,[{key:"hasTile",value:function(r){return!!this.tileCache.has(r.key)}},{key:"addTile",value:function(r){var n;if(this.hasTile(r))return{layers:[],layerIDList:[]};this.tileCache.set(r.key,r);var t=this.tileFactory.createTile(r,this.initOptions);return V_(this.parent,t.layers),(n=r.layerIDList).push.apply(n,(0,ee.Z)(t.layerIDList)),this.addChildren(t.layers),t.layers.map(function(o){o.once("modelLoaded",function(){r.layerLoad()})}),t}},{key:"removeTile",value:function(r){this.tileCache.delete(r.key),this.removeChildren(r.layerIDList,!1)}},{key:"addChild",value:function(r){this.children.push(r)}},{key:"addChildren",value:function(r){var n;(n=this.children).push.apply(n,(0,ee.Z)(r))}},{key:"removeChildren",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=[],o=[];this.children.filter(function(u){r.includes(u.id)?t.push(u):o.push(u)}),t.map(function(u){return u.destroy(n)}),this.children=o}},{key:"removeChild",value:function(r){var n=this.children.indexOf(r);n>-1&&this.children.splice(n,1),r.destroy()}},{key:"getChildren",value:function(r){return this.children.filter(function(n){return r.includes(n.id)})}},{key:"getChild",value:function(r){return this.children.filter(function(n){return n.id===r})[0]}},{key:"clearChild",value:function(){this.children.forEach(function(r){r.destroy()}),this.children.slice(0,this.children.length)}},{key:"hasChild",value:function(r){return this.children.includes(r)}},{key:"initTileFactory",value:function(){var r=this.parent.getSource(),n=rM(this.parent.type,r.parser);this.tileFactory=new n({parent:this.parent,mapService:this.mapService,rendererService:this.rendererService})}},{key:"getSourceLayer",value:function(r,n){return r==="geojsonvt"?"geojsonvt":r==="testTile"?"testTile":n}},{key:"destroy",value:function(){}}]),e}();function nM(e){var i=iM();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function iM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aM=function(e){(0,hr.Z)(r,e);var i=nM(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),(0,T.Z)((0,$e.Z)(n),"checkConfigList",[]),n.cacheConfig=new Map,n}return(0,yt.Z)(r,[{key:"setConfig",value:function(t,o){this.checkConfigList.includes(t)||this.checkConfigList.push(t),this.cacheConfig.set(t,o)}},{key:"removeConfig",value:function(t){var o=this.checkConfigList.indexOf(t);o>-1&&(this.cacheConfig.delete(t),this.checkConfigList.splice(o,1))}},{key:"checkConfig",value:function(t){var o=this;if(!!t.inited){var u=t.getLayerConfig(),c=[];this.checkConfigList.map(function(p){var m=o.cacheConfig.get(p),b;if(["color","size","shape"].includes(p)){var C;b=(C=t.getAttribute(p))===null||C===void 0?void 0:C.scale}else{if(!(p in u))return;b=u[p]}(0,Er.isEqual)(m,b)||(c.push(p),o.setConfig(p,b))}),c.length>0&&(console.warn("tile config cache update!",c),this.emit("updateConfig",c))}}},{key:"getAttributeScale",value:function(t,o){var u=t.getAttribute(o),c={field:void 0,values:void 0,callback:void 0};if(u&&u.scale){var p=u.scale,m=p.field,b=p.values,C=p.callback;c.field=m,c.values=b,c.callback=C}return c}}]),r}(sh());function oM(e){var i=sM();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function sM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uM=function(e){(0,hr.Z)(r,e);var i=oM(r);function r(n,t,o,u,c){var p;return(0,vt.Z)(this,r),p=i.call(this),(0,T.Z)((0,$e.Z)(p),"isLastPicked",!1),p.parent=n,p.rendererService=t,p.pickingService=o,p.children=u,p.tileRenderService=c,p}return(0,yt.Z)(r,[{key:"pick",value:function(t,o){var u=this;this.tileRenderService.renderMask(this.parent);var c=t.filter(function(p){return u.parent.needPick(o.type)&&p.inited&&p.isVisible()}).some(function(p){p.hooks.beforePickingEncode.call(),p.masks.length>0&&(u.rendererService.clear({stencil:0,depth:1,framebuffer:null}),p.masks.map(function(b){b.hooks.beforeRender.call(),b.render(),b.hooks.afterRender.call()})),p.renderModels(!0),p.hooks.afterPickingEncode.call();var m=u.pickingService.pickFromPickingFBO(p,o);return m&&u.parent.type!=="RasterLayer"&&(u.emit("pick",{type:o.type,pickedColors:u.pickingService.pickedColors,layer:p}),u.pickingService.pickedTileLayers=[u.parent]),m});return this.parent.type!=="RasterLayer"&&!c&&this.isLastPicked&&o.type!=="click"&&(this.pickingService.pickedTileLayers=[],this.emit("unpick",{}),this.beforeHighlight([0,0,0])),this.isLastPicked=c,c}},{key:"clearPick",value:function(){this.children.filter(function(t){return t.inited&&t.isVisible()}).map(function(t){t.hooks.beforeSelect.call([0,0,0])}),this.pickingService.pickedTileLayers=[]}},{key:"beforeHighlight",value:function(t){this.children.filter(function(o){return o.inited&&o.isVisible()}).map(function(o){o.hooks.beforeHighlight.call(t)})}},{key:"beforeSelect",value:function(t){this.children.filter(function(o){return o.inited&&o.isVisible()}).map(function(o){o.hooks.beforeSelect.call(t)})}},{key:"destroy",value:function(){this.removeAllListeners()}}]),r}(iu.EventEmitter),lM=function(){function e(i){(0,vt.Z)(this,e),this.rendererService=i}return(0,yt.Z)(e,[{key:"render",value:function(r){var n=this;r.filter(function(t){return t.inited}).filter(function(t){return t.isVisible()}).map(function(t){t.hooks.beforeRenderData.call(),t.hooks.beforeRender.call(),t.masks.length>0&&(n.rendererService.clear({stencil:0,depth:1,framebuffer:null}),t.masks.map(function(o){o.hooks.beforeRenderData.call(),o.hooks.beforeRender.call(),o.render(),o.hooks.afterRender.call()})),t.render(),t.hooks.afterRender.call()})}},{key:"renderMask",value:function(r){r.inited&&r.isVisible()&&r.masks.length>0&&(r.hooks.beforeRender.call(),this.rendererService.clear({stencil:0,depth:1,framebuffer:null}),r.masks.map(function(n){n.hooks.beforeRender.call(),n.render(),n.hooks.afterRender.call()}),r.hooks.afterRender.call())}}]),e}(),y1=["size","color","shape"],y0=["opacity","zIndex"],cM=["mask","rampColors","domain","clampHigh","clampLow","pixelConstant","pixelConstantR","pixelConstantG","pixelConstantB","pixelConstantRGB"].concat(y0),fM=["stroke","strokeWidth","strokeOpacity","color","shape","size"].concat(y0),hM=["stroke","strokeWidth","strokeOpacity","color","shape","size"].concat(y0),pM=["color","shape"].concat(y0),dM={PointLayer:fM,LineLayer:hM,PolygonLayer:pM,RasterLayer:cM,MaskLayer:[],TileDebugLayer:[]};function vM(e){var i=mM();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function mM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gM=function(e){(0,hr.Z)(r,e);var i=vM(r);function r(n,t,o,u,c){var p;return(0,vt.Z)(this,r),p=i.call(this),p.parent=n,p.children=n.layerChildren,p.mapService=t,p.rendererService=o,p.transforms=c,p.tileRenderService=new lM(o),p.tilePickService=new uM(n,o,u,p.children,p.tileRenderService),p.tileStyleService=new aM,p.setSubLayerInitOption(),p.setConfigListener(),p.initTileFactory(),p}return(0,yt.Z)(r,[{key:"render",value:function(){this.tileStyleService.checkConfig(this.parent),this.tileRenderService.render(this.children)}},{key:"pickLayers",value:function(t){return this.tilePickService.pick(this.children,t)}},{key:"setSubLayerInitOption",value:function(){var t,o=this.parent.getLayerConfig(),u=o.zIndex,c=u===void 0?0:u,p=o.opacity,m=p===void 0?1:p,b=o.mask,C=b===void 0?!1:b,A=o.stroke,P=A===void 0?"#fff":A,O=o.strokeWidth,D=O===void 0?0:O,N=o.strokeOpacity,j=N===void 0?1:N,ae=o.clampLow,re=ae===void 0?!0:ae,Te=o.clampHigh,Re=Te===void 0?!0:Te,Ke=o.domain,gt=Ke===void 0?[0,1]:Ke,lt=o.rampColors,Ut=lt===void 0?{colors:["rgb(166,97,26)","rgb(223,194,125)","rgb(245,245,245)","rgb(128,205,193)","rgb(1,133,113)"],positions:[0,.25,.5,.75,1]}:lt,or=o.featureId,cr=or===void 0?"id":or,Tr=o.workerEnabled,Sn=Tr===void 0?!1:Tr,Un=o.sourceLayer,Vi=o.pixelConstant,Ba=Vi===void 0?0:Vi,ho=o.pixelConstantR,Ao=ho===void 0?256*256:ho,Wo=o.pixelConstantG,Ju=Wo===void 0?256:Wo,up=o.pixelConstantB,lp=up===void 0?1:up,cp=o.pixelConstantRGB,Wd=cp===void 0?.1:cp,Pv=this.tileStyleService.getAttributeScale(this.parent,"color"),Xd=this.tileStyleService.getAttributeScale(this.parent,"size"),Yd=this.parent.getSource(),$m=(Yd==null||(t=Yd.data)===null||t===void 0?void 0:t.tilesetOptions)||{},xi=$m.coords,La=Yd.getParserType(),$a=j_(this.parent.type,this.parent);if(this.initOptions={layerType:this.parent.type,transforms:this.transforms,shape:$a,zIndex:c,opacity:m,sourceLayer:this.getSourceLayer(La,Un),coords:xi,featureId:cr,color:Pv,size:Xd,mask:G_(this.parent.type,C),stroke:P,strokeWidth:D,strokeOpacity:j,clampLow:re,clampHigh:Re,domain:gt,rampColors:Ut,workerEnabled:Sn,pixelConstant:Ba,pixelConstantR:Ao,pixelConstantG:Ju,pixelConstantB:lp,pixelConstantRGB:Wd},Ut){var In=this.rendererService.createTexture2D,xu=M(Ut),zo=In({data:xu.data,width:xu.width,height:xu.height,flipY:!1});this.initOptions.colorTexture=zo}}},{key:"getInitOptionValue",value:function(t){var o,u,c;switch(t){case"color":return(o=this.parent.getAttribute("color"))===null||o===void 0?void 0:o.scale;case"shape":return(u=this.parent.getAttribute("shape"))===null||u===void 0?void 0:u.scale;case"size":return(c=this.parent.getAttribute("size"))===null||c===void 0?void 0:c.scale;default:return this.initOptions[t]}}},{key:"setInitOptionValue",value:function(t,o){this.initOptions[t]=o}},{key:"setConfigListener",value:function(){var t=this,o=dM[this.parent.type]||[];o.map(function(u){t.tileStyleService.setConfig(u,t.getInitOptionValue(u))}),this.tileStyleService.on("updateConfig",function(u){u.map(function(c){return t.updateStyle(c)})})}},{key:"updateAttribute",value:function(t){var o=this;if(y1.includes(t)){var u,c=(u=this.parent.getAttribute(t))===null||u===void 0?void 0:u.scale;if(!c)return;this.children.map(function(p){return d0(p,o.parent,t,c)})}}},{key:"updateStyle",value:function(t){var o=null;if(y1.includes(t))this.updateAttribute(t);else{var u=this.parent.getLayerConfig();if(!(t in u))return;var c=u[t];switch(o=c,t){case"rampColors":var p=pA(c,this.children,this.rendererService);this.initOptions.colorTexture=p;break;default:pm(this.children,t,c)}}this.setInitOptionValue(t,o)}},{key:"destroy",value:function(){this.tilePickService.destroy()}}]),r}(g1),_1=function(){function e(){(0,vt.Z)(this,e),(0,T.Z)(this,"initedTileset",!1),(0,T.Z)(this,"viewchange",(0,Er.debounce)(this.mapchange,200))}return(0,yt.Z)(e,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"mapchange",value:function(){var r,n=this.getCurrentView(),t=n.latLonBounds,o=n.zoom;if(this.mapService.version==="GAODE1.x"){var u=this.parent.getLayerConfig(),c=u.visible;o<3&&c?(this.parent.updateLayerConfig({visible:!1}),this.layerService.reRender()):o>=3&&!c&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.reRender())}this.lastViewStates&&this.lastViewStates.zoom===o&&this.lastViewStates.latLonBounds.toString()===t.toString()||(this.lastViewStates={zoom:o,latLonBounds:t},(r=this.tilesetManager)===null||r===void 0||r.throttleUpdate(o,t))}},{key:"getCurrentView",value:function(){var r=this.mapService.getBounds(),n=[r[0][0],r[0][1],r[1][0],r[1][1]],t=this.mapService.getZoom();return{latLonBounds:n,zoom:t}}},{key:"initTileSetManager",value:function(){var r,n=this.parent.getSource();this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var t=this.getCurrentView(),o=t.latLonBounds,u=t.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(u,o)}},{key:"bindTilesetEvent",value:function(){var r=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){r.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,t){r.tileError(n)}),this.tilesetManager.on("tile-update",function(){r.tileUpdate()}),this.mapService.on("zoomend",function(){return r.viewchange()}),this.mapService.on("moveend",function(){return r.viewchange()}))}},{key:"render",value:function(){this.tileLayerManager.render()}},{key:"tileLoaded",value:function(r){}},{key:"tileError",value:function(r){console.warn("error:",r)}},{key:"destroy",value:function(){var r;(r=this.tilesetManager)===null||r===void 0||r.destroy(),this.tileLayerManager.destroy()}},{key:"tileUnLoad",value:function(r){this.tileLayerManager.removeTile(r)}},{key:"tileUpdate",value:function(){var r=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(n){return n.isLoaded}).map(function(n){if(!!r.isTileReady(n))if(r.tileLayerManager.hasTile(n)){if(!n.isVisibleChange)return;var u=r.tileLayerManager.getChildren(n.layerIDList);CA(n,u,r.layerService),r.setPickState(u)}else{var t=r.tileLayerManager.addTile(n),o=t.layers;r.setPickState(o)}}),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}},{key:"isTileReady",value:function(r){var n;if((n=r.data)!==null&&n!==void 0&&n.layers&&this.sourceLayer){var t=r.data.layers[this.sourceLayer],o=t==null?void 0:t.features;if(!(Array.isArray(o)&&o.length>0))return!1}return!0}},{key:"setPickState",value:function(r){}}]),e}();function yM(e){e.filter(function(i){return i.inited&&i.isVisible()}).filter(function(i){return i.getCurrentSelectedId()!==null}).map(function(i){Od(i,new Uint8Array([0,0,0,0])),i.setCurrentSelectedId(null)})}function _M(e,i,r){var n=g(i),t;return e.map(function(o){o.getCurrentSelectedId()===null||n!==o.getCurrentSelectedId()?(Od(o,i),o.setCurrentSelectedId(n),t=i):(Od(o,new Uint8Array([0,0,0,0])),o.setCurrentSelectedId(null),t=null)}),r.filter(function(o){return o.inited&&!o.isVector&&o.isVisible()&&o.needPick("click")}).filter(function(o){return o.getCurrentSelectedId()!==null}).map(function(o){Od(o,new Uint8Array([0,0,0,0])),o.setCurrentSelectedId(null)}),t}function xM(e,i){var r=g(i);e.filter(function(n){return n.inited&&n.isVisible()&&n.isVector}).filter(function(n){return n.getPickID()!==r}).map(function(n){n.setPickID(r),n.hooks.beforeHighlight.call(i)})}function bM(e,i){i.select&&e.map(function(r){Od(r,i.select)}),i.active&&e.filter(function(r){return r.inited&&r.isVisible()}).map(function(r){r.hooks.beforeHighlight.call(i.active)})}function Od(e,i){var r=(0,ce.Z)(i,3),n=r[0],t=r[1],o=r[2];e.hooks.beforeSelect.call([n,t,o])}function qR(e,i){var r=decodePickingColor(e);i.map(function(n){Od(n,e),n.setCurrentSelectedId(r)})}function KR(e,i){var r=decodePickingColor(e);i.map(function(n){n.hooks.beforeHighlight.call(e),n.setCurrentPickId(r)})}function EM(e){var i=SM();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function SM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CM=function(e){(0,hr.Z)(r,e);var i=EM(r);function r(n){var t,o,u=n.parent,c=n.rendererService,p=n.mapService,m=n.layerService,b=n.pickingService,C=n.transforms;(0,vt.Z)(this,r),o=i.call(this),(0,T.Z)((0,$e.Z)(o),"pickColors",{select:null,active:null});var A=u.getSource(),P=(A==null||(t=A.data)===null||t===void 0?void 0:t.tilesetOptions)||{},O=P.sourceLayer;return o.sourceLayer=O,o.parent=u,o.mapService=p,o.layerService=m,o.tileLayerManager=new gM(u,p,c,b,C),o.initTileSetManager(),o.bindSubLayerEvent(),o.bindSubLayerPick(),o.scaleField=o.parent.getScaleOptions(),o}return(0,yt.Z)(r,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"clearPick",value:function(t){t==="mousemove"&&this.tileLayerManager.tilePickService.clearPick()}},{key:"clearPickState",value:function(){yM(this.children)}},{key:"pickLayers",value:function(t){return this.tileLayerManager.pickLayers(t)}},{key:"setPickState",value:function(t){bM(t,this.pickColors)}},{key:"bindSubLayerPick",value:function(){var t=this;this.tileLayerManager.tilePickService.on("pick",function(o){var u=(0,ce.Z)(o.pickedColors,3),c=u[0],p=u[1],m=u[2];if(o.type==="click"){var b=t.children.filter(function(P){return P.inited&&P.isVisible()&&P.isVector}).filter(function(P){return P!==o.layer}),C=t.layerService.getRenderList(),A=_M(b,[c,p,m],C);t.pickColors.select=A}else xM(t.children,[c,p,m]),t.pickColors.active=[c,p,m]}),this.tileLayerManager.tilePickService.on("unpick",function(){t.pickColors.active=null})}},{key:"bindSubLayerEvent",value:function(){var t=this;this.parent.on("subLayerClick",function(o){t.parent.emit("click",(0,oe.Z)({},o))}),this.parent.on("subLayerMouseMove",function(o){return t.parent.emit("mousemove",(0,oe.Z)({},o))}),this.parent.on("subLayerMouseUp",function(o){return t.parent.emit("mouseup",(0,oe.Z)({},o))}),this.parent.on("subLayerMouseEnter",function(o){return t.parent.emit("mouseenter",(0,oe.Z)({},o))}),this.parent.on("subLayerMouseOut",function(o){return t.parent.emit("mouseout",(0,oe.Z)({},o))}),this.parent.on("subLayerMouseDown",function(o){return t.parent.emit("mousedown",(0,oe.Z)({},o))}),this.parent.on("subLayerContextmenu",function(o){return t.parent.emit("contextmenu",(0,oe.Z)({},o))}),this.parent.on("subLayerUnClick",function(o){return t.parent.emit("unclick",(0,oe.Z)({},o))}),this.parent.on("subLayerUnMouseMove",function(o){return t.parent.emit("unmousemove",(0,oe.Z)({},o))}),this.parent.on("subLayerUnMouseUp",function(o){return t.parent.emit("unmouseup",(0,oe.Z)({},o))}),this.parent.on("subLayerUnMouseDown",function(o){return t.parent.emit("unmousedown",(0,oe.Z)({},o))}),this.parent.on("subLayerUnContextmenu",function(o){return t.parent.emit("uncontextmenu",(0,oe.Z)({},o))})}}]),r}(_1);function wM(e){var i=AM();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function AM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TM=function(e){(0,hr.Z)(r,e);var i=wM(r);function r(n,t,o){var u;return(0,vt.Z)(this,r),u=i.call(this),u.parent=n,u.children=n.layerChildren,u.mapService=t,u.rendererService=o,u.setSubLayerInitOption(),u.initTileFactory(),u}return(0,yt.Z)(r,[{key:"render",value:function(){var t=this;this.children.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).map(function(o){o.hooks.beforeRenderData.call(),o.hooks.beforeRender.call(),o.masks.length>0&&(t.rendererService.clear({stencil:0,depth:1,framebuffer:null}),o.masks.map(function(u){u.hooks.beforeRenderData.call(),u.hooks.beforeRender.call(),u.render(),u.hooks.afterRender.call()})),o.render(),o.hooks.afterRender.call()})}},{key:"setSubLayerInitOption",value:function(){var t,o,u=this.parent.getLayerConfig(),c=u.zIndex,p=c===void 0?0:c,m=u.opacity,b=m===void 0?1:m,C=u.mask,A=C===void 0?!1:C,P=u.stroke,O=P===void 0?"#fff":P,D=u.strokeWidth,N=D===void 0?0:D,j=u.strokeOpacity,ae=j===void 0?1:j,re=u.workerEnabled,Te=re===void 0?!1:re,Re=u.sourceLayer,Ke=this.parent.getSource(),gt=Ke.getParserType(),lt=this.parent.getAttribute("color"),Ut=(lt==null||(t=lt.scale)===null||t===void 0?void 0:t.field)||"#fff",or=this.parent.getAttribute("size"),cr=(or==null||(o=or.scale)===null||o===void 0?void 0:o.field)||1,Tr=j_(this.parent.type,this.parent);this.initOptions={usage:"basemap",layerType:this.parent.type,shape:Tr,zIndex:p,opacity:b,sourceLayer:this.getSourceLayer(gt,Re),basemapColor:Ut,basemapSize:cr,mask:G_(this.parent.type,A),stroke:O,strokeWidth:N,strokeOpacity:ae,workerEnabled:Te}}}]),r}(g1);function MM(e){var i=IM();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function IM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kM=function(e){(0,hr.Z)(r,e);var i=MM(r);function r(n){var t,o,u=n.parent,c=n.rendererService,p=n.mapService,m=n.layerService;(0,vt.Z)(this,r),o=i.call(this);var b=u.getSource(),C=(b==null||(t=b.data)===null||t===void 0?void 0:t.tilesetOptions)||{},A=C.sourceLayer;return o.sourceLayer=A,o.parent=u,o.mapService=p,o.layerService=m,o.tileLayerManager=new TM(u,p,c),o.initTileSetManager(),o}return(0,yt.Z)(r)}(_1);function PM(e){var i=LM();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function LM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dv=function(e){(0,hr.Z)(r,e);var i=PM(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){return{}}},{key:"getTileLayer",value:function(t){switch(t){case"basemap":return kM;default:return CM}}},{key:"initModels",value:function(){var t=this.layer.getSource(),o=this.layer.getLayerConfig(),u=o.usage;if(t!=null&&t.data.isTile&&!this.layer.tileLayer){var c=this.getTileLayer(u);this.layer.tileLayer=new c({parent:this.layer,rendererService:this.rendererService,mapService:this.mapService,layerService:this.layerService,pickingService:this.pickingService,transforms:t.transforms})}return this.buildModels()}},{key:"clearModels",value:function(){}},{key:"buildModels",value:function(){return[]}},{key:"registerBuiltinAttributes",value:function(){}}]),r}(ya);function RM(e){var i=OM();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function OM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DM=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,FM=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,BM=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,NM=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  float arcThetaOffset = styleMappingMat[0][1];
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, arcThetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, arcThetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,zM=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,UM=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,ZM={solid:0,dash:1},VM=function(e){(0,hr.Z)(r,e);var i=RM(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=c({data:n.iconService.getCanvas(),mag:H.NEAREST,min:H.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.sourceColor,p=t.targetColor,m=t.textureBlend,b=m===void 0?"normal":m,C=t.lineType,A=C===void 0?"solid":C,P=t.dashArray,O=P===void 0?[10,5]:P,D=t.forward,N=D===void 0?!0:D,j=t.lineTexture,ae=j===void 0?!1:j,re=t.iconStep,Te=re===void 0?100:re,Re=t.segmentNumber,Ke=Re===void 0?30:Re,gt=t.thetaOffset,lt=gt===void 0?.314:gt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,thetaOffset:lt})){this.judgeStyleAttributes({opacity:u,thetaOffset:lt});var Ut=this.layer.getEncodedData(),or=this.calDataFrame(this.cellLength,Ut,this.cellProperties),cr=or.data,Tr=or.width,Sn=or.height;this.rowCount=Sn,this.dataTexture=this.cellLength>0&&cr.length>0?this.createTexture2D({flipY:!0,data:cr,format:H.LUMINANCE,type:H.FLOAT,width:Tr,height:Sn}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}O.length===2&&O.push(0,0);var Un=0,Vi=[0,0,0,0],Ba=[0,0,0,0];return c&&p&&(Vi=h(c),Ba=h(p),Un=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:(0,Er.isNumber)(lt)?lt:0,u_opacity:(0,Er.isNumber)(u)?u:1,u_textureBlend:b==="normal"?0:1,segmentNumber:Ke,u_line_type:ZM[A||"solid"],u_dash_array:O,u_blur:.9,u_lineDir:N?1:-1,u_texture:this.texture,u_line_texture:ae?1:0,u_icon_step:Te,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Un,u_sourceColor:Vi,u_targetColor:Ba}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,c=t.lineType;return c==="dash"?{frag:DM,vert:FM,type:"Dash"}:o&&u?{frag:zM,vert:UM,type:"Linear"}:{frag:BM,vert:NM,type:""}}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.segmentNumber,c=u===void 0?30:u,p=o.mask,m=p===void 0?!1:p,b=o.maskInside,C=b===void 0?!0:b,A=this.getShaders(),P=A.frag,O=A.vert,D=A.type;this.layer.buildLayerModel({moduleName:"lineArc2d"+D,vertexShader:O,fragmentShader:P,triangulation:h0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:c,stencil:X(m,C)}).then(function(N){t([N])}).catch(function(N){console.warn(N),t([])})}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?1:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:gn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:4,update:function(u,c,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var c=t.iconService.getIconMap(),p=u.texture,m=c[p]||{x:0,y:0},b=m.x,C=m.y;return[b,C]}}})}}]),r}(ya);function jM(e){var i=GM();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function GM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,WM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,XM=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,YM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,$M={solid:0,dash:1},qM=function(e){(0,hr.Z)(r,e);var i=jM(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=c({data:n.iconService.getCanvas(),mag:H.NEAREST,min:H.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.sourceColor,p=t.targetColor,m=t.textureBlend,b=m===void 0?"normal":m,C=t.lineType,A=C===void 0?"solid":C,P=t.dashArray,O=P===void 0?[10,5]:P,D=t.lineTexture,N=D===void 0?!1:D,j=t.iconStep,ae=j===void 0?100:j,re=t.segmentNumber,Te=re===void 0?30:re,Re=t.globalArcHeight,Ke=Re===void 0?10:Re;O.length===2&&O.push(0,0);var gt=0,lt=[0,0,0,0],Ut=[0,0,0,0];if(c&&p&&(lt=h(c),Ut=h(p),gt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var or=this.layer.getEncodedData(),cr=this.calDataFrame(this.cellLength,or,this.cellProperties),Tr=cr.data,Sn=cr.width,Un=cr.height;this.rowCount=Un,this.dataTexture=this.cellLength>0&&Tr.length>0?this.createTexture2D({flipY:!0,data:Tr,format:H.LUMINANCE,type:H.FLOAT,width:Sn,height:Un}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:lm,u_global_height:Ke,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Er.isNumber)(u)?u:1,u_textureBlend:b==="normal"?0:1,segmentNumber:Te,u_line_type:$M[A]||0,u_dash_array:O,u_texture:this.texture,u_line_texture:N?1:0,u_icon_step:ae,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:gt,u_sourceColor:lt,u_targetColor:Ut}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:XM,vert:YM,type:"Linear"}:{frag:HM,vert:WM,type:""}}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.segmentNumber,c=u===void 0?30:u,p=o.mask,m=p===void 0?!1:p,b=o.maskInside,C=b===void 0?!0:b,A=this.getShaders(),P=A.frag,O=A.vert,D=A.type;this.layer.buildLayerModel({moduleName:"lineArc3d"+D,vertexShader:O,fragmentShader:P,triangulation:h0,blend:this.getBlend(),segmentNumber:c,stencil:X(m,C)}).then(function(N){t([N])}).catch(function(N){console.warn(N),t([])})}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?1:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:gn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:4,update:function(u,c,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var c=t.iconService.getIconMap(),p=u.texture,m=c[p]||{x:0,y:0},b=m.x,C=m.y;return[b,C]}}})}}]),r}(ya);function KM(e){var i=QM();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function QM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,e5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,t5=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,r5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,n5={solid:0,dash:1},i5=function(e){(0,hr.Z)(r,e);var i=KM(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=c({data:n.iconService.getCanvas(),mag:H.NEAREST,min:H.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.sourceColor,p=t.targetColor,m=t.textureBlend,b=m===void 0?"normal":m,C=t.lineType,A=C===void 0?"solid":C,P=t.dashArray,O=P===void 0?[10,5]:P,D=t.lineTexture,N=D===void 0?!1:D,j=t.iconStep,ae=j===void 0?100:j,re=t.segmentNumber,Te=re===void 0?30:re,Re=t.globalArcHeight,Ke=Re===void 0?10:Re;O.length===2&&O.push(0,0);var gt=0,lt=[0,0,0,0],Ut=[0,0,0,0];if(c&&p&&(lt=h(c),Ut=h(p),gt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var or=this.layer.getEncodedData(),cr=this.calDataFrame(this.cellLength,or,this.cellProperties),Tr=cr.data,Sn=cr.width,Un=cr.height;this.rowCount=Un,this.dataTexture=this.cellLength>0&&Tr.length>0?this.createTexture2D({flipY:!0,data:Tr,format:H.LUMINANCE,type:H.FLOAT,width:Sn,height:Un}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_globel:1,u_globel_radius:lm,u_global_height:Ke,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Er.isNumber)(u)?u:1,u_textureBlend:b==="normal"?0:1,segmentNumber:Te,u_line_type:n5[A]||0,u_dash_array:O,u_texture:this.texture,u_line_texture:N?1:0,u_icon_step:ae,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:gt,u_sourceColor:lt,u_targetColor:Ut}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:t5,vert:r5,type:"Linear"}:{frag:JM,vert:e5,type:""}}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.segmentNumber,c=u===void 0?30:u,p=o.mask,m=p===void 0?!1:p,b=o.maskInside,C=b===void 0?!0:b,A=this.getShaders(),P=A.frag,O=A.vert,D=A.type;this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+D,vertexShader:O,fragmentShader:P,triangulation:h0,depth:{enable:!0},blend:this.getBlend(),segmentNumber:c,stencil:X(m,C)}).then(function(N){t([N])}).catch(function(N){console.warn(N),t([])})}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?1:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:gn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:4,update:function(u,c,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var c=t.iconService.getIconMap(),p=u.texture,m=c[p]||{x:0,y:0},b=m.x,C=m.y;return[b,C]}}})}}]),r}(ya);function a5(e){var i=o5();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function o5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var s5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,u5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,l5={solid:0,dash:1},c5=function(e){(0,hr.Z)(r,e);var i=a5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=c({data:n.iconService.getCanvas(),mag:H.NEAREST,min:H.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.sourceColor,p=t.targetColor,m=t.textureBlend,b=m===void 0?"normal":m,C=t.lineType,A=C===void 0?"solid":C,P=t.dashArray,O=P===void 0?[10,5]:P,D=t.lineTexture,N=D===void 0?!1:D,j=t.iconStep,ae=j===void 0?100:j,re=t.segmentNumber,Te=re===void 0?30:re;O.length===2&&O.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Re=0,Ke=[0,0,0,0],gt=[0,0,0,0];if(c&&p&&(Ke=h(c),gt=h(p),Re=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var lt=this.layer.getEncodedData(),Ut=this.calDataFrame(this.cellLength,lt,this.cellProperties),or=Ut.data,cr=Ut.width,Tr=Ut.height;this.rowCount=Tr,this.dataTexture=this.cellLength>0&&or.length>0?this.createTexture2D({flipY:!0,data:or,format:H.LUMINANCE,type:H.FLOAT,width:cr,height:Tr}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Er.isNumber)(u)?u:1,u_textureBlend:b==="normal"?0:1,segmentNumber:Te,u_line_type:l5[A]||0,u_dash_array:O,u_texture:this.texture,u_line_texture:N?1:0,u_icon_step:ae,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Re,u_sourceColor:Ke,u_targetColor:gt}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:u5,fragmentShader:s5,triangulation:h0,depth:{enable:!1},blend:this.getBlend(),stencil:X(c,m)}).then(function(b){t([b])}).catch(function(b){console.warn(b),t([])})}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?1:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:gn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:4,update:function(u,c,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var c=t.iconService.getIconMap(),p=u.texture,m=c[p]||{x:0,y:0},b=m.x,C=m.y;return[b,C]}}})}}]),r}(ya);function f5(e){var i=h5();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function h5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p5=`#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
uniform float u_CoordinateSystem;
varying vec4 v_color;
uniform float u_arrow: 0.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

varying mat4 styleMappingMat;
void main() {
  float distanceAndIndex = styleMappingMat[0][3];
  float miter = styleMappingMat[0][2];

  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B


  if(u_arrow > 0.0 && distanceAndIndex < 2.0) { // arrow
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { 
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) { // amap
        discard;
      }
    } else { // amap2 mapbox map
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { 
        discard;
      }
    }
  } else { // line body
    if(miter < 0.0) {
      discard;
    }
  }


  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,d5=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute vec4 a_dirPoints;
attribute vec3 a_DistanceAndIndex;

uniform vec4 u_lineDir;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - a_Miter - a_DistanceAndIndex
    0.0, 0.0, 0.0, 0.0, // originX - originY - vectorX - vectorY
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );
  styleMappingMat[0][3] = a_DistanceAndIndex.y;
  styleMappingMat[0][2] = a_Miter;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  // styleMappingMat[1].rg = a_Position.xy + offset;

  vec2 copyOffset = vec2(offset.x, offset.y);

  float lineDistance = a_DistanceAndIndex.x;
  float total_Distance = a_DistanceAndIndex.z;
  float currentLinePointRatio = lineDistance / total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z); // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }
  
  if(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {
    vec2 startPoint = a_dirPoints.rg;
    vec2 endPoint = a_dirPoints.ba;
    vec4 t1 = project_position(vec4(startPoint, 0, 1.0));
    vec4 t2 = project_position(vec4(endPoint, 0, 1.0));
    // TODO\uFF1A \u540E\u7EED\u4F18\u5316\u53EF\u4EE5\u628A\u4F4D\u7F6E\u8BA1\u7B97\u653E\u5728 cpu \u4E2D\u5B8C\u6210
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      vec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    } else {
      vec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    }
  }

  setPickingColor(a_PickingColor);
}
`,v5=function(e){(0,hr.Z)(r,e);var i=f5(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.sourceColor,p=t.targetColor,m=t.arrow,b=m===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:m,C=0,A=[0,0,0,0],P=[0,0,0,0];if(c&&p&&(A=h(c),P=h(p),C=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var O=this.layer.getEncodedData(),D=this.calDataFrame(this.cellLength,O,this.cellProperties),N=D.data,j=D.width,ae=D.height;this.rowCount=ae,this.dataTexture=this.cellLength>0&&N.length>0?this.createTexture2D({flipY:!0,data:N,format:H.LUMINANCE,type:H.FLOAT,width:j,height:ae}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Er.isNumber)(u)?u:1,u_linearColor:C,u_sourceColor:A,u_targetColor:P,u_arrow:Number(b.enable),u_arrowHeight:b.arrowHeight||3,u_arrowWidth:b.arrowWidth||2,u_tailWidth:b.tailWidth===void 0?1:b.tailWidth}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,ue.Z)(te().mark(function o(u){var c,p,m,b,C,A,P,O,D,N;return te().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:c=this.layer.getLayerConfig(),p=c.mask,m=p===void 0?!1:p,b=c.maskInside,C=b===void 0?!0:b,A=c.depth,P=A===void 0?!1:A,O=this.getShaders(),D=O.frag,N=O.vert,this.layer.triangulation=Qp,this.layer.buildLayerModel({moduleName:"lineHalf",vertexShader:N,fragmentShader:D,triangulation:Qp,depth:{enable:P},blend:this.getBlend(),stencil:X(m,C)}).then(function(re){u([re])}).catch(function(re){console.warn(re),u([])});case 4:case"end":return ae.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){return{frag:p5,vert:d5,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:gn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o,u,c,p,m,b){return b===void 0?[c[3],10,c[5]]:[c[3],b,c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:gn.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:4,update:function(o){var u=o.coordinates[0]||[0,0],c=o.coordinates[3]||[0,0];return[u[0],u[1],c[0],c[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o){var u=o.size,c=u===void 0?1:u;return Array.isArray(c)?[c[0],c[1]]:[c,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o,u,c,p,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o,u,c){return[c[4]]}}})}}]),r}(ya),x1;(function(e){e[e.solid=0]="solid",e[e.dash=1]="dash"})(x1||(x1={}));var Dd;(function(e){e.VERTICAL="vertical",e.HORIZONTAL="horizontal"})(Dd||(Dd={}));var gm;(function(e){e.NORMAL="normal",e.REPLACE="replace"})(gm||(gm={}));var b1;(function(e){e.ALWAYS="always",e.DRAGEND="dragend"})(b1||(b1={}));function m5(e){var i=g5();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function g5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y5=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,_5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,x5=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = styleMappingMat[3][3];
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,E1=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,b5=`varying vec4 v_color;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3][0]; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,E5={solid:0,dash:1},S1=function(e){(0,hr.Z)(r,e);var i=m5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=c({data:n.iconService.getCanvas(),mag:H.NEAREST,min:H.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.sourceColor,p=t.targetColor,m=t.textureBlend,b=m===void 0?"normal":m,C=t.lineType,A=C===void 0?"solid":C,P=t.dashArray,O=P===void 0?[10,5,0,0]:P,D=t.lineTexture,N=D===void 0?!1:D,j=t.iconStep,ae=j===void 0?100:j,re=t.vertexHeightScale,Te=re===void 0?20:re,Re=t.borderWidth,Ke=Re===void 0?0:Re,gt=t.borderColor,lt=gt===void 0?"#ccc":gt,Ut=t.raisingHeight,or=Ut===void 0?0:Ut,cr=t.heightfixed,Tr=cr===void 0?!1:cr,Sn=t.linearDir,Un=Sn===void 0?Dd.VERTICAL:Sn,Vi=t.blur,Ba=Vi===void 0?[1,1,1]:Vi,ho=t.arrow,Ao=ho===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:ho;O.length===2&&O.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Wo=0,Ju=[0,0,0,0],up=[0,0,0,0];if(c&&p&&(Ju=h(c),up=h(p),Wo=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var lp=this.layer.getEncodedData(),cp=this.calDataFrame(this.cellLength,lp,this.cellProperties),Wd=cp.data,Pv=cp.width,Xd=cp.height;this.rowCount=Xd,this.dataTexture=this.cellLength>0&&Wd.length>0?this.createTexture2D({flipY:!0,data:Wd,format:H.LUMINANCE,type:H.FLOAT,width:Pv,height:Xd}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Er.isNumber)(u)?u:1,u_textureBlend:b===gm.NORMAL?0:1,u_line_type:E5[A],u_dash_array:O,u_blur:Ba,u_texture:this.texture,u_line_texture:N?1:0,u_icon_step:ae,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:Ke,u_borderColor:h(lt),u_linearDir:Un===Dd.VERTICAL?1:0,u_linearColor:Wo,u_sourceColor:Ju,u_targetColor:up,u_heightfixed:Number(Tr),u_vertexScale:Te,u_raisingHeight:Number(or),u_arrow:Number(Ao.enable),u_arrowHeight:Ao.arrowHeight||3,u_arrowWidth:Ao.arrowWidth||2,u_tailWidth:Ao.tailWidth===void 0?1:Ao.tailWidth}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p,b=o.depth,C=b===void 0?!1:b,A=o.workerEnabled,P=A===void 0?!1:A,O=o.enablePicking,D=this.getShaders(),N=D.frag,j=D.vert,ae=D.type;this.layer.triangulation=mp,this.layer.buildLayerModel({moduleName:"line"+ae,vertexShader:j,fragmentShader:N,triangulation:mp,depth:{enable:C},blend:this.getBlend(),stencil:X(c,m),workerEnabled:P,workerOptions:{modelType:"line"+ae,enablePicking:O,iconMap:this.iconService.getIconMap()}}).then(function(re){t([re])}).catch(function(re){console.warn(re),t([])})}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,c=t.lineType;return c==="dash"?{frag:y5,vert:_5,type:"Dash"}:o&&u?{frag:b5,vert:E1,type:"Linear"}:{frag:x5,vert:E1,type:""}}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:gn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u,c,p,m,b,C){return C===void 0?[p[3],10]:[p[3],C]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u,c,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var c=u.size,p=c===void 0?1:c;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(u,c,p,m,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u,c,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var c=t.iconService.getIconMap(),p=u.texture,m=c[p]||{x:0,y:0},b=m.x,C=m.y;return[b,C]}}})}}]),r}(ya);function S5(e){var i=C5();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function C5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w5=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  gl_FragColor = texture2D(u_texture, vec2(linearRadio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,A5=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,T5=function(e){(0,hr.Z)(r,e);var i=S5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var p=n.layer.getLayerConfig(),m=p.rampColors,b=M(m);n.colorTexture=c({data:new Uint8Array(b.data),width:b.width,height:b.height,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE,min:H.NEAREST,mag:H.NEAREST,flipY:!1})}),n}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.vertexHeightScale,p=c===void 0?20:c,m=t.raisingHeight,b=m===void 0?0:m,C=t.heightfixed,A=C===void 0?!1:C,P=t.linearDir,O=P===void 0?Dd.VERTICAL:P;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var D=this.layer.getEncodedData(),N=this.calDataFrame(this.cellLength,D,this.cellProperties),j=N.data,ae=N.width,re=N.height;this.rowCount=re,this.dataTexture=this.cellLength>0&&j.length>0?this.createTexture2D({flipY:!0,data:j,format:H.LUMINANCE,type:H.FLOAT,width:ae,height:re}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_linearDir:O===Dd.VERTICAL?1:0,u_opacity:(0,Er.isNumber)(u)?u:1,u_texture:this.colorTexture,u_heightfixed:Number(A),u_vertexScale:p,u_raisingHeight:Number(b)}}},{key:"initModels",value:function(t){this.updateTexture(),this.buildModels(t)}},{key:"clearModels",value:function(){var t,o;(t=this.colorTexture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p,b=o.depth,C=b===void 0?!1:b;this.layer.triangulation=Qp,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:A5,fragmentShader:w5,triangulation:Qp,depth:{enable:C},blend:this.getBlend(),stencil:X(c,m)}).then(function(A){t([A])}).catch(function(A){console.warn(A),t([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:gn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,c,p,m,b){return b===void 0?[c[3],10]:[c[3],b]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o,u,c){return[c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o){var u=o.size,c=u===void 0?1:u;return Array.isArray(c)?[c[0],c[1]]:[c,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o,u,c,p,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o,u,c){return[c[4]]}}})}}]),r}(ya);function M5(e){var i=I5();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function I5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var k5=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,P5=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];

  // styleMappingMat[3][0] \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = mix(u_sourceColor, u_targetColor, styleMappingMat[3][0]);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,C1=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  v_color = a_Color; 
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,L5=function(e){(0,hr.Z)(r,e);var i=M5(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.sourceColor,p=t.targetColor,m=t.vertexHeightScale,b=m===void 0?20:m,C=0,A=[0,0,0,0],P=[0,0,0,0];if(c&&p&&(A=h(c),P=h(p),C=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var O=this.layer.getEncodedData(),D=this.calDataFrame(this.cellLength,O,this.cellProperties),N=D.data,j=D.width,ae=D.height;this.rowCount=ae,this.dataTexture=this.cellLength>0&&N.length>0?this.createTexture2D({flipY:!0,data:N,format:H.LUMINANCE,type:H.FLOAT,width:j,height:ae}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Er.isNumber)(u)?u:1,u_linearColor:C,u_sourceColor:A,u_targetColor:P,u_vertexScale:b}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:P5,vert:C1,type:"lineSimpleLinear"}:{frag:k5,vert:C1,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p,b=this.getShaders(),C=b.frag,A=b.vert,P=b.type;this.layer.buildLayerModel({moduleName:P,vertexShader:A,fragmentShader:C,triangulation:rw,primitive:H.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:X(c,m),pick:!1}).then(function(O){t([O])}).catch(function(O){console.warn(O),t([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:gn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o,u,c){return[c[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o,u,c){return[c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o){var u=o.size,c=u===void 0?1:u;return Array.isArray(c)?[c[0],c[1]]:[c,0]}}})}}]),r}(ya);function R5(e){var i=O5();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function O5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D5=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,F5=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,B5=function(e){(0,hr.Z)(r,e);var i=R5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=c({data:n.iconService.getCanvas(),mag:H.NEAREST,min:H.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.sourceColor,p=t.targetColor,m=t.textureBlend,b=m===void 0?"normal":m,C=t.heightfixed,A=C===void 0?!1:C,P=t.lineTexture,O=P===void 0?!1:P,D=t.iconStep,N=D===void 0?100:D,j=t.iconStepCount,ae=j===void 0?1:j;this.rendererService.getDirty()&&this.texture.bind();var re=0,Te=[0,0,0,0],Re=[0,0,0,0];return c&&p&&(Te=h(c),Re=h(p),re=1),{u_heightfixed:Number(A),u_opacity:(0,Er.isNumber)(u)?u:1,u_textureBlend:b==="normal"?0:1,u_texture:this.texture,u_line_texture:O?1:0,u_iconStepCount:ae,u_icon_step:N,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:re,u_sourceColor:Te,u_targetColor:Re}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(t){this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:F5,fragmentShader:D5,triangulation:Qp,depth:{enable:!1},blend:this.getBlend()}).then(function(o){t([o])}).catch(function(o){console.warn(o),t([])})}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:gn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u,c,p){return[p[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u,c,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var c=u.size,p=c===void 0?1:c;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(u,c,p,m,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u,c,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var c=t.iconService.getIconMap(),p=u.texture,m=c[p]||{x:0,y:0},b=m.x,C=m.y;return[b,C]}}})}}]),r}(ya),N5={arc:VM,arc3d:qM,greatcircle:c5,wall:B5,line:S1,halfLine:v5,simple:L5,linearline:T5,vectorline:dv,tileLine:vm,earthArc3d:i5},z5=N5;function U5(e){var i=Z5();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function Z5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V5=function(e){(0,hr.Z)(r,e);var i=U5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"type","LineLayer"),(0,T.Z)((0,$e.Z)(n),"arrowInsertCount",0),(0,T.Z)((0,$e.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,yt.Z)(r,[{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new z5[o](this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},vectorline:{},tileLine:{},halfLine:{},earthArc3d:{}};return o[t]}},{key:"getModelType",value:function(){var t;if(this.layerType)return this.layerType;var o=this.layerSource.getParserType();if(v0(o))return"vectorline";var u=this.styleAttributeService.getLayerStyleAttribute("shape"),c=u==null||(t=u.scale)===null||t===void 0?void 0:t.field;return c||"line"}}]),r}(Uf);function j5(e){var i=G5();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function G5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H5=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,W5=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,X5=function(e){(0,hr.Z)(r,e);var i=j5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"raiseCount",0),(0,T.Z)((0,$e.Z)(n),"raiseRepeat",0),n}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,c=t.opacity,p=c===void 0?1:c,m=t.sourceColor,b=t.targetColor,C=t.pickLight,A=C===void 0?!1:C,P=t.heightfixed,O=P===void 0?!1:P,D=t.opacityLinear,N=D===void 0?{enable:!1,dir:"up"}:D,j=t.lightEnable,ae=j===void 0?!0:j;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var re=this.layer.getEncodedData(),Te=this.calDataFrame(this.cellLength,re,this.cellProperties),Re=Te.data,Ke=Te.width,gt=Te.height;this.rowCount=gt,this.dataTexture=this.cellLength>0&&Re.length>0?this.createTexture2D({flipY:!0,data:Re,format:H.LUMINANCE,type:H.FLOAT,width:Ke,height:gt}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}var lt=0,Ut=[0,0,0,0],or=[0,0,0,0];if(m&&b&&(Ut=h(m),or=h(b),lt=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var cr=u.speed,Tr=cr===void 0?.01:cr;this.raiseCount+=Tr,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(A),u_heightfixed:Number(O),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Er.isNumber)(p)?p:1,u_linearColor:lt,u_sourceColor:Ut,u_targetColor:or,u_opacitylinear:Number(N.enable),u_opacitylinear_dir:N.dir==="up"?1:0,u_lightEnable:Number(ae)}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.animateOption.repeat,c=u===void 0?1:u;this.raiseRepeat=c,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:W5,fragmentShader:H5,triangulation:hm,depth:{enable:!0},cull:{enable:!0,face:Ec(this.mapService.version)},blend:this.getBlend()}).then(function(p){t([p])}).catch(function(p){console.warn(p),t([])})}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o){var u=o.size;if(u){var c=[];return Array.isArray(u)&&(c=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(c=[u,u,u]),c}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o,u,c,p,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:gn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o){var u=go(o.coordinates);return w_([u[0],u[1]])}}})}}]),r}(ya);function Y5(e){var i=$5();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function $5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q5=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,K5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);

  setPickingColor(a_PickingColor);
}
`,Q5=function(e){(0,hr.Z)(r,e);var i=Y5(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.strokeOpacity,p=c===void 0?1:c,m=t.strokeWidth,b=m===void 0?0:m,C=t.stroke,A=C===void 0?"rgba(0,0,0,0)":C,P=t.offsets,O=P===void 0?[0,0]:P,D=t.blend,N=t.blur,j=N===void 0?0:N;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:p,strokeWidth:b,stroke:A,offsets:O})){this.judgeStyleAttributes({opacity:u,strokeOpacity:p,strokeWidth:b,stroke:A,offsets:O});var ae=this.layer.getEncodedData(),re=this.calDataFrame(this.cellLength,ae,this.cellProperties),Te=re.data,Re=re.width,Ke=re.height;this.rowCount=Ke,this.dataTexture=this.cellLength>0&&Te.length>0?this.createTexture2D({flipY:!0,data:Te,format:H.LUMINANCE,type:H.FLOAT,width:Re,height:Ke}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_blur:j,u_additive:D==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Er.isNumber)(u)?u:1,u_stroke_opacity:(0,Er.isNumber)(p)?p:1,u_stroke_width:(0,Er.isNumber)(b)?b:1,u_stroke_color:this.getStrokeColor(A),u_offsets:this.isOffsetStatic(O)?O:[0,0]}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){this.layer.triangulation=L_,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:K5,fragmentShader:q5,triangulation:L_,depth:{enable:!0},blend:this.getBlend()}).then(function(o){t([o])}).catch(function(o){console.warn(o),t([])})}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(u,c,p,m){var b=(0,ce.Z)(p,3),C=b[0],A=b[1],P=b[2],O=_a.fromValues(0,0,1),D=_a.fromValues(C,0,P),N=C>=0?_a.angle(O,D):Math.PI*2-_a.angle(O,D),j=Math.PI*2-Math.asin(A/100),ae=Ho();Yh(ae,ae,N),dh(ae,ae,j);var re=_a.fromValues(1,1,0);_a.transformMat4(re,re,ae),_a.normalize(re,re);var Te=_a.fromValues(-1,1,0);_a.transformMat4(Te,Te,ae),_a.normalize(Te,Te);var Re=_a.fromValues(-1,-1,0);_a.transformMat4(Re,Re,ae),_a.normalize(Re,Re);var Ke=_a.fromValues(1,-1,0);_a.transformMat4(Ke,Ke,ae),_a.normalize(Ke,Ke);var gt=[].concat((0,ee.Z)(re),(0,ee.Z)(Te),(0,ee.Z)(Re),(0,ee.Z)(Ke)),lt=m%4*3;return[gt[lt],gt[lt+1],gt[lt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?5:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:gn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var c=u.shape,p=c===void 0?2:c,m=t.layer.getLayerConfig().shape2d,b=m.indexOf(p);return[b]}}})}}]),r}(ya);function J5(e){var i=eI();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function eI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tI=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,rI=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }

  setPickingColor(a_PickingColor);
}
`,w1=function(e){(0,hr.Z)(r,e);var i=J5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"raiseCount",0),(0,T.Z)((0,$e.Z)(n),"raiseRepeat",0),n}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,c=t.opacity,p=c===void 0?1:c,m=t.sourceColor,b=t.targetColor,C=t.pickLight,A=C===void 0?!1:C,P=t.heightfixed,O=P===void 0?!1:P,D=t.opacityLinear,N=D===void 0?{enable:!1,dir:"up"}:D,j=t.lightEnable,ae=j===void 0?!0:j;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var re=this.layer.getEncodedData(),Te=this.calDataFrame(this.cellLength,re,this.cellProperties),Re=Te.data,Ke=Te.width,gt=Te.height;this.rowCount=gt,this.dataTexture=this.cellLength>0&&Re.length>0?this.createTexture2D({flipY:!0,data:Re,format:H.LUMINANCE,type:H.FLOAT,width:Ke,height:gt}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}var lt=0,Ut=[0,0,0,0],or=[0,0,0,0];if(m&&b&&(Ut=h(m),or=h(b),lt=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var cr=u.speed,Tr=cr===void 0?.01:cr;this.raiseCount+=Tr,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(A),u_heightfixed:Number(O),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Er.isNumber)(p)?p:1,u_linearColor:lt,u_sourceColor:Ut,u_targetColor:or,u_opacitylinear:Number(N.enable),u_opacitylinear_dir:N.dir==="up"?1:0,u_lightEnable:Number(ae)}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(){var n=(0,ue.Z)(te().mark(function o(u){var c,p,m,b,C;return te().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:c=this.layer.getLayerConfig(),p=c.depth,m=p===void 0?!0:p,b=c.animateOption.repeat,C=b===void 0?1:b,this.raiseRepeat=C,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:rI,fragmentShader:tI,triangulation:hm,blend:this.getBlend(),cull:{enable:!0,face:Ec(this.mapService.version)},depth:{enable:m}}).then(function(O){u([O])}).catch(function(O){console.warn(O),u([])});case 3:case"end":return P.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o){var u=o.size;if(u){var c=[];return Array.isArray(u)&&(c=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(c=[u,u,u]),c}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o,u,c,p,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:gn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o){var u=go(o.coordinates);return[u[0],u[1],0]}}})}}]),r}(ya);function nI(e){var i=iI();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function iI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A1=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,aI=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,ym=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_meter2coord;
uniform float u_meteryScale;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size) * u_meter2coord;
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    if(newSize * pow(2.0, u_Zoom) < 48.0) {
      antialiasblur = max(antialiasblur, -0.05);
    } else if(newSize * pow(2.0, u_Zoom) < 128.0) {
      antialiasblur = max(antialiasblur, -0.6/pow(u_Zoom, 2.0));
    } else {
      antialiasblur = max(antialiasblur, -0.8/pow(u_Zoom, 2.0));
    }
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.x += offset.x / u_meteryScale;
      aPosition.y += offset.y;
      offset = vec2(0.0);
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_raisingHeight;

  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }
 

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,T1=function(e){(0,hr.Z)(r,e);var i=nI(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"meter2coord",1),(0,T.Z)((0,$e.Z)(n),"meterYScale",1),(0,T.Z)((0,$e.Z)(n),"isMeter",!1),(0,T.Z)((0,$e.Z)(n),"unit","l7size"),n}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.strokeOpacity,p=c===void 0?1:c,m=t.strokeWidth,b=m===void 0?0:m,C=t.stroke,A=C===void 0?"rgba(0,0,0,0)":C,P=t.offsets,O=P===void 0?[0,0]:P,D=t.blend,N=t.blur,j=N===void 0?0:N,ae=t.raisingHeight,re=ae===void 0?0:ae,Te=t.heightfixed,Re=Te===void 0?!1:Te,Ke=t.unit,gt=Ke===void 0?"l7size":Ke;if(this.updateUnit(gt),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:p,strokeWidth:b,stroke:A,offsets:O})){this.judgeStyleAttributes({opacity:u,strokeOpacity:p,strokeWidth:b,stroke:A,offsets:O});var lt=this.layer.getEncodedData(),Ut=this.calDataFrame(this.cellLength,lt,this.cellProperties),or=Ut.data,cr=Ut.width,Tr=Ut.height;this.rowCount=Tr,this.dataTexture=this.cellLength>0&&or.length>0?this.createTexture2D({flipY:!0,data:or,format:H.LUMINANCE,type:H.FLOAT,width:cr,height:Tr}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(re),u_heightfixed:Number(Re),u_meter2coord:this.meter2coord,u_meteryScale:this.meterYScale,u_isMeter:Number(this.isMeter),u_blur:j,u_additive:D==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Er.isNumber)(u)?u:1,u_stroke_opacity:(0,Er.isNumber)(p)?p:1,u_stroke_width:(0,Er.isNumber)(b)?b:1,u_stroke_color:this.getStrokeColor(A),u_offsets:this.isOffsetStatic(O)?O:[0,0]}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Mh)}},{key:"initModels",value:function(t){this.updateUnit("l7size"),this.buildModels(t)}},{key:"calMeter2Coord",value:function(){var t=(0,ce.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],c=t[2],p=t[3],m=[(o+c)/2,(u+p)/2],b=this.mapService.version,C=ha==null?void 0:ha.mapboxgl;if(b===ts.MAPBOX&&C!==null&&C!==void 0&&C.MercatorCoordinate){var A=C.MercatorCoordinate.fromLngLat({lng:m[0],lat:m[1]},0),P=A.meterInMercatorCoordinateUnits(),O=new C.MercatorCoordinate(A.x-P,A.y,A.z),D=O.toLngLat(),N=new C.MercatorCoordinate(A.x,A.y-P,A.z),j=N.toLngLat();this.meter2coord=m[0]-D.lng,this.meterYScale=(j.lat-m[1])/this.meter2coord;return}var ae=this.mapService.meterToCoord(m,[o,u]),re=this.mapService.meterToCoord(m,[c===o?c+.1:c,p===u?u+.1:p]);this.meter2coord=(ae+re)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var n=(0,ue.Z)(te().mark(function o(u){var c,p,m,b,C,A,P,O,D,N,j,ae,re,Te,Re;return te().wrap(function(gt){for(;;)switch(gt.prev=gt.next){case 0:c=this.layer.getLayerConfig(),p=c.mask,m=p===void 0?!1:p,b=c.maskInside,C=b===void 0?!0:b,A=c.animateOption,P=A===void 0?{enable:!1}:A,O=c.workerEnabled,D=O===void 0?!1:O,N=c.enablePicking,j=c.shape2d,ae=this.getShaders(P),re=ae.frag,Te=ae.vert,Re=ae.type,this.layer.triangulation=Mh,this.layer.buildLayerModel({moduleName:Re,vertexShader:Te,fragmentShader:re,triangulation:Mh,depth:{enable:!1},blend:this.getBlend(),stencil:X(m,C),workerEnabled:D,workerOptions:{modelType:Re,enablePicking:N,shape2d:j}}).then(function(lt){u([lt])}).catch(function(lt){console.warn(lt),u([])});case 4:case"end":return gt.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(t){if(t.enable)switch(t.type){case"wave":return{frag:A1,vert:ym,type:"pointWave"};default:return{frag:A1,vert:ym,type:"pointWave"}}else return{frag:aI,vert:ym,type:"pointFill"}}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(u,c,p,m){var b=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],C=m%4*3;return[b[C],b[C+1],b[C+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?5:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:gn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var c=u.shape,p=c===void 0?2:c,m=t.indexOf(p);return[m]}}})}},{key:"updateUnit",value:function(t){var o=this.mapService.version;this.unit!==t&&(this.unit!=="meter"&&t==="meter"&&o!==ts.L7MAP&&o!==ts.GLOBEL?(this.isMeter=!0,this.calMeter2Coord()):this.unit==="meter"&&t!=="meter"&&(this.isMeter=!1,this.meter2coord=1),this.unit=t)}}]),r}(ya);function oI(e){var i=sI();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function sI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uI=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,lI=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,cI=function(e){(0,hr.Z)(r,e);var i=oI(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"meter2coord",1),(0,T.Z)((0,$e.Z)(n),"isMeter",!1),(0,T.Z)((0,$e.Z)(n),"radian",0),(0,T.Z)((0,$e.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=c({data:n.iconService.getCanvas(),mag:H.LINEAR,min:H.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.offsets,p=c===void 0?[0,0]:c,m=t.rotation,b=t.raisingHeight,C=b===void 0?0:b,A=t.heightfixed,P=A===void 0?!1:A;this.rendererService.getDirty()&&this.texture.bind();var O=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(O=-1),this.radian=m!==void 0?O*Math.PI*m/180:O*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var D=this.layer.getEncodedData(),N=this.calDataFrame(this.cellLength,D,this.cellProperties),j=N.data,ae=N.width,re=N.height;this.rowCount=re,this.dataTexture=this.cellLength>0&&j.length>0?this.createTexture2D({flipY:!0,data:j,format:H.LUMINANCE,type:H.FLOAT,width:ae,height:re}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(C),u_heightfixed:Number(P),u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,Er.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Kp)}},{key:"initModels",value:function(t){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var o=this.layer.getLayerConfig(),u=o.unit,c=u===void 0?"l7size":u,p=this.mapService.version;c==="meter"&&p!==ts.L7MAP&&p!==ts.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(t)}},{key:"calMeter2Coord",value:function(){var t=(0,ce.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],c=t[2],p=t[3],m=[(o+c)/2,(u+p)/2],b=this.mapService.version;if(b===ts.MAPBOX&&window.mapboxgl.MercatorCoordinate){var C=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:m[0],lat:m[1]},0),A=1,P=A*C.meterInMercatorCoordinateUnits(),O=new window.mapboxgl.MercatorCoordinate(C.x-P,C.y,C.z),D=O.toLngLat();this.meter2coord=m[0]-D.lng;return}var N=this.mapService.meterToCoord(m,[o,u]),j=this.mapService.meterToCoord(m,[c===o?c+.1:c,p===u?u+.1:p]);this.meter2coord=(N+j)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:lI,fragmentShader:uI,triangulation:Kp,depth:{enable:!1},blend:this.getBlend(),stencil:X(c,m),cull:{enable:!0,face:Ec(this.mapService.version)}}).then(function(b){t([b])}).catch(function(b){console.warn(b),t([])})}},{key:"clearModels",value:function(){var t,o;this.iconService.off("imageUpdate",this.updateTexture),(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:gn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var c=u.rotate,p=c===void 0?0:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var c=t.iconService.getIconMap(),p=u.shape,m=c[p]||{x:0,y:0},b=m.x,C=m.y;return[b,C]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(u,c,p,m){var b=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],C=m%4*3;return[b[C],b[C+1],b[C+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?5:c;return Array.isArray(p)?[p[0]*t.meter2coord]:[p*t.meter2coord]}}})}}]),r}(ya);function fI(e){var i=hI();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function hI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pI=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,dI=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(textrueOffsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,M1=function(e){(0,hr.Z)(r,e);var i=fI(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"updateTexture",function(){var c=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=c({data:n.iconService.getCanvas(),mag:H.LINEAR,min:H.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.offsets,p=c===void 0?[0,0]:c,m=t.raisingHeight,b=m===void 0?0:m,C=t.heightfixed,A=C===void 0?!1:C;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var P=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,P,this.cellProperties),D=O.data,N=O.width,j=O.height;this.rowCount=j,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:H.LUMINANCE,type:H.FLOAT,width:N,height:j}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(b),u_heightfixed:Number(A),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,Er.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0]}}},{key:"initModels",value:function(t){this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(t)}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:dI,fragmentShader:pI,triangulation:tw,depth:{enable:!1},primitive:H.POINTS,blend:this.getBlend(),stencil:X(c,m)}).then(function(b){t([b])}).catch(function(b){console.warn(b),t([])})}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?5:c;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var c=t.iconService.getIconMap(),p=u.shape,m=c[p]||{x:0,y:0},b=m.x,C=m.y;return[b,C]}}})}}]),r}(ya);function vI(e){var i=mI();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function mI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gI=`uniform float u_opacity : 1;
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
}
`,yI=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;

varying vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
}
`;function I1(e){var i=e.coordinates;return{vertices:(0,ee.Z)(i),indices:[0],size:i.length}}var k1=function(e){(0,hr.Z)(r,e);var i=vI(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o;return{u_opacity:(0,Er.isNumber)(u)?u:1}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p;this.layer.triangulation=I1,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:yI,fragmentShader:gI,triangulation:I1,depth:{enable:!1},primitive:H.POINTS,blend:this.getBlend(),stencil:X(c,m),pick:!1}).then(function(b){t([b])}).catch(function(b){console.warn(b),t([])})}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o){var u=o.size,c=u===void 0?1:u;return Array.isArray(c)?[c[0]]:[c]}}})}}]),r}(ya);function _I(e){var i=xI();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function xI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bI=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,EI=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,SI=function(e){(0,hr.Z)(r,e);var i=_I(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"meter2coord",1),(0,T.Z)((0,$e.Z)(n),"isMeter",!1),n}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.blend,p=t.speed,m=p===void 0?1:p;return{u_isMeter:Number(this.isMeter),u_speed:m,u_additive:c==="additive"?1:0,u_opacity:(0,Er.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Kp)}},{key:"initModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.unit,c=u===void 0?"l7size":u,p=this.mapService.version;c==="meter"&&p!==ts.L7MAP&&p!==ts.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(t)}},{key:"calMeter2Coord",value:function(){var t=(0,ce.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],c=t[2],p=t[3],m=[(o+c)/2,(u+p)/2],b=this.mapService.version;if(b===ts.MAPBOX&&window.mapboxgl.MercatorCoordinate){var C=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:m[0],lat:m[1]},0),A=1,P=A*C.meterInMercatorCoordinateUnits(),O=new window.mapboxgl.MercatorCoordinate(C.x-P,C.y,C.z),D=O.toLngLat();this.meter2coord=m[0]-D.lng;return}var N=this.mapService.meterToCoord(m,[o,u]),j=this.mapService.meterToCoord(m,[c===o?c+.1:c,p===u?u+.1:p]);this.meter2coord=(N+j)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:EI,fragmentShader:bI,triangulation:Kp,depth:{enable:!1},blend:this.getBlend(),stencil:X(c,m)}).then(function(b){t([b])}).catch(function(b){console.warn(b),t([])})}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(u,c,p,m){var b=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],C=m%4*3;return[b[C],b[C+1],b[C+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var c=u.size,p=c===void 0?5:c;return Array.isArray(p)?[p[0]*t.meter2coord]:[p*t.meter2coord]}}})}}]),r}(ya);function CI(e){var i=wI();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function wI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AI=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,TI=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function P1(e){var i=e.coordinates;return{vertices:(0,ee.Z)(i),indices:[0],size:i.length}}var MI=function(e){(0,hr.Z)(r,e);var i=CI(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.offsets,p=c===void 0?[0,0]:c,m=t.blend,b=t.strokeOpacity,C=b===void 0?1:b,A=t.strokeWidth,P=A===void 0?0:A,O=t.stroke,D=O===void 0?"#fff":O;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var N=this.layer.getEncodedData(),j=this.calDataFrame(this.cellLength,N,this.cellProperties),ae=j.data,re=j.width,Te=j.height;this.rowCount=Te,this.dataTexture=this.cellLength>0&&ae.length>0?this.createTexture2D({flipY:!0,data:ae,format:H.LUMINANCE,type:H.FLOAT,width:re,height:Te}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_additive:m==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Er.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0],u_stroke_opacity:(0,Er.isNumber)(C)?C:1,u_stroke_width:(0,Er.isNumber)(P)?P:1,u_stroke_color:this.getStrokeColor(D)}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p;this.layer.triangulation=P1,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:TI,fragmentShader:AI,triangulation:P1,depth:{enable:!1},primitive:H.POINTS,blend:this.getBlend(),stencil:X(c,m)}).then(function(b){t([b])}).catch(function(b){console.warn(b),t([])})}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o){var u=o.size,c=u===void 0?1:u;return Array.isArray(c)?[c[0]]:[c]}}})}}]),r}(ya);function II(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=kI(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var m=r.next();return o=m.done,m},e:function(m){u=!0,c=m},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function kI(e,i){if(!!e){if(typeof e=="string")return L1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return L1(e,i)}}function L1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function PI(e){var i=LI();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function LI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var R1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,O1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function D1(e){var i=this,r=e.id,n=[],t=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var o=i.glyphInfoMap[r].centroid,u=o.length===2?[o[0],o[1],0]:o;return i.glyphInfoMap[r].glyphQuads.forEach(function(c,p){n.push.apply(n,(0,ee.Z)(u).concat([c.tex.x,c.tex.y+c.tex.height,c.tl.x,c.tl.y],(0,ee.Z)(u),[c.tex.x+c.tex.width,c.tex.y+c.tex.height,c.tr.x,c.tr.y],(0,ee.Z)(u),[c.tex.x+c.tex.width,c.tex.y,c.br.x,c.br.y],(0,ee.Z)(u),[c.tex.x,c.tex.y,c.bl.x,c.bl.y])),t.push(0+p*4,1+p*4,2+p*4,2+p*4,3+p*4,0+p*4)}),{vertices:n,indices:t,size:7}}var F1=function(e){(0,hr.Z)(r,e);var i=PI(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"glyphInfoMap",{}),(0,T.Z)((0,$e.Z)(n),"currentZoom",-1),(0,T.Z)((0,$e.Z)(n),"textureHeight",0),(0,T.Z)((0,$e.Z)(n),"textCount",0),(0,T.Z)((0,$e.Z)(n),"preTextStyle",{}),(0,T.Z)((0,$e.Z)(n),"buildModels",function(){var c=(0,ue.Z)(te().mark(function p(m){var b,C,A,P,O;return te().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:b=n.layer.getLayerConfig(),C=b.mask,A=C===void 0?!1:C,P=b.maskInside,O=P===void 0?!0:P,n.mapping(),n.layer.buildLayerModel({moduleName:"pointText",vertexShader:O1,fragmentShader:R1,triangulation:D1.bind((0,$e.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:X(A,O)}).then(function(j){m([j])}).catch(function(j){console.warn(j),m([])});case 3:case"end":return N.stop()}},p)}));return function(p){return c.apply(this,arguments)}}()),(0,T.Z)((0,$e.Z)(n),"mapping",function(){n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel()}),n}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.stroke,p=c===void 0?"#fff":c,m=t.strokeWidth,b=m===void 0?0:m,C=t.textAnchor,A=C===void 0?"center":C,P=t.textAllowOverlap,O=P===void 0?!1:P,D=t.halo,N=D===void 0?.5:D,j=t.gamma,ae=j===void 0?2:j,re=t.raisingHeight,Te=re===void 0?0:re,Re=this.fontService,Ke=Re.canvas,gt=Re.mapping;if(Object.keys(gt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(gt).length),this.preTextStyle={textAnchor:A,textAllowOverlap:O},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeWidth:b,stroke:p})){this.judgeStyleAttributes({opacity:u,strokeWidth:b,stroke:p});var lt=this.layer.getEncodedData(),Ut=this.calDataFrame(this.cellLength,lt,this.cellProperties),or=Ut.data,cr=Ut.width,Tr=Ut.height;this.rowCount=Tr,this.dataTexture=this.cellLength>0&&or.length>0?this.createTexture2D({flipY:!0,data:or,format:H.LUMINANCE,type:H.FLOAT,width:cr,height:Tr}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(Te),u_opacity:(0,Er.isNumber)(u)?u:1,u_stroke_width:(0,Er.isNumber)(b)?b:1,u_stroke_color:this.getStrokeColor(p),u_sdf_map:this.texture,u_halo_blur:N,u_gamma_scale:ae,u_sdf_map_size:[Ke.width,Ke.height]}}},{key:"initModels",value:function(t){this.layer.on("remapping",this.mapping),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,c=u===void 0?"center":u,p=o.textAllowOverlap,m=p===void 0?!0:p;this.preTextStyle={textAnchor:c,textAllowOverlap:m},this.buildModels(t)}},{key:"needUpdate",value:function(){var t=this.layer.getLayerConfig(),o=t.textAllowOverlap,u=o===void 0?!1:o,c=this.mapService.getZoom(),p=this.mapService.getBounds(),m=Al(this.extent,p);return!u&&(Math.abs(this.currentZoom-c)>1||!m)||u!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:gn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o){var u=o.rotate,c=u===void 0?0:u;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:gn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,c){return[c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o){var u=o.size,c=u===void 0?12:u;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:gn.Attribute,descriptor:{name:"a_tex",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}})}},{key:"textExtent",value:function(){var t=this.mapService.getBounds();return pu(t,.5)}},{key:"initTextFont",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,c=t.fontFamily,p=c===void 0?"sans-serif":c,m=this.layer.getEncodedData(),b=[];m.forEach(function(C){var A=C.shape,P=A===void 0?"":A;P=P.toString();var O=II(P),D;try{for(O.s();!(D=O.n()).done;){var N=D.value;b.indexOf(N)===-1&&b.push(N)}}catch(j){O.e(j)}finally{O.f()}}),this.fontService.setFontOptions({characterSet:b,fontWeight:u,fontFamily:p,iconfont:!1})}},{key:"initIconFontTex",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,c=t.fontFamily,p=c===void 0?"sans-serif":c,m=this.layer.getEncodedData(),b=[];m.forEach(function(C){var A=C.shape,P=A===void 0?"":A;P="".concat(P),b.indexOf(P)===-1&&b.push(P)}),this.fontService.setFontOptions({characterSet:b,fontWeight:u,fontFamily:p,iconfont:!0})}},{key:"generateGlyphLayout",value:function(t){var o=this,u=this.fontService.mapping,c=this.layer.getLayerConfig(),p=c.spacing,m=p===void 0?2:p,b=c.textAnchor,C=b===void 0?"center":b,A=this.layer.getEncodedData();this.glyphInfo=A.map(function(P){var O=P.shape,D=O===void 0?"":O,N=P.id,j=P.size,ae=j===void 0?1:j,re=P.textOffset,Te=re===void 0?[0,0]:re,Re=Q_(D.toString(),u,ae,C,"left",m,Te,t),Ke=J_(Re,Te,!1);return P.shaping=Re,P.glyphQuads=Ke,P.centroid=go(P.coordinates),P.originCentroid=P.version==="GAODE2.x"?go(P.originCoordinates):P.originCentroid=P.centroid,o.glyphInfoMap[N]={shaping:Re,glyphQuads:Ke,centroid:go(P.coordinates)},P})}},{key:"filterGlyphs",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.padding,c=u===void 0?[4,4]:u,p=o.textAllowOverlap,m=p===void 0?!1:p;if(!m){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var b=this.rendererService.getViewportSize(),C=b.width,A=b.height,P=new W_(C,A),O=this.glyphInfo.filter(function(D){var N=D.shaping,j=D.id,ae=j===void 0?0:j,re=D.version==="GAODE2.x"?D.originCentroid:D.centroid,Te=D.size,Re=Te/24,Ke=t.mapService.lngLatToContainer(re),gt=P.placeCollisionBox({x1:N.left*Re-c[0],x2:N.right*Re+c[0],y1:N.top*Re-c[1],y2:N.bottom*Re+c[1],anchorPointX:Ke.x,anchorPointY:Ke.y}),lt=gt.box;return lt&&lt.length?(P.insertCollisionBox(lt,ae),!0):!1});O.forEach(function(D){t.glyphInfoMap[D.id]=D})}}},{key:"initGlyph",value:function(){var t=this.layer.getLayerConfig(),o=t.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=t({data:o,mag:H.LINEAR,min:H.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointText",vertexShader:O1,fragmentShader:R1,triangulation:D1.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:X(c,m)}).then(function(b){t.layer.models=[b],t.layerService.throttleRenderLayers()}).catch(function(b){console.warn(b),t.layer.models=[]})}}]),r}(ya),RI={fillImage:cI,fill:T1,radar:SI,image:M1,normal:k1,simplePoint:MI,extrude:w1,text:F1,vectorPoint:dv,tile:m0,tileText:o1,earthFill:Q5,earthExtrude:X5},OI=RI;function DI(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=FI(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var m=r.next();return o=m.done,m},e:function(m){u=!0,c=m},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function FI(e,i){if(!!e){if(typeof e=="string")return B1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return B1(e,i)}}function B1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function BI(e){var i=NI();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function NI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zI=function(e){(0,hr.Z)(r,e);var i=BI(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"type","PointLayer"),(0,T.Z)((0,$e.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,yt.Z)(r,[{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new OI[o](this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var t=this.shapeOption,o=t.field,u=t.values,c=this.getLayerConfig(),p=c.shape2d,m=this.iconService.getIconMap();if(o&&(p==null?void 0:p.indexOf(o))!==-1)return"fill";if(u&&u instanceof Array){var b=DI(u),C;try{for(b.s();!(C=b.n()).done;){var A=C.value;if(typeof A=="string"&&m.hasOwnProperty(A))return"image"}}catch(P){b.e(P)}finally{b.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},vectorPoint:{},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return o[t]}},{key:"getModelType",value:function(){var t=this.layerSource.getParserType();if(v0(t))return"vectorPoint";var o=this.getEncodedData(),u=this.getLayerConfig(),c=u.shape2d,p=u.shape3d,m=this.iconService.getIconMap(),b=o.find(function(A){return A.hasOwnProperty("shape")});if(b){var C=b.shape;return C==="dot"?"normal":C==="simple"?"simplePoint":C==="radar"?"radar":this.layerType==="fillImage"?"fillImage":(c==null?void 0:c.indexOf(C))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(p==null?void 0:p.indexOf(C))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":m.hasOwnProperty(C)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(Uf);function UI(e){var i=ZI();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function ZI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VI=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,jI=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,GI=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,HI=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,WI=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,XI=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,YI=function(e){(0,hr.Z)(r,e);var i=UI(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.heightfixed,p=c===void 0?!1:c,m=t.raisingHeight,b=m===void 0?0:m,C=t.topsurface,A=C===void 0?!0:C,P=t.sidesurface,O=P===void 0?!0:P,D=t.sourceColor,N=t.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var j=this.layer.getEncodedData(),ae=this.calDataFrame(this.cellLength,j,this.cellProperties),re=ae.data,Te=ae.width,Re=ae.height;this.rowCount=Re,this.dataTexture=this.cellLength>0&&re.length>0?this.createTexture2D({flipY:!0,data:re,format:H.LUMINANCE,type:H.FLOAT,width:Te,height:Re}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}var Ke=0,gt=[1,1,1,1],lt=[1,1,1,1];return D&&N&&(gt=h(D),lt=h(N),Ke=1),{u_topsurface:Number(A),u_sidesurface:Number(O),u_heightfixed:Number(p),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(b),u_opacity:(0,Er.isNumber)(u)?u:1,u_linearColor:Ke,u_sourceColor:gt,u_targetColor:lt,u_texture:this.texture}}},{key:"initModels",value:function(t){this.loadTexture(),this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p,b=this.getShaders(),C=b.frag,A=b.vert,P=b.type;this.layer.buildLayerModel({moduleName:P,vertexShader:A,fragmentShader:C,triangulation:O_,stencil:X(c,m)}).then(function(O){t([O])}).catch(function(O){console.warn(O),t([])})}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.pickLight,u=t.mapTexture;return u?{frag:GI,vert:HI,type:"polygonExtrudeTexture"}:o?{frag:WI,vert:XI,type:"polygonExtrudePickLight"}:{frag:VI,vert:jI,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var t,o;(t=this.dataTexture)===null||t===void 0||t.destroy(),(o=this.texture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,ce.Z)(t,4),u=o[0],c=o[1],p=o[2],m=o[3],b=p-u,C=m-c;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:gn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(P,O,D){var N=D[0],j=D[1];return[(N-u)/b,(j-c)/C,D[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(P,O,D,N,j){return j}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(P){var O=P.size,D=O===void 0?10:O;return Array.isArray(D)?[D[0]]:[D]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.mapTexture,c=this.rendererService.createTexture2D;if(this.texture=c({height:0,width:0}),u){var p=new Image;p.crossOrigin="",p.src=u,p.onload=function(){t.texture=c({data:p,width:p.width,height:p.height,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE,min:H.LINEAR,mag:H.LINEAR}),t.layerService.reRender()}}}}]),r}(ya);function $I(e){var i=qI();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function qI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KI=`uniform float u_opacity: 1.0;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,QI=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,JI=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,e3=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,t3=function(e){(0,hr.Z)(r,e);var i=$I(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.raisingHeight,u=o===void 0?0:o,c=t.opacity,p=c===void 0?1:c,m=t.opacityLinear,b=m===void 0?{enable:!1,dir:"in"}:m;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var C=this.layer.getEncodedData(),A=this.calDataFrame(this.cellLength,C,this.cellProperties),P=A.data,O=A.width,D=A.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&P.length>0?this.createTexture2D({flipY:!0,data:P,format:H.LUMINANCE,type:H.FLOAT,width:O,height:D}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(u),u_opacity:(0,Er.isNumber)(p)?p:1,u_opacitylinear:Number(b.enable),u_dir:b.dir==="in"?1:0}}},{key:"initModels",value:function(t){this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.getModelParams(),u=o.frag,c=o.vert,p=o.triangulation,m=o.type,b=this.layer.getLayerConfig(),C=b.mask,A=C===void 0?!1:C,P=b.maskInside,O=P===void 0?!0:P,D=b.workerEnabled,N=D===void 0?!1:D,j=b.enablePicking;this.layer.triangulation=p,this.layer.buildLayerModel({moduleName:m,vertexShader:c,fragmentShader:u,triangulation:p,primitive:H.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:X(A,O),workerEnabled:N,workerOptions:{modelType:m,enablePicking:j}}).then(function(ae){t([ae])}).catch(function(ae){console.warn(ae),t([])})}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig(),o=t.opacityLinear,u=o===void 0?{enable:!1,dir:"in"}:o;u.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:gn.Attribute,descriptor:{name:"a_linear",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(p,m,b){return[b[3],b[4],b[5]]}}})}},{key:"getModelParams",value:function(){var t=this.layer.getLayerConfig(),o=t.opacityLinear,u=o===void 0?{enable:!1}:o;return u.enable?{frag:QI,vert:JI,type:"polygonLinear",triangulation:ow}:{frag:KI,vert:e3,type:"polygonFill",triangulation:gp}}}]),r}(ya);function r3(e){var i=n3();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function n3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i3=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = u_opacity;
  gl_FragColor = vec4(col, opacity);  
}
`,a3=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,o3=function(e){(0,hr.Z)(r,e);var i=r3(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.watercolor,p=c===void 0?"#6D99A8":c,m=t.watercolor2,b=m===void 0?"#0F121C":m;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:h(p),u_watercolor2:h(b),u_opacity:(0,Er.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.loadTexture(),this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:a3,fragmentShader:i3,triangulation:pv,primitive:H.TRIANGLES,depth:{enable:!1},stencil:X(c,m)}).then(function(b){t([b])}).catch(function(b){console.warn(b),t([])})}},{key:"clearModels",value:function(){var t,o,u;(t=this.texture1)===null||t===void 0||t.destroy(),(o=this.texture2)===null||o===void 0||o.destroy(),(u=this.texture3)===null||u===void 0||u.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,ce.Z)(t,4),u=o[0],c=o[1],p=o[2],m=o[3],b=p-u,C=m-c;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:gn.Attribute,descriptor:{name:"a_uv",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(P,O,D,N){var j=P.version===ts["GAODE2.x"]?P.originCoordinates[0][N]:D,ae=(0,ce.Z)(j,2),re=ae[0],Te=ae[1];return[(re-u)/b,(Te-c)/C]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.rendererService.createTexture2D,u={height:0,width:0};this.texture1=o(u),this.texture2=o(u),this.texture3=o(u),c(function(m){t.texture1=p(m[0]),t.texture2=p(m[1]),t.texture3=p(m[2]),t.layerService.reRender()});function c(m){var b=0,C=[],A=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];A.map(function(P){var O=new Image;O.crossOrigin="",O.src=P,C.push(O),O.onload=function(){b++,b===3&&m(C)}})}function p(m){return o({data:m,width:m.width,height:m.height,wrapS:H.MIRRORED_REPEAT,wrapT:H.MIRRORED_REPEAT,min:H.LINEAR,mag:H.LINEAR})}}}]),r}(ya);function s3(e){var i=u3();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function u3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l3=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = u_opacity;
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,c3=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;


#pragma include "projection"

void main() {
  v_uv = a_uv;

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,f3=function(e){(0,hr.Z)(r,e);var i=s3(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.speed,p=c===void 0?.5:c;return{u_texture:this.texture,u_speed:p,u_opacity:(0,Er.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(t){this.loadTexture(),this.buildModels(t)}},{key:"buildModels",value:function(t){var o=this.layer.getLayerConfig(),u=o.mask,c=u===void 0?!1:u,p=o.maskInside,m=p===void 0?!0:p;this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:c3,fragmentShader:l3,triangulation:pv,primitive:H.TRIANGLES,depth:{enable:!1},stencil:X(c,m)}).then(function(b){t([b])}).catch(function(b){console.warn(b),t([])})}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,ce.Z)(t,4),u=o[0],c=o[1],p=o[2],m=o[3],b=p-u,C=m-c;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:gn.Attribute,descriptor:{name:"a_uv",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(P,O,D,N){var j=P.version===ts["GAODE2.x"]?P.originCoordinates[0][N]:D,ae=(0,ce.Z)(j,2),re=ae[0],Te=ae[1];return[(re-u)/b,(Te-c)/C]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.waterTexture,c=this.rendererService.createTexture2D;this.texture=c({height:0,width:0});var p=new Image;p.crossOrigin="",u?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),p.src=u):p.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",p.onload=function(){t.texture=c({data:p,width:p.width,height:p.height,wrapS:H.MIRRORED_REPEAT,wrapT:H.MIRRORED_REPEAT,min:H.LINEAR,mag:H.LINEAR}),t.layerService.reRender()}}}]),r}(ya),h3={fill:t3,line:S1,extrude:YI,text:F1,point_fill:T1,point_image:M1,point_normal:k1,point_extrude:w1,water:f3,ocean:o3,vectorpolygon:dv,tile:s1},p3=h3;function d3(e){var i=v3();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function v3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var N1=function(e){(0,hr.Z)(r,e);var i=d3(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"type","PolygonLayer"),n}return(0,yt.Z)(r,[{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new p3[o](this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"getModelType",value:function(){var t,o=this.layerSource.getParserType();if(v0(o))return"vectorpolygon";var u=this.styleAttributeService.getLayerStyleAttribute("shape"),c=u==null||(t=u.scale)===null||t===void 0?void 0:t.field;return c==="fill"?"fill":c==="extrude"?"extrude":c==="water"?"water":c==="ocean"?"ocean":c==="line"?"line":c==="tile"?"tile":this.getPointModelType()}},{key:"getPointModelType",value:function(){var t=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,c=o.shape3d,p=this.iconService.getIconMap(),m=t.find(function(C){return C.hasOwnProperty("shape")});if(m){var b=m.shape;return b==="dot"?"point_normal":(u==null?void 0:u.indexOf(b))!==-1?"point_fill":(c==null?void 0:c.indexOf(b))!==-1?"point_extrude":p.hasOwnProperty(b)?"point_image":"text"}else return"fill"}}]),r}(Uf);function m3(e){var i=g3();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function g3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y3=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;



// float getBlurIndusty() {
//   vec2 u_ViewportSize = vec2(1024);

//     float vW = 2.0/u_ViewportSize.x;
//     float vH = 2.0/u_ViewportSize.y;
//     vec2 vUv = v_texCoord;
//     float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
//     float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
//     float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

//     float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
//     float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
//     float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

//     float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
//     float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
//     float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

//     return(
//         i11 + 
//         i12 + 
//         i13 + 
//         i21 + 
//         i21 + 
//         i22 + 
//         i23 + 
//         i31 + 
//         i32 + 
//         i33
//         )/9.0;
// }

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;

  // float value = getBlurIndusty();


  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,_3=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,z1=function(e){(0,hr.Z)(r,e);var i=m3(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,c=t.clampLow,p=c===void 0?!0:c,m=t.clampHigh,b=m===void 0?!0:m,C=t.noDataValue,A=C===void 0?-9999999:C,P=t.domain,O=P===void 0?[0,1]:P,D=t.rampColors;return(0,Er.isEqual)(this.rampColors,D)||(this.updateColorTexture(),this.rampColors=D),{u_opacity:u||1,u_texture:this.texture,u_domain:O,u_clampLow:p,u_clampHigh:typeof b!="undefined"?b:p,u_noDataValue:A,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var n=(0,ue.Z)(te().mark(function o(u){var c,p,m,b;return te().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!Array.isArray(u.data)){A.next=4;break}return A.abrupt("return",{data:u.data,width:u.width,height:u.height});case 4:return A.next=6,u.data;case 6:return c=A.sent,p=c.rasterData,m=c.width,b=c.height,A.abrupt("return",{data:Array.from(p),width:m,height:b});case 11:case"end":return A.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var n=(0,ue.Z)(te().mark(function o(u){var c,p,m,b,C,A,P,O,D,N,j,ae,re,Te,Re;return te().wrap(function(gt){for(;;)switch(gt.prev=gt.next){case 0:return c=this.layer.getLayerConfig(),p=c.mask,m=p===void 0?!1:p,b=c.maskInside,C=b===void 0?!0:b,A=c.rampColorsData,P=c.rampColors,O=this.layer.getSource(),D=this.rendererService.createTexture2D,N=O.data.dataArray[0],gt.next=6,this.getRasterData(N);case 6:j=gt.sent,ae=j.data,re=j.width,Te=j.height,this.texture=D({data:ae,width:re,height:Te,format:H.LUMINANCE,type:H.FLOAT}),Re=A||M(P),this.colorTexture=D({data:Re.data,width:Re.width,height:Re.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:_3,fragmentShader:y3,triangulation:Rd,primitive:H.TRIANGLES,depth:{enable:!1},stencil:X(m,C)}).then(function(lt){u([lt])}).catch(function(lt){console.warn(lt),u([])});case 14:case"end":return gt.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(t){this.initModels(t)}},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,c){return[c[3],c[4]]}}})}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.rampColors,c=M(u);this.colorTexture=t({data:c.data,width:c.width,height:c.height,flipY:!1})}}]),r}(ya),x3={raster:z1,rasterRgb:m1,raster3d:z1,rasterTile:dv},b3=x3;function E3(e){var i=S3();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function S3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var C3=function(e){(0,hr.Z)(r,e);var i=E3(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"type","RasterLayer"),n}return(0,yt.Z)(r,[{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new b3[o](this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={raster:{},rasterRgb:{},raster3d:{},rasterTile:{}};return o[t]}},{key:"getModelType",value:function(){var t=this.layerSource.getParserType();switch(t){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"rasterTile":return"rasterTile";default:return"raster"}}}]),r}(Uf),w3={fill:u1,vectorMask:dv},A3=w3;function T3(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=M3(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,c;return{s:function(){r=r.call(e)},n:function(){var m=r.next();return o=m.done,m},e:function(m){u=!0,c=m},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw c}}}}function M3(e,i){if(!!e){if(typeof e=="string")return U1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return U1(e,i)}}function U1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function I3(e){var i=k3();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function k3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var P3=function(e){(0,hr.Z)(r,e);var i=I3(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"type","MaskLayer"),n}return(0,yt.Z)(r,[{key:"init",value:function(){var t=this,o=this.container.get(Ft.SceneID);this.configService.setLayerConfig(o,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.rendererService=this.container.get(Ft.IRendererService),this.layerService=this.container.get(Ft.ILayerService),this.mapService=this.container.get(Ft.IMapService),this.cameraService=this.container.get(Ft.ICameraService),this.coordinateService=this.container.get(Ft.ICoordinateSystemService),this.shaderModuleService=this.container.get(Ft.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Ft.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Ft.IFactoryNormalPass),this.styleAttributeService=this.container.get(Ft.IStyleAttributeService),this.pendingStyleAttributes.forEach(function(m){var b=m.attributeName,C=m.attributeField,A=m.attributeValues,P=m.updateOptions;t.styleAttributeService.updateStyleAttribute(b,{scale:(0,oe.Z)({field:C},t.splitValuesAndCallbackInAttribute(A,t.getLayerConfig()[b]))},P)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Ft.ILayerPlugin);var u=T3(this.plugins),c;try{for(u.s();!(c=u.n()).done;){var p=c.value;p.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(m){u.e(m)}finally{u.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this}},{key:"buildModels",value:function(){var t=this,o=this.getModelType();this.layerModel=new A3[o](this),this.layerModel.initModels(function(u){t.dispatchModelLoad(u)})}},{key:"rebuildModels",value:function(){var t=this;this.layerModel.buildModels(function(o){t.dispatchModelLoad(o)})}},{key:"getModelType",value:function(){var t=this.layerSource.getParserType();return v0(t)?"vectorMask":"fill"}}]),r}(Uf),Z1,V1,j1,G1,_0,H1,W1,L3=(Z1=(0,Jr.b2)(),V1=(0,Jr.f3)(Ft.IMapService),j1=(0,Jr.f3)(Ft.IFontService),Z1(G1=(_0=function(){function e(){(0,vt.Z)(this,e),na(this,"mapService",H1,this),na(this,"fontService",W1,this)}return(0,yt.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){var u=r.getSource();u.inited?t.generateMaping(r,{styleAttributeService:o}):u.once("update",function(){t.generateMaping(r,{styleAttributeService:o})})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){r.dataState.dataMappingNeedUpdate=!1;var u=r.getSource();return u.inited?t.generateMaping(r,{styleAttributeService:o}):u.once("update",function(){t.generateMaping(r,{styleAttributeService:o})}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){var u=r.getLayerConfig(),c=u.usage;if(c!=="basemap"){var p=r.getSource();if(!(r.layerModelNeedUpdate||!p||!p.inited)){var m=r.getBottomColor(),b=o.getLayerStyleAttributes()||[],C=o.getLayerStyleAttribute("filter"),A=p.data.dataArray,P=b.filter(function(j){return j.needRemapping}),O=A;if(C!=null&&C.needRemapping&&C!==null&&C!==void 0&&C.scale&&(O=A.filter(function(j){return t.applyAttributeMapping(C,j,m)[0]})),P.length){if(C!=null&&C.needRemapping){var D=t.mapping(r,b,O,void 0,m);r.setEncodedData(D),C.needRemapping=!1}else{var N=t.mapping(r,P,O,r.getEncodedData(),m);r.setEncodedData(N)}r.emit("remapping",null)}}}})}},{key:"generateMaping",value:function(r,n){var t=this,o=n.styleAttributeService,u=r.getBottomColor(),c=o.getLayerStyleAttributes()||[],p=o.getLayerStyleAttribute("filter"),m=r.getSource().data.dataArray,b=m;p!=null&&p.scale&&(b=m.filter(function(A){return t.applyAttributeMapping(p,A,u)[0]}));var C=this.mapping(r,c,b,void 0,u);r.setEncodedData(C),r.emit("dataUpdate",null)}},{key:"mapping",value:function(r,n,t,o,u){var c=this,p=r.getLayerConfig(),m=p.arrow,b=m===void 0?{enable:!1}:m,C=p.usage;if(C==="basemap")return this.mapLayerMapping(r,n,t,o);var A=n.filter(function(O){return O.scale!==void 0}),P=t.map(function(O,D){var N=o?o[D]:{},j=(0,oe.Z)({id:O._id,coordinates:O.coordinates},N);if(A.forEach(function(Te){var Re=c.applyAttributeMapping(Te,O,u);Te.needRemapping=!1,Te.name==="color"&&(Re=Re.map(function(Ke){return h(Ke)})),j[Te.name]=Array.isArray(Re)&&Re.length===1?Re[0]:Re,Te.name==="shape"&&(j.shape=c.fontService.getIconFontKey(j[Te.name]))}),b.enable&&(j.shape==="line"||j.shape==="halfLine")){var ae=j.coordinates;if(r.arrowInsertCount<r.encodeDataLength){var re=c.getArrowPoints(ae[0],ae[1]);j.coordinates.splice(1,0,re,re),r.arrowInsertCount++}}return j});return this.adjustData2Amap2Coordinates(P,r),this.adjustData2SimpleCoordinates(P),P}},{key:"mapLayerMapping",value:function(r,n,t,o){var u=this,c=n.filter(function(m){return m.scale!==void 0}),p=t.map(function(m,b){var C=o?o[b]:{},A=(0,oe.Z)({id:m._id,coordinates:m.coordinates},C);return c.forEach(function(P){var O;if(P.name==="shape"&&((O=r.shapeOption)===null||O===void 0?void 0:O.field)==="simple")A[P.name]="simple",P.needRemapping=!1;else{var D=u.applyMapLayerAttributeMapping(P,m);P.needRemapping=!1,A[P.name]=Array.isArray(D)&&D.length===1?D[0]:D,P.name==="shape"&&(A.shape=u.fontService.getIconFontKey(A[P.name]))}}),A.size===void 0&&(A.size=1),A});return this.adjustData2Amap2Coordinates(p,r),p}},{key:"adjustData2Amap2Coordinates",value:function(r,n){var t=this;if(r.length>0&&this.mapService.version===ts["GAODE2.x"]){var o=n.coordCenter||n.getSource().center;typeof r[0].coordinates[0]=="number"?r.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=ts["GAODE2.x"],u.originCoordinates=(0,Er.cloneDeep)(u.coordinates),u.coordinates=t.mapService.lngLatToCoordByLayer(u.coordinates,o)}):r.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=ts["GAODE2.x"],u.originCoordinates=(0,Er.cloneDeep)(u.coordinates),u.coordinates=t.mapService.lngLatToCoordsByLayer(u.coordinates,o)})}}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===ts.SIMPLE&&r.map(function(t){t.simpleCoordinate||(t.coordinates=n.unProjectCoordinates(t.coordinates),t.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var t=[];return r.map(function(u){var c=[];u.map(function(p){c.push(n.mapService.simpleMapCoord.unproject(p))}),t.push(c)}),t}else{var o=[];return r.map(function(u){o.push(n.mapService.simpleMapCoord.unproject(u))}),o}}},{key:"applyAttributeMapping",value:function(r,n,t){var o;if(!r.scale)return[];var u=(r==null||(o=r.scale)===null||o===void 0?void 0:o.scalers)||[],c=[];u.forEach(function(m){var b,C=m.field;(n.hasOwnProperty(C)||((b=r.scale)===null||b===void 0?void 0:b.type)==="variable")&&c.push(n[C])});var p=r.mapping?r.mapping(c):[];return r.name==="color"&&!d(p[0])?[t]:p}},{key:"applyMapLayerAttributeMapping",value:function(r,n){var t;if(!r.scale)return[];var o=(r==null||(t=r.scale)===null||t===void 0?void 0:t.scalers)||[],u=[];o.forEach(function(p){var m,b=p.field;(n.hasOwnProperty(b)||((m=r.scale)===null||m===void 0?void 0:m.type)==="variable")&&u.push(n[b])});var c=r.mapping?r.mapping(u):[];return c}},{key:"getArrowPoints",value:function(r,n){var t=[n[0]-r[0],n[1]-r[1]],o=Yl(t),u=[r[0]+o[0]*1e-4,r[1]+o[1]*1e-4];return u}}]),e}(),H1=ta(_0.prototype,"mapService",[V1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W1=ta(_0.prototype,"fontService",[j1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_0))||G1),X1,Y1,R3=(X1=(0,Jr.b2)(),X1(Y1=function(){function e(){(0,vt.Z)(this,e)}return(0,yt.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(Ft.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var t=r.getSource();if(!t){var o=r.sourceOption||r.defaultSourceConfig,u=o.data,c=o.options;t=new us(u,c),r.setSource(t)}t.inited?n.updateClusterData(r):t.once("update",function(){n.updateClusterData(r)})}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var t=n.updateClusterData(r),o=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,t||o})}},{key:"updateClusterData",value:function(r){if(r.isTileLayer||r.tileLayer)return!1;var n=r.getSource(),t=n.cluster,o=n.clusterOptions.zoom,u=o===void 0?0:o,c=this.mapService.getZoom()-1,p=r.dataState.dataSourceNeedUpdate;return t&&p&&n.updateClusterData(Math.floor(c)),t&&Math.abs(r.clusterZoom-c)>=1?(u!==Math.floor(c)&&n.updateClusterData(Math.floor(c)),r.clusterZoom=c,!0):!1}}]),e}())||Y1);function _m(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function $1(e){return e.length===1&&(e=O3(e)),{left:function(i,r,n,t){for(n==null&&(n=0),t==null&&(t=i.length);n<t;){var o=n+t>>>1;e(i[o],r)<0?n=o+1:t=o}return n},right:function(i,r,n,t){for(n==null&&(n=0),t==null&&(t=i.length);n<t;){var o=n+t>>>1;e(i[o],r)>0?t=o:n=o+1}return n}}}function O3(e){return function(i,r){return _m(e(i),r)}}var q1=$1(_m),D3=q1.right,QR=q1.left,x0=D3;function K1(e,i){var r=e.length,n=-1,t,o,u;if(i==null){for(;++n<r;)if((t=e[n])!=null&&t>=t)for(o=u=t;++n<r;)(t=e[n])!=null&&(o>t&&(o=t),u<t&&(u=t))}else for(;++n<r;)if((t=i(e[n],n,e))!=null&&t>=t)for(o=u=t;++n<r;)(t=i(e[n],n,e))!=null&&(o>t&&(o=t),u<t&&(u=t));return[o,u]}var Q1=Array.prototype,JR=Q1.slice,eO=Q1.map,xm=Math.sqrt(50),bm=Math.sqrt(10),Em=Math.sqrt(2);function J1(e,i,r){var n,t=-1,o,u,c;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(o=e,e=i,i=o),(c=b0(e,i,r))===0||!isFinite(c))return[];if(c>0)for(e=Math.ceil(e/c),i=Math.floor(i/c),u=new Array(o=Math.ceil(i-e+1));++t<o;)u[t]=(e+t)*c;else for(e=Math.floor(e*c),i=Math.ceil(i*c),u=new Array(o=Math.ceil(e-i+1));++t<o;)u[t]=(e-t)/c;return n&&u.reverse(),u}function b0(e,i,r){var n=(i-e)/Math.max(0,r),t=Math.floor(Math.log(n)/Math.LN10),o=n/Math.pow(10,t);return t>=0?(o>=xm?10:o>=bm?5:o>=Em?2:1)*Math.pow(10,t):-Math.pow(10,-t)/(o>=xm?10:o>=bm?5:o>=Em?2:1)}function Sm(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),t=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/t;return o>=xm?t*=10:o>=bm?t*=5:o>=Em&&(t*=2),i<e?-t:t}function tO(){var e=identity,i=extent,r=sturges;function n(t){var o,u=t.length,c,p=new Array(u);for(o=0;o<u;++o)p[o]=e(t[o],o,t);var m=i(p),b=m[0],C=m[1],A=r(p,b,C);Array.isArray(A)||(A=tickStep(b,C,A),A=range(Math.ceil(b/A)*A,C,A));for(var P=A.length;A[0]<=b;)A.shift(),--P;for(;A[P-1]>C;)A.pop(),--P;var O=new Array(P+1),D;for(o=0;o<=P;++o)D=O[o]=[],D.x0=o>0?A[o-1]:b,D.x1=o<P?A[o]:C;for(o=0;o<u;++o)c=p[o],b<=c&&c<=C&&O[bisect(A,c,0,P)].push(t[o]);return O}return n.value=function(t){return arguments.length?(e=typeof t=="function"?t:constant(t),n):e},n.domain=function(t){return arguments.length?(i=typeof t=="function"?t:constant([t[0],t[1]]),n):i},n.thresholds=function(t){return arguments.length?(r=typeof t=="function"?t:Array.isArray(t)?constant(slice.call(t)):constant(t),n):r},n}function rO(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function F3(e){return e===null?NaN:+e}function B3(e,i,r){if(r==null&&(r=F3),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,t=(n-1)*i,o=Math.floor(t),u=+r(e[o],o,e),c=+r(e[o+1],o+1,e);return u+(c-u)*(t-o)}}var N3=fe(87765),Fc="$";function E0(){}E0.prototype=ex.prototype={constructor:E0,has:function(e){return Fc+e in this},get:function(e){return this[Fc+e]},set:function(e,i){return this[Fc+e]=i,this},remove:function(e){var i=Fc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Fc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Fc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Fc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Fc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Fc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Fc)return!1;return!0},each:function(e){for(var i in this)i[0]===Fc&&e(this[i],i.slice(1),this)}};function ex(e,i){var r=new E0;if(e instanceof E0)e.each(function(c,p){r.set(p,c)});else if(Array.isArray(e)){var n=-1,t=e.length,o;if(i==null)for(;++n<t;)r.set(n,e[n]);else for(;++n<t;)r.set(i(o=e[n],n,e),o)}else if(e)for(var u in e)r.set(u,e[u]);return r}var Cm=ex;function nO(){var e=[],i=[],r,n,t;function o(c,p,m,b){if(p>=e.length)return r!=null&&c.sort(r),n!=null?n(c):c;for(var C=-1,A=c.length,P=e[p++],O,D,N=map(),j,ae=m();++C<A;)(j=N.get(O=P(D=c[C])+""))?j.push(D):N.set(O,[D]);return N.each(function(re,Te){b(ae,Te,o(re,p,m,b))}),ae}function u(c,p){if(++p>e.length)return c;var m,b=i[p-1];return n!=null&&p>=e.length?m=c.entries():(m=[],c.each(function(C,A){m.push({key:A,values:u(C,p)})})),b!=null?m.sort(function(C,A){return b(C.key,A.key)}):m}return t={object:function(c){return o(c,0,z3,U3)},map:function(c){return o(c,0,tx,rx)},entries:function(c){return u(o(c,0,tx,rx),0)},key:function(c){return e.push(c),t},sortKeys:function(c){return i[e.length-1]=c,t},sortValues:function(c){return r=c,t},rollup:function(c){return n=c,t}}}function z3(){return{}}function U3(e,i,r){e[i]=r}function tx(){return map()}function rx(e,i,r){e.set(i,r)}function S0(){}var ed=Cm.prototype;S0.prototype=Z3.prototype={constructor:S0,has:ed.has,add:function(e){return e+="",this[Fc+e]=e,this},remove:ed.remove,clear:ed.clear,values:ed.keys,size:ed.size,empty:ed.empty,each:ed.each};function Z3(e,i){var r=new S0;if(e instanceof S0)e.each(function(o){r.add(o)});else if(e){var n=-1,t=e.length;if(i==null)for(;++n<t;)r.add(e[n]);else for(;++n<t;)r.add(i(e[n],n,e))}return r}var iO=null,nx=Array.prototype,C0=nx.map,td=nx.slice;function op(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function ix(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var ax={name:"implicit"};function w0(){var e=Cm(),i=[],r=[],n=ax;function t(o){var u=o+"",c=e.get(u);if(!c){if(n!==ax)return n;e.set(u,c=i.push(o))}return r[(c-1)%r.length]}return t.domain=function(o){if(!arguments.length)return i.slice();i=[],e=Cm();for(var u=-1,c=o.length,p,m;++u<c;)e.has(m=(p=o[u])+"")||e.set(m,i.push(p));return t},t.range=function(o){return arguments.length?(r=td.call(o),t):r.slice()},t.unknown=function(o){return arguments.length?(n=o,t):n},t.copy=function(){return w0(i,r).unknown(n)},op.apply(t,arguments),t}function ox(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],t,o,u=!1,c=0,p=0,m=.5;delete e.unknown;function b(){var C=i().length,A=n[1]<n[0],P=n[A-0],O=n[1-A];t=(O-P)/Math.max(1,C-c+p*2),u&&(t=Math.floor(t)),P+=(O-P-t*(C-c))*m,o=t*(1-c),u&&(P=Math.round(P),o=Math.round(o));var D=sequence(C).map(function(N){return P+t*N});return r(A?D.reverse():D)}return e.domain=function(C){return arguments.length?(i(C),b()):i()},e.range=function(C){return arguments.length?(n=[+C[0],+C[1]],b()):n.slice()},e.rangeRound=function(C){return n=[+C[0],+C[1]],u=!0,b()},e.bandwidth=function(){return o},e.step=function(){return t},e.round=function(C){return arguments.length?(u=!!C,b()):u},e.padding=function(C){return arguments.length?(c=Math.min(1,p=+C),b()):c},e.paddingInner=function(C){return arguments.length?(c=Math.min(1,C),b()):c},e.paddingOuter=function(C){return arguments.length?(p=+C,b()):p},e.align=function(C){return arguments.length?(m=Math.max(0,Math.min(1,C)),b()):m},e.copy=function(){return ox(i(),n).round(u).paddingInner(c).paddingOuter(p).align(m)},initRange.apply(b(),arguments)}function sx(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return sx(i())},e}function aO(){return sx(ox.apply(null,arguments).paddingInner(1))}var V3=fe(21775),j3=fe(73626);function G3(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function H3(e){return function(){return e}}function wm(e){return+e}var ux=[0,1];function Qu(e){return e}function Am(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:H3(isNaN(i)?NaN:.5)}function lx(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(t){return Math.max(i,Math.min(r,t))}}function W3(e,i,r){var n=e[0],t=e[1],o=i[0],u=i[1];return t<n?(n=Am(t,n),o=r(u,o)):(n=Am(n,t),o=r(o,u)),function(c){return o(n(c))}}function X3(e,i,r){var n=Math.min(e.length,i.length)-1,t=new Array(n),o=new Array(n),u=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++u<n;)t[u]=Am(e[u],e[u+1]),o[u]=r(i[u],i[u+1]);return function(c){var p=x0(e,c,1,n)-1;return o[p](t[p](c))}}function A0(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Tm(){var e=ux,i=ux,r=V3.Z,n,t,o,u=Qu,c,p,m;function b(){return c=Math.min(e.length,i.length)>2?X3:W3,p=m=null,C}function C(A){return isNaN(A=+A)?o:(p||(p=c(e.map(n),i,r)))(n(u(A)))}return C.invert=function(A){return u(t((m||(m=c(i,e.map(n),j3.Z)))(A)))},C.domain=function(A){return arguments.length?(e=C0.call(A,wm),u===Qu||(u=lx(e)),b()):e.slice()},C.range=function(A){return arguments.length?(i=td.call(A),b()):i.slice()},C.rangeRound=function(A){return i=td.call(A),r=G3,b()},C.clamp=function(A){return arguments.length?(u=A?lx(e):Qu,C):u!==Qu},C.interpolate=function(A){return arguments.length?(r=A,b()):r},C.unknown=function(A){return arguments.length?(o=A,C):o},function(A,P){return n=A,t=P,b()}}function cx(e,i){return Tm()(e,i)}var Y3=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function T0(e){if(!(i=Y3.exec(e)))throw new Error("invalid format: "+e);var i;return new Mm({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}T0.prototype=Mm.prototype;function Mm(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Mm.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function $3(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function M0(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function Fd(e){return e=M0(Math.abs(e)),e?e[1]:NaN}function q3(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Fd(i)/3)))*3-Fd(Math.abs(e)))}function K3(e,i){return function(r,n){for(var t=r.length,o=[],u=0,c=e[0],p=0;t>0&&c>0&&(p+c+1>n&&(c=Math.max(1,n-p)),o.push(r.substring(t-=c,t+c)),!((p+=c+1)>n));)c=e[u=(u+1)%e.length];return o.reverse().join(i)}}function Q3(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function J3(e){e:for(var i=e.length,r=1,n=-1,t;r<i;++r)switch(e[r]){case".":n=t=r;break;case"0":n===0&&(n=r),t=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(t+1):e}var fx;function ek(e,i){var r=M0(e,i);if(!r)return e+"";var n=r[0],t=r[1],o=t-(fx=Math.max(-8,Math.min(8,Math.floor(t/3)))*3)+1,u=n.length;return o===u?n:o>u?n+new Array(o-u+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+M0(e,Math.max(0,i+o-1))[0]}function hx(e,i){var r=M0(e,i);if(!r)return e+"";var n=r[0],t=r[1];return t<0?"0."+new Array(-t).join("0")+n:n.length>t+1?n.slice(0,t+1)+"."+n.slice(t+1):n+new Array(t-n.length+2).join("0")}var px={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:$3,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return hx(e*100,i)},r:hx,s:ek,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function dx(e){return e}var vx=Array.prototype.map,mx=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function tk(e){var i=e.grouping===void 0||e.thousands===void 0?dx:K3(vx.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",t=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?dx:Q3(vx.call(e.numerals,String)),u=e.percent===void 0?"%":e.percent+"",c=e.minus===void 0?"-":e.minus+"",p=e.nan===void 0?"NaN":e.nan+"";function m(C){C=T0(C);var A=C.fill,P=C.align,O=C.sign,D=C.symbol,N=C.zero,j=C.width,ae=C.comma,re=C.precision,Te=C.trim,Re=C.type;Re==="n"?(ae=!0,Re="g"):px[Re]||(re===void 0&&(re=12),Te=!0,Re="g"),(N||A==="0"&&P==="=")&&(N=!0,A="0",P="=");var Ke=D==="$"?r:D==="#"&&/[boxX]/.test(Re)?"0"+Re.toLowerCase():"",gt=D==="$"?n:/[%p]/.test(Re)?u:"",lt=px[Re],Ut=/[defgprs%]/.test(Re);re=re===void 0?6:/[gprs]/.test(Re)?Math.max(1,Math.min(21,re)):Math.max(0,Math.min(20,re));function or(cr){var Tr=Ke,Sn=gt,Un,Vi,Ba;if(Re==="c")Sn=lt(cr)+Sn,cr="";else{cr=+cr;var ho=cr<0||1/cr<0;if(cr=isNaN(cr)?p:lt(Math.abs(cr),re),Te&&(cr=J3(cr)),ho&&+cr==0&&O!=="+"&&(ho=!1),Tr=(ho?O==="("?O:c:O==="-"||O==="("?"":O)+Tr,Sn=(Re==="s"?mx[8+fx/3]:"")+Sn+(ho&&O==="("?")":""),Ut){for(Un=-1,Vi=cr.length;++Un<Vi;)if(Ba=cr.charCodeAt(Un),48>Ba||Ba>57){Sn=(Ba===46?t+cr.slice(Un+1):cr.slice(Un))+Sn,cr=cr.slice(0,Un);break}}}ae&&!N&&(cr=i(cr,Infinity));var Ao=Tr.length+cr.length+Sn.length,Wo=Ao<j?new Array(j-Ao+1).join(A):"";switch(ae&&N&&(cr=i(Wo+cr,Wo.length?j-Sn.length:Infinity),Wo=""),P){case"<":cr=Tr+cr+Sn+Wo;break;case"=":cr=Tr+Wo+cr+Sn;break;case"^":cr=Wo.slice(0,Ao=Wo.length>>1)+Tr+cr+Sn+Wo.slice(Ao);break;default:cr=Wo+Tr+cr+Sn;break}return o(cr)}return or.toString=function(){return C+""},or}function b(C,A){var P=m((C=T0(C),C.type="f",C)),O=Math.max(-8,Math.min(8,Math.floor(Fd(A)/3)))*3,D=Math.pow(10,-O),N=mx[8+O/3];return function(j){return P(D*j)+N}}return{format:m,formatPrefix:b}}var I0,Im,gx;rk({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function rk(e){return I0=tk(e),Im=I0.format,gx=I0.formatPrefix,I0}function nk(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,Fd(i)-Fd(e))+1}function ik(e){return Math.max(0,-Fd(Math.abs(e)))}function ak(e,i,r,n){var t=Sm(e,i,r),o;switch(n=T0(n==null?",f":n),n.type){case"s":{var u=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(o=q3(t,u))&&(n.precision=o),gx(n,u)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=nk(t,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=ik(t))&&(n.precision=o-(n.type==="%")*2);break}}return Im(n)}function Bd(e){var i=e.domain;return e.ticks=function(r){var n=i();return J1(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var t=i();return ak(t[0],t[t.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),t=0,o=n.length-1,u=n[t],c=n[o],p;return c<u&&(p=u,u=c,c=p,p=t,t=o,o=p),p=b0(u,c,r),p>0?(u=Math.floor(u/p)*p,c=Math.ceil(c/p)*p,p=b0(u,c,r)):p<0&&(u=Math.ceil(u*p)/p,c=Math.floor(c*p)/p,p=b0(u,c,r)),p>0?(n[t]=Math.floor(u/p)*p,n[o]=Math.ceil(c/p)*p,i(n)):p<0&&(n[t]=Math.ceil(u*p)/p,n[o]=Math.floor(c*p)/p,i(n)),e},e}function yx(){var e=cx(Qu,Qu);return e.copy=function(){return A0(e,yx())},op.apply(e,arguments),Bd(e)}function _x(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=C0.call(n,wm),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return _x(e).unknown(i)},e=arguments.length?C0.call(e,wm):[0,1],Bd(r)}function xx(e,i){e=e.slice();var r=0,n=e.length-1,t=e[r],o=e[n],u;return o<t&&(u=r,r=n,n=u,u=t,t=o,o=u),e[r]=i.floor(t),e[n]=i.ceil(o),e}function bx(e){return Math.log(e)}function Ex(e){return Math.exp(e)}function ok(e){return-Math.log(-e)}function sk(e){return-Math.exp(-e)}function uk(e){return isFinite(e)?+("1e"+e):e<0?0:e}function lk(e){return e===10?uk:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function ck(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function Sx(e){return function(i){return-e(-i)}}function fk(e){var i=e(bx,Ex),r=i.domain,n=10,t,o;function u(){return t=ck(n),o=lk(n),r()[0]<0?(t=Sx(t),o=Sx(o),e(ok,sk)):e(bx,Ex),i}return i.base=function(c){return arguments.length?(n=+c,u()):n},i.domain=function(c){return arguments.length?(r(c),u()):r()},i.ticks=function(c){var p=r(),m=p[0],b=p[p.length-1],C;(C=b<m)&&(A=m,m=b,b=A);var A=t(m),P=t(b),O,D,N,j=c==null?10:+c,ae=[];if(!(n%1)&&P-A<j){if(A=Math.round(A)-1,P=Math.round(P)+1,m>0){for(;A<P;++A)for(D=1,O=o(A);D<n;++D)if(N=O*D,!(N<m)){if(N>b)break;ae.push(N)}}else for(;A<P;++A)for(D=n-1,O=o(A);D>=1;--D)if(N=O*D,!(N<m)){if(N>b)break;ae.push(N)}}else ae=J1(A,P,Math.min(P-A,j)).map(o);return C?ae.reverse():ae},i.tickFormat=function(c,p){if(p==null&&(p=n===10?".0e":","),typeof p!="function"&&(p=Im(p)),c===Infinity)return p;c==null&&(c=10);var m=Math.max(1,n*c/i.ticks().length);return function(b){var C=b/o(Math.round(t(b)));return C*n<n-.5&&(C*=n),C<=m?p(b):""}},i.nice=function(){return r(xx(r(),{floor:function(c){return o(Math.floor(t(c)))},ceil:function(c){return o(Math.ceil(t(c)))}}))},i}function Cx(){var e=fk(Tm()).domain([1,10]);return e.copy=function(){return A0(e,Cx()).base(e.base())},op.apply(e,arguments),e}function Ax(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function Tx(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function hk(e){var i=1,r=e(Ax(i),Tx(i));return r.constant=function(n){return arguments.length?e(Ax(i=+n),Tx(i)):i},linearish(r)}function pk(){var e=hk(transformer());return e.copy=function(){return copy(e,pk()).constant(e.constant())},initRange.apply(e,arguments)}function Mx(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function dk(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function vk(e){return e<0?-e*e:e*e}function mk(e){var i=e(Qu,Qu),r=1;function n(){return r===1?e(Qu,Qu):r===.5?e(dk,vk):e(Mx(r),Mx(1/r))}return i.exponent=function(t){return arguments.length?(r=+t,n()):r},Bd(i)}function km(){var e=mk(Tm());return e.copy=function(){return A0(e,km()).exponent(e.exponent())},op.apply(e,arguments),e}function oO(){return km.apply(null,arguments).exponent(.5)}function Ix(){var e=[],i=[],r=[],n;function t(){var u=0,c=Math.max(1,i.length);for(r=new Array(c-1);++u<c;)r[u-1]=B3(e,u/c);return o}function o(u){return isNaN(u=+u)?n:i[x0(r,u)]}return o.invertExtent=function(u){var c=i.indexOf(u);return c<0?[NaN,NaN]:[c>0?r[c-1]:e[0],c<r.length?r[c]:e[e.length-1]]},o.domain=function(u){if(!arguments.length)return e.slice();e=[];for(var c=0,p=u.length,m;c<p;++c)m=u[c],m!=null&&!isNaN(m=+m)&&e.push(m);return e.sort(_m),t()},o.range=function(u){return arguments.length?(i=td.call(u),t()):i.slice()},o.unknown=function(u){return arguments.length?(n=u,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return Ix().domain(e).range(i).unknown(n)},op.apply(o,arguments)}function kx(){var e=0,i=1,r=1,n=[.5],t=[0,1],o;function u(p){return p<=p?t[x0(n,p,0,r)]:o}function c(){var p=-1;for(n=new Array(r);++p<r;)n[p]=((p+1)*i-(p-r)*e)/(r+1);return u}return u.domain=function(p){return arguments.length?(e=+p[0],i=+p[1],c()):[e,i]},u.range=function(p){return arguments.length?(r=(t=td.call(p)).length-1,c()):t.slice()},u.invertExtent=function(p){var m=t.indexOf(p);return m<0?[NaN,NaN]:m<1?[e,n[0]]:m>=r?[n[r-1],i]:[n[m-1],n[m]]},u.unknown=function(p){return arguments.length&&(o=p),u},u.thresholds=function(){return n.slice()},u.copy=function(){return kx().domain([e,i]).range(t).unknown(o)},op.apply(Bd(u),arguments)}function Px(){var e=[.5],i=[0,1],r,n=1;function t(o){return o<=o?i[x0(e,o,0,n)]:r}return t.domain=function(o){return arguments.length?(e=td.call(o),n=Math.min(e.length,i.length-1),t):e.slice()},t.range=function(o){return arguments.length?(i=td.call(o),n=Math.min(e.length,i.length-1),t):i.slice()},t.invertExtent=function(o){var u=i.indexOf(o);return[e[u-1],e[u]]},t.unknown=function(o){return arguments.length?(r=o,t):r},t.copy=function(){return Px().domain(e).range(i).unknown(r)},op.apply(t,arguments)}var Pm=new Date,Lm=new Date;function vl(e,i,r,n){function t(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return t.floor=function(o){return e(o=new Date(+o)),o},t.ceil=function(o){return e(o=new Date(o-1)),i(o,1),e(o),o},t.round=function(o){var u=t(o),c=t.ceil(o);return o-u<c-o?u:c},t.offset=function(o,u){return i(o=new Date(+o),u==null?1:Math.floor(u)),o},t.range=function(o,u,c){var p=[],m;if(o=t.ceil(o),c=c==null?1:Math.floor(c),!(o<u)||!(c>0))return p;do p.push(m=new Date(+o)),i(o,c),e(o);while(m<o&&o<u);return p},t.filter=function(o){return vl(function(u){if(u>=u)for(;e(u),!o(u);)u.setTime(u-1)},function(u,c){if(u>=u)if(c<0)for(;++c<=0;)for(;i(u,-1),!o(u););else for(;--c>=0;)for(;i(u,1),!o(u););})},r&&(t.count=function(o,u){return Pm.setTime(+o),Lm.setTime(+u),e(Pm),e(Lm),Math.floor(r(Pm,Lm))},t.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?t.filter(n?function(u){return n(u)%o==0}:function(u){return t.count(0,u)%o==0}):t}),t}var Rm=vl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Rm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:vl(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var Nd=Rm,sO=Rm.range,Lx=vl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),gk=Lx,uO=Lx.range,k0=1e3,vv=6e4,Rx=36e5,Ox=864e5,Dx=6048e5;function rd(e){return vl(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*vv)/Dx})}var Om=rd(0),P0=rd(1),yk=rd(2),_k=rd(3),zd=rd(4),xk=rd(5),bk=rd(6),lO=Om.range,cO=P0.range,fO=yk.range,hO=_k.range,pO=zd.range,dO=xk.range,vO=bk.range,Fx=vl(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*vv)/Ox},function(e){return e.getDate()-1}),Dm=Fx,mO=Fx.range,Bx=vl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*k0-e.getMinutes()*vv)},function(e,i){e.setTime(+e+i*Rx)},function(e,i){return(i-e)/Rx},function(e){return e.getHours()}),Ek=Bx,gO=Bx.range,Nx=vl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*k0)},function(e,i){e.setTime(+e+i*vv)},function(e,i){return(i-e)/vv},function(e){return e.getMinutes()}),Sk=Nx,yO=Nx.range,zx=vl(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*k0)},function(e,i){return(i-e)/k0},function(e){return e.getUTCSeconds()}),Ck=zx,_O=zx.range,L0=vl(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});L0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?vl(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):L0};var wk=L0,xO=L0.range;function nd(e){return vl(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/Dx})}var Ux=nd(0),R0=nd(1),Ak=nd(2),Tk=nd(3),Ud=nd(4),Mk=nd(5),Ik=nd(6),bO=Ux.range,EO=R0.range,SO=Ak.range,CO=Tk.range,wO=Ud.range,AO=Mk.range,TO=Ik.range,Zx=vl(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/Ox},function(e){return e.getUTCDate()-1}),Vx=Zx,MO=Zx.range,Fm=vl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Fm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:vl(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var mv=Fm,IO=Fm.range;function Bm(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Nm(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function gv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function kk(e){var i=e.dateTime,r=e.date,n=e.time,t=e.periods,o=e.days,u=e.shortDays,c=e.months,p=e.shortMonths,m=yv(t),b=_v(t),C=yv(o),A=_v(o),P=yv(u),O=_v(u),D=yv(c),N=_v(c),j=yv(p),ae=_v(p),re={a:ho,A:Ao,b:Wo,B:Ju,c:null,d:Yx,e:Yx,f:Jk,g:l4,G:f4,H:qk,I:Kk,j:Qk,L:$x,m:e4,M:t4,p:up,q:lp,Q:tb,s:rb,S:r4,u:n4,U:i4,V:a4,w:o4,W:s4,x:null,X:null,y:u4,Y:c4,Z:h4,"%":eb},Te={a:cp,A:Wd,b:Pv,B:Xd,c:null,d:Kx,e:Kx,f:m4,g:A4,G:M4,H:p4,I:d4,j:v4,L:Qx,m:g4,M:y4,p:Yd,q:$m,Q:tb,s:rb,S:_4,u:x4,U:b4,V:E4,w:S4,W:C4,x:null,X:null,y:w4,Y:T4,Z:I4,"%":eb},Re={a:or,A:cr,b:Tr,B:Sn,c:Un,d:Wx,e:Wx,f:Wk,g:Hx,G:Gx,H:Xx,I:Xx,j:Vk,L:Hk,m:Zk,M:jk,p:Ut,q:Uk,Q:Yk,s:$k,S:Gk,u:Dk,U:Fk,V:Bk,w:Ok,W:Nk,x:Vi,X:Ba,y:Hx,Y:Gx,Z:zk,"%":Xk};re.x=Ke(r,re),re.X=Ke(n,re),re.c=Ke(i,re),Te.x=Ke(r,Te),Te.X=Ke(n,Te),Te.c=Ke(i,Te);function Ke(xi,La){return function($a){var In=[],xu=-1,zo=0,sc=xi.length,uc,sd,U2;for($a instanceof Date||($a=new Date(+$a));++xu<sc;)xi.charCodeAt(xu)===37&&(In.push(xi.slice(zo,xu)),(sd=jx[uc=xi.charAt(++xu)])!=null?uc=xi.charAt(++xu):sd=uc==="e"?" ":"0",(U2=La[uc])&&(uc=U2($a,sd)),In.push(uc),zo=xu+1);return In.push(xi.slice(zo,xu)),In.join("")}}function gt(xi,La){return function($a){var In=gv(1900,void 0,1),xu=lt(In,xi,$a+="",0),zo,sc;if(xu!=$a.length)return null;if("Q"in In)return new Date(In.Q);if("s"in In)return new Date(In.s*1e3+("L"in In?In.L:0));if(La&&!("Z"in In)&&(In.Z=0),"p"in In&&(In.H=In.H%12+In.p*12),In.m===void 0&&(In.m="q"in In?In.q:0),"V"in In){if(In.V<1||In.V>53)return null;"w"in In||(In.w=1),"Z"in In?(zo=Nm(gv(In.y,0,1)),sc=zo.getUTCDay(),zo=sc>4||sc===0?R0.ceil(zo):R0(zo),zo=Vx.offset(zo,(In.V-1)*7),In.y=zo.getUTCFullYear(),In.m=zo.getUTCMonth(),In.d=zo.getUTCDate()+(In.w+6)%7):(zo=Bm(gv(In.y,0,1)),sc=zo.getDay(),zo=sc>4||sc===0?P0.ceil(zo):P0(zo),zo=Dm.offset(zo,(In.V-1)*7),In.y=zo.getFullYear(),In.m=zo.getMonth(),In.d=zo.getDate()+(In.w+6)%7)}else("W"in In||"U"in In)&&("w"in In||(In.w="u"in In?In.u%7:"W"in In?1:0),sc="Z"in In?Nm(gv(In.y,0,1)).getUTCDay():Bm(gv(In.y,0,1)).getDay(),In.m=0,In.d="W"in In?(In.w+6)%7+In.W*7-(sc+5)%7:In.w+In.U*7-(sc+6)%7);return"Z"in In?(In.H+=In.Z/100|0,In.M+=In.Z%100,Nm(In)):Bm(In)}}function lt(xi,La,$a,In){for(var xu=0,zo=La.length,sc=$a.length,uc,sd;xu<zo;){if(In>=sc)return-1;if(uc=La.charCodeAt(xu++),uc===37){if(uc=La.charAt(xu++),sd=Re[uc in jx?La.charAt(xu++):uc],!sd||(In=sd(xi,$a,In))<0)return-1}else if(uc!=$a.charCodeAt(In++))return-1}return In}function Ut(xi,La,$a){var In=m.exec(La.slice($a));return In?(xi.p=b[In[0].toLowerCase()],$a+In[0].length):-1}function or(xi,La,$a){var In=P.exec(La.slice($a));return In?(xi.w=O[In[0].toLowerCase()],$a+In[0].length):-1}function cr(xi,La,$a){var In=C.exec(La.slice($a));return In?(xi.w=A[In[0].toLowerCase()],$a+In[0].length):-1}function Tr(xi,La,$a){var In=j.exec(La.slice($a));return In?(xi.m=ae[In[0].toLowerCase()],$a+In[0].length):-1}function Sn(xi,La,$a){var In=D.exec(La.slice($a));return In?(xi.m=N[In[0].toLowerCase()],$a+In[0].length):-1}function Un(xi,La,$a){return lt(xi,i,La,$a)}function Vi(xi,La,$a){return lt(xi,r,La,$a)}function Ba(xi,La,$a){return lt(xi,n,La,$a)}function ho(xi){return u[xi.getDay()]}function Ao(xi){return o[xi.getDay()]}function Wo(xi){return p[xi.getMonth()]}function Ju(xi){return c[xi.getMonth()]}function up(xi){return t[+(xi.getHours()>=12)]}function lp(xi){return 1+~~(xi.getMonth()/3)}function cp(xi){return u[xi.getUTCDay()]}function Wd(xi){return o[xi.getUTCDay()]}function Pv(xi){return p[xi.getUTCMonth()]}function Xd(xi){return c[xi.getUTCMonth()]}function Yd(xi){return t[+(xi.getUTCHours()>=12)]}function $m(xi){return 1+~~(xi.getUTCMonth()/3)}return{format:function(xi){var La=Ke(xi+="",re);return La.toString=function(){return xi},La},parse:function(xi){var La=gt(xi+="",!1);return La.toString=function(){return xi},La},utcFormat:function(xi){var La=Ke(xi+="",Te);return La.toString=function(){return xi},La},utcParse:function(xi){var La=gt(xi+="",!0);return La.toString=function(){return xi},La}}}var jx={"-":"",_:" ","0":"0"},_u=/^\s*\d+/,Pk=/^%/,Lk=/[\\^$*+?|[\]().{}]/g;function so(e,i,r){var n=e<0?"-":"",t=(n?-e:e)+"",o=t.length;return n+(o<r?new Array(r-o+1).join(i)+t:t)}function Rk(e){return e.replace(Lk,"\\$&")}function yv(e){return new RegExp("^(?:"+e.map(Rk).join("|")+")","i")}function _v(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function Ok(e,i,r){var n=_u.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function Dk(e,i,r){var n=_u.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function Fk(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function Bk(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function Nk(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function Gx(e,i,r){var n=_u.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function Hx(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function zk(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function Uk(e,i,r){var n=_u.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function Zk(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function Wx(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function Vk(e,i,r){var n=_u.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function Xx(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function jk(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function Gk(e,i,r){var n=_u.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function Hk(e,i,r){var n=_u.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function Wk(e,i,r){var n=_u.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function Xk(e,i,r){var n=Pk.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function Yk(e,i,r){var n=_u.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function $k(e,i,r){var n=_u.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function Yx(e,i){return so(e.getDate(),i,2)}function qk(e,i){return so(e.getHours(),i,2)}function Kk(e,i){return so(e.getHours()%12||12,i,2)}function Qk(e,i){return so(1+Dm.count(Nd(e),e),i,3)}function $x(e,i){return so(e.getMilliseconds(),i,3)}function Jk(e,i){return $x(e,i)+"000"}function e4(e,i){return so(e.getMonth()+1,i,2)}function t4(e,i){return so(e.getMinutes(),i,2)}function r4(e,i){return so(e.getSeconds(),i,2)}function n4(e){var i=e.getDay();return i===0?7:i}function i4(e,i){return so(Om.count(Nd(e)-1,e),i,2)}function qx(e){var i=e.getDay();return i>=4||i===0?zd(e):zd.ceil(e)}function a4(e,i){return e=qx(e),so(zd.count(Nd(e),e)+(Nd(e).getDay()===4),i,2)}function o4(e){return e.getDay()}function s4(e,i){return so(P0.count(Nd(e)-1,e),i,2)}function u4(e,i){return so(e.getFullYear()%100,i,2)}function l4(e,i){return e=qx(e),so(e.getFullYear()%100,i,2)}function c4(e,i){return so(e.getFullYear()%1e4,i,4)}function f4(e,i){var r=e.getDay();return e=r>=4||r===0?zd(e):zd.ceil(e),so(e.getFullYear()%1e4,i,4)}function h4(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+so(i/60|0,"0",2)+so(i%60,"0",2)}function Kx(e,i){return so(e.getUTCDate(),i,2)}function p4(e,i){return so(e.getUTCHours(),i,2)}function d4(e,i){return so(e.getUTCHours()%12||12,i,2)}function v4(e,i){return so(1+Vx.count(mv(e),e),i,3)}function Qx(e,i){return so(e.getUTCMilliseconds(),i,3)}function m4(e,i){return Qx(e,i)+"000"}function g4(e,i){return so(e.getUTCMonth()+1,i,2)}function y4(e,i){return so(e.getUTCMinutes(),i,2)}function _4(e,i){return so(e.getUTCSeconds(),i,2)}function x4(e){var i=e.getUTCDay();return i===0?7:i}function b4(e,i){return so(Ux.count(mv(e)-1,e),i,2)}function Jx(e){var i=e.getUTCDay();return i>=4||i===0?Ud(e):Ud.ceil(e)}function E4(e,i){return e=Jx(e),so(Ud.count(mv(e),e)+(mv(e).getUTCDay()===4),i,2)}function S4(e){return e.getUTCDay()}function C4(e,i){return so(R0.count(mv(e)-1,e),i,2)}function w4(e,i){return so(e.getUTCFullYear()%100,i,2)}function A4(e,i){return e=Jx(e),so(e.getUTCFullYear()%100,i,2)}function T4(e,i){return so(e.getUTCFullYear()%1e4,i,4)}function M4(e,i){var r=e.getUTCDay();return e=r>=4||r===0?Ud(e):Ud.ceil(e),so(e.getUTCFullYear()%1e4,i,4)}function I4(){return"+0000"}function eb(){return"%"}function tb(e){return+e}function rb(e){return Math.floor(+e/1e3)}var Zd,nb,k4,P4,L4;R4({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function R4(e){return Zd=kk(e),nb=Zd.format,k4=Zd.parse,P4=Zd.utcFormat,L4=Zd.utcParse,Zd}var xv=1e3,bv=xv*60,Ev=bv*60,Sv=Ev*24,O4=Sv*7,ib=Sv*30,zm=Sv*365;function D4(e){return new Date(e)}function F4(e){return e instanceof Date?+e:+new Date(+e)}function ab(e,i,r,n,t,o,u,c,p){var m=cx(Qu,Qu),b=m.invert,C=m.domain,A=p(".%L"),P=p(":%S"),O=p("%I:%M"),D=p("%I %p"),N=p("%a %d"),j=p("%b %d"),ae=p("%B"),re=p("%Y"),Te=[[u,1,xv],[u,5,5*xv],[u,15,15*xv],[u,30,30*xv],[o,1,bv],[o,5,5*bv],[o,15,15*bv],[o,30,30*bv],[t,1,Ev],[t,3,3*Ev],[t,6,6*Ev],[t,12,12*Ev],[n,1,Sv],[n,2,2*Sv],[r,1,O4],[i,1,ib],[i,3,3*ib],[e,1,zm]];function Re(gt){return(u(gt)<gt?A:o(gt)<gt?P:t(gt)<gt?O:n(gt)<gt?D:i(gt)<gt?r(gt)<gt?N:j:e(gt)<gt?ae:re)(gt)}function Ke(gt,lt,Ut,or){if(gt==null&&(gt=10),typeof gt=="number"){var cr=Math.abs(Ut-lt)/gt,Tr=$1(function(Sn){return Sn[2]}).right(Te,cr);Tr===Te.length?(or=Sm(lt/zm,Ut/zm,gt),gt=e):Tr?(Tr=Te[cr/Te[Tr-1][2]<Te[Tr][2]/cr?Tr-1:Tr],or=Tr[1],gt=Tr[0]):(or=Math.max(Sm(lt,Ut,gt),1),gt=c)}return or==null?gt:gt.every(or)}return m.invert=function(gt){return new Date(b(gt))},m.domain=function(gt){return arguments.length?C(C0.call(gt,F4)):C().map(D4)},m.ticks=function(gt,lt){var Ut=C(),or=Ut[0],cr=Ut[Ut.length-1],Tr=cr<or,Sn;return Tr&&(Sn=or,or=cr,cr=Sn),Sn=Ke(gt,or,cr,lt),Sn=Sn?Sn.range(or,cr+1):[],Tr?Sn.reverse():Sn},m.tickFormat=function(gt,lt){return lt==null?Re:p(lt)},m.nice=function(gt,lt){var Ut=C();return(gt=Ke(gt,Ut[0],Ut[Ut.length-1],lt))?C(xx(Ut,gt)):m},m.copy=function(){return A0(m,ab(e,i,r,n,t,o,u,c,p))},m}function B4(){return op.apply(ab(Nd,gk,Om,Dm,Ek,Sk,Ck,wk,nb).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function kO(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function O0(){var e=0,i=1,r,n,t,o,u=Qu,c=!1,p;function m(b){return isNaN(b=+b)?p:u(t===0?.5:(b=(o(b)-r)*t,c?Math.max(0,Math.min(1,b)):b))}return m.domain=function(b){return arguments.length?(r=o(e=+b[0]),n=o(i=+b[1]),t=r===n?0:1/(n-r),m):[e,i]},m.clamp=function(b){return arguments.length?(c=!!b,m):c},m.interpolator=function(b){return arguments.length?(u=b,m):u},m.unknown=function(b){return arguments.length?(p=b,m):p},function(b){return o=b,r=b(e),n=b(i),t=r===n?0:1/(n-r),m}}function Cv(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function ob(){var e=Bd(O0()(Qu));return e.copy=function(){return Cv(e,ob())},ix.apply(e,arguments)}function N4(){var e=loggish(O0()).domain([1,10]);return e.copy=function(){return Cv(e,N4()).base(e.base())},initInterpolator.apply(e,arguments)}function z4(){var e=symlogish(O0());return e.copy=function(){return Cv(e,z4()).constant(e.constant())},initInterpolator.apply(e,arguments)}function sb(){var e=powish(O0());return e.copy=function(){return Cv(e,sb()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function PO(){return sb.apply(null,arguments).exponent(.5)}function U4(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var t=0,o=n.length,u;t<o;++t)u=n[t],u!=null&&!isNaN(u=+u)&&e.push(u);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return U4(i).domain(e)},initInterpolator.apply(r,arguments)}function D0(){var e=0,i=.5,r=1,n,t,o,u,c,p=Qu,m,b=!1,C;function A(P){return isNaN(P=+P)?C:(P=.5+((P=+m(P))-t)*(P<t?u:c),p(b?Math.max(0,Math.min(1,P)):P))}return A.domain=function(P){return arguments.length?(n=m(e=+P[0]),t=m(i=+P[1]),o=m(r=+P[2]),u=n===t?0:.5/(t-n),c=t===o?0:.5/(o-t),A):[e,i,r]},A.clamp=function(P){return arguments.length?(b=!!P,A):b},A.interpolator=function(P){return arguments.length?(p=P,A):p},A.unknown=function(P){return arguments.length?(C=P,A):C},function(P){return m=P,n=P(e),t=P(i),o=P(r),u=n===t?0:.5/(t-n),c=t===o?0:.5/(o-t),A}}function ub(){var e=Bd(D0()(Qu));return e.copy=function(){return Cv(e,ub())},ix.apply(e,arguments)}function Z4(){var e=loggish(D0()).domain([.1,1,10]);return e.copy=function(){return copy(e,Z4()).base(e.base())},initInterpolator.apply(e,arguments)}function V4(){var e=symlogish(D0());return e.copy=function(){return copy(e,V4()).constant(e.constant())},initInterpolator.apply(e,arguments)}function lb(){var e=powish(D0());return e.copy=function(){return copy(e,lb()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function LO(){return lb.apply(null,arguments).exponent(.5)}var oc,cb,fb,j4=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,G4=(oc={},(0,T.Z)(oc,oo.LINEAR,yx),(0,T.Z)(oc,oo.POWER,km),(0,T.Z)(oc,oo.LOG,Cx),(0,T.Z)(oc,oo.IDENTITY,_x),(0,T.Z)(oc,oo.SEQUENTIAL,ob),(0,T.Z)(oc,oo.TIME,B4),(0,T.Z)(oc,oo.QUANTILE,Ix),(0,T.Z)(oc,oo.QUANTIZE,kx),(0,T.Z)(oc,oo.THRESHOLD,Px),(0,T.Z)(oc,oo.CAT,w0),(0,T.Z)(oc,oo.DIVERGING,ub),oc),H4=(cb=(0,Jr.b2)(),cb(fb=function(){function e(){(0,vt.Z)(this,e),(0,T.Z)(this,"scaleOptions",{})}return(0,yt.Z)(e,[{key:"getSourceData",value:function(r,n){var t=r.getSource();t.inited?n(t.data):t.once("update",function(){n(t.data)})}},{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){t.scaleOptions=r.getScaleOptions();var u=o.getLayerStyleAttributes();t.getSourceData(r,function(c){var p=c.dataArray;Array.isArray(p)&&p.length===0||t.caculateScalesForAttributes(u||[],p)})}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){t.scaleOptions=r.getScaleOptions();var u=o.getLayerStyleAttributes();return t.getSourceData(r,function(c){var p=c.dataArray;Array.isArray(p)&&p.length===0||(t.caculateScalesForAttributes(u||[],p),r.layerModelNeedUpdate=!0)}),!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){var u=r.getLayerConfig(),c=u.usage;if(!(r.layerModelNeedUpdate||c==="basemap")){t.scaleOptions=r.getScaleOptions();var p=o.getLayerStyleAttributes();p&&t.getSourceData(r,function(m){var b=m.dataArray;if(b.length!==0){var C=p.filter(function(A){return A.needRescale});C.length&&t.caculateScalesForAttributes(C,b)}})}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var t=this;r.forEach(function(o){if(o.scale){var u=o.scale;u.names=t.parseFields(o.scale.field||[]);var c=[];u.names.forEach(function(p){var m;c.push(t.createScale(p,o.name,(m=o.scale)===null||m===void 0?void 0:m.values,n))}),c.some(function(p){return p.type===tp.VARIABLE})?(u.type=tp.VARIABLE,c.forEach(function(p){var m;if(!u.callback&&u.values!=="text")switch((m=p.option)===null||m===void 0?void 0:m.type){case oo.LOG:case oo.LINEAR:case oo.POWER:if(u.values&&u.values.length>2){var b=p.scale.ticks(u.values.length);p.scale.domain(b)}u.values?p.scale.range(u.values):p.scale.range(p.option.domain);break;case oo.QUANTILE:case oo.QUANTIZE:case oo.THRESHOLD:p.scale.range(u.values);break;case oo.CAT:u.values?p.scale.range(u.values):p.scale.range(p.option.domain);break;case oo.DIVERGING:case oo.SEQUENTIAL:p.scale.interpolator(N3.hD(u.values));break}if(u.values==="text"){var C;p.scale.range((C=p.option)===null||C===void 0?void 0:C.domain)}})):(u.type=tp.CONSTANT,u.defaultValues=c.map(function(p,m){return p.scale(u.names[m])})),u.scalers=c.map(function(p){return{field:p.field,func:p.scale,option:p.option}}),o.needRescale=!1}})}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:(0,Er.isString)(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,t,o){var u,c,p=this.scaleOptions[n]&&((u=this.scaleOptions[n])===null||u===void 0?void 0:u.field)===r?this.scaleOptions[n]:this.scaleOptions[r],m={field:r,scale:void 0,type:tp.VARIABLE,option:p};if(!o||!o.length)return p&&p.type?m.scale=this.createDefaultScale(p):(m.scale=w0([r]),m.type=tp.CONSTANT),m;var b=(c=o.find(function(P){return!(0,Er.isNil)(P[r])}))===null||c===void 0?void 0:c[r];if(this.isNumber(r)||(0,Er.isNil)(b)&&!p)m.scale=w0([r]),m.type=tp.CONSTANT;else{var C=p&&p.type||this.getDefaultType(b);t==="text"&&(C=oo.CAT);var A=this.createScaleConfig(C,r,p,o);m.scale=this.createDefaultScale(A),m.option=A}return m}},{key:"getDefaultType",value:function(r){var n=oo.LINEAR;return typeof r=="string"&&(n=j4.test(r)?oo.TIME:oo.CAT),n}},{key:"createScaleConfig",value:function(r,n,t,o){var u={type:r},c=(o==null?void 0:o.map(function(b){return b[n]}))||[];if(t!=null&&t.domain)u.domain=t==null?void 0:t.domain;else if(r!==oo.CAT&&r!==oo.QUANTILE&&r!==oo.DIVERGING)u.domain=K1(c);else if(r===oo.CAT)u.domain=(0,Er.uniq)(c);else if(r===oo.QUANTILE)u.domain=c;else if(r===oo.DIVERGING){var p=K1(c),m=(t==null?void 0:t.neutral)!==void 0?t==null?void 0:t.neutral:(p[0]+p[1])/2;u.domain=[p[0],m,p[1]]}return(0,oe.Z)((0,oe.Z)({},u),t)}},{key:"createDefaultScale",value:function(r){var n=r.type,t=r.domain,o=r.unknown,u=r.clamp,c=r.nice,p=G4[n]();return t&&p.domain&&p.domain(t),o&&p.unknown(o),u!==void 0&&p.clamp&&p.clamp(u),c!==void 0&&p.nice&&p.nice(c),p}}]),e}())||fb),hb,pb,W4=(hb=(0,Jr.b2)(),hb(pb=function(){function e(){(0,vt.Z)(this,e)}return(0,yt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=r.animateStatus;n&&r.models.forEach(function(t){t.addUniforms((0,oe.Z)({},r.layerModel.getAnimateUniforms()))})})}}]),e}())||pb),db,vb,X4=(db=(0,Jr.b2)(),db(vb=function(){function e(){(0,vt.Z)(this,e)}return(0,yt.Z)(e,[{key:"initLayerModel",value:function(r){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}},{key:"prepareLayerModel",value:function(r){var n;r.prepareBuildModel(),(n=r.layerModel)===null||n===void 0||n.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1}},{key:"apply",value:function(r){var n=this;r.hooks.init.tap("LayerModelPlugin",function(){r.inited=!0,r.modelLoaded=!1;var t=r.getSource();t.inited&&n.initLayerModel(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var t=r.getSource();return r.modelLoaded=!1,t.inited?n.prepareLayerModel(r):t.once("update",function(){n.prepareLayerModel(r)}),!1})}}]),e}())||vb),mb,gb,Y4=(mb=(0,Jr.b2)(),mb(gb=function(){function e(){(0,vt.Z)(this,e)}return(0,yt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),t=n.autoFit,o=n.fitBoundsOptions;t&&setTimeout(function(){r.fitBounds(o)},100)})}}]),e}())||gb),yb,_b,$4=["type"],xb={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},q4={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},K4={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},Q4={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function J4(e){var i={u_DirectionalLights:new Array(3).fill((0,oe.Z)({},K4)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,oe.Z)({},Q4)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[q4]),e.forEach(function(r){var n=r.type,t=n===void 0?"directional":n,o=(0,sf.Z)(r,$4),u=xb[t].lights,c=xb[t].num,p=i[c];i[u][p]=(0,oe.Z)((0,oe.Z)({},i[u][p]),o),i[c]++}),i}var eP=(yb=(0,Jr.b2)(),yb(_b=function(){function e(){(0,vt.Z)(this,e)}return(0,yt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),t=n.enableLighting;t&&r.models.forEach(function(o){return o.addUniforms((0,oe.Z)({},J4()))})})}}]),e}())||_b),bb,Eb,tP=(bb=(0,Jr.b2)(),bb(Eb=function(){function e(){(0,vt.Z)(this,e)}return(0,yt.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.rendererService,u=n.postProcessingPassFactory,c=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var p=r.getLayerConfig(),m=p.enableMultiPassRenderer,b=p.passes,C=b===void 0?[]:b;t.enabled=!!m&&r.getLayerConfig().enableMultiPassRenderer!==!1,t.enabled&&(r.multiPassRenderer=m_(r,C,u,c),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(t.enabled){var p=o.getViewportSize(),m=p.width,b=p.height;r.multiPassRenderer.resize(m,b)}})}}]),e}())||Eb),Sb,Cb,F0={NONE:0,ENCODE:1,HIGHLIGHT:2},rP=(Sb=(0,Jr.b2)(),Sb(Cb=function(){function e(){(0,vt.Z)(this,e)}return(0,yt.Z)(e,[{key:"apply",value:function(r,n){var t=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;t.registerStyleAttribute({name:"pickingColor",type:gn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:H.FLOAT},size:3,update:function(p){var m=p.id;return u?S(m):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;u&&r.isVisible()&&r.models.forEach(function(c){return c.addUniforms({u_PickingStage:F0.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;u&&r.isVisible()&&r.models.forEach(function(c){return c.addUniforms({u_PickingStage:F0.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(o){var u=r.getLayerConfig(),c=u.highlightColor,p=u.activeMix,m=p===void 0?0:p,b=typeof c=="string"?h(c):c||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:g(new Uint8Array(o))}),r.models.forEach(function(C){return C.addUniforms({u_PickingStage:F0.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:b.map(function(A){return A*255}),u_activeMix:m})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(o){var u=r.getLayerConfig(),c=u.selectColor,p=u.selectMix,m=p===void 0?0:p,b=typeof c=="string"?h(c):c||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:g(new Uint8Array(o))}),r.models.forEach(function(C){return C.addUniforms({u_PickingStage:F0.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:b.map(function(A){return A*255}),u_activeMix:m,u_CurrentSelectedId:o,u_SelectColor:b.map(function(A){return A*255}),u_EnableSelect:1})})})}}]),e}())||Cb),wb,Ab,nP=(wb=(0,Jr.b2)(),wb(Ab=function(){function e(){(0,vt.Z)(this,e)}return(0,yt.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){yA(r)||t.registerBuiltinAttributes(o,r)})}},{key:"registerBuiltinAttributes",value:function(r,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(r);return}var t=n.getLayerConfig(),o=t.usage;if(o==="basemap"){this.registerPositionAttribute(r);return}if(n.isTileLayer){this.registerPositionAttribute(r),this.registerColorAttribute(r);return}this.registerPositionAttribute(r),this.registerFilterAttribute(r),this.registerColorAttribute(r),this.registerVertexIdAttribute(r)}},{key:"registerPositionAttribute",value:function(r){r.registerStyleAttribute({name:"position",type:gn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:H.FLOAT},size:3,update:function(t,o,u){return u.length===2?[u[0],u[1],0]:[u[0],u[1],u[2]]}}})}},{key:"registerFilterAttribute",value:function(r){r.registerStyleAttribute({name:"filter",type:gn.Attribute,descriptor:{name:"filter",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(t){var o=t.filter;return o?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(r){r.registerStyleAttribute({name:"color",type:gn.Attribute,descriptor:{name:"a_Color",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:4,update:function(t){var o=t.color;return!o||!o.length?[1,1,1,1]:o}}})}},{key:"registerVertexIdAttribute",value:function(r){r.registerStyleAttribute({name:"vertexId",type:gn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(t,o){return[o]}}})}}]),e}())||Ab),Tb,Mb,Ib,kb,Pb,Lb,Vd,Rb,Ob,Db,Fb,iP=(Tb=(0,Jr.b2)(),Mb=(0,Jr.f3)(Ft.ICameraService),Ib=(0,Jr.f3)(Ft.ICoordinateSystemService),kb=(0,Jr.f3)(Ft.IRendererService),Pb=(0,Jr.f3)(Ft.IMapService),Tb(Lb=(Vd=function(){function e(){(0,vt.Z)(this,e),na(this,"cameraService",Rb,this),na(this,"coordinateSystemService",Ob,this),na(this,"rendererService",Db,this),na(this,"mapService",Fb,this)}return(0,yt.Z)(e,[{key:"apply",value:function(r){var n=this,t=this.mapService.version,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var c=r.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(c),t==="GAODE2.x"&&(n.setLayerCenter(r),o=n.mapService.map.customCoords.getMVPMatrix(),u=n.mapService.getCustomCoordCenter());var p=n.rendererService.getViewportSize(),m=p.width,b=p.height;r.models.forEach(function(C){var A;C.addUniforms((A={},(0,T.Z)(A,Yp.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,T.Z)(A,Yp.ViewMatrix,n.cameraService.getViewMatrix()),(0,T.Z)(A,Yp.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,T.Z)(A,Yp.Zoom,n.cameraService.getZoom()),(0,T.Z)(A,Yp.ZoomScale,n.cameraService.getZoomScale()),(0,T.Z)(A,Yp.FocalDistance,n.cameraService.getFocalDistance()),(0,T.Z)(A,Yp.CameraPosition,n.cameraService.getCameraPosition()),(0,T.Z)(A,Hp.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,T.Z)(A,Hp.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,T.Z)(A,Hp.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,T.Z)(A,Hp.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,T.Z)(A,Hp.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,T.Z)(A,Hp.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,T.Z)(A,Hp.Mvp,o),(0,T.Z)(A,"u_SceneCenterMKT",u),(0,T.Z)(A,"u_ViewportSize",[m,b]),(0,T.Z)(A,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,T.Z)(A,"u_DevicePixelRatio",ha.devicePixelRatio),(0,T.Z)(A,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,T.Z)(A,"u_shaderPick",Number(r.getShaderPickStat())),A))})})}},{key:"setLayerCenter",value:function(r){r.coordCenter===void 0&&(r.coordCenter=r.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(r.coordCenter)}}]),e}(),Rb=ta(Vd.prototype,"cameraService",[Mb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ob=ta(Vd.prototype,"coordinateSystemService",[Ib],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Db=ta(Vd.prototype,"rendererService",[kb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fb=ta(Vd.prototype,"mapService",[Pb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vd))||Lb),Bb,Nb,aP=(Bb=(0,Jr.b2)(),Bb(Nb=function(){function e(){(0,vt.Z)(this,e)}return(0,yt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||Nb),zb,Ub,oP=(zb=(0,Jr.b2)(),zb(Ub=function(){function e(){(0,vt.Z)(this,e)}return(0,yt.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){t.initStyleAttribute(r,{styleAttributeService:o})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){var u=r.getLayerConfig(),c=u.usage;r.layerModelNeedUpdate||r.tileLayer||c==="basemap"||r.modelLoaded&&t.updateStyleAttribute(r,{styleAttributeService:o})})}},{key:"updateStyleAttribute",value:function(r,n){var t=n.styleAttributeService,o=t.getLayerStyleAttributes()||[],u=t.getLayerStyleAttribute("filter");if(u&&u.needRegenerateVertices){r.layerModelNeedUpdate=!0,o.forEach(function(c){return c.needRegenerateVertices=!1});return}o.filter(function(c){return c.needRegenerateVertices}).forEach(function(c){t.updateAttributeByFeatureRange(c.name,r.getEncodedData(),c.featureRange.startIndex,c.featureRange.endIndex,r),c.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var t=n.styleAttributeService,o=t.getLayerStyleAttributes()||[];o.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){t.updateAttributeByFeatureRange(u.name,r.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex),u.needRegenerateVertices=!1})}}]),e}())||Ub);ac.bind(Ft.ILayerPlugin).to(R3).inRequestScope(),ac.bind(Ft.ILayerPlugin).to(nP).inRequestScope(),ac.bind(Ft.ILayerPlugin).to(H4).inRequestScope(),ac.bind(Ft.ILayerPlugin).to(L3).inRequestScope(),ac.bind(Ft.ILayerPlugin).to(Y4).inRequestScope(),ac.bind(Ft.ILayerPlugin).to(oP).inRequestScope(),ac.bind(Ft.ILayerPlugin).to(aP).inRequestScope(),ac.bind(Ft.ILayerPlugin).to(tP).inRequestScope(),ac.bind(Ft.ILayerPlugin).to(iP).inRequestScope(),ac.bind(Ft.ILayerPlugin).to(W4).inRequestScope(),ac.bind(Ft.ILayerPlugin).to(eP).inRequestScope(),ac.bind(Ft.ILayerPlugin).to(rP).inRequestScope(),ac.bind(Ft.ILayerPlugin).to(X4).inRequestScope();var sP=fe(88307),uP=fe.n(sP),lP=function(){function e(i,r){(0,vt.Z)(this,e);var n=r.buffer,t=r.offset,o=r.stride,u=r.normalized,c=r.size,p=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:t||0,stride:o||0,normalized:u||!1,divisor:p||0},c&&(this.attribute.size=c)}return(0,yt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),yh,wv,_h,Bc,Av,sp,Tv,B0,Zf,id,Du,Vf,jf,N0,cP=(yh={},(0,T.Z)(yh,H.POINTS,"points"),(0,T.Z)(yh,H.LINES,"lines"),(0,T.Z)(yh,H.LINE_LOOP,"line loop"),(0,T.Z)(yh,H.LINE_STRIP,"line strip"),(0,T.Z)(yh,H.TRIANGLES,"triangles"),(0,T.Z)(yh,H.TRIANGLE_FAN,"triangle fan"),(0,T.Z)(yh,H.TRIANGLE_STRIP,"triangle strip"),yh),Zb=(wv={},(0,T.Z)(wv,H.STATIC_DRAW,"static"),(0,T.Z)(wv,H.DYNAMIC_DRAW,"dynamic"),(0,T.Z)(wv,H.STREAM_DRAW,"stream"),wv),Um=(_h={},(0,T.Z)(_h,H.BYTE,"int8"),(0,T.Z)(_h,H.UNSIGNED_INT,"int16"),(0,T.Z)(_h,H.INT,"int32"),(0,T.Z)(_h,H.UNSIGNED_BYTE,"uint8"),(0,T.Z)(_h,H.UNSIGNED_SHORT,"uint16"),(0,T.Z)(_h,H.UNSIGNED_INT,"uint32"),(0,T.Z)(_h,H.FLOAT,"float"),_h),fP=(Bc={},(0,T.Z)(Bc,H.ALPHA,"alpha"),(0,T.Z)(Bc,H.LUMINANCE,"luminance"),(0,T.Z)(Bc,H.LUMINANCE_ALPHA,"luminance alpha"),(0,T.Z)(Bc,H.RGB,"rgb"),(0,T.Z)(Bc,H.RGBA,"rgba"),(0,T.Z)(Bc,H.RGBA4,"rgba4"),(0,T.Z)(Bc,H.RGB5_A1,"rgb5 a1"),(0,T.Z)(Bc,H.RGB565,"rgb565"),(0,T.Z)(Bc,H.DEPTH_COMPONENT,"depth"),(0,T.Z)(Bc,H.DEPTH_STENCIL,"depth stencil"),Bc),hP=(Av={},(0,T.Z)(Av,H.DONT_CARE,"dont care"),(0,T.Z)(Av,H.NICEST,"nice"),(0,T.Z)(Av,H.FASTEST,"fast"),Av),Vb=(sp={},(0,T.Z)(sp,H.NEAREST,"nearest"),(0,T.Z)(sp,H.LINEAR,"linear"),(0,T.Z)(sp,H.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,T.Z)(sp,H.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,T.Z)(sp,H.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,T.Z)(sp,H.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),sp),jb=(Tv={},(0,T.Z)(Tv,H.REPEAT,"repeat"),(0,T.Z)(Tv,H.CLAMP_TO_EDGE,"clamp"),(0,T.Z)(Tv,H.MIRRORED_REPEAT,"mirror"),Tv),pP=(B0={},(0,T.Z)(B0,H.NONE,"none"),(0,T.Z)(B0,H.BROWSER_DEFAULT_WEBGL,"browser"),B0),dP=(Zf={},(0,T.Z)(Zf,H.NEVER,"never"),(0,T.Z)(Zf,H.ALWAYS,"always"),(0,T.Z)(Zf,H.LESS,"less"),(0,T.Z)(Zf,H.LEQUAL,"lequal"),(0,T.Z)(Zf,H.GREATER,"greater"),(0,T.Z)(Zf,H.GEQUAL,"gequal"),(0,T.Z)(Zf,H.EQUAL,"equal"),(0,T.Z)(Zf,H.NOTEQUAL,"notequal"),Zf),Gb=(id={},(0,T.Z)(id,H.FUNC_ADD,"add"),(0,T.Z)(id,H.MIN_EXT,"min"),(0,T.Z)(id,H.MAX_EXT,"max"),(0,T.Z)(id,H.FUNC_SUBTRACT,"subtract"),(0,T.Z)(id,H.FUNC_REVERSE_SUBTRACT,"reverse subtract"),id),z0=(Du={},(0,T.Z)(Du,H.ZERO,"zero"),(0,T.Z)(Du,H.ONE,"one"),(0,T.Z)(Du,H.SRC_COLOR,"src color"),(0,T.Z)(Du,H.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,T.Z)(Du,H.SRC_ALPHA,"src alpha"),(0,T.Z)(Du,H.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,T.Z)(Du,H.DST_COLOR,"dst color"),(0,T.Z)(Du,H.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,T.Z)(Du,H.DST_ALPHA,"dst alpha"),(0,T.Z)(Du,H.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,T.Z)(Du,H.CONSTANT_COLOR,"constant color"),(0,T.Z)(Du,H.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,T.Z)(Du,H.CONSTANT_ALPHA,"constant alpha"),(0,T.Z)(Du,H.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,T.Z)(Du,H.SRC_ALPHA_SATURATE,"src alpha saturate"),Du),vP=(Vf={},(0,T.Z)(Vf,H.NEVER,"never"),(0,T.Z)(Vf,H.ALWAYS,"always"),(0,T.Z)(Vf,H.LESS,"less"),(0,T.Z)(Vf,H.LEQUAL,"lequal"),(0,T.Z)(Vf,H.GREATER,"greater"),(0,T.Z)(Vf,H.GEQUAL,"gequal"),(0,T.Z)(Vf,H.EQUAL,"equal"),(0,T.Z)(Vf,H.NOTEQUAL,"notequal"),Vf),jd=(jf={},(0,T.Z)(jf,H.ZERO,"zero"),(0,T.Z)(jf,H.KEEP,"keep"),(0,T.Z)(jf,H.REPLACE,"replace"),(0,T.Z)(jf,H.INVERT,"invert"),(0,T.Z)(jf,H.INCR,"increment"),(0,T.Z)(jf,H.DECR,"decrement"),(0,T.Z)(jf,H.INCR_WRAP,"increment wrap"),(0,T.Z)(jf,H.DECR_WRAP,"decrement wrap"),jf),mP=(N0={},(0,T.Z)(N0,H.FRONT,"front"),(0,T.Z)(N0,H.BACK,"back"),N0),gP=function(){function e(i,r){(0,vt.Z)(this,e);var n=r.data,t=r.usage,o=r.type;this.buffer=i.buffer({data:n,usage:Zb[t||H.STATIC_DRAW],type:Um[o||H.UNSIGNED_BYTE]})}return(0,yt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,t=r.offset;this.buffer.subdata(n,t)}}]),e}(),yP=function(){function e(i,r){(0,vt.Z)(this,e);var n=r.data,t=r.usage,o=r.type,u=r.count;this.elements=i.elements({data:n,usage:Zb[t||H.STATIC_DRAW],type:Um[o||H.UNSIGNED_BYTE],count:u})}return(0,yt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),_P=function(){function e(i,r){(0,vt.Z)(this,e);var n=r.width,t=r.height,o=r.color,u=r.colors,c={width:n,height:t};Array.isArray(u)&&(c.colors=u.map(function(p){return p.get()})),o&&typeof o!="boolean"&&(c.color=o.get()),this.framebuffer=i.framebuffer(c)}return(0,yt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,t=r.height;this.framebuffer.resize(n,t)}}]),e}(),xP=function(){function e(i,r){(0,vt.Z)(this,e),(0,T.Z)(this,"destroyed",!1),(0,T.Z)(this,"uniforms",{}),this.reGl=i;var n=r.pick,t=n===void 0?!0:n,o=r.vs,u=r.fs,c=r.attributes,p=r.uniforms,m=r.primitive,b=r.count,C=r.elements,A=r.depth,P=r.blend,O=r.stencil,D=r.cull,N=r.instances,j={};this.options=r,p&&(this.uniforms=this.extractUniforms(p),Object.keys(p).forEach(function(Re){j[Re]=i.prop(Re)}));var ae={};Object.keys(c).forEach(function(Re){ae[Re]=c[Re].get()});var re={attributes:ae,frag:u,uniforms:j,vert:o,blend:{},primitive:cP[m===void 0?H.TRIANGLES:m]};if(N&&(re.instances=N),b?re.count=b:C&&(re.elements=C.get()),this.initDepthDrawParams({depth:A},re),this.initBlendDrawParams({blend:P},re),this.initStencilDrawParams({stencil:O},re),this.initCullDrawParams({cull:D},re),this.drawCommand=i(re),t){var Te=(0,Er.cloneDeep)(re);Te.blend=(0,oe.Z)((0,oe.Z)({},Te.blend),{},{enable:!1}),this.drawPickCommand=i(Te)}this.drawParams=re}return(0,yt.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var t={};if(Object.keys(r).forEach(function(u){t[u]=r[u].get()}),this.drawParams.attributes=t,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams),this.options.pick){var o=(0,Er.cloneDeep)(this.drawParams);o.blend=(0,oe.Z)((0,oe.Z)({},o.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(o)}}},{key:"updateAttributes",value:function(r){var n={};if(Object.keys(r).forEach(function(o){n[o]=r[o].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams),this.options.pick){var t=(0,Er.cloneDeep)(this.drawParams);t.blend=(0,oe.Z)((0,oe.Z)({},t.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(t)}}},{key:"addUniforms",value:function(r){this.uniforms=(0,oe.Z)((0,oe.Z)({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var t=(0,oe.Z)((0,oe.Z)({},this.uniforms),this.extractUniforms(r.uniforms||{})),o={};Object.keys(t).forEach(function(u){var c=(0,ke.Z)(t[u]);c==="boolean"||c==="number"||Array.isArray(t[u])||t[u].BYTES_PER_ELEMENT?o[u]=t[u]:o[u]=t[u].get()}),n?this.drawPickCommand&&this.drawPickCommand(o):this.drawCommand(o)}}},{key:"destroy",value:function(){var r,n;(r=this.drawParams)===null||r===void 0||(n=r.elements)===null||n===void 0||n.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){t==null||t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var t=r.depth;t&&(n.depth={enable:t.enable===void 0?!0:!!t.enable,mask:t.mask===void 0?!0:!!t.mask,func:dP[t.func||H.LESS],range:t.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var t=r.blend;if(t){var o=t.enable,u=t.func,c=t.equation,p=t.color,m=p===void 0?[0,0,0,0]:p;n.blend={enable:!!o,func:{srcRGB:z0[u&&u.srcRGB||H.SRC_ALPHA],srcAlpha:z0[u&&u.srcAlpha||H.SRC_ALPHA],dstRGB:z0[u&&u.dstRGB||H.ONE_MINUS_SRC_ALPHA],dstAlpha:z0[u&&u.dstAlpha||H.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Gb[c&&c.rgb||H.FUNC_ADD],alpha:Gb[c&&c.alpha||H.FUNC_ADD]},color:m}}}},{key:"initStencilDrawParams",value:function(r,n){var t=r.stencil;if(t){var o=t.enable,u=t.mask,c=u===void 0?-1:u,p=t.func,m=p===void 0?{cmp:H.ALWAYS,ref:0,mask:-1}:p,b=t.opFront,C=b===void 0?{fail:H.KEEP,zfail:H.KEEP,zpass:H.KEEP}:b,A=t.opBack,P=A===void 0?{fail:H.KEEP,zfail:H.KEEP,zpass:H.KEEP}:A;n.stencil={enable:!!o,mask:c,func:(0,oe.Z)((0,oe.Z)({},m),{},{cmp:vP[m.cmp]}),opFront:{fail:jd[C.fail],zfail:jd[C.zfail],zpass:jd[C.zpass]},opBack:{fail:jd[P.fail],zfail:jd[P.zfail],zpass:jd[P.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var t=r.cull;if(t){var o=t.enable,u=t.face,c=u===void 0?H.BACK:u;n.cull={enable:!!o,face:mP[c]}}}},{key:"extractUniforms",value:function(r){var n=this,t={};return Object.keys(r).forEach(function(o){n.extractUniformsRecursively(o,r[o],t,"")}),t}},{key:"extractUniformsRecursively",value:function(r,n,t,o){var u=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||(0,Er.isTypedArray)(n)||n===""||"resize"in n){t["".concat(o&&o+".").concat(r)]=n;return}(0,Er.isPlainObject)(n)&&Object.keys(n).forEach(function(c){u.extractUniformsRecursively(c,n[c],t,"".concat(o&&o+".").concat(r))}),Array.isArray(n)&&n.forEach(function(c,p){Object.keys(c).forEach(function(m){u.extractUniformsRecursively(m,c[m],t,"".concat(o&&o+".").concat(r,"[").concat(p,"]"))})})}}]),e}(),bP=function(){function e(i,r){(0,vt.Z)(this,e),(0,T.Z)(this,"isDistroy",!1);var n=r.data,t=r.type,o=t===void 0?H.UNSIGNED_BYTE:t,u=r.width,c=r.height,p=r.flipY,m=p===void 0?!1:p,b=r.format,C=b===void 0?H.RGBA:b,A=r.mipmap,P=A===void 0?!1:A,O=r.wrapS,D=O===void 0?H.CLAMP_TO_EDGE:O,N=r.wrapT,j=N===void 0?H.CLAMP_TO_EDGE:N,ae=r.aniso,re=ae===void 0?0:ae,Te=r.alignment,Re=Te===void 0?1:Te,Ke=r.premultiplyAlpha,gt=Ke===void 0?!1:Ke,lt=r.mag,Ut=lt===void 0?H.NEAREST:lt,or=r.min,cr=or===void 0?H.NEAREST:or,Tr=r.colorSpace,Sn=Tr===void 0?H.BROWSER_DEFAULT_WEBGL:Tr,Un=r.x,Vi=Un===void 0?0:Un,Ba=r.y,ho=Ba===void 0?0:Ba,Ao=r.copy,Wo=Ao===void 0?!1:Ao;this.width=u,this.height=c;var Ju={width:u,height:c,type:Um[o],format:fP[C],wrapS:jb[D],wrapT:jb[j],mag:Vb[Ut],min:Vb[cr],alignment:Re,flipY:m,colorSpace:pP[Sn],premultiplyAlpha:gt,aniso:re,x:Vi,y:ho,copy:Wo};n&&(Ju.data=n),typeof P=="number"?Ju.mipmap=hP[P]:typeof P=="boolean"&&(Ju.mipmap=P),this.texture=i.texture(Ju)}return(0,yt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,t=r.height;this.texture.resize(n,t),this.width=n,this.height=t}},{key:"destroy",value:function(){if(!this.isDistroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDistroy=!0}}]),e}(),Hb,Wb,EP=(Hb=(0,Jr.b2)(),Hb(Wb=function(){function e(){var i=this;(0,vt.Z)(this,e),(0,T.Z)(this,"createModel",function(r){return new xP(i.gl,r)}),(0,T.Z)(this,"createAttribute",function(r){return new lP(i.gl,r)}),(0,T.Z)(this,"createBuffer",function(r){return new gP(i.gl,r)}),(0,T.Z)(this,"createElements",function(r){return new yP(i.gl,r)}),(0,T.Z)(this,"createTexture2D",function(r){return new bP(i.gl,r)}),(0,T.Z)(this,"createFramebuffer",function(r){return new _P(i.gl,r)}),(0,T.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,T.Z)(this,"clear",function(r){var n,t=r.color,o=r.depth,u=r.stencil,c=r.framebuffer,p=c===void 0?null:c,m={color:t,depth:o,stencil:u};m.framebuffer=p===null?p:p.get(),(n=i.gl)===null||n===void 0||n.clear(m)}),(0,T.Z)(this,"viewport",function(r){var n=r.x,t=r.y,o=r.width,u=r.height;i.gl._gl.viewport(n,t,o,u),i.width=o,i.height=u,i.gl._refresh()}),(0,T.Z)(this,"readPixels",function(r){var n=r.framebuffer,t=r.x,o=r.y,u=r.width,c=r.height,p={x:t,y:o,width:u,height:c};return n&&(p.framebuffer=n.get()),i.gl.read(p)}),(0,T.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,T.Z)(this,"getContainer",function(){if(as)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,T.Z)(this,"getCanvas",function(){return i.canvas}),(0,T.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,T.Z)(this,"destroy",function(){var r,n,t;i.canvas=null,(r=i.gl)===null||r===void 0||(n=r._gl)===null||n===void 0||(t=n.getExtension("WEBGL_lose_context"))===null||t===void 0||t.loseContext(),i.gl.destroy(),i.gl=null})}return(0,yt.Z)(e,[{key:"init",value:function(){var i=(0,ue.Z)(te().mark(function n(t,o,u){var c=this;return te().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(this.canvas=t,!u){m.next=5;break}this.gl=u,m.next=8;break;case 5:return m.next=7,new Promise(function(b,C){uP()({canvas:c.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(P,O){(P||!O)&&C(P),b(O)}})});case 7:this.gl=m.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return m.stop()}},n,this)}));function r(n,t,o){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Wb),Zm=function(){function e(i){(0,vt.Z)(this,e);var r=i.id,n=i.map,t=i.canvas,o=i.hasBaseMap,u=eC();this.container=u,n.setContainer(u,r,t,o),u.bind(Ft.IRendererService).to(EP).inSingletonScope(),this.sceneService=u.get(Ft.ISceneService),this.mapService=u.get(Ft.IMapService),this.iconService=u.get(Ft.IIconService),this.fontService=u.get(Ft.IFontService),this.controlService=u.get(Ft.IControlService),this.layerService=u.get(Ft.ILayerService),this.markerService=u.get(Ft.IMarkerService),this.interactionService=u.get(Ft.IInteractionService),this.popupService=u.get(Ft.IPopupService),as?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,yt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var t=new r(this);t.init()}else this.on("loaded",function(){var o=new r(n);o.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=this,t=im(this.container);if(r.setContainer(t,this.container),this.sceneService.addLayer(r),r.inited){var o=this.initMask(r);this.addMask(o,r.id)}else r.on("inited",function(){var u=n.initMask(r);n.addMask(u,r.id)})}},{key:"initMask",value:function(r){var n=r.getLayerConfig(),t=n.mask,o=n.maskfence,u=n.maskColor,c=u===void 0?"#000":u,p=n.maskOpacity,m=p===void 0?0:p;if(!!t){var b=new P3().source(o).shape("fill").style({color:c,opacity:m});return b}}},{key:"addMask",value:function(r,n){if(!!r){var t=this.getLayer(n);if(t){var o=im(this.container);r.setContainer(o,this.container),t.addMaskLayer(r),this.sceneService.addLayer(r)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(t){var o=(0,ce.Z)(t,2),u=o[0],c=o[1];n.fontService.addIconFont(u,c)})}},{key:"addFontFace",value:function(r,n){var t=this;this.fontService.once("fontloaded",function(o){t.emit("fontloaded",o)}),this.fontService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){as?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){s0.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){s0.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"emit",value:function(r,n){s0.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.emit(r,n)}},{key:"off",value:function(r,n){s0.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var t=this.sceneService.getSceneConfig(),o=t.fitBoundsOptions,u=t.animate;this.mapService.fitBounds(r,n||(0,oe.Z)((0,oe.Z)({},o),{},{animate:u}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(Ft.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:qi(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,t=r.logoPosition;n&&this.addControl(new f_({position:t}))}}]),e}(),RO="2.9.37",Xb,Vm,Yb,$b=(Xb=nm(Ft.IGlobalConfigService),Vm=function(){function e(i){(0,vt.Z)(this,e),na(this,"configService",Yb,this),this.config=i}return(0,yt.Z)(e,[{key:"setContainer",value:function(r,n,t,o){r.bind(Ft.MapConfig).toConstantValue((0,oe.Z)((0,oe.Z)({},this.config),{},{id:n,canvas:t,hasBaseMap:o})),r.bind(Ft.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),Yb=ta(Vm.prototype,"configService",[Xb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vm),SP=fe(81618),qb=fe.n(SP),Kb=Math.PI/180,CP=function(){function e(){(0,vt.Z)(this,e),(0,T.Z)(this,"projectionMatrix",Ho()),(0,T.Z)(this,"viewMatrix",Ho()),(0,T.Z)(this,"viewProjectionMatrix",Ho()),(0,T.Z)(this,"ViewProjectionMatrixUncentered",Ho()),(0,T.Z)(this,"viewUncenteredMatrix",Ho())}return(0,yt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.zoom,t=n===void 0?1:n,o=r.pitch,u=o===void 0?0:o,c=r.bearing,p=c===void 0?0:c,m=r.center,b=m===void 0?[0,0]:m,C=r.offsetOrigin,A=C===void 0?[0,0]:C,P=r.cameraHeight,O=P===void 0?1:P,D=r.aspect,N=D===void 0?1:D,j=r.near,ae=j===void 0?.1:j,re=r.far,Te=re===void 0?1e3:re,Re=r.fov,Ke=Re===void 0?0:Re;this.zoom=t,this.center=b;var gt=u*Kb,lt=(360-p)*Kb;wd(this.projectionMatrix,Ke,N,ae,Te);var Ut=_a.fromValues(O*Math.sin(gt)*Math.sin(lt),-O*Math.sin(gt)*Math.cos(lt),O*Math.cos(gt)),or=_a.fromValues(-Math.cos(gt)*Math.sin(lt),Math.cos(gt)*Math.cos(lt),Math.sin(gt));Ad(this.viewMatrix,Ut,_a.fromValues(0,0,0),or),this.viewUncenteredMatrix=Nv(this.viewMatrix),kc(this.viewMatrix,this.viewMatrix,_a.fromValues(-A[0],A[1],0)),Lu(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),Lu(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var r=(0,ce.Z)(this.center,2),n=r[0],t=r[1];return[n,t]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r){var n=85.0511287798,t=Math.max(Math.min(n,r[1]),-n),o=256<<20,u=Math.PI/180,c=r[0]*u,p=t*u;p=Math.log(Math.tan(Math.PI/4+p/2));var m=.5/Math.PI,b=.5,C=-.5/Math.PI;return u=.5,c=o*(m*c+b)-215440491,p=-(o*(C*p+u)-106744817),[c,p]}}]),e}(),Qb=function(){function e(i){(0,vt.Z)(this,e),(0,T.Z)(this,"size",1e4),this.size=i||1e4}return(0,yt.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),t=this.mercatorYfromLat(r[1]);return[n,t]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),t=this.latFromMercatorY(r[1]);return[n,t]}}]),e}();function Jb(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i={top:0,right:0,bottom:0,left:0};if(typeof e=="number")return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(e.length===4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(e.length===2)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return Object.assign({},i,e)}function Mv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function U0(e,i){var r=$0([],i,e);return Y2(r,r,1/r[3]),r}function OO(e,i){var r=e%i;return r<0?i+r:r}function DO(e,i,r){return r*i+(1-r)*e}function ad(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var lf=Math.PI,e2=lf/4,xh=lf/180,t2=180/lf,jm=512,Gm=4003e4,wP=1.5;function r2(e){return Math.pow(2,e)}function AP(e){return Math.log2(e)}function Z0(e,i){var r=(0,ce.Z)(e,2),n=r[0],t=r[1];ad(Number.isFinite(n)&&Number.isFinite(i)),ad(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude"),i*=jm;var o=n*xh,u=t*xh,c=i*(o+lf)/(2*lf),p=i*(lf-Math.log(Math.tan(e2+u*.5)))/(2*lf);return[c,p]}function Hm(e,i){var r=(0,ce.Z)(e,2),n=r[0],t=r[1];i*=jm;var o=n/i*(2*lf)-lf,u=2*(Math.atan(Math.exp(lf-t/i*(2*lf)))-e2);return[o*t2,u*t2]}function FO(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*xh);return AP(Gm*r)-9}function n2(e){var i=e.latitude,r=e.longitude,n=e.zoom,t=e.scale,o=e.highPrecision,u=o===void 0?!1:o;t=t!==void 0?t:r2(n),ad(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(t));var c={},p=jm*t,m=Math.cos(i*xh),b=p/360,C=b/m,A=p/Gm/m;if(c.pixelsPerMeter=[A,-A,A],c.metersPerPixel=[1/A,-1/A,1/A],c.pixelsPerDegree=[b,-C,A],c.degreesPerPixel=[1/b,-1/C,1/A],u){var P=xh*Math.tan(i*xh)/m,O=b*P/2,D=p/Gm*P,N=D/C*A;c.pixelsPerDegree2=[0,-O,D],c.pixelsPerMeter2=[N,0,N]}return c}function BO(e,i){var r=_slicedToArray(e,3),n=r[0],t=r[1],o=r[2],u=_slicedToArray(i,3),c=u[0],p=u[1],m=u[2],b=1,C=n2({longitude:n,latitude:t,scale:b,highPrecision:!0}),A=C.pixelsPerMeter,P=C.pixelsPerMeter2,O=Z0(e,b);O[0]+=c*(A[0]+P[0]*p),O[1]+=p*(A[1]+P[1]*p);var D=Hm(O,b),N=(o||0)+(m||0);return Number.isFinite(o)||Number.isFinite(m)?[D[0],D[1],N]:D}function TP(e){var i=e.height,r=e.pitch,n=e.bearing,t=e.altitude,o=e.center,u=o===void 0?null:o,c=e.flipY,p=c===void 0?!1:c,m=Mv();return kc(m,m,[0,0,-t]),zf(m,m,[1,1,1/i]),dh(m,m,-r*xh),$h(m,m,n*xh),p&&zf(m,m,[1,-1,1]),u&&kc(m,m,_a.negate([],u)),m}function MP(e){var i=e.width,r=e.height,n=e.altitude,t=n===void 0?wP:n,o=e.pitch,u=o===void 0?0:o,c=e.nearZMultiplier,p=c===void 0?1:c,m=e.farZMultiplier,b=m===void 0?1:m,C=u*xh,A=Math.atan(.5/t),P=Math.sin(A)*t/Math.sin(Math.PI/2-C-A),O=Math.cos(Math.PI/2-C)*P+t;return{fov:2*Math.atan(r/2/t),aspect:i/r,focalDistance:t,near:p,far:O*b}}function IP(e){var i=e.width,r=e.height,n=e.pitch,t=e.altitude,o=e.nearZMultiplier,u=e.farZMultiplier,c=MP({width:i,height:r,altitude:t,pitch:n,nearZMultiplier:o,farZMultiplier:u}),p=c.fov,m=c.aspect,b=c.near,C=c.far,A=wd([],p,m,b,C);return A}function kP(e,i){var r=(0,ce.Z)(e,3),n=r[0],t=r[1],o=r[2],u=o===void 0?0:o;return ad(Number.isFinite(n)&&Number.isFinite(t)&&Number.isFinite(u)),U0(i,[n,t,u,1])}function i2(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,ce.Z)(e,3),t=n[0],o=n[1],u=n[2];if(ad(Number.isFinite(t)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u)){var c=U0(i,[t,o,u,1]);return c}var p=U0(i,[t,o,0,1]),m=U0(i,[t,o,1,1]),b=p[2],C=m[2],A=b===C?0:((r||0)-b)/(C-b);return jr.lerp([],p,m,A)}var a2=Mv(),PP=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,t=i.viewMatrix,o=t===void 0?a2:t,u=i.projectionMatrix,c=u===void 0?a2:u;(0,vt.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=c;var p=Mv();Lu(p,p,this.projectionMatrix),Lu(p,p,this.viewMatrix),this.viewProjectionMatrix=p;var m=Mv();zf(m,m,[this.width/2,-this.height/2,1]),kc(m,m,[1,-1,0]),Lu(m,m,this.viewProjectionMatrix);var b=ph(Mv(),m);if(!b)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=m,this.pixelUnprojectionMatrix=b,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,yt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Jh(r.projectionMatrix,this.projectionMatrix)&&Jh(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.topLeft,o=t===void 0?!0:t,u=this.projectPosition(r),c=kP(u,this.pixelProjectionMatrix),p=(0,ce.Z)(c,2),m=p[0],b=p[1],C=o?b:this.height-b;return r.length===2?[m,C]:[m,C,c[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.topLeft,o=t===void 0?!0:t,u=n.targetZ,c=(0,ce.Z)(r,3),p=c[0],m=c[1],b=c[2],C=o?m:this.height-m,A=u&&u*this.pixelsPerMeter,P=i2([p,C,b],this.pixelUnprojectionMatrix,A),O=this.unprojectPosition(P),D=(0,ce.Z)(O,3),N=D[0],j=D[1],ae=D[2];return Number.isFinite(b)?[N,j,ae]:Number.isFinite(u)?[N,j,u]:[N,j]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),t=(0,ce.Z)(n,2),o=t[0],u=t[1],c=(r[2]||0)*this.pixelsPerMeter;return[o,u,c]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),t=(0,ce.Z)(n,2),o=t[0],u=t[1],c=(r[2]||0)/this.pixelsPerMeter;return[o,u,c]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function LP(e){var i=e.width,r=e.height,n=e.bounds,t=e.minExtent,o=t===void 0?0:t,u=e.maxZoom,c=u===void 0?24:u,p=e.padding,m=p===void 0?0:p,b=e.offset,C=b===void 0?[0,0]:b,A=(0,ce.Z)(n,2),P=(0,ce.Z)(A[0],2),O=P[0],D=P[1],N=(0,ce.Z)(A[1],2),j=N[0],ae=N[1];if(Number.isFinite(m)){var re=m;m={top:re,bottom:re,left:re,right:re}}else ad(Number.isFinite(m.top)&&Number.isFinite(m.bottom)&&Number.isFinite(m.left)&&Number.isFinite(m.right));var Te=new Wm({width:i,height:r,longitude:0,latitude:0,zoom:0}),Re=Te.project([O,ae]),Ke=Te.project([j,D]),gt=[Math.max(Math.abs(Ke[0]-Re[0]),o),Math.max(Math.abs(Ke[1]-Re[1]),o)],lt=[i-m.left-m.right-Math.abs(C[0])*2,r-m.top-m.bottom-Math.abs(C[1])*2];ad(lt[0]>0&&lt[1]>0);var Ut=lt[0]/gt[0],or=lt[1]/gt[1],cr=(m.right-m.left)/2/Ut,Tr=(m.bottom-m.top)/2/or,Sn=[(Ke[0]+Re[0])/2+cr,(Ke[1]+Re[1])/2+Tr],Un=Te.unproject(Sn),Vi=Te.zoom+Math.log2(Math.abs(Math.min(Ut,or)));return{longitude:Un[0],latitude:Un[1],zoom:Math.min(Vi,c)}}var Wm=function(e){(0,hr.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=n.width,o=n.height,u=n.latitude,c=u===void 0?0:u,p=n.longitude,m=p===void 0?0:p,b=n.zoom,C=b===void 0?0:b,A=n.pitch,P=A===void 0?0:A,O=n.bearing,D=O===void 0?0:O,N=n.altitude,j=N===void 0?1.5:N,ae=n.nearZMultiplier,re=n.farZMultiplier;(0,vt.Z)(this,i),t=t||1,o=o||1;var Te=r2(C);j=Math.max(.75,j);var Re=Z0([m,c],Te);Re[2]=0;var Ke=IP({width:t,height:o,pitch:P,bearing:D,altitude:j,nearZMultiplier:ae||1/o,farZMultiplier:re||1.01}),gt=TP({height:o,center:Re,pitch:P,bearing:D,altitude:j,flipY:!0});return r=(0,_r.Z)(this,(0,at.Z)(i).call(this,{width:t,height:o,viewMatrix:gt,projectionMatrix:Ke})),r.latitude=c,r.longitude=m,r.zoom=C,r.pitch=P,r.bearing=D,r.altitude=j,r.scale=Te,r.center=Re,r.pixelsPerMeter=n2((0,$e.Z)((0,$e.Z)(r))).pixelsPerMeter[2],Object.freeze((0,$e.Z)((0,$e.Z)(r))),r}return(0,yt.Z)(i,[{key:"projectFlat",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Z0(n,t)}},{key:"unprojectFlat",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Hm(n,t)}},{key:"getMapCenterByLngLatPosition",value:function(n){var t=n.lngLat,o=n.pos,u=i2(o,this.pixelUnprojectionMatrix),c=Z0(t,this.scale),p=jr.add([],c,jr.negate([],u)),m=jr.add([],this.center,p);return Hm(m,this.scale)}},{key:"getLocationAtPoint",value:function(n){var t=n.lngLat,o=n.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:o})}},{key:"fitBounds",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,u=this.height,c=LP(Object.assign({width:o,height:u,bounds:n},t)),p=c.longitude,m=c.latitude,b=c.zoom;return new i({width:o,height:u,longitude:p,latitude:m,zoom:b})}}]),i}(PP),RP=function(){function e(){(0,vt.Z)(this,e)}return(0,yt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,t=r.zoom,o=r.pitch,u=r.bearing,c=r.viewportHeight,p=r.viewportWidth,m=this.viewport?{width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing}:{};this.viewport=new Wm((0,oe.Z)((0,oe.Z)({},m),{},{width:p,height:c,longitude:n&&n[0],latitude:n&&n[1],zoom:t,pitch:o,bearing:u}))}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),o2={dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",normal:"amap://styles/normal",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true"},OP=["id","style","minZoom","maxZoom","token","mapInstance","plugin"],s2,u2,l2,c2,f2,h2,Gd,p2,d2,v2,m2;function DP(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}DP(`.amap-logo{
 display: none !important;
}
`);var FP=0;window.forceWebGL=!0;var g2="15cd8a57710d40c9b7c0e3cc120f1200",BP="1.4.15",NP="amap-script",Xm=!1,V0=[],zP=12,UP=(s2=(0,Jr.b2)(),u2=(0,Jr.f3)(Ft.IGlobalConfigService),l2=(0,Jr.f3)(Ft.MapConfig),c2=(0,Jr.f3)(Ft.ICoordinateSystemService),f2=(0,Jr.f3)(Ft.IEventEmitter),s2(h2=(Gd=function(){function e(){var i=this;(0,vt.Z)(this,e),(0,T.Z)(this,"version",ts["GAODE1.x"]),(0,T.Z)(this,"simpleMapCoord",new Qb),(0,T.Z)(this,"bgColor","rgba(0, 0, 0, 0)"),na(this,"configService",p2,this),na(this,"config",d2,this),na(this,"coordinateSystemService",v2,this),na(this,"eventEmitter",m2,this),(0,T.Z)(this,"handleCameraChanged",function(r){var n=r.camera,t=n.fov,o=n.near,u=n.far,c=n.height,p=n.pitch,m=n.rotation,b=n.aspect,C=n.position,A=i.getCenter(),P=A.lng,O=A.lat;if(i.emit("mapchange"),i.cameraChangedCallback){i.viewport.syncWithMapCamera({aspect:b,bearing:360-m,far:u,fov:t,cameraHeight:c,near:o,pitch:p,zoom:i.map.getZoom()-1,center:[P,O],offsetOrigin:[C.x,C.y]});var D=i.config.offsetZoom,N=D===void 0?zP:D;i.viewport.getZoom()>N?i.coordinateSystemService.setCoordinateSystem(Oc.P20_OFFSET):i.coordinateSystemService.setCoordinateSystem(Oc.P20),i.cameraChangedCallback(i.viewport)}})}return(0,yt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getContainer();if(r!==null){var n=r.getElementsByClassName("amap-maps")[0];this.markerContainer=Ia("div","l7-marker-container",n)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){am.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(r,n)}},{key:"off",value:function(r,n){am.indexOf(r)!==-1?this.eventEmitter.off(r,n):this.map.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var r;return(r=this.map.getContainer())===null||r===void 0?void 0:r.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var r=this.map.getSize();return[r.getWidth(),r.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(r){return this.map.setZoom(r+1)}},{key:"getCenter",value:function(r){if(r!=null&&r.padding){var n=this.getCenter(),t=Jb(r.padding),o=this.lngLatToPixel([n.lng,n.lat]),u=[(t.right-t.left)/2,(t.bottom-t.top)/2],c=this.pixelToLngLat([o.x-u[0],o.y-u[1]]);return c}var p=this.map.getCenter();return{lng:p.getLng(),lat:p.getLat()}}},{key:"setCenter",value:function(r,n){if(n!=null&&n.padding){var t=Jb(n.padding),o=this.lngLatToPixel(r),u=[(t.right-t.left)/2,(t.bottom-t.top)/2],c=this.pixelToLngLat([o.x+u[0],o.y+u[1]]);this.map.setCenter([c.lng,c.lat])}else this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var r=this.map.getBounds().toBounds(),n=r.getNorthEast(),t=r.getSouthWest(),o=this.getCenter(),u=o.lng>n.getLng()||o.lng<t.getLng()?180-n.getLng():n.getLng(),c=o.lng<t.getLng()?t.getLng()-180:t.getLng();return[[c,t.getLat()],[u,n.getLat()]]}},{key:"getMinZoom",value:function(){var r=this.map.get("zooms");return r[0]-1}},{key:"getMaxZoom",value:function(){var r=this.map.get("zooms");return r[1]-1}},{key:"setRotation",value:function(r){return this.map.setRotation(r)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy(r,n)}},{key:"fitBounds",value:function(r){this.map.setBounds(new AMap.Bounds([r[0][0],r[0][1],r[1][0],r[1][1]]))}},{key:"setZoomAndCenter",value:function(r,n){this.map.setZoomAndCenter(r+1,n)}},{key:"setMapStyle",value:function(r){this.map.setMapStyle(this.getMapStyle(r))}},{key:"setMapStatus",value:function(r){this.map.setStatus(r)}},{key:"pixelToLngLat",value:function(r){var n=this.map.pixelToLngLat(new AMap.Pixel(r[0],r[1]));return{lng:n.getLng(),lat:n.getLat()}}},{key:"lngLatToPixel",value:function(r){var n=this.map.lnglatToPixel(new AMap.LngLat(r[0],r[1]));return{x:n.getX(),y:n.getY()}}},{key:"containerToLngLat",value:function(r){var n=new AMap.Pixel(r[0],r[1]),t=this.map.containerToLngLat(n);return{lng:t==null?void 0:t.getLng(),lat:t==null?void 0:t.getLat()}}},{key:"lngLatToContainer",value:function(r){var n=new AMap.LngLat(r[0],r[1]),t=this.map.lngLatToContainer(n);return{x:t.getX(),y:t.getY()}}},{key:"lngLatToCoord",value:function(r){var n=this.map.lngLatToGeodeticCoord(r),t=n.x,o=n.y;return[t,-o]}},{key:"lngLatToMercator",value:function(r,n){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(r,n,t){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],u=this.viewport.projectFlat(r),c=Ho();return kc(c,c,_a.fromValues(u[0],u[1],n)),zf(c,c,_a.fromValues(o[0],o[1],o[2])),dh(c,c,t[0]),Yh(c,c,t[1]),$h(c,c,t[2]),c}},{key:"init",value:function(){var i=(0,ue.Z)(te().mark(function n(){var t=this,o,u,c,p,m,b,C,A,P,O,D,N,j,ae;return te().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return o=this.config,u=o.id,c=o.style,p=c===void 0?"light":c,m=o.minZoom,b=m===void 0?0:m,C=o.maxZoom,A=C===void 0?18:C,P=o.token,O=P===void 0?g2:P,D=o.mapInstance,N=o.plugin,j=N===void 0?[]:N,ae=(0,sf.Z)(o,OP),Te.next=3,new Promise(function(Re){var Ke=function(){if(D)t.map=D,t.$mapContainer=t.map.getContainer(),setTimeout(function(){t.map.on("camerachange",t.handleCameraChanged),Re()},30);else{t.$mapContainer=t.creatMapContainer(u);var lt=(0,oe.Z)({mapStyle:t.getMapStyle(p),zooms:[b,A],viewMode:"3D"},ae);lt.zoom&&(lt.zoom+=1);var Ut=new AMap.Map(t.$mapContainer,lt);Ut.on("camerachange",t.handleCameraChanged),Ut.on("camerachange",function(){setTimeout(function(){return t.handleAfterMapChange()})}),t.map=Ut,setTimeout(function(){Re()},10)}};!Xm&&!D?(O===g2&&console.warn(t.configService.getSceneWarninfo("MapToken")),Xm=!0,j.push("Map3D"),qb().load({key:O,version:BP,plugins:j}).then(function(){Ke(),V0.length&&(V0.forEach(function(gt){return gt()}),V0=[])}).catch(function(gt){throw new Error(gt)})):Xm&&window.AMap||D?Ke():V0.push(Ke)});case 3:this.viewport=new RP;case 4:case"end":return Te.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"meterToCoord",value:function(r,n){var t=AMap.GeometryUtil.distance(xs(AMap.LngLat,(0,ee.Z)(r)),xs(AMap.LngLat,(0,ee.Z)(n))),o=this.lngLatToCoord(r),u=(0,ce.Z)(o,2),c=u[0],p=u[1],m=this.lngLatToCoord(n),b=(0,ce.Z)(m,2),C=b[0],A=b[1],P=Math.sqrt(Math.pow(c-C,2)+Math.pow(p-A,2));return P/t}},{key:"updateView",value:function(r){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(r){var n,t=(n=this.getContainer())===null||n===void 0?void 0:n.getElementsByClassName("amap-layer")[0],o=r==="jpg"?t==null?void 0:t.toDataURL("image/jpeg"):t==null?void 0:t.toDataURL("image/png");return o}},{key:"emit",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).emit.apply(n,[r].concat(o))}},{key:"once",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).once.apply(n,[r].concat(o))}},{key:"destroy",value:function(){var r,n;this.map.destroy(),(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),delete window.initAMap;var t=document.getElementById(NP);t&&document.head.removeChild(t)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"handleAfterMapChange",value:function(){this.emit("mapAfterFrameChange")}},{key:"getMapStyle",value:function(r){return o2[r]?o2[r]:r}},{key:"creatMapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var t=document.createElement("div");return t.style.cssText+=`
       position: absolute;
       top: 0;
       height: 100%;
       width: 100%;
     `,t.id="l7_amap_div"+FP++,n.appendChild(t),t}}]),e}(),p2=ta(Gd.prototype,"configService",[u2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d2=ta(Gd.prototype,"config",[l2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v2=ta(Gd.prototype,"coordinateSystemService",[c2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m2=ta(Gd.prototype,"eventEmitter",[f2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gd))||h2),ZP=["id","style","minZoom","maxZoom","token","mapInstance","plugin"],y2,_2;function VP(e){var i=jP();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function jP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}window.forceWebGL=!0;var x2="15cd8a57710d40c9b7c0e3cc120f1200",GP="1.4.15",Ym=!1,j0=[],HP=12,WP=(y2=(0,Jr.b2)(),y2(_2=function(e){(0,hr.Z)(r,e);var i=VP(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"version",ts["GAODE1.x"]),(0,T.Z)((0,$e.Z)(n),"handleCameraChanged",function(c){var p=c.camera,m=p.fov,b=p.near,C=p.far,A=p.height,P=p.pitch,O=p.rotation,D=p.aspect,N=p.position,j=n.getCenter(),ae=j.lng,re=j.lat;if(n.emit("mapchange"),n.cameraChangedCallback){n.viewport.syncWithMapCamera({aspect:D,bearing:360-O,far:C,fov:m,cameraHeight:A,near:b,pitch:P,zoom:n.map.getZoom()-1,center:[ae,re],offsetOrigin:[N.x,N.y]});var Te=n.config.offsetZoom,Re=Te===void 0?HP:Te;n.viewport.getZoom()>Re?n.coordinateSystemService.setCoordinateSystem(Oc.P20_OFFSET):n.coordinateSystemService.setCoordinateSystem(Oc.P20),n.cameraChangedCallback(n.viewport)}}),n}return(0,yt.Z)(r,[{key:"getModelMatrix",value:function(t,o,u){var c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=this.viewport.projectFlat(t),m=Ho();return kc(m,m,_a.fromValues(p[0],p[1],o)),zf(m,m,_a.fromValues(c[0],c[1],c[2])),dh(m,m,u[0]),Yh(m,m,u[1]),$h(m,m,u[2]),m}},{key:"init",value:function(){var n=(0,ue.Z)(te().mark(function o(){var u=this,c,p,m,b,C,A,P,O,D,N,j,ae,re,Te;return te().wrap(function(Ke){for(;;)switch(Ke.prev=Ke.next){case 0:return c=this.config,p=c.id,m=c.style,b=m===void 0?"light":m,C=c.minZoom,A=C===void 0?0:C,P=c.maxZoom,O=P===void 0?18:P,D=c.token,N=D===void 0?x2:D,j=c.mapInstance,ae=c.plugin,re=ae===void 0?[]:ae,Te=(0,sf.Z)(c,ZP),Ke.next=3,new Promise(function(gt){var lt=function(){if(j)u.map=j,u.$mapContainer=u.map.getContainer(),setTimeout(function(){u.map.on("camerachange",u.handleCameraChanged),gt()},30);else{u.$mapContainer=u.creatMapContainer(p);var or=(0,oe.Z)({mapStyle:u.getMapStyle(b),zooms:[A,O],viewMode:"3D"},Te);or.zoom&&(or.zoom+=1);var cr=new AMap.Map(u.$mapContainer,or);cr.on("camerachange",u.handleCameraChanged),cr.on("camerachange",function(){setTimeout(function(){return u.handleAfterMapChange()})}),u.map=cr,setTimeout(function(){gt()},10)}};!Ym&&!j?(N===x2&&console.warn(u.configService.getSceneWarninfo("MapToken")),Ym=!0,re.push("Map3D"),qb().load({key:N,version:GP,plugins:re}).then(function(Ut){lt(),j0.length&&(j0.forEach(function(or){return or()}),j0=[])}).catch(function(Ut){throw new Error(Ut)})):Ym&&window.AMap||j?lt():j0.push(lt)});case 3:this.viewport=new CP;case 4:case"end":return Ke.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"meterToCoord",value:function(t,o){var u=AMap.GeometryUtil.distance(xs(AMap.LngLat,(0,ee.Z)(t)),xs(AMap.LngLat,(0,ee.Z)(o))),c=this.lngLatToCoord(t),p=(0,ce.Z)(c,2),m=p[0],b=p[1],C=this.lngLatToCoord(o),A=(0,ce.Z)(C,2),P=A[0],O=A[1],D=Math.sqrt(Math.pow(m-P,2)+Math.pow(b-O,2));return D/u}},{key:"updateView",value:function(t){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(t){var o,u=(o=this.getContainer())===null||o===void 0?void 0:o.getElementsByClassName("amap-layer")[0],c=t==="jpg"?u==null?void 0:u.toDataURL("image/jpeg"):u==null?void 0:u.toDataURL("image/png");return c}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}}]),r}(UP))||_2);function XP(e){var i=YP();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function YP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $P=function(e){(0,hr.Z)(r,e);var i=XP(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getServiceConstructor",value:function(){return WP}}]),r}($b);function b2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function qP(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?b2(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var NO=J.memo(function(e){var i=e.style,r=e.className,n=e.map,t=e.option,o=e.onSceneLoaded,u=(0,J.createRef)(),c=(0,J.useState)(),p=(0,ce.Z)(c,2),m=p[0],b=p[1];return(0,J.useEffect)(function(){var C=new Zm(qP({id:u.current},t,{map:new $P(n)}));return C.on("loaded",function(){b(C),o&&o(C)}),function(){C.destroy()}},[]),(0,J.useEffect)(function(){!m||m.setMapStyle(n.style)},[n.style]),J.createElement(y.Provider,{value:m},(0,J.createElement)("div",{ref:u,style:i,className:r},m&&e.children))}),zO=null,KP=fe(6158),Iv=fe.n(KP),QP=function(){function e(){(0,vt.Z)(this,e)}return(0,yt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,t=r.zoom,o=r.pitch,u=r.bearing,c=r.viewportHeight,p=r.viewportWidth;this.viewport=new Wm({width:p,height:c,longitude:n&&n[0],latitude:n&&n[1],zoom:t,pitch:o,bearing:u})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),E2={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},S2,C2,w2,A2,T2,M2,Hd,I2,k2,P2,L2,R2={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},JP=12,eL=(S2=(0,Jr.b2)(),C2=(0,Jr.f3)(Ft.MapConfig),w2=(0,Jr.f3)(Ft.IGlobalConfigService),A2=(0,Jr.f3)(Ft.ICoordinateSystemService),T2=(0,Jr.f3)(Ft.IEventEmitter),S2(M2=(Hd=function(){function e(){var i=this;(0,vt.Z)(this,e),(0,T.Z)(this,"version",ts.L7MAP),(0,T.Z)(this,"simpleMapCoord",new Qb),(0,T.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),na(this,"config",I2,this),na(this,"configService",k2,this),na(this,"coordinateSystemService",P2,this),na(this,"eventEmitter",L2,this),(0,T.Z)(this,"handleCameraChanged",function(r){var n=i.map.getCenter(),t=n.lat,o=n.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[o,t],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0}),i.updateCoordinateSystemService(),i.cameraChangedCallback(i.viewport)})}return(0,yt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Ia("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(r,n){am.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(R2[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(R2[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===ts.SIMPLE)return this.simpleMapCoord.getSize();var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.dragEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"meterToCoord",value:function(r,n){return 1}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).emit.apply(n,[r].concat(o))}},{key:"once",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).once.apply(n,[r].concat(o))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),t=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return t}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatMapContainer",value:function(r){var n=r;return typeof r=="string"&&(n=document.getElementById(r)),n}},{key:"updateView",value:function(r){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:r.bearing,center:r.center,viewportHeight:r.viewportHeight,pitch:r.pitch,viewportWidth:r.viewportWidth,zoom:r.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var r=this.config.offsetCoordinate,n=r===void 0?!0:r;this.viewport.getZoom()>JP&&n?this.coordinateSystemService.setCoordinateSystem(Oc.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Oc.LNGLAT)}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:E2[r]?E2[r]:r}}]),e}(),I2=ta(Hd.prototype,"config",[C2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k2=ta(Hd.prototype,"configService",[w2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P2=ta(Hd.prototype,"coordinateSystemService",[A2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L2=ta(Hd.prototype,"eventEmitter",[T2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hd))||M2),tL=["id","attributionControl","style","token","rotation","mapInstance"],O2,D2;function rL(e){var i=nL();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function nL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function iL(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}iL(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Iv();var aL=0,F2="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",oL=(O2=(0,Jr.b2)(),O2(D2=function(e){(0,hr.Z)(r,e);var i=rL(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,T.Z)((0,$e.Z)(n),"version",ts.MAPBOX),n}return(0,yt.Z)(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},u=this.lngLatToMercator(t,0),c=u.x,p=u.y;return[c-o.x,p-o.y]}},{key:"lngLatToMercator",value:function(t,o){var u=window.mapboxgl.MercatorCoordinate.fromLngLat(t,o),c=u.x,p=c===void 0?0:c,m=u.y,b=m===void 0?0:m,C=u.z,A=C===void 0?0:C;return{x:p,y:b,z:A}}},{key:"getModelMatrix",value:function(t,o,u){var c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},m=window.mapboxgl.MercatorCoordinate.fromLngLat(t,o),b=m.meterInMercatorCoordinateUnits(),C=Ho();return kc(C,C,_a.fromValues(m.x-p.x,m.y-p.y,m.z||0-p.z)),zf(C,C,_a.fromValues(b*c[0],-b*c[1],b*c[2])),dh(C,C,u[0]),Yh(C,C,u[1]),$h(C,C,u[2]),C}},{key:"init",value:function(){var n=(0,ue.Z)(te().mark(function o(){var u,c,p,m,b,C,A,P,O,D,N,j,ae;return te().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:u=this.config,c=u.id,p=c===void 0?"map":c,m=u.attributionControl,b=m===void 0?!1:m,C=u.style,A=C===void 0?"light":C,P=u.token,O=P===void 0?F2:P,D=u.rotation,N=D===void 0?0:D,j=u.mapInstance,ae=(0,sf.Z)(u,tL),this.viewport=new QP,!j&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),O===F2&&A!=="blank"&&!window.mapboxgl.accessToken&&!j&&console.warn(this.configService.getSceneWarninfo("MapToken")),!j&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=O),j?(this.map=j,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(p),this.map=new window.mapboxgl.Map((0,oe.Z)({container:this.$mapContainer,style:this.getMapStyle(A),attributionControl:b,bearing:N},ae))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Te.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,o;(t=this.$mapContainer)===null||t===void 0||(o=t.parentNode)===null||o===void 0||o.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var o,u=arguments.length,c=new Array(u>1?u-1:0),p=1;p<u;p++)c[p-1]=arguments[p];(o=this.eventEmitter).emit.apply(o,[t].concat(c))}},{key:"once",value:function(t){for(var o,u=arguments.length,c=new Array(u>1?u-1:0),p=1;p<u;p++)c[p-1]=arguments[p];(o=this.eventEmitter).once.apply(o,[t].concat(c))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,o){var u=new(Iv()).LngLat(t[0],t[1]),c=new(Iv()).LngLat(o[0],o[1]),p=u.distanceTo(c),m=Iv().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),b=Iv().MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]}),C=m.x,A=m.y,P=b.x,O=b.y,D=Math.sqrt(Math.pow(C-P,2)+Math.pow(A-O,2))*4194304*2;return D/p}},{key:"exportMap",value:function(t){var o=this.map.getCanvas(),u=t==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return u}},{key:"creatMapContainer",value:function(t){var o=t;typeof t=="string"&&(o=document.getElementById(t));var u=document.createElement("div");return u.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,u.id="l7_mapbox_div"+aL++,o.appendChild(u),u}}]),r}(eL))||D2);function sL(e){var i=uL();return function(){var n=(0,at.Z)(e),t;if(i){var o=(0,at.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,_r.Z)(this,t)}}function uL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function lL(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}lL(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var cL=function(e){(0,hr.Z)(r,e);var i=sL(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,yt.Z)(r,[{key:"getServiceConstructor",value:function(){return oL}}]),r}($b);function B2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function fL(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?B2(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var hL=J.memo(function(e){var i=e.style,r=e.className,n=e.map,t=e.option,o=e.onSceneLoaded,u=(0,J.createRef)(),c=(0,J.useState)(),p=(0,ce.Z)(c,2),m=p[0],b=p[1];return(0,J.useEffect)(function(){var C=new Zm(fL({id:u.current},t,{map:new cL(n)}));return C.on("loaded",function(){b(C),o&&o(C)}),function(){C.destroy()}},[]),(0,J.useEffect)(function(){m&&n.style&&m.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,J.useEffect)(function(){m&&n.zoom&&m.setZoom(n.zoom)},[n.zoom]),(0,J.useEffect)(function(){m&&n.center&&m.setCenter(n.center)},[JSON.stringify(n.center)]),(0,J.useEffect)(function(){m&&n.pitch&&m.setPitch(n.pitch)},[n.pitch]),(0,J.useEffect)(function(){m&&n.rotation&&m.setRotation(n.rotation)},[n.rotation]),J.createElement(y.Provider,{value:m},(0,J.createElement)("div",{ref:u,style:i,className:r},m&&e.children))}),pL=hL,UO=J.memo(function(e){var i=e.style,r=e.className,n=e.map,t=(0,J.createRef)(),o=(0,J.useState)(),u=(0,ce.Z)(o,2),c=u[0],p=u[1];return(0,J.useEffect)(function(){var m=new Zm({id:t.current,map:n});return m.on("loaded",function(){p(m)}),function(){m.destroy()}},[]),J.createElement(y.Provider,{value:c},(0,J.createElement)("div",{ref:t,style:i,className:r},c&&e.children))}),N2=(0,J.createContext)({});function dL(){return(0,J.useContext)(N2)}var vL=J.useEffect,mL=J.memo(function(i){var r=i.layer,n=i.active;return vL(function(){r.active(n.option)},[JSON.stringify(n)]),null}),gL=J.useEffect,yL=J.memo(function(i){var r=i.layer,n=i.animate;return gL(function(){r.animate(n)},[JSON.stringify(n)]),null}),_L=J.useEffect,xL=J.memo(function(i){var r=i.layer,n=i.color;return _L(function(){n.field?r.color(n.field,n.values):r.color(n.values)},[n.field,n.scale,JSON.stringify(n.values),JSON.stringify(n.options)]),null}),bL=J.useEffect,EL=J.memo(function(i){var r=i.layer,n=i.filter;return bL(function(){n.field&&r.filter(n.field,n.values)},[n.field,n.values,JSON.stringify(n.values),JSON.stringify(n.options)]),null}),SL=J.useEffect,CL=J.memo(function(i){var r=i.layer,n=i.scale;return SL(function(){r.scale(n.values)},[n.values]),null}),wL=J.useEffect,AL=J.memo(function(i){var r=i.layer,n=i.select;return wL(function(){r.select(n.option)},[JSON.stringify(n)]),null}),TL=J.useEffect,ML=J.memo(function(i){var r=i.layer,n=i.shape;return TL(function(){n.field?r.shape(n.field,n.values):r.shape(n.values)},[n.field,JSON.stringify(n.values),JSON.stringify(n.options)]),null}),IL=J.useEffect,kL=J.memo(function(i){var r=i.layer,n=i.size;return IL(function(){n.field?r.size(n.field,n.values):r.size(n.values)},[n.field,n.scale,JSON.stringify(n.values),JSON.stringify(n.options)]),null}),PL=J.useEffect,LL=J.memo(function(i){var r=i.layer,n=i.source,t=n.data,o=(0,sf.Z)(n,["data"]);return PL(function(){r.inited?r.setData(t,o):r.source(t,o),o.autoFit&&r.fitBounds(o&&o.fitBoundsOptions)},[t,JSON.stringify(o)]),null}),RL=J.useEffect,OL=J.memo(function(i){var r=i.layer,n=i.style;return RL(function(){r.style(n)},Object.keys(n).map(function(t){return n[t]})),null}),kv=J.useEffect,DL=J.useState;function od(e,i){var r=i.source,n=i.color,t=i.shape,o=i.style,u=i.size,c=i.scale,p=i.active,m=i.select,b=i.filter,C=i.animate,A=i.options,P=i.onLayerLoaded,O=Ae(),D=DL(),N=(0,ce.Z)(D,2),j=N[0],ae=N[1];if(!j){var re;switch(e){case"polygonLayer":re=new N1(A);break;case"lineLayer":re=new V5(A);break;case"pointLayer":re=new zI(A);break;case"heatmapLayer":re=new Xw(A);break;case"rasterLayer":re=new C3(A);break;case"imageLayer":re=new U_(A);break;case"citybuildingLayer":re=new yw(A);break;default:re=new N1(A)}re.on("inited",function(){P&&P(re,O)}),ae(re)}return kv(function(){if(j!==void 0)return O.addLayer(j),function(){O.removeLayer(j)}},[]),kv(function(){j&&O.render()}),kv(function(){j&&j.inited&&A&&j.updateLayerConfig(A)},[A==null?void 0:A.minZoom,A==null?void 0:A.maxZoom,A==null?void 0:A.visible]),kv(function(){j&&j.inited&&A&&A.zIndex&&j.setIndex(A.zIndex)},[A==null?void 0:A.zIndex]),kv(function(){j&&j.inited&&A&&A.blend&&j.setBlend(A.blend)},[A==null?void 0:A.blend]),j!=null?J.createElement(N2.Provider,{value:j},J.createElement(LL,{layer:j,source:r}),c&&J.createElement(CL,{layer:j,scale:c}),n&&J.createElement(xL,{layer:j,color:n}),u&&J.createElement(kL,{layer:j,size:u}),t&&J.createElement(ML,{layer:j,shape:t}),o&&J.createElement(OL,{layer:j,style:o}),p&&J.createElement(mL,{layer:j,active:p}),m&&J.createElement(AL,{layer:j,select:m}),b&&J.createElement(EL,{layer:j,filter:b}),C&&J.createElement(yL,{layer:j,animate:C}),i.children):null}var ZO=J.memo(function(i){return od("polygonLayer",i)}),VO=J.memo(function(i){return od("lineLayer",i)}),FL=J.memo(function(i){return od("pointLayer",i)}),BL=J.memo(function(i){return od("heatmapLayer",i)}),jO=J.memo(function(i){return od("rasterLayer",i)}),GO=J.memo(function(i){return od("imagelayer",i)}),HO=J.memo(function(i){return od("citybuildinglayer",i)}),WO=J.memo(function(i){var r=Ae(),n=(0,J.useState)(),t=(0,ce.Z)(n,2),o=t[1],u=i.type,c=i.position;return(0,J.useEffect)(function(){var p;switch(u){case"scale":p=new bC({position:c||"bottomright"});break;case"zoom":p=new CC({position:c||"topright"});break;case"logo":p=new f_({position:c||"bottomleft"})}return o(p),r.addControl(p),function(){r.removeControl(p)}},[u,c]),null}),z2=fe(73935),NL=J.useEffect,XO=J.useState;function YO(e){var i=e.className,r=e.style,n=e.children,t=e.position,o=useSceneValue(),u=document.createElement("div");return NL(function(){var c=new Control({position:t});return c.onAdd=function(){if(i&&(u.className=i),r){var p=Object.keys(r).map(function(m){return"".concat(m,":").concat(r[m])}).join(";");u.style.cssText=p}return u},o.addControl(c),function(){o.removeControl(c)}},[]),createPortal(n,u)}var zL=J.useEffect,$O=J.memo(function(e){var i=e.type,r=e.handler,n=dL();return zL(function(){return n.off(i,r),n.on(i,r),function(){n.off(i,r)}},[i,r]),null});fe(68982)(`/* @antv/l7-react */
.color {
 color:'red';
}
`);var qO=J.memo(function(e){var i=e.className,r=e.style,n=e.title,t=[{title:"1",color:"rgb(239,243,255)"},{title:"10",color:"rgb(198,219,239)"},{title:"30",color:"rgb(158,202,225)"},{title:"50",color:"rgb(107,174,214)"},{title:"60",color:"rgb(49,130,189)"},{title:"100",color:"rgb(8,81,156)"}];return J.createElement("div",null,J.createElement("div",null,t.map(function(o,u){return J.createElement("div",{key:u.toString(),style:{background:o.color,height:"100%",display:"inline-block",cursor:"pointer",width:""+(100-t.length)/t.length+"%",marginRight:"1%",padding:5}})})),J.createElement("div",null,t.map(function(o,u){return J.createElement("div",{key:u.toString()+"122",style:{background:"#fff",height:"100%",display:"inline-block",textAlign:"left",cursor:"pointer",width:""+(100-t.length)/t.length+"%",marginRight:"1%"}},o.title)})))}),KO=function(e){(0,hr.Z)(i,e);function i(r){var n;return(0,vt.Z)(this,i),n=(0,_r.Z)(this,(0,at.Z)(i).call(this,r)),n.el=void 0,n.scene=void 0,n.popup=void 0,n.el=document.createElement("div"),n}return(0,yt.Z)(i,[{key:"componentDidMount",value:function(){var n=this.props,t=n.lnglat,o=n.children,u=n.option,c=new p_(u);t&&c.setLnglat(t),o&&c.setDOMContent(this.el),this.popup=c,this.scene.addPopup(c)}},{key:"componentDidUpdate",value:function(n){var t,o,u,c=(n==null||(t=n.lnglat)===null||t===void 0?void 0:t.toString())!==((o=this.props)===null||o===void 0||(u=o.lnglat)===null||u===void 0?void 0:u.toString());c&&(this.popup.remove(),this.popup=new p_(this.props.option),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup))}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var n=this;return J.createElement(y.Consumer,{},function(t){return t&&(n.scene=t),(0,z2.createPortal)(n.props.children,n.el)})}}]),i}(J.PureComponent),QO=function(e){(0,hr.Z)(i,e);function i(r){var n;return(0,vt.Z)(this,i),n=(0,_r.Z)(this,(0,at.Z)(i).call(this,r)),n.el=void 0,n.scene=void 0,n.marker=void 0,n.el=document.createElement("div"),n}return(0,yt.Z)(i,[{key:"componentDidMount",value:function(){var n=this.props,t=n.lnglat,o=n.children,u=n.option,c=n.onMarkerLoaded,p=new h_(u);t&&p.setLnglat(t),o&&p.setElement(this.el),this.marker=p,c&&c(p),this.scene.addMarker(p)}},{key:"componentDidUpdate",value:function(n){var t,o=(n==null?void 0:n.lnglat.toString())!==((t=this.props)===null||t===void 0?void 0:t.lnglat.toString());o&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var n=this;return J.createElement(y.Consumer,{},function(t){return t&&(n.scene=t),(0,z2.createPortal)(n.props.children,n.el)})}}]),i}(J.PureComponent),UL=J.useEffect,JO=J.memo(function(e){var i=e.type,r=e.handler,n=Ae();return UL(function(){return n.on(i,r),function(){n.off(i,r)}},[i]),null}),eD=null,ZL=J.useEffect,tD=J.memo(function(i){var r=i.name,n=i.url,t=Ae();return ZL(function(){t.addImage(r,n)},[r,n]),null})},59591:function(nn,ye,fe){var Le=fe(50008).default;function J(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */nn.exports=J=function(){return y},nn.exports.__esModule=!0,nn.exports.default=nn.exports;var y={},Ae=Object.prototype,T=Ae.hasOwnProperty,ce=typeof Symbol=="function"?Symbol:{},pe=ce.iterator||"@@iterator",Fe=ce.asyncIterator||"@@asyncIterator",_e=ce.toStringTag||"@@toStringTag";function Ge(q,ge,Q){return Object.defineProperty(q,ge,{value:Q,enumerable:!0,configurable:!0,writable:!0}),q[ge]}try{Ge({},"")}catch(q){Ge=function(Q,Me,ee){return Q[Me]=ee}}function ot(q,ge,Q,Me){var ee=ge&&ge.prototype instanceof ar?ge:ar,oe=Object.create(ee.prototype),bt=new pt(Me||[]);return oe._invoke=function(Nt,jt,Qt){var ln="suspendedStart";return function(Dr,oi){if(ln==="executing")throw new Error("Generator is already running");if(ln==="completed"){if(Dr==="throw")throw oi;return Br()}for(Qt.method=Dr,Qt.arg=oi;;){var Zn=Qt.delegate;if(Zn){var Vn=Tt(Zn,Qt);if(Vn){if(Vn===kt)continue;return Vn}}if(Qt.method==="next")Qt.sent=Qt._sent=Qt.arg;else if(Qt.method==="throw"){if(ln==="suspendedStart")throw ln="completed",Qt.arg;Qt.dispatchException(Qt.arg)}else Qt.method==="return"&&Qt.abrupt("return",Qt.arg);ln="executing";var Xi=ft(Nt,jt,Qt);if(Xi.type==="normal"){if(ln=Qt.done?"completed":"suspendedYield",Xi.arg===kt)continue;return{value:Xi.arg,done:Qt.done}}Xi.type==="throw"&&(ln="completed",Qt.method="throw",Qt.arg=Xi.arg)}}}(q,Q,bt),oe}function ft(q,ge,Q){try{return{type:"normal",arg:q.call(ge,Q)}}catch(Me){return{type:"throw",arg:Me}}}y.wrap=ot;var kt={};function ar(){}function xt(){}function Jt(){}var Gt={};Ge(Gt,pe,function(){return this});var wt=Object.getPrototypeOf,Bt=wt&&wt(wt(lr([])));Bt&&Bt!==Ae&&T.call(Bt,pe)&&(Gt=Bt);var gr=Jt.prototype=ar.prototype=Object.create(Gt);function K(q){["next","throw","return"].forEach(function(ge){Ge(q,ge,function(Q){return this._invoke(ge,Q)})})}function ur(q,ge){function Q(ee,oe,bt,Nt){var jt=ft(q[ee],q,oe);if(jt.type!=="throw"){var Qt=jt.arg,ln=Qt.value;return ln&&Le(ln)=="object"&&T.call(ln,"__await")?ge.resolve(ln.__await).then(function(Dr){Q("next",Dr,bt,Nt)},function(Dr){Q("throw",Dr,bt,Nt)}):ge.resolve(ln).then(function(Dr){Qt.value=Dr,bt(Qt)},function(Dr){return Q("throw",Dr,bt,Nt)})}Nt(jt.arg)}var Me;this._invoke=function(ee,oe){function bt(){return new ge(function(Nt,jt){Q(ee,oe,Nt,jt)})}return Me=Me?Me.then(bt,bt):bt()}}function Tt(q,ge){var Q=q.iterator[ge.method];if(Q===void 0){if(ge.delegate=null,ge.method==="throw"){if(q.iterator.return&&(ge.method="return",ge.arg=void 0,Tt(q,ge),ge.method==="throw"))return kt;ge.method="throw",ge.arg=new TypeError("The iterator does not provide a 'throw' method")}return kt}var Me=ft(Q,q.iterator,ge.arg);if(Me.type==="throw")return ge.method="throw",ge.arg=Me.arg,ge.delegate=null,kt;var ee=Me.arg;return ee?ee.done?(ge[q.resultName]=ee.value,ge.next=q.nextLoc,ge.method!=="return"&&(ge.method="next",ge.arg=void 0),ge.delegate=null,kt):ee:(ge.method="throw",ge.arg=new TypeError("iterator result is not an object"),ge.delegate=null,kt)}function ht(q){var ge={tryLoc:q[0]};1 in q&&(ge.catchLoc=q[1]),2 in q&&(ge.finallyLoc=q[2],ge.afterLoc=q[3]),this.tryEntries.push(ge)}function Ot(q){var ge=q.completion||{};ge.type="normal",delete ge.arg,q.completion=ge}function pt(q){this.tryEntries=[{tryLoc:"root"}],q.forEach(ht,this),this.reset(!0)}function lr(q){if(q){var ge=q[pe];if(ge)return ge.call(q);if(typeof q.next=="function")return q;if(!isNaN(q.length)){var Q=-1,Me=function ee(){for(;++Q<q.length;)if(T.call(q,Q))return ee.value=q[Q],ee.done=!1,ee;return ee.value=void 0,ee.done=!0,ee};return Me.next=Me}}return{next:Br}}function Br(){return{value:void 0,done:!0}}return xt.prototype=Jt,Ge(gr,"constructor",Jt),Ge(Jt,"constructor",xt),xt.displayName=Ge(Jt,_e,"GeneratorFunction"),y.isGeneratorFunction=function(q){var ge=typeof q=="function"&&q.constructor;return!!ge&&(ge===xt||(ge.displayName||ge.name)==="GeneratorFunction")},y.mark=function(q){return Object.setPrototypeOf?Object.setPrototypeOf(q,Jt):(q.__proto__=Jt,Ge(q,_e,"GeneratorFunction")),q.prototype=Object.create(gr),q},y.awrap=function(q){return{__await:q}},K(ur.prototype),Ge(ur.prototype,Fe,function(){return this}),y.AsyncIterator=ur,y.async=function(q,ge,Q,Me,ee){ee===void 0&&(ee=Promise);var oe=new ur(ot(q,ge,Q,Me),ee);return y.isGeneratorFunction(ge)?oe:oe.next().then(function(bt){return bt.done?bt.value:oe.next()})},K(gr),Ge(gr,_e,"Generator"),Ge(gr,pe,function(){return this}),Ge(gr,"toString",function(){return"[object Generator]"}),y.keys=function(q){var ge=[];for(var Q in q)ge.push(Q);return ge.reverse(),function Me(){for(;ge.length;){var ee=ge.pop();if(ee in q)return Me.value=ee,Me.done=!1,Me}return Me.done=!0,Me}},y.values=lr,pt.prototype={constructor:pt,reset:function(ge){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(Ot),!ge)for(var Q in this)Q.charAt(0)==="t"&&T.call(this,Q)&&!isNaN(+Q.slice(1))&&(this[Q]=void 0)},stop:function(){this.done=!0;var ge=this.tryEntries[0].completion;if(ge.type==="throw")throw ge.arg;return this.rval},dispatchException:function(ge){if(this.done)throw ge;var Q=this;function Me(Qt,ln){return bt.type="throw",bt.arg=ge,Q.next=Qt,ln&&(Q.method="next",Q.arg=void 0),!!ln}for(var ee=this.tryEntries.length-1;ee>=0;--ee){var oe=this.tryEntries[ee],bt=oe.completion;if(oe.tryLoc==="root")return Me("end");if(oe.tryLoc<=this.prev){var Nt=T.call(oe,"catchLoc"),jt=T.call(oe,"finallyLoc");if(Nt&&jt){if(this.prev<oe.catchLoc)return Me(oe.catchLoc,!0);if(this.prev<oe.finallyLoc)return Me(oe.finallyLoc)}else if(Nt){if(this.prev<oe.catchLoc)return Me(oe.catchLoc,!0)}else{if(!jt)throw new Error("try statement without catch or finally");if(this.prev<oe.finallyLoc)return Me(oe.finallyLoc)}}}},abrupt:function(ge,Q){for(var Me=this.tryEntries.length-1;Me>=0;--Me){var ee=this.tryEntries[Me];if(ee.tryLoc<=this.prev&&T.call(ee,"finallyLoc")&&this.prev<ee.finallyLoc){var oe=ee;break}}oe&&(ge==="break"||ge==="continue")&&oe.tryLoc<=Q&&Q<=oe.finallyLoc&&(oe=null);var bt=oe?oe.completion:{};return bt.type=ge,bt.arg=Q,oe?(this.method="next",this.next=oe.finallyLoc,kt):this.complete(bt)},complete:function(ge,Q){if(ge.type==="throw")throw ge.arg;return ge.type==="break"||ge.type==="continue"?this.next=ge.arg:ge.type==="return"?(this.rval=this.arg=ge.arg,this.method="return",this.next="end"):ge.type==="normal"&&Q&&(this.next=Q),kt},finish:function(ge){for(var Q=this.tryEntries.length-1;Q>=0;--Q){var Me=this.tryEntries[Q];if(Me.finallyLoc===ge)return this.complete(Me.completion,Me.afterLoc),Ot(Me),kt}},catch:function(ge){for(var Q=this.tryEntries.length-1;Q>=0;--Q){var Me=this.tryEntries[Q];if(Me.tryLoc===ge){var ee=Me.completion;if(ee.type==="throw"){var oe=ee.arg;Ot(Me)}return oe}}throw new Error("illegal catch attempt")},delegateYield:function(ge,Q,Me){return this.delegate={iterator:lr(ge),resultName:Q,nextLoc:Me},this.method==="next"&&(this.arg=void 0),kt}},y}nn.exports=J,nn.exports.__esModule=!0,nn.exports.default=nn.exports},50008:function(nn){function ye(fe){return nn.exports=ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Le){return typeof Le}:function(Le){return Le&&typeof Symbol=="function"&&Le.constructor===Symbol&&Le!==Symbol.prototype?"symbol":typeof Le},nn.exports.__esModule=!0,nn.exports.default=nn.exports,ye(fe)}nn.exports=ye,nn.exports.__esModule=!0,nn.exports.default=nn.exports},87757:function(nn,ye,fe){var Le=fe(59591)();nn.exports=Le;try{regeneratorRuntime=Le}catch(J){typeof globalThis=="object"?globalThis.regeneratorRuntime=Le:Function("r","regeneratorRuntime = r")(Le)}},38163:function(nn){nn.exports=ye;function ye(J,y){var Ae=J&&J.type,T;if(Ae==="FeatureCollection")for(T=0;T<J.features.length;T++)ye(J.features[T],y);else if(Ae==="GeometryCollection")for(T=0;T<J.geometries.length;T++)ye(J.geometries[T],y);else if(Ae==="Feature")ye(J.geometry,y);else if(Ae==="Polygon")fe(J.coordinates,y);else if(Ae==="MultiPolygon")for(T=0;T<J.coordinates.length;T++)fe(J.coordinates[T],y);return J}function fe(J,y){if(J.length!==0){Le(J[0],y);for(var Ae=1;Ae<J.length;Ae++)Le(J[Ae],!y)}}function Le(J,y){for(var Ae=0,T=0,ce=0,pe=J.length,Fe=pe-1;ce<pe;Fe=ce++){var _e=(J[ce][0]-J[Fe][0])*(J[Fe][1]+J[ce][1]),Ge=Ae+_e;T+=Math.abs(Ae)>=Math.abs(_e)?Ae-Ge+_e:_e-Ge+Ae,Ae=Ge}Ae+T>=0!=!!y&&J.reverse()}},75550:function(nn){"use strict";nn.exports=ye;function ye(fe,Le){this.x=fe,this.y=Le}ye.prototype={clone:function(){return new ye(this.x,this.y)},add:function(fe){return this.clone()._add(fe)},sub:function(fe){return this.clone()._sub(fe)},multByPoint:function(fe){return this.clone()._multByPoint(fe)},divByPoint:function(fe){return this.clone()._divByPoint(fe)},mult:function(fe){return this.clone()._mult(fe)},div:function(fe){return this.clone()._div(fe)},rotate:function(fe){return this.clone()._rotate(fe)},rotateAround:function(fe,Le){return this.clone()._rotateAround(fe,Le)},matMult:function(fe){return this.clone()._matMult(fe)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(fe){return this.x===fe.x&&this.y===fe.y},dist:function(fe){return Math.sqrt(this.distSqr(fe))},distSqr:function(fe){var Le=fe.x-this.x,J=fe.y-this.y;return Le*Le+J*J},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(fe){return Math.atan2(this.y-fe.y,this.x-fe.x)},angleWith:function(fe){return this.angleWithSep(fe.x,fe.y)},angleWithSep:function(fe,Le){return Math.atan2(this.x*Le-this.y*fe,this.x*fe+this.y*Le)},_matMult:function(fe){var Le=fe[0]*this.x+fe[1]*this.y,J=fe[2]*this.x+fe[3]*this.y;return this.x=Le,this.y=J,this},_add:function(fe){return this.x+=fe.x,this.y+=fe.y,this},_sub:function(fe){return this.x-=fe.x,this.y-=fe.y,this},_mult:function(fe){return this.x*=fe,this.y*=fe,this},_div:function(fe){return this.x/=fe,this.y/=fe,this},_multByPoint:function(fe){return this.x*=fe.x,this.y*=fe.y,this},_divByPoint:function(fe){return this.x/=fe.x,this.y/=fe.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var fe=this.y;return this.y=this.x,this.x=-fe,this},_rotate:function(fe){var Le=Math.cos(fe),J=Math.sin(fe),y=Le*this.x-J*this.y,Ae=J*this.x+Le*this.y;return this.x=y,this.y=Ae,this},_rotateAround:function(fe,Le){var J=Math.cos(fe),y=Math.sin(fe),Ae=Le.x+J*(this.x-Le.x)-y*(this.y-Le.y),T=Le.y+y*(this.x-Le.x)+J*(this.y-Le.y);return this.x=Ae,this.y=T,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ye.convert=function(fe){return fe instanceof ye?fe:Array.isArray(fe)?new ye(fe[0],fe[1]):fe}},38929:function(nn,ye,fe){nn.exports.VectorTile=fe(22779),fe(66024),fe(59701)},22779:function(nn,ye,fe){"use strict";var Le=fe(59701);nn.exports=J;function J(Ae,T){this.layers=Ae.readFields(y,{},T)}function y(Ae,T,ce){if(Ae===3){var pe=new Le(ce,ce.readVarint()+ce.pos);pe.length&&(T[pe.name]=pe)}}},66024:function(nn,ye,fe){"use strict";var Le=fe(75550);nn.exports=J;function J(pe,Fe,_e,Ge,ot){this.properties={},this.extent=_e,this.type=0,this._pbf=pe,this._geometry=-1,this._keys=Ge,this._values=ot,pe.readFields(y,this,Fe)}function y(pe,Fe,_e){pe==1?Fe.id=_e.readVarint():pe==2?Ae(_e,Fe):pe==3?Fe.type=_e.readVarint():pe==4&&(Fe._geometry=_e.pos)}function Ae(pe,Fe){for(var _e=pe.readVarint()+pe.pos;pe.pos<_e;){var Ge=Fe._keys[pe.readVarint()],ot=Fe._values[pe.readVarint()];Fe.properties[Ge]=ot}}J.types=["Unknown","Point","LineString","Polygon"],J.prototype.loadGeometry=function(){var pe=this._pbf;pe.pos=this._geometry;for(var Fe=pe.readVarint()+pe.pos,_e=1,Ge=0,ot=0,ft=0,kt=[],ar;pe.pos<Fe;){if(Ge<=0){var xt=pe.readVarint();_e=xt&7,Ge=xt>>3}if(Ge--,_e===1||_e===2)ot+=pe.readSVarint(),ft+=pe.readSVarint(),_e===1&&(ar&&kt.push(ar),ar=[]),ar.push(new Le(ot,ft));else if(_e===7)ar&&ar.push(ar[0].clone());else throw new Error("unknown command "+_e)}return ar&&kt.push(ar),kt},J.prototype.bbox=function(){var pe=this._pbf;pe.pos=this._geometry;for(var Fe=pe.readVarint()+pe.pos,_e=1,Ge=0,ot=0,ft=0,kt=Infinity,ar=-Infinity,xt=Infinity,Jt=-Infinity;pe.pos<Fe;){if(Ge<=0){var Gt=pe.readVarint();_e=Gt&7,Ge=Gt>>3}if(Ge--,_e===1||_e===2)ot+=pe.readSVarint(),ft+=pe.readSVarint(),ot<kt&&(kt=ot),ot>ar&&(ar=ot),ft<xt&&(xt=ft),ft>Jt&&(Jt=ft);else if(_e!==7)throw new Error("unknown command "+_e)}return[kt,xt,ar,Jt]},J.prototype.toGeoJSON=function(pe,Fe,_e){var Ge=this.extent*Math.pow(2,_e),ot=this.extent*pe,ft=this.extent*Fe,kt=this.loadGeometry(),ar=J.types[this.type],xt,Jt;function Gt(gr){for(var K=0;K<gr.length;K++){var ur=gr[K],Tt=180-(ur.y+ft)*360/Ge;gr[K]=[(ur.x+ot)*360/Ge-180,360/Math.PI*Math.atan(Math.exp(Tt*Math.PI/180))-90]}}switch(this.type){case 1:var wt=[];for(xt=0;xt<kt.length;xt++)wt[xt]=kt[xt][0];kt=wt,Gt(kt);break;case 2:for(xt=0;xt<kt.length;xt++)Gt(kt[xt]);break;case 3:for(kt=T(kt),xt=0;xt<kt.length;xt++)for(Jt=0;Jt<kt[xt].length;Jt++)Gt(kt[xt][Jt]);break}kt.length===1?kt=kt[0]:ar="Multi"+ar;var Bt={type:"Feature",geometry:{type:ar,coordinates:kt},properties:this.properties};return"id"in this&&(Bt.id=this.id),Bt};function T(pe){var Fe=pe.length;if(Fe<=1)return[pe];for(var _e=[],Ge,ot,ft=0;ft<Fe;ft++){var kt=ce(pe[ft]);kt!==0&&(ot===void 0&&(ot=kt<0),ot===kt<0?(Ge&&_e.push(Ge),Ge=[pe[ft]]):Ge.push(pe[ft]))}return Ge&&_e.push(Ge),_e}function ce(pe){for(var Fe=0,_e=0,Ge=pe.length,ot=Ge-1,ft,kt;_e<Ge;ot=_e++)ft=pe[_e],kt=pe[ot],Fe+=(kt.x-ft.x)*(ft.y+kt.y);return Fe}},59701:function(nn,ye,fe){"use strict";var Le=fe(66024);nn.exports=J;function J(T,ce){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=T,this._keys=[],this._values=[],this._features=[],T.readFields(y,this,ce),this.length=this._features.length}function y(T,ce,pe){T===15?ce.version=pe.readVarint():T===1?ce.name=pe.readString():T===5?ce.extent=pe.readVarint():T===2?ce._features.push(pe.pos):T===3?ce._keys.push(pe.readString()):T===4&&ce._values.push(Ae(pe))}function Ae(T){for(var ce=null,pe=T.readVarint()+T.pos;T.pos<pe;){var Fe=T.readVarint()>>3;ce=Fe===1?T.readString():Fe===2?T.readFloat():Fe===3?T.readDouble():Fe===4?T.readVarint64():Fe===5?T.readVarint():Fe===6?T.readSVarint():Fe===7?T.readBoolean():null}return ce}J.prototype.feature=function(T){if(T<0||T>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[T];var ce=this._pbf.readVarint()+this._pbf.pos;return new Le(this._pbf,ce,this.extent,this._keys,this._values)}},9187:function(nn){"use strict";nn.exports=ye,nn.exports.default=ye;function ye(Q,Me,ee){ee=ee||2;var oe=Me&&Me.length,bt=oe?Me[0]*ee:Q.length,Nt=fe(Q,0,bt,ee,!0),jt=[];if(!Nt||Nt.next===Nt.prev)return jt;var Qt,ln,Dr,oi,Zn,Vn,Xi;if(oe&&(Nt=pe(Q,Me,Nt,ee)),Q.length>80*ee){Qt=Dr=Q[0],ln=oi=Q[1];for(var Ci=ee;Ci<bt;Ci+=ee)Zn=Q[Ci],Vn=Q[Ci+1],Zn<Qt&&(Qt=Zn),Vn<ln&&(ln=Vn),Zn>Dr&&(Dr=Zn),Vn>oi&&(oi=Vn);Xi=Math.max(Dr-Qt,oi-ln),Xi=Xi!==0?32767/Xi:0}return J(Nt,jt,ee,Qt,ln,Xi,0),jt}function fe(Q,Me,ee,oe,bt){var Nt,jt;if(bt===ge(Q,Me,ee,oe)>0)for(Nt=Me;Nt<ee;Nt+=oe)jt=lr(Nt,Q[Nt],Q[Nt+1],jt);else for(Nt=ee-oe;Nt>=Me;Nt-=oe)jt=lr(Nt,Q[Nt],Q[Nt+1],jt);return jt&&Bt(jt,jt.next)&&(Br(jt),jt=jt.next),jt}function Le(Q,Me){if(!Q)return Q;Me||(Me=Q);var ee=Q,oe;do if(oe=!1,!ee.steiner&&(Bt(ee,ee.next)||wt(ee.prev,ee,ee.next)===0)){if(Br(ee),ee=Me=ee.prev,ee===ee.next)break;oe=!0}else ee=ee.next;while(oe||ee!==Me);return Me}function J(Q,Me,ee,oe,bt,Nt,jt){if(!!Q){!jt&&Nt&&ft(Q,oe,bt,Nt);for(var Qt=Q,ln,Dr;Q.prev!==Q.next;){if(ln=Q.prev,Dr=Q.next,Nt?Ae(Q,oe,bt,Nt):y(Q)){Me.push(ln.i/ee|0),Me.push(Q.i/ee|0),Me.push(Dr.i/ee|0),Br(Q),Q=Dr.next,Qt=Dr.next;continue}if(Q=Dr,Q===Qt){jt?jt===1?(Q=T(Le(Q),Me,ee),J(Q,Me,ee,oe,bt,Nt,2)):jt===2&&ce(Q,Me,ee,oe,bt,Nt):J(Le(Q),Me,ee,oe,bt,Nt,1);break}}}}function y(Q){var Me=Q.prev,ee=Q,oe=Q.next;if(wt(Me,ee,oe)>=0)return!1;for(var bt=Me.x,Nt=ee.x,jt=oe.x,Qt=Me.y,ln=ee.y,Dr=oe.y,oi=bt<Nt?bt<jt?bt:jt:Nt<jt?Nt:jt,Zn=Qt<ln?Qt<Dr?Qt:Dr:ln<Dr?ln:Dr,Vn=bt>Nt?bt>jt?bt:jt:Nt>jt?Nt:jt,Xi=Qt>ln?Qt>Dr?Qt:Dr:ln>Dr?ln:Dr,Ci=oe.next;Ci!==Me;){if(Ci.x>=oi&&Ci.x<=Vn&&Ci.y>=Zn&&Ci.y<=Xi&&Jt(bt,Qt,Nt,ln,jt,Dr,Ci.x,Ci.y)&&wt(Ci.prev,Ci,Ci.next)>=0)return!1;Ci=Ci.next}return!0}function Ae(Q,Me,ee,oe){var bt=Q.prev,Nt=Q,jt=Q.next;if(wt(bt,Nt,jt)>=0)return!1;for(var Qt=bt.x,ln=Nt.x,Dr=jt.x,oi=bt.y,Zn=Nt.y,Vn=jt.y,Xi=Qt<ln?Qt<Dr?Qt:Dr:ln<Dr?ln:Dr,Ci=oi<Zn?oi<Vn?oi:Vn:Zn<Vn?Zn:Vn,fi=Qt>ln?Qt>Dr?Qt:Dr:ln>Dr?ln:Dr,Hi=oi>Zn?oi>Vn?oi:Vn:Zn>Vn?Zn:Vn,Ni=ar(Xi,Ci,Me,ee,oe),hi=ar(fi,Hi,Me,ee,oe),Xn=Q.prevZ,ri=Q.nextZ;Xn&&Xn.z>=Ni&&ri&&ri.z<=hi;){if(Xn.x>=Xi&&Xn.x<=fi&&Xn.y>=Ci&&Xn.y<=Hi&&Xn!==bt&&Xn!==jt&&Jt(Qt,oi,ln,Zn,Dr,Vn,Xn.x,Xn.y)&&wt(Xn.prev,Xn,Xn.next)>=0||(Xn=Xn.prevZ,ri.x>=Xi&&ri.x<=fi&&ri.y>=Ci&&ri.y<=Hi&&ri!==bt&&ri!==jt&&Jt(Qt,oi,ln,Zn,Dr,Vn,ri.x,ri.y)&&wt(ri.prev,ri,ri.next)>=0))return!1;ri=ri.nextZ}for(;Xn&&Xn.z>=Ni;){if(Xn.x>=Xi&&Xn.x<=fi&&Xn.y>=Ci&&Xn.y<=Hi&&Xn!==bt&&Xn!==jt&&Jt(Qt,oi,ln,Zn,Dr,Vn,Xn.x,Xn.y)&&wt(Xn.prev,Xn,Xn.next)>=0)return!1;Xn=Xn.prevZ}for(;ri&&ri.z<=hi;){if(ri.x>=Xi&&ri.x<=fi&&ri.y>=Ci&&ri.y<=Hi&&ri!==bt&&ri!==jt&&Jt(Qt,oi,ln,Zn,Dr,Vn,ri.x,ri.y)&&wt(ri.prev,ri,ri.next)>=0)return!1;ri=ri.nextZ}return!0}function T(Q,Me,ee){var oe=Q;do{var bt=oe.prev,Nt=oe.next.next;!Bt(bt,Nt)&&gr(bt,oe,oe.next,Nt)&&ht(bt,Nt)&&ht(Nt,bt)&&(Me.push(bt.i/ee|0),Me.push(oe.i/ee|0),Me.push(Nt.i/ee|0),Br(oe),Br(oe.next),oe=Q=Nt),oe=oe.next}while(oe!==Q);return Le(oe)}function ce(Q,Me,ee,oe,bt,Nt){var jt=Q;do{for(var Qt=jt.next.next;Qt!==jt.prev;){if(jt.i!==Qt.i&&Gt(jt,Qt)){var ln=pt(jt,Qt);jt=Le(jt,jt.next),ln=Le(ln,ln.next),J(jt,Me,ee,oe,bt,Nt,0),J(ln,Me,ee,oe,bt,Nt,0);return}Qt=Qt.next}jt=jt.next}while(jt!==Q)}function pe(Q,Me,ee,oe){var bt=[],Nt,jt,Qt,ln,Dr;for(Nt=0,jt=Me.length;Nt<jt;Nt++)Qt=Me[Nt]*oe,ln=Nt<jt-1?Me[Nt+1]*oe:Q.length,Dr=fe(Q,Qt,ln,oe,!1),Dr===Dr.next&&(Dr.steiner=!0),bt.push(xt(Dr));for(bt.sort(Fe),Nt=0;Nt<bt.length;Nt++)ee=_e(bt[Nt],ee);return ee}function Fe(Q,Me){return Q.x-Me.x}function _e(Q,Me){var ee=Ge(Q,Me);if(!ee)return Me;var oe=pt(ee,Q);return Le(oe,oe.next),Le(ee,ee.next)}function Ge(Q,Me){var ee=Me,oe=Q.x,bt=Q.y,Nt=-Infinity,jt;do{if(bt<=ee.y&&bt>=ee.next.y&&ee.next.y!==ee.y){var Qt=ee.x+(bt-ee.y)*(ee.next.x-ee.x)/(ee.next.y-ee.y);if(Qt<=oe&&Qt>Nt&&(Nt=Qt,jt=ee.x<ee.next.x?ee:ee.next,Qt===oe))return jt}ee=ee.next}while(ee!==Me);if(!jt)return null;var ln=jt,Dr=jt.x,oi=jt.y,Zn=Infinity,Vn;ee=jt;do oe>=ee.x&&ee.x>=Dr&&oe!==ee.x&&Jt(bt<oi?oe:Nt,bt,Dr,oi,bt<oi?Nt:oe,bt,ee.x,ee.y)&&(Vn=Math.abs(bt-ee.y)/(oe-ee.x),ht(ee,Q)&&(Vn<Zn||Vn===Zn&&(ee.x>jt.x||ee.x===jt.x&&ot(jt,ee)))&&(jt=ee,Zn=Vn)),ee=ee.next;while(ee!==ln);return jt}function ot(Q,Me){return wt(Q.prev,Q,Me.prev)<0&&wt(Me.next,Q,Q.next)<0}function ft(Q,Me,ee,oe){var bt=Q;do bt.z===0&&(bt.z=ar(bt.x,bt.y,Me,ee,oe)),bt.prevZ=bt.prev,bt.nextZ=bt.next,bt=bt.next;while(bt!==Q);bt.prevZ.nextZ=null,bt.prevZ=null,kt(bt)}function kt(Q){var Me,ee,oe,bt,Nt,jt,Qt,ln,Dr=1;do{for(ee=Q,Q=null,Nt=null,jt=0;ee;){for(jt++,oe=ee,Qt=0,Me=0;Me<Dr&&(Qt++,oe=oe.nextZ,!!oe);Me++);for(ln=Dr;Qt>0||ln>0&&oe;)Qt!==0&&(ln===0||!oe||ee.z<=oe.z)?(bt=ee,ee=ee.nextZ,Qt--):(bt=oe,oe=oe.nextZ,ln--),Nt?Nt.nextZ=bt:Q=bt,bt.prevZ=Nt,Nt=bt;ee=oe}Nt.nextZ=null,Dr*=2}while(jt>1);return Q}function ar(Q,Me,ee,oe,bt){return Q=(Q-ee)*bt|0,Me=(Me-oe)*bt|0,Q=(Q|Q<<8)&16711935,Q=(Q|Q<<4)&252645135,Q=(Q|Q<<2)&858993459,Q=(Q|Q<<1)&1431655765,Me=(Me|Me<<8)&16711935,Me=(Me|Me<<4)&252645135,Me=(Me|Me<<2)&858993459,Me=(Me|Me<<1)&1431655765,Q|Me<<1}function xt(Q){var Me=Q,ee=Q;do(Me.x<ee.x||Me.x===ee.x&&Me.y<ee.y)&&(ee=Me),Me=Me.next;while(Me!==Q);return ee}function Jt(Q,Me,ee,oe,bt,Nt,jt,Qt){return(bt-jt)*(Me-Qt)>=(Q-jt)*(Nt-Qt)&&(Q-jt)*(oe-Qt)>=(ee-jt)*(Me-Qt)&&(ee-jt)*(Nt-Qt)>=(bt-jt)*(oe-Qt)}function Gt(Q,Me){return Q.next.i!==Me.i&&Q.prev.i!==Me.i&&!Tt(Q,Me)&&(ht(Q,Me)&&ht(Me,Q)&&Ot(Q,Me)&&(wt(Q.prev,Q,Me.prev)||wt(Q,Me.prev,Me))||Bt(Q,Me)&&wt(Q.prev,Q,Q.next)>0&&wt(Me.prev,Me,Me.next)>0)}function wt(Q,Me,ee){return(Me.y-Q.y)*(ee.x-Me.x)-(Me.x-Q.x)*(ee.y-Me.y)}function Bt(Q,Me){return Q.x===Me.x&&Q.y===Me.y}function gr(Q,Me,ee,oe){var bt=ur(wt(Q,Me,ee)),Nt=ur(wt(Q,Me,oe)),jt=ur(wt(ee,oe,Q)),Qt=ur(wt(ee,oe,Me));return!!(bt!==Nt&&jt!==Qt||bt===0&&K(Q,ee,Me)||Nt===0&&K(Q,oe,Me)||jt===0&&K(ee,Q,oe)||Qt===0&&K(ee,Me,oe))}function K(Q,Me,ee){return Me.x<=Math.max(Q.x,ee.x)&&Me.x>=Math.min(Q.x,ee.x)&&Me.y<=Math.max(Q.y,ee.y)&&Me.y>=Math.min(Q.y,ee.y)}function ur(Q){return Q>0?1:Q<0?-1:0}function Tt(Q,Me){var ee=Q;do{if(ee.i!==Q.i&&ee.next.i!==Q.i&&ee.i!==Me.i&&ee.next.i!==Me.i&&gr(ee,ee.next,Q,Me))return!0;ee=ee.next}while(ee!==Q);return!1}function ht(Q,Me){return wt(Q.prev,Q,Q.next)<0?wt(Q,Me,Q.next)>=0&&wt(Q,Q.prev,Me)>=0:wt(Q,Me,Q.prev)<0||wt(Q,Q.next,Me)<0}function Ot(Q,Me){var ee=Q,oe=!1,bt=(Q.x+Me.x)/2,Nt=(Q.y+Me.y)/2;do ee.y>Nt!=ee.next.y>Nt&&ee.next.y!==ee.y&&bt<(ee.next.x-ee.x)*(Nt-ee.y)/(ee.next.y-ee.y)+ee.x&&(oe=!oe),ee=ee.next;while(ee!==Q);return oe}function pt(Q,Me){var ee=new q(Q.i,Q.x,Q.y),oe=new q(Me.i,Me.x,Me.y),bt=Q.next,Nt=Me.prev;return Q.next=Me,Me.prev=Q,ee.next=bt,bt.prev=ee,oe.next=ee,ee.prev=oe,Nt.next=oe,oe.prev=Nt,oe}function lr(Q,Me,ee,oe){var bt=new q(Q,Me,ee);return oe?(bt.next=oe.next,bt.prev=oe,oe.next.prev=bt,oe.next=bt):(bt.prev=bt,bt.next=bt),bt}function Br(Q){Q.next.prev=Q.prev,Q.prev.next=Q.next,Q.prevZ&&(Q.prevZ.nextZ=Q.nextZ),Q.nextZ&&(Q.nextZ.prevZ=Q.prevZ)}function q(Q,Me,ee){this.i=Q,this.x=Me,this.y=ee,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ye.deviation=function(Q,Me,ee,oe){var bt=Me&&Me.length,Nt=bt?Me[0]*ee:Q.length,jt=Math.abs(ge(Q,0,Nt,ee));if(bt)for(var Qt=0,ln=Me.length;Qt<ln;Qt++){var Dr=Me[Qt]*ee,oi=Qt<ln-1?Me[Qt+1]*ee:Q.length;jt-=Math.abs(ge(Q,Dr,oi,ee))}var Zn=0;for(Qt=0;Qt<oe.length;Qt+=3){var Vn=oe[Qt]*ee,Xi=oe[Qt+1]*ee,Ci=oe[Qt+2]*ee;Zn+=Math.abs((Q[Vn]-Q[Ci])*(Q[Xi+1]-Q[Vn+1])-(Q[Vn]-Q[Xi])*(Q[Ci+1]-Q[Vn+1]))}return jt===0&&Zn===0?0:Math.abs((Zn-jt)/jt)};function ge(Q,Me,ee,oe){for(var bt=0,Nt=Me,jt=ee-oe;Nt<ee;Nt+=oe)bt+=(Q[jt]-Q[Nt])*(Q[Nt+1]+Q[jt+1]),jt=Nt;return bt}ye.flatten=function(Q){for(var Me=Q[0][0].length,ee={vertices:[],holes:[],dimensions:Me},oe=0,bt=0;bt<Q.length;bt++){for(var Nt=0;Nt<Q[bt].length;Nt++)for(var jt=0;jt<Me;jt++)ee.vertices.push(Q[bt][Nt][jt]);bt>0&&(oe+=Q[bt-1].length,ee.holes.push(oe))}return ee}},67709:function(nn){function ye(Le){var J=Le.target||Le.srcElement;J.__resizeRAF__&&cancelAnimationFrame(J.__resizeRAF__),J.__resizeRAF__=requestAnimationFrame(function(){var y=J.__resizeTrigger__,Ae=y&&y.__resizeListeners__;Ae&&Ae.forEach(function(T){T.call(y,Le)})})}var fe=function(J,y){var Ae=this,T=Ae.document,ce,pe=T.attachEvent;typeof navigator!="undefined"&&(ce=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Fe(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",ye)}if(!J.__resizeListeners__)if(J.__resizeListeners__=[],pe)J.__resizeTrigger__=J,J.attachEvent("onresize",ye);else{getComputedStyle(J).position==="static"&&(J.style.position="relative");var _e=J.__resizeTrigger__=T.createElement("object");_e.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),_e.setAttribute("class","resize-sensor"),_e.setAttribute("tabindex","-1"),_e.setAttribute("title",""),_e.__resizeElement__=J,_e.onload=Fe,_e.type="text/html",ce&&J.appendChild(_e),_e.data="about:blank",ce||J.appendChild(_e)}J.__resizeListeners__.push(y)};nn.exports=typeof window=="undefined"?fe:fe.bind(window),nn.exports.unbind=function(Le,J){var y=document.attachEvent,Ae=Le.__resizeListeners__||[];if(J){var T=Ae.indexOf(J);T!==-1&&Ae.splice(T,1)}else Ae=Le.__resizeListeners__=[];if(!Ae.length){if(y)Le.detachEvent("onresize",ye);else if(Le.__resizeTrigger__){var ce=Le.__resizeTrigger__.contentDocument,pe=ce&&ce.defaultView;pe&&(pe.removeEventListener("resize",ye),delete pe.__resizeTrigger__),Le.__resizeTrigger__=!Le.removeChild(Le.__resizeTrigger__)}delete Le.__resizeListeners__}}},26729:function(nn){"use strict";var ye=Object.prototype.hasOwnProperty,fe="~";function Le(){}Object.create&&(Le.prototype=Object.create(null),new Le().__proto__||(fe=!1));function J(ce,pe,Fe){this.fn=ce,this.context=pe,this.once=Fe||!1}function y(ce,pe,Fe,_e,Ge){if(typeof Fe!="function")throw new TypeError("The listener must be a function");var ot=new J(Fe,_e||ce,Ge),ft=fe?fe+pe:pe;return ce._events[ft]?ce._events[ft].fn?ce._events[ft]=[ce._events[ft],ot]:ce._events[ft].push(ot):(ce._events[ft]=ot,ce._eventsCount++),ce}function Ae(ce,pe){--ce._eventsCount==0?ce._events=new Le:delete ce._events[pe]}function T(){this._events=new Le,this._eventsCount=0}T.prototype.eventNames=function(){var pe=[],Fe,_e;if(this._eventsCount===0)return pe;for(_e in Fe=this._events)ye.call(Fe,_e)&&pe.push(fe?_e.slice(1):_e);return Object.getOwnPropertySymbols?pe.concat(Object.getOwnPropertySymbols(Fe)):pe},T.prototype.listeners=function(pe){var Fe=fe?fe+pe:pe,_e=this._events[Fe];if(!_e)return[];if(_e.fn)return[_e.fn];for(var Ge=0,ot=_e.length,ft=new Array(ot);Ge<ot;Ge++)ft[Ge]=_e[Ge].fn;return ft},T.prototype.listenerCount=function(pe){var Fe=fe?fe+pe:pe,_e=this._events[Fe];return _e?_e.fn?1:_e.length:0},T.prototype.emit=function(pe,Fe,_e,Ge,ot,ft){var kt=fe?fe+pe:pe;if(!this._events[kt])return!1;var ar=this._events[kt],xt=arguments.length,Jt,Gt;if(ar.fn){switch(ar.once&&this.removeListener(pe,ar.fn,void 0,!0),xt){case 1:return ar.fn.call(ar.context),!0;case 2:return ar.fn.call(ar.context,Fe),!0;case 3:return ar.fn.call(ar.context,Fe,_e),!0;case 4:return ar.fn.call(ar.context,Fe,_e,Ge),!0;case 5:return ar.fn.call(ar.context,Fe,_e,Ge,ot),!0;case 6:return ar.fn.call(ar.context,Fe,_e,Ge,ot,ft),!0}for(Gt=1,Jt=new Array(xt-1);Gt<xt;Gt++)Jt[Gt-1]=arguments[Gt];ar.fn.apply(ar.context,Jt)}else{var wt=ar.length,Bt;for(Gt=0;Gt<wt;Gt++)switch(ar[Gt].once&&this.removeListener(pe,ar[Gt].fn,void 0,!0),xt){case 1:ar[Gt].fn.call(ar[Gt].context);break;case 2:ar[Gt].fn.call(ar[Gt].context,Fe);break;case 3:ar[Gt].fn.call(ar[Gt].context,Fe,_e);break;case 4:ar[Gt].fn.call(ar[Gt].context,Fe,_e,Ge);break;default:if(!Jt)for(Bt=1,Jt=new Array(xt-1);Bt<xt;Bt++)Jt[Bt-1]=arguments[Bt];ar[Gt].fn.apply(ar[Gt].context,Jt)}}return!0},T.prototype.on=function(pe,Fe,_e){return y(this,pe,Fe,_e,!1)},T.prototype.once=function(pe,Fe,_e){return y(this,pe,Fe,_e,!0)},T.prototype.removeListener=function(pe,Fe,_e,Ge){var ot=fe?fe+pe:pe;if(!this._events[ot])return this;if(!Fe)return Ae(this,ot),this;var ft=this._events[ot];if(ft.fn)ft.fn===Fe&&(!Ge||ft.once)&&(!_e||ft.context===_e)&&Ae(this,ot);else{for(var kt=0,ar=[],xt=ft.length;kt<xt;kt++)(ft[kt].fn!==Fe||Ge&&!ft[kt].once||_e&&ft[kt].context!==_e)&&ar.push(ft[kt]);ar.length?this._events[ot]=ar.length===1?ar[0]:ar:Ae(this,ot)}return this},T.prototype.removeAllListeners=function(pe){var Fe;return pe?(Fe=fe?fe+pe:pe,this._events[Fe]&&Ae(this,Fe)):(this._events=new Le,this._eventsCount=0),this},T.prototype.off=T.prototype.removeListener,T.prototype.addListener=T.prototype.on,T.prefixed=fe,T.EventEmitter=T,nn.exports=T},80645:function(nn,ye){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ye.read=function(fe,Le,J,y,Ae){var T,ce,pe=Ae*8-y-1,Fe=(1<<pe)-1,_e=Fe>>1,Ge=-7,ot=J?Ae-1:0,ft=J?-1:1,kt=fe[Le+ot];for(ot+=ft,T=kt&(1<<-Ge)-1,kt>>=-Ge,Ge+=pe;Ge>0;T=T*256+fe[Le+ot],ot+=ft,Ge-=8);for(ce=T&(1<<-Ge)-1,T>>=-Ge,Ge+=y;Ge>0;ce=ce*256+fe[Le+ot],ot+=ft,Ge-=8);if(T===0)T=1-_e;else{if(T===Fe)return ce?NaN:(kt?-1:1)*Infinity;ce=ce+Math.pow(2,y),T=T-_e}return(kt?-1:1)*ce*Math.pow(2,T-y)},ye.write=function(fe,Le,J,y,Ae,T){var ce,pe,Fe,_e=T*8-Ae-1,Ge=(1<<_e)-1,ot=Ge>>1,ft=Ae===23?Math.pow(2,-24)-Math.pow(2,-77):0,kt=y?0:T-1,ar=y?1:-1,xt=Le<0||Le===0&&1/Le<0?1:0;for(Le=Math.abs(Le),isNaN(Le)||Le===Infinity?(pe=isNaN(Le)?1:0,ce=Ge):(ce=Math.floor(Math.log(Le)/Math.LN2),Le*(Fe=Math.pow(2,-ce))<1&&(ce--,Fe*=2),ce+ot>=1?Le+=ft/Fe:Le+=ft*Math.pow(2,1-ot),Le*Fe>=2&&(ce++,Fe/=2),ce+ot>=Ge?(pe=0,ce=Ge):ce+ot>=1?(pe=(Le*Fe-1)*Math.pow(2,Ae),ce=ce+ot):(pe=Le*Math.pow(2,ot-1)*Math.pow(2,Ae),ce=0));Ae>=8;fe[J+kt]=pe&255,kt+=ar,pe/=256,Ae-=8);for(ce=ce<<Ae|pe,_e+=Ae;_e>0;fe[J+kt]=ce&255,kt+=ar,ce/=256,_e-=8);fe[J+kt-ar]|=xt*128}},7375:function(nn,ye){"use strict";Object.defineProperty(ye,"__esModule",{value:!0});var fe=Symbol.for("INJECTION");function Le(ce,pe,Fe,_e){function Ge(){return _e&&!Reflect.hasMetadata(fe,this,pe)&&Reflect.defineMetadata(fe,Fe(),this,pe),Reflect.hasMetadata(fe,this,pe)?Reflect.getMetadata(fe,this,pe):Fe()}function ot(ft){Reflect.defineMetadata(fe,ft,this,pe)}Object.defineProperty(ce,pe,{configurable:!0,enumerable:!0,get:Ge,set:ot})}function J(ce,pe){return function(Fe){return function(_e,Ge){var ot=function(){return ce.get(Fe)};Le(_e,Ge,ot,pe)}}}ye.makePropertyInjectDecorator=J;function y(ce,pe){return function(Fe,_e){return function(Ge,ot){var ft=function(){return ce.getNamed(Fe,_e)};Le(Ge,ot,ft,pe)}}}ye.makePropertyInjectNamedDecorator=y;function Ae(ce,pe){return function(Fe,_e,Ge){return function(ot,ft){var kt=function(){return ce.getTagged(Fe,_e,Ge)};Le(ot,ft,kt,pe)}}}ye.makePropertyInjectTaggedDecorator=Ae;function T(ce,pe){return function(Fe){return function(_e,Ge){var ot=function(){return ce.getAll(Fe)};Le(_e,Ge,ot,pe)}}}ye.makePropertyMultiInjectDecorator=T},84879:function(nn,ye,fe){"use strict";var Le;Le={value:!0};var J=fe(7375);function y(Ae,T){T===void 0&&(T=!0);var ce=J.makePropertyInjectDecorator(Ae,T),pe=J.makePropertyInjectNamedDecorator(Ae,T),Fe=J.makePropertyInjectTaggedDecorator(Ae,T),_e=J.makePropertyMultiInjectDecorator(Ae,T);return{lazyInject:ce,lazyInjectNamed:pe,lazyInjectTagged:Fe,lazyMultiInject:_e}}ye.Z=y},99934:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.tagProperty=ye.tagParameter=ye.decorate=void 0;var Le=fe(16674),J=fe(6867);function y(_e,Ge,ot,ft){var kt=J.TAGGED;T(kt,_e,Ge,ft,ot)}ye.tagParameter=y;function Ae(_e,Ge,ot){var ft=J.TAGGED_PROP;T(ft,_e.constructor,Ge,ot)}ye.tagProperty=Ae;function T(_e,Ge,ot,ft,kt){var ar={},xt=typeof kt=="number",Jt=kt!==void 0&&xt?kt.toString():ot;if(xt&&ot!==void 0)throw new Error(Le.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(_e,Ge)&&(ar=Reflect.getMetadata(_e,Ge));var Gt=ar[Jt];if(!Array.isArray(Gt))Gt=[];else for(var wt=0,Bt=Gt;wt<Bt.length;wt++){var gr=Bt[wt];if(gr.key===ft.key)throw new Error(Le.DUPLICATED_METADATA+" "+gr.key.toString())}Gt.push(ft),ar[Jt]=Gt,Reflect.defineMetadata(_e,ar,Ge)}function ce(_e,Ge){Reflect.decorate(_e,Ge)}function pe(_e,Ge){return function(ot,ft){Ge(ot,ft,_e)}}function Fe(_e,Ge,ot){typeof ot=="number"?ce([pe(ot,_e)],Ge):typeof ot=="string"?Reflect.decorate([_e],Ge,ot):ce([_e],Ge)}ye.decorate=Fe},5744:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.inject=ye.LazyServiceIdentifer=void 0;var Le=fe(16674),J=fe(6867),y=fe(47738),Ae=fe(99934),T=function(){function pe(Fe){this._cb=Fe}return pe.prototype.unwrap=function(){return this._cb()},pe}();ye.LazyServiceIdentifer=T;function ce(pe){return function(Fe,_e,Ge){if(pe===void 0)throw new Error(Le.UNDEFINED_INJECT_ANNOTATION(Fe.name));var ot=new y.Metadata(J.INJECT_TAG,pe);typeof Ge=="number"?Ae.tagParameter(Fe,_e,Ge,ot):Ae.tagProperty(Fe,_e,ot)}}ye.inject=ce},64315:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.injectable=void 0;var Le=fe(16674),J=fe(6867);function y(){return function(Ae){if(Reflect.hasOwnMetadata(J.PARAM_TYPES,Ae))throw new Error(Le.DUPLICATED_INJECTABLE_DECORATOR);var T=Reflect.getMetadata(J.DESIGN_PARAM_TYPES,Ae)||[];return Reflect.defineMetadata(J.PARAM_TYPES,T,Ae),Ae}}ye.injectable=y},71693:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.multiInject=void 0;var Le=fe(6867),J=fe(47738),y=fe(99934);function Ae(T){return function(ce,pe,Fe){var _e=new J.Metadata(Le.MULTI_INJECT_TAG,T);typeof Fe=="number"?y.tagParameter(ce,pe,Fe,_e):y.tagProperty(ce,pe,_e)}}ye.multiInject=Ae},38085:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.named=void 0;var Le=fe(6867),J=fe(47738),y=fe(99934);function Ae(T){return function(ce,pe,Fe){var _e=new J.Metadata(Le.NAMED_TAG,T);typeof Fe=="number"?y.tagParameter(ce,pe,Fe,_e):y.tagProperty(ce,pe,_e)}}ye.named=Ae},6515:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.optional=void 0;var Le=fe(6867),J=fe(47738),y=fe(99934);function Ae(){return function(T,ce,pe){var Fe=new J.Metadata(Le.OPTIONAL_TAG,!0);typeof pe=="number"?y.tagParameter(T,ce,pe,Fe):y.tagProperty(T,ce,Fe)}}ye.optional=Ae},7014:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.postConstruct=void 0;var Le=fe(16674),J=fe(6867),y=fe(47738);function Ae(){return function(T,ce,pe){var Fe=new y.Metadata(J.POST_CONSTRUCT,ce);if(Reflect.hasOwnMetadata(J.POST_CONSTRUCT,T.constructor))throw new Error(Le.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(J.POST_CONSTRUCT,Fe,T.constructor)}}ye.postConstruct=Ae},32052:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.tagged=void 0;var Le=fe(47738),J=fe(99934);function y(Ae,T){return function(ce,pe,Fe){var _e=new Le.Metadata(Ae,T);typeof Fe=="number"?J.tagParameter(ce,pe,Fe,_e):J.tagProperty(ce,pe,_e)}}ye.tagged=y},55638:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.targetName=void 0;var Le=fe(6867),J=fe(47738),y=fe(99934);function Ae(T){return function(ce,pe,Fe){var _e=new J.Metadata(Le.NAME_TAG,T);y.tagParameter(ce,pe,Fe,_e)}}ye.targetName=Ae},86757:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.unmanaged=void 0;var Le=fe(6867),J=fe(47738),y=fe(99934);function Ae(){return function(T,ce,pe){var Fe=new J.Metadata(Le.UNMANAGED_TAG,!0);y.tagParameter(T,ce,pe,Fe)}}ye.unmanaged=Ae},44290:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.Binding=void 0;var Le=fe(28421),J=fe(37791),y=function(){function Ae(T,ce){this.id=J.id(),this.activated=!1,this.serviceIdentifier=T,this.scope=ce,this.type=Le.BindingTypeEnum.Invalid,this.constraint=function(pe){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Ae.prototype.clone=function(){var T=new Ae(this.serviceIdentifier,this.scope);return T.activated=T.scope===Le.BindingScopeEnum.Singleton?this.activated:!1,T.implementationType=this.implementationType,T.dynamicValue=this.dynamicValue,T.scope=this.scope,T.type=this.type,T.factory=this.factory,T.provider=this.provider,T.constraint=this.constraint,T.onActivation=this.onActivation,T.cache=this.cache,T},Ae}();ye.Binding=y},23184:function(nn,ye){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.BindingCount=void 0;var fe={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};ye.BindingCount=fe},16674:function(nn,ye){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.STACK_OVERFLOW=ye.CIRCULAR_DEPENDENCY_IN_FACTORY=ye.POST_CONSTRUCT_ERROR=ye.MULTIPLE_POST_CONSTRUCT_METHODS=ye.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=ye.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=ye.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=ye.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=ye.ARGUMENTS_LENGTH_MISMATCH=ye.INVALID_DECORATOR_OPERATION=ye.INVALID_TO_SELF_VALUE=ye.INVALID_FUNCTION_BINDING=ye.INVALID_MIDDLEWARE_RETURN=ye.NO_MORE_SNAPSHOTS_AVAILABLE=ye.INVALID_BINDING_TYPE=ye.NOT_IMPLEMENTED=ye.CIRCULAR_DEPENDENCY=ye.UNDEFINED_INJECT_ANNOTATION=ye.MISSING_INJECT_ANNOTATION=ye.MISSING_INJECTABLE_ANNOTATION=ye.NOT_REGISTERED=ye.CANNOT_UNBIND=ye.AMBIGUOUS_MATCH=ye.KEY_NOT_FOUND=ye.NULL_ARGUMENT=ye.DUPLICATED_METADATA=ye.DUPLICATED_INJECTABLE_DECORATOR=void 0,ye.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",ye.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",ye.NULL_ARGUMENT="NULL argument",ye.KEY_NOT_FOUND="Key Not Found",ye.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",ye.CANNOT_UNBIND="Could not unbind serviceIdentifier:",ye.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",ye.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",ye.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var fe=function(Ae){return"@inject called with undefined this could mean that the class "+Ae+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};ye.UNDEFINED_INJECT_ANNOTATION=fe,ye.CIRCULAR_DEPENDENCY="Circular dependency found:",ye.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",ye.INVALID_BINDING_TYPE="Invalid binding type:",ye.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",ye.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",ye.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",ye.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",ye.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Le=function(){for(var Ae=[],T=0;T<arguments.length;T++)Ae[T]=arguments[T];return"The number of constructor arguments in the derived class "+(Ae[0]+" must be >= than the number of constructor arguments of its base class.")};ye.ARGUMENTS_LENGTH_MISMATCH=Le,ye.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",ye.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",ye.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",ye.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",ye.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var J=function(){for(var Ae=[],T=0;T<arguments.length;T++)Ae[T]=arguments[T];return"@postConstruct error in class "+Ae[0]+": "+Ae[1]};ye.POST_CONSTRUCT_ERROR=J;var y=function(){for(var Ae=[],T=0;T<arguments.length;T++)Ae[T]=arguments[T];return"It looks like there is a circular dependency "+("in one of the '"+Ae[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Ae[1]+"'.")};ye.CIRCULAR_DEPENDENCY_IN_FACTORY=y,ye.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(nn,ye){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.TargetTypeEnum=ye.BindingTypeEnum=ye.BindingScopeEnum=void 0;var fe={Request:"Request",Singleton:"Singleton",Transient:"Transient"};ye.BindingScopeEnum=fe;var Le={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};ye.BindingTypeEnum=Le;var J={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};ye.TargetTypeEnum=J},6867:function(nn,ye){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.NON_CUSTOM_TAG_KEYS=ye.POST_CONSTRUCT=ye.DESIGN_PARAM_TYPES=ye.PARAM_TYPES=ye.TAGGED_PROP=ye.TAGGED=ye.MULTI_INJECT_TAG=ye.INJECT_TAG=ye.OPTIONAL_TAG=ye.UNMANAGED_TAG=ye.NAME_TAG=ye.NAMED_TAG=void 0,ye.NAMED_TAG="named",ye.NAME_TAG="name",ye.UNMANAGED_TAG="unmanaged",ye.OPTIONAL_TAG="optional",ye.INJECT_TAG="inject",ye.MULTI_INJECT_TAG="multi_inject",ye.TAGGED="inversify:tagged",ye.TAGGED_PROP="inversify:tagged_props",ye.PARAM_TYPES="inversify:paramtypes",ye.DESIGN_PARAM_TYPES="design:paramtypes",ye.POST_CONSTRUCT="post_construct";function fe(){return[ye.INJECT_TAG,ye.MULTI_INJECT_TAG,ye.NAME_TAG,ye.UNMANAGED_TAG,ye.NAMED_TAG,ye.OPTIONAL_TAG]}ye.NON_CUSTOM_TAG_KEYS=fe()},51389:function(nn,ye,fe){"use strict";var Le=this&&this.__awaiter||function(Gt,wt,Bt,gr){function K(ur){return ur instanceof Bt?ur:new Bt(function(Tt){Tt(ur)})}return new(Bt||(Bt=Promise))(function(ur,Tt){function ht(lr){try{pt(gr.next(lr))}catch(Br){Tt(Br)}}function Ot(lr){try{pt(gr.throw(lr))}catch(Br){Tt(Br)}}function pt(lr){lr.done?ur(lr.value):K(lr.value).then(ht,Ot)}pt((gr=gr.apply(Gt,wt||[])).next())})},J=this&&this.__generator||function(Gt,wt){var Bt={label:0,sent:function(){if(ur[0]&1)throw ur[1];return ur[1]},trys:[],ops:[]},gr,K,ur,Tt;return Tt={next:ht(0),throw:ht(1),return:ht(2)},typeof Symbol=="function"&&(Tt[Symbol.iterator]=function(){return this}),Tt;function ht(pt){return function(lr){return Ot([pt,lr])}}function Ot(pt){if(gr)throw new TypeError("Generator is already executing.");for(;Bt;)try{if(gr=1,K&&(ur=pt[0]&2?K.return:pt[0]?K.throw||((ur=K.return)&&ur.call(K),0):K.next)&&!(ur=ur.call(K,pt[1])).done)return ur;switch(K=0,ur&&(pt=[pt[0]&2,ur.value]),pt[0]){case 0:case 1:ur=pt;break;case 4:return Bt.label++,{value:pt[1],done:!1};case 5:Bt.label++,K=pt[1],pt=[0];continue;case 7:pt=Bt.ops.pop(),Bt.trys.pop();continue;default:if(ur=Bt.trys,!(ur=ur.length>0&&ur[ur.length-1])&&(pt[0]===6||pt[0]===2)){Bt=0;continue}if(pt[0]===3&&(!ur||pt[1]>ur[0]&&pt[1]<ur[3])){Bt.label=pt[1];break}if(pt[0]===6&&Bt.label<ur[1]){Bt.label=ur[1],ur=pt;break}if(ur&&Bt.label<ur[2]){Bt.label=ur[2],Bt.ops.push(pt);break}ur[2]&&Bt.ops.pop(),Bt.trys.pop();continue}pt=wt.call(Gt,Bt)}catch(lr){pt=[6,lr],K=0}finally{gr=ur=0}if(pt[0]&5)throw pt[1];return{value:pt[0]?pt[1]:void 0,done:!0}}},y=this&&this.__spreadArray||function(Gt,wt){for(var Bt=0,gr=wt.length,K=Gt.length;Bt<gr;Bt++,K++)Gt[K]=wt[Bt];return Gt};Object.defineProperty(ye,"__esModule",{value:!0}),ye.Container=void 0;var Ae=fe(44290),T=fe(16674),ce=fe(28421),pe=fe(6867),Fe=fe(51377),_e=fe(86311),Ge=fe(31927),ot=fe(51860),ft=fe(37791),kt=fe(55800),ar=fe(85700),xt=fe(80175),Jt=function(){function Gt(wt){this._appliedMiddleware=[];var Bt=wt||{};if(typeof Bt!="object")throw new Error(""+T.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(Bt.defaultScope===void 0)Bt.defaultScope=ce.BindingScopeEnum.Transient;else if(Bt.defaultScope!==ce.BindingScopeEnum.Singleton&&Bt.defaultScope!==ce.BindingScopeEnum.Transient&&Bt.defaultScope!==ce.BindingScopeEnum.Request)throw new Error(""+T.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(Bt.autoBindInjectable===void 0)Bt.autoBindInjectable=!1;else if(typeof Bt.autoBindInjectable!="boolean")throw new Error(""+T.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(Bt.skipBaseClassChecks===void 0)Bt.skipBaseClassChecks=!1;else if(typeof Bt.skipBaseClassChecks!="boolean")throw new Error(""+T.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:Bt.autoBindInjectable,defaultScope:Bt.defaultScope,skipBaseClassChecks:Bt.skipBaseClassChecks},this.id=ft.id(),this._bindingDictionary=new xt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Fe.MetadataReader}return Gt.merge=function(wt,Bt){for(var gr=[],K=2;K<arguments.length;K++)gr[K-2]=arguments[K];var ur=new Gt,Tt=y([wt,Bt],gr).map(function(pt){return _e.getBindingDictionary(pt)}),ht=_e.getBindingDictionary(ur);function Ot(pt,lr){pt.traverse(function(Br,q){q.forEach(function(ge){lr.add(ge.serviceIdentifier,ge.clone())})})}return Tt.forEach(function(pt){Ot(pt,ht)}),ur},Gt.prototype.load=function(){for(var wt=[],Bt=0;Bt<arguments.length;Bt++)wt[Bt]=arguments[Bt];for(var gr=this._getContainerModuleHelpersFactory(),K=0,ur=wt;K<ur.length;K++){var Tt=ur[K],ht=gr(Tt.id);Tt.registry(ht.bindFunction,ht.unbindFunction,ht.isboundFunction,ht.rebindFunction)}},Gt.prototype.loadAsync=function(){for(var wt=[],Bt=0;Bt<arguments.length;Bt++)wt[Bt]=arguments[Bt];return Le(this,void 0,void 0,function(){var gr,K,ur,Tt,ht;return J(this,function(Ot){switch(Ot.label){case 0:gr=this._getContainerModuleHelpersFactory(),K=0,ur=wt,Ot.label=1;case 1:return K<ur.length?(Tt=ur[K],ht=gr(Tt.id),[4,Tt.registry(ht.bindFunction,ht.unbindFunction,ht.isboundFunction,ht.rebindFunction)]):[3,4];case 2:Ot.sent(),Ot.label=3;case 3:return K++,[3,1];case 4:return[2]}})})},Gt.prototype.unload=function(){for(var wt=this,Bt=[],gr=0;gr<arguments.length;gr++)Bt[gr]=arguments[gr];var K=function(ur){return function(Tt){return Tt.moduleId===ur}};Bt.forEach(function(ur){var Tt=K(ur.id);wt._bindingDictionary.removeByCondition(Tt)})},Gt.prototype.bind=function(wt){var Bt=this.options.defaultScope||ce.BindingScopeEnum.Transient,gr=new Ae.Binding(wt,Bt);return this._bindingDictionary.add(wt,gr),new ot.BindingToSyntax(gr)},Gt.prototype.rebind=function(wt){return this.unbind(wt),this.bind(wt)},Gt.prototype.unbind=function(wt){try{this._bindingDictionary.remove(wt)}catch(Bt){throw new Error(T.CANNOT_UNBIND+" "+kt.getServiceIdentifierAsString(wt))}},Gt.prototype.unbindAll=function(){this._bindingDictionary=new xt.Lookup},Gt.prototype.isBound=function(wt){var Bt=this._bindingDictionary.hasKey(wt);return!Bt&&this.parent&&(Bt=this.parent.isBound(wt)),Bt},Gt.prototype.isBoundNamed=function(wt,Bt){return this.isBoundTagged(wt,pe.NAMED_TAG,Bt)},Gt.prototype.isBoundTagged=function(wt,Bt,gr){var K=!1;if(this._bindingDictionary.hasKey(wt)){var ur=this._bindingDictionary.get(wt),Tt=_e.createMockRequest(this,wt,Bt,gr);K=ur.some(function(ht){return ht.constraint(Tt)})}return!K&&this.parent&&(K=this.parent.isBoundTagged(wt,Bt,gr)),K},Gt.prototype.snapshot=function(){this._snapshots.push(ar.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Gt.prototype.restore=function(){var wt=this._snapshots.pop();if(wt===void 0)throw new Error(T.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=wt.bindings,this._middleware=wt.middleware},Gt.prototype.createChild=function(wt){var Bt=new Gt(wt||this.options);return Bt.parent=this,Bt},Gt.prototype.applyMiddleware=function(){for(var wt=[],Bt=0;Bt<arguments.length;Bt++)wt[Bt]=arguments[Bt];this._appliedMiddleware=this._appliedMiddleware.concat(wt);var gr=this._middleware?this._middleware:this._planAndResolve();this._middleware=wt.reduce(function(K,ur){return ur(K)},gr)},Gt.prototype.applyCustomMetadataReader=function(wt){this._metadataReader=wt},Gt.prototype.get=function(wt){return this._get(!1,!1,ce.TargetTypeEnum.Variable,wt)},Gt.prototype.getTagged=function(wt,Bt,gr){return this._get(!1,!1,ce.TargetTypeEnum.Variable,wt,Bt,gr)},Gt.prototype.getNamed=function(wt,Bt){return this.getTagged(wt,pe.NAMED_TAG,Bt)},Gt.prototype.getAll=function(wt){return this._get(!0,!0,ce.TargetTypeEnum.Variable,wt)},Gt.prototype.getAllTagged=function(wt,Bt,gr){return this._get(!1,!0,ce.TargetTypeEnum.Variable,wt,Bt,gr)},Gt.prototype.getAllNamed=function(wt,Bt){return this.getAllTagged(wt,pe.NAMED_TAG,Bt)},Gt.prototype.resolve=function(wt){var Bt=this.createChild();return Bt.bind(wt).toSelf(),this._appliedMiddleware.forEach(function(gr){Bt.applyMiddleware(gr)}),Bt.get(wt)},Gt.prototype._getContainerModuleHelpersFactory=function(){var wt=this,Bt=function(ht,Ot){ht._binding.moduleId=Ot},gr=function(ht){return function(Ot){var pt=wt.bind.bind(wt),lr=pt(Ot);return Bt(lr,ht),lr}},K=function(ht){return function(Ot){var pt=wt.unbind.bind(wt);pt(Ot)}},ur=function(ht){return function(Ot){var pt=wt.isBound.bind(wt);return pt(Ot)}},Tt=function(ht){return function(Ot){var pt=wt.rebind.bind(wt),lr=pt(Ot);return Bt(lr,ht),lr}};return function(ht){return{bindFunction:gr(ht),isboundFunction:ur(ht),rebindFunction:Tt(ht),unbindFunction:K(ht)}}},Gt.prototype._get=function(wt,Bt,gr,K,ur,Tt){var ht=null,Ot={avoidConstraints:wt,contextInterceptor:function(pt){return pt},isMultiInject:Bt,key:ur,serviceIdentifier:K,targetType:gr,value:Tt};if(this._middleware){if(ht=this._middleware(Ot),ht==null)throw new Error(T.INVALID_MIDDLEWARE_RETURN)}else ht=this._planAndResolve()(Ot);return ht},Gt.prototype._planAndResolve=function(){var wt=this;return function(Bt){var gr=_e.plan(wt._metadataReader,wt,Bt.isMultiInject,Bt.targetType,Bt.serviceIdentifier,Bt.key,Bt.value,Bt.avoidConstraints);gr=Bt.contextInterceptor(gr);var K=Ge.resolve(gr);return K}},Gt}();ye.Container=Jt},33244:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.AsyncContainerModule=ye.ContainerModule=void 0;var Le=fe(37791),J=function(){function Ae(T){this.id=Le.id(),this.registry=T}return Ae}();ye.ContainerModule=J;var y=function(){function Ae(T){this.id=Le.id(),this.registry=T}return Ae}();ye.AsyncContainerModule=y},85700:function(nn,ye){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.ContainerSnapshot=void 0;var fe=function(){function Le(){}return Le.of=function(J,y){var Ae=new Le;return Ae.bindings=J,Ae.middleware=y,Ae},Le}();ye.ContainerSnapshot=fe},80175:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.Lookup=void 0;var Le=fe(16674),J=function(){function y(){this._map=new Map}return y.prototype.getMap=function(){return this._map},y.prototype.add=function(Ae,T){if(Ae==null)throw new Error(Le.NULL_ARGUMENT);if(T==null)throw new Error(Le.NULL_ARGUMENT);var ce=this._map.get(Ae);ce!==void 0?(ce.push(T),this._map.set(Ae,ce)):this._map.set(Ae,[T])},y.prototype.get=function(Ae){if(Ae==null)throw new Error(Le.NULL_ARGUMENT);var T=this._map.get(Ae);if(T!==void 0)return T;throw new Error(Le.KEY_NOT_FOUND)},y.prototype.remove=function(Ae){if(Ae==null)throw new Error(Le.NULL_ARGUMENT);if(!this._map.delete(Ae))throw new Error(Le.KEY_NOT_FOUND)},y.prototype.removeByCondition=function(Ae){var T=this;this._map.forEach(function(ce,pe){var Fe=ce.filter(function(_e){return!Ae(_e)});Fe.length>0?T._map.set(pe,Fe):T._map.delete(pe)})},y.prototype.hasKey=function(Ae){if(Ae==null)throw new Error(Le.NULL_ARGUMENT);return this._map.has(Ae)},y.prototype.clone=function(){var Ae=new y;return this._map.forEach(function(T,ce){T.forEach(function(pe){return Ae.add(ce,pe.clone())})}),Ae},y.prototype.traverse=function(Ae){this._map.forEach(function(T,ce){Ae(ce,T)})},y}();ye.Lookup=J},86700:function(nn,ye,fe){"use strict";var Le;Le={value:!0},Le=Le=Le=Le=Le=Le=ye.GW=Le=Le=ye.zY=Le=Le=Le=Le=Le=ye.f3=Le=Le=ye.b2=Le=Le=Le=Le=Le=ye.W2=Le=void 0;var J=fe(6867);Le=J;var y=fe(51389);Object.defineProperty(ye,"W2",{enumerable:!0,get:function(){return y.Container}});var Ae=fe(28421);Le={enumerable:!0,get:function(){return Ae.BindingScopeEnum}},Le={enumerable:!0,get:function(){return Ae.BindingTypeEnum}},Le={enumerable:!0,get:function(){return Ae.TargetTypeEnum}};var T=fe(33244);Le={enumerable:!0,get:function(){return T.AsyncContainerModule}},Le={enumerable:!0,get:function(){return T.ContainerModule}};var ce=fe(64315);Object.defineProperty(ye,"b2",{enumerable:!0,get:function(){return ce.injectable}});var pe=fe(32052);Le={enumerable:!0,get:function(){return pe.tagged}};var Fe=fe(38085);Le={enumerable:!0,get:function(){return Fe.named}};var _e=fe(5744);Object.defineProperty(ye,"f3",{enumerable:!0,get:function(){return _e.inject}}),Le={enumerable:!0,get:function(){return _e.LazyServiceIdentifer}};var Ge=fe(6515);Le={enumerable:!0,get:function(){return Ge.optional}};var ot=fe(86757);Le={enumerable:!0,get:function(){return ot.unmanaged}};var ft=fe(71693);Le={enumerable:!0,get:function(){return ft.multiInject}};var kt=fe(55638);Le={enumerable:!0,get:function(){return kt.targetName}};var ar=fe(7014);Object.defineProperty(ye,"zY",{enumerable:!0,get:function(){return ar.postConstruct}});var xt=fe(51377);Le={enumerable:!0,get:function(){return xt.MetadataReader}};var Jt=fe(37791);Le={enumerable:!0,get:function(){return Jt.id}};var Gt=fe(99934);Object.defineProperty(ye,"GW",{enumerable:!0,get:function(){return Gt.decorate}});var wt=fe(80758);Le={enumerable:!0,get:function(){return wt.traverseAncerstors}},Le={enumerable:!0,get:function(){return wt.taggedConstraint}},Le={enumerable:!0,get:function(){return wt.namedConstraint}},Le={enumerable:!0,get:function(){return wt.typeConstraint}};var Bt=fe(55800);Le={enumerable:!0,get:function(){return Bt.getServiceIdentifierAsString}};var gr=fe(70600);Le={enumerable:!0,get:function(){return gr.multiBindToService}}},95228:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.Context=void 0;var Le=fe(37791),J=function(){function y(Ae){this.id=Le.id(),this.container=Ae}return y.prototype.addPlan=function(Ae){this.plan=Ae},y.prototype.setCurrentRequest=function(Ae){this.currentRequest=Ae},y}();ye.Context=J},47738:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.Metadata=void 0;var Le=fe(6867),J=function(){function y(Ae,T){this.key=Ae,this.value=T}return y.prototype.toString=function(){return this.key===Le.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},y}();ye.Metadata=J},51377:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.MetadataReader=void 0;var Le=fe(6867),J=function(){function y(){}return y.prototype.getConstructorMetadata=function(Ae){var T=Reflect.getMetadata(Le.PARAM_TYPES,Ae),ce=Reflect.getMetadata(Le.TAGGED,Ae);return{compilerGeneratedMetadata:T,userGeneratedMetadata:ce||{}}},y.prototype.getPropertiesMetadata=function(Ae){var T=Reflect.getMetadata(Le.TAGGED_PROP,Ae)||[];return T},y}();ye.MetadataReader=J},55314:function(nn,ye){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.Plan=void 0;var fe=function(){function Le(J,y){this.parentContext=J,this.rootRequest=y}return Le}();ye.Plan=fe},86311:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.getBindingDictionary=ye.createMockRequest=ye.plan=void 0;var Le=fe(23184),J=fe(16674),y=fe(28421),Ae=fe(6867),T=fe(85265),ce=fe(55800),pe=fe(95228),Fe=fe(47738),_e=fe(55314),Ge=fe(6e3),ot=fe(6748),ft=fe(18924);function kt(K){return K._bindingDictionary}ye.getBindingDictionary=kt;function ar(K,ur,Tt,ht,Ot,pt){var lr=K?Ae.MULTI_INJECT_TAG:Ae.INJECT_TAG,Br=new Fe.Metadata(lr,Tt),q=new ft.Target(ur,ht,Tt,Br);if(Ot!==void 0){var ge=new Fe.Metadata(Ot,pt);q.metadata.push(ge)}return q}function xt(K,ur,Tt,ht,Ot){var pt=wt(Tt.container,Ot.serviceIdentifier),lr=[];return pt.length===Le.BindingCount.NoBindingsAvailable&&Tt.container.options.autoBindInjectable&&typeof Ot.serviceIdentifier=="function"&&K.getConstructorMetadata(Ot.serviceIdentifier).compilerGeneratedMetadata&&(Tt.container.bind(Ot.serviceIdentifier).toSelf(),pt=wt(Tt.container,Ot.serviceIdentifier)),ur?lr=pt:lr=pt.filter(function(Br){var q=new ot.Request(Br.serviceIdentifier,Tt,ht,Br,Ot);return Br.constraint(q)}),Jt(Ot.serviceIdentifier,lr,Ot,Tt.container),lr}function Jt(K,ur,Tt,ht){switch(ur.length){case Le.BindingCount.NoBindingsAvailable:if(Tt.isOptional())return ur;var Ot=ce.getServiceIdentifierAsString(K),pt=J.NOT_REGISTERED;throw pt+=ce.listMetadataForTarget(Ot,Tt),pt+=ce.listRegisteredBindingsForServiceIdentifier(ht,Ot,wt),new Error(pt);case Le.BindingCount.OnlyOneBindingAvailable:if(!Tt.isArray())return ur;case Le.BindingCount.MultipleBindingsAvailable:default:if(Tt.isArray())return ur;var Ot=ce.getServiceIdentifierAsString(K),pt=J.AMBIGUOUS_MATCH+" "+Ot;throw pt+=ce.listRegisteredBindingsForServiceIdentifier(ht,Ot,wt),new Error(pt)}}function Gt(K,ur,Tt,ht,Ot,pt){var lr,Br;if(Ot===null){lr=xt(K,ur,ht,null,pt),Br=new ot.Request(Tt,ht,null,lr,pt);var q=new _e.Plan(ht,Br);ht.addPlan(q)}else lr=xt(K,ur,ht,Ot,pt),Br=Ot.addChildRequest(pt.serviceIdentifier,lr,pt);lr.forEach(function(ge){var Q=null;if(pt.isArray())Q=Br.addChildRequest(ge.serviceIdentifier,ge,pt);else{if(ge.cache)return;Q=Br}if(ge.type===y.BindingTypeEnum.Instance&&ge.implementationType!==null){var Me=Ge.getDependencies(K,ge.implementationType);if(!ht.container.options.skipBaseClassChecks){var ee=Ge.getBaseClassDependencyCount(K,ge.implementationType);if(Me.length<ee){var oe=J.ARGUMENTS_LENGTH_MISMATCH(Ge.getFunctionName(ge.implementationType));throw new Error(oe)}}Me.forEach(function(bt){Gt(K,!1,bt.serviceIdentifier,ht,Q,bt)})}})}function wt(K,ur){var Tt=[],ht=kt(K);return ht.hasKey(ur)?Tt=ht.get(ur):K.parent!==null&&(Tt=wt(K.parent,ur)),Tt}function Bt(K,ur,Tt,ht,Ot,pt,lr,Br){Br===void 0&&(Br=!1);var q=new pe.Context(ur),ge=ar(Tt,ht,Ot,"",pt,lr);try{return Gt(K,Br,Ot,q,null,ge),q}catch(Q){throw T.isStackOverflowExeption(Q)&&q.plan&&ce.circularDependencyToException(q.plan.rootRequest),Q}}ye.plan=Bt;function gr(K,ur,Tt,ht){var Ot=new ft.Target(y.TargetTypeEnum.Variable,"",ur,new Fe.Metadata(Tt,ht)),pt=new pe.Context(K),lr=new ot.Request(ur,pt,null,[],Ot);return lr}ye.createMockRequest=gr},88460:function(nn,ye){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.QueryableString=void 0;var fe=function(){function Le(J){this.str=J}return Le.prototype.startsWith=function(J){return this.str.indexOf(J)===0},Le.prototype.endsWith=function(J){var y="",Ae=J.split("").reverse().join("");return y=this.str.split("").reverse().join(""),this.startsWith.call({str:y},Ae)},Le.prototype.contains=function(J){return this.str.indexOf(J)!==-1},Le.prototype.equals=function(J){return this.str===J},Le.prototype.value=function(){return this.str},Le}();ye.QueryableString=fe},6e3:function(nn,ye,fe){"use strict";var Le=this&&this.__spreadArray||function(xt,Jt){for(var Gt=0,wt=Jt.length,Bt=xt.length;Gt<wt;Gt++,Bt++)xt[Bt]=Jt[Gt];return xt};Object.defineProperty(ye,"__esModule",{value:!0}),ye.getFunctionName=ye.getBaseClassDependencyCount=ye.getDependencies=void 0;var J=fe(5744),y=fe(16674),Ae=fe(28421),T=fe(6867),ce=fe(55800);Object.defineProperty(ye,"getFunctionName",{enumerable:!0,get:function(){return ce.getFunctionName}});var pe=fe(18924);function Fe(xt,Jt){var Gt=ce.getFunctionName(Jt),wt=_e(xt,Gt,Jt,!1);return wt}ye.getDependencies=Fe;function _e(xt,Jt,Gt,wt){var Bt=xt.getConstructorMetadata(Gt),gr=Bt.compilerGeneratedMetadata;if(gr===void 0){var K=y.MISSING_INJECTABLE_ANNOTATION+" "+Jt+".";throw new Error(K)}var ur=Bt.userGeneratedMetadata,Tt=Object.keys(ur),ht=Gt.length===0&&Tt.length>0,Ot=Tt.length>Gt.length,pt=ht||Ot?Tt.length:Gt.length,lr=ot(wt,Jt,gr,ur,pt),Br=ft(xt,Gt),q=Le(Le([],lr),Br);return q}function Ge(xt,Jt,Gt,wt,Bt){var gr=Bt[xt.toString()]||[],K=ar(gr),ur=K.unmanaged!==!0,Tt=wt[xt],ht=K.inject||K.multiInject;if(Tt=ht||Tt,Tt instanceof J.LazyServiceIdentifer&&(Tt=Tt.unwrap()),ur){var Ot=Tt===Object,pt=Tt===Function,lr=Tt===void 0,Br=Ot||pt||lr;if(!Jt&&Br){var q=y.MISSING_INJECT_ANNOTATION+" argument "+xt+" in class "+Gt+".";throw new Error(q)}var ge=new pe.Target(Ae.TargetTypeEnum.ConstructorArgument,K.targetName,Tt);return ge.metadata=gr,ge}return null}function ot(xt,Jt,Gt,wt,Bt){for(var gr=[],K=0;K<Bt;K++){var ur=K,Tt=Ge(ur,xt,Jt,Gt,wt);Tt!==null&&gr.push(Tt)}return gr}function ft(xt,Jt){for(var Gt=xt.getPropertiesMetadata(Jt),wt=[],Bt=Object.keys(Gt),gr=0,K=Bt;gr<K.length;gr++){var ur=K[gr],Tt=Gt[ur],ht=ar(Gt[ur]),Ot=ht.targetName||ur,pt=ht.inject||ht.multiInject,lr=new pe.Target(Ae.TargetTypeEnum.ClassProperty,Ot,pt);lr.metadata=Tt,wt.push(lr)}var Br=Object.getPrototypeOf(Jt.prototype).constructor;if(Br!==Object){var q=ft(xt,Br);wt=Le(Le([],wt),q)}return wt}function kt(xt,Jt){var Gt=Object.getPrototypeOf(Jt.prototype).constructor;if(Gt!==Object){var wt=ce.getFunctionName(Gt),Bt=_e(xt,wt,Gt,!0),gr=Bt.map(function(Tt){return Tt.metadata.filter(function(ht){return ht.key===T.UNMANAGED_TAG})}),K=[].concat.apply([],gr).length,ur=Bt.length-K;return ur>0?ur:kt(xt,Gt)}else return 0}ye.getBaseClassDependencyCount=kt;function ar(xt){var Jt={};return xt.forEach(function(Gt){Jt[Gt.key.toString()]=Gt.value}),{inject:Jt[T.INJECT_TAG],multiInject:Jt[T.MULTI_INJECT_TAG],targetName:Jt[T.NAME_TAG],unmanaged:Jt[T.UNMANAGED_TAG]}}},6748:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.Request=void 0;var Le=fe(37791),J=function(){function y(Ae,T,ce,pe,Fe){this.id=Le.id(),this.serviceIdentifier=Ae,this.parentContext=T,this.parentRequest=ce,this.target=Fe,this.childRequests=[],this.bindings=Array.isArray(pe)?pe:[pe],this.requestScope=ce===null?new Map:null}return y.prototype.addChildRequest=function(Ae,T,ce){var pe=new y(Ae,this.parentContext,this,T,ce);return this.childRequests.push(pe),pe},y}();ye.Request=J},18924:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.Target=void 0;var Le=fe(6867),J=fe(37791),y=fe(47738),Ae=fe(88460),T=function(){function ce(pe,Fe,_e,Ge){this.id=J.id(),this.type=pe,this.serviceIdentifier=_e,this.name=new Ae.QueryableString(Fe||""),this.metadata=new Array;var ot=null;typeof Ge=="string"?ot=new y.Metadata(Le.NAMED_TAG,Ge):Ge instanceof y.Metadata&&(ot=Ge),ot!==null&&this.metadata.push(ot)}return ce.prototype.hasTag=function(pe){for(var Fe=0,_e=this.metadata;Fe<_e.length;Fe++){var Ge=_e[Fe];if(Ge.key===pe)return!0}return!1},ce.prototype.isArray=function(){return this.hasTag(Le.MULTI_INJECT_TAG)},ce.prototype.matchesArray=function(pe){return this.matchesTag(Le.MULTI_INJECT_TAG)(pe)},ce.prototype.isNamed=function(){return this.hasTag(Le.NAMED_TAG)},ce.prototype.isTagged=function(){return this.metadata.some(function(pe){return Le.NON_CUSTOM_TAG_KEYS.every(function(Fe){return pe.key!==Fe})})},ce.prototype.isOptional=function(){return this.matchesTag(Le.OPTIONAL_TAG)(!0)},ce.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(pe){return pe.key===Le.NAMED_TAG})[0]:null},ce.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(pe){return Le.NON_CUSTOM_TAG_KEYS.every(function(Fe){return pe.key!==Fe})}):null},ce.prototype.matchesNamedTag=function(pe){return this.matchesTag(Le.NAMED_TAG)(pe)},ce.prototype.matchesTag=function(pe){var Fe=this;return function(_e){for(var Ge=0,ot=Fe.metadata;Ge<ot.length;Ge++){var ft=ot[Ge];if(ft.key===pe&&ft.value===_e)return!0}return!1}},ce}();ye.Target=T},52279:function(nn,ye,fe){"use strict";var Le=this&&this.__spreadArray||function(_e,Ge){for(var ot=0,ft=Ge.length,kt=_e.length;ot<ft;ot++,kt++)_e[kt]=Ge[ot];return _e};Object.defineProperty(ye,"__esModule",{value:!0}),ye.resolveInstance=void 0;var J=fe(16674),y=fe(28421),Ae=fe(6867);function T(_e,Ge,ot){var ft=Ge.filter(function(ar){return ar.target!==null&&ar.target.type===y.TargetTypeEnum.ClassProperty}),kt=ft.map(ot);return ft.forEach(function(ar,xt){var Jt="";Jt=ar.target.name.value();var Gt=kt[xt];_e[Jt]=Gt}),_e}function ce(_e,Ge){return new(_e.bind.apply(_e,Le([void 0],Ge)))}function pe(_e,Ge){if(Reflect.hasMetadata(Ae.POST_CONSTRUCT,_e)){var ot=Reflect.getMetadata(Ae.POST_CONSTRUCT,_e);try{Ge[ot.value]()}catch(ft){throw new Error(J.POST_CONSTRUCT_ERROR(_e.name,ft.message))}}}function Fe(_e,Ge,ot){var ft=null;if(Ge.length>0){var kt=Ge.filter(function(xt){return xt.target!==null&&xt.target.type===y.TargetTypeEnum.ConstructorArgument}),ar=kt.map(ot);ft=ce(_e,ar),ft=T(ft,Ge,ot)}else ft=new _e;return pe(_e,ft),ft}ye.resolveInstance=Fe},31927:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.resolve=void 0;var Le=fe(16674),J=fe(28421),y=fe(85265),Ae=fe(55800),T=fe(52279),ce=function(_e,Ge,ot){try{return ot()}catch(ft){throw y.isStackOverflowExeption(ft)?new Error(Le.CIRCULAR_DEPENDENCY_IN_FACTORY(_e,Ge.toString())):ft}},pe=function(_e){return function(Ge){Ge.parentContext.setCurrentRequest(Ge);var ot=Ge.bindings,ft=Ge.childRequests,kt=Ge.target&&Ge.target.isArray(),ar=!Ge.parentRequest||!Ge.parentRequest.target||!Ge.target||!Ge.parentRequest.target.matchesArray(Ge.target.serviceIdentifier);if(kt&&ar)return ft.map(function(gr){var K=pe(_e);return K(gr)});var xt=null;if(Ge.target.isOptional()&&ot.length===0)return;var Jt=ot[0],Gt=Jt.scope===J.BindingScopeEnum.Singleton,wt=Jt.scope===J.BindingScopeEnum.Request;if(Gt&&Jt.activated)return Jt.cache;if(wt&&_e!==null&&_e.has(Jt.id))return _e.get(Jt.id);if(Jt.type===J.BindingTypeEnum.ConstantValue)xt=Jt.cache,Jt.activated=!0;else if(Jt.type===J.BindingTypeEnum.Function)xt=Jt.cache,Jt.activated=!0;else if(Jt.type===J.BindingTypeEnum.Constructor)xt=Jt.implementationType;else if(Jt.type===J.BindingTypeEnum.DynamicValue&&Jt.dynamicValue!==null)xt=ce("toDynamicValue",Jt.serviceIdentifier,function(){return Jt.dynamicValue(Ge.parentContext)});else if(Jt.type===J.BindingTypeEnum.Factory&&Jt.factory!==null)xt=ce("toFactory",Jt.serviceIdentifier,function(){return Jt.factory(Ge.parentContext)});else if(Jt.type===J.BindingTypeEnum.Provider&&Jt.provider!==null)xt=ce("toProvider",Jt.serviceIdentifier,function(){return Jt.provider(Ge.parentContext)});else if(Jt.type===J.BindingTypeEnum.Instance&&Jt.implementationType!==null)xt=T.resolveInstance(Jt.implementationType,ft,pe(_e));else{var Bt=Ae.getServiceIdentifierAsString(Ge.serviceIdentifier);throw new Error(Le.INVALID_BINDING_TYPE+" "+Bt)}return typeof Jt.onActivation=="function"&&(xt=Jt.onActivation(Ge.parentContext,xt)),Gt&&(Jt.cache=xt,Jt.activated=!0),wt&&_e!==null&&!_e.has(Jt.id)&&_e.set(Jt.id,xt),xt}};function Fe(_e){var Ge=pe(_e.plan.rootRequest.requestScope);return Ge(_e.plan.rootRequest)}ye.resolve=Fe},83366:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.BindingInSyntax=void 0;var Le=fe(28421),J=fe(71325),y=function(){function Ae(T){this._binding=T}return Ae.prototype.inRequestScope=function(){return this._binding.scope=Le.BindingScopeEnum.Request,new J.BindingWhenOnSyntax(this._binding)},Ae.prototype.inSingletonScope=function(){return this._binding.scope=Le.BindingScopeEnum.Singleton,new J.BindingWhenOnSyntax(this._binding)},Ae.prototype.inTransientScope=function(){return this._binding.scope=Le.BindingScopeEnum.Transient,new J.BindingWhenOnSyntax(this._binding)},Ae}();ye.BindingInSyntax=y},99812:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.BindingInWhenOnSyntax=void 0;var Le=fe(83366),J=fe(51811),y=fe(98370),Ae=function(){function T(ce){this._binding=ce,this._bindingWhenSyntax=new y.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new J.BindingOnSyntax(this._binding),this._bindingInSyntax=new Le.BindingInSyntax(ce)}return T.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},T.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},T.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},T.prototype.when=function(ce){return this._bindingWhenSyntax.when(ce)},T.prototype.whenTargetNamed=function(ce){return this._bindingWhenSyntax.whenTargetNamed(ce)},T.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},T.prototype.whenTargetTagged=function(ce,pe){return this._bindingWhenSyntax.whenTargetTagged(ce,pe)},T.prototype.whenInjectedInto=function(ce){return this._bindingWhenSyntax.whenInjectedInto(ce)},T.prototype.whenParentNamed=function(ce){return this._bindingWhenSyntax.whenParentNamed(ce)},T.prototype.whenParentTagged=function(ce,pe){return this._bindingWhenSyntax.whenParentTagged(ce,pe)},T.prototype.whenAnyAncestorIs=function(ce){return this._bindingWhenSyntax.whenAnyAncestorIs(ce)},T.prototype.whenNoAncestorIs=function(ce){return this._bindingWhenSyntax.whenNoAncestorIs(ce)},T.prototype.whenAnyAncestorNamed=function(ce){return this._bindingWhenSyntax.whenAnyAncestorNamed(ce)},T.prototype.whenAnyAncestorTagged=function(ce,pe){return this._bindingWhenSyntax.whenAnyAncestorTagged(ce,pe)},T.prototype.whenNoAncestorNamed=function(ce){return this._bindingWhenSyntax.whenNoAncestorNamed(ce)},T.prototype.whenNoAncestorTagged=function(ce,pe){return this._bindingWhenSyntax.whenNoAncestorTagged(ce,pe)},T.prototype.whenAnyAncestorMatches=function(ce){return this._bindingWhenSyntax.whenAnyAncestorMatches(ce)},T.prototype.whenNoAncestorMatches=function(ce){return this._bindingWhenSyntax.whenNoAncestorMatches(ce)},T.prototype.onActivation=function(ce){return this._bindingOnSyntax.onActivation(ce)},T}();ye.BindingInWhenOnSyntax=Ae},51811:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.BindingOnSyntax=void 0;var Le=fe(98370),J=function(){function y(Ae){this._binding=Ae}return y.prototype.onActivation=function(Ae){return this._binding.onActivation=Ae,new Le.BindingWhenSyntax(this._binding)},y}();ye.BindingOnSyntax=J},51860:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.BindingToSyntax=void 0;var Le=fe(16674),J=fe(28421),y=fe(99812),Ae=fe(71325),T=function(){function ce(pe){this._binding=pe}return ce.prototype.to=function(pe){return this._binding.type=J.BindingTypeEnum.Instance,this._binding.implementationType=pe,new y.BindingInWhenOnSyntax(this._binding)},ce.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Le.INVALID_TO_SELF_VALUE);var pe=this._binding.serviceIdentifier;return this.to(pe)},ce.prototype.toConstantValue=function(pe){return this._binding.type=J.BindingTypeEnum.ConstantValue,this._binding.cache=pe,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=J.BindingScopeEnum.Singleton,new Ae.BindingWhenOnSyntax(this._binding)},ce.prototype.toDynamicValue=function(pe){return this._binding.type=J.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=pe,this._binding.implementationType=null,new y.BindingInWhenOnSyntax(this._binding)},ce.prototype.toConstructor=function(pe){return this._binding.type=J.BindingTypeEnum.Constructor,this._binding.implementationType=pe,this._binding.scope=J.BindingScopeEnum.Singleton,new Ae.BindingWhenOnSyntax(this._binding)},ce.prototype.toFactory=function(pe){return this._binding.type=J.BindingTypeEnum.Factory,this._binding.factory=pe,this._binding.scope=J.BindingScopeEnum.Singleton,new Ae.BindingWhenOnSyntax(this._binding)},ce.prototype.toFunction=function(pe){if(typeof pe!="function")throw new Error(Le.INVALID_FUNCTION_BINDING);var Fe=this.toConstantValue(pe);return this._binding.type=J.BindingTypeEnum.Function,this._binding.scope=J.BindingScopeEnum.Singleton,Fe},ce.prototype.toAutoFactory=function(pe){return this._binding.type=J.BindingTypeEnum.Factory,this._binding.factory=function(Fe){var _e=function(){return Fe.container.get(pe)};return _e},this._binding.scope=J.BindingScopeEnum.Singleton,new Ae.BindingWhenOnSyntax(this._binding)},ce.prototype.toProvider=function(pe){return this._binding.type=J.BindingTypeEnum.Provider,this._binding.provider=pe,this._binding.scope=J.BindingScopeEnum.Singleton,new Ae.BindingWhenOnSyntax(this._binding)},ce.prototype.toService=function(pe){this.toDynamicValue(function(Fe){return Fe.container.get(pe)})},ce}();ye.BindingToSyntax=T},71325:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.BindingWhenOnSyntax=void 0;var Le=fe(51811),J=fe(98370),y=function(){function Ae(T){this._binding=T,this._bindingWhenSyntax=new J.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Le.BindingOnSyntax(this._binding)}return Ae.prototype.when=function(T){return this._bindingWhenSyntax.when(T)},Ae.prototype.whenTargetNamed=function(T){return this._bindingWhenSyntax.whenTargetNamed(T)},Ae.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Ae.prototype.whenTargetTagged=function(T,ce){return this._bindingWhenSyntax.whenTargetTagged(T,ce)},Ae.prototype.whenInjectedInto=function(T){return this._bindingWhenSyntax.whenInjectedInto(T)},Ae.prototype.whenParentNamed=function(T){return this._bindingWhenSyntax.whenParentNamed(T)},Ae.prototype.whenParentTagged=function(T,ce){return this._bindingWhenSyntax.whenParentTagged(T,ce)},Ae.prototype.whenAnyAncestorIs=function(T){return this._bindingWhenSyntax.whenAnyAncestorIs(T)},Ae.prototype.whenNoAncestorIs=function(T){return this._bindingWhenSyntax.whenNoAncestorIs(T)},Ae.prototype.whenAnyAncestorNamed=function(T){return this._bindingWhenSyntax.whenAnyAncestorNamed(T)},Ae.prototype.whenAnyAncestorTagged=function(T,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(T,ce)},Ae.prototype.whenNoAncestorNamed=function(T){return this._bindingWhenSyntax.whenNoAncestorNamed(T)},Ae.prototype.whenNoAncestorTagged=function(T,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(T,ce)},Ae.prototype.whenAnyAncestorMatches=function(T){return this._bindingWhenSyntax.whenAnyAncestorMatches(T)},Ae.prototype.whenNoAncestorMatches=function(T){return this._bindingWhenSyntax.whenNoAncestorMatches(T)},Ae.prototype.onActivation=function(T){return this._bindingOnSyntax.onActivation(T)},Ae}();ye.BindingWhenOnSyntax=y},98370:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.BindingWhenSyntax=void 0;var Le=fe(51811),J=fe(80758),y=function(){function Ae(T){this._binding=T}return Ae.prototype.when=function(T){return this._binding.constraint=T,new Le.BindingOnSyntax(this._binding)},Ae.prototype.whenTargetNamed=function(T){return this._binding.constraint=J.namedConstraint(T),new Le.BindingOnSyntax(this._binding)},Ae.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(T){var ce=T.target!==null&&!T.target.isNamed()&&!T.target.isTagged();return ce},new Le.BindingOnSyntax(this._binding)},Ae.prototype.whenTargetTagged=function(T,ce){return this._binding.constraint=J.taggedConstraint(T)(ce),new Le.BindingOnSyntax(this._binding)},Ae.prototype.whenInjectedInto=function(T){return this._binding.constraint=function(ce){return J.typeConstraint(T)(ce.parentRequest)},new Le.BindingOnSyntax(this._binding)},Ae.prototype.whenParentNamed=function(T){return this._binding.constraint=function(ce){return J.namedConstraint(T)(ce.parentRequest)},new Le.BindingOnSyntax(this._binding)},Ae.prototype.whenParentTagged=function(T,ce){return this._binding.constraint=function(pe){return J.taggedConstraint(T)(ce)(pe.parentRequest)},new Le.BindingOnSyntax(this._binding)},Ae.prototype.whenAnyAncestorIs=function(T){return this._binding.constraint=function(ce){return J.traverseAncerstors(ce,J.typeConstraint(T))},new Le.BindingOnSyntax(this._binding)},Ae.prototype.whenNoAncestorIs=function(T){return this._binding.constraint=function(ce){return!J.traverseAncerstors(ce,J.typeConstraint(T))},new Le.BindingOnSyntax(this._binding)},Ae.prototype.whenAnyAncestorNamed=function(T){return this._binding.constraint=function(ce){return J.traverseAncerstors(ce,J.namedConstraint(T))},new Le.BindingOnSyntax(this._binding)},Ae.prototype.whenNoAncestorNamed=function(T){return this._binding.constraint=function(ce){return!J.traverseAncerstors(ce,J.namedConstraint(T))},new Le.BindingOnSyntax(this._binding)},Ae.prototype.whenAnyAncestorTagged=function(T,ce){return this._binding.constraint=function(pe){return J.traverseAncerstors(pe,J.taggedConstraint(T)(ce))},new Le.BindingOnSyntax(this._binding)},Ae.prototype.whenNoAncestorTagged=function(T,ce){return this._binding.constraint=function(pe){return!J.traverseAncerstors(pe,J.taggedConstraint(T)(ce))},new Le.BindingOnSyntax(this._binding)},Ae.prototype.whenAnyAncestorMatches=function(T){return this._binding.constraint=function(ce){return J.traverseAncerstors(ce,T)},new Le.BindingOnSyntax(this._binding)},Ae.prototype.whenNoAncestorMatches=function(T){return this._binding.constraint=function(ce){return!J.traverseAncerstors(ce,T)},new Le.BindingOnSyntax(this._binding)},Ae}();ye.BindingWhenSyntax=y},80758:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.typeConstraint=ye.namedConstraint=ye.taggedConstraint=ye.traverseAncerstors=void 0;var Le=fe(6867),J=fe(47738),y=function(pe,Fe){var _e=pe.parentRequest;return _e!==null?Fe(_e)?!0:y(_e,Fe):!1};ye.traverseAncerstors=y;var Ae=function(pe){return function(Fe){var _e=function(Ge){return Ge!==null&&Ge.target!==null&&Ge.target.matchesTag(pe)(Fe)};return _e.metaData=new J.Metadata(pe,Fe),_e}};ye.taggedConstraint=Ae;var T=Ae(Le.NAMED_TAG);ye.namedConstraint=T;var ce=function(pe){return function(Fe){var _e=null;if(Fe!==null)if(_e=Fe.bindings[0],typeof pe=="string"){var Ge=_e.serviceIdentifier;return Ge===pe}else{var ot=Fe.bindings[0].implementationType;return pe===ot}return!1}};ye.typeConstraint=ce},70600:function(nn,ye){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.multiBindToService=void 0;var fe=function(Le){return function(J){return function(){for(var y=[],Ae=0;Ae<arguments.length;Ae++)y[Ae]=arguments[Ae];return y.forEach(function(T){return Le.bind(T).toService(J)})}}};ye.multiBindToService=fe},85265:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.isStackOverflowExeption=void 0;var Le=fe(16674);function J(y){return y instanceof RangeError||y.message===Le.STACK_OVERFLOW}ye.isStackOverflowExeption=J},37791:function(nn,ye){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.id=void 0;var fe=0;function Le(){return fe++}ye.id=Le},55800:function(nn,ye,fe){"use strict";Object.defineProperty(ye,"__esModule",{value:!0}),ye.circularDependencyToException=ye.listMetadataForTarget=ye.listRegisteredBindingsForServiceIdentifier=ye.getServiceIdentifierAsString=ye.getFunctionName=void 0;var Le=fe(16674);function J(_e){if(typeof _e=="function"){var Ge=_e;return Ge.name}else{if(typeof _e=="symbol")return _e.toString();var Ge=_e;return Ge}}ye.getServiceIdentifierAsString=J;function y(_e,Ge,ot){var ft="",kt=ot(_e,Ge);return kt.length!==0&&(ft=`
Registered bindings:`,kt.forEach(function(ar){var xt="Object";ar.implementationType!==null&&(xt=Fe(ar.implementationType)),ft=ft+`
 `+xt,ar.constraint.metaData&&(ft=ft+" - "+ar.constraint.metaData)})),ft}ye.listRegisteredBindingsForServiceIdentifier=y;function Ae(_e,Ge){return _e.parentRequest===null?!1:_e.parentRequest.serviceIdentifier===Ge?!0:Ae(_e.parentRequest,Ge)}function T(_e){function Ge(ft,kt){kt===void 0&&(kt=[]);var ar=J(ft.serviceIdentifier);return kt.push(ar),ft.parentRequest!==null?Ge(ft.parentRequest,kt):kt}var ot=Ge(_e);return ot.reverse().join(" --> ")}function ce(_e){_e.childRequests.forEach(function(Ge){if(Ae(Ge,Ge.serviceIdentifier)){var ot=T(Ge);throw new Error(Le.CIRCULAR_DEPENDENCY+" "+ot)}else ce(Ge)})}ye.circularDependencyToException=ce;function pe(_e,Ge){if(Ge.isTagged()||Ge.isNamed()){var ot="",ft=Ge.getNamedTag(),kt=Ge.getCustomTags();return ft!==null&&(ot+=ft.toString()+`
`),kt!==null&&kt.forEach(function(ar){ot+=ar.toString()+`
`})," "+_e+`
 `+_e+" - "+ot}else return" "+_e}ye.listMetadataForTarget=pe;function Fe(_e){if(_e.name)return _e.name;var Ge=_e.toString(),ot=Ge.match(/^function\s*([^\s(]+)/);return ot?ot[1]:"Anonymous function: "+Ge}ye.getFunctionName=Fe},31745:function(nn){"use strict";nn.exports=fe,nn.exports.default=fe;var ye=1e20;function fe(T,ce,pe,Fe,_e,Ge){this.fontSize=T||24,this.buffer=ce===void 0?3:ce,this.cutoff=Fe||.25,this.fontFamily=_e||"sans-serif",this.fontWeight=Ge||"normal",this.radius=pe||8;var ot=this.size=this.fontSize+this.buffer*2,ft=ot+this.buffer*2,kt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;kt?this.canvas=my.createOffscreenCanvas(ot,ot,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=ot),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(ft*ft),this.gridInner=new Float64Array(ft*ft),this.f=new Float64Array(ft),this.z=new Float64Array(ft+1),this.v=new Uint16Array(ft),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,kt?this.middle=Math.round(ot/2*1):this.middle=Math.round(ot/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Le(T,ce,pe,Fe,_e,Ge,ot){Ge.fill(ye,0,ce*pe),ot.fill(0,0,ce*pe);for(var ft=(ce-Fe)/2,kt=0;kt<_e;kt++)for(var ar=0;ar<Fe;ar++){var xt=(kt+ft)*ce+ar+ft,Jt=T.data[4*(kt*Fe+ar)+3]/255;if(Jt===1)Ge[xt]=0,ot[xt]=ye;else if(Jt===0)Ge[xt]=ye,ot[xt]=0;else{var Gt=Math.max(0,.5-Jt),wt=Math.max(0,Jt-.5);Ge[xt]=Gt*Gt,ot[xt]=wt*wt}}}function J(T,ce,pe,Fe,_e,Ge,ot){for(var ft=0;ft<ce*pe;ft++){var kt=Math.sqrt(Fe[ft])-Math.sqrt(_e[ft]);T[ft]=Math.round(255-255*(kt/Ge+ot))}}fe.prototype._draw=function(T,ce){var pe=this.ctx.measureText(T),Fe=pe.width,_e=2*this.buffer,Ge,ot,ft,kt,ar,xt,Jt,Gt;ce&&this.useMetrics?(ar=Math.floor(pe.actualBoundingBoxAscent),Gt=this.buffer+Math.ceil(pe.actualBoundingBoxAscent),xt=this.buffer,Jt=this.buffer,ot=Math.min(this.size,Math.ceil(pe.actualBoundingBoxRight-pe.actualBoundingBoxLeft)),kt=Math.min(this.size-xt,Math.ceil(pe.actualBoundingBoxAscent+pe.actualBoundingBoxDescent)),Ge=ot+_e,ft=kt+_e,this.ctx.textBaseline="alphabetic"):(Ge=ot=this.size,ft=kt=this.size,ar=19*this.fontSize/24,xt=Jt=0,Gt=this.middle,this.ctx.textBaseline="middle");var wt;ot&&kt&&(this.ctx.clearRect(Jt,xt,ot,kt),this.ctx.fillText(T,this.buffer,Gt),wt=this.ctx.getImageData(Jt,xt,ot,kt));var Bt=new Uint8ClampedArray(Ge*ft);return Le(wt,Ge,ft,ot,kt,this.gridOuter,this.gridInner),y(this.gridOuter,Ge,ft,this.f,this.v,this.z),y(this.gridInner,Ge,ft,this.f,this.v,this.z),J(Bt,Ge,ft,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:Bt,metrics:{width:ot,height:kt,sdfWidth:Ge,sdfHeight:ft,top:ar,left:0,advance:Fe}}},fe.prototype.draw=function(T){return this._draw(T,!1).data},fe.prototype.drawWithMetrics=function(T){return this._draw(T,!0)};function y(T,ce,pe,Fe,_e,Ge){for(var ot=0;ot<ce;ot++)Ae(T,ot,ce,pe,Fe,_e,Ge);for(var ft=0;ft<pe;ft++)Ae(T,ft*ce,1,ce,Fe,_e,Ge)}function Ae(T,ce,pe,Fe,_e,Ge,ot){var ft,kt,ar,xt;for(Ge[0]=0,ot[0]=-ye,ot[1]=ye,ft=0;ft<Fe;ft++)_e[ft]=T[ce+ft*pe];for(ft=1,kt=0,ar=0;ft<Fe;ft++){do xt=Ge[kt],ar=(_e[ft]-_e[xt]+ft*ft-xt*xt)/(ft-xt)/2;while(ar<=ot[kt]&&--kt>-1);kt++,Ge[kt]=ft,ot[kt]=ar,ot[kt+1]=ye}for(ft=0,kt=0;ft<Fe;ft++){for(;ot[kt+1]<ft;)kt++;xt=Ge[kt],T[ce+ft*pe]=_e[xt]+(ft-xt)*(ft-xt)}}},18857:function(nn,ye,fe){"use strict";fe.r(ye),fe.d(ye,{Function:function(){return Ks},Interpreter:function(){return Pa},default:function(){return Rl},evaluate:function(){return el},vm:function(){return Le}});var Le={};fe.r(Le),fe.d(Le,{Script:function(){return ml},compileFunction:function(){return cf},createContext:function(){return Nc},runInContext:function(){return Os},runInNewContext:function(){return ff}});var J={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},y="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Ae={5:y,"5module":y+" export import",6:y+" const class extends export import super"},T=/^in(stanceof)?$/,ce="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",pe="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Fe=new RegExp("["+ce+"]"),_e=new RegExp("["+ce+pe+"]");ce=pe=null;var Ge=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],ot=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function ft(x,I){for(var U=65536,R=0;R<I.length;R+=2){if(U+=I[R],U>x)return!1;if(U+=I[R+1],U>=x)return!0}}function kt(x,I){return x<65?x===36:x<91?!0:x<97?x===95:x<123?!0:x<=65535?x>=170&&Fe.test(String.fromCharCode(x)):I===!1?!1:ft(x,Ge)}function ar(x,I){return x<48?x===36:x<58?!0:x<65?!1:x<91?!0:x<97?x===95:x<123?!0:x<=65535?x>=170&&_e.test(String.fromCharCode(x)):I===!1?!1:ft(x,Ge)||ft(x,ot)}var xt=function(I,U){U===void 0&&(U={}),this.label=I,this.keyword=U.keyword,this.beforeExpr=!!U.beforeExpr,this.startsExpr=!!U.startsExpr,this.isLoop=!!U.isLoop,this.isAssign=!!U.isAssign,this.prefix=!!U.prefix,this.postfix=!!U.postfix,this.binop=U.binop||null,this.updateContext=null};function Jt(x,I){return new xt(x,{beforeExpr:!0,binop:I})}var Gt={beforeExpr:!0},wt={startsExpr:!0},Bt={};function gr(x,I){return I===void 0&&(I={}),I.keyword=x,Bt[x]=new xt(x,I)}var K={num:new xt("num",wt),regexp:new xt("regexp",wt),string:new xt("string",wt),name:new xt("name",wt),eof:new xt("eof"),bracketL:new xt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new xt("]"),braceL:new xt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new xt("}"),parenL:new xt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new xt(")"),comma:new xt(",",Gt),semi:new xt(";",Gt),colon:new xt(":",Gt),dot:new xt("."),question:new xt("?",Gt),questionDot:new xt("?."),arrow:new xt("=>",Gt),template:new xt("template"),invalidTemplate:new xt("invalidTemplate"),ellipsis:new xt("...",Gt),backQuote:new xt("`",wt),dollarBraceL:new xt("${",{beforeExpr:!0,startsExpr:!0}),eq:new xt("=",{beforeExpr:!0,isAssign:!0}),assign:new xt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new xt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new xt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Jt("||",1),logicalAND:Jt("&&",2),bitwiseOR:Jt("|",3),bitwiseXOR:Jt("^",4),bitwiseAND:Jt("&",5),equality:Jt("==/!=/===/!==",6),relational:Jt("</>/<=/>=",7),bitShift:Jt("<</>>/>>>",8),plusMin:new xt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Jt("%",10),star:Jt("*",10),slash:Jt("/",10),starstar:new xt("**",{beforeExpr:!0}),coalesce:Jt("??",1),_break:gr("break"),_case:gr("case",Gt),_catch:gr("catch"),_continue:gr("continue"),_debugger:gr("debugger"),_default:gr("default",Gt),_do:gr("do",{isLoop:!0,beforeExpr:!0}),_else:gr("else",Gt),_finally:gr("finally"),_for:gr("for",{isLoop:!0}),_function:gr("function",wt),_if:gr("if"),_return:gr("return",Gt),_switch:gr("switch"),_throw:gr("throw",Gt),_try:gr("try"),_var:gr("var"),_const:gr("const"),_while:gr("while",{isLoop:!0}),_with:gr("with"),_new:gr("new",{beforeExpr:!0,startsExpr:!0}),_this:gr("this",wt),_super:gr("super",wt),_class:gr("class",wt),_extends:gr("extends",Gt),_export:gr("export"),_import:gr("import",wt),_null:gr("null",wt),_true:gr("true",wt),_false:gr("false",wt),_in:gr("in",{beforeExpr:!0,binop:7}),_instanceof:gr("instanceof",{beforeExpr:!0,binop:7}),_typeof:gr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:gr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:gr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},ur=/\r\n?|\n|\u2028|\u2029/,Tt=new RegExp(ur.source,"g");function ht(x,I){return x===10||x===13||!I&&(x===8232||x===8233)}var Ot=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,pt=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,lr=Object.prototype,Br=lr.hasOwnProperty,q=lr.toString;function ge(x,I){return Br.call(x,I)}var Q=Array.isArray||function(x){return q.call(x)==="[object Array]"};function Me(x){return new RegExp("^(?:"+x.replace(/ /g,"|")+")$")}var ee=function(I,U){this.line=I,this.column=U};ee.prototype.offset=function(I){return new ee(this.line,this.column+I)};var oe=function(I,U,R){this.start=U,this.end=R,I.sourceFile!==null&&(this.source=I.sourceFile)};function bt(x,I){for(var U=1,R=0;;){Tt.lastIndex=R;var ne=Tt.exec(x);if(ne&&ne.index<I)++U,R=ne.index+ne[0].length;else return new ee(U,I-R)}}var Nt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function jt(x){var I={};for(var U in Nt)I[U]=x&&ge(x,U)?x[U]:Nt[U];if(I.ecmaVersion>=2015&&(I.ecmaVersion-=2009),I.allowReserved==null&&(I.allowReserved=I.ecmaVersion<5),Q(I.onToken)){var R=I.onToken;I.onToken=function(ne){return R.push(ne)}}return Q(I.onComment)&&(I.onComment=Qt(I,I.onComment)),I}function Qt(x,I){return function(U,R,ne,ke,it,Pt){var Lt={type:U?"Block":"Line",value:R,start:ne,end:ke};x.locations&&(Lt.loc=new oe(this,it,Pt)),x.ranges&&(Lt.range=[ne,ke]),I.push(Lt)}}var ln=1,Dr=2,oi=ln|Dr,Zn=4,Vn=8,Xi=16,Ci=32,fi=64,Hi=128;function Ni(x,I){return Dr|(x?Zn:0)|(I?Vn:0)}var hi=0,Xn=1,ri=2,po=3,Ha=4,wa=5,Et=function(I,U,R){this.options=I=jt(I),this.sourceFile=I.sourceFile,this.keywords=Me(Ae[I.ecmaVersion>=6?6:I.sourceType==="module"?"5module":5]);var ne="";if(I.allowReserved!==!0){for(var ke=I.ecmaVersion;!(ne=J[ke]);ke--);I.sourceType==="module"&&(ne+=" await")}this.reservedWords=Me(ne);var it=(ne?ne+" ":"")+J.strict;this.reservedWordsStrict=Me(it),this.reservedWordsStrictBind=Me(it+" "+J.strictBind),this.input=String(U),this.containsEsc=!1,R?(this.pos=R,this.lineStart=this.input.lastIndexOf(`
`,R-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(ur).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=K.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=I.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&I.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(ln),this.regexpState=null},me={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Et.prototype.parse=function(){var I=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(I)},me.inFunction.get=function(){return(this.currentVarScope().flags&Dr)>0},me.inGenerator.get=function(){return(this.currentVarScope().flags&Vn)>0},me.inAsync.get=function(){return(this.currentVarScope().flags&Zn)>0},me.allowSuper.get=function(){return(this.currentThisScope().flags&fi)>0},me.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Hi)>0},me.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Et.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&Dr)>0},Et.extend=function(){for(var I=[],U=arguments.length;U--;)I[U]=arguments[U];for(var R=this,ne=0;ne<I.length;ne++)R=I[ne](R);return R},Et.parse=function(I,U){return new this(U,I).parse()},Et.parseExpressionAt=function(I,U,R){var ne=new this(R,I,U);return ne.nextToken(),ne.parseExpression()},Et.tokenizer=function(I,U){return new this(U,I)},Object.defineProperties(Et.prototype,me);var se=Et.prototype,Se=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;se.strictDirective=function(x){for(;;){pt.lastIndex=x,x+=pt.exec(this.input)[0].length;var I=Se.exec(this.input.slice(x));if(!I)return!1;if((I[1]||I[2])==="use strict"){pt.lastIndex=x+I[0].length;var U=pt.exec(this.input),R=U.index+U[0].length,ne=this.input.charAt(R);return ne===";"||ne==="}"||ur.test(U[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(ne)||ne==="!"&&this.input.charAt(R+1)==="=")}x+=I[0].length,pt.lastIndex=x,x+=pt.exec(this.input)[0].length,this.input[x]===";"&&x++}},se.eat=function(x){return this.type===x?(this.next(),!0):!1},se.isContextual=function(x){return this.type===K.name&&this.value===x&&!this.containsEsc},se.eatContextual=function(x){return this.isContextual(x)?(this.next(),!0):!1},se.expectContextual=function(x){this.eatContextual(x)||this.unexpected()},se.canInsertSemicolon=function(){return this.type===K.eof||this.type===K.braceR||ur.test(this.input.slice(this.lastTokEnd,this.start))},se.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},se.semicolon=function(){!this.eat(K.semi)&&!this.insertSemicolon()&&this.unexpected()},se.afterTrailingComma=function(x,I){if(this.type===x)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),I||this.next(),!0},se.expect=function(x){this.eat(x)||this.unexpected()},se.unexpected=function(x){this.raise(x!=null?x:this.start,"Unexpected token")};function z(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}se.checkPatternErrors=function(x,I){if(!!x){x.trailingComma>-1&&this.raiseRecoverable(x.trailingComma,"Comma is not permitted after the rest element");var U=I?x.parenthesizedAssign:x.parenthesizedBind;U>-1&&this.raiseRecoverable(U,"Parenthesized pattern")}},se.checkExpressionErrors=function(x,I){if(!x)return!1;var U=x.shorthandAssign,R=x.doubleProto;if(!I)return U>=0||R>=0;U>=0&&this.raise(U,"Shorthand property assignments are valid only in destructuring patterns"),R>=0&&this.raiseRecoverable(R,"Redefinition of __proto__ property")},se.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},se.isSimpleAssignTarget=function(x){return x.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(x.expression):x.type==="Identifier"||x.type==="MemberExpression"};var qe=Et.prototype;qe.parseTopLevel=function(x){var I={};for(x.body||(x.body=[]);this.type!==K.eof;){var U=this.parseStatement(null,!0,I);x.body.push(U)}if(this.inModule)for(var R=0,ne=Object.keys(this.undefinedExports);R<ne.length;R+=1){var ke=ne[R];this.raiseRecoverable(this.undefinedExports[ke].start,"Export '"+ke+"' is not defined")}return this.adaptDirectivePrologue(x.body),this.next(),x.sourceType=this.options.sourceType,this.finishNode(x,"Program")};var qt={kind:"loop"},Or={kind:"switch"};qe.isLet=function(x){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;pt.lastIndex=this.pos;var I=pt.exec(this.input),U=this.pos+I[0].length,R=this.input.charCodeAt(U);if(R===91)return!0;if(x)return!1;if(R===123)return!0;if(kt(R,!0)){for(var ne=U+1;ar(this.input.charCodeAt(ne),!0);)++ne;var ke=this.input.slice(U,ne);if(!T.test(ke))return!0}return!1},qe.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;pt.lastIndex=this.pos;var x=pt.exec(this.input),I=this.pos+x[0].length;return!ur.test(this.input.slice(this.pos,I))&&this.input.slice(I,I+8)==="function"&&(I+8===this.input.length||!ar(this.input.charAt(I+8)))},qe.parseStatement=function(x,I,U){var R=this.type,ne=this.startNode(),ke;switch(this.isLet(x)&&(R=K._var,ke="let"),R){case K._break:case K._continue:return this.parseBreakContinueStatement(ne,R.keyword);case K._debugger:return this.parseDebuggerStatement(ne);case K._do:return this.parseDoStatement(ne);case K._for:return this.parseForStatement(ne);case K._function:return x&&(this.strict||x!=="if"&&x!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(ne,!1,!x);case K._class:return x&&this.unexpected(),this.parseClass(ne,!0);case K._if:return this.parseIfStatement(ne);case K._return:return this.parseReturnStatement(ne);case K._switch:return this.parseSwitchStatement(ne);case K._throw:return this.parseThrowStatement(ne);case K._try:return this.parseTryStatement(ne);case K._const:case K._var:return ke=ke||this.value,x&&ke!=="var"&&this.unexpected(),this.parseVarStatement(ne,ke);case K._while:return this.parseWhileStatement(ne);case K._with:return this.parseWithStatement(ne);case K.braceL:return this.parseBlock(!0,ne);case K.semi:return this.parseEmptyStatement(ne);case K._export:case K._import:if(this.options.ecmaVersion>10&&R===K._import){pt.lastIndex=this.pos;var it=pt.exec(this.input),Pt=this.pos+it[0].length,Lt=this.input.charCodeAt(Pt);if(Lt===40||Lt===46)return this.parseExpressionStatement(ne,this.parseExpression())}return this.options.allowImportExportEverywhere||(I||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),R===K._import?this.parseImport(ne):this.parseExport(ne,U);default:if(this.isAsyncFunction())return x&&this.unexpected(),this.next(),this.parseFunctionStatement(ne,!0,!x);var yr=this.value,Lr=this.parseExpression();return R===K.name&&Lr.type==="Identifier"&&this.eat(K.colon)?this.parseLabeledStatement(ne,yr,Lr,x):this.parseExpressionStatement(ne,Lr)}},qe.parseBreakContinueStatement=function(x,I){var U=I==="break";this.next(),this.eat(K.semi)||this.insertSemicolon()?x.label=null:this.type!==K.name?this.unexpected():(x.label=this.parseIdent(),this.semicolon());for(var R=0;R<this.labels.length;++R){var ne=this.labels[R];if((x.label==null||ne.name===x.label.name)&&(ne.kind!=null&&(U||ne.kind==="loop")||x.label&&U))break}return R===this.labels.length&&this.raise(x.start,"Unsyntactic "+I),this.finishNode(x,U?"BreakStatement":"ContinueStatement")},qe.parseDebuggerStatement=function(x){return this.next(),this.semicolon(),this.finishNode(x,"DebuggerStatement")},qe.parseDoStatement=function(x){return this.next(),this.labels.push(qt),x.body=this.parseStatement("do"),this.labels.pop(),this.expect(K._while),x.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(K.semi):this.semicolon(),this.finishNode(x,"DoWhileStatement")},qe.parseForStatement=function(x){this.next();var I=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(qt),this.enterScope(0),this.expect(K.parenL),this.type===K.semi)return I>-1&&this.unexpected(I),this.parseFor(x,null);var U=this.isLet();if(this.type===K._var||this.type===K._const||U){var R=this.startNode(),ne=U?"let":this.value;return this.next(),this.parseVar(R,!0,ne),this.finishNode(R,"VariableDeclaration"),(this.type===K._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&R.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===K._in?I>-1&&this.unexpected(I):x.await=I>-1),this.parseForIn(x,R)):(I>-1&&this.unexpected(I),this.parseFor(x,R))}var ke=new z,it=this.parseExpression(!0,ke);return this.type===K._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===K._in?I>-1&&this.unexpected(I):x.await=I>-1),this.toAssignable(it,!1,ke),this.checkLVal(it),this.parseForIn(x,it)):(this.checkExpressionErrors(ke,!0),I>-1&&this.unexpected(I),this.parseFor(x,it))},qe.parseFunctionStatement=function(x,I,U){return this.next(),this.parseFunction(x,Mt|(U?0:pr),!1,I)},qe.parseIfStatement=function(x){return this.next(),x.test=this.parseParenExpression(),x.consequent=this.parseStatement("if"),x.alternate=this.eat(K._else)?this.parseStatement("if"):null,this.finishNode(x,"IfStatement")},qe.parseReturnStatement=function(x){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(K.semi)||this.insertSemicolon()?x.argument=null:(x.argument=this.parseExpression(),this.semicolon()),this.finishNode(x,"ReturnStatement")},qe.parseSwitchStatement=function(x){this.next(),x.discriminant=this.parseParenExpression(),x.cases=[],this.expect(K.braceL),this.labels.push(Or),this.enterScope(0);for(var I,U=!1;this.type!==K.braceR;)if(this.type===K._case||this.type===K._default){var R=this.type===K._case;I&&this.finishNode(I,"SwitchCase"),x.cases.push(I=this.startNode()),I.consequent=[],this.next(),R?I.test=this.parseExpression():(U&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),U=!0,I.test=null),this.expect(K.colon)}else I||this.unexpected(),I.consequent.push(this.parseStatement(null));return this.exitScope(),I&&this.finishNode(I,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(x,"SwitchStatement")},qe.parseThrowStatement=function(x){return this.next(),ur.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),x.argument=this.parseExpression(),this.semicolon(),this.finishNode(x,"ThrowStatement")};var Ye=[];qe.parseTryStatement=function(x){if(this.next(),x.block=this.parseBlock(),x.handler=null,this.type===K._catch){var I=this.startNode();if(this.next(),this.eat(K.parenL)){I.param=this.parseBindingAtom();var U=I.param.type==="Identifier";this.enterScope(U?Ci:0),this.checkLVal(I.param,U?Ha:ri),this.expect(K.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),I.param=null,this.enterScope(0);I.body=this.parseBlock(!1),this.exitScope(),x.handler=this.finishNode(I,"CatchClause")}return x.finalizer=this.eat(K._finally)?this.parseBlock():null,!x.handler&&!x.finalizer&&this.raise(x.start,"Missing catch or finally clause"),this.finishNode(x,"TryStatement")},qe.parseVarStatement=function(x,I){return this.next(),this.parseVar(x,!1,I),this.semicolon(),this.finishNode(x,"VariableDeclaration")},qe.parseWhileStatement=function(x){return this.next(),x.test=this.parseParenExpression(),this.labels.push(qt),x.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(x,"WhileStatement")},qe.parseWithStatement=function(x){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),x.object=this.parseParenExpression(),x.body=this.parseStatement("with"),this.finishNode(x,"WithStatement")},qe.parseEmptyStatement=function(x){return this.next(),this.finishNode(x,"EmptyStatement")},qe.parseLabeledStatement=function(x,I,U,R){for(var ne=0,ke=this.labels;ne<ke.length;ne+=1){var it=ke[ne];it.name===I&&this.raise(U.start,"Label '"+I+"' is already declared")}for(var Pt=this.type.isLoop?"loop":this.type===K._switch?"switch":null,Lt=this.labels.length-1;Lt>=0;Lt--){var yr=this.labels[Lt];if(yr.statementStart===x.start)yr.statementStart=this.start,yr.kind=Pt;else break}return this.labels.push({name:I,kind:Pt,statementStart:this.start}),x.body=this.parseStatement(R?R.indexOf("label")===-1?R+"label":R:"label"),this.labels.pop(),x.label=U,this.finishNode(x,"LabeledStatement")},qe.parseExpressionStatement=function(x,I){return x.expression=I,this.semicolon(),this.finishNode(x,"ExpressionStatement")},qe.parseBlock=function(x,I,U){for(x===void 0&&(x=!0),I===void 0&&(I=this.startNode()),I.body=[],this.expect(K.braceL),x&&this.enterScope(0);this.type!==K.braceR;){var R=this.parseStatement(null);I.body.push(R)}return U&&(this.strict=!1),this.next(),x&&this.exitScope(),this.finishNode(I,"BlockStatement")},qe.parseFor=function(x,I){return x.init=I,this.expect(K.semi),x.test=this.type===K.semi?null:this.parseExpression(),this.expect(K.semi),x.update=this.type===K.parenR?null:this.parseExpression(),this.expect(K.parenR),x.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(x,"ForStatement")},qe.parseForIn=function(x,I){var U=this.type===K._in;return this.next(),I.type==="VariableDeclaration"&&I.declarations[0].init!=null&&(!U||this.options.ecmaVersion<8||this.strict||I.kind!=="var"||I.declarations[0].id.type!=="Identifier")?this.raise(I.start,(U?"for-in":"for-of")+" loop variable declaration may not have an initializer"):I.type==="AssignmentPattern"&&this.raise(I.start,"Invalid left-hand side in for-loop"),x.left=I,x.right=U?this.parseExpression():this.parseMaybeAssign(),this.expect(K.parenR),x.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(x,U?"ForInStatement":"ForOfStatement")},qe.parseVar=function(x,I,U){for(x.declarations=[],x.kind=U;;){var R=this.startNode();if(this.parseVarId(R,U),this.eat(K.eq)?R.init=this.parseMaybeAssign(I):U==="const"&&!(this.type===K._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():R.id.type!=="Identifier"&&!(I&&(this.type===K._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):R.init=null,x.declarations.push(this.finishNode(R,"VariableDeclarator")),!this.eat(K.comma))break}return x},qe.parseVarId=function(x,I){x.id=this.parseBindingAtom(),this.checkLVal(x.id,I==="var"?Xn:ri,!1)};var Mt=1,pr=2,Mr=4;qe.parseFunction=function(x,I,U,R){this.initFunction(x),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!R)&&(this.type===K.star&&I&pr&&this.unexpected(),x.generator=this.eat(K.star)),this.options.ecmaVersion>=8&&(x.async=!!R),I&Mt&&(x.id=I&Mr&&this.type!==K.name?null:this.parseIdent(),x.id&&!(I&pr)&&this.checkLVal(x.id,this.strict||x.generator||x.async?this.treatFunctionsAsVar?Xn:ri:po));var ne=this.yieldPos,ke=this.awaitPos,it=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ni(x.async,x.generator)),I&Mt||(x.id=this.type===K.name?this.parseIdent():null),this.parseFunctionParams(x),this.parseFunctionBody(x,U,!1),this.yieldPos=ne,this.awaitPos=ke,this.awaitIdentPos=it,this.finishNode(x,I&Mt?"FunctionDeclaration":"FunctionExpression")},qe.parseFunctionParams=function(x){this.expect(K.parenL),x.params=this.parseBindingList(K.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},qe.parseClass=function(x,I){this.next();var U=this.strict;this.strict=!0,this.parseClassId(x,I),this.parseClassSuper(x);var R=this.startNode(),ne=!1;for(R.body=[],this.expect(K.braceL);this.type!==K.braceR;){var ke=this.parseClassElement(x.superClass!==null);ke&&(R.body.push(ke),ke.type==="MethodDefinition"&&ke.kind==="constructor"&&(ne&&this.raise(ke.start,"Duplicate constructor in the same class"),ne=!0))}return this.strict=U,this.next(),x.body=this.finishNode(R,"ClassBody"),this.finishNode(x,I?"ClassDeclaration":"ClassExpression")},qe.parseClassElement=function(x){var I=this;if(this.eat(K.semi))return null;var U=this.startNode(),R=function(Lt,yr){yr===void 0&&(yr=!1);var Lr=I.start,Hn=I.startLoc;return I.eatContextual(Lt)?I.type!==K.parenL&&(!yr||!I.canInsertSemicolon())?!0:(U.key&&I.unexpected(),U.computed=!1,U.key=I.startNodeAt(Lr,Hn),U.key.name=Lt,I.finishNode(U.key,"Identifier"),!1):!1};U.kind="method",U.static=R("static");var ne=this.eat(K.star),ke=!1;ne||(this.options.ecmaVersion>=8&&R("async",!0)?(ke=!0,ne=this.options.ecmaVersion>=9&&this.eat(K.star)):R("get")?U.kind="get":R("set")&&(U.kind="set")),U.key||this.parsePropertyName(U);var it=U.key,Pt=!1;return!U.computed&&!U.static&&(it.type==="Identifier"&&it.name==="constructor"||it.type==="Literal"&&it.value==="constructor")?(U.kind!=="method"&&this.raise(it.start,"Constructor can't have get/set modifier"),ne&&this.raise(it.start,"Constructor can't be a generator"),ke&&this.raise(it.start,"Constructor can't be an async method"),U.kind="constructor",Pt=x):U.static&&it.type==="Identifier"&&it.name==="prototype"&&this.raise(it.start,"Classes may not have a static property named prototype"),this.parseClassMethod(U,ne,ke,Pt),U.kind==="get"&&U.value.params.length!==0&&this.raiseRecoverable(U.value.start,"getter should have no params"),U.kind==="set"&&U.value.params.length!==1&&this.raiseRecoverable(U.value.start,"setter should have exactly one param"),U.kind==="set"&&U.value.params[0].type==="RestElement"&&this.raiseRecoverable(U.value.params[0].start,"Setter cannot use rest params"),U},qe.parseClassMethod=function(x,I,U,R){return x.value=this.parseMethod(I,U,R),this.finishNode(x,"MethodDefinition")},qe.parseClassId=function(x,I){this.type===K.name?(x.id=this.parseIdent(),I&&this.checkLVal(x.id,ri,!1)):(I===!0&&this.unexpected(),x.id=null)},qe.parseClassSuper=function(x){x.superClass=this.eat(K._extends)?this.parseExprSubscripts():null},qe.parseExport=function(x,I){if(this.next(),this.eat(K.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(x.exported=this.parseIdent(!0),this.checkExport(I,x.exported.name,this.lastTokStart)):x.exported=null),this.expectContextual("from"),this.type!==K.string&&this.unexpected(),x.source=this.parseExprAtom(),this.semicolon(),this.finishNode(x,"ExportAllDeclaration");if(this.eat(K._default)){this.checkExport(I,"default",this.lastTokStart);var U;if(this.type===K._function||(U=this.isAsyncFunction())){var R=this.startNode();this.next(),U&&this.next(),x.declaration=this.parseFunction(R,Mt|Mr,!1,U)}else if(this.type===K._class){var ne=this.startNode();x.declaration=this.parseClass(ne,"nullableID")}else x.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(x,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())x.declaration=this.parseStatement(null),x.declaration.type==="VariableDeclaration"?this.checkVariableExport(I,x.declaration.declarations):this.checkExport(I,x.declaration.id.name,x.declaration.id.start),x.specifiers=[],x.source=null;else{if(x.declaration=null,x.specifiers=this.parseExportSpecifiers(I),this.eatContextual("from"))this.type!==K.string&&this.unexpected(),x.source=this.parseExprAtom();else{for(var ke=0,it=x.specifiers;ke<it.length;ke+=1){var Pt=it[ke];this.checkUnreserved(Pt.local),this.checkLocalExport(Pt.local)}x.source=null}this.semicolon()}return this.finishNode(x,"ExportNamedDeclaration")},qe.checkExport=function(x,I,U){!x||(ge(x,I)&&this.raiseRecoverable(U,"Duplicate export '"+I+"'"),x[I]=!0)},qe.checkPatternExport=function(x,I){var U=I.type;if(U==="Identifier")this.checkExport(x,I.name,I.start);else if(U==="ObjectPattern")for(var R=0,ne=I.properties;R<ne.length;R+=1){var ke=ne[R];this.checkPatternExport(x,ke)}else if(U==="ArrayPattern")for(var it=0,Pt=I.elements;it<Pt.length;it+=1){var Lt=Pt[it];Lt&&this.checkPatternExport(x,Lt)}else U==="Property"?this.checkPatternExport(x,I.value):U==="AssignmentPattern"?this.checkPatternExport(x,I.left):U==="RestElement"?this.checkPatternExport(x,I.argument):U==="ParenthesizedExpression"&&this.checkPatternExport(x,I.expression)},qe.checkVariableExport=function(x,I){if(!!x)for(var U=0,R=I;U<R.length;U+=1){var ne=R[U];this.checkPatternExport(x,ne.id)}},qe.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},qe.parseExportSpecifiers=function(x){var I=[],U=!0;for(this.expect(K.braceL);!this.eat(K.braceR);){if(U)U=!1;else if(this.expect(K.comma),this.afterTrailingComma(K.braceR))break;var R=this.startNode();R.local=this.parseIdent(!0),R.exported=this.eatContextual("as")?this.parseIdent(!0):R.local,this.checkExport(x,R.exported.name,R.exported.start),I.push(this.finishNode(R,"ExportSpecifier"))}return I},qe.parseImport=function(x){return this.next(),this.type===K.string?(x.specifiers=Ye,x.source=this.parseExprAtom()):(x.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),x.source=this.type===K.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(x,"ImportDeclaration")},qe.parseImportSpecifiers=function(){var x=[],I=!0;if(this.type===K.name){var U=this.startNode();if(U.local=this.parseIdent(),this.checkLVal(U.local,ri),x.push(this.finishNode(U,"ImportDefaultSpecifier")),!this.eat(K.comma))return x}if(this.type===K.star){var R=this.startNode();return this.next(),this.expectContextual("as"),R.local=this.parseIdent(),this.checkLVal(R.local,ri),x.push(this.finishNode(R,"ImportNamespaceSpecifier")),x}for(this.expect(K.braceL);!this.eat(K.braceR);){if(I)I=!1;else if(this.expect(K.comma),this.afterTrailingComma(K.braceR))break;var ne=this.startNode();ne.imported=this.parseIdent(!0),this.eatContextual("as")?ne.local=this.parseIdent():(this.checkUnreserved(ne.imported),ne.local=ne.imported),this.checkLVal(ne.local,ri),x.push(this.finishNode(ne,"ImportSpecifier"))}return x},qe.adaptDirectivePrologue=function(x){for(var I=0;I<x.length&&this.isDirectiveCandidate(x[I]);++I)x[I].directive=x[I].expression.raw.slice(1,-1)},qe.isDirectiveCandidate=function(x){return x.type==="ExpressionStatement"&&x.expression.type==="Literal"&&typeof x.expression.value=="string"&&(this.input[x.start]==='"'||this.input[x.start]==="'")};var Zr=Et.prototype;Zr.toAssignable=function(x,I,U){if(this.options.ecmaVersion>=6&&x)switch(x.type){case"Identifier":this.inAsync&&x.name==="await"&&this.raise(x.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":x.type="ObjectPattern",U&&this.checkPatternErrors(U,!0);for(var R=0,ne=x.properties;R<ne.length;R+=1){var ke=ne[R];this.toAssignable(ke,I),ke.type==="RestElement"&&(ke.argument.type==="ArrayPattern"||ke.argument.type==="ObjectPattern")&&this.raise(ke.argument.start,"Unexpected token")}break;case"Property":x.kind!=="init"&&this.raise(x.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(x.value,I);break;case"ArrayExpression":x.type="ArrayPattern",U&&this.checkPatternErrors(U,!0),this.toAssignableList(x.elements,I);break;case"SpreadElement":x.type="RestElement",this.toAssignable(x.argument,I),x.argument.type==="AssignmentPattern"&&this.raise(x.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":x.operator!=="="&&this.raise(x.left.end,"Only '=' operator can be used for specifying default value."),x.type="AssignmentPattern",delete x.operator,this.toAssignable(x.left,I);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(x.expression,I,U);break;case"ChainExpression":this.raiseRecoverable(x.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!I)break;default:this.raise(x.start,"Assigning to rvalue")}else U&&this.checkPatternErrors(U,!0);return x},Zr.toAssignableList=function(x,I){for(var U=x.length,R=0;R<U;R++){var ne=x[R];ne&&this.toAssignable(ne,I)}if(U){var ke=x[U-1];this.options.ecmaVersion===6&&I&&ke&&ke.type==="RestElement"&&ke.argument.type!=="Identifier"&&this.unexpected(ke.argument.start)}return x},Zr.parseSpread=function(x){var I=this.startNode();return this.next(),I.argument=this.parseMaybeAssign(!1,x),this.finishNode(I,"SpreadElement")},Zr.parseRestBinding=function(){var x=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==K.name&&this.unexpected(),x.argument=this.parseBindingAtom(),this.finishNode(x,"RestElement")},Zr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case K.bracketL:var x=this.startNode();return this.next(),x.elements=this.parseBindingList(K.bracketR,!0,!0),this.finishNode(x,"ArrayPattern");case K.braceL:return this.parseObj(!0)}return this.parseIdent()},Zr.parseBindingList=function(x,I,U){for(var R=[],ne=!0;!this.eat(x);)if(ne?ne=!1:this.expect(K.comma),I&&this.type===K.comma)R.push(null);else{if(U&&this.afterTrailingComma(x))break;if(this.type===K.ellipsis){var ke=this.parseRestBinding();this.parseBindingListItem(ke),R.push(ke),this.type===K.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(x);break}else{var it=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(it),R.push(it)}}return R},Zr.parseBindingListItem=function(x){return x},Zr.parseMaybeDefault=function(x,I,U){if(U=U||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(K.eq))return U;var R=this.startNodeAt(x,I);return R.left=U,R.right=this.parseMaybeAssign(),this.finishNode(R,"AssignmentPattern")},Zr.checkLVal=function(x,I,U){switch(I===void 0&&(I=hi),x.type){case"Identifier":I===ri&&x.name==="let"&&this.raiseRecoverable(x.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(x.name)&&this.raiseRecoverable(x.start,(I?"Binding ":"Assigning to ")+x.name+" in strict mode"),U&&(ge(U,x.name)&&this.raiseRecoverable(x.start,"Argument name clash"),U[x.name]=!0),I!==hi&&I!==wa&&this.declareName(x.name,I,x.start);break;case"ChainExpression":this.raiseRecoverable(x.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":I&&this.raiseRecoverable(x.start,"Binding member expression");break;case"ObjectPattern":for(var R=0,ne=x.properties;R<ne.length;R+=1){var ke=ne[R];this.checkLVal(ke,I,U)}break;case"Property":this.checkLVal(x.value,I,U);break;case"ArrayPattern":for(var it=0,Pt=x.elements;it<Pt.length;it+=1){var Lt=Pt[it];Lt&&this.checkLVal(Lt,I,U)}break;case"AssignmentPattern":this.checkLVal(x.left,I,U);break;case"RestElement":this.checkLVal(x.argument,I,U);break;case"ParenthesizedExpression":this.checkLVal(x.expression,I,U);break;default:this.raise(x.start,(I?"Binding":"Assigning to")+" rvalue")}};var qr=Et.prototype;qr.checkPropClash=function(x,I,U){if(!(this.options.ecmaVersion>=9&&x.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(x.computed||x.method||x.shorthand))){var R=x.key,ne;switch(R.type){case"Identifier":ne=R.name;break;case"Literal":ne=String(R.value);break;default:return}var ke=x.kind;if(this.options.ecmaVersion>=6){ne==="__proto__"&&ke==="init"&&(I.proto&&(U?U.doubleProto<0&&(U.doubleProto=R.start):this.raiseRecoverable(R.start,"Redefinition of __proto__ property")),I.proto=!0);return}ne="$"+ne;var it=I[ne];if(it){var Pt;ke==="init"?Pt=this.strict&&it.init||it.get||it.set:Pt=it.init||it[ke],Pt&&this.raiseRecoverable(R.start,"Redefinition of property")}else it=I[ne]={init:!1,get:!1,set:!1};it[ke]=!0}},qr.parseExpression=function(x,I){var U=this.start,R=this.startLoc,ne=this.parseMaybeAssign(x,I);if(this.type===K.comma){var ke=this.startNodeAt(U,R);for(ke.expressions=[ne];this.eat(K.comma);)ke.expressions.push(this.parseMaybeAssign(x,I));return this.finishNode(ke,"SequenceExpression")}return ne},qr.parseMaybeAssign=function(x,I,U){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(x);this.exprAllowed=!1}var R=!1,ne=-1,ke=-1;I?(ne=I.parenthesizedAssign,ke=I.trailingComma,I.parenthesizedAssign=I.trailingComma=-1):(I=new z,R=!0);var it=this.start,Pt=this.startLoc;(this.type===K.parenL||this.type===K.name)&&(this.potentialArrowAt=this.start);var Lt=this.parseMaybeConditional(x,I);if(U&&(Lt=U.call(this,Lt,it,Pt)),this.type.isAssign){var yr=this.startNodeAt(it,Pt);return yr.operator=this.value,yr.left=this.type===K.eq?this.toAssignable(Lt,!1,I):Lt,R||(I.parenthesizedAssign=I.trailingComma=I.doubleProto=-1),I.shorthandAssign>=yr.left.start&&(I.shorthandAssign=-1),this.checkLVal(Lt),this.next(),yr.right=this.parseMaybeAssign(x),this.finishNode(yr,"AssignmentExpression")}else R&&this.checkExpressionErrors(I,!0);return ne>-1&&(I.parenthesizedAssign=ne),ke>-1&&(I.trailingComma=ke),Lt},qr.parseMaybeConditional=function(x,I){var U=this.start,R=this.startLoc,ne=this.parseExprOps(x,I);if(this.checkExpressionErrors(I))return ne;if(this.eat(K.question)){var ke=this.startNodeAt(U,R);return ke.test=ne,ke.consequent=this.parseMaybeAssign(),this.expect(K.colon),ke.alternate=this.parseMaybeAssign(x),this.finishNode(ke,"ConditionalExpression")}return ne},qr.parseExprOps=function(x,I){var U=this.start,R=this.startLoc,ne=this.parseMaybeUnary(I,!1);return this.checkExpressionErrors(I)||ne.start===U&&ne.type==="ArrowFunctionExpression"?ne:this.parseExprOp(ne,U,R,-1,x)},qr.parseExprOp=function(x,I,U,R,ne){var ke=this.type.binop;if(ke!=null&&(!ne||this.type!==K._in)&&ke>R){var it=this.type===K.logicalOR||this.type===K.logicalAND,Pt=this.type===K.coalesce;Pt&&(ke=K.logicalAND.binop);var Lt=this.value;this.next();var yr=this.start,Lr=this.startLoc,Hn=this.parseExprOp(this.parseMaybeUnary(null,!1),yr,Lr,ke,ne),Jn=this.buildBinary(I,U,x,Hn,Lt,it||Pt);return(it&&this.type===K.coalesce||Pt&&(this.type===K.logicalOR||this.type===K.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Jn,I,U,R,ne)}return x},qr.buildBinary=function(x,I,U,R,ne,ke){var it=this.startNodeAt(x,I);return it.left=U,it.operator=ne,it.right=R,this.finishNode(it,ke?"LogicalExpression":"BinaryExpression")},qr.parseMaybeUnary=function(x,I){var U=this.start,R=this.startLoc,ne;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))ne=this.parseAwait(),I=!0;else if(this.type.prefix){var ke=this.startNode(),it=this.type===K.incDec;ke.operator=this.value,ke.prefix=!0,this.next(),ke.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(x,!0),it?this.checkLVal(ke.argument):this.strict&&ke.operator==="delete"&&ke.argument.type==="Identifier"?this.raiseRecoverable(ke.start,"Deleting local variable in strict mode"):I=!0,ne=this.finishNode(ke,it?"UpdateExpression":"UnaryExpression")}else{if(ne=this.parseExprSubscripts(x),this.checkExpressionErrors(x))return ne;for(;this.type.postfix&&!this.canInsertSemicolon();){var Pt=this.startNodeAt(U,R);Pt.operator=this.value,Pt.prefix=!1,Pt.argument=ne,this.checkLVal(ne),this.next(),ne=this.finishNode(Pt,"UpdateExpression")}}return!I&&this.eat(K.starstar)?this.buildBinary(U,R,ne,this.parseMaybeUnary(null,!1),"**",!1):ne},qr.parseExprSubscripts=function(x){var I=this.start,U=this.startLoc,R=this.parseExprAtom(x);if(R.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return R;var ne=this.parseSubscripts(R,I,U);return x&&ne.type==="MemberExpression"&&(x.parenthesizedAssign>=ne.start&&(x.parenthesizedAssign=-1),x.parenthesizedBind>=ne.start&&(x.parenthesizedBind=-1)),ne},qr.parseSubscripts=function(x,I,U,R){for(var ne=this.options.ecmaVersion>=8&&x.type==="Identifier"&&x.name==="async"&&this.lastTokEnd===x.end&&!this.canInsertSemicolon()&&x.end-x.start==5&&this.potentialArrowAt===x.start,ke=!1;;){var it=this.parseSubscript(x,I,U,R,ne,ke);if(it.optional&&(ke=!0),it===x||it.type==="ArrowFunctionExpression"){if(ke){var Pt=this.startNodeAt(I,U);Pt.expression=it,it=this.finishNode(Pt,"ChainExpression")}return it}x=it}},qr.parseSubscript=function(x,I,U,R,ne,ke){var it=this.options.ecmaVersion>=11,Pt=it&&this.eat(K.questionDot);R&&Pt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Lt=this.eat(K.bracketL);if(Lt||Pt&&this.type!==K.parenL&&this.type!==K.backQuote||this.eat(K.dot)){var yr=this.startNodeAt(I,U);yr.object=x,yr.property=Lt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),yr.computed=!!Lt,Lt&&this.expect(K.bracketR),it&&(yr.optional=Pt),x=this.finishNode(yr,"MemberExpression")}else if(!R&&this.eat(K.parenL)){var Lr=new z,Hn=this.yieldPos,Jn=this.awaitPos,vi=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Yi=this.parseExprList(K.parenR,this.options.ecmaVersion>=8,!1,Lr);if(ne&&!Pt&&!this.canInsertSemicolon()&&this.eat(K.arrow))return this.checkPatternErrors(Lr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Hn,this.awaitPos=Jn,this.awaitIdentPos=vi,this.parseArrowExpression(this.startNodeAt(I,U),Yi,!0);this.checkExpressionErrors(Lr,!0),this.yieldPos=Hn||this.yieldPos,this.awaitPos=Jn||this.awaitPos,this.awaitIdentPos=vi||this.awaitIdentPos;var ba=this.startNodeAt(I,U);ba.callee=x,ba.arguments=Yi,it&&(ba.optional=Pt),x=this.finishNode(ba,"CallExpression")}else if(this.type===K.backQuote){(Pt||ke)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Ra=this.startNodeAt(I,U);Ra.tag=x,Ra.quasi=this.parseTemplate({isTagged:!0}),x=this.finishNode(Ra,"TaggedTemplateExpression")}return x},qr.parseExprAtom=function(x){this.type===K.slash&&this.readRegexp();var I,U=this.potentialArrowAt===this.start;switch(this.type){case K._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),I=this.startNode(),this.next(),this.type===K.parenL&&!this.allowDirectSuper&&this.raise(I.start,"super() call outside constructor of a subclass"),this.type!==K.dot&&this.type!==K.bracketL&&this.type!==K.parenL&&this.unexpected(),this.finishNode(I,"Super");case K._this:return I=this.startNode(),this.next(),this.finishNode(I,"ThisExpression");case K.name:var R=this.start,ne=this.startLoc,ke=this.containsEsc,it=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!ke&&it.name==="async"&&!this.canInsertSemicolon()&&this.eat(K._function))return this.parseFunction(this.startNodeAt(R,ne),0,!1,!0);if(U&&!this.canInsertSemicolon()){if(this.eat(K.arrow))return this.parseArrowExpression(this.startNodeAt(R,ne),[it],!1);if(this.options.ecmaVersion>=8&&it.name==="async"&&this.type===K.name&&!ke)return it=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(K.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(R,ne),[it],!0)}return it;case K.regexp:var Pt=this.value;return I=this.parseLiteral(Pt.value),I.regex={pattern:Pt.pattern,flags:Pt.flags},I;case K.num:case K.string:return this.parseLiteral(this.value);case K._null:case K._true:case K._false:return I=this.startNode(),I.value=this.type===K._null?null:this.type===K._true,I.raw=this.type.keyword,this.next(),this.finishNode(I,"Literal");case K.parenL:var Lt=this.start,yr=this.parseParenAndDistinguishExpression(U);return x&&(x.parenthesizedAssign<0&&!this.isSimpleAssignTarget(yr)&&(x.parenthesizedAssign=Lt),x.parenthesizedBind<0&&(x.parenthesizedBind=Lt)),yr;case K.bracketL:return I=this.startNode(),this.next(),I.elements=this.parseExprList(K.bracketR,!0,!0,x),this.finishNode(I,"ArrayExpression");case K.braceL:return this.parseObj(!1,x);case K._function:return I=this.startNode(),this.next(),this.parseFunction(I,0);case K._class:return this.parseClass(this.startNode(),!1);case K._new:return this.parseNew();case K.backQuote:return this.parseTemplate();case K._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},qr.parseExprImport=function(){var x=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var I=this.parseIdent(!0);switch(this.type){case K.parenL:return this.parseDynamicImport(x);case K.dot:return x.meta=I,this.parseImportMeta(x);default:this.unexpected()}},qr.parseDynamicImport=function(x){if(this.next(),x.source=this.parseMaybeAssign(),!this.eat(K.parenR)){var I=this.start;this.eat(K.comma)&&this.eat(K.parenR)?this.raiseRecoverable(I,"Trailing comma is not allowed in import()"):this.unexpected(I)}return this.finishNode(x,"ImportExpression")},qr.parseImportMeta=function(x){this.next();var I=this.containsEsc;return x.property=this.parseIdent(!0),x.property.name!=="meta"&&this.raiseRecoverable(x.property.start,"The only valid meta property for import is 'import.meta'"),I&&this.raiseRecoverable(x.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(x.start,"Cannot use 'import.meta' outside a module"),this.finishNode(x,"MetaProperty")},qr.parseLiteral=function(x){var I=this.startNode();return I.value=x,I.raw=this.input.slice(this.start,this.end),I.raw.charCodeAt(I.raw.length-1)===110&&(I.bigint=I.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(I,"Literal")},qr.parseParenExpression=function(){this.expect(K.parenL);var x=this.parseExpression();return this.expect(K.parenR),x},qr.parseParenAndDistinguishExpression=function(x){var I=this.start,U=this.startLoc,R,ne=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var ke=this.start,it=this.startLoc,Pt=[],Lt=!0,yr=!1,Lr=new z,Hn=this.yieldPos,Jn=this.awaitPos,vi;for(this.yieldPos=0,this.awaitPos=0;this.type!==K.parenR;)if(Lt?Lt=!1:this.expect(K.comma),ne&&this.afterTrailingComma(K.parenR,!0)){yr=!0;break}else if(this.type===K.ellipsis){vi=this.start,Pt.push(this.parseParenItem(this.parseRestBinding())),this.type===K.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Pt.push(this.parseMaybeAssign(!1,Lr,this.parseParenItem));var Yi=this.start,ba=this.startLoc;if(this.expect(K.parenR),x&&!this.canInsertSemicolon()&&this.eat(K.arrow))return this.checkPatternErrors(Lr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Hn,this.awaitPos=Jn,this.parseParenArrowList(I,U,Pt);(!Pt.length||yr)&&this.unexpected(this.lastTokStart),vi&&this.unexpected(vi),this.checkExpressionErrors(Lr,!0),this.yieldPos=Hn||this.yieldPos,this.awaitPos=Jn||this.awaitPos,Pt.length>1?(R=this.startNodeAt(ke,it),R.expressions=Pt,this.finishNodeAt(R,"SequenceExpression",Yi,ba)):R=Pt[0]}else R=this.parseParenExpression();if(this.options.preserveParens){var Ra=this.startNodeAt(I,U);return Ra.expression=R,this.finishNode(Ra,"ParenthesizedExpression")}else return R},qr.parseParenItem=function(x){return x},qr.parseParenArrowList=function(x,I,U){return this.parseArrowExpression(this.startNodeAt(x,I),U)};var jn=[];qr.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var x=this.startNode(),I=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(K.dot)){x.meta=I;var U=this.containsEsc;return x.property=this.parseIdent(!0),x.property.name!=="target"&&this.raiseRecoverable(x.property.start,"The only valid meta property for new is 'new.target'"),U&&this.raiseRecoverable(x.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(x.start,"'new.target' can only be used in functions"),this.finishNode(x,"MetaProperty")}var R=this.start,ne=this.startLoc,ke=this.type===K._import;return x.callee=this.parseSubscripts(this.parseExprAtom(),R,ne,!0),ke&&x.callee.type==="ImportExpression"&&this.raise(R,"Cannot use new with import()"),this.eat(K.parenL)?x.arguments=this.parseExprList(K.parenR,this.options.ecmaVersion>=8,!1):x.arguments=jn,this.finishNode(x,"NewExpression")},qr.parseTemplateElement=function(x){var I=x.isTagged,U=this.startNode();return this.type===K.invalidTemplate?(I||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),U.value={raw:this.value,cooked:null}):U.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),U.tail=this.type===K.backQuote,this.finishNode(U,"TemplateElement")},qr.parseTemplate=function(x){x===void 0&&(x={});var I=x.isTagged;I===void 0&&(I=!1);var U=this.startNode();this.next(),U.expressions=[];var R=this.parseTemplateElement({isTagged:I});for(U.quasis=[R];!R.tail;)this.type===K.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(K.dollarBraceL),U.expressions.push(this.parseExpression()),this.expect(K.braceR),U.quasis.push(R=this.parseTemplateElement({isTagged:I}));return this.next(),this.finishNode(U,"TemplateLiteral")},qr.isAsyncProp=function(x){return!x.computed&&x.key.type==="Identifier"&&x.key.name==="async"&&(this.type===K.name||this.type===K.num||this.type===K.string||this.type===K.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===K.star)&&!ur.test(this.input.slice(this.lastTokEnd,this.start))},qr.parseObj=function(x,I){var U=this.startNode(),R=!0,ne={};for(U.properties=[],this.next();!this.eat(K.braceR);){if(R)R=!1;else if(this.expect(K.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(K.braceR))break;var ke=this.parseProperty(x,I);x||this.checkPropClash(ke,ne,I),U.properties.push(ke)}return this.finishNode(U,x?"ObjectPattern":"ObjectExpression")},qr.parseProperty=function(x,I){var U=this.startNode(),R,ne,ke,it;if(this.options.ecmaVersion>=9&&this.eat(K.ellipsis))return x?(U.argument=this.parseIdent(!1),this.type===K.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(U,"RestElement")):(this.type===K.parenL&&I&&(I.parenthesizedAssign<0&&(I.parenthesizedAssign=this.start),I.parenthesizedBind<0&&(I.parenthesizedBind=this.start)),U.argument=this.parseMaybeAssign(!1,I),this.type===K.comma&&I&&I.trailingComma<0&&(I.trailingComma=this.start),this.finishNode(U,"SpreadElement"));this.options.ecmaVersion>=6&&(U.method=!1,U.shorthand=!1,(x||I)&&(ke=this.start,it=this.startLoc),x||(R=this.eat(K.star)));var Pt=this.containsEsc;return this.parsePropertyName(U),!x&&!Pt&&this.options.ecmaVersion>=8&&!R&&this.isAsyncProp(U)?(ne=!0,R=this.options.ecmaVersion>=9&&this.eat(K.star),this.parsePropertyName(U,I)):ne=!1,this.parsePropertyValue(U,x,R,ne,ke,it,I,Pt),this.finishNode(U,"Property")},qr.parsePropertyValue=function(x,I,U,R,ne,ke,it,Pt){if((U||R)&&this.type===K.colon&&this.unexpected(),this.eat(K.colon))x.value=I?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,it),x.kind="init";else if(this.options.ecmaVersion>=6&&this.type===K.parenL)I&&this.unexpected(),x.kind="init",x.method=!0,x.value=this.parseMethod(U,R);else if(!I&&!Pt&&this.options.ecmaVersion>=5&&!x.computed&&x.key.type==="Identifier"&&(x.key.name==="get"||x.key.name==="set")&&this.type!==K.comma&&this.type!==K.braceR&&this.type!==K.eq){(U||R)&&this.unexpected(),x.kind=x.key.name,this.parsePropertyName(x),x.value=this.parseMethod(!1);var Lt=x.kind==="get"?0:1;if(x.value.params.length!==Lt){var yr=x.value.start;x.kind==="get"?this.raiseRecoverable(yr,"getter should have no params"):this.raiseRecoverable(yr,"setter should have exactly one param")}else x.kind==="set"&&x.value.params[0].type==="RestElement"&&this.raiseRecoverable(x.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!x.computed&&x.key.type==="Identifier"?((U||R)&&this.unexpected(),this.checkUnreserved(x.key),x.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=ne),x.kind="init",I?x.value=this.parseMaybeDefault(ne,ke,x.key):this.type===K.eq&&it?(it.shorthandAssign<0&&(it.shorthandAssign=this.start),x.value=this.parseMaybeDefault(ne,ke,x.key)):x.value=x.key,x.shorthand=!0):this.unexpected()},qr.parsePropertyName=function(x){if(this.options.ecmaVersion>=6){if(this.eat(K.bracketL))return x.computed=!0,x.key=this.parseMaybeAssign(),this.expect(K.bracketR),x.key;x.computed=!1}return x.key=this.type===K.num||this.type===K.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},qr.initFunction=function(x){x.id=null,this.options.ecmaVersion>=6&&(x.generator=x.expression=!1),this.options.ecmaVersion>=8&&(x.async=!1)},qr.parseMethod=function(x,I,U){var R=this.startNode(),ne=this.yieldPos,ke=this.awaitPos,it=this.awaitIdentPos;return this.initFunction(R),this.options.ecmaVersion>=6&&(R.generator=x),this.options.ecmaVersion>=8&&(R.async=!!I),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ni(I,R.generator)|fi|(U?Hi:0)),this.expect(K.parenL),R.params=this.parseBindingList(K.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(R,!1,!0),this.yieldPos=ne,this.awaitPos=ke,this.awaitIdentPos=it,this.finishNode(R,"FunctionExpression")},qr.parseArrowExpression=function(x,I,U){var R=this.yieldPos,ne=this.awaitPos,ke=this.awaitIdentPos;return this.enterScope(Ni(U,!1)|Xi),this.initFunction(x),this.options.ecmaVersion>=8&&(x.async=!!U),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,x.params=this.toAssignableList(I,!0),this.parseFunctionBody(x,!0,!1),this.yieldPos=R,this.awaitPos=ne,this.awaitIdentPos=ke,this.finishNode(x,"ArrowFunctionExpression")},qr.parseFunctionBody=function(x,I,U){var R=I&&this.type!==K.braceL,ne=this.strict,ke=!1;if(R)x.body=this.parseMaybeAssign(),x.expression=!0,this.checkParams(x,!1);else{var it=this.options.ecmaVersion>=7&&!this.isSimpleParamList(x.params);(!ne||it)&&(ke=this.strictDirective(this.end),ke&&it&&this.raiseRecoverable(x.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Pt=this.labels;this.labels=[],ke&&(this.strict=!0),this.checkParams(x,!ne&&!ke&&!I&&!U&&this.isSimpleParamList(x.params)),this.strict&&x.id&&this.checkLVal(x.id,wa),x.body=this.parseBlock(!1,void 0,ke&&!ne),x.expression=!1,this.adaptDirectivePrologue(x.body.body),this.labels=Pt}this.exitScope()},qr.isSimpleParamList=function(x){for(var I=0,U=x;I<U.length;I+=1){var R=U[I];if(R.type!=="Identifier")return!1}return!0},qr.checkParams=function(x,I){for(var U={},R=0,ne=x.params;R<ne.length;R+=1){var ke=ne[R];this.checkLVal(ke,Xn,I?null:U)}},qr.parseExprList=function(x,I,U,R){for(var ne=[],ke=!0;!this.eat(x);){if(ke)ke=!1;else if(this.expect(K.comma),I&&this.afterTrailingComma(x))break;var it=void 0;U&&this.type===K.comma?it=null:this.type===K.ellipsis?(it=this.parseSpread(R),R&&this.type===K.comma&&R.trailingComma<0&&(R.trailingComma=this.start)):it=this.parseMaybeAssign(!1,R),ne.push(it)}return ne},qr.checkUnreserved=function(x){var I=x.start,U=x.end,R=x.name;if(this.inGenerator&&R==="yield"&&this.raiseRecoverable(I,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&R==="await"&&this.raiseRecoverable(I,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(R)&&this.raise(I,"Unexpected keyword '"+R+"'"),!(this.options.ecmaVersion<6&&this.input.slice(I,U).indexOf("\\")!==-1)){var ne=this.strict?this.reservedWordsStrict:this.reservedWords;ne.test(R)&&(!this.inAsync&&R==="await"&&this.raiseRecoverable(I,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(I,"The keyword '"+R+"' is reserved"))}},qr.parseIdent=function(x,I){var U=this.startNode();return this.type===K.name?U.name=this.value:this.type.keyword?(U.name=this.type.keyword,(U.name==="class"||U.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!x),this.finishNode(U,"Identifier"),x||(this.checkUnreserved(U),U.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=U.start)),U},qr.parseYield=function(x){this.yieldPos||(this.yieldPos=this.start);var I=this.startNode();return this.next(),this.type===K.semi||this.canInsertSemicolon()||this.type!==K.star&&!this.type.startsExpr?(I.delegate=!1,I.argument=null):(I.delegate=this.eat(K.star),I.argument=this.parseMaybeAssign(x)),this.finishNode(I,"YieldExpression")},qr.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var x=this.startNode();return this.next(),x.argument=this.parseMaybeUnary(null,!1),this.finishNode(x,"AwaitExpression")};var Nn=Et.prototype;Nn.raise=function(x,I){var U=bt(this.input,x);I+=" ("+U.line+":"+U.column+")";var R=new SyntaxError(I);throw R.pos=x,R.loc=U,R.raisedAt=this.pos,R},Nn.raiseRecoverable=Nn.raise,Nn.curPosition=function(){if(this.options.locations)return new ee(this.curLine,this.pos-this.lineStart)};var en=Et.prototype,pi=function(I){this.flags=I,this.var=[],this.lexical=[],this.functions=[]};en.enterScope=function(x){this.scopeStack.push(new pi(x))},en.exitScope=function(){this.scopeStack.pop()},en.treatFunctionsAsVarInScope=function(x){return x.flags&Dr||!this.inModule&&x.flags&ln},en.declareName=function(x,I,U){var R=!1;if(I===ri){var ne=this.currentScope();R=ne.lexical.indexOf(x)>-1||ne.functions.indexOf(x)>-1||ne.var.indexOf(x)>-1,ne.lexical.push(x),this.inModule&&ne.flags&ln&&delete this.undefinedExports[x]}else if(I===Ha){var ke=this.currentScope();ke.lexical.push(x)}else if(I===po){var it=this.currentScope();this.treatFunctionsAsVar?R=it.lexical.indexOf(x)>-1:R=it.lexical.indexOf(x)>-1||it.var.indexOf(x)>-1,it.functions.push(x)}else for(var Pt=this.scopeStack.length-1;Pt>=0;--Pt){var Lt=this.scopeStack[Pt];if(Lt.lexical.indexOf(x)>-1&&!(Lt.flags&Ci&&Lt.lexical[0]===x)||!this.treatFunctionsAsVarInScope(Lt)&&Lt.functions.indexOf(x)>-1){R=!0;break}if(Lt.var.push(x),this.inModule&&Lt.flags&ln&&delete this.undefinedExports[x],Lt.flags&oi)break}R&&this.raiseRecoverable(U,"Identifier '"+x+"' has already been declared")},en.checkLocalExport=function(x){this.scopeStack[0].lexical.indexOf(x.name)===-1&&this.scopeStack[0].var.indexOf(x.name)===-1&&(this.undefinedExports[x.name]=x)},en.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},en.currentVarScope=function(){for(var x=this.scopeStack.length-1;;x--){var I=this.scopeStack[x];if(I.flags&oi)return I}},en.currentThisScope=function(){for(var x=this.scopeStack.length-1;;x--){var I=this.scopeStack[x];if(I.flags&oi&&!(I.flags&Xi))return I}};var si=function(I,U,R){this.type="",this.start=U,this.end=0,I.options.locations&&(this.loc=new oe(I,R)),I.options.directSourceFile&&(this.sourceFile=I.options.directSourceFile),I.options.ranges&&(this.range=[U,0])},ra=Et.prototype;ra.startNode=function(){return new si(this,this.start,this.startLoc)},ra.startNodeAt=function(x,I){return new si(this,x,I)};function Aa(x,I,U,R){return x.type=I,x.end=U,this.options.locations&&(x.loc.end=R),this.options.ranges&&(x.range[1]=U),x}ra.finishNode=function(x,I){return Aa.call(this,x,I,this.lastTokEnd,this.lastTokEndLoc)},ra.finishNodeAt=function(x,I,U,R){return Aa.call(this,x,I,U,R)};var va=function(I,U,R,ne,ke){this.token=I,this.isExpr=!!U,this.preserveSpace=!!R,this.override=ne,this.generator=!!ke},xa={b_stat:new va("{",!1),b_expr:new va("{",!0),b_tmpl:new va("${",!1),p_stat:new va("(",!1),p_expr:new va("(",!0),q_tmpl:new va("`",!0,!0,function(x){return x.tryReadTemplateToken()}),f_stat:new va("function",!1),f_expr:new va("function",!0),f_expr_gen:new va("function",!0,!1,null,!0),f_gen:new va("function",!1,!1,null,!0)},Ki=Et.prototype;Ki.initialContext=function(){return[xa.b_stat]},Ki.braceIsBlock=function(x){var I=this.curContext();return I===xa.f_expr||I===xa.f_stat?!0:x===K.colon&&(I===xa.b_stat||I===xa.b_expr)?!I.isExpr:x===K._return||x===K.name&&this.exprAllowed?ur.test(this.input.slice(this.lastTokEnd,this.start)):x===K._else||x===K.semi||x===K.eof||x===K.parenR||x===K.arrow?!0:x===K.braceL?I===xa.b_stat:x===K._var||x===K._const||x===K.name?!1:!this.exprAllowed},Ki.inGeneratorContext=function(){for(var x=this.context.length-1;x>=1;x--){var I=this.context[x];if(I.token==="function")return I.generator}return!1},Ki.updateContext=function(x){var I,U=this.type;U.keyword&&x===K.dot?this.exprAllowed=!1:(I=U.updateContext)?I.call(this,x):this.exprAllowed=U.beforeExpr},K.parenR.updateContext=K.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var x=this.context.pop();x===xa.b_stat&&this.curContext().token==="function"&&(x=this.context.pop()),this.exprAllowed=!x.isExpr},K.braceL.updateContext=function(x){this.context.push(this.braceIsBlock(x)?xa.b_stat:xa.b_expr),this.exprAllowed=!0},K.dollarBraceL.updateContext=function(){this.context.push(xa.b_tmpl),this.exprAllowed=!0},K.parenL.updateContext=function(x){var I=x===K._if||x===K._for||x===K._with||x===K._while;this.context.push(I?xa.p_stat:xa.p_expr),this.exprAllowed=!0},K.incDec.updateContext=function(){},K._function.updateContext=K._class.updateContext=function(x){x.beforeExpr&&x!==K.semi&&x!==K._else&&!(x===K._return&&ur.test(this.input.slice(this.lastTokEnd,this.start)))&&!((x===K.colon||x===K.braceL)&&this.curContext()===xa.b_stat)?this.context.push(xa.f_expr):this.context.push(xa.f_stat),this.exprAllowed=!1},K.backQuote.updateContext=function(){this.curContext()===xa.q_tmpl?this.context.pop():this.context.push(xa.q_tmpl),this.exprAllowed=!1},K.star.updateContext=function(x){if(x===K._function){var I=this.context.length-1;this.context[I]===xa.f_expr?this.context[I]=xa.f_expr_gen:this.context[I]=xa.f_gen}this.exprAllowed=!0},K.name.updateContext=function(x){var I=!1;this.options.ecmaVersion>=6&&x!==K.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(I=!0),this.exprAllowed=I};var Y="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ie=Y+" Extended_Pictographic",de=ie,Ce={9:Y,10:ie,11:de},Ze="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",et="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",dt=et+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",be=dt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",He={9:et,10:dt,11:be},Rt={};function kr(x){var I=Rt[x]={binary:Me(Ce[x]+" "+Ze),nonBinary:{General_Category:Me(Ze),Script:Me(He[x])}};I.nonBinary.Script_Extensions=I.nonBinary.Script,I.nonBinary.gc=I.nonBinary.General_Category,I.nonBinary.sc=I.nonBinary.Script,I.nonBinary.scx=I.nonBinary.Script_Extensions}kr(9),kr(10),kr(11);var Xt=Et.prototype,er=function(I){this.parser=I,this.validFlags="gim"+(I.options.ecmaVersion>=6?"uy":"")+(I.options.ecmaVersion>=9?"s":""),this.unicodeProperties=Rt[I.options.ecmaVersion>=11?11:I.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};er.prototype.reset=function(I,U,R){var ne=R.indexOf("u")!==-1;this.start=I|0,this.source=U+"",this.flags=R,this.switchU=ne&&this.parser.options.ecmaVersion>=6,this.switchN=ne&&this.parser.options.ecmaVersion>=9},er.prototype.raise=function(I){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+I)},er.prototype.at=function(I,U){U===void 0&&(U=!1);var R=this.source,ne=R.length;if(I>=ne)return-1;var ke=R.charCodeAt(I);if(!(U||this.switchU)||ke<=55295||ke>=57344||I+1>=ne)return ke;var it=R.charCodeAt(I+1);return it>=56320&&it<=57343?(ke<<10)+it-56613888:ke},er.prototype.nextIndex=function(I,U){U===void 0&&(U=!1);var R=this.source,ne=R.length;if(I>=ne)return ne;var ke=R.charCodeAt(I),it;return!(U||this.switchU)||ke<=55295||ke>=57344||I+1>=ne||(it=R.charCodeAt(I+1))<56320||it>57343?I+1:I+2},er.prototype.current=function(I){return I===void 0&&(I=!1),this.at(this.pos,I)},er.prototype.lookahead=function(I){return I===void 0&&(I=!1),this.at(this.nextIndex(this.pos,I),I)},er.prototype.advance=function(I){I===void 0&&(I=!1),this.pos=this.nextIndex(this.pos,I)},er.prototype.eat=function(I,U){return U===void 0&&(U=!1),this.current(U)===I?(this.advance(U),!0):!1};function Pr(x){return x<=65535?String.fromCharCode(x):(x-=65536,String.fromCharCode((x>>10)+55296,(x&1023)+56320))}Xt.validateRegExpFlags=function(x){for(var I=x.validFlags,U=x.flags,R=0;R<U.length;R++){var ne=U.charAt(R);I.indexOf(ne)===-1&&this.raise(x.start,"Invalid regular expression flag"),U.indexOf(ne,R+1)>-1&&this.raise(x.start,"Duplicate regular expression flag")}},Xt.validateRegExpPattern=function(x){this.regexp_pattern(x),!x.switchN&&this.options.ecmaVersion>=9&&x.groupNames.length>0&&(x.switchN=!0,this.regexp_pattern(x))},Xt.regexp_pattern=function(x){x.pos=0,x.lastIntValue=0,x.lastStringValue="",x.lastAssertionIsQuantifiable=!1,x.numCapturingParens=0,x.maxBackReference=0,x.groupNames.length=0,x.backReferenceNames.length=0,this.regexp_disjunction(x),x.pos!==x.source.length&&(x.eat(41)&&x.raise("Unmatched ')'"),(x.eat(93)||x.eat(125))&&x.raise("Lone quantifier brackets")),x.maxBackReference>x.numCapturingParens&&x.raise("Invalid escape");for(var I=0,U=x.backReferenceNames;I<U.length;I+=1){var R=U[I];x.groupNames.indexOf(R)===-1&&x.raise("Invalid named capture referenced")}},Xt.regexp_disjunction=function(x){for(this.regexp_alternative(x);x.eat(124);)this.regexp_alternative(x);this.regexp_eatQuantifier(x,!0)&&x.raise("Nothing to repeat"),x.eat(123)&&x.raise("Lone quantifier brackets")},Xt.regexp_alternative=function(x){for(;x.pos<x.source.length&&this.regexp_eatTerm(x););},Xt.regexp_eatTerm=function(x){return this.regexp_eatAssertion(x)?(x.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(x)&&x.switchU&&x.raise("Invalid quantifier"),!0):(x.switchU?this.regexp_eatAtom(x):this.regexp_eatExtendedAtom(x))?(this.regexp_eatQuantifier(x),!0):!1},Xt.regexp_eatAssertion=function(x){var I=x.pos;if(x.lastAssertionIsQuantifiable=!1,x.eat(94)||x.eat(36))return!0;if(x.eat(92)){if(x.eat(66)||x.eat(98))return!0;x.pos=I}if(x.eat(40)&&x.eat(63)){var U=!1;if(this.options.ecmaVersion>=9&&(U=x.eat(60)),x.eat(61)||x.eat(33))return this.regexp_disjunction(x),x.eat(41)||x.raise("Unterminated group"),x.lastAssertionIsQuantifiable=!U,!0}return x.pos=I,!1},Xt.regexp_eatQuantifier=function(x,I){return I===void 0&&(I=!1),this.regexp_eatQuantifierPrefix(x,I)?(x.eat(63),!0):!1},Xt.regexp_eatQuantifierPrefix=function(x,I){return x.eat(42)||x.eat(43)||x.eat(63)||this.regexp_eatBracedQuantifier(x,I)},Xt.regexp_eatBracedQuantifier=function(x,I){var U=x.pos;if(x.eat(123)){var R=0,ne=-1;if(this.regexp_eatDecimalDigits(x)&&(R=x.lastIntValue,x.eat(44)&&this.regexp_eatDecimalDigits(x)&&(ne=x.lastIntValue),x.eat(125)))return ne!==-1&&ne<R&&!I&&x.raise("numbers out of order in {} quantifier"),!0;x.switchU&&!I&&x.raise("Incomplete quantifier"),x.pos=U}return!1},Xt.regexp_eatAtom=function(x){return this.regexp_eatPatternCharacters(x)||x.eat(46)||this.regexp_eatReverseSolidusAtomEscape(x)||this.regexp_eatCharacterClass(x)||this.regexp_eatUncapturingGroup(x)||this.regexp_eatCapturingGroup(x)},Xt.regexp_eatReverseSolidusAtomEscape=function(x){var I=x.pos;if(x.eat(92)){if(this.regexp_eatAtomEscape(x))return!0;x.pos=I}return!1},Xt.regexp_eatUncapturingGroup=function(x){var I=x.pos;if(x.eat(40)){if(x.eat(63)&&x.eat(58)){if(this.regexp_disjunction(x),x.eat(41))return!0;x.raise("Unterminated group")}x.pos=I}return!1},Xt.regexp_eatCapturingGroup=function(x){if(x.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(x):x.current()===63&&x.raise("Invalid group"),this.regexp_disjunction(x),x.eat(41))return x.numCapturingParens+=1,!0;x.raise("Unterminated group")}return!1},Xt.regexp_eatExtendedAtom=function(x){return x.eat(46)||this.regexp_eatReverseSolidusAtomEscape(x)||this.regexp_eatCharacterClass(x)||this.regexp_eatUncapturingGroup(x)||this.regexp_eatCapturingGroup(x)||this.regexp_eatInvalidBracedQuantifier(x)||this.regexp_eatExtendedPatternCharacter(x)},Xt.regexp_eatInvalidBracedQuantifier=function(x){return this.regexp_eatBracedQuantifier(x,!0)&&x.raise("Nothing to repeat"),!1},Xt.regexp_eatSyntaxCharacter=function(x){var I=x.current();return Ln(I)?(x.lastIntValue=I,x.advance(),!0):!1};function Ln(x){return x===36||x>=40&&x<=43||x===46||x===63||x>=91&&x<=94||x>=123&&x<=125}Xt.regexp_eatPatternCharacters=function(x){for(var I=x.pos,U=0;(U=x.current())!==-1&&!Ln(U);)x.advance();return x.pos!==I},Xt.regexp_eatExtendedPatternCharacter=function(x){var I=x.current();return I!==-1&&I!==36&&!(I>=40&&I<=43)&&I!==46&&I!==63&&I!==91&&I!==94&&I!==124?(x.advance(),!0):!1},Xt.regexp_groupSpecifier=function(x){if(x.eat(63)){if(this.regexp_eatGroupName(x)){x.groupNames.indexOf(x.lastStringValue)!==-1&&x.raise("Duplicate capture group name"),x.groupNames.push(x.lastStringValue);return}x.raise("Invalid group")}},Xt.regexp_eatGroupName=function(x){if(x.lastStringValue="",x.eat(60)){if(this.regexp_eatRegExpIdentifierName(x)&&x.eat(62))return!0;x.raise("Invalid capture group name")}return!1},Xt.regexp_eatRegExpIdentifierName=function(x){if(x.lastStringValue="",this.regexp_eatRegExpIdentifierStart(x)){for(x.lastStringValue+=Pr(x.lastIntValue);this.regexp_eatRegExpIdentifierPart(x);)x.lastStringValue+=Pr(x.lastIntValue);return!0}return!1},Xt.regexp_eatRegExpIdentifierStart=function(x){var I=x.pos,U=this.options.ecmaVersion>=11,R=x.current(U);return x.advance(U),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(x,U)&&(R=x.lastIntValue),An(R)?(x.lastIntValue=R,!0):(x.pos=I,!1)};function An(x){return kt(x,!0)||x===36||x===95}Xt.regexp_eatRegExpIdentifierPart=function(x){var I=x.pos,U=this.options.ecmaVersion>=11,R=x.current(U);return x.advance(U),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(x,U)&&(R=x.lastIntValue),Ht(R)?(x.lastIntValue=R,!0):(x.pos=I,!1)};function Ht(x){return ar(x,!0)||x===36||x===95||x===8204||x===8205}Xt.regexp_eatAtomEscape=function(x){return this.regexp_eatBackReference(x)||this.regexp_eatCharacterClassEscape(x)||this.regexp_eatCharacterEscape(x)||x.switchN&&this.regexp_eatKGroupName(x)?!0:(x.switchU&&(x.current()===99&&x.raise("Invalid unicode escape"),x.raise("Invalid escape")),!1)},Xt.regexp_eatBackReference=function(x){var I=x.pos;if(this.regexp_eatDecimalEscape(x)){var U=x.lastIntValue;if(x.switchU)return U>x.maxBackReference&&(x.maxBackReference=U),!0;if(U<=x.numCapturingParens)return!0;x.pos=I}return!1},Xt.regexp_eatKGroupName=function(x){if(x.eat(107)){if(this.regexp_eatGroupName(x))return x.backReferenceNames.push(x.lastStringValue),!0;x.raise("Invalid named reference")}return!1},Xt.regexp_eatCharacterEscape=function(x){return this.regexp_eatControlEscape(x)||this.regexp_eatCControlLetter(x)||this.regexp_eatZero(x)||this.regexp_eatHexEscapeSequence(x)||this.regexp_eatRegExpUnicodeEscapeSequence(x,!1)||!x.switchU&&this.regexp_eatLegacyOctalEscapeSequence(x)||this.regexp_eatIdentityEscape(x)},Xt.regexp_eatCControlLetter=function(x){var I=x.pos;if(x.eat(99)){if(this.regexp_eatControlLetter(x))return!0;x.pos=I}return!1},Xt.regexp_eatZero=function(x){return x.current()===48&&!Pi(x.lookahead())?(x.lastIntValue=0,x.advance(),!0):!1},Xt.regexp_eatControlEscape=function(x){var I=x.current();return I===116?(x.lastIntValue=9,x.advance(),!0):I===110?(x.lastIntValue=10,x.advance(),!0):I===118?(x.lastIntValue=11,x.advance(),!0):I===102?(x.lastIntValue=12,x.advance(),!0):I===114?(x.lastIntValue=13,x.advance(),!0):!1},Xt.regexp_eatControlLetter=function(x){var I=x.current();return xn(I)?(x.lastIntValue=I%32,x.advance(),!0):!1};function xn(x){return x>=65&&x<=90||x>=97&&x<=122}Xt.regexp_eatRegExpUnicodeEscapeSequence=function(x,I){I===void 0&&(I=!1);var U=x.pos,R=I||x.switchU;if(x.eat(117)){if(this.regexp_eatFixedHexDigits(x,4)){var ne=x.lastIntValue;if(R&&ne>=55296&&ne<=56319){var ke=x.pos;if(x.eat(92)&&x.eat(117)&&this.regexp_eatFixedHexDigits(x,4)){var it=x.lastIntValue;if(it>=56320&&it<=57343)return x.lastIntValue=(ne-55296)*1024+(it-56320)+65536,!0}x.pos=ke,x.lastIntValue=ne}return!0}if(R&&x.eat(123)&&this.regexp_eatHexDigits(x)&&x.eat(125)&&sn(x.lastIntValue))return!0;R&&x.raise("Invalid unicode escape"),x.pos=U}return!1};function sn(x){return x>=0&&x<=1114111}Xt.regexp_eatIdentityEscape=function(x){if(x.switchU)return this.regexp_eatSyntaxCharacter(x)?!0:x.eat(47)?(x.lastIntValue=47,!0):!1;var I=x.current();return I!==99&&(!x.switchN||I!==107)?(x.lastIntValue=I,x.advance(),!0):!1},Xt.regexp_eatDecimalEscape=function(x){x.lastIntValue=0;var I=x.current();if(I>=49&&I<=57){do x.lastIntValue=10*x.lastIntValue+(I-48),x.advance();while((I=x.current())>=48&&I<=57);return!0}return!1},Xt.regexp_eatCharacterClassEscape=function(x){var I=x.current();if(pn(I))return x.lastIntValue=-1,x.advance(),!0;if(x.switchU&&this.options.ecmaVersion>=9&&(I===80||I===112)){if(x.lastIntValue=-1,x.advance(),x.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(x)&&x.eat(125))return!0;x.raise("Invalid property name")}return!1};function pn(x){return x===100||x===68||x===115||x===83||x===119||x===87}Xt.regexp_eatUnicodePropertyValueExpression=function(x){var I=x.pos;if(this.regexp_eatUnicodePropertyName(x)&&x.eat(61)){var U=x.lastStringValue;if(this.regexp_eatUnicodePropertyValue(x)){var R=x.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(x,U,R),!0}}if(x.pos=I,this.regexp_eatLoneUnicodePropertyNameOrValue(x)){var ne=x.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(x,ne),!0}return!1},Xt.regexp_validateUnicodePropertyNameAndValue=function(x,I,U){ge(x.unicodeProperties.nonBinary,I)||x.raise("Invalid property name"),x.unicodeProperties.nonBinary[I].test(U)||x.raise("Invalid property value")},Xt.regexp_validateUnicodePropertyNameOrValue=function(x,I){x.unicodeProperties.binary.test(I)||x.raise("Invalid property name")},Xt.regexp_eatUnicodePropertyName=function(x){var I=0;for(x.lastStringValue="";bi(I=x.current());)x.lastStringValue+=Pr(I),x.advance();return x.lastStringValue!==""};function bi(x){return xn(x)||x===95}Xt.regexp_eatUnicodePropertyValue=function(x){var I=0;for(x.lastStringValue="";yn(I=x.current());)x.lastStringValue+=Pr(I),x.advance();return x.lastStringValue!==""};function yn(x){return bi(x)||Pi(x)}Xt.regexp_eatLoneUnicodePropertyNameOrValue=function(x){return this.regexp_eatUnicodePropertyValue(x)},Xt.regexp_eatCharacterClass=function(x){if(x.eat(91)){if(x.eat(94),this.regexp_classRanges(x),x.eat(93))return!0;x.raise("Unterminated character class")}return!1},Xt.regexp_classRanges=function(x){for(;this.regexp_eatClassAtom(x);){var I=x.lastIntValue;if(x.eat(45)&&this.regexp_eatClassAtom(x)){var U=x.lastIntValue;x.switchU&&(I===-1||U===-1)&&x.raise("Invalid character class"),I!==-1&&U!==-1&&I>U&&x.raise("Range out of order in character class")}}},Xt.regexp_eatClassAtom=function(x){var I=x.pos;if(x.eat(92)){if(this.regexp_eatClassEscape(x))return!0;if(x.switchU){var U=x.current();(U===99||yt(U))&&x.raise("Invalid class escape"),x.raise("Invalid escape")}x.pos=I}var R=x.current();return R!==93?(x.lastIntValue=R,x.advance(),!0):!1},Xt.regexp_eatClassEscape=function(x){var I=x.pos;if(x.eat(98))return x.lastIntValue=8,!0;if(x.switchU&&x.eat(45))return x.lastIntValue=45,!0;if(!x.switchU&&x.eat(99)){if(this.regexp_eatClassControlLetter(x))return!0;x.pos=I}return this.regexp_eatCharacterClassEscape(x)||this.regexp_eatCharacterEscape(x)},Xt.regexp_eatClassControlLetter=function(x){var I=x.current();return Pi(I)||I===95?(x.lastIntValue=I%32,x.advance(),!0):!1},Xt.regexp_eatHexEscapeSequence=function(x){var I=x.pos;if(x.eat(120)){if(this.regexp_eatFixedHexDigits(x,2))return!0;x.switchU&&x.raise("Invalid escape"),x.pos=I}return!1},Xt.regexp_eatDecimalDigits=function(x){var I=x.pos,U=0;for(x.lastIntValue=0;Pi(U=x.current());)x.lastIntValue=10*x.lastIntValue+(U-48),x.advance();return x.pos!==I};function Pi(x){return x>=48&&x<=57}Xt.regexp_eatHexDigits=function(x){var I=x.pos,U=0;for(x.lastIntValue=0;aa(U=x.current());)x.lastIntValue=16*x.lastIntValue+vt(U),x.advance();return x.pos!==I};function aa(x){return x>=48&&x<=57||x>=65&&x<=70||x>=97&&x<=102}function vt(x){return x>=65&&x<=70?10+(x-65):x>=97&&x<=102?10+(x-97):x-48}Xt.regexp_eatLegacyOctalEscapeSequence=function(x){if(this.regexp_eatOctalDigit(x)){var I=x.lastIntValue;if(this.regexp_eatOctalDigit(x)){var U=x.lastIntValue;I<=3&&this.regexp_eatOctalDigit(x)?x.lastIntValue=I*64+U*8+x.lastIntValue:x.lastIntValue=I*8+U}else x.lastIntValue=I;return!0}return!1},Xt.regexp_eatOctalDigit=function(x){var I=x.current();return yt(I)?(x.lastIntValue=I-48,x.advance(),!0):(x.lastIntValue=0,!1)};function yt(x){return x>=48&&x<=55}Xt.regexp_eatFixedHexDigits=function(x,I){var U=x.pos;x.lastIntValue=0;for(var R=0;R<I;++R){var ne=x.current();if(!aa(ne))return x.pos=U,!1;x.lastIntValue=16*x.lastIntValue+vt(ne),x.advance()}return!0};var Ii=function(I){this.type=I.type,this.value=I.value,this.start=I.start,this.end=I.end,I.options.locations&&(this.loc=new oe(I,I.startLoc,I.endLoc)),I.options.ranges&&(this.range=[I.start,I.end])},ui=Et.prototype;ui.next=function(x){!x&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ii(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},ui.getToken=function(){return this.next(),new Ii(this)},typeof Symbol!="undefined"&&(ui[Symbol.iterator]=function(){var x=this;return{next:function(){var I=x.getToken();return{done:I.type===K.eof,value:I}}}}),ui.curContext=function(){return this.context[this.context.length-1]},ui.nextToken=function(){var x=this.curContext();if((!x||!x.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(K.eof);if(x.override)return x.override(this);this.readToken(this.fullCharCodeAtPos())},ui.readToken=function(x){return kt(x,this.options.ecmaVersion>=6)||x===92?this.readWord():this.getTokenFromCode(x)},ui.fullCharCodeAtPos=function(){var x=this.input.charCodeAt(this.pos);if(x<=55295||x>=57344)return x;var I=this.input.charCodeAt(this.pos+1);return(x<<10)+I-56613888},ui.skipBlockComment=function(){var x=this.options.onComment&&this.curPosition(),I=this.pos,U=this.input.indexOf("*/",this.pos+=2);if(U===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=U+2,this.options.locations){Tt.lastIndex=I;for(var R;(R=Tt.exec(this.input))&&R.index<this.pos;)++this.curLine,this.lineStart=R.index+R[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(I+2,U),I,this.pos,x,this.curPosition())},ui.skipLineComment=function(x){for(var I=this.pos,U=this.options.onComment&&this.curPosition(),R=this.input.charCodeAt(this.pos+=x);this.pos<this.input.length&&!ht(R);)R=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(I+x,this.pos),I,this.pos,U,this.curPosition())},ui.skipSpace=function(){e:for(;this.pos<this.input.length;){var x=this.input.charCodeAt(this.pos);switch(x){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(x>8&&x<14||x>=5760&&Ot.test(String.fromCharCode(x)))++this.pos;else break e}}},ui.finishToken=function(x,I){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var U=this.type;this.type=x,this.value=I,this.updateContext(U)},ui.readToken_dot=function(){var x=this.input.charCodeAt(this.pos+1);if(x>=48&&x<=57)return this.readNumber(!0);var I=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&x===46&&I===46?(this.pos+=3,this.finishToken(K.ellipsis)):(++this.pos,this.finishToken(K.dot))},ui.readToken_slash=function(){var x=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):x===61?this.finishOp(K.assign,2):this.finishOp(K.slash,1)},ui.readToken_mult_modulo_exp=function(x){var I=this.input.charCodeAt(this.pos+1),U=1,R=x===42?K.star:K.modulo;return this.options.ecmaVersion>=7&&x===42&&I===42&&(++U,R=K.starstar,I=this.input.charCodeAt(this.pos+2)),I===61?this.finishOp(K.assign,U+1):this.finishOp(R,U)},ui.readToken_pipe_amp=function(x){var I=this.input.charCodeAt(this.pos+1);if(I===x){if(this.options.ecmaVersion>=12){var U=this.input.charCodeAt(this.pos+2);if(U===61)return this.finishOp(K.assign,3)}return this.finishOp(x===124?K.logicalOR:K.logicalAND,2)}return I===61?this.finishOp(K.assign,2):this.finishOp(x===124?K.bitwiseOR:K.bitwiseAND,1)},ui.readToken_caret=function(){var x=this.input.charCodeAt(this.pos+1);return x===61?this.finishOp(K.assign,2):this.finishOp(K.bitwiseXOR,1)},ui.readToken_plus_min=function(x){var I=this.input.charCodeAt(this.pos+1);return I===x?I===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||ur.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(K.incDec,2):I===61?this.finishOp(K.assign,2):this.finishOp(K.plusMin,1)},ui.readToken_lt_gt=function(x){var I=this.input.charCodeAt(this.pos+1),U=1;return I===x?(U=x===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+U)===61?this.finishOp(K.assign,U+1):this.finishOp(K.bitShift,U)):I===33&&x===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(I===61&&(U=2),this.finishOp(K.relational,U))},ui.readToken_eq_excl=function(x){var I=this.input.charCodeAt(this.pos+1);return I===61?this.finishOp(K.equality,this.input.charCodeAt(this.pos+2)===61?3:2):x===61&&I===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(K.arrow)):this.finishOp(x===61?K.eq:K.prefix,1)},ui.readToken_question=function(){var x=this.options.ecmaVersion;if(x>=11){var I=this.input.charCodeAt(this.pos+1);if(I===46){var U=this.input.charCodeAt(this.pos+2);if(U<48||U>57)return this.finishOp(K.questionDot,2)}if(I===63){if(x>=12){var R=this.input.charCodeAt(this.pos+2);if(R===61)return this.finishOp(K.assign,3)}return this.finishOp(K.coalesce,2)}}return this.finishOp(K.question,1)},ui.getTokenFromCode=function(x){switch(x){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(K.parenL);case 41:return++this.pos,this.finishToken(K.parenR);case 59:return++this.pos,this.finishToken(K.semi);case 44:return++this.pos,this.finishToken(K.comma);case 91:return++this.pos,this.finishToken(K.bracketL);case 93:return++this.pos,this.finishToken(K.bracketR);case 123:return++this.pos,this.finishToken(K.braceL);case 125:return++this.pos,this.finishToken(K.braceR);case 58:return++this.pos,this.finishToken(K.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(K.backQuote);case 48:var I=this.input.charCodeAt(this.pos+1);if(I===120||I===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(I===111||I===79)return this.readRadixNumber(8);if(I===98||I===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(x);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(x);case 124:case 38:return this.readToken_pipe_amp(x);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(x);case 60:case 62:return this.readToken_lt_gt(x);case 61:case 33:return this.readToken_eq_excl(x);case 63:return this.readToken_question();case 126:return this.finishOp(K.prefix,1)}this.raise(this.pos,"Unexpected character '"+oa(x)+"'")},ui.finishOp=function(x,I){var U=this.input.slice(this.pos,this.pos+I);return this.pos+=I,this.finishToken(x,U)},ui.readRegexp=function(){for(var x,I,U=this.pos;;){this.pos>=this.input.length&&this.raise(U,"Unterminated regular expression");var R=this.input.charAt(this.pos);if(ur.test(R)&&this.raise(U,"Unterminated regular expression"),x)x=!1;else{if(R==="[")I=!0;else if(R==="]"&&I)I=!1;else if(R==="/"&&!I)break;x=R==="\\"}++this.pos}var ne=this.input.slice(U,this.pos);++this.pos;var ke=this.pos,it=this.readWord1();this.containsEsc&&this.unexpected(ke);var Pt=this.regexpState||(this.regexpState=new er(this));Pt.reset(U,ne,it),this.validateRegExpFlags(Pt),this.validateRegExpPattern(Pt);var Lt=null;try{Lt=new RegExp(ne,it)}catch(yr){}return this.finishToken(K.regexp,{pattern:ne,flags:it,value:Lt})},ui.readInt=function(x,I,U){for(var R=this.options.ecmaVersion>=12&&I===void 0,ne=U&&this.input.charCodeAt(this.pos)===48,ke=this.pos,it=0,Pt=0,Lt=0,yr=I==null?Infinity:I;Lt<yr;++Lt,++this.pos){var Lr=this.input.charCodeAt(this.pos),Hn=void 0;if(R&&Lr===95){ne&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Pt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Lt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Pt=Lr;continue}if(Lr>=97?Hn=Lr-97+10:Lr>=65?Hn=Lr-65+10:Lr>=48&&Lr<=57?Hn=Lr-48:Hn=Infinity,Hn>=x)break;Pt=Lr,it=it*x+Hn}return R&&Pt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===ke||I!=null&&this.pos-ke!==I?null:it};function Qi(x,I){return I?parseInt(x,8):parseFloat(x.replace(/_/g,""))}function Ji(x){return typeof BigInt!="function"?null:BigInt(x.replace(/_/g,""))}ui.readRadixNumber=function(x){var I=this.pos;this.pos+=2;var U=this.readInt(x);return U==null&&this.raise(this.start+2,"Expected number in radix "+x),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(U=Ji(this.input.slice(I,this.pos)),++this.pos):kt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(K.num,U)},ui.readNumber=function(x){var I=this.pos;!x&&this.readInt(10,void 0,!0)===null&&this.raise(I,"Invalid number");var U=this.pos-I>=2&&this.input.charCodeAt(I)===48;U&&this.strict&&this.raise(I,"Invalid number");var R=this.input.charCodeAt(this.pos);if(!U&&!x&&this.options.ecmaVersion>=11&&R===110){var ne=Ji(this.input.slice(I,this.pos));return++this.pos,kt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(K.num,ne)}U&&/[89]/.test(this.input.slice(I,this.pos))&&(U=!1),R===46&&!U&&(++this.pos,this.readInt(10),R=this.input.charCodeAt(this.pos)),(R===69||R===101)&&!U&&(R=this.input.charCodeAt(++this.pos),(R===43||R===45)&&++this.pos,this.readInt(10)===null&&this.raise(I,"Invalid number")),kt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var ke=Qi(this.input.slice(I,this.pos),U);return this.finishToken(K.num,ke)},ui.readCodePoint=function(){var x=this.input.charCodeAt(this.pos),I;if(x===123){this.options.ecmaVersion<6&&this.unexpected();var U=++this.pos;I=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,I>1114111&&this.invalidStringToken(U,"Code point out of bounds")}else I=this.readHexChar(4);return I};function oa(x){return x<=65535?String.fromCharCode(x):(x-=65536,String.fromCharCode((x>>10)+55296,(x&1023)+56320))}ui.readString=function(x){for(var I="",U=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var R=this.input.charCodeAt(this.pos);if(R===x)break;R===92?(I+=this.input.slice(U,this.pos),I+=this.readEscapedChar(!1),U=this.pos):(ht(R,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return I+=this.input.slice(U,this.pos++),this.finishToken(K.string,I)};var Ri={};ui.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(x){if(x===Ri)this.readInvalidTemplateToken();else throw x}this.inTemplateElement=!1},ui.invalidStringToken=function(x,I){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ri;this.raise(x,I)},ui.readTmplToken=function(){for(var x="",I=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var U=this.input.charCodeAt(this.pos);if(U===96||U===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===K.template||this.type===K.invalidTemplate)?U===36?(this.pos+=2,this.finishToken(K.dollarBraceL)):(++this.pos,this.finishToken(K.backQuote)):(x+=this.input.slice(I,this.pos),this.finishToken(K.template,x));if(U===92)x+=this.input.slice(I,this.pos),x+=this.readEscapedChar(!0),I=this.pos;else if(ht(U)){switch(x+=this.input.slice(I,this.pos),++this.pos,U){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:x+=`
`;break;default:x+=String.fromCharCode(U);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),I=this.pos}else++this.pos}},ui.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(K.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},ui.readEscapedChar=function(x){var I=this.input.charCodeAt(++this.pos);switch(++this.pos,I){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return oa(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(x){var U=this.pos-1;return this.invalidStringToken(U,"Invalid escape sequence in template string"),null}default:if(I>=48&&I<=55){var R=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],ne=parseInt(R,8);return ne>255&&(R=R.slice(0,-1),ne=parseInt(R,8)),this.pos+=R.length-1,I=this.input.charCodeAt(this.pos),(R!=="0"||I===56||I===57)&&(this.strict||x)&&this.invalidStringToken(this.pos-1-R.length,x?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(ne)}return ht(I)?"":String.fromCharCode(I)}},ui.readHexChar=function(x){var I=this.pos,U=this.readInt(16,x);return U===null&&this.invalidStringToken(I,"Bad character escape sequence"),U},ui.readWord1=function(){this.containsEsc=!1;for(var x="",I=!0,U=this.pos,R=this.options.ecmaVersion>=6;this.pos<this.input.length;){var ne=this.fullCharCodeAtPos();if(ar(ne,R))this.pos+=ne<=65535?1:2;else if(ne===92){this.containsEsc=!0,x+=this.input.slice(U,this.pos);var ke=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var it=this.readCodePoint();(I?kt:ar)(it,R)||this.invalidStringToken(ke,"Invalid Unicode escape"),x+=oa(it),U=this.pos}else break;I=!1}return x+this.input.slice(U,this.pos)},ui.readWord=function(){var x=this.readWord1(),I=K.name;return this.keywords.test(x)&&(I=Bt[x]),this.finishToken(I,x)};var hr="7.4.1";Et.acorn={Parser:Et,version:hr,defaultOptions:Nt,Position:ee,SourceLocation:oe,getLineInfo:bt,Node:si,TokenType:xt,tokTypes:K,keywordTypes:Bt,TokContext:va,tokContexts:xa,isIdentifierChar:ar,isIdentifierStart:kt,Token:Ii,isNewLine:ht,lineBreak:ur,lineBreakG:Tt,nonASCIIwhitespace:Ot};function _r(x,I){return Et.parse(x,I)}function at(x,I,U){return Et.parseExpressionAt(x,I,U)}function Ta(x,I){return Et.tokenizer(x,I)}function $e(x,I){x.prototype=Object.create(I.prototype),x.prototype.constructor=x,x.__proto__=I}function ks(x){var I=typeof Map=="function"?new Map:void 0;return ks=function(R){if(R===null||!Us(R))return R;if(typeof R!="function")throw new TypeError("Super expression must either be null or a function");if(typeof I!="undefined"){if(I.has(R))return I.get(R);I.set(R,ne)}function ne(){return ia(R,arguments,Wa(this).constructor)}return ne.prototype=Object.create(R.prototype,{constructor:{value:ne,enumerable:!1,writable:!0,configurable:!0}}),Ja(ne,R)},ks(x)}function ls(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(x){return!1}}function ia(x,I,U){return ls()?ia=Reflect.construct:ia=function(ne,ke,it){var Pt=[null];Pt.push.apply(Pt,ke);var Lt=Function.bind.apply(ne,Pt),yr=new Lt;return it&&Ja(yr,it.prototype),yr},ia.apply(null,arguments)}function Us(x){return Function.toString.call(x).indexOf("[native code]")!==-1}function Ja(x,I){return Ja=Object.setPrototypeOf||function(R,ne){return R.__proto__=ne,R},Ja(x,I)}function Wa(x){return Wa=Object.setPrototypeOf?Object.getPrototypeOf:function(U){return U.__proto__||Object.getPrototypeOf(U)},Wa(x)}var eo=function(x){$e(I,x);function I(){return x.apply(this,arguments)||this}return I}(ks(Error)),sa=function(x){$e(I,x);function I(){return x.apply(this,arguments)||this}return I}(ks(SyntaxError)),Xo=function(x){$e(I,x);function I(){return x.apply(this,arguments)||this}return I}(ks(ReferenceError)),rs=function(x){$e(I,x);function I(){return x.apply(this,arguments)||this}return I}(ks(TypeError)),bu=function(x){$e(I,x);function I(){return x.apply(this,arguments)||this}return I}(eo),To=function(x){$e(I,x);function I(){return x.apply(this,arguments)||this}return I}(sa),Mo=function(x){$e(I,x);function I(){return x.apply(this,arguments)||this}return I}(Xo),fa={UnknownError:[3001,"%0",bu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",bu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Mo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Mo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Mo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Mo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Mo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Mo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Mo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Mo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Mo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Mo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Xo],VariableUndefinedReferenceError:[2002,"%0 is not defined",Xo],IsNotConstructor:[2003,"%0 is not a constructor",rs]};function to(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(x){return!1}}function Yo(x,I,U){return to()?Yo=Reflect.construct:Yo=function(ne,ke,it){var Pt=[null];Pt.push.apply(Pt,ke);var Lt=Function.bind.apply(ne,Pt),yr=new Lt;return it&&qa(yr,it.prototype),yr},Yo.apply(null,arguments)}function qa(x,I){return qa=Object.setPrototypeOf||function(R,ne){return R.__proto__=ne,R},qa(x,I)}var $s="0.0.3";function Ll(x,I){Object.defineProperty(x,"name",{value:I,writable:!1,enumerable:!1,configurable:!0})}var ns=Object.prototype.hasOwnProperty,he=Symbol("Break"),Pe=Symbol("Continue"),ct=Symbol("DefaultCase"),Yt=Symbol("EmptyStatementReturn"),Yr=Symbol("WithScopeName"),Gn=Symbol("SuperScopeName"),Oi=Symbol("RootScopeName"),uo=Symbol("GlobalScopeName");function Na(x){return typeof x=="function"}var Ka=function(){function x(U){this.interpreter=U}var I=x.prototype;return I.generator=function(){var R=this.interpreter;function ne(){return this.getCurrentScope()}function ke(){return this.getGlobalScope()}function it(){return this.getCurrentContext()}return{getOptions:R.getOptions.bind(R),getCurrentScope:ne.bind(R),getGlobalScope:ke.bind(R),getCurrentContext:it.bind(R),getExecStartTime:R.getExecStartTime.bind(R)}},x}();function is(x,I,U){if(U===void 0&&(U=!0),!(x instanceof Ka))throw new Error("Illegal call");if(typeof I!="string")return I;if(!!I){var R=x.generator(),ne=R.getOptions(),ke={timeout:ne.timeout,_initEnv:function(){U||this.setCurrentContext(R.getCurrentContext()),this.execStartTime=R.getExecStartTime(),this.execEndTime=this.execStartTime}},it=U?R.getGlobalScope():R.getCurrentScope(),Pt=new Pa(it,ke);return Pt.evaluate(I)}}Object.defineProperty(is,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function Uo(x){if(!(x instanceof Ka))throw new Error("Illegal call");for(var I=x.generator(),U=arguments.length,R=new Array(U>1?U-1:0),ne=1;ne<U;ne++)R[ne-1]=arguments[ne];var ke=R.pop(),it=new Pa(I.getGlobalScope(),I.getOptions()),Pt=`
		    (function anonymous(`+R.join(",")+`){
		        `+ke+`
		    });
		    `;return it.evaluate(Pt)}Object.defineProperty(Uo,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var vo=function(I){this.value=I},Ps=function(I){this.value=I},Ls=function(I){this.value=I},Rs=function(I,U,R){U===void 0&&(U=null),this.name=R,this.parent=U,this.data=I,this.labelStack=[]};function qs(){}function uu(x,I){return x===void 0&&(x=null),new Rs(Object.create(null),x,I)}function gs(x){return Object.create(x)}var zi={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:is,Function:Uo};typeof JSON!="undefined"&&(zi.JSON=JSON),typeof Promise!="undefined"&&(zi.Promise=Promise),typeof Set!="undefined"&&(zi.Set=Set),typeof Map!="undefined"&&(zi.Map=Map),typeof Symbol!="undefined"&&(zi.Symbol=Symbol),typeof Proxy!="undefined"&&(zi.Proxy=Proxy),typeof WeakMap!="undefined"&&(zi.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(zi.WeakSet=WeakSet),typeof Reflect!="undefined"&&(zi.Reflect=Reflect);var Pa=function(){function x(U,R){U===void 0&&(U=x.global),R===void 0&&(R={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:R.ecmaVersion||x.ecmaVersion,timeout:R.timeout||0,rootContext:R.rootContext,globalContextInFunction:R.globalContextInFunction===void 0?x.globalContextInFunction:R.globalContextInFunction,_initEnv:R._initEnv},this.context=U||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var I=x.prototype;return I.initEnvironment=function(R){var ne;if(R instanceof Rs)ne=R;else{var ke=null,it=this.createSuperScope(R);this.options.rootContext&&(ke=new Rs(gs(this.options.rootContext),it,Oi)),ne=new Rs(R,ke||it,uo)}this.globalScope=ne,this.currentScope=this.globalScope,this.globalContext=ne.data,this.currentContext=ne.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Pt=this.options._initEnv;Pt&&Pt.call(this)},I.getExecStartTime=function(){return this.execStartTime},I.getExecutionTime=function(){return this.execEndTime-this.execStartTime},I.setExecTimeout=function(R){R===void 0&&(R=0),this.options.timeout=R},I.getOptions=function(){return this.options},I.getGlobalScope=function(){return this.globalScope},I.getCurrentScope=function(){return this.currentScope},I.getCurrentContext=function(){return this.currentContext},I.isInterruptThrow=function(R){return R instanceof bu||R instanceof Mo||R instanceof To},I.createSuperScope=function(R){var ne=Object.assign({},zi),ke=Object.keys(ne);return ke.forEach(function(it){it in R&&delete ne[it]}),new Rs(ne,null,Gn)},I.setCurrentContext=function(R){this.currentContext=R},I.setCurrentScope=function(R){this.currentScope=R},I.evaluate=function(R){R===void 0&&(R="");var ne;if(!!R)return ne=_r(R,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||x.ecmaVersion}),this.evaluateNode(ne,R)},I.appendCode=function(R){return this.evaluate(R)},I.evaluateNode=function(R,ne){var ke=this;ne===void 0&&(ne=""),this.value=void 0,this.source=ne,this.sourceList.push(ne),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var it=this.getCurrentScope(),Pt=this.getCurrentContext(),Lt=it.labelStack.concat([]),yr=this.callStack.concat([]),Lr=function(){ke.setCurrentScope(it),ke.setCurrentContext(Pt),it.labelStack=Lt,ke.callStack=yr};try{var Hn=this.createClosure(R);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Hn()}catch(Jn){throw Jn}finally{Lr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},I.createErrorMessage=function(R,ne,ke){var it=R[1].replace("%0",String(ne));return ke!==null&&(it+=this.getNodePosition(ke||this.lastExecNode)),it},I.createError=function(R,ne){return new ne(R)},I.createThrowError=function(R,ne){return this.createError(R,ne)},I.createInternalThrowError=function(R,ne,ke){return this.createError(this.createErrorMessage(R,ne,ke),R[2])},I.checkTimeout=function(){if(!this.isRunning)return!1;var R=this.options.timeout||0,ne=Date.now();return ne-this.execStartTime>R},I.getNodePosition=function(R){if(R){var ne="";return R.loc?" ["+R.loc.start.line+":"+R.loc.start.column+"]"+ne:""}return""},I.createClosure=function(R){var ne=this,ke;switch(R.type){case"BinaryExpression":ke=this.binaryExpressionHandler(R);break;case"LogicalExpression":ke=this.logicalExpressionHandler(R);break;case"UnaryExpression":ke=this.unaryExpressionHandler(R);break;case"UpdateExpression":ke=this.updateExpressionHandler(R);break;case"ObjectExpression":ke=this.objectExpressionHandler(R);break;case"ArrayExpression":ke=this.arrayExpressionHandler(R);break;case"CallExpression":ke=this.callExpressionHandler(R);break;case"NewExpression":ke=this.newExpressionHandler(R);break;case"MemberExpression":ke=this.memberExpressionHandler(R);break;case"ThisExpression":ke=this.thisExpressionHandler(R);break;case"SequenceExpression":ke=this.sequenceExpressionHandler(R);break;case"Literal":ke=this.literalHandler(R);break;case"Identifier":ke=this.identifierHandler(R);break;case"AssignmentExpression":ke=this.assignmentExpressionHandler(R);break;case"FunctionDeclaration":ke=this.functionDeclarationHandler(R);break;case"VariableDeclaration":ke=this.variableDeclarationHandler(R);break;case"BlockStatement":case"Program":ke=this.programHandler(R);break;case"ExpressionStatement":ke=this.expressionStatementHandler(R);break;case"EmptyStatement":ke=this.emptyStatementHandler(R);break;case"ReturnStatement":ke=this.returnStatementHandler(R);break;case"FunctionExpression":ke=this.functionExpressionHandler(R);break;case"IfStatement":ke=this.ifStatementHandler(R);break;case"ConditionalExpression":ke=this.conditionalExpressionHandler(R);break;case"ForStatement":ke=this.forStatementHandler(R);break;case"WhileStatement":ke=this.whileStatementHandler(R);break;case"DoWhileStatement":ke=this.doWhileStatementHandler(R);break;case"ForInStatement":ke=this.forInStatementHandler(R);break;case"WithStatement":ke=this.withStatementHandler(R);break;case"ThrowStatement":ke=this.throwStatementHandler(R);break;case"TryStatement":ke=this.tryStatementHandler(R);break;case"ContinueStatement":ke=this.continueStatementHandler(R);break;case"BreakStatement":ke=this.breakStatementHandler(R);break;case"SwitchStatement":ke=this.switchStatementHandler(R);break;case"LabeledStatement":ke=this.labeledStatementHandler(R);break;case"DebuggerStatement":ke=this.debuggerStatementHandler(R);break;default:throw this.createInternalThrowError(fa.NodeTypeSyntaxError,R.type,R)}return function(){var it=ne.options.timeout;if(it&&it>0&&ne.checkTimeout())throw ne.createInternalThrowError(fa.ExecutionTimeOutError,it,null);return ne.lastExecNode=R,ke.apply(void 0,arguments)}},I.binaryExpressionHandler=function(R){var ne=this,ke=this.createClosure(R.left),it=this.createClosure(R.right);return function(){var Pt=ke(),Lt=it();switch(R.operator){case"==":return Pt==Lt;case"!=":return Pt!=Lt;case"===":return Pt===Lt;case"!==":return Pt!==Lt;case"<":return Pt<Lt;case"<=":return Pt<=Lt;case">":return Pt>Lt;case">=":return Pt>=Lt;case"<<":return Pt<<Lt;case">>":return Pt>>Lt;case">>>":return Pt>>>Lt;case"+":return Pt+Lt;case"-":return Pt-Lt;case"*":return Pt*Lt;case"**":return Math.pow(Pt,Lt);case"/":return Pt/Lt;case"%":return Pt%Lt;case"|":return Pt|Lt;case"^":return Pt^Lt;case"&":return Pt&Lt;case"in":return Pt in Lt;case"instanceof":return Pt instanceof Lt;default:throw ne.createInternalThrowError(fa.BinaryOperatorSyntaxError,R.operator,R)}}},I.logicalExpressionHandler=function(R){var ne=this,ke=this.createClosure(R.left),it=this.createClosure(R.right);return function(){switch(R.operator){case"||":return ke()||it();case"&&":return ke()&&it();default:throw ne.createInternalThrowError(fa.LogicalOperatorSyntaxError,R.operator,R)}}},I.unaryExpressionHandler=function(R){var ne=this;switch(R.operator){case"delete":var ke=this.createObjectGetter(R.argument),it=this.createNameGetter(R.argument);return function(){var Lr=ke(),Hn=it();return delete Lr[Hn]};default:var Pt;if(R.operator==="typeof"&&R.argument.type==="Identifier"){var Lt=this.createObjectGetter(R.argument),yr=this.createNameGetter(R.argument);Pt=function(){return Lt()[yr()]}}else Pt=this.createClosure(R.argument);return function(){var Lr=Pt();switch(R.operator){case"-":return-Lr;case"+":return+Lr;case"!":return!Lr;case"~":return~Lr;case"void":return;case"typeof":return typeof Lr;default:throw ne.createInternalThrowError(fa.UnaryOperatorSyntaxError,R.operator,R)}}}},I.updateExpressionHandler=function(R){var ne=this,ke=this.createObjectGetter(R.argument),it=this.createNameGetter(R.argument);return function(){var Pt=ke(),Lt=it();switch(ne.assertVariable(Pt,Lt,R),R.operator){case"++":return R.prefix?++Pt[Lt]:Pt[Lt]++;case"--":return R.prefix?--Pt[Lt]:Pt[Lt]--;default:throw ne.createInternalThrowError(fa.UpdateOperatorSyntaxError,R.operator,R)}}},I.objectExpressionHandler=function(R){var ne=this,ke=[];function it(Lt){return Lt.type==="Identifier"?Lt.name:Lt.type==="Literal"?Lt.value:this.throwError(fa.ObjectStructureSyntaxError,Lt.type,Lt)}var Pt=Object.create(null);return R.properties.forEach(function(Lt){var yr=Lt.kind,Lr=it(Lt.key);(!Pt[Lr]||yr==="init")&&(Pt[Lr]={}),Pt[Lr][yr]=ne.createClosure(Lt.value),ke.push({key:Lr,property:Lt})}),function(){for(var Lt={},yr=ke.length,Lr=0;Lr<yr;Lr++){var Hn=ke[Lr],Jn=Hn.key,vi=Pt[Jn],Yi=vi.init?vi.init():void 0,ba=vi.get?vi.get():function(){},Ra=vi.set?vi.set():function(gl){};if("set"in vi||"get"in vi){var $i={configurable:!0,enumerable:!0,get:ba,set:Ra};Object.defineProperty(Lt,Jn,$i)}else{var ys=Hn.property,lu=ys.kind;ys.key.type==="Identifier"&&ys.value.type==="FunctionExpression"&&lu==="init"&&!ys.value.id&&Ll(Yi,ys.key.name),Lt[Jn]=Yi}}return Lt}},I.arrayExpressionHandler=function(R){var ne=this,ke=R.elements.map(function(it){return it&&ne.createClosure(it)});return function(){for(var it=ke.length,Pt=Array(it),Lt=0;Lt<it;Lt++){var yr=ke[Lt];yr&&(Pt[Lt]=yr())}return Pt}},I.safeObjectGet=function(R,ne,ke){return R[ne]},I.createCallFunctionGetter=function(R){var ne=this;switch(R.type){case"MemberExpression":var ke=this.createClosure(R.object),it=this.createMemberKeyGetter(R),Pt=this.source;return function(){var yr=ke(),Lr=it(),Hn=ne.safeObjectGet(yr,Lr,R);if(!Hn||!Na(Hn)){var Jn=Pt.slice(R.start,R.end);throw ne.createInternalThrowError(fa.FunctionUndefinedReferenceError,Jn,R)}return Hn.__IS_EVAL_FUNC?function(vi){return Hn(new Ka(ne),vi,!0)}:Hn.__IS_FUNCTION_FUNC?function(){for(var vi=arguments.length,Yi=new Array(vi),ba=0;ba<vi;ba++)Yi[ba]=arguments[ba];return Hn.apply(void 0,[new Ka(ne)].concat(Yi))}:Hn.bind(yr)};default:var Lt=this.createClosure(R);return function(){var yr="";R.type==="Identifier"&&(yr=R.name);var Lr=Lt();if(!Lr||!Na(Lr))throw ne.createInternalThrowError(fa.FunctionUndefinedReferenceError,yr,R);if(R.type==="Identifier"&&Lr.__IS_EVAL_FUNC&&yr==="eval")return function(vi){var Yi=ne.getScopeFromName(yr,ne.getCurrentScope()),ba=Yi.name===Gn||Yi.name===uo||Yi.name===Oi;return Lr(new Ka(ne),vi,!ba)};if(Lr.__IS_EVAL_FUNC)return function(vi){return Lr(new Ka(ne),vi,!0)};if(Lr.__IS_FUNCTION_FUNC)return function(){for(var vi=arguments.length,Yi=new Array(vi),ba=0;ba<vi;ba++)Yi[ba]=arguments[ba];return Lr.apply(void 0,[new Ka(ne)].concat(Yi))};var Hn=ne.options.globalContextInFunction;if(R.type==="Identifier"){var Jn=ne.getIdentifierScope(R);Jn.name===Yr&&(Hn=Jn.data)}return Lr.bind(Hn)}}},I.callExpressionHandler=function(R){var ne=this,ke=this.createCallFunctionGetter(R.callee),it=R.arguments.map(function(Pt){return ne.createClosure(Pt)});return function(){return ke().apply(void 0,it.map(function(Pt){return Pt()}))}},I.functionExpressionHandler=function(R){var ne=this,ke=this,it=this.source,Pt=this.collectDeclVars,Lt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var yr=R.id?R.id.name:"",Lr=R.params.length,Hn=R.params.map(function(ba){return ne.createParamNameGetter(ba)}),Jn=this.createClosure(R.body),vi=this.collectDeclVars,Yi=this.collectDeclFuncs;return this.collectDeclVars=Pt,this.collectDeclFuncs=Lt,function(){var ba=ke.getCurrentScope(),Ra=function $i(){for(var ys=arguments.length,lu=new Array(ys),gl=0;gl<ys;gl++)lu[gl]=arguments[gl];ke.callStack.push(""+yr);var hf=ke.getCurrentScope(),yl=uu(ba,"FunctionScope("+yr+")");ke.setCurrentScope(yl),ke.addDeclarationsToScope(vi,Yi,yl),yr&&(yl.data[yr]=$i),yl.data.arguments=arguments,Hn.forEach(function(Bu,Nu){yl.data[Bu()]=lu[Nu]});var zc=ke.getCurrentContext();ke.setCurrentContext(this);var Fu=Jn();if(ke.setCurrentContext(zc),ke.setCurrentScope(hf),ke.callStack.pop(),Fu instanceof vo)return Fu.value};return Ll(Ra,yr),Object.defineProperty(Ra,"length",{value:Lr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Ra,"toString",{value:function(){return it.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Ra,"valueOf",{value:function(){return it.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Ra}},I.newExpressionHandler=function(R){var ne=this,ke=this.source,it=this.createClosure(R.callee),Pt=R.arguments.map(function(Lt){return ne.createClosure(Lt)});return function(){var Lt=it();if(!Na(Lt)||Lt.__IS_EVAL_FUNC){var yr=R.callee,Lr=ke.slice(yr.start,yr.end);throw ne.createInternalThrowError(fa.IsNotConstructor,Lr,R)}return Lt.__IS_FUNCTION_FUNC?Lt.apply(void 0,[new Ka(ne)].concat(Pt.map(function(Hn){return Hn()}))):Yo(Lt,Pt.map(function(Hn){return Hn()}))}},I.memberExpressionHandler=function(R){var ne=this.createClosure(R.object),ke=this.createMemberKeyGetter(R);return function(){var it=ne(),Pt=ke();return it[Pt]}},I.thisExpressionHandler=function(R){var ne=this;return function(){return ne.getCurrentContext()}},I.sequenceExpressionHandler=function(R){var ne=this,ke=R.expressions.map(function(it){return ne.createClosure(it)});return function(){for(var it,Pt=ke.length,Lt=0;Lt<Pt;Lt++){var yr=ke[Lt];it=yr()}return it}},I.literalHandler=function(R){return function(){return R.regex?new RegExp(R.regex.pattern,R.regex.flags):R.value}},I.identifierHandler=function(R){var ne=this;return function(){var ke=ne.getCurrentScope(),it=ne.getScopeDataFromName(R.name,ke);return ne.assertVariable(it,R.name,R),it[R.name]}},I.getIdentifierScope=function(R){var ne=this.getCurrentScope(),ke=this.getScopeFromName(R.name,ne);return ke},I.assignmentExpressionHandler=function(R){var ne=this;R.left.type==="Identifier"&&R.right.type==="FunctionExpression"&&!R.right.id&&(R.right.id={type:"Identifier",name:R.left.name});var ke=this.createObjectGetter(R.left),it=this.createNameGetter(R.left),Pt=this.createClosure(R.right);return function(){var Lt=ke(),yr=it(),Lr=Pt();switch(R.operator!=="="&&ne.assertVariable(Lt,yr,R),R.operator){case"=":return Lt[yr]=Lr;case"+=":return Lt[yr]+=Lr;case"-=":return Lt[yr]-=Lr;case"*=":return Lt[yr]*=Lr;case"**=":return Lt[yr]=Math.pow(Lt[yr],Lr);case"/=":return Lt[yr]/=Lr;case"%=":return Lt[yr]%=Lr;case"<<=":return Lt[yr]<<=Lr;case">>=":return Lt[yr]>>=Lr;case">>>=":return Lt[yr]>>>=Lr;case"&=":return Lt[yr]&=Lr;case"^=":return Lt[yr]^=Lr;case"|=":return Lt[yr]|=Lr;default:throw ne.createInternalThrowError(fa.AssignmentExpressionSyntaxError,R.type,R)}}},I.functionDeclarationHandler=function(R){if(R.id){var ne=this.functionExpressionHandler(R);Object.defineProperty(ne,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(R.id.name,ne)}return function(){return Yt}},I.getVariableName=function(R){if(R.type==="Identifier")return R.name;throw this.createInternalThrowError(fa.VariableTypeSyntaxError,R.type,R)},I.variableDeclarationHandler=function(R){for(var ne=this,ke,it=[],Pt=0;Pt<R.declarations.length;Pt++){var Lt=R.declarations[Pt];this.varDeclaration(this.getVariableName(Lt.id)),Lt.init&&it.push({type:"AssignmentExpression",operator:"=",left:Lt.id,right:Lt.init})}return it.length&&(ke=this.createClosure({type:"BlockStatement",body:it})),function(){if(ke){var yr=ne.isVarDeclMode;ne.isVarDeclMode=!0,ke(),ne.isVarDeclMode=yr}return Yt}},I.assertVariable=function(R,ne,ke){if(R===this.globalScope.data&&!(ne in R))throw this.createInternalThrowError(fa.VariableUndefinedReferenceError,ne,ke)},I.programHandler=function(R){var ne=this,ke=R.body.map(function(it){return ne.createClosure(it)});return function(){for(var it=Yt,Pt=0;Pt<ke.length;Pt++){var Lt=ke[Pt],yr=ne.setValue(Lt());if(yr!==Yt&&(it=yr,it instanceof vo||it instanceof Ps||it instanceof Ls||it===he||it===Pe))break}return it}},I.expressionStatementHandler=function(R){return this.createClosure(R.expression)},I.emptyStatementHandler=function(R){return function(){return Yt}},I.returnStatementHandler=function(R){var ne=R.argument?this.createClosure(R.argument):qs;return function(){return new vo(ne())}},I.ifStatementHandler=function(R){var ne=this.createClosure(R.test),ke=this.createClosure(R.consequent),it=R.alternate?this.createClosure(R.alternate):function(){return Yt};return function(){return ne()?ke():it()}},I.conditionalExpressionHandler=function(R){return this.ifStatementHandler(R)},I.forStatementHandler=function(R){var ne=this,ke=qs,it=R.test?this.createClosure(R.test):function(){return!0},Pt=qs,Lt=this.createClosure(R.body);return R.type==="ForStatement"&&(ke=R.init?this.createClosure(R.init):ke,Pt=R.update?this.createClosure(R.update):qs),function(yr){var Lr,Hn=Yt,Jn=R.type==="DoWhileStatement";for(yr&&yr.type==="LabeledStatement"&&(Lr=yr.label.name),ke();Jn||it();Pt()){Jn=!1;var vi=ne.setValue(Lt());if(!(vi===Yt||vi===Pe)){if(vi===he)break;if(Hn=vi,Hn instanceof Ls&&Hn.value===Lr){Hn=Yt;continue}if(Hn instanceof vo||Hn instanceof Ps||Hn instanceof Ls)break}}return Hn}},I.whileStatementHandler=function(R){return this.forStatementHandler(R)},I.doWhileStatementHandler=function(R){return this.forStatementHandler(R)},I.forInStatementHandler=function(R){var ne=this,ke=R.left,it=this.createClosure(R.right),Pt=this.createClosure(R.body);return R.left.type==="VariableDeclaration"&&(this.createClosure(R.left)(),ke=R.left.declarations[0].id),function(Lt){var yr,Lr=Yt,Hn;Lt&&Lt.type==="LabeledStatement"&&(yr=Lt.label.name);var Jn=it();for(Hn in Jn){ne.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:ke,right:{type:"Literal",value:Hn}})();var vi=ne.setValue(Pt());if(!(vi===Yt||vi===Pe)){if(vi===he)break;if(Lr=vi,Lr instanceof Ls&&Lr.value===yr){Lr=Yt;continue}if(Lr instanceof vo||Lr instanceof Ps||Lr instanceof Ls)break}}return Lr}},I.withStatementHandler=function(R){var ne=this,ke=this.createClosure(R.object),it=this.createClosure(R.body);return function(){var Pt=ke(),Lt=ne.getCurrentScope(),yr=new Rs(Pt,Lt,Yr);ne.setCurrentScope(yr);var Lr=ne.setValue(it());return ne.setCurrentScope(Lt),Lr}},I.throwStatementHandler=function(R){var ne=this,ke=this.createClosure(R.argument);return function(){throw ne.setValue(void 0),ke()}},I.tryStatementHandler=function(R){var ne=this,ke=this.createClosure(R.block),it=R.handler?this.catchClauseHandler(R.handler):null,Pt=R.finalizer?this.createClosure(R.finalizer):null;return function(){var Lt=ne.getCurrentScope(),yr=ne.getCurrentContext(),Lr=Lt.labelStack.concat([]),Hn=ne.callStack.concat([]),Jn=Yt,vi,Yi,ba=function(){ne.setCurrentScope(Lt),ne.setCurrentContext(yr),Lt.labelStack=Lr,ne.callStack=Hn};try{Jn=ne.setValue(ke()),Jn instanceof vo&&(vi=Jn)}catch(Ra){if(ba(),ne.isInterruptThrow(Ra))throw Ra;if(it)try{Jn=ne.setValue(it(Ra)),Jn instanceof vo&&(vi=Jn)}catch($i){if(ba(),ne.isInterruptThrow($i))throw $i;Yi=$i}}if(Pt)try{Jn=Pt(),Jn instanceof vo&&(vi=Jn)}catch(Ra){if(ba(),ne.isInterruptThrow(Ra))throw Ra;Yi=Ra}if(Yi)throw Yi;return vi||Jn}},I.catchClauseHandler=function(R){var ne=this,ke=this.createParamNameGetter(R.param),it=this.createClosure(R.body);return function(Pt){var Lt,yr=ne.getCurrentScope(),Lr=yr.data,Hn=ke(),Jn=ns.call(Lr,Hn),vi=Lr[Hn];return Lr[Hn]=Pt,Lt=it(),Jn?Lr[Hn]=vi:delete Lr[Hn],Lt}},I.continueStatementHandler=function(R){return function(){return R.label?new Ls(R.label.name):Pe}},I.breakStatementHandler=function(R){return function(){return R.label?new Ps(R.label.name):he}},I.switchStatementHandler=function(R){var ne=this,ke=this.createClosure(R.discriminant),it=R.cases.map(function(Pt){return ne.switchCaseHandler(Pt)});return function(){for(var Pt=ke(),Lt=!1,yr,Lr,Hn,Jn=0;Jn<it.length;Jn++){var vi=it[Jn](),Yi=vi.testClosure();if(Yi===ct){Hn=vi;continue}if(Lt||Yi===Pt){if(Lt=!0,Lr=ne.setValue(vi.bodyClosure()),Lr===Yt)continue;if(Lr===he||(yr=Lr,yr instanceof vo||yr instanceof Ps||yr instanceof Ls||yr===Pe))break}}if(!Lt&&Hn){Lr=ne.setValue(Hn.bodyClosure());var ba=Lr===Yt||Lr===he||Lr===Pe;ba||(yr=Lr)}return yr}},I.switchCaseHandler=function(R){var ne=R.test?this.createClosure(R.test):function(){return ct},ke=this.createClosure({type:"BlockStatement",body:R.consequent});return function(){return{testClosure:ne,bodyClosure:ke}}},I.labeledStatementHandler=function(R){var ne=this,ke=R.label.name,it=this.createClosure(R.body);return function(){var Pt,Lt=ne.getCurrentScope();return Lt.labelStack.push(ke),Pt=it(R),Pt instanceof Ps&&Pt.value===ke&&(Pt=Yt),Lt.labelStack.pop(),Pt}},I.debuggerStatementHandler=function(R){return function(){debugger;return Yt}},I.createParamNameGetter=function(R){if(R.type==="Identifier")return function(){return R.name};throw this.createInternalThrowError(fa.ParamTypeSyntaxError,R.type,R)},I.createObjectKeyGetter=function(R){var ne;return R.type==="Identifier"?ne=function(){return R.name}:ne=this.createClosure(R),function(){return ne()}},I.createMemberKeyGetter=function(R){return R.computed?this.createClosure(R.property):this.createObjectKeyGetter(R.property)},I.createObjectGetter=function(R){var ne=this;switch(R.type){case"Identifier":return function(){return ne.getScopeDataFromName(R.name,ne.getCurrentScope())};case"MemberExpression":return this.createClosure(R.object);default:throw this.createInternalThrowError(fa.AssignmentTypeSyntaxError,R.type,R)}},I.createNameGetter=function(R){switch(R.type){case"Identifier":return function(){return R.name};case"MemberExpression":return this.createMemberKeyGetter(R);default:throw this.createInternalThrowError(fa.AssignmentTypeSyntaxError,R.type,R)}},I.varDeclaration=function(R){var ne=this.collectDeclVars;ne[R]=void 0},I.funcDeclaration=function(R,ne){var ke=this.collectDeclFuncs;ke[R]=ne},I.addDeclarationsToScope=function(R,ne,ke){var it=ke.data;for(var Pt in ne){var Lt=ne[Pt];it[Pt]=Lt&&Lt()}for(var yr in R)yr in it||(it[yr]=void 0)},I.getScopeValue=function(R,ne){var ke=this.getScopeFromName(R,ne);return ke.data[R]},I.getScopeDataFromName=function(R,ne){return this.getScopeFromName(R,ne).data},I.getScopeFromName=function(R,ne){var ke=ne;do if(R in ke.data)return ke;while(ke=ke.parent);return this.globalScope},I.setValue=function(R){var ne=this.callStack.length;return this.isVarDeclMode||ne||R===Yt||R===he||R===Pe||R instanceof Ps||R instanceof Ls||(this.value=R instanceof vo?R.value:R),R},I.getValue=function(){return this.value},x}();Pa.version=$s,Pa.eval=is,Pa.Function=Uo,Pa.ecmaVersion=5,Pa.globalContextInFunction=void 0,Pa.global=Object.create(null);function Nc(x){return x===void 0&&(x=Object.create(null)),x}function cf(x,I,U){I===void 0&&(I=[]),U===void 0&&(U={});var R=U.parsingContext,ne=U.timeout===void 0?0:U.timeout,ke=`
    (function anonymous(`+I.join(",")+`){
         `+x+`
    });
    `,it=new Pa(R,{ecmaVersion:U.ecmaVersion,timeout:ne,rootContext:U.rootContext,globalContextInFunction:U.globalContextInFunction});return it.evaluate(ke)}function Os(x,I,U){var R=new Pa(I,U);return R.evaluate(x)}var ff=Os,ml=function(){function x(U){this._code=U}var I=x.prototype;return I.runInContext=function(R){return Os(this._code,R)},I.runInNewContext=function(R){return Os(this._code,R)},x}(),el=function(x,I,U){return Os(x,I,U)};function Ks(){for(var x=arguments.length,I=new Array(x),U=0;U<x;U++)I[U]=arguments[U];var R=I.pop();return cf(R||"",I)}var Rl=el},20396:function(nn,ye,fe){var Le;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(J,y,Ae,T){"use strict";var ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,pe=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Fe=ce||pe,_e=["","webkit","Moz","MS","ms","o"],Ge=Fe?"":y.createElement("div"),ot="function",ft=Math.round,kt=Math.abs,ar=Date.now;function xt(he,Pe,ct){return setTimeout(Tt(he,ct),Pe)}function Jt(he,Pe,ct){return Array.isArray(he)?(Gt(he,ct[Pe],ct),!0):!1}function Gt(he,Pe,ct){var Yt;if(!!he)if(he.forEach)he.forEach(Pe,ct);else if(he.length!==T)for(Yt=0;Yt<he.length;)Pe.call(ct,he[Yt],Yt,he),Yt++;else for(Yt in he)he.hasOwnProperty(Yt)&&Pe.call(ct,he[Yt],Yt,he)}function wt(he,Pe,ct){var Yt="DEPRECATED METHOD: "+Pe+`
`+ct+` AT 
`;return function(){var Yr=new Error("get-stack-trace"),Gn=Yr&&Yr.stack?Yr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Oi=J.console&&(J.console.warn||J.console.log);return Oi&&Oi.call(J.console,Yt,Gn),he.apply(this,arguments)}}var Bt;typeof Object.assign!="function"?Bt=function(Pe){if(Pe===T||Pe===null)throw new TypeError("Cannot convert undefined or null to object");for(var ct=Object(Pe),Yt=1;Yt<arguments.length;Yt++){var Yr=arguments[Yt];if(Yr!==T&&Yr!==null)for(var Gn in Yr)Yr.hasOwnProperty(Gn)&&(ct[Gn]=Yr[Gn])}return ct}:Bt=Object.assign;var gr=wt(function(Pe,ct,Yt){for(var Yr=Object.keys(ct),Gn=0;Gn<Yr.length;)(!Yt||Yt&&Pe[Yr[Gn]]===T)&&(Pe[Yr[Gn]]=ct[Yr[Gn]]),Gn++;return Pe},"extend","Use `assign`."),K=wt(function(Pe,ct){return gr(Pe,ct,!0)},"merge","Use `assign`.");function ur(he,Pe,ct){var Yt=Pe.prototype,Yr;Yr=he.prototype=Object.create(Yt),Yr.constructor=he,Yr._super=Yt,ct&&Bt(Yr,ct)}function Tt(he,Pe){return function(){return he.apply(Pe,arguments)}}function ht(he,Pe){return typeof he==ot?he.apply(Pe&&Pe[0]||T,Pe):he}function Ot(he,Pe){return he===T?Pe:he}function pt(he,Pe,ct){Gt(ge(Pe),function(Yt){he.addEventListener(Yt,ct,!1)})}function lr(he,Pe,ct){Gt(ge(Pe),function(Yt){he.removeEventListener(Yt,ct,!1)})}function Br(he,Pe){for(;he;){if(he==Pe)return!0;he=he.parentNode}return!1}function q(he,Pe){return he.indexOf(Pe)>-1}function ge(he){return he.trim().split(/\s+/g)}function Q(he,Pe,ct){if(he.indexOf&&!ct)return he.indexOf(Pe);for(var Yt=0;Yt<he.length;){if(ct&&he[Yt][ct]==Pe||!ct&&he[Yt]===Pe)return Yt;Yt++}return-1}function Me(he){return Array.prototype.slice.call(he,0)}function ee(he,Pe,ct){for(var Yt=[],Yr=[],Gn=0;Gn<he.length;){var Oi=Pe?he[Gn][Pe]:he[Gn];Q(Yr,Oi)<0&&Yt.push(he[Gn]),Yr[Gn]=Oi,Gn++}return ct&&(Pe?Yt=Yt.sort(function(Na,Ka){return Na[Pe]>Ka[Pe]}):Yt=Yt.sort()),Yt}function oe(he,Pe){for(var ct,Yt,Yr=Pe[0].toUpperCase()+Pe.slice(1),Gn=0;Gn<_e.length;){if(ct=_e[Gn],Yt=ct?ct+Yr:Pe,Yt in he)return Yt;Gn++}return T}var bt=1;function Nt(){return bt++}function jt(he){var Pe=he.ownerDocument||he;return Pe.defaultView||Pe.parentWindow||J}var Qt=/mobile|tablet|ip(ad|hone|od)|android/i,ln="ontouchstart"in J,Dr=oe(J,"PointerEvent")!==T,oi=ln&&Qt.test(navigator.userAgent),Zn="touch",Vn="pen",Xi="mouse",Ci="kinect",fi=25,Hi=1,Ni=2,hi=4,Xn=8,ri=1,po=2,Ha=4,wa=8,Et=16,me=po|Ha,se=wa|Et,Se=me|se,z=["x","y"],qe=["clientX","clientY"];function qt(he,Pe){var ct=this;this.manager=he,this.callback=Pe,this.element=he.element,this.target=he.options.inputTarget,this.domHandler=function(Yt){ht(he.options.enable,[he])&&ct.handler(Yt)},this.init()}qt.prototype={handler:function(){},init:function(){this.evEl&&pt(this.element,this.evEl,this.domHandler),this.evTarget&&pt(this.target,this.evTarget,this.domHandler),this.evWin&&pt(jt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&lr(this.element,this.evEl,this.domHandler),this.evTarget&&lr(this.target,this.evTarget,this.domHandler),this.evWin&&lr(jt(this.element),this.evWin,this.domHandler)}};function Or(he){var Pe,ct=he.options.inputClass;return ct?Pe=ct:Dr?Pe=Ze:oi?Pe=er:ln?Pe=Ht:Pe=Ki,new Pe(he,Ye)}function Ye(he,Pe,ct){var Yt=ct.pointers.length,Yr=ct.changedPointers.length,Gn=Pe&Hi&&Yt-Yr==0,Oi=Pe&(hi|Xn)&&Yt-Yr==0;ct.isFirst=!!Gn,ct.isFinal=!!Oi,Gn&&(he.session={}),ct.eventType=Pe,Mt(he,ct),he.emit("hammer.input",ct),he.recognize(ct),he.session.prevInput=ct}function Mt(he,Pe){var ct=he.session,Yt=Pe.pointers,Yr=Yt.length;ct.firstInput||(ct.firstInput=Zr(Pe)),Yr>1&&!ct.firstMultiple?ct.firstMultiple=Zr(Pe):Yr===1&&(ct.firstMultiple=!1);var Gn=ct.firstInput,Oi=ct.firstMultiple,uo=Oi?Oi.center:Gn.center,Na=Pe.center=qr(Yt);Pe.timeStamp=ar(),Pe.deltaTime=Pe.timeStamp-Gn.timeStamp,Pe.angle=pi(uo,Na),Pe.distance=en(uo,Na),pr(ct,Pe),Pe.offsetDirection=Nn(Pe.deltaX,Pe.deltaY);var Ka=jn(Pe.deltaTime,Pe.deltaX,Pe.deltaY);Pe.overallVelocityX=Ka.x,Pe.overallVelocityY=Ka.y,Pe.overallVelocity=kt(Ka.x)>kt(Ka.y)?Ka.x:Ka.y,Pe.scale=Oi?ra(Oi.pointers,Yt):1,Pe.rotation=Oi?si(Oi.pointers,Yt):0,Pe.maxPointers=ct.prevInput?Pe.pointers.length>ct.prevInput.maxPointers?Pe.pointers.length:ct.prevInput.maxPointers:Pe.pointers.length,Mr(ct,Pe);var is=he.element;Br(Pe.srcEvent.target,is)&&(is=Pe.srcEvent.target),Pe.target=is}function pr(he,Pe){var ct=Pe.center,Yt=he.offsetDelta||{},Yr=he.prevDelta||{},Gn=he.prevInput||{};(Pe.eventType===Hi||Gn.eventType===hi)&&(Yr=he.prevDelta={x:Gn.deltaX||0,y:Gn.deltaY||0},Yt=he.offsetDelta={x:ct.x,y:ct.y}),Pe.deltaX=Yr.x+(ct.x-Yt.x),Pe.deltaY=Yr.y+(ct.y-Yt.y)}function Mr(he,Pe){var ct=he.lastInterval||Pe,Yt=Pe.timeStamp-ct.timeStamp,Yr,Gn,Oi,uo;if(Pe.eventType!=Xn&&(Yt>fi||ct.velocity===T)){var Na=Pe.deltaX-ct.deltaX,Ka=Pe.deltaY-ct.deltaY,is=jn(Yt,Na,Ka);Gn=is.x,Oi=is.y,Yr=kt(is.x)>kt(is.y)?is.x:is.y,uo=Nn(Na,Ka),he.lastInterval=Pe}else Yr=ct.velocity,Gn=ct.velocityX,Oi=ct.velocityY,uo=ct.direction;Pe.velocity=Yr,Pe.velocityX=Gn,Pe.velocityY=Oi,Pe.direction=uo}function Zr(he){for(var Pe=[],ct=0;ct<he.pointers.length;)Pe[ct]={clientX:ft(he.pointers[ct].clientX),clientY:ft(he.pointers[ct].clientY)},ct++;return{timeStamp:ar(),pointers:Pe,center:qr(Pe),deltaX:he.deltaX,deltaY:he.deltaY}}function qr(he){var Pe=he.length;if(Pe===1)return{x:ft(he[0].clientX),y:ft(he[0].clientY)};for(var ct=0,Yt=0,Yr=0;Yr<Pe;)ct+=he[Yr].clientX,Yt+=he[Yr].clientY,Yr++;return{x:ft(ct/Pe),y:ft(Yt/Pe)}}function jn(he,Pe,ct){return{x:Pe/he||0,y:ct/he||0}}function Nn(he,Pe){return he===Pe?ri:kt(he)>=kt(Pe)?he<0?po:Ha:Pe<0?wa:Et}function en(he,Pe,ct){ct||(ct=z);var Yt=Pe[ct[0]]-he[ct[0]],Yr=Pe[ct[1]]-he[ct[1]];return Math.sqrt(Yt*Yt+Yr*Yr)}function pi(he,Pe,ct){ct||(ct=z);var Yt=Pe[ct[0]]-he[ct[0]],Yr=Pe[ct[1]]-he[ct[1]];return Math.atan2(Yr,Yt)*180/Math.PI}function si(he,Pe){return pi(Pe[1],Pe[0],qe)+pi(he[1],he[0],qe)}function ra(he,Pe){return en(Pe[0],Pe[1],qe)/en(he[0],he[1],qe)}var Aa={mousedown:Hi,mousemove:Ni,mouseup:hi},va="mousedown",xa="mousemove mouseup";function Ki(){this.evEl=va,this.evWin=xa,this.pressed=!1,qt.apply(this,arguments)}ur(Ki,qt,{handler:function(Pe){var ct=Aa[Pe.type];ct&Hi&&Pe.button===0&&(this.pressed=!0),ct&Ni&&Pe.which!==1&&(ct=hi),!!this.pressed&&(ct&hi&&(this.pressed=!1),this.callback(this.manager,ct,{pointers:[Pe],changedPointers:[Pe],pointerType:Xi,srcEvent:Pe}))}});var Y={pointerdown:Hi,pointermove:Ni,pointerup:hi,pointercancel:Xn,pointerout:Xn},ie={2:Zn,3:Vn,4:Xi,5:Ci},de="pointerdown",Ce="pointermove pointerup pointercancel";!Fe&&J.MSPointerEvent&&!J.PointerEvent&&(de="MSPointerDown",Ce="MSPointerMove MSPointerUp MSPointerCancel");function Ze(){this.evEl=de,this.evWin=Ce,qt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}ur(Ze,qt,{handler:function(Pe){var ct=this.store,Yt=!1,Yr=Pe.type.toLowerCase().replace("ms",""),Gn=Y[Yr],Oi=ie[Pe.pointerType]||Pe.pointerType,uo=Oi==Zn,Na=Q(ct,Pe.pointerId,"pointerId");Gn&Hi&&(Pe.button===0||uo)?Na<0&&(ct.push(Pe),Na=ct.length-1):Gn&(hi|Xn)&&(Yt=!0),!(Na<0)&&(ct[Na]=Pe,this.callback(this.manager,Gn,{pointers:ct,changedPointers:[Pe],pointerType:Oi,srcEvent:Pe}),Yt&&ct.splice(Na,1))}});var et={touchstart:Hi,touchmove:Ni,touchend:hi,touchcancel:Xn},dt="touchstart",be="touchstart touchmove touchend touchcancel";function He(){this.evTarget=dt,this.evWin=be,this.started=!1,qt.apply(this,arguments)}ur(He,qt,{handler:function(Pe){var ct=et[Pe.type];if(ct===Hi&&(this.started=!0),!!this.started){var Yt=Rt.call(this,Pe,ct);ct&(hi|Xn)&&Yt[0].length-Yt[1].length==0&&(this.started=!1),this.callback(this.manager,ct,{pointers:Yt[0],changedPointers:Yt[1],pointerType:Zn,srcEvent:Pe})}}});function Rt(he,Pe){var ct=Me(he.touches),Yt=Me(he.changedTouches);return Pe&(hi|Xn)&&(ct=ee(ct.concat(Yt),"identifier",!0)),[ct,Yt]}var kr={touchstart:Hi,touchmove:Ni,touchend:hi,touchcancel:Xn},Xt="touchstart touchmove touchend touchcancel";function er(){this.evTarget=Xt,this.targetIds={},qt.apply(this,arguments)}ur(er,qt,{handler:function(Pe){var ct=kr[Pe.type],Yt=Pr.call(this,Pe,ct);!Yt||this.callback(this.manager,ct,{pointers:Yt[0],changedPointers:Yt[1],pointerType:Zn,srcEvent:Pe})}});function Pr(he,Pe){var ct=Me(he.touches),Yt=this.targetIds;if(Pe&(Hi|Ni)&&ct.length===1)return Yt[ct[0].identifier]=!0,[ct,ct];var Yr,Gn,Oi=Me(he.changedTouches),uo=[],Na=this.target;if(Gn=ct.filter(function(Ka){return Br(Ka.target,Na)}),Pe===Hi)for(Yr=0;Yr<Gn.length;)Yt[Gn[Yr].identifier]=!0,Yr++;for(Yr=0;Yr<Oi.length;)Yt[Oi[Yr].identifier]&&uo.push(Oi[Yr]),Pe&(hi|Xn)&&delete Yt[Oi[Yr].identifier],Yr++;if(!!uo.length)return[ee(Gn.concat(uo),"identifier",!0),uo]}var Ln=2500,An=25;function Ht(){qt.apply(this,arguments);var he=Tt(this.handler,this);this.touch=new er(this.manager,he),this.mouse=new Ki(this.manager,he),this.primaryTouch=null,this.lastTouches=[]}ur(Ht,qt,{handler:function(Pe,ct,Yt){var Yr=Yt.pointerType==Zn,Gn=Yt.pointerType==Xi;if(!(Gn&&Yt.sourceCapabilities&&Yt.sourceCapabilities.firesTouchEvents)){if(Yr)xn.call(this,ct,Yt);else if(Gn&&pn.call(this,Yt))return;this.callback(Pe,ct,Yt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function xn(he,Pe){he&Hi?(this.primaryTouch=Pe.changedPointers[0].identifier,sn.call(this,Pe)):he&(hi|Xn)&&sn.call(this,Pe)}function sn(he){var Pe=he.changedPointers[0];if(Pe.identifier===this.primaryTouch){var ct={x:Pe.clientX,y:Pe.clientY};this.lastTouches.push(ct);var Yt=this.lastTouches,Yr=function(){var Gn=Yt.indexOf(ct);Gn>-1&&Yt.splice(Gn,1)};setTimeout(Yr,Ln)}}function pn(he){for(var Pe=he.srcEvent.clientX,ct=he.srcEvent.clientY,Yt=0;Yt<this.lastTouches.length;Yt++){var Yr=this.lastTouches[Yt],Gn=Math.abs(Pe-Yr.x),Oi=Math.abs(ct-Yr.y);if(Gn<=An&&Oi<=An)return!0}return!1}var bi=Fe?T:oe(Ge.style,"touchAction"),yn=bi!==T,Pi="compute",aa="auto",vt="manipulation",yt="none",Ii="pan-x",ui="pan-y",Qi=Ri();function Ji(he,Pe){this.manager=he,this.set(Pe)}Ji.prototype={set:function(he){he==Pi&&(he=this.compute()),yn&&this.manager.element.style&&Qi[he]&&(this.manager.element.style[bi]=he),this.actions=he.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var he=[];return Gt(this.manager.recognizers,function(Pe){ht(Pe.options.enable,[Pe])&&(he=he.concat(Pe.getTouchAction()))}),oa(he.join(" "))},preventDefaults:function(he){var Pe=he.srcEvent,ct=he.offsetDirection;if(this.manager.session.prevented){Pe.preventDefault();return}var Yt=this.actions,Yr=q(Yt,yt)&&!Qi[yt],Gn=q(Yt,ui)&&!Qi[ui],Oi=q(Yt,Ii)&&!Qi[Ii];if(Yr){var uo=he.pointers.length===1,Na=he.distance<2,Ka=he.deltaTime<250;if(uo&&Na&&Ka)return}if(!(Oi&&Gn)&&(Yr||Gn&&ct&me||Oi&&ct&se))return this.preventSrc(Pe)},preventSrc:function(he){this.manager.session.prevented=!0,he.preventDefault()}};function oa(he){if(q(he,yt))return yt;var Pe=q(he,Ii),ct=q(he,ui);return Pe&&ct?yt:Pe||ct?Pe?Ii:ui:q(he,vt)?vt:aa}function Ri(){if(!yn)return!1;var he={};if(Fe)return he;var Pe=J.CSS&&J.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ct){he[ct]=Pe?J.CSS.supports("touch-action",ct):!0}),he}var hr=1,_r=2,at=4,Ta=8,$e=Ta,ks=16,ls=32;function ia(he){this.options=Bt({},this.defaults,he||{}),this.id=Nt(),this.manager=null,this.options.enable=Ot(this.options.enable,!0),this.state=hr,this.simultaneous={},this.requireFail=[]}ia.prototype={defaults:{},set:function(he){return Bt(this.options,he),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(he){if(Jt(he,"recognizeWith",this))return this;var Pe=this.simultaneous;return he=Wa(he,this),Pe[he.id]||(Pe[he.id]=he,he.recognizeWith(this)),this},dropRecognizeWith:function(he){return Jt(he,"dropRecognizeWith",this)?this:(he=Wa(he,this),delete this.simultaneous[he.id],this)},requireFailure:function(he){if(Jt(he,"requireFailure",this))return this;var Pe=this.requireFail;return he=Wa(he,this),Q(Pe,he)===-1&&(Pe.push(he),he.requireFailure(this)),this},dropRequireFailure:function(he){if(Jt(he,"dropRequireFailure",this))return this;he=Wa(he,this);var Pe=Q(this.requireFail,he);return Pe>-1&&this.requireFail.splice(Pe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(he){return!!this.simultaneous[he.id]},emit:function(he){var Pe=this,ct=this.state;function Yt(Yr){Pe.manager.emit(Yr,he)}ct<Ta&&Yt(Pe.options.event+Us(ct)),Yt(Pe.options.event),he.additionalEvent&&Yt(he.additionalEvent),ct>=Ta&&Yt(Pe.options.event+Us(ct))},tryEmit:function(he){if(this.canEmit())return this.emit(he);this.state=ls},canEmit:function(){for(var he=0;he<this.requireFail.length;){if(!(this.requireFail[he].state&(ls|hr)))return!1;he++}return!0},recognize:function(he){var Pe=Bt({},he);if(!ht(this.options.enable,[this,Pe])){this.reset(),this.state=ls;return}this.state&($e|ks|ls)&&(this.state=hr),this.state=this.process(Pe),this.state&(_r|at|Ta|ks)&&this.tryEmit(Pe)},process:function(he){},getTouchAction:function(){},reset:function(){}};function Us(he){return he&ks?"cancel":he&Ta?"end":he&at?"move":he&_r?"start":""}function Ja(he){return he==Et?"down":he==wa?"up":he==po?"left":he==Ha?"right":""}function Wa(he,Pe){var ct=Pe.manager;return ct?ct.get(he):he}function eo(){ia.apply(this,arguments)}ur(eo,ia,{defaults:{pointers:1},attrTest:function(he){var Pe=this.options.pointers;return Pe===0||he.pointers.length===Pe},process:function(he){var Pe=this.state,ct=he.eventType,Yt=Pe&(_r|at),Yr=this.attrTest(he);return Yt&&(ct&Xn||!Yr)?Pe|ks:Yt||Yr?ct&hi?Pe|Ta:Pe&_r?Pe|at:_r:ls}});function sa(){eo.apply(this,arguments),this.pX=null,this.pY=null}ur(sa,eo,{defaults:{event:"pan",threshold:10,pointers:1,direction:Se},getTouchAction:function(){var he=this.options.direction,Pe=[];return he&me&&Pe.push(ui),he&se&&Pe.push(Ii),Pe},directionTest:function(he){var Pe=this.options,ct=!0,Yt=he.distance,Yr=he.direction,Gn=he.deltaX,Oi=he.deltaY;return Yr&Pe.direction||(Pe.direction&me?(Yr=Gn===0?ri:Gn<0?po:Ha,ct=Gn!=this.pX,Yt=Math.abs(he.deltaX)):(Yr=Oi===0?ri:Oi<0?wa:Et,ct=Oi!=this.pY,Yt=Math.abs(he.deltaY))),he.direction=Yr,ct&&Yt>Pe.threshold&&Yr&Pe.direction},attrTest:function(he){return eo.prototype.attrTest.call(this,he)&&(this.state&_r||!(this.state&_r)&&this.directionTest(he))},emit:function(he){this.pX=he.deltaX,this.pY=he.deltaY;var Pe=Ja(he.direction);Pe&&(he.additionalEvent=this.options.event+Pe),this._super.emit.call(this,he)}});function Xo(){eo.apply(this,arguments)}ur(Xo,eo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[yt]},attrTest:function(he){return this._super.attrTest.call(this,he)&&(Math.abs(he.scale-1)>this.options.threshold||this.state&_r)},emit:function(he){if(he.scale!==1){var Pe=he.scale<1?"in":"out";he.additionalEvent=this.options.event+Pe}this._super.emit.call(this,he)}});function rs(){ia.apply(this,arguments),this._timer=null,this._input=null}ur(rs,ia,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[aa]},process:function(he){var Pe=this.options,ct=he.pointers.length===Pe.pointers,Yt=he.distance<Pe.threshold,Yr=he.deltaTime>Pe.time;if(this._input=he,!Yt||!ct||he.eventType&(hi|Xn)&&!Yr)this.reset();else if(he.eventType&Hi)this.reset(),this._timer=xt(function(){this.state=$e,this.tryEmit()},Pe.time,this);else if(he.eventType&hi)return $e;return ls},reset:function(){clearTimeout(this._timer)},emit:function(he){this.state===$e&&(he&&he.eventType&hi?this.manager.emit(this.options.event+"up",he):(this._input.timeStamp=ar(),this.manager.emit(this.options.event,this._input)))}});function bu(){eo.apply(this,arguments)}ur(bu,eo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[yt]},attrTest:function(he){return this._super.attrTest.call(this,he)&&(Math.abs(he.rotation)>this.options.threshold||this.state&_r)}});function To(){eo.apply(this,arguments)}ur(To,eo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:me|se,pointers:1},getTouchAction:function(){return sa.prototype.getTouchAction.call(this)},attrTest:function(he){var Pe=this.options.direction,ct;return Pe&(me|se)?ct=he.overallVelocity:Pe&me?ct=he.overallVelocityX:Pe&se&&(ct=he.overallVelocityY),this._super.attrTest.call(this,he)&&Pe&he.offsetDirection&&he.distance>this.options.threshold&&he.maxPointers==this.options.pointers&&kt(ct)>this.options.velocity&&he.eventType&hi},emit:function(he){var Pe=Ja(he.offsetDirection);Pe&&this.manager.emit(this.options.event+Pe,he),this.manager.emit(this.options.event,he)}});function Mo(){ia.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}ur(Mo,ia,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[vt]},process:function(he){var Pe=this.options,ct=he.pointers.length===Pe.pointers,Yt=he.distance<Pe.threshold,Yr=he.deltaTime<Pe.time;if(this.reset(),he.eventType&Hi&&this.count===0)return this.failTimeout();if(Yt&&Yr&&ct){if(he.eventType!=hi)return this.failTimeout();var Gn=this.pTime?he.timeStamp-this.pTime<Pe.interval:!0,Oi=!this.pCenter||en(this.pCenter,he.center)<Pe.posThreshold;this.pTime=he.timeStamp,this.pCenter=he.center,!Oi||!Gn?this.count=1:this.count+=1,this._input=he;var uo=this.count%Pe.taps;if(uo===0)return this.hasRequireFailures()?(this._timer=xt(function(){this.state=$e,this.tryEmit()},Pe.interval,this),_r):$e}return ls},failTimeout:function(){return this._timer=xt(function(){this.state=ls},this.options.interval,this),ls},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==$e&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function fa(he,Pe){return Pe=Pe||{},Pe.recognizers=Ot(Pe.recognizers,fa.defaults.preset),new qa(he,Pe)}fa.VERSION="2.0.7",fa.defaults={domEvents:!1,touchAction:Pi,enable:!0,inputTarget:null,inputClass:null,preset:[[bu,{enable:!1}],[Xo,{enable:!1},["rotate"]],[To,{direction:me}],[sa,{direction:me},["swipe"]],[Mo],[Mo,{event:"doubletap",taps:2},["tap"]],[rs]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var to=1,Yo=2;function qa(he,Pe){this.options=Bt({},fa.defaults,Pe||{}),this.options.inputTarget=this.options.inputTarget||he,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=he,this.input=Or(this),this.touchAction=new Ji(this,this.options.touchAction),$s(this,!0),Gt(this.options.recognizers,function(ct){var Yt=this.add(new ct[0](ct[1]));ct[2]&&Yt.recognizeWith(ct[2]),ct[3]&&Yt.requireFailure(ct[3])},this)}qa.prototype={set:function(he){return Bt(this.options,he),he.touchAction&&this.touchAction.update(),he.inputTarget&&(this.input.destroy(),this.input.target=he.inputTarget,this.input.init()),this},stop:function(he){this.session.stopped=he?Yo:to},recognize:function(he){var Pe=this.session;if(!Pe.stopped){this.touchAction.preventDefaults(he);var ct,Yt=this.recognizers,Yr=Pe.curRecognizer;(!Yr||Yr&&Yr.state&$e)&&(Yr=Pe.curRecognizer=null);for(var Gn=0;Gn<Yt.length;)ct=Yt[Gn],Pe.stopped!==Yo&&(!Yr||ct==Yr||ct.canRecognizeWith(Yr))?ct.recognize(he):ct.reset(),!Yr&&ct.state&(_r|at|Ta)&&(Yr=Pe.curRecognizer=ct),Gn++}},get:function(he){if(he instanceof ia)return he;for(var Pe=this.recognizers,ct=0;ct<Pe.length;ct++)if(Pe[ct].options.event==he)return Pe[ct];return null},add:function(he){if(Jt(he,"add",this))return this;var Pe=this.get(he.options.event);return Pe&&this.remove(Pe),this.recognizers.push(he),he.manager=this,this.touchAction.update(),he},remove:function(he){if(Jt(he,"remove",this))return this;if(he=this.get(he),he){var Pe=this.recognizers,ct=Q(Pe,he);ct!==-1&&(Pe.splice(ct,1),this.touchAction.update())}return this},on:function(he,Pe){if(he!==T&&Pe!==T){var ct=this.handlers;return Gt(ge(he),function(Yt){ct[Yt]=ct[Yt]||[],ct[Yt].push(Pe)}),this}},off:function(he,Pe){if(he!==T){var ct=this.handlers;return Gt(ge(he),function(Yt){Pe?ct[Yt]&&ct[Yt].splice(Q(ct[Yt],Pe),1):delete ct[Yt]}),this}},emit:function(he,Pe){this.options.domEvents&&Ll(he,Pe);var ct=this.handlers[he]&&this.handlers[he].slice();if(!(!ct||!ct.length)){Pe.type=he,Pe.preventDefault=function(){Pe.srcEvent.preventDefault()};for(var Yt=0;Yt<ct.length;)ct[Yt](Pe),Yt++}},destroy:function(){this.element&&$s(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function $s(he,Pe){var ct=he.element;if(!!ct.style){var Yt;Gt(he.options.cssProps,function(Yr,Gn){Yt=oe(ct.style,Gn),Pe?(he.oldCssProps[Yt]=ct.style[Yt],ct.style[Yt]=Yr):ct.style[Yt]=he.oldCssProps[Yt]||""}),Pe||(he.oldCssProps={})}}function Ll(he,Pe){if(!Fe){var ct=y.createEvent("Event");ct.initEvent(he,!0,!0),ct.gesture=Pe,Pe.target.dispatchEvent(ct)}}if(!Fe){Bt(fa,{INPUT_START:Hi,INPUT_MOVE:Ni,INPUT_END:hi,INPUT_CANCEL:Xn,STATE_POSSIBLE:hr,STATE_BEGAN:_r,STATE_CHANGED:at,STATE_ENDED:Ta,STATE_RECOGNIZED:$e,STATE_CANCELLED:ks,STATE_FAILED:ls,DIRECTION_NONE:ri,DIRECTION_LEFT:po,DIRECTION_RIGHT:Ha,DIRECTION_UP:wa,DIRECTION_DOWN:Et,DIRECTION_HORIZONTAL:me,DIRECTION_VERTICAL:se,DIRECTION_ALL:Se,Manager:qa,Input:qt,TouchAction:Ji,TouchInput:er,MouseInput:Ki,PointerEventInput:Ze,TouchMouseInput:Ht,SingleTouchInput:He,Recognizer:ia,AttrRecognizer:eo,Tap:Mo,Pan:sa,Swipe:To,Pinch:Xo,Rotate:bu,Press:rs,on:pt,off:lr,each:Gt,merge:K,extend:gr,assign:Bt,inherit:ur,bindFn:Tt,prefixed:oe});var ns=typeof window!="undefined"?window:typeof self!="undefined"?self:{};ns.Hammer=fa,Le=function(){return fa}.call(ye,fe,ye,nn),Le!==T&&(nn.exports=Le)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(nn,ye,fe){(function(Le,J){nn.exports=J(fe(18857))})(this,function(Le){"use strict";var J=function(Z){return Z instanceof Uint8Array||Z instanceof Uint16Array||Z instanceof Uint32Array||Z instanceof Int8Array||Z instanceof Int16Array||Z instanceof Int32Array||Z instanceof Float32Array||Z instanceof Float64Array||Z instanceof Uint8ClampedArray},y=function(Z,we){for(var Xe=Object.keys(we),Kt=0;Kt<Xe.length;++Kt)Z[Xe[Kt]]=we[Xe[Kt]];return Z},Ae=`
`;function T(Z){return typeof atob!="undefined"?atob(Z):"base64:"+Z}function ce(Z){var we=new Error("(regl) "+Z);throw console.error(we),we}function pe(Z,we){Z||ce(we)}function Fe(Z){return Z?": "+Z:""}function _e(Z,we,Xe){Z in we||ce("unknown parameter ("+Z+")"+Fe(Xe)+". possible values: "+Object.keys(we).join())}function Ge(Z,we){J(Z)||ce("invalid parameter type"+Fe(we)+". must be a typed array")}function ot(Z,we){switch(we){case"number":return typeof Z=="number";case"object":return typeof Z=="object";case"string":return typeof Z=="string";case"boolean":return typeof Z=="boolean";case"function":return typeof Z=="function";case"undefined":return typeof Z=="undefined";case"symbol":return typeof Z=="symbol"}}function ft(Z,we,Xe){ot(Z,we)||ce("invalid parameter type"+Fe(Xe)+". expected "+we+", got "+typeof Z)}function kt(Z,we){Z>=0&&(Z|0)===Z||ce("invalid parameter type, ("+Z+")"+Fe(we)+". must be a nonnegative integer")}function ar(Z,we,Xe){we.indexOf(Z)<0&&ce("invalid value"+Fe(Xe)+". must be one of: "+we)}var xt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Jt(Z){Object.keys(Z).forEach(function(we){xt.indexOf(we)<0&&ce('invalid regl constructor argument "'+we+'". must be one of '+xt)})}function Gt(Z,we){for(Z=Z+"";Z.length<we;)Z=" "+Z;return Z}function wt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Bt(Z,we){this.number=Z,this.line=we,this.errors=[]}function gr(Z,we,Xe){this.file=Z,this.line=we,this.message=Xe}function K(){var Z=new Error,we=(Z.stack||Z).toString(),Xe=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(we);if(Xe)return Xe[1];var Kt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(we);return Kt?Kt[1]:"unknown"}function ur(){var Z=new Error,we=(Z.stack||Z).toString(),Xe=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(we);if(Xe)return Xe[1];var Kt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(we);return Kt?Kt[1]:"unknown"}function Tt(Z,we){var Xe=Z.split(`
`),Kt=1,br=0,$t={unknown:new wt,0:new wt};$t.unknown.name=$t[0].name=we||K(),$t.unknown.lines.push(new Bt(0,""));for(var mr=0;mr<Xe.length;++mr){var Ar=Xe[mr],Rr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Ar);if(Rr)switch(Rr[1]){case"line":var Nr=/(\d+)(\s+\d+)?/.exec(Rr[2]);Nr&&(Kt=Nr[1]|0,Nr[2]&&(br=Nr[2]|0,br in $t||($t[br]=new wt)));break;case"define":var Gr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Rr[2]);Gr&&($t[br].name=Gr[1]?T(Gr[2]):Gr[2]);break}$t[br].lines.push(new Bt(Kt++,Ar))}return Object.keys($t).forEach(function(Wr){var un=$t[Wr];un.lines.forEach(function(Fr){un.index[Fr.number]=Fr})}),$t}function ht(Z){var we=[];return Z.split(`
`).forEach(function(Xe){if(!(Xe.length<5)){var Kt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Xe);Kt?we.push(new gr(Kt[1]|0,Kt[2]|0,Kt[3].trim())):Xe.length>0&&we.push(new gr("unknown",0,Xe))}}),we}function Ot(Z,we){we.forEach(function(Xe){var Kt=Z[Xe.file];if(Kt){var br=Kt.index[Xe.line];if(br){br.errors.push(Xe),Kt.hasErrors=!0;return}}Z.unknown.hasErrors=!0,Z.unknown.lines[0].errors.push(Xe)})}function pt(Z,we,Xe,Kt,br){if(!Z.getShaderParameter(we,Z.COMPILE_STATUS)){var $t=Z.getShaderInfoLog(we),mr=Kt===Z.FRAGMENT_SHADER?"fragment":"vertex";ee(Xe,"string",mr+" shader source must be a string",br);var Ar=Tt(Xe,br),Rr=ht($t);Ot(Ar,Rr),Object.keys(Ar).forEach(function(Nr){var Gr=Ar[Nr];if(!Gr.hasErrors)return;var Wr=[""],un=[""];function Fr(Vr,Ct){Wr.push(Vr),un.push(Ct||"")}Fr("file number "+Nr+": "+Gr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Gr.lines.forEach(function(Vr){if(Vr.errors.length>0){Fr(Gt(Vr.number,4)+"|  ","background-color:yellow; font-weight:bold"),Fr(Vr.line+Ae,"color:red; background-color:yellow; font-weight:bold");var Ct=0;Vr.errors.forEach(function(rr){var zr=rr.message,rn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(zr);if(rn){var Cr=rn[1];switch(zr=rn[2],Cr){case"assign":Cr="=";break}Ct=Math.max(Vr.line.indexOf(Cr,Ct),0)}else Ct=0;Fr(Gt("| ",6)),Fr(Gt("^^^",Ct+3)+Ae,"font-weight:bold"),Fr(Gt("| ",6)),Fr(zr+Ae,"font-weight:bold")}),Fr(Gt("| ",6)+Ae)}else Fr(Gt(Vr.number,4)+"|  "),Fr(Vr.line+Ae,"color:red")}),typeof document!="undefined"&&!window.chrome?(un[0]=Wr.join("%c"),console.log.apply(console,un)):console.log(Wr.join(""))}),pe.raise("Error compiling "+mr+" shader, "+Ar[0].name)}}function lr(Z,we,Xe,Kt,br){if(!Z.getProgramParameter(we,Z.LINK_STATUS)){var $t=Z.getProgramInfoLog(we),mr=Tt(Xe,br),Ar=Tt(Kt,br),Rr='Error linking program with vertex shader, "'+Ar[0].name+'", and fragment shader "'+mr[0].name+'"';typeof document!="undefined"?console.log("%c"+Rr+Ae+"%c"+$t,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Rr+Ae+$t),pe.raise(Rr)}}function Br(Z){Z._commandRef=K()}function q(Z,we,Xe,Kt){Br(Z);function br(Rr){return Rr?Kt.id(Rr):0}Z._fragId=br(Z.static.frag),Z._vertId=br(Z.static.vert);function $t(Rr,Nr){Object.keys(Nr).forEach(function(Gr){Rr[Kt.id(Gr)]=!0})}var mr=Z._uniformSet={};$t(mr,we.static),$t(mr,we.dynamic);var Ar=Z._attributeSet={};$t(Ar,Xe.static),$t(Ar,Xe.dynamic),Z._hasCount="count"in Z.static||"count"in Z.dynamic||"elements"in Z.static||"elements"in Z.dynamic}function ge(Z,we){var Xe=ur();ce(Z+" in command "+(we||K())+(Xe==="unknown"?"":" called from "+Xe))}function Q(Z,we,Xe){Z||ge(we,Xe||K())}function Me(Z,we,Xe,Kt){Z in we||ge("unknown parameter ("+Z+")"+Fe(Xe)+". possible values: "+Object.keys(we).join(),Kt||K())}function ee(Z,we,Xe,Kt){ot(Z,we)||ge("invalid parameter type"+Fe(Xe)+". expected "+we+", got "+typeof Z,Kt||K())}function oe(Z){Z()}function bt(Z,we,Xe){Z.texture?ar(Z.texture._texture.internalformat,we,"unsupported texture format for attachment"):ar(Z.renderbuffer._renderbuffer.format,Xe,"unsupported renderbuffer format for attachment")}var Nt=33071,jt=9728,Qt=9984,ln=9985,Dr=9986,oi=9987,Zn=5120,Vn=5121,Xi=5122,Ci=5123,fi=5124,Hi=5125,Ni=5126,hi=32819,Xn=32820,ri=33635,po=34042,Ha=36193,wa={};wa[Zn]=wa[Vn]=1,wa[Xi]=wa[Ci]=wa[Ha]=wa[ri]=wa[hi]=wa[Xn]=2,wa[fi]=wa[Hi]=wa[Ni]=wa[po]=4;function Et(Z,we){return Z===Xn||Z===hi||Z===ri?2:Z===po?4:wa[Z]*we}function me(Z){return!(Z&Z-1)&&!!Z}function se(Z,we,Xe){var Kt,br=we.width,$t=we.height,mr=we.channels;pe(br>0&&br<=Xe.maxTextureSize&&$t>0&&$t<=Xe.maxTextureSize,"invalid texture shape"),(Z.wrapS!==Nt||Z.wrapT!==Nt)&&pe(me(br)&&me($t),"incompatible wrap mode for texture, both width and height must be power of 2"),we.mipmask===1?br!==1&&$t!==1&&pe(Z.minFilter!==Qt&&Z.minFilter!==Dr&&Z.minFilter!==ln&&Z.minFilter!==oi,"min filter requires mipmap"):(pe(me(br)&&me($t),"texture must be a square power of 2 to support mipmapping"),pe(we.mipmask===(br<<1)-1,"missing or incomplete mipmap data")),we.type===Ni&&(Xe.extensions.indexOf("oes_texture_float_linear")<0&&pe(Z.minFilter===jt&&Z.magFilter===jt,"filter not supported, must enable oes_texture_float_linear"),pe(!Z.genMipmaps,"mipmap generation not supported with float textures"));var Ar=we.images;for(Kt=0;Kt<16;++Kt)if(Ar[Kt]){var Rr=br>>Kt,Nr=$t>>Kt;pe(we.mipmask&1<<Kt,"missing mipmap data");var Gr=Ar[Kt];if(pe(Gr.width===Rr&&Gr.height===Nr,"invalid shape for mip images"),pe(Gr.format===we.format&&Gr.internalformat===we.internalformat&&Gr.type===we.type,"incompatible type for mip image"),!Gr.compressed)if(Gr.data){var Wr=Math.ceil(Et(Gr.type,mr)*Rr/Gr.unpackAlignment)*Gr.unpackAlignment;pe(Gr.data.byteLength===Wr*Nr,"invalid data for image, buffer size is inconsistent with image format")}else Gr.element||Gr.copy}else Z.genMipmaps||pe((we.mipmask&1<<Kt)==0,"extra mipmap data");we.compressed&&pe(!Z.genMipmaps,"mipmap generation for compressed images not supported")}function Se(Z,we,Xe,Kt){var br=Z.width,$t=Z.height,mr=Z.channels;pe(br>0&&br<=Kt.maxTextureSize&&$t>0&&$t<=Kt.maxTextureSize,"invalid texture shape"),pe(br===$t,"cube map must be square"),pe(we.wrapS===Nt&&we.wrapT===Nt,"wrap mode not supported by cube map");for(var Ar=0;Ar<Xe.length;++Ar){var Rr=Xe[Ar];pe(Rr.width===br&&Rr.height===$t,"inconsistent cube map face shape"),we.genMipmaps&&(pe(!Rr.compressed,"can not generate mipmap for compressed textures"),pe(Rr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Nr=Rr.images,Gr=0;Gr<16;++Gr){var Wr=Nr[Gr];if(Wr){var un=br>>Gr,Fr=$t>>Gr;pe(Rr.mipmask&1<<Gr,"missing mipmap data"),pe(Wr.width===un&&Wr.height===Fr,"invalid shape for mip images"),pe(Wr.format===Z.format&&Wr.internalformat===Z.internalformat&&Wr.type===Z.type,"incompatible type for mip image"),Wr.compressed||(Wr.data?pe(Wr.data.byteLength===un*Fr*Math.max(Et(Wr.type,mr),Wr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Wr.element||Wr.copy)}}}}var z=y(pe,{optional:oe,raise:ce,commandRaise:ge,command:Q,parameter:_e,commandParameter:Me,constructor:Jt,type:ft,commandType:ee,isTypedArray:Ge,nni:kt,oneOf:ar,shaderError:pt,linkError:lr,callSite:ur,saveCommandRef:Br,saveDrawInfo:q,framebufferFormat:bt,guessCommand:K,texture2D:se,textureCube:Se}),qe=0,qt=0,Or=5,Ye=6;function Mt(Z,we){this.id=qe++,this.type=Z,this.data=we}function pr(Z){return Z.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Mr(Z){if(Z.length===0)return[];var we=Z.charAt(0),Xe=Z.charAt(Z.length-1);if(Z.length>1&&we===Xe&&(we==='"'||we==="'"))return['"'+pr(Z.substr(1,Z.length-2))+'"'];var Kt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(Z);if(Kt)return Mr(Z.substr(0,Kt.index)).concat(Mr(Kt[1])).concat(Mr(Z.substr(Kt.index+Kt[0].length)));var br=Z.split(".");if(br.length===1)return['"'+pr(Z)+'"'];for(var $t=[],mr=0;mr<br.length;++mr)$t=$t.concat(Mr(br[mr]));return $t}function Zr(Z){return"["+Mr(Z).join("][")+"]"}function qr(Z,we){return new Mt(Z,Zr(we+""))}function jn(Z){return typeof Z=="function"&&!Z._reglType||Z instanceof Mt}function Nn(Z,we){if(typeof Z=="function")return new Mt(qt,Z);if(typeof Z=="number"||typeof Z=="boolean")return new Mt(Or,Z);if(Array.isArray(Z))return new Mt(Ye,Z.map(function(Xe,Kt){return Nn(Xe,we+"["+Kt+"]")}));if(Z instanceof Mt)return Z;z(!1,"invalid option type in uniform "+we)}var en={DynamicVariable:Mt,define:qr,isDynamic:jn,unbox:Nn,accessor:Zr},pi={next:typeof requestAnimationFrame=="function"?function(Z){return requestAnimationFrame(Z)}:function(Z){return setTimeout(Z,16)},cancel:typeof cancelAnimationFrame=="function"?function(Z){return cancelAnimationFrame(Z)}:clearTimeout},si=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ra=si?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Aa(){var Z={"":0},we=[""];return{id:function(Xe){var Kt=Z[Xe];return Kt||(Kt=Z[Xe]=we.length,we.push(Xe),Kt)},str:function(Xe){return we[Xe]}}}function va(Z,we,Xe){var Kt=document.createElement("canvas");y(Kt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),Z.appendChild(Kt),Z===document.body&&(Kt.style.position="absolute",y(Z.style,{margin:0,padding:0}));function br(){var Ar=window.innerWidth,Rr=window.innerHeight;if(Z!==document.body){var Nr=Kt.getBoundingClientRect();Ar=Nr.right-Nr.left,Rr=Nr.bottom-Nr.top}Kt.width=Xe*Ar,Kt.height=Xe*Rr}var $t;Z!==document.body&&typeof ResizeObserver=="function"?($t=new ResizeObserver(function(){setTimeout(br)}),$t.observe(Z)):window.addEventListener("resize",br,!1);function mr(){$t?$t.disconnect():window.removeEventListener("resize",br),Z.removeChild(Kt)}return br(),{canvas:Kt,onDestroy:mr}}function xa(Z,we){function Xe(Kt){try{return Z.getContext(Kt,we)}catch(br){return null}}return Xe("webgl")||Xe("experimental-webgl")||Xe("webgl-experimental")}function Ki(Z){return typeof Z.nodeName=="string"&&typeof Z.appendChild=="function"&&typeof Z.getBoundingClientRect=="function"}function Y(Z){return typeof Z.drawArrays=="function"||typeof Z.drawElements=="function"}function ie(Z){return typeof Z=="string"?Z.split():(z(Array.isArray(Z),"invalid extension array"),Z)}function de(Z){return typeof Z=="string"?(z(typeof document!="undefined","not supported outside of DOM"),document.querySelector(Z)):Z}function Ce(Z){var we=Z||{},Xe,Kt,br,$t,mr={},Ar=[],Rr=[],Nr=typeof window=="undefined"?1:window.devicePixelRatio,Gr=!1,Wr=function(Vr){Vr&&z.raise(Vr)},un=function(){};if(typeof we=="string"?(z(typeof document!="undefined","selector queries only supported in DOM environments"),Xe=document.querySelector(we),z(Xe,"invalid query string for element")):typeof we=="object"?Ki(we)?Xe=we:Y(we)?($t=we,br=$t.canvas):(z.constructor(we),"gl"in we?$t=we.gl:"canvas"in we?br=de(we.canvas):"container"in we&&(Kt=de(we.container)),"attributes"in we&&(mr=we.attributes,z.type(mr,"object","invalid context attributes")),"extensions"in we&&(Ar=ie(we.extensions)),"optionalExtensions"in we&&(Rr=ie(we.optionalExtensions)),"onDone"in we&&(z.type(we.onDone,"function","invalid or missing onDone callback"),Wr=we.onDone),"profile"in we&&(Gr=!!we.profile),"pixelRatio"in we&&(Nr=+we.pixelRatio,z(Nr>0,"invalid pixel ratio"))):z.raise("invalid arguments to regl"),Xe&&(Xe.nodeName.toLowerCase()==="canvas"?br=Xe:Kt=Xe),!$t){if(!br){z(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Fr=va(Kt||document.body,Wr,Nr);if(!Fr)return null;br=Fr.canvas,un=Fr.onDestroy}mr.premultipliedAlpha===void 0&&(mr.premultipliedAlpha=!0),$t=xa(br,mr)}return $t?{gl:$t,canvas:br,container:Kt,extensions:Ar,optionalExtensions:Rr,pixelRatio:Nr,profile:Gr,onDone:Wr,onDestroy:un}:(un(),Wr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ze(Z,we){var Xe={};function Kt(Ar){z.type(Ar,"string","extension name must be string");var Rr=Ar.toLowerCase(),Nr;try{Nr=Xe[Rr]=br(Ar)}catch(Gr){}return!!Nr}function br(Ar){return Z.getExtension(Ar)?Z.getExtension(Ar):Z.getExtension(Ar.toLowerCase())?Z.getExtension(Ar.toLowerCase()):null}for(var $t=0;$t<we.extensions.length;++$t){var mr=we.extensions[$t];if(!Kt(mr))return we.onDestroy(),we.onDone('"'+mr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return we.optionalExtensions.forEach(Kt),{extensions:Xe,restore:function(){Object.keys(Xe).forEach(function(Ar){if(Xe[Ar]&&!Kt(Ar))throw new Error("(regl): error restoring extension "+Ar)})}}}function et(Z,we){for(var Xe=Array(Z),Kt=0;Kt<Z;++Kt)Xe[Kt]=we(Kt);return Xe}var dt=5120,be=5121,He=5122,Rt=5123,kr=5124,Xt=5125,er=5126;function Pr(Z){for(var we=16;we<=1<<28;we*=16)if(Z<=we)return we;return 0}function Ln(Z){var we,Xe;return we=(Z>65535)<<4,Z>>>=we,Xe=(Z>255)<<3,Z>>>=Xe,we|=Xe,Xe=(Z>15)<<2,Z>>>=Xe,we|=Xe,Xe=(Z>3)<<1,Z>>>=Xe,we|=Xe,we|Z>>1}function An(){var Z=et(8,function(){return[]});function we($t){var mr=Pr($t),Ar=Z[Ln(mr)>>2];return Ar.length>0?Ar.pop():new ArrayBuffer(mr)}function Xe($t){Z[Ln($t.byteLength)>>2].push($t)}function Kt($t,mr){var Ar=null;switch($t){case dt:Ar=new Int8Array(we(mr),0,mr);break;case be:Ar=new Uint8Array(we(mr),0,mr);break;case He:Ar=new Int16Array(we(2*mr),0,mr);break;case Rt:Ar=new Uint16Array(we(2*mr),0,mr);break;case kr:Ar=new Int32Array(we(4*mr),0,mr);break;case Xt:Ar=new Uint32Array(we(4*mr),0,mr);break;case er:Ar=new Float32Array(we(4*mr),0,mr);break;default:return null}return Ar.length!==mr?Ar.subarray(0,mr):Ar}function br($t){Xe($t.buffer)}return{alloc:we,free:Xe,allocType:Kt,freeType:br}}var Ht=An();Ht.zero=An();var xn=3408,sn=3410,pn=3411,bi=3412,yn=3413,Pi=3414,aa=3415,vt=33901,yt=33902,Ii=3379,ui=3386,Qi=34921,Ji=36347,oa=36348,Ri=35661,hr=35660,_r=34930,at=36349,Ta=34076,$e=34024,ks=7936,ls=7937,ia=7938,Us=35724,Ja=34047,Wa=36063,eo=34852,sa=3553,Xo=34067,rs=34069,bu=33984,To=6408,Mo=5126,fa=5121,to=36160,Yo=36053,qa=36064,$s=16384,Ll=function(Z,we){var Xe=1;we.ext_texture_filter_anisotropic&&(Xe=Z.getParameter(Ja));var Kt=1,br=1;we.webgl_draw_buffers&&(Kt=Z.getParameter(eo),br=Z.getParameter(Wa));var $t=!!we.oes_texture_float;if($t){var mr=Z.createTexture();Z.bindTexture(sa,mr),Z.texImage2D(sa,0,To,1,1,0,To,Mo,null);var Ar=Z.createFramebuffer();if(Z.bindFramebuffer(to,Ar),Z.framebufferTexture2D(to,qa,sa,mr,0),Z.bindTexture(sa,null),Z.checkFramebufferStatus(to)!==Yo)$t=!1;else{Z.viewport(0,0,1,1),Z.clearColor(1,0,0,1),Z.clear($s);var Rr=Ht.allocType(Mo,4);Z.readPixels(0,0,1,1,To,Mo,Rr),Z.getError()?$t=!1:(Z.deleteFramebuffer(Ar),Z.deleteTexture(mr),$t=Rr[0]===1),Ht.freeType(Rr)}}var Nr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Gr=!0;if(!Nr){var Wr=Z.createTexture(),un=Ht.allocType(fa,36);Z.activeTexture(bu),Z.bindTexture(Xo,Wr),Z.texImage2D(rs,0,To,3,3,0,To,fa,un),Ht.freeType(un),Z.bindTexture(Xo,null),Z.deleteTexture(Wr),Gr=!Z.getError()}return{colorBits:[Z.getParameter(sn),Z.getParameter(pn),Z.getParameter(bi),Z.getParameter(yn)],depthBits:Z.getParameter(Pi),stencilBits:Z.getParameter(aa),subpixelBits:Z.getParameter(xn),extensions:Object.keys(we).filter(function(Fr){return!!we[Fr]}),maxAnisotropic:Xe,maxDrawbuffers:Kt,maxColorAttachments:br,pointSizeDims:Z.getParameter(vt),lineWidthDims:Z.getParameter(yt),maxViewportDims:Z.getParameter(ui),maxCombinedTextureUnits:Z.getParameter(Ri),maxCubeMapSize:Z.getParameter(Ta),maxRenderbufferSize:Z.getParameter($e),maxTextureUnits:Z.getParameter(_r),maxTextureSize:Z.getParameter(Ii),maxAttributes:Z.getParameter(Qi),maxVertexUniforms:Z.getParameter(Ji),maxVertexTextureUnits:Z.getParameter(hr),maxVaryingVectors:Z.getParameter(oa),maxFragmentUniforms:Z.getParameter(at),glsl:Z.getParameter(Us),renderer:Z.getParameter(ls),vendor:Z.getParameter(ks),version:Z.getParameter(ia),readFloat:$t,npotTextureCube:Gr}};function ns(Z){return!!Z&&typeof Z=="object"&&Array.isArray(Z.shape)&&Array.isArray(Z.stride)&&typeof Z.offset=="number"&&Z.shape.length===Z.stride.length&&(Array.isArray(Z.data)||J(Z.data))}var he=function(Z){return Object.keys(Z).map(function(we){return Z[we]})},Pe={shape:uo,flatten:Oi};function ct(Z,we,Xe){for(var Kt=0;Kt<we;++Kt)Xe[Kt]=Z[Kt]}function Yt(Z,we,Xe,Kt){for(var br=0,$t=0;$t<we;++$t)for(var mr=Z[$t],Ar=0;Ar<Xe;++Ar)Kt[br++]=mr[Ar]}function Yr(Z,we,Xe,Kt,br,$t){for(var mr=$t,Ar=0;Ar<we;++Ar)for(var Rr=Z[Ar],Nr=0;Nr<Xe;++Nr)for(var Gr=Rr[Nr],Wr=0;Wr<Kt;++Wr)br[mr++]=Gr[Wr]}function Gn(Z,we,Xe,Kt,br){for(var $t=1,mr=Xe+1;mr<we.length;++mr)$t*=we[mr];var Ar=we[Xe];if(we.length-Xe==4){var Rr=we[Xe+1],Nr=we[Xe+2],Gr=we[Xe+3];for(mr=0;mr<Ar;++mr)Yr(Z[mr],Rr,Nr,Gr,Kt,br),br+=$t}else for(mr=0;mr<Ar;++mr)Gn(Z[mr],we,Xe+1,Kt,br),br+=$t}function Oi(Z,we,Xe,Kt){var br=1;if(we.length)for(var $t=0;$t<we.length;++$t)br*=we[$t];else br=0;var mr=Kt||Ht.allocType(Xe,br);switch(we.length){case 0:break;case 1:ct(Z,we[0],mr);break;case 2:Yt(Z,we[0],we[1],mr);break;case 3:Yr(Z,we[0],we[1],we[2],mr,0);break;default:Gn(Z,we,0,mr,0)}return mr}function uo(Z){for(var we=[],Xe=Z;Xe.length;Xe=Xe[0])we.push(Xe.length);return we}var Na={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ka=5120,is=5122,Uo=5124,vo=5121,Ps=5123,Ls=5125,Rs=5126,qs=5126,uu={int8:Ka,int16:is,int32:Uo,uint8:vo,uint16:Ps,uint32:Ls,float:Rs,float32:qs},gs=35048,zi=35040,Pa={dynamic:gs,stream:zi,static:35044},Nc=Pe.flatten,cf=Pe.shape,Os=35044,ff=35040,ml=5121,el=5126,Ks=[];Ks[5120]=1,Ks[5122]=2,Ks[5124]=4,Ks[5121]=1,Ks[5123]=2,Ks[5125]=4,Ks[5126]=4;function Rl(Z){return Na[Object.prototype.toString.call(Z)]|0}function x(Z,we){for(var Xe=0;Xe<we.length;++Xe)Z[Xe]=we[Xe]}function I(Z,we,Xe,Kt,br,$t,mr){for(var Ar=0,Rr=0;Rr<Xe;++Rr)for(var Nr=0;Nr<Kt;++Nr)Z[Ar++]=we[br*Rr+$t*Nr+mr]}function U(Z,we,Xe,Kt){var br=0,$t={};function mr(Ct){this.id=br++,this.buffer=Z.createBuffer(),this.type=Ct,this.usage=Os,this.byteLength=0,this.dimension=1,this.dtype=ml,this.persistentData=null,Xe.profile&&(this.stats={size:0})}mr.prototype.bind=function(){Z.bindBuffer(this.type,this.buffer)},mr.prototype.destroy=function(){un(this)};var Ar=[];function Rr(Ct,rr){var zr=Ar.pop();return zr||(zr=new mr(Ct)),zr.bind(),Wr(zr,rr,ff,0,1,!1),zr}function Nr(Ct){Ar.push(Ct)}function Gr(Ct,rr,zr){Ct.byteLength=rr.byteLength,Z.bufferData(Ct.type,rr,zr)}function Wr(Ct,rr,zr,rn,Cr,Hr){var vn;if(Ct.usage=zr,Array.isArray(rr)){if(Ct.dtype=rn||el,rr.length>0){var qn;if(Array.isArray(rr[0])){vn=cf(rr);for(var vr=1,xr=1;xr<vn.length;++xr)vr*=vn[xr];Ct.dimension=vr,qn=Nc(rr,vn,Ct.dtype),Gr(Ct,qn,zr),Hr?Ct.persistentData=qn:Ht.freeType(qn)}else if(typeof rr[0]=="number"){Ct.dimension=Cr;var On=Ht.allocType(Ct.dtype,rr.length);x(On,rr),Gr(Ct,On,zr),Hr?Ct.persistentData=On:Ht.freeType(On)}else J(rr[0])?(Ct.dimension=rr[0].length,Ct.dtype=rn||Rl(rr[0])||el,qn=Nc(rr,[rr.length,rr[0].length],Ct.dtype),Gr(Ct,qn,zr),Hr?Ct.persistentData=qn:Ht.freeType(qn)):z.raise("invalid buffer data")}}else if(J(rr))Ct.dtype=rn||Rl(rr),Ct.dimension=Cr,Gr(Ct,rr,zr),Hr&&(Ct.persistentData=new Uint8Array(new Uint8Array(rr.buffer)));else if(ns(rr)){vn=rr.shape;var Kr=rr.stride,Ur=rr.offset,cn=0,mn=0,Ai=0,gi=0;vn.length===1?(cn=vn[0],mn=1,Ai=Kr[0],gi=0):vn.length===2?(cn=vn[0],mn=vn[1],Ai=Kr[0],gi=Kr[1]):z.raise("invalid shape"),Ct.dtype=rn||Rl(rr.data)||el,Ct.dimension=mn;var fn=Ht.allocType(Ct.dtype,cn*mn);I(fn,rr.data,cn,mn,Ai,gi,Ur),Gr(Ct,fn,zr),Hr?Ct.persistentData=fn:Ht.freeType(fn)}else rr instanceof ArrayBuffer?(Ct.dtype=ml,Ct.dimension=Cr,Gr(Ct,rr,zr),Hr&&(Ct.persistentData=new Uint8Array(new Uint8Array(rr)))):z.raise("invalid buffer data")}function un(Ct){we.bufferCount--,Kt(Ct);var rr=Ct.buffer;z(rr,"buffer must not be deleted already"),Z.deleteBuffer(rr),Ct.buffer=null,delete $t[Ct.id]}function Fr(Ct,rr,zr,rn){we.bufferCount++;var Cr=new mr(rr);$t[Cr.id]=Cr;function Hr(vr){var xr=Os,On=null,Kr=0,Ur=0,cn=1;return Array.isArray(vr)||J(vr)||ns(vr)||vr instanceof ArrayBuffer?On=vr:typeof vr=="number"?Kr=vr|0:vr&&(z.type(vr,"object","buffer arguments must be an object, a number or an array"),"data"in vr&&(z(On===null||Array.isArray(On)||J(On)||ns(On),"invalid data for buffer"),On=vr.data),"usage"in vr&&(z.parameter(vr.usage,Pa,"invalid buffer usage"),xr=Pa[vr.usage]),"type"in vr&&(z.parameter(vr.type,uu,"invalid buffer type"),Ur=uu[vr.type]),"dimension"in vr&&(z.type(vr.dimension,"number","invalid dimension"),cn=vr.dimension|0),"length"in vr&&(z.nni(Kr,"buffer length must be a nonnegative integer"),Kr=vr.length|0)),Cr.bind(),On?Wr(Cr,On,xr,Ur,cn,rn):(Kr&&Z.bufferData(Cr.type,Kr,xr),Cr.dtype=Ur||ml,Cr.usage=xr,Cr.dimension=cn,Cr.byteLength=Kr),Xe.profile&&(Cr.stats.size=Cr.byteLength*Ks[Cr.dtype]),Hr}function vn(vr,xr){z(xr+vr.byteLength<=Cr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+vr.byteLength+" starting from offset "+xr+" to a buffer of size "+Cr.byteLength),Z.bufferSubData(Cr.type,xr,vr)}function qn(vr,xr){var On=(xr||0)|0,Kr;if(Cr.bind(),J(vr)||vr instanceof ArrayBuffer)vn(vr,On);else if(Array.isArray(vr)){if(vr.length>0)if(typeof vr[0]=="number"){var Ur=Ht.allocType(Cr.dtype,vr.length);x(Ur,vr),vn(Ur,On),Ht.freeType(Ur)}else if(Array.isArray(vr[0])||J(vr[0])){Kr=cf(vr);var cn=Nc(vr,Kr,Cr.dtype);vn(cn,On),Ht.freeType(cn)}else z.raise("invalid buffer data")}else if(ns(vr)){Kr=vr.shape;var mn=vr.stride,Ai=0,gi=0,fn=0,En=0;Kr.length===1?(Ai=Kr[0],gi=1,fn=mn[0],En=0):Kr.length===2?(Ai=Kr[0],gi=Kr[1],fn=mn[0],En=mn[1]):z.raise("invalid shape");var di=Array.isArray(vr.data)?Cr.dtype:Rl(vr.data),wi=Ht.allocType(di,Ai*gi);I(wi,vr.data,Ai,gi,fn,En,vr.offset),vn(wi,On),Ht.freeType(wi)}else z.raise("invalid data for buffer subdata");return Hr}return zr||Hr(Ct),Hr._reglType="buffer",Hr._buffer=Cr,Hr.subdata=qn,Xe.profile&&(Hr.stats=Cr.stats),Hr.destroy=function(){un(Cr)},Hr}function Vr(){he($t).forEach(function(Ct){Ct.buffer=Z.createBuffer(),Z.bindBuffer(Ct.type,Ct.buffer),Z.bufferData(Ct.type,Ct.persistentData||Ct.byteLength,Ct.usage)})}return Xe.profile&&(we.getTotalBufferSize=function(){var Ct=0;return Object.keys($t).forEach(function(rr){Ct+=$t[rr].stats.size}),Ct}),{create:Fr,createStream:Rr,destroyStream:Nr,clear:function(){he($t).forEach(un),Ar.forEach(un)},getBuffer:function(Ct){return Ct&&Ct._buffer instanceof mr?Ct._buffer:null},restore:Vr,_initBuffer:Wr}}var R=0,ne=0,ke=1,it=1,Pt=4,Lt=4,yr={points:R,point:ne,lines:ke,line:it,triangles:Pt,triangle:Lt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Lr=0,Hn=1,Jn=4,vi=5120,Yi=5121,ba=5122,Ra=5123,$i=5124,ys=5125,lu=34963,gl=35040,hf=35044;function yl(Z,we,Xe,Kt){var br={},$t=0,mr={uint8:Yi,uint16:Ra};we.oes_element_index_uint&&(mr.uint32=ys);function Ar(Vr){this.id=$t++,br[this.id]=this,this.buffer=Vr,this.primType=Jn,this.vertCount=0,this.type=0}Ar.prototype.bind=function(){this.buffer.bind()};var Rr=[];function Nr(Vr){var Ct=Rr.pop();return Ct||(Ct=new Ar(Xe.create(null,lu,!0,!1)._buffer)),Wr(Ct,Vr,gl,-1,-1,0,0),Ct}function Gr(Vr){Rr.push(Vr)}function Wr(Vr,Ct,rr,zr,rn,Cr,Hr){Vr.buffer.bind();var vn;if(Ct){var qn=Hr;!Hr&&(!J(Ct)||ns(Ct)&&!J(Ct.data))&&(qn=we.oes_element_index_uint?ys:Ra),Xe._initBuffer(Vr.buffer,Ct,rr,qn,3)}else Z.bufferData(lu,Cr,rr),Vr.buffer.dtype=vn||Yi,Vr.buffer.usage=rr,Vr.buffer.dimension=3,Vr.buffer.byteLength=Cr;if(vn=Hr,!Hr){switch(Vr.buffer.dtype){case Yi:case vi:vn=Yi;break;case Ra:case ba:vn=Ra;break;case ys:case $i:vn=ys;break;default:z.raise("unsupported type for element array")}Vr.buffer.dtype=vn}Vr.type=vn,z(vn!==ys||!!we.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var vr=rn;vr<0&&(vr=Vr.buffer.byteLength,vn===Ra?vr>>=1:vn===ys&&(vr>>=2)),Vr.vertCount=vr;var xr=zr;if(zr<0){xr=Jn;var On=Vr.buffer.dimension;On===1&&(xr=Lr),On===2&&(xr=Hn),On===3&&(xr=Jn)}Vr.primType=xr}function un(Vr){Kt.elementsCount--,z(Vr.buffer!==null,"must not double destroy elements"),delete br[Vr.id],Vr.buffer.destroy(),Vr.buffer=null}function Fr(Vr,Ct){var rr=Xe.create(null,lu,!0),zr=new Ar(rr._buffer);Kt.elementsCount++;function rn(Cr){if(!Cr)rr(),zr.primType=Jn,zr.vertCount=0,zr.type=Yi;else if(typeof Cr=="number")rr(Cr),zr.primType=Jn,zr.vertCount=Cr|0,zr.type=Yi;else{var Hr=null,vn=hf,qn=-1,vr=-1,xr=0,On=0;Array.isArray(Cr)||J(Cr)||ns(Cr)?Hr=Cr:(z.type(Cr,"object","invalid arguments for elements"),"data"in Cr&&(Hr=Cr.data,z(Array.isArray(Hr)||J(Hr)||ns(Hr),"invalid data for element buffer")),"usage"in Cr&&(z.parameter(Cr.usage,Pa,"invalid element buffer usage"),vn=Pa[Cr.usage]),"primitive"in Cr&&(z.parameter(Cr.primitive,yr,"invalid element buffer primitive"),qn=yr[Cr.primitive]),"count"in Cr&&(z(typeof Cr.count=="number"&&Cr.count>=0,"invalid vertex count for elements"),vr=Cr.count|0),"type"in Cr&&(z.parameter(Cr.type,mr,"invalid buffer type"),On=mr[Cr.type]),"length"in Cr?xr=Cr.length|0:(xr=vr,On===Ra||On===ba?xr*=2:(On===ys||On===$i)&&(xr*=4))),Wr(zr,Hr,vn,qn,vr,xr,On)}return rn}return rn(Vr),rn._reglType="elements",rn._elements=zr,rn.subdata=function(Cr,Hr){return rr.subdata(Cr,Hr),rn},rn.destroy=function(){un(zr)},rn}return{create:Fr,createStream:Nr,destroyStream:Gr,getElements:function(Vr){return typeof Vr=="function"&&Vr._elements instanceof Ar?Vr._elements:null},clear:function(){he(br).forEach(un)}}}var zc=new Float32Array(1),Fu=new Uint32Array(zc.buffer),Bu=5123;function Nu(Z){for(var we=Ht.allocType(Bu,Z.length),Xe=0;Xe<Z.length;++Xe)if(isNaN(Z[Xe]))we[Xe]=65535;else if(Z[Xe]===Infinity)we[Xe]=31744;else if(Z[Xe]===-Infinity)we[Xe]=64512;else{zc[0]=Z[Xe];var Kt=Fu[0],br=Kt>>>31<<15,$t=(Kt<<1>>>24)-127,mr=Kt>>13&(1<<10)-1;if($t<-24)we[Xe]=br;else if($t<-14){var Ar=-14-$t;we[Xe]=br+(mr+(1<<10)>>Ar)}else $t>15?we[Xe]=br+31744:we[Xe]=br+($t+15<<10)+mr}return we}function mo(Z){return Array.isArray(Z)||J(Z)}var Gf=function(Z){return!(Z&Z-1)&&!!Z},Uc=34467,_s=3553,pf=34067,tl=34069,Qs=6408,Hf=6406,Zs=6407,Ma=6409,Ol=6410,bh=32854,zu=32855,Zc=36194,fp=32819,hp=32820,Wf=33635,Vc=34042,lc=6402,Dl=34041,Fl=35904,_l=35906,xl=36193,bl=33776,Js=33777,df=33778,vf=33779,Bl=35986,El=35987,cc=34798,jc=35840,fc=35841,mf=35842,pp=35843,gf=36196,Sl=5121,yf=5123,Xf=5125,Uu=5126,Eh=10242,Sh=10243,Ch=10497,Nl=33071,wh=33648,as=10240,Qa=10241,ha=9728,zl=9729,rl=9984,qi=9985,Oa=9986,Fs=9987,Gc=33170,Ia=4352,Zu=4353,Ul=4354,Hc=34046,Wc=3317,hc=37440,Eu=37441,Io=37443,pc=37444,Zl=33984,ko=[rl,Oa,qi,Fs],Rn=[0,Ma,Ol,Zs,Qs],lo={};lo[Ma]=lo[Hf]=lo[lc]=1,lo[Dl]=lo[Ol]=2,lo[Zs]=lo[Fl]=3,lo[Qs]=lo[_l]=4;function Da(Z){return"[object "+Z+"]"}var Vl=Da("HTMLCanvasElement"),cu=Da("OffscreenCanvas"),Ds=Da("CanvasRenderingContext2D"),_f=Da("ImageBitmap"),dn=Da("HTMLImageElement"),dc=Da("HTMLVideoElement"),vc=Object.keys(Na).concat([Vl,cu,Ds,_f,dn,dc]),Cl=[];Cl[Sl]=1,Cl[Uu]=4,Cl[xl]=2,Cl[yf]=2,Cl[Xf]=4;var za=[];za[bh]=2,za[zu]=2,za[Zc]=2,za[Dl]=4,za[bl]=.5,za[Js]=.5,za[df]=1,za[vf]=1,za[Bl]=.5,za[El]=1,za[cc]=1,za[jc]=.5,za[fc]=.25,za[mf]=.5,za[pp]=.25,za[gf]=.5;function Bs(Z){return Array.isArray(Z)&&(Z.length===0||typeof Z[0]=="number")}function Xc(Z){if(!Array.isArray(Z))return!1;var we=Z.length;return!(we===0||!mo(Z[0]))}function xs(Z){return Object.prototype.toString.call(Z)}function bs(Z){return xs(Z)===Vl}function Vu(Z){return xs(Z)===cu}function Ah(Z){return xs(Z)===Ds}function xf(Z){return xs(Z)===_f}function Yf(Z){return xs(Z)===dn}function $f(Z){return xs(Z)===dc}function Vs(Z){var we=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(we&&Z&&Z.getContext)}function eu(Z){var we=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(we&&Z&&"src"in Z&&"crossOrigin"in Z)}function Di(Z){if(!Z)return!1;if(Vs(Z)||eu(Z))return!0;var we=xs(Z);return vc.indexOf(we)>=0?!0:Bs(Z)||Xc(Z)||ns(Z)}function Su(Z){return Na[Object.prototype.toString.call(Z)]|0}function js(Z,we){var Xe=we.length;switch(Z.type){case Sl:case yf:case Xf:case Uu:var Kt=Ht.allocType(Z.type,Xe);Kt.set(we),Z.data=Kt;break;case xl:Z.data=Nu(we);break;default:z.raise("unsupported texture type, must specify a typed array")}}function cs(Z,we){return Ht.allocType(Z.type===xl?Uu:Z.type,we)}function ju(Z,we){Z.type===xl?(Z.data=Nu(we),Ht.freeType(we)):Z.data=we}function jl(Z,we,Xe,Kt,br,$t){for(var mr=Z.width,Ar=Z.height,Rr=Z.channels,Nr=mr*Ar*Rr,Gr=cs(Z,Nr),Wr=0,un=0;un<Ar;++un)for(var Fr=0;Fr<mr;++Fr)for(var Vr=0;Vr<Rr;++Vr)Gr[Wr++]=we[Xe*Fr+Kt*un+br*Vr+$t];ju(Z,Gr)}function tu(Z,we,Xe,Kt,br,$t){var mr;if(typeof za[Z]!="undefined"?mr=za[Z]:mr=lo[Z]*Cl[we],$t&&(mr*=6),br){for(var Ar=0,Rr=Xe;Rr>=1;)Ar+=mr*Rr*Rr,Rr/=2;return Ar}else return mr*Xe*Kt}function Es(Z,we,Xe,Kt,br,$t,mr){var Ar={"don't care":Ia,"dont care":Ia,nice:Ul,fast:Zu},Rr={repeat:Ch,clamp:Nl,mirror:wh},Nr={nearest:ha,linear:zl},Gr=y({mipmap:Fs,"nearest mipmap nearest":rl,"linear mipmap nearest":qi,"nearest mipmap linear":Oa,"linear mipmap linear":Fs},Nr),Wr={none:0,browser:pc},un={uint8:Sl,rgba4:fp,rgb565:Wf,"rgb5 a1":hp},Fr={alpha:Hf,luminance:Ma,"luminance alpha":Ol,rgb:Zs,rgba:Qs,rgba4:bh,"rgb5 a1":zu,rgb565:Zc},Vr={};we.ext_srgb&&(Fr.srgb=Fl,Fr.srgba=_l),we.oes_texture_float&&(un.float32=un.float=Uu),we.oes_texture_half_float&&(un.float16=un["half float"]=xl),we.webgl_depth_texture&&(y(Fr,{depth:lc,"depth stencil":Dl}),y(un,{uint16:yf,uint32:Xf,"depth stencil":Vc})),we.webgl_compressed_texture_s3tc&&y(Vr,{"rgb s3tc dxt1":bl,"rgba s3tc dxt1":Js,"rgba s3tc dxt3":df,"rgba s3tc dxt5":vf}),we.webgl_compressed_texture_atc&&y(Vr,{"rgb atc":Bl,"rgba atc explicit alpha":El,"rgba atc interpolated alpha":cc}),we.webgl_compressed_texture_pvrtc&&y(Vr,{"rgb pvrtc 4bppv1":jc,"rgb pvrtc 2bppv1":fc,"rgba pvrtc 4bppv1":mf,"rgba pvrtc 2bppv1":pp}),we.webgl_compressed_texture_etc1&&(Vr["rgb etc1"]=gf);var Ct=Array.prototype.slice.call(Z.getParameter(Uc)||new Uint32Array(0));Object.keys(Vr).forEach(function(Ne){var tr=Vr[Ne];Ct.indexOf(tr)>=0&&(Fr[Ne]=tr)});var rr=Object.keys(Fr);Xe.textureFormats=rr;var zr=[];Object.keys(Fr).forEach(function(Ne){var tr=Fr[Ne];zr[tr]=Ne});var rn=[];Object.keys(un).forEach(function(Ne){var tr=un[Ne];rn[tr]=Ne});var Cr=[];Object.keys(Nr).forEach(function(Ne){var tr=Nr[Ne];Cr[tr]=Ne});var Hr=[];Object.keys(Gr).forEach(function(Ne){var tr=Gr[Ne];Hr[tr]=Ne});var vn=[];Object.keys(Rr).forEach(function(Ne){var tr=Rr[Ne];vn[tr]=Ne});var qn=rr.reduce(function(Ne,tr){var zt=Fr[tr];return zt===Ma||zt===Hf||zt===Ma||zt===Ol||zt===lc||zt===Dl||we.ext_srgb&&(zt===Fl||zt===_l)?Ne[zt]=zt:zt===zu||tr.indexOf("rgba")>=0?Ne[zt]=Qs:Ne[zt]=Zs,Ne},{});function vr(){this.internalformat=Qs,this.format=Qs,this.type=Sl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=pc,this.width=0,this.height=0,this.channels=0}function xr(Ne,tr){Ne.internalformat=tr.internalformat,Ne.format=tr.format,Ne.type=tr.type,Ne.compressed=tr.compressed,Ne.premultiplyAlpha=tr.premultiplyAlpha,Ne.flipY=tr.flipY,Ne.unpackAlignment=tr.unpackAlignment,Ne.colorSpace=tr.colorSpace,Ne.width=tr.width,Ne.height=tr.height,Ne.channels=tr.channels}function On(Ne,tr){if(!(typeof tr!="object"||!tr)){if("premultiplyAlpha"in tr&&(z.type(tr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ne.premultiplyAlpha=tr.premultiplyAlpha),"flipY"in tr&&(z.type(tr.flipY,"boolean","invalid texture flip"),Ne.flipY=tr.flipY),"alignment"in tr&&(z.oneOf(tr.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ne.unpackAlignment=tr.alignment),"colorSpace"in tr&&(z.parameter(tr.colorSpace,Wr,"invalid colorSpace"),Ne.colorSpace=Wr[tr.colorSpace]),"type"in tr){var zt=tr.type;z(we.oes_texture_float||!(zt==="float"||zt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),z(we.oes_texture_half_float||!(zt==="half float"||zt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),z(we.webgl_depth_texture||!(zt==="uint16"||zt==="uint32"||zt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),z.parameter(zt,un,"invalid texture type"),Ne.type=un[zt]}var Tn=Ne.width,Zi=Ne.height,De=Ne.channels,xe=!1;"shape"in tr?(z(Array.isArray(tr.shape)&&tr.shape.length>=2,"shape must be an array"),Tn=tr.shape[0],Zi=tr.shape[1],tr.shape.length===3&&(De=tr.shape[2],z(De>0&&De<=4,"invalid number of channels"),xe=!0),z(Tn>=0&&Tn<=Xe.maxTextureSize,"invalid width"),z(Zi>=0&&Zi<=Xe.maxTextureSize,"invalid height")):("radius"in tr&&(Tn=Zi=tr.radius,z(Tn>=0&&Tn<=Xe.maxTextureSize,"invalid radius")),"width"in tr&&(Tn=tr.width,z(Tn>=0&&Tn<=Xe.maxTextureSize,"invalid width")),"height"in tr&&(Zi=tr.height,z(Zi>=0&&Zi<=Xe.maxTextureSize,"invalid height")),"channels"in tr&&(De=tr.channels,z(De>0&&De<=4,"invalid number of channels"),xe=!0)),Ne.width=Tn|0,Ne.height=Zi|0,Ne.channels=De|0;var tt=!1;if("format"in tr){var At=tr.format;z(we.webgl_depth_texture||!(At==="depth"||At==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),z.parameter(At,Fr,"invalid texture format");var Wt=Ne.internalformat=Fr[At];Ne.format=qn[Wt],At in un&&("type"in tr||(Ne.type=un[At])),At in Vr&&(Ne.compressed=!0),tt=!0}!xe&&tt?Ne.channels=lo[Ne.format]:xe&&!tt?Ne.channels!==Rn[Ne.format]&&(Ne.format=Ne.internalformat=Rn[Ne.channels]):tt&&xe&&z(Ne.channels===lo[Ne.format],"number of channels inconsistent with specified format")}}function Kr(Ne){Z.pixelStorei(hc,Ne.flipY),Z.pixelStorei(Eu,Ne.premultiplyAlpha),Z.pixelStorei(Io,Ne.colorSpace),Z.pixelStorei(Wc,Ne.unpackAlignment)}function Ur(){vr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function cn(Ne,tr){var zt=null;if(Di(tr)?zt=tr:tr&&(z.type(tr,"object","invalid pixel data type"),On(Ne,tr),"x"in tr&&(Ne.xOffset=tr.x|0),"y"in tr&&(Ne.yOffset=tr.y|0),Di(tr.data)&&(zt=tr.data)),z(!Ne.compressed||zt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),tr.copy){z(!zt,"can not specify copy and data field for the same texture");var Tn=br.viewportWidth,Zi=br.viewportHeight;Ne.width=Ne.width||Tn-Ne.xOffset,Ne.height=Ne.height||Zi-Ne.yOffset,Ne.needsCopy=!0,z(Ne.xOffset>=0&&Ne.xOffset<Tn&&Ne.yOffset>=0&&Ne.yOffset<Zi&&Ne.width>0&&Ne.width<=Tn&&Ne.height>0&&Ne.height<=Zi,"copy texture read out of bounds")}else if(!zt)Ne.width=Ne.width||1,Ne.height=Ne.height||1,Ne.channels=Ne.channels||4;else if(J(zt))Ne.channels=Ne.channels||4,Ne.data=zt,!("type"in tr)&&Ne.type===Sl&&(Ne.type=Su(zt));else if(Bs(zt))Ne.channels=Ne.channels||4,js(Ne,zt),Ne.alignment=1,Ne.needsFree=!0;else if(ns(zt)){var De=zt.data;!Array.isArray(De)&&Ne.type===Sl&&(Ne.type=Su(De));var xe=zt.shape,tt=zt.stride,At,Wt,ut,We,_t,Ie;xe.length===3?(ut=xe[2],Ie=tt[2]):(z(xe.length===2,"invalid ndarray pixel data, must be 2 or 3D"),ut=1,Ie=1),At=xe[0],Wt=xe[1],We=tt[0],_t=tt[1],Ne.alignment=1,Ne.width=At,Ne.height=Wt,Ne.channels=ut,Ne.format=Ne.internalformat=Rn[ut],Ne.needsFree=!0,jl(Ne,De,We,_t,Ie,zt.offset)}else if(Vs(zt)||bs(zt)||Vu(zt)||Ah(zt))Vs(zt)||bs(zt)||Vu(zt)?Ne.element=zt:Ne.element=zt.canvas,Ne.width=Ne.element.width,Ne.height=Ne.element.height,Ne.channels=4;else if(xf(zt))Ne.element=zt,Ne.width=zt.width,Ne.height=zt.height,Ne.channels=4;else if(Yf(zt))Ne.element=zt,Ne.width=zt.naturalWidth,Ne.height=zt.naturalHeight,Ne.channels=4;else if(eu(zt))Ne.element=zt,Ne.width=zt.width,Ne.height=zt.height,Ne.channels=4;else if($f(zt))Ne.element=zt,Ne.width=zt.videoWidth,Ne.height=zt.videoHeight,Ne.channels=4;else if(Xc(zt)){var Je=Ne.width||zt[0].length,Oe=Ne.height||zt.length,It=Ne.channels;mo(zt[0][0])?It=It||zt[0][0].length:It=It||1;for(var Zt=Pe.shape(zt),wr=1,an=0;an<Zt.length;++an)wr*=Zt[an];var on=cs(Ne,wr);Pe.flatten(zt,Zt,"",on),ju(Ne,on),Ne.alignment=1,Ne.width=Je,Ne.height=Oe,Ne.channels=It,Ne.format=Ne.internalformat=Rn[It],Ne.needsFree=!0}Ne.type===Uu?z(Xe.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ne.type===xl&&z(Xe.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function mn(Ne,tr,zt){var Tn=Ne.element,Zi=Ne.data,De=Ne.internalformat,xe=Ne.format,tt=Ne.type,At=Ne.width,Wt=Ne.height;Kr(Ne),Tn?Z.texImage2D(tr,zt,xe,xe,tt,Tn):Ne.compressed?Z.compressedTexImage2D(tr,zt,De,At,Wt,0,Zi):Ne.needsCopy?(Kt(),Z.copyTexImage2D(tr,zt,xe,Ne.xOffset,Ne.yOffset,At,Wt,0)):Z.texImage2D(tr,zt,xe,At,Wt,0,xe,tt,Zi||null)}function Ai(Ne,tr,zt,Tn,Zi){var De=Ne.element,xe=Ne.data,tt=Ne.internalformat,At=Ne.format,Wt=Ne.type,ut=Ne.width,We=Ne.height;Kr(Ne),De?Z.texSubImage2D(tr,Zi,zt,Tn,At,Wt,De):Ne.compressed?Z.compressedTexSubImage2D(tr,Zi,zt,Tn,tt,ut,We,xe):Ne.needsCopy?(Kt(),Z.copyTexSubImage2D(tr,Zi,zt,Tn,Ne.xOffset,Ne.yOffset,ut,We)):Z.texSubImage2D(tr,Zi,zt,Tn,ut,We,At,Wt,xe)}var gi=[];function fn(){return gi.pop()||new Ur}function En(Ne){Ne.needsFree&&Ht.freeType(Ne.data),Ur.call(Ne),gi.push(Ne)}function di(){vr.call(this),this.genMipmaps=!1,this.mipmapHint=Ia,this.mipmask=0,this.images=Array(16)}function wi(Ne,tr,zt){var Tn=Ne.images[0]=fn();Ne.mipmask=1,Tn.width=Ne.width=tr,Tn.height=Ne.height=zt,Tn.channels=Ne.channels=4}function Ui(Ne,tr){var zt=null;if(Di(tr))zt=Ne.images[0]=fn(),xr(zt,Ne),cn(zt,tr),Ne.mipmask=1;else if(On(Ne,tr),Array.isArray(tr.mipmap))for(var Tn=tr.mipmap,Zi=0;Zi<Tn.length;++Zi)zt=Ne.images[Zi]=fn(),xr(zt,Ne),zt.width>>=Zi,zt.height>>=Zi,cn(zt,Tn[Zi]),Ne.mipmask|=1<<Zi;else zt=Ne.images[0]=fn(),xr(zt,Ne),cn(zt,tr),Ne.mipmask=1;xr(Ne,Ne.images[0]),Ne.compressed&&(Ne.internalformat===bl||Ne.internalformat===Js||Ne.internalformat===df||Ne.internalformat===vf)&&z(Ne.width%4==0&&Ne.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function no(Ne,tr){for(var zt=Ne.images,Tn=0;Tn<zt.length;++Tn){if(!zt[Tn])return;mn(zt[Tn],tr,Tn)}}var co=[];function ji(){var Ne=co.pop()||new di;vr.call(Ne),Ne.mipmask=0;for(var tr=0;tr<16;++tr)Ne.images[tr]=null;return Ne}function hs(Ne){for(var tr=Ne.images,zt=0;zt<tr.length;++zt)tr[zt]&&En(tr[zt]),tr[zt]=null;co.push(Ne)}function Va(){this.minFilter=ha,this.magFilter=ha,this.wrapS=Nl,this.wrapT=Nl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Ia}function ss(Ne,tr){if("min"in tr){var zt=tr.min;z.parameter(zt,Gr),Ne.minFilter=Gr[zt],ko.indexOf(Ne.minFilter)>=0&&!("faces"in tr)&&(Ne.genMipmaps=!0)}if("mag"in tr){var Tn=tr.mag;z.parameter(Tn,Nr),Ne.magFilter=Nr[Tn]}var Zi=Ne.wrapS,De=Ne.wrapT;if("wrap"in tr){var xe=tr.wrap;typeof xe=="string"?(z.parameter(xe,Rr),Zi=De=Rr[xe]):Array.isArray(xe)&&(z.parameter(xe[0],Rr),z.parameter(xe[1],Rr),Zi=Rr[xe[0]],De=Rr[xe[1]])}else{if("wrapS"in tr){var tt=tr.wrapS;z.parameter(tt,Rr),Zi=Rr[tt]}if("wrapT"in tr){var At=tr.wrapT;z.parameter(At,Rr),De=Rr[At]}}if(Ne.wrapS=Zi,Ne.wrapT=De,"anisotropic"in tr){var Wt=tr.anisotropic;z(typeof Wt=="number"&&Wt>=1&&Wt<=Xe.maxAnisotropic,"aniso samples must be between 1 and "),Ne.anisotropic=tr.anisotropic}if("mipmap"in tr){var ut=!1;switch(typeof tr.mipmap){case"string":z.parameter(tr.mipmap,Ar,"invalid mipmap hint"),Ne.mipmapHint=Ar[tr.mipmap],Ne.genMipmaps=!0,ut=!0;break;case"boolean":ut=Ne.genMipmaps=tr.mipmap;break;case"object":z(Array.isArray(tr.mipmap),"invalid mipmap type"),Ne.genMipmaps=!1,ut=!0;break;default:z.raise("invalid mipmap type")}ut&&!("min"in tr)&&(Ne.minFilter=rl)}}function Oo(Ne,tr){Z.texParameteri(tr,Qa,Ne.minFilter),Z.texParameteri(tr,as,Ne.magFilter),Z.texParameteri(tr,Eh,Ne.wrapS),Z.texParameteri(tr,Sh,Ne.wrapT),we.ext_texture_filter_anisotropic&&Z.texParameteri(tr,Hc,Ne.anisotropic),Ne.genMipmaps&&(Z.hint(Gc,Ne.mipmapHint),Z.generateMipmap(tr))}var Do=0,Fo={},As=Xe.maxTextureUnits,_o=Array(As).map(function(){return null});function Mi(Ne){vr.call(this),this.mipmask=0,this.internalformat=Qs,this.id=Do++,this.refCount=1,this.target=Ne,this.texture=Z.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Va,mr.profile&&(this.stats={size:0})}function Jo(Ne){Z.activeTexture(Zl),Z.bindTexture(Ne.target,Ne.texture)}function la(){var Ne=_o[0];Ne?Z.bindTexture(Ne.target,Ne.texture):Z.bindTexture(_s,null)}function ps(Ne){var tr=Ne.texture;z(tr,"must not double destroy texture");var zt=Ne.unit,Tn=Ne.target;zt>=0&&(Z.activeTexture(Zl+zt),Z.bindTexture(Tn,null),_o[zt]=null),Z.deleteTexture(tr),Ne.texture=null,Ne.params=null,Ne.pixels=null,Ne.refCount=0,delete Fo[Ne.id],$t.textureCount--}y(Mi.prototype,{bind:function(){var Ne=this;Ne.bindCount+=1;var tr=Ne.unit;if(tr<0){for(var zt=0;zt<As;++zt){var Tn=_o[zt];if(Tn){if(Tn.bindCount>0)continue;Tn.unit=-1}_o[zt]=Ne,tr=zt;break}tr>=As&&z.raise("insufficient number of texture units"),mr.profile&&$t.maxTextureUnits<tr+1&&($t.maxTextureUnits=tr+1),Ne.unit=tr,Z.activeTexture(Zl+tr),Z.bindTexture(Ne.target,Ne.texture)}return tr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ps(this)}});function _i(Ne,tr){var zt=new Mi(_s);Fo[zt.id]=zt,$t.textureCount++;function Tn(xe,tt){var At=zt.texInfo;Va.call(At);var Wt=ji();return typeof xe=="number"?typeof tt=="number"?wi(Wt,xe|0,tt|0):wi(Wt,xe|0,xe|0):xe?(z.type(xe,"object","invalid arguments to regl.texture"),ss(At,xe),Ui(Wt,xe)):wi(Wt,1,1),At.genMipmaps&&(Wt.mipmask=(Wt.width<<1)-1),zt.mipmask=Wt.mipmask,xr(zt,Wt),z.texture2D(At,Wt,Xe),zt.internalformat=Wt.internalformat,Tn.width=Wt.width,Tn.height=Wt.height,Jo(zt),no(Wt,_s),Oo(At,_s),la(),hs(Wt),mr.profile&&(zt.stats.size=tu(zt.internalformat,zt.type,Wt.width,Wt.height,At.genMipmaps,!1)),Tn.format=zr[zt.internalformat],Tn.type=rn[zt.type],Tn.mag=Cr[At.magFilter],Tn.min=Hr[At.minFilter],Tn.wrapS=vn[At.wrapS],Tn.wrapT=vn[At.wrapT],Tn}function Zi(xe,tt,At,Wt){z(!!xe,"must specify image data");var ut=tt|0,We=At|0,_t=Wt|0,Ie=fn();return xr(Ie,zt),Ie.width=0,Ie.height=0,cn(Ie,xe),Ie.width=Ie.width||(zt.width>>_t)-ut,Ie.height=Ie.height||(zt.height>>_t)-We,z(zt.type===Ie.type&&zt.format===Ie.format&&zt.internalformat===Ie.internalformat,"incompatible format for texture.subimage"),z(ut>=0&&We>=0&&ut+Ie.width<=zt.width&&We+Ie.height<=zt.height,"texture.subimage write out of bounds"),z(zt.mipmask&1<<_t,"missing mipmap data"),z(Ie.data||Ie.element||Ie.needsCopy,"missing image data"),Jo(zt),Ai(Ie,_s,ut,We,_t),la(),En(Ie),Tn}function De(xe,tt){var At=xe|0,Wt=tt|0||At;if(At===zt.width&&Wt===zt.height)return Tn;Tn.width=zt.width=At,Tn.height=zt.height=Wt,Jo(zt);for(var ut=0;zt.mipmask>>ut;++ut){var We=At>>ut,_t=Wt>>ut;if(!We||!_t)break;Z.texImage2D(_s,ut,zt.format,We,_t,0,zt.format,zt.type,null)}return la(),mr.profile&&(zt.stats.size=tu(zt.internalformat,zt.type,At,Wt,!1,!1)),Tn}return Tn(Ne,tr),Tn.subimage=Zi,Tn.resize=De,Tn._reglType="texture2d",Tn._texture=zt,mr.profile&&(Tn.stats=zt.stats),Tn.destroy=function(){zt.decRef()},Tn}function Gi(Ne,tr,zt,Tn,Zi,De){var xe=new Mi(pf);Fo[xe.id]=xe,$t.cubeCount++;var tt=new Array(6);function At(We,_t,Ie,Je,Oe,It){var Zt,wr=xe.texInfo;for(Va.call(wr),Zt=0;Zt<6;++Zt)tt[Zt]=ji();if(typeof We=="number"||!We){var an=We|0||1;for(Zt=0;Zt<6;++Zt)wi(tt[Zt],an,an)}else if(typeof We=="object")if(_t)Ui(tt[0],We),Ui(tt[1],_t),Ui(tt[2],Ie),Ui(tt[3],Je),Ui(tt[4],Oe),Ui(tt[5],It);else if(ss(wr,We),On(xe,We),"faces"in We){var on=We.faces;for(z(Array.isArray(on)&&on.length===6,"cube faces must be a length 6 array"),Zt=0;Zt<6;++Zt)z(typeof on[Zt]=="object"&&!!on[Zt],"invalid input for cube map face"),xr(tt[Zt],xe),Ui(tt[Zt],on[Zt])}else for(Zt=0;Zt<6;++Zt)Ui(tt[Zt],We);else z.raise("invalid arguments to cube map");for(xr(xe,tt[0]),z.optional(function(){Xe.npotTextureCube||z(Gf(xe.width)&&Gf(xe.height),"your browser does not support non power or two texture dimensions")}),wr.genMipmaps?xe.mipmask=(tt[0].width<<1)-1:xe.mipmask=tt[0].mipmask,z.textureCube(xe,wr,tt,Xe),xe.internalformat=tt[0].internalformat,At.width=tt[0].width,At.height=tt[0].height,Jo(xe),Zt=0;Zt<6;++Zt)no(tt[Zt],tl+Zt);for(Oo(wr,pf),la(),mr.profile&&(xe.stats.size=tu(xe.internalformat,xe.type,At.width,At.height,wr.genMipmaps,!0)),At.format=zr[xe.internalformat],At.type=rn[xe.type],At.mag=Cr[wr.magFilter],At.min=Hr[wr.minFilter],At.wrapS=vn[wr.wrapS],At.wrapT=vn[wr.wrapT],Zt=0;Zt<6;++Zt)hs(tt[Zt]);return At}function Wt(We,_t,Ie,Je,Oe){z(!!_t,"must specify image data"),z(typeof We=="number"&&We===(We|0)&&We>=0&&We<6,"invalid face");var It=Ie|0,Zt=Je|0,wr=Oe|0,an=fn();return xr(an,xe),an.width=0,an.height=0,cn(an,_t),an.width=an.width||(xe.width>>wr)-It,an.height=an.height||(xe.height>>wr)-Zt,z(xe.type===an.type&&xe.format===an.format&&xe.internalformat===an.internalformat,"incompatible format for texture.subimage"),z(It>=0&&Zt>=0&&It+an.width<=xe.width&&Zt+an.height<=xe.height,"texture.subimage write out of bounds"),z(xe.mipmask&1<<wr,"missing mipmap data"),z(an.data||an.element||an.needsCopy,"missing image data"),Jo(xe),Ai(an,tl+We,It,Zt,wr),la(),En(an),At}function ut(We){var _t=We|0;if(_t!==xe.width){At.width=xe.width=_t,At.height=xe.height=_t,Jo(xe);for(var Ie=0;Ie<6;++Ie)for(var Je=0;xe.mipmask>>Je;++Je)Z.texImage2D(tl+Ie,Je,xe.format,_t>>Je,_t>>Je,0,xe.format,xe.type,null);return la(),mr.profile&&(xe.stats.size=tu(xe.internalformat,xe.type,At.width,At.height,!1,!0)),At}}return At(Ne,tr,zt,Tn,Zi,De),At.subimage=Wt,At.resize=ut,At._reglType="textureCube",At._texture=xe,mr.profile&&(At.stats=xe.stats),At.destroy=function(){xe.decRef()},At}function ma(){for(var Ne=0;Ne<As;++Ne)Z.activeTexture(Zl+Ne),Z.bindTexture(_s,null),_o[Ne]=null;he(Fo).forEach(ps),$t.cubeCount=0,$t.textureCount=0}mr.profile&&($t.getTotalTextureSize=function(){var Ne=0;return Object.keys(Fo).forEach(function(tr){Ne+=Fo[tr].stats.size}),Ne});function Bo(){for(var Ne=0;Ne<As;++Ne){var tr=_o[Ne];tr&&(tr.bindCount=0,tr.unit=-1,_o[Ne]=null)}he(Fo).forEach(function(zt){zt.texture=Z.createTexture(),Z.bindTexture(zt.target,zt.texture);for(var Tn=0;Tn<32;++Tn)if((zt.mipmask&1<<Tn)!=0)if(zt.target===_s)Z.texImage2D(_s,Tn,zt.internalformat,zt.width>>Tn,zt.height>>Tn,0,zt.internalformat,zt.type,null);else for(var Zi=0;Zi<6;++Zi)Z.texImage2D(tl+Zi,Tn,zt.internalformat,zt.width>>Tn,zt.height>>Tn,0,zt.internalformat,zt.type,null);Oo(zt.texInfo,zt.target)})}function Iu(){for(var Ne=0;Ne<As;++Ne){var tr=_o[Ne];tr&&(tr.bindCount=0,tr.unit=-1,_o[Ne]=null),Z.activeTexture(Zl+Ne),Z.bindTexture(_s,null),Z.bindTexture(pf,null)}}return{create2D:_i,createCube:Gi,clear:ma,getTexture:function(Ne){return null},restore:Bo,refresh:Iu}}var fu=36161,Yn=32854,zn=32855,Gl=36194,$o=33189,hu=36168,qo=34041,Gu=35907,Yc=34836,Hl=34842,Ea=34843,Ua=[];Ua[Yn]=2,Ua[zn]=2,Ua[Gl]=2,Ua[$o]=2,Ua[hu]=1,Ua[qo]=4,Ua[Gu]=4,Ua[Yc]=16,Ua[Hl]=8,Ua[Ea]=6;function qf(Z,we,Xe){return Ua[Z]*we*Xe}var Wl=function(Z,we,Xe,Kt,br){var $t={rgba4:Yn,rgb565:Gl,"rgb5 a1":zn,depth:$o,stencil:hu,"depth stencil":qo};we.ext_srgb&&($t.srgba=Gu),we.ext_color_buffer_half_float&&($t.rgba16f=Hl,$t.rgb16f=Ea),we.webgl_color_buffer_float&&($t.rgba32f=Yc);var mr=[];Object.keys($t).forEach(function(Fr){var Vr=$t[Fr];mr[Vr]=Fr});var Ar=0,Rr={};function Nr(Fr){this.id=Ar++,this.refCount=1,this.renderbuffer=Fr,this.format=Yn,this.width=0,this.height=0,br.profile&&(this.stats={size:0})}Nr.prototype.decRef=function(){--this.refCount<=0&&Gr(this)};function Gr(Fr){var Vr=Fr.renderbuffer;z(Vr,"must not double destroy renderbuffer"),Z.bindRenderbuffer(fu,null),Z.deleteRenderbuffer(Vr),Fr.renderbuffer=null,Fr.refCount=0,delete Rr[Fr.id],Kt.renderbufferCount--}function Wr(Fr,Vr){var Ct=new Nr(Z.createRenderbuffer());Rr[Ct.id]=Ct,Kt.renderbufferCount++;function rr(rn,Cr){var Hr=0,vn=0,qn=Yn;if(typeof rn=="object"&&rn){var vr=rn;if("shape"in vr){var xr=vr.shape;z(Array.isArray(xr)&&xr.length>=2,"invalid renderbuffer shape"),Hr=xr[0]|0,vn=xr[1]|0}else"radius"in vr&&(Hr=vn=vr.radius|0),"width"in vr&&(Hr=vr.width|0),"height"in vr&&(vn=vr.height|0);"format"in vr&&(z.parameter(vr.format,$t,"invalid renderbuffer format"),qn=$t[vr.format])}else typeof rn=="number"?(Hr=rn|0,typeof Cr=="number"?vn=Cr|0:vn=Hr):rn?z.raise("invalid arguments to renderbuffer constructor"):Hr=vn=1;if(z(Hr>0&&vn>0&&Hr<=Xe.maxRenderbufferSize&&vn<=Xe.maxRenderbufferSize,"invalid renderbuffer size"),!(Hr===Ct.width&&vn===Ct.height&&qn===Ct.format))return rr.width=Ct.width=Hr,rr.height=Ct.height=vn,Ct.format=qn,Z.bindRenderbuffer(fu,Ct.renderbuffer),Z.renderbufferStorage(fu,qn,Hr,vn),z(Z.getError()===0,"invalid render buffer format"),br.profile&&(Ct.stats.size=qf(Ct.format,Ct.width,Ct.height)),rr.format=mr[Ct.format],rr}function zr(rn,Cr){var Hr=rn|0,vn=Cr|0||Hr;return Hr===Ct.width&&vn===Ct.height||(z(Hr>0&&vn>0&&Hr<=Xe.maxRenderbufferSize&&vn<=Xe.maxRenderbufferSize,"invalid renderbuffer size"),rr.width=Ct.width=Hr,rr.height=Ct.height=vn,Z.bindRenderbuffer(fu,Ct.renderbuffer),Z.renderbufferStorage(fu,Ct.format,Hr,vn),z(Z.getError()===0,"invalid render buffer format"),br.profile&&(Ct.stats.size=qf(Ct.format,Ct.width,Ct.height))),rr}return rr(Fr,Vr),rr.resize=zr,rr._reglType="renderbuffer",rr._renderbuffer=Ct,br.profile&&(rr.stats=Ct.stats),rr.destroy=function(){Ct.decRef()},rr}br.profile&&(Kt.getTotalRenderbufferSize=function(){var Fr=0;return Object.keys(Rr).forEach(function(Vr){Fr+=Rr[Vr].stats.size}),Fr});function un(){he(Rr).forEach(function(Fr){Fr.renderbuffer=Z.createRenderbuffer(),Z.bindRenderbuffer(fu,Fr.renderbuffer),Z.renderbufferStorage(fu,Fr.format,Fr.width,Fr.height)}),Z.bindRenderbuffer(fu,null)}return{create:Wr,clear:function(){he(Rr).forEach(Gr)},restore:un}},Xa=36160,Hu=36161,os=3553,wl=34069,Cu=36064,bf=36096,pu=36128,Al=33306,Xl=36053,Yl=36054,Tl=36055,Kf=36057,nl=36061,$l=36193,Ef=5121,ql=5126,go=6407,Sf=6408,$c=6402,Ml=[go,Sf],qc=[];qc[Sf]=4,qc[go]=3;var f=[];f[Ef]=1,f[ql]=4,f[$l]=2;var d=32854,h=32855,g=36194,S=33189,M=36168,k=34041,F=35907,G=34836,X=34842,ue=34843,Ee=[d,h,g,F,X,ue,G],te={};te[Xl]="complete",te[Yl]="incomplete attachment",te[Kf]="incomplete dimensions",te[Tl]="incomplete, missing attachment",te[nl]="unsupported";function je(Z,we,Xe,Kt,br,$t){var mr={cur:null,next:null,dirty:!1,setFBO:null},Ar=["rgba"],Rr=["rgba4","rgb565","rgb5 a1"];we.ext_srgb&&Rr.push("srgba"),we.ext_color_buffer_half_float&&Rr.push("rgba16f","rgb16f"),we.webgl_color_buffer_float&&Rr.push("rgba32f");var Nr=["uint8"];we.oes_texture_half_float&&Nr.push("half float","float16"),we.oes_texture_float&&Nr.push("float","float32");function Gr(Ur,cn,mn){this.target=Ur,this.texture=cn,this.renderbuffer=mn;var Ai=0,gi=0;cn?(Ai=cn.width,gi=cn.height):mn&&(Ai=mn.width,gi=mn.height),this.width=Ai,this.height=gi}function Wr(Ur){Ur&&(Ur.texture&&Ur.texture._texture.decRef(),Ur.renderbuffer&&Ur.renderbuffer._renderbuffer.decRef())}function un(Ur,cn,mn){if(!!Ur)if(Ur.texture){var Ai=Ur.texture._texture,gi=Math.max(1,Ai.width),fn=Math.max(1,Ai.height);z(gi===cn&&fn===mn,"inconsistent width/height for supplied texture"),Ai.refCount+=1}else{var En=Ur.renderbuffer._renderbuffer;z(En.width===cn&&En.height===mn,"inconsistent width/height for renderbuffer"),En.refCount+=1}}function Fr(Ur,cn){cn&&(cn.texture?Z.framebufferTexture2D(Xa,Ur,cn.target,cn.texture._texture.texture,0):Z.framebufferRenderbuffer(Xa,Ur,Hu,cn.renderbuffer._renderbuffer.renderbuffer))}function Vr(Ur){var cn=os,mn=null,Ai=null,gi=Ur;typeof Ur=="object"&&(gi=Ur.data,"target"in Ur&&(cn=Ur.target|0)),z.type(gi,"function","invalid attachment data");var fn=gi._reglType;return fn==="texture2d"?(mn=gi,z(cn===os)):fn==="textureCube"?(mn=gi,z(cn>=wl&&cn<wl+6,"invalid cube map target")):fn==="renderbuffer"?(Ai=gi,cn=Hu):z.raise("invalid regl object for attachment"),new Gr(cn,mn,Ai)}function Ct(Ur,cn,mn,Ai,gi){if(mn){var fn=Kt.create2D({width:Ur,height:cn,format:Ai,type:gi});return fn._texture.refCount=0,new Gr(os,fn,null)}else{var En=br.create({width:Ur,height:cn,format:Ai});return En._renderbuffer.refCount=0,new Gr(Hu,null,En)}}function rr(Ur){return Ur&&(Ur.texture||Ur.renderbuffer)}function zr(Ur,cn,mn){Ur&&(Ur.texture?Ur.texture.resize(cn,mn):Ur.renderbuffer&&Ur.renderbuffer.resize(cn,mn),Ur.width=cn,Ur.height=mn)}var rn=0,Cr={};function Hr(){this.id=rn++,Cr[this.id]=this,this.framebuffer=Z.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function vn(Ur){Ur.colorAttachments.forEach(Wr),Wr(Ur.depthAttachment),Wr(Ur.stencilAttachment),Wr(Ur.depthStencilAttachment)}function qn(Ur){var cn=Ur.framebuffer;z(cn,"must not double destroy framebuffer"),Z.deleteFramebuffer(cn),Ur.framebuffer=null,$t.framebufferCount--,delete Cr[Ur.id]}function vr(Ur){var cn;Z.bindFramebuffer(Xa,Ur.framebuffer);var mn=Ur.colorAttachments;for(cn=0;cn<mn.length;++cn)Fr(Cu+cn,mn[cn]);for(cn=mn.length;cn<Xe.maxColorAttachments;++cn)Z.framebufferTexture2D(Xa,Cu+cn,os,null,0);Z.framebufferTexture2D(Xa,Al,os,null,0),Z.framebufferTexture2D(Xa,bf,os,null,0),Z.framebufferTexture2D(Xa,pu,os,null,0),Fr(bf,Ur.depthAttachment),Fr(pu,Ur.stencilAttachment),Fr(Al,Ur.depthStencilAttachment);var Ai=Z.checkFramebufferStatus(Xa);!Z.isContextLost()&&Ai!==Xl&&z.raise("framebuffer configuration not supported, status = "+te[Ai]),Z.bindFramebuffer(Xa,mr.next?mr.next.framebuffer:null),mr.cur=mr.next,Z.getError()}function xr(Ur,cn){var mn=new Hr;$t.framebufferCount++;function Ai(fn,En){var di;z(mr.next!==mn,"can not update framebuffer which is currently in use");var wi=0,Ui=0,no=!0,co=!0,ji=null,hs=!0,Va="rgba",ss="uint8",Oo=1,Do=null,Fo=null,As=null,_o=!1;if(typeof fn=="number")wi=fn|0,Ui=En|0||wi;else if(!fn)wi=Ui=1;else{z.type(fn,"object","invalid arguments for framebuffer");var Mi=fn;if("shape"in Mi){var Jo=Mi.shape;z(Array.isArray(Jo)&&Jo.length>=2,"invalid shape for framebuffer"),wi=Jo[0],Ui=Jo[1]}else"radius"in Mi&&(wi=Ui=Mi.radius),"width"in Mi&&(wi=Mi.width),"height"in Mi&&(Ui=Mi.height);("color"in Mi||"colors"in Mi)&&(ji=Mi.color||Mi.colors,Array.isArray(ji)&&z(ji.length===1||we.webgl_draw_buffers,"multiple render targets not supported")),ji||("colorCount"in Mi&&(Oo=Mi.colorCount|0,z(Oo>0,"invalid color buffer count")),"colorTexture"in Mi&&(hs=!!Mi.colorTexture,Va="rgba4"),"colorType"in Mi&&(ss=Mi.colorType,hs?(z(we.oes_texture_float||!(ss==="float"||ss==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),z(we.oes_texture_half_float||!(ss==="half float"||ss==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):ss==="half float"||ss==="float16"?(z(we.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Va="rgba16f"):(ss==="float"||ss==="float32")&&(z(we.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Va="rgba32f"),z.oneOf(ss,Nr,"invalid color type")),"colorFormat"in Mi&&(Va=Mi.colorFormat,Ar.indexOf(Va)>=0?hs=!0:Rr.indexOf(Va)>=0?hs=!1:z.optional(function(){hs?z.oneOf(Mi.colorFormat,Ar,"invalid color format for texture"):z.oneOf(Mi.colorFormat,Rr,"invalid color format for renderbuffer")}))),("depthTexture"in Mi||"depthStencilTexture"in Mi)&&(_o=!!(Mi.depthTexture||Mi.depthStencilTexture),z(!_o||we.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Mi&&(typeof Mi.depth=="boolean"?no=Mi.depth:(Do=Mi.depth,co=!1)),"stencil"in Mi&&(typeof Mi.stencil=="boolean"?co=Mi.stencil:(Fo=Mi.stencil,no=!1)),"depthStencil"in Mi&&(typeof Mi.depthStencil=="boolean"?no=co=Mi.depthStencil:(As=Mi.depthStencil,no=!1,co=!1))}var la=null,ps=null,_i=null,Gi=null;if(Array.isArray(ji))la=ji.map(Vr);else if(ji)la=[Vr(ji)];else for(la=new Array(Oo),di=0;di<Oo;++di)la[di]=Ct(wi,Ui,hs,Va,ss);z(we.webgl_draw_buffers||la.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),z(la.length<=Xe.maxColorAttachments,"too many color attachments, not supported"),wi=wi||la[0].width,Ui=Ui||la[0].height,Do?ps=Vr(Do):no&&!co&&(ps=Ct(wi,Ui,_o,"depth","uint32")),Fo?_i=Vr(Fo):co&&!no&&(_i=Ct(wi,Ui,!1,"stencil","uint8")),As?Gi=Vr(As):!Do&&!Fo&&co&&no&&(Gi=Ct(wi,Ui,_o,"depth stencil","depth stencil")),z(!!Do+!!Fo+!!As<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ma=null;for(di=0;di<la.length;++di)if(un(la[di],wi,Ui),z(!la[di]||la[di].texture&&Ml.indexOf(la[di].texture._texture.format)>=0||la[di].renderbuffer&&Ee.indexOf(la[di].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+di+" is invalid"),la[di]&&la[di].texture){var Bo=qc[la[di].texture._texture.format]*f[la[di].texture._texture.type];ma===null?ma=Bo:z(ma===Bo,"all color attachments much have the same number of bits per pixel.")}return un(ps,wi,Ui),z(!ps||ps.texture&&ps.texture._texture.format===$c||ps.renderbuffer&&ps.renderbuffer._renderbuffer.format===S,"invalid depth attachment for framebuffer object"),un(_i,wi,Ui),z(!_i||_i.renderbuffer&&_i.renderbuffer._renderbuffer.format===M,"invalid stencil attachment for framebuffer object"),un(Gi,wi,Ui),z(!Gi||Gi.texture&&Gi.texture._texture.format===k||Gi.renderbuffer&&Gi.renderbuffer._renderbuffer.format===k,"invalid depth-stencil attachment for framebuffer object"),vn(mn),mn.width=wi,mn.height=Ui,mn.colorAttachments=la,mn.depthAttachment=ps,mn.stencilAttachment=_i,mn.depthStencilAttachment=Gi,Ai.color=la.map(rr),Ai.depth=rr(ps),Ai.stencil=rr(_i),Ai.depthStencil=rr(Gi),Ai.width=mn.width,Ai.height=mn.height,vr(mn),Ai}function gi(fn,En){z(mr.next!==mn,"can not resize a framebuffer which is currently in use");var di=Math.max(fn|0,1),wi=Math.max(En|0||di,1);if(di===mn.width&&wi===mn.height)return Ai;for(var Ui=mn.colorAttachments,no=0;no<Ui.length;++no)zr(Ui[no],di,wi);return zr(mn.depthAttachment,di,wi),zr(mn.stencilAttachment,di,wi),zr(mn.depthStencilAttachment,di,wi),mn.width=Ai.width=di,mn.height=Ai.height=wi,vr(mn),Ai}return Ai(Ur,cn),y(Ai,{resize:gi,_reglType:"framebuffer",_framebuffer:mn,destroy:function(){qn(mn),vn(mn)},use:function(fn){mr.setFBO({framebuffer:Ai},fn)}})}function On(Ur){var cn=Array(6);function mn(gi){var fn;z(cn.indexOf(mr.next)<0,"can not update framebuffer which is currently in use");var En={color:null},di=0,wi=null,Ui="rgba",no="uint8",co=1;if(typeof gi=="number")di=gi|0;else if(!gi)di=1;else{z.type(gi,"object","invalid arguments for framebuffer");var ji=gi;if("shape"in ji){var hs=ji.shape;z(Array.isArray(hs)&&hs.length>=2,"invalid shape for framebuffer"),z(hs[0]===hs[1],"cube framebuffer must be square"),di=hs[0]}else"radius"in ji&&(di=ji.radius|0),"width"in ji?(di=ji.width|0,"height"in ji&&z(ji.height===di,"must be square")):"height"in ji&&(di=ji.height|0);("color"in ji||"colors"in ji)&&(wi=ji.color||ji.colors,Array.isArray(wi)&&z(wi.length===1||we.webgl_draw_buffers,"multiple render targets not supported")),wi||("colorCount"in ji&&(co=ji.colorCount|0,z(co>0,"invalid color buffer count")),"colorType"in ji&&(z.oneOf(ji.colorType,Nr,"invalid color type"),no=ji.colorType),"colorFormat"in ji&&(Ui=ji.colorFormat,z.oneOf(ji.colorFormat,Ar,"invalid color format for texture"))),"depth"in ji&&(En.depth=ji.depth),"stencil"in ji&&(En.stencil=ji.stencil),"depthStencil"in ji&&(En.depthStencil=ji.depthStencil)}var Va;if(wi)if(Array.isArray(wi))for(Va=[],fn=0;fn<wi.length;++fn)Va[fn]=wi[fn];else Va=[wi];else{Va=Array(co);var ss={radius:di,format:Ui,type:no};for(fn=0;fn<co;++fn)Va[fn]=Kt.createCube(ss)}for(En.color=Array(Va.length),fn=0;fn<Va.length;++fn){var Oo=Va[fn];z(typeof Oo=="function"&&Oo._reglType==="textureCube","invalid cube map"),di=di||Oo.width,z(Oo.width===di&&Oo.height===di,"invalid cube map shape"),En.color[fn]={target:wl,data:Va[fn]}}for(fn=0;fn<6;++fn){for(var Do=0;Do<Va.length;++Do)En.color[Do].target=wl+fn;fn>0&&(En.depth=cn[0].depth,En.stencil=cn[0].stencil,En.depthStencil=cn[0].depthStencil),cn[fn]?cn[fn](En):cn[fn]=xr(En)}return y(mn,{width:di,height:di,color:Va})}function Ai(gi){var fn,En=gi|0;if(z(En>0&&En<=Xe.maxCubeMapSize,"invalid radius for cube fbo"),En===mn.width)return mn;var di=mn.color;for(fn=0;fn<di.length;++fn)di[fn].resize(En);for(fn=0;fn<6;++fn)cn[fn].resize(En);return mn.width=mn.height=En,mn}return mn(Ur),y(mn,{faces:cn,resize:Ai,_reglType:"framebufferCube",destroy:function(){cn.forEach(function(gi){gi.destroy()})}})}function Kr(){mr.cur=null,mr.next=null,mr.dirty=!0,he(Cr).forEach(function(Ur){Ur.framebuffer=Z.createFramebuffer(),vr(Ur)})}return y(mr,{getFramebuffer:function(Ur){if(typeof Ur=="function"&&Ur._reglType==="framebuffer"){var cn=Ur._framebuffer;if(cn instanceof Hr)return cn}return null},create:xr,createCube:On,clear:function(){he(Cr).forEach(qn)},restore:Kr})}var ze=5126,nt=34962,Be=34963,rt=["attributes","elements","offset","count","primitive","instances"];function mt(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=ze,this.offset=0,this.stride=0,this.divisor=0}function Dt(Z,we,Xe,Kt,br,$t,mr){for(var Ar=Xe.maxAttributes,Rr=new Array(Ar),Nr=0;Nr<Ar;++Nr)Rr[Nr]=new mt;var Gr=0,Wr={},un={Record:mt,scope:{},state:Rr,currentVAO:null,targetVAO:null,restore:Vr()?vn:function(){},createVAO:qn,getVAO:rr,destroyBuffer:Fr,setVAO:Vr()?zr:rn,clear:Vr()?Cr:function(){}};function Fr(vr){for(var xr=0;xr<Rr.length;++xr){var On=Rr[xr];On.buffer===vr&&(Z.disableVertexAttribArray(xr),On.buffer=null)}}function Vr(){return we.oes_vertex_array_object}function Ct(){return we.angle_instanced_arrays}function rr(vr){return typeof vr=="function"&&vr._vao?vr._vao:null}function zr(vr){if(vr!==un.currentVAO){var xr=Vr();vr?xr.bindVertexArrayOES(vr.vao):xr.bindVertexArrayOES(null),un.currentVAO=vr}}function rn(vr){if(vr!==un.currentVAO){if(vr)vr.bindAttrs();else{for(var xr=Ct(),On=0;On<Rr.length;++On){var Kr=Rr[On];Kr.buffer?(Z.enableVertexAttribArray(On),Kr.buffer.bind(),Z.vertexAttribPointer(On,Kr.size,Kr.type,Kr.normalized,Kr.stride,Kr.offfset),xr&&Kr.divisor&&xr.vertexAttribDivisorANGLE(On,Kr.divisor)):(Z.disableVertexAttribArray(On),Z.vertexAttrib4f(On,Kr.x,Kr.y,Kr.z,Kr.w))}mr.elements?Z.bindBuffer(Be,mr.elements.buffer.buffer):Z.bindBuffer(Be,null)}un.currentVAO=vr}}function Cr(){he(Wr).forEach(function(vr){vr.destroy()})}function Hr(){this.id=++Gr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var vr=Vr();vr?this.vao=vr.createVertexArrayOES():this.vao=null,Wr[this.id]=this,this.buffers=[]}Hr.prototype.bindAttrs=function(){for(var vr=Ct(),xr=this.attributes,On=0;On<xr.length;++On){var Kr=xr[On];Kr.buffer?(Z.enableVertexAttribArray(On),Z.bindBuffer(nt,Kr.buffer.buffer),Z.vertexAttribPointer(On,Kr.size,Kr.type,Kr.normalized,Kr.stride,Kr.offset),vr&&Kr.divisor&&vr.vertexAttribDivisorANGLE(On,Kr.divisor)):(Z.disableVertexAttribArray(On),Z.vertexAttrib4f(On,Kr.x,Kr.y,Kr.z,Kr.w))}for(var Ur=xr.length;Ur<Ar;++Ur)Z.disableVertexAttribArray(Ur);var cn=$t.getElements(this.elements);cn?Z.bindBuffer(Be,cn.buffer.buffer):Z.bindBuffer(Be,null)},Hr.prototype.refresh=function(){var vr=Vr();vr&&(vr.bindVertexArrayOES(this.vao),this.bindAttrs(),un.currentVAO=null,vr.bindVertexArrayOES(null))},Hr.prototype.destroy=function(){if(this.vao){var vr=Vr();this===un.currentVAO&&(un.currentVAO=null,vr.bindVertexArrayOES(null)),vr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Wr[this.id]&&(delete Wr[this.id],Kt.vaoCount-=1)};function vn(){var vr=Vr();vr&&he(Wr).forEach(function(xr){xr.refresh()})}function qn(vr){var xr=new Hr;Kt.vaoCount+=1;function On(Kr){var Ur;if(Array.isArray(Kr))Ur=Kr,xr.elements&&xr.ownsElements&&xr.elements.destroy(),xr.elements=null,xr.ownsElements=!1,xr.offset=0,xr.count=0,xr.instances=-1,xr.primitive=4;else{if(z(typeof Kr=="object","invalid arguments for create vao"),z("attributes"in Kr,"must specify attributes for vao"),Kr.elements){var cn=Kr.elements;xr.ownsElements?typeof cn=="function"&&cn._reglType==="elements"?(xr.elements.destroy(),xr.ownsElements=!1):(xr.elements(cn),xr.ownsElements=!1):$t.getElements(Kr.elements)?(xr.elements=Kr.elements,xr.ownsElements=!1):(xr.elements=$t.create(Kr.elements),xr.ownsElements=!0)}else xr.elements=null,xr.ownsElements=!1;Ur=Kr.attributes,xr.offset=0,xr.count=-1,xr.instances=-1,xr.primitive=4,xr.elements&&(xr.count=xr.elements._elements.vertCount,xr.primitive=xr.elements._elements.primType),"offset"in Kr&&(xr.offset=Kr.offset|0),"count"in Kr&&(xr.count=Kr.count|0),"instances"in Kr&&(xr.instances=Kr.instances|0),"primitive"in Kr&&(z(Kr.primitive in yr,"bad primitive type: "+Kr.primitive),xr.primitive=yr[Kr.primitive]),z.optional(function(){for(var no=Object.keys(Kr),co=0;co<no.length;++co)z(rt.indexOf(no[co])>=0,'invalid option for vao: "'+no[co]+'" valid options are '+rt)}),z(Array.isArray(Ur),"attributes must be an array")}z(Ur.length<Ar,"too many attributes"),z(Ur.length>0,"must specify at least one attribute");var mn={},Ai=xr.attributes;Ai.length=Ur.length;for(var gi=0;gi<Ur.length;++gi){var fn=Ur[gi],En=Ai[gi]=new mt,di=fn.data||fn;if(Array.isArray(di)||J(di)||ns(di)){var wi;xr.buffers[gi]&&(wi=xr.buffers[gi],J(di)&&wi._buffer.byteLength>=di.byteLength?wi.subdata(di):(wi.destroy(),xr.buffers[gi]=null)),xr.buffers[gi]||(wi=xr.buffers[gi]=br.create(fn,nt,!1,!0)),En.buffer=br.getBuffer(wi),En.size=En.buffer.dimension|0,En.normalized=!1,En.type=En.buffer.dtype,En.offset=0,En.stride=0,En.divisor=0,En.state=1,mn[gi]=1}else br.getBuffer(fn)?(En.buffer=br.getBuffer(fn),En.size=En.buffer.dimension|0,En.normalized=!1,En.type=En.buffer.dtype,En.offset=0,En.stride=0,En.divisor=0,En.state=1):br.getBuffer(fn.buffer)?(En.buffer=br.getBuffer(fn.buffer),En.size=(+fn.size||En.buffer.dimension)|0,En.normalized=!!fn.normalized||!1,"type"in fn?(z.parameter(fn.type,uu,"invalid buffer type"),En.type=uu[fn.type]):En.type=En.buffer.dtype,En.offset=(fn.offset||0)|0,En.stride=(fn.stride||0)|0,En.divisor=(fn.divisor||0)|0,En.state=1,z(En.size>=1&&En.size<=4,"size must be between 1 and 4"),z(En.offset>=0,"invalid offset"),z(En.stride>=0&&En.stride<=255,"stride must be between 0 and 255"),z(En.divisor>=0,"divisor must be positive"),z(!En.divisor||!!we.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in fn?(z(gi>0,"first attribute must not be a constant"),En.x=+fn.x||0,En.y=+fn.y||0,En.z=+fn.z||0,En.w=+fn.w||0,En.state=2):z(!1,"invalid attribute spec for location "+gi)}for(var Ui=0;Ui<xr.buffers.length;++Ui)!mn[Ui]&&xr.buffers[Ui]&&(xr.buffers[Ui].destroy(),xr.buffers[Ui]=null);return xr.refresh(),On}return On.destroy=function(){for(var Kr=0;Kr<xr.buffers.length;++Kr)xr.buffers[Kr]&&xr.buffers[Kr].destroy();xr.buffers.length=0,xr.ownsElements&&(xr.elements.destroy(),xr.elements=null,xr.ownsElements=!1),xr.destroy()},On._vao=xr,On._reglType="vao",On(vr)}return un}var fr=35632,nr=35633,dr=35718,Ir=35721;function tn(Z,we,Xe,Kt){var br={},$t={};function mr(Ct,rr,zr,rn){this.name=Ct,this.id=rr,this.location=zr,this.info=rn}function Ar(Ct,rr){for(var zr=0;zr<Ct.length;++zr)if(Ct[zr].id===rr.id){Ct[zr].location=rr.location;return}Ct.push(rr)}function Rr(Ct,rr,zr){var rn=Ct===fr?br:$t,Cr=rn[rr];if(!Cr){var Hr=we.str(rr);Cr=Z.createShader(Ct),Z.shaderSource(Cr,Hr),Z.compileShader(Cr),z.shaderError(Z,Cr,Hr,Ct,zr),rn[rr]=Cr}return Cr}var Nr={},Gr=[],Wr=0;function un(Ct,rr){this.id=Wr++,this.fragId=Ct,this.vertId=rr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Kt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Fr(Ct,rr,zr){var rn,Cr,Hr=Rr(fr,Ct.fragId),vn=Rr(nr,Ct.vertId),qn=Ct.program=Z.createProgram();if(Z.attachShader(qn,Hr),Z.attachShader(qn,vn),zr)for(rn=0;rn<zr.length;++rn){var vr=zr[rn];Z.bindAttribLocation(qn,vr[0],vr[1])}Z.linkProgram(qn),z.linkError(Z,qn,we.str(Ct.fragId),we.str(Ct.vertId),rr);var xr=Z.getProgramParameter(qn,dr);Kt.profile&&(Ct.stats.uniformsCount=xr);var On=Ct.uniforms;for(rn=0;rn<xr;++rn)if(Cr=Z.getActiveUniform(qn,rn),Cr)if(Cr.size>1)for(var Kr=0;Kr<Cr.size;++Kr){var Ur=Cr.name.replace("[0]","["+Kr+"]");Ar(On,new mr(Ur,we.id(Ur),Z.getUniformLocation(qn,Ur),Cr))}else Ar(On,new mr(Cr.name,we.id(Cr.name),Z.getUniformLocation(qn,Cr.name),Cr));var cn=Z.getProgramParameter(qn,Ir);Kt.profile&&(Ct.stats.attributesCount=cn);var mn=Ct.attributes;for(rn=0;rn<cn;++rn)Cr=Z.getActiveAttrib(qn,rn),Cr&&Ar(mn,new mr(Cr.name,we.id(Cr.name),Z.getAttribLocation(qn,Cr.name),Cr))}Kt.profile&&(Xe.getMaxUniformsCount=function(){var Ct=0;return Gr.forEach(function(rr){rr.stats.uniformsCount>Ct&&(Ct=rr.stats.uniformsCount)}),Ct},Xe.getMaxAttributesCount=function(){var Ct=0;return Gr.forEach(function(rr){rr.stats.attributesCount>Ct&&(Ct=rr.stats.attributesCount)}),Ct});function Vr(){br={},$t={};for(var Ct=0;Ct<Gr.length;++Ct)Fr(Gr[Ct],null,Gr[Ct].attributes.map(function(rr){return[rr.location,rr.name]}))}return{clear:function(){var Ct=Z.deleteShader.bind(Z);he(br).forEach(Ct),br={},he($t).forEach(Ct),$t={},Gr.forEach(function(rr){Z.deleteProgram(rr.program)}),Gr.length=0,Nr={},Xe.shaderCount=0},program:function(Ct,rr,zr,rn){z.command(Ct>=0,"missing vertex shader",zr),z.command(rr>=0,"missing fragment shader",zr);var Cr=Nr[rr];Cr||(Cr=Nr[rr]={});var Hr=Cr[Ct];if(Hr&&(Hr.refCount++,!rn))return Hr;var vn=new un(rr,Ct);return Xe.shaderCount++,Fr(vn,zr,rn),Hr||(Cr[Ct]=vn),Gr.push(vn),y(vn,{destroy:function(){if(vn.refCount--,vn.refCount<=0){Z.deleteProgram(vn.program);var qn=Gr.indexOf(vn);Gr.splice(qn,1),Xe.shaderCount--}Cr[vn.vertId].refCount<=0&&(Z.deleteShader($t[vn.vertId]),delete $t[vn.vertId],delete Nr[vn.fragId][vn.vertId]),Object.keys(Nr[vn.fragId]).length||(Z.deleteShader(br[vn.fragId]),delete br[vn.fragId],delete Nr[vn.fragId])}})},restore:Vr,shader:Rr,frag:-1,vert:-1}}var $r=6408,bn=5121,Qn=3333,$n=5126;function ei(Z,we,Xe,Kt,br,$t,mr){function Ar(Gr){var Wr;we.next===null?(z(br.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Wr=bn):(z(we.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Wr=we.next.colorAttachments[0].texture._texture.type,z.optional(function(){$t.oes_texture_float?(z(Wr===bn||Wr===$n,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Wr===$n&&z(mr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):z(Wr===bn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var un=0,Fr=0,Vr=Kt.framebufferWidth,Ct=Kt.framebufferHeight,rr=null;J(Gr)?rr=Gr:Gr&&(z.type(Gr,"object","invalid arguments to regl.read()"),un=Gr.x|0,Fr=Gr.y|0,z(un>=0&&un<Kt.framebufferWidth,"invalid x offset for regl.read"),z(Fr>=0&&Fr<Kt.framebufferHeight,"invalid y offset for regl.read"),Vr=(Gr.width||Kt.framebufferWidth-un)|0,Ct=(Gr.height||Kt.framebufferHeight-Fr)|0,rr=Gr.data||null),rr&&(Wr===bn?z(rr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Wr===$n&&z(rr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),z(Vr>0&&Vr+un<=Kt.framebufferWidth,"invalid width for read pixels"),z(Ct>0&&Ct+Fr<=Kt.framebufferHeight,"invalid height for read pixels"),Xe();var zr=Vr*Ct*4;return rr||(Wr===bn?rr=new Uint8Array(zr):Wr===$n&&(rr=rr||new Float32Array(zr))),z.isTypedArray(rr,"data buffer for regl.read() must be a typedarray"),z(rr.byteLength>=zr,"data buffer for regl.read() too small"),Z.pixelStorei(Qn,4),Z.readPixels(un,Fr,Vr,Ct,$r,Wr,rr),rr}function Rr(Gr){var Wr;return we.setFBO({framebuffer:Gr.framebuffer},function(){Wr=Ar(Gr)}),Wr}function Nr(Gr){return!Gr||!("framebuffer"in Gr)?Ar(Gr):Rr(Gr)}return Nr}function Fi(Z){return Array.prototype.slice.call(Z)}function Cn(Z){return Fi(Z).join("")}function Ei(){var Z=0,we=[],Xe=[];function Kt(Wr){for(var un=0;un<Xe.length;++un)if(Xe[un]===Wr)return we[un];var Fr="g"+Z++;return we.push(Fr),Xe.push(Wr),Fr}function br(){var Wr=[];function un(){Wr.push.apply(Wr,Fi(arguments))}var Fr=[];function Vr(){var Ct="v"+Z++;return Fr.push(Ct),arguments.length>0&&(Wr.push(Ct,"="),Wr.push.apply(Wr,Fi(arguments)),Wr.push(";")),Ct}return y(un,{def:Vr,toString:function(){return Cn([Fr.length>0?"var "+Fr.join(",")+";":"",Cn(Wr)])}})}function $t(){var Wr=br(),un=br(),Fr=Wr.toString,Vr=un.toString;function Ct(rr,zr){un(rr,zr,"=",Wr.def(rr,zr),";")}return y(function(){Wr.apply(Wr,Fi(arguments))},{def:Wr.def,entry:Wr,exit:un,save:Ct,set:function(rr,zr,rn){Ct(rr,zr),Wr(rr,zr,"=",rn,";")},toString:function(){return Fr()+Vr()}})}function mr(){var Wr=Cn(arguments),un=$t(),Fr=$t(),Vr=un.toString,Ct=Fr.toString;return y(un,{then:function(){return un.apply(un,Fi(arguments)),this},else:function(){return Fr.apply(Fr,Fi(arguments)),this},toString:function(){var rr=Ct();return rr&&(rr="else{"+rr+"}"),Cn(["if(",Wr,"){",Vr(),"}",rr])}})}var Ar=br(),Rr={};function Nr(Wr,un){var Fr=[];function Vr(){var Cr="a"+Fr.length;return Fr.push(Cr),Cr}un=un||0;for(var Ct=0;Ct<un;++Ct)Vr();var rr=$t(),zr=rr.toString,rn=Rr[Wr]=y(rr,{arg:Vr,toString:function(){return Cn(["function(",Fr.join(),"){",zr(),"}"])}});return rn}function Gr(){var Wr=['"use strict";',Ar,"return {"];Object.keys(Rr).forEach(function(Ct){Wr.push('"',Ct,'":',Rr[Ct].toString(),",")}),Wr.push("}");var un=Cn(Wr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Fr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Vr=Fr?Le.Function.apply(null,we.concat(un)):Function.apply(null,we.concat(un));return Vr.apply(null,Xe)}return{global:Ar,link:Kt,block:br,proc:Nr,scope:$t,cond:mr,compile:Gr}}var Si="xyzw".split(""),mi=5121,ai=1,Ti=2,li=0,ti=1,bo=2,ro=3,Ko=4,Qo=5,Ya=6,yo="dither",Eo="blend.enable",fs="blend.color",il="blend.equation",Ss="blend.func",wu="depth.enable",du="depth.func",Kl="depth.range",Il="depth.mask",al="colorMask",mc="cull.enable",gc="cull.face",vu="frontFace",Ql="lineWidth",Au="polygonOffset.enable",Po="polygonOffset.offset",Wu="sample.alpha",ol="sample.enable",mu="sample.coverage",ua="stencil.enable",Gs="stencil.mask",Cs="stencil.func",Xu="stencil.opFront",yc="stencil.opBack",Jl="scissor.enable",Qf="scissor.box",ru="viewport",_c="profile",gu="framebuffer",ec="vert",Cf="frag",nu="elements",Lo="primitive",tc="count",Kc="offset",Th="instances",Hs="vao",jr="Width",wf="Height",Qc=gu+jr,So=gu+wf,sl=ru+jr,Jc=ru+wf,ul="drawingBuffer",Tu=ul+jr,ef=ul+wf,dp=[Ss,il,Cs,Xu,yc,mu,ru,Qf,Po],Jf=34962,vp=34963,mp=35632,Mh=35633,gp=3553,yp=34067,$d=2884,Af=3042,ud=3024,Ro=2960,Ih=2929,kh=3089,eh=32823,Ph=32926,th=32928,Lh=5126,rc=35664,xc=35665,Tf=35666,rh=5124,Rh=35667,bc=35668,Mf=35669,ll=35670,Ec=35671,nh=35672,If=35673,ws=35674,kl=35675,Ns=35676,ih=35678,kf=35680,ah=4,Mu=1028,tf=1029,ld=2304,Oh=2305,_p=32775,xp=32776,oh=519,Yu=7680,bp=0,Dh=1,Pf=32774,cl=513,cd=36160,Ep=36064,fl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Lf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],rf={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Sc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},iu={frag:mp,vert:Mh},sh={cw:ld,ccw:Oh};function Fh(Z){return Array.isArray(Z)||J(Z)||ns(Z)}function Sp(Z){return Z.sort(function(we,Xe){return we===ru?-1:Xe===ru?1:we<Xe?-1:1})}function Sa(Z,we,Xe,Kt){this.thisDep=Z,this.contextDep=we,this.propDep=Xe,this.append=Kt}function Cc(Z){return Z&&!(Z.thisDep||Z.contextDep||Z.propDep)}function Zo(Z){return new Sa(!1,!1,!1,Z)}function Er(Z,we){var Xe=Z.type;if(Xe===li){var Kt=Z.data.length;return new Sa(!0,Kt>=1,Kt>=2,we)}else if(Xe===Ko){var br=Z.data;return new Sa(br.thisDep,br.contextDep,br.propDep,we)}else{if(Xe===Qo)return new Sa(!1,!1,!1,we);if(Xe===Ya){for(var $t=!1,mr=!1,Ar=!1,Rr=0;Rr<Z.data.length;++Rr){var Nr=Z.data[Rr];if(Nr.type===ti)Ar=!0;else if(Nr.type===bo)mr=!0;else if(Nr.type===ro)$t=!0;else if(Nr.type===li){$t=!0;var Gr=Nr.data;Gr>=1&&(mr=!0),Gr>=2&&(Ar=!0)}else Nr.type===Ko&&($t=$t||Nr.data.thisDep,mr=mr||Nr.data.contextDep,Ar=Ar||Nr.data.propDep)}return new Sa($t,mr,Ar,we)}else return new Sa(Xe===ro,Xe===bo,Xe===ti,we)}}var nc=new Sa(!1,!1,!1,function(){});function fd(Z,we,Xe,Kt,br,$t,mr,Ar,Rr,Nr,Gr,Wr,un,Fr,Vr){var Ct=Nr.Record,rr={add:32774,subtract:32778,"reverse subtract":32779};Xe.ext_blend_minmax&&(rr.min=_p,rr.max=xp);var zr=Xe.angle_instanced_arrays,rn=Xe.webgl_draw_buffers,Cr=Xe.oes_vertex_array_object,Hr={dirty:!0,profile:Vr.profile},vn={},qn=[],vr={},xr={};function On(De){return De.replace(".","_")}function Kr(De,xe,tt){var At=On(De);qn.push(De),vn[At]=Hr[At]=!!tt,vr[At]=xe}function Ur(De,xe,tt){var At=On(De);qn.push(De),Array.isArray(tt)?(Hr[At]=tt.slice(),vn[At]=tt.slice()):Hr[At]=vn[At]=tt,xr[At]=xe}Kr(yo,ud),Kr(Eo,Af),Ur(fs,"blendColor",[0,0,0,0]),Ur(il,"blendEquationSeparate",[Pf,Pf]),Ur(Ss,"blendFuncSeparate",[Dh,bp,Dh,bp]),Kr(wu,Ih,!0),Ur(du,"depthFunc",cl),Ur(Kl,"depthRange",[0,1]),Ur(Il,"depthMask",!0),Ur(al,al,[!0,!0,!0,!0]),Kr(mc,$d),Ur(gc,"cullFace",tf),Ur(vu,vu,Oh),Ur(Ql,Ql,1),Kr(Au,eh),Ur(Po,"polygonOffset",[0,0]),Kr(Wu,Ph),Kr(ol,th),Ur(mu,"sampleCoverage",[1,!1]),Kr(ua,Ro),Ur(Gs,"stencilMask",-1),Ur(Cs,"stencilFunc",[oh,0,-1]),Ur(Xu,"stencilOpSeparate",[Mu,Yu,Yu,Yu]),Ur(yc,"stencilOpSeparate",[tf,Yu,Yu,Yu]),Kr(Jl,kh),Ur(Qf,"scissor",[0,0,Z.drawingBufferWidth,Z.drawingBufferHeight]),Ur(ru,ru,[0,0,Z.drawingBufferWidth,Z.drawingBufferHeight]);var cn={gl:Z,context:un,strings:we,next:vn,current:Hr,draw:Wr,elements:$t,buffer:br,shader:Gr,attributes:Nr.state,vao:Nr,uniforms:Rr,framebuffer:Ar,extensions:Xe,timer:Fr,isBufferArgs:Fh},mn={primTypes:yr,compareFuncs:rf,blendFuncs:fl,blendEquations:rr,stencilOps:Sc,glTypes:uu,orientationType:sh};z.optional(function(){cn.isArrayLike=mo}),rn&&(mn.backBuffer=[tf],mn.drawBuffer=et(Kt.maxDrawbuffers,function(De){return De===0?[0]:et(De,function(xe){return Ep+xe})}));var Ai=0;function gi(){var De=Ei(),xe=De.link,tt=De.global;De.id=Ai++,De.batchId="0";var At=xe(cn),Wt=De.shared={props:"a0"};Object.keys(cn).forEach(function(Je){Wt[Je]=tt.def(At,".",Je)}),z.optional(function(){De.CHECK=xe(z),De.commandStr=z.guessCommand(),De.command=xe(De.commandStr),De.assert=function(Je,Oe,It){Je("if(!(",Oe,"))",this.CHECK,".commandRaise(",xe(It),",",this.command,");")},mn.invalidBlendCombinations=Lf});var ut=De.next={},We=De.current={};Object.keys(xr).forEach(function(Je){Array.isArray(Hr[Je])&&(ut[Je]=tt.def(Wt.next,".",Je),We[Je]=tt.def(Wt.current,".",Je))});var _t=De.constants={};Object.keys(mn).forEach(function(Je){_t[Je]=tt.def(JSON.stringify(mn[Je]))}),De.invoke=function(Je,Oe){switch(Oe.type){case li:var It=["this",Wt.context,Wt.props,De.batchId];return Je.def(xe(Oe.data),".call(",It.slice(0,Math.max(Oe.data.length+1,4)),")");case ti:return Je.def(Wt.props,Oe.data);case bo:return Je.def(Wt.context,Oe.data);case ro:return Je.def("this",Oe.data);case Ko:return Oe.data.append(De,Je),Oe.data.ref;case Qo:return Oe.data.toString();case Ya:return Oe.data.map(function(Zt){return De.invoke(Je,Zt)})}},De.attribCache={};var Ie={};return De.scopeAttrib=function(Je){var Oe=we.id(Je);if(Oe in Ie)return Ie[Oe];var It=Nr.scope[Oe];It||(It=Nr.scope[Oe]=new Ct);var Zt=Ie[Oe]=xe(It);return Zt},De}function fn(De){var xe=De.static,tt=De.dynamic,At;if(_c in xe){var Wt=!!xe[_c];At=Zo(function(We,_t){return Wt}),At.enable=Wt}else if(_c in tt){var ut=tt[_c];At=Er(ut,function(We,_t){return We.invoke(_t,ut)})}return At}function En(De,xe){var tt=De.static,At=De.dynamic;if(gu in tt){var Wt=tt[gu];return Wt?(Wt=Ar.getFramebuffer(Wt),z.command(Wt,"invalid framebuffer object"),Zo(function(We,_t){var Ie=We.link(Wt),Je=We.shared;_t.set(Je.framebuffer,".next",Ie);var Oe=Je.context;return _t.set(Oe,"."+Qc,Ie+".width"),_t.set(Oe,"."+So,Ie+".height"),Ie})):Zo(function(We,_t){var Ie=We.shared;_t.set(Ie.framebuffer,".next","null");var Je=Ie.context;return _t.set(Je,"."+Qc,Je+"."+Tu),_t.set(Je,"."+So,Je+"."+ef),"null"})}else if(gu in At){var ut=At[gu];return Er(ut,function(We,_t){var Ie=We.invoke(_t,ut),Je=We.shared,Oe=Je.framebuffer,It=_t.def(Oe,".getFramebuffer(",Ie,")");z.optional(function(){We.assert(_t,"!"+Ie+"||"+It,"invalid framebuffer object")}),_t.set(Oe,".next",It);var Zt=Je.context;return _t.set(Zt,"."+Qc,It+"?"+It+".width:"+Zt+"."+Tu),_t.set(Zt,"."+So,It+"?"+It+".height:"+Zt+"."+ef),It})}else return null}function di(De,xe,tt){var At=De.static,Wt=De.dynamic;function ut(Ie){if(Ie in At){var Je=At[Ie];z.commandType(Je,"object","invalid "+Ie,tt.commandStr);var Oe=!0,It=Je.x|0,Zt=Je.y|0,wr,an;return"width"in Je?(wr=Je.width|0,z.command(wr>=0,"invalid "+Ie,tt.commandStr)):Oe=!1,"height"in Je?(an=Je.height|0,z.command(an>=0,"invalid "+Ie,tt.commandStr)):Oe=!1,new Sa(!Oe&&xe&&xe.thisDep,!Oe&&xe&&xe.contextDep,!Oe&&xe&&xe.propDep,function(Qr,Bn){var wn=Qr.shared.context,Fn=wr;"width"in Je||(Fn=Bn.def(wn,".",Qc,"-",It));var Dn=an;return"height"in Je||(Dn=Bn.def(wn,".",So,"-",Zt)),[It,Zt,Fn,Dn]})}else if(Ie in Wt){var on=Wt[Ie],_n=Er(on,function(Qr,Bn){var wn=Qr.invoke(Bn,on);z.optional(function(){Qr.assert(Bn,wn+"&&typeof "+wn+'==="object"',"invalid "+Ie)});var Fn=Qr.shared.context,Dn=Bn.def(wn,".x|0"),kn=Bn.def(wn,".y|0"),ci=Bn.def('"width" in ',wn,"?",wn,".width|0:","(",Fn,".",Qc,"-",Dn,")"),ka=Bn.def('"height" in ',wn,"?",wn,".height|0:","(",Fn,".",So,"-",kn,")");return z.optional(function(){Qr.assert(Bn,ci+">=0&&"+ka+">=0","invalid "+Ie)}),[Dn,kn,ci,ka]});return xe&&(_n.thisDep=_n.thisDep||xe.thisDep,_n.contextDep=_n.contextDep||xe.contextDep,_n.propDep=_n.propDep||xe.propDep),_n}else return xe?new Sa(xe.thisDep,xe.contextDep,xe.propDep,function(Qr,Bn){var wn=Qr.shared.context;return[0,0,Bn.def(wn,".",Qc),Bn.def(wn,".",So)]}):null}var We=ut(ru);if(We){var _t=We;We=new Sa(We.thisDep,We.contextDep,We.propDep,function(Ie,Je){var Oe=_t.append(Ie,Je),It=Ie.shared.context;return Je.set(It,"."+sl,Oe[2]),Je.set(It,"."+Jc,Oe[3]),Oe})}return{viewport:We,scissor_box:ut(Qf)}}function wi(De,xe){var tt=De.static,At=typeof tt[Cf]=="string"&&typeof tt[ec]=="string";if(At){if(Object.keys(xe.dynamic).length>0)return null;var Wt=xe.static,ut=Object.keys(Wt);if(ut.length>0&&typeof Wt[ut[0]]=="number"){for(var We=[],_t=0;_t<ut.length;++_t)z(typeof Wt[ut[_t]]=="number","must specify all vertex attribute locations when using vaos"),We.push([Wt[ut[_t]]|0,ut[_t]]);return We}}return null}function Ui(De,xe,tt){var At=De.static,Wt=De.dynamic;function ut(Oe){if(Oe in At){var It=we.id(At[Oe]);z.optional(function(){Gr.shader(iu[Oe],It,z.guessCommand())});var Zt=Zo(function(){return It});return Zt.id=It,Zt}else if(Oe in Wt){var wr=Wt[Oe];return Er(wr,function(an,on){var _n=an.invoke(on,wr),Qr=on.def(an.shared.strings,".id(",_n,")");return z.optional(function(){on(an.shared.shader,".shader(",iu[Oe],",",Qr,",",an.command,");")}),Qr})}return null}var We=ut(Cf),_t=ut(ec),Ie=null,Je;return Cc(We)&&Cc(_t)?(Ie=Gr.program(_t.id,We.id,null,tt),Je=Zo(function(Oe,It){return Oe.link(Ie)})):Je=new Sa(We&&We.thisDep||_t&&_t.thisDep,We&&We.contextDep||_t&&_t.contextDep,We&&We.propDep||_t&&_t.propDep,function(Oe,It){var Zt=Oe.shared.shader,wr;We?wr=We.append(Oe,It):wr=It.def(Zt,".",Cf);var an;_t?an=_t.append(Oe,It):an=It.def(Zt,".",ec);var on=Zt+".program("+an+","+wr;return z.optional(function(){on+=","+Oe.command}),It.def(on+")")}),{frag:We,vert:_t,progVar:Je,program:Ie}}function no(De,xe){var tt=De.static,At=De.dynamic,Wt={},ut=!1;function We(){if(Hs in tt){var Bn=tt[Hs];return Bn!==null&&Nr.getVAO(Bn)===null&&(Bn=Nr.createVAO(Bn)),ut=!0,Wt.vao=Bn,Zo(function(Fn){var Dn=Nr.getVAO(Bn);return Dn?Fn.link(Dn):"null"})}else if(Hs in At){ut=!0;var wn=At[Hs];return Er(wn,function(Fn,Dn){var kn=Fn.invoke(Dn,wn);return Dn.def(Fn.shared.vao+".getVAO("+kn+")")})}return null}var _t=We(),Ie=!1;function Je(){if(nu in tt){var Bn=tt[nu];if(Wt.elements=Bn,Fh(Bn)){var wn=Wt.elements=$t.create(Bn,!0);Bn=$t.getElements(wn),Ie=!0}else Bn&&(Bn=$t.getElements(Bn),Ie=!0,z.command(Bn,"invalid elements",xe.commandStr));var Fn=Zo(function(kn,ci){if(Bn){var ka=kn.link(Bn);return kn.ELEMENTS=ka,ka}return kn.ELEMENTS=null,null});return Fn.value=Bn,Fn}else if(nu in At){Ie=!0;var Dn=At[nu];return Er(Dn,function(kn,ci){var ka=kn.shared,ds=ka.isBufferArgs,ja=ka.elements,pa=kn.invoke(ci,Dn),$u=ci.def("null"),Ts=ci.def(ds,"(",pa,")"),ku=kn.cond(Ts).then($u,"=",ja,".createStream(",pa,");").else($u,"=",ja,".getElements(",pa,");");return z.optional(function(){kn.assert(ku.else,"!"+pa+"||"+$u,"invalid elements")}),ci.entry(ku),ci.exit(kn.cond(Ts).then(ja,".destroyStream(",$u,");")),kn.ELEMENTS=$u,$u})}else if(ut)return new Sa(_t.thisDep,_t.contextDep,_t.propDep,function(kn,ci){return ci.def(kn.shared.vao+".currentVAO?"+kn.shared.elements+".getElements("+kn.shared.vao+".currentVAO.elements):null")});return null}var Oe=Je();function It(){if(Lo in tt){var Bn=tt[Lo];return Wt.primitive=Bn,z.commandParameter(Bn,yr,"invalid primitve",xe.commandStr),Zo(function(Fn,Dn){return yr[Bn]})}else if(Lo in At){var wn=At[Lo];return Er(wn,function(Fn,Dn){var kn=Fn.constants.primTypes,ci=Fn.invoke(Dn,wn);return z.optional(function(){Fn.assert(Dn,ci+" in "+kn,"invalid primitive, must be one of "+Object.keys(yr))}),Dn.def(kn,"[",ci,"]")})}else{if(Ie)return Cc(Oe)?Oe.value?Zo(function(Fn,Dn){return Dn.def(Fn.ELEMENTS,".primType")}):Zo(function(){return ah}):new Sa(Oe.thisDep,Oe.contextDep,Oe.propDep,function(Fn,Dn){var kn=Fn.ELEMENTS;return Dn.def(kn,"?",kn,".primType:",ah)});if(ut)return new Sa(_t.thisDep,_t.contextDep,_t.propDep,function(Fn,Dn){return Dn.def(Fn.shared.vao+".currentVAO?"+Fn.shared.vao+".currentVAO.primitive:"+ah)})}return null}function Zt(Bn,wn){if(Bn in tt){var Fn=tt[Bn]|0;return wn?Wt.offset=Fn:Wt.instances=Fn,z.command(!wn||Fn>=0,"invalid "+Bn,xe.commandStr),Zo(function(kn,ci){return wn&&(kn.OFFSET=Fn),Fn})}else if(Bn in At){var Dn=At[Bn];return Er(Dn,function(kn,ci){var ka=kn.invoke(ci,Dn);return wn&&(kn.OFFSET=ka,z.optional(function(){kn.assert(ci,ka+">=0","invalid "+Bn)})),ka})}else if(wn){if(Ie)return Zo(function(kn,ci){return kn.OFFSET=0,0});if(ut)return new Sa(_t.thisDep,_t.contextDep,_t.propDep,function(kn,ci){return ci.def(kn.shared.vao+".currentVAO?"+kn.shared.vao+".currentVAO.offset:0")})}else if(ut)return new Sa(_t.thisDep,_t.contextDep,_t.propDep,function(kn,ci){return ci.def(kn.shared.vao+".currentVAO?"+kn.shared.vao+".currentVAO.instances:-1")});return null}var wr=Zt(Kc,!0);function an(){if(tc in tt){var Bn=tt[tc]|0;return Wt.count=Bn,z.command(typeof Bn=="number"&&Bn>=0,"invalid vertex count",xe.commandStr),Zo(function(){return Bn})}else if(tc in At){var wn=At[tc];return Er(wn,function(ci,ka){var ds=ci.invoke(ka,wn);return z.optional(function(){ci.assert(ka,"typeof "+ds+'==="number"&&'+ds+">=0&&"+ds+"===("+ds+"|0)","invalid vertex count")}),ds})}else if(Ie)if(Cc(Oe)){if(Oe)return wr?new Sa(wr.thisDep,wr.contextDep,wr.propDep,function(ci,ka){var ds=ka.def(ci.ELEMENTS,".vertCount-",ci.OFFSET);return z.optional(function(){ci.assert(ka,ds+">=0","invalid vertex offset/element buffer too small")}),ds}):Zo(function(ci,ka){return ka.def(ci.ELEMENTS,".vertCount")});var Fn=Zo(function(){return-1});return z.optional(function(){Fn.MISSING=!0}),Fn}else{var Dn=new Sa(Oe.thisDep||wr.thisDep,Oe.contextDep||wr.contextDep,Oe.propDep||wr.propDep,function(ci,ka){var ds=ci.ELEMENTS;return ci.OFFSET?ka.def(ds,"?",ds,".vertCount-",ci.OFFSET,":-1"):ka.def(ds,"?",ds,".vertCount:-1")});return z.optional(function(){Dn.DYNAMIC=!0}),Dn}else if(ut){var kn=new Sa(_t.thisDep,_t.contextDep,_t.propDep,function(ci,ka){return ka.def(ci.shared.vao,".currentVAO?",ci.shared.vao,".currentVAO.count:-1")});return kn}return null}var on=It(),_n=an(),Qr=Zt(Th,!1);return{elements:Oe,primitive:on,count:_n,instances:Qr,offset:wr,vao:_t,vaoActive:ut,elementsActive:Ie,static:Wt}}function co(De,xe){var tt=De.static,At=De.dynamic,Wt={};return qn.forEach(function(ut){var We=On(ut);function _t(Ie,Je){if(ut in tt){var Oe=Ie(tt[ut]);Wt[We]=Zo(function(){return Oe})}else if(ut in At){var It=At[ut];Wt[We]=Er(It,function(Zt,wr){return Je(Zt,wr,Zt.invoke(wr,It))})}}switch(ut){case mc:case Eo:case yo:case ua:case wu:case Jl:case Au:case Wu:case ol:case Il:return _t(function(Ie){return z.commandType(Ie,"boolean",ut,xe.commandStr),Ie},function(Ie,Je,Oe){return z.optional(function(){Ie.assert(Je,"typeof "+Oe+'==="boolean"',"invalid flag "+ut,Ie.commandStr)}),Oe});case du:return _t(function(Ie){return z.commandParameter(Ie,rf,"invalid "+ut,xe.commandStr),rf[Ie]},function(Ie,Je,Oe){var It=Ie.constants.compareFuncs;return z.optional(function(){Ie.assert(Je,Oe+" in "+It,"invalid "+ut+", must be one of "+Object.keys(rf))}),Je.def(It,"[",Oe,"]")});case Kl:return _t(function(Ie){return z.command(mo(Ie)&&Ie.length===2&&typeof Ie[0]=="number"&&typeof Ie[1]=="number"&&Ie[0]<=Ie[1],"depth range is 2d array",xe.commandStr),Ie},function(Ie,Je,Oe){z.optional(function(){Ie.assert(Je,Ie.shared.isArrayLike+"("+Oe+")&&"+Oe+".length===2&&typeof "+Oe+'[0]==="number"&&typeof '+Oe+'[1]==="number"&&'+Oe+"[0]<="+Oe+"[1]","depth range must be a 2d array")});var It=Je.def("+",Oe,"[0]"),Zt=Je.def("+",Oe,"[1]");return[It,Zt]});case Ss:return _t(function(Ie){z.commandType(Ie,"object","blend.func",xe.commandStr);var Je="srcRGB"in Ie?Ie.srcRGB:Ie.src,Oe="srcAlpha"in Ie?Ie.srcAlpha:Ie.src,It="dstRGB"in Ie?Ie.dstRGB:Ie.dst,Zt="dstAlpha"in Ie?Ie.dstAlpha:Ie.dst;return z.commandParameter(Je,fl,We+".srcRGB",xe.commandStr),z.commandParameter(Oe,fl,We+".srcAlpha",xe.commandStr),z.commandParameter(It,fl,We+".dstRGB",xe.commandStr),z.commandParameter(Zt,fl,We+".dstAlpha",xe.commandStr),z.command(Lf.indexOf(Je+", "+It)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Je+", "+It+")",xe.commandStr),[fl[Je],fl[It],fl[Oe],fl[Zt]]},function(Ie,Je,Oe){var It=Ie.constants.blendFuncs;z.optional(function(){Ie.assert(Je,Oe+"&&typeof "+Oe+'==="object"',"invalid blend func, must be an object")});function Zt(wn,Fn){var Dn=Je.def('"',wn,Fn,'" in ',Oe,"?",Oe,".",wn,Fn,":",Oe,".",wn);return z.optional(function(){Ie.assert(Je,Dn+" in "+It,"invalid "+ut+"."+wn+Fn+", must be one of "+Object.keys(fl))}),Dn}var wr=Zt("src","RGB"),an=Zt("dst","RGB");z.optional(function(){var wn=Ie.constants.invalidBlendCombinations;Ie.assert(Je,wn+".indexOf("+wr+'+", "+'+an+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var on=Je.def(It,"[",wr,"]"),_n=Je.def(It,"[",Zt("src","Alpha"),"]"),Qr=Je.def(It,"[",an,"]"),Bn=Je.def(It,"[",Zt("dst","Alpha"),"]");return[on,Qr,_n,Bn]});case il:return _t(function(Ie){if(typeof Ie=="string")return z.commandParameter(Ie,rr,"invalid "+ut,xe.commandStr),[rr[Ie],rr[Ie]];if(typeof Ie=="object")return z.commandParameter(Ie.rgb,rr,ut+".rgb",xe.commandStr),z.commandParameter(Ie.alpha,rr,ut+".alpha",xe.commandStr),[rr[Ie.rgb],rr[Ie.alpha]];z.commandRaise("invalid blend.equation",xe.commandStr)},function(Ie,Je,Oe){var It=Ie.constants.blendEquations,Zt=Je.def(),wr=Je.def(),an=Ie.cond("typeof ",Oe,'==="string"');return z.optional(function(){function on(_n,Qr,Bn){Ie.assert(_n,Bn+" in "+It,"invalid "+Qr+", must be one of "+Object.keys(rr))}on(an.then,ut,Oe),Ie.assert(an.else,Oe+"&&typeof "+Oe+'==="object"',"invalid "+ut),on(an.else,ut+".rgb",Oe+".rgb"),on(an.else,ut+".alpha",Oe+".alpha")}),an.then(Zt,"=",wr,"=",It,"[",Oe,"];"),an.else(Zt,"=",It,"[",Oe,".rgb];",wr,"=",It,"[",Oe,".alpha];"),Je(an),[Zt,wr]});case fs:return _t(function(Ie){return z.command(mo(Ie)&&Ie.length===4,"blend.color must be a 4d array",xe.commandStr),et(4,function(Je){return+Ie[Je]})},function(Ie,Je,Oe){return z.optional(function(){Ie.assert(Je,Ie.shared.isArrayLike+"("+Oe+")&&"+Oe+".length===4","blend.color must be a 4d array")}),et(4,function(It){return Je.def("+",Oe,"[",It,"]")})});case Gs:return _t(function(Ie){return z.commandType(Ie,"number",We,xe.commandStr),Ie|0},function(Ie,Je,Oe){return z.optional(function(){Ie.assert(Je,"typeof "+Oe+'==="number"',"invalid stencil.mask")}),Je.def(Oe,"|0")});case Cs:return _t(function(Ie){z.commandType(Ie,"object",We,xe.commandStr);var Je=Ie.cmp||"keep",Oe=Ie.ref||0,It="mask"in Ie?Ie.mask:-1;return z.commandParameter(Je,rf,ut+".cmp",xe.commandStr),z.commandType(Oe,"number",ut+".ref",xe.commandStr),z.commandType(It,"number",ut+".mask",xe.commandStr),[rf[Je],Oe,It]},function(Ie,Je,Oe){var It=Ie.constants.compareFuncs;z.optional(function(){function on(){Ie.assert(Je,Array.prototype.join.call(arguments,""),"invalid stencil.func")}on(Oe+"&&typeof ",Oe,'==="object"'),on('!("cmp" in ',Oe,")||(",Oe,".cmp in ",It,")")});var Zt=Je.def('"cmp" in ',Oe,"?",It,"[",Oe,".cmp]",":",Yu),wr=Je.def(Oe,".ref|0"),an=Je.def('"mask" in ',Oe,"?",Oe,".mask|0:-1");return[Zt,wr,an]});case Xu:case yc:return _t(function(Ie){z.commandType(Ie,"object",We,xe.commandStr);var Je=Ie.fail||"keep",Oe=Ie.zfail||"keep",It=Ie.zpass||"keep";return z.commandParameter(Je,Sc,ut+".fail",xe.commandStr),z.commandParameter(Oe,Sc,ut+".zfail",xe.commandStr),z.commandParameter(It,Sc,ut+".zpass",xe.commandStr),[ut===yc?tf:Mu,Sc[Je],Sc[Oe],Sc[It]]},function(Ie,Je,Oe){var It=Ie.constants.stencilOps;z.optional(function(){Ie.assert(Je,Oe+"&&typeof "+Oe+'==="object"',"invalid "+ut)});function Zt(wr){return z.optional(function(){Ie.assert(Je,'!("'+wr+'" in '+Oe+")||("+Oe+"."+wr+" in "+It+")","invalid "+ut+"."+wr+", must be one of "+Object.keys(Sc))}),Je.def('"',wr,'" in ',Oe,"?",It,"[",Oe,".",wr,"]:",Yu)}return[ut===yc?tf:Mu,Zt("fail"),Zt("zfail"),Zt("zpass")]});case Po:return _t(function(Ie){z.commandType(Ie,"object",We,xe.commandStr);var Je=Ie.factor|0,Oe=Ie.units|0;return z.commandType(Je,"number",We+".factor",xe.commandStr),z.commandType(Oe,"number",We+".units",xe.commandStr),[Je,Oe]},function(Ie,Je,Oe){z.optional(function(){Ie.assert(Je,Oe+"&&typeof "+Oe+'==="object"',"invalid "+ut)});var It=Je.def(Oe,".factor|0"),Zt=Je.def(Oe,".units|0");return[It,Zt]});case gc:return _t(function(Ie){var Je=0;return Ie==="front"?Je=Mu:Ie==="back"&&(Je=tf),z.command(!!Je,We,xe.commandStr),Je},function(Ie,Je,Oe){return z.optional(function(){Ie.assert(Je,Oe+'==="front"||'+Oe+'==="back"',"invalid cull.face")}),Je.def(Oe,'==="front"?',Mu,":",tf)});case Ql:return _t(function(Ie){return z.command(typeof Ie=="number"&&Ie>=Kt.lineWidthDims[0]&&Ie<=Kt.lineWidthDims[1],"invalid line width, must be a positive number between "+Kt.lineWidthDims[0]+" and "+Kt.lineWidthDims[1],xe.commandStr),Ie},function(Ie,Je,Oe){return z.optional(function(){Ie.assert(Je,"typeof "+Oe+'==="number"&&'+Oe+">="+Kt.lineWidthDims[0]+"&&"+Oe+"<="+Kt.lineWidthDims[1],"invalid line width")}),Oe});case vu:return _t(function(Ie){return z.commandParameter(Ie,sh,We,xe.commandStr),sh[Ie]},function(Ie,Je,Oe){return z.optional(function(){Ie.assert(Je,Oe+'==="cw"||'+Oe+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Je.def(Oe+'==="cw"?'+ld+":"+Oh)});case al:return _t(function(Ie){return z.command(mo(Ie)&&Ie.length===4,"color.mask must be length 4 array",xe.commandStr),Ie.map(function(Je){return!!Je})},function(Ie,Je,Oe){return z.optional(function(){Ie.assert(Je,Ie.shared.isArrayLike+"("+Oe+")&&"+Oe+".length===4","invalid color.mask")}),et(4,function(It){return"!!"+Oe+"["+It+"]"})});case mu:return _t(function(Ie){z.command(typeof Ie=="object"&&Ie,We,xe.commandStr);var Je="value"in Ie?Ie.value:1,Oe=!!Ie.invert;return z.command(typeof Je=="number"&&Je>=0&&Je<=1,"sample.coverage.value must be a number between 0 and 1",xe.commandStr),[Je,Oe]},function(Ie,Je,Oe){z.optional(function(){Ie.assert(Je,Oe+"&&typeof "+Oe+'==="object"',"invalid sample.coverage")});var It=Je.def('"value" in ',Oe,"?+",Oe,".value:1"),Zt=Je.def("!!",Oe,".invert");return[It,Zt]})}}),Wt}function ji(De,xe){var tt=De.static,At=De.dynamic,Wt={};return Object.keys(tt).forEach(function(ut){var We=tt[ut],_t;if(typeof We=="number"||typeof We=="boolean")_t=Zo(function(){return We});else if(typeof We=="function"){var Ie=We._reglType;Ie==="texture2d"||Ie==="textureCube"?_t=Zo(function(Je){return Je.link(We)}):Ie==="framebuffer"||Ie==="framebufferCube"?(z.command(We.color.length>0,'missing color attachment for framebuffer sent to uniform "'+ut+'"',xe.commandStr),_t=Zo(function(Je){return Je.link(We.color[0])})):z.commandRaise('invalid data for uniform "'+ut+'"',xe.commandStr)}else mo(We)?_t=Zo(function(Je){var Oe=Je.global.def("[",et(We.length,function(It){return z.command(typeof We[It]=="number"||typeof We[It]=="boolean","invalid uniform "+ut,Je.commandStr),We[It]}),"]");return Oe}):z.commandRaise('invalid or missing data for uniform "'+ut+'"',xe.commandStr);_t.value=We,Wt[ut]=_t}),Object.keys(At).forEach(function(ut){var We=At[ut];Wt[ut]=Er(We,function(_t,Ie){return _t.invoke(Ie,We)})}),Wt}function hs(De,xe){var tt=De.static,At=De.dynamic,Wt={};return Object.keys(tt).forEach(function(ut){var We=tt[ut],_t=we.id(ut),Ie=new Ct;if(Fh(We))Ie.state=ai,Ie.buffer=br.getBuffer(br.create(We,Jf,!1,!0)),Ie.type=0;else{var Je=br.getBuffer(We);if(Je)Ie.state=ai,Ie.buffer=Je,Ie.type=0;else if(z.command(typeof We=="object"&&We,"invalid data for attribute "+ut,xe.commandStr),"constant"in We){var Oe=We.constant;Ie.buffer="null",Ie.state=Ti,typeof Oe=="number"?Ie.x=Oe:(z.command(mo(Oe)&&Oe.length>0&&Oe.length<=4,"invalid constant for attribute "+ut,xe.commandStr),Si.forEach(function(Qr,Bn){Bn<Oe.length&&(Ie[Qr]=Oe[Bn])}))}else{Fh(We.buffer)?Je=br.getBuffer(br.create(We.buffer,Jf,!1,!0)):Je=br.getBuffer(We.buffer),z.command(!!Je,'missing buffer for attribute "'+ut+'"',xe.commandStr);var It=We.offset|0;z.command(It>=0,'invalid offset for attribute "'+ut+'"',xe.commandStr);var Zt=We.stride|0;z.command(Zt>=0&&Zt<256,'invalid stride for attribute "'+ut+'", must be integer betweeen [0, 255]',xe.commandStr);var wr=We.size|0;z.command(!("size"in We)||wr>0&&wr<=4,'invalid size for attribute "'+ut+'", must be 1,2,3,4',xe.commandStr);var an=!!We.normalized,on=0;"type"in We&&(z.commandParameter(We.type,uu,"invalid type for attribute "+ut,xe.commandStr),on=uu[We.type]);var _n=We.divisor|0;z.optional(function(){"divisor"in We&&(z.command(_n===0||zr,'cannot specify divisor for attribute "'+ut+'", instancing not supported',xe.commandStr),z.command(_n>=0,'invalid divisor for attribute "'+ut+'"',xe.commandStr));var Qr=xe.commandStr,Bn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(We).forEach(function(wn){z.command(Bn.indexOf(wn)>=0,'unknown parameter "'+wn+'" for attribute pointer "'+ut+'" (valid parameters are '+Bn+")",Qr)})}),Ie.buffer=Je,Ie.state=ai,Ie.size=wr,Ie.normalized=an,Ie.type=on||Je.dtype,Ie.offset=It,Ie.stride=Zt,Ie.divisor=_n}}Wt[ut]=Zo(function(Qr,Bn){var wn=Qr.attribCache;if(_t in wn)return wn[_t];var Fn={isStream:!1};return Object.keys(Ie).forEach(function(Dn){Fn[Dn]=Ie[Dn]}),Ie.buffer&&(Fn.buffer=Qr.link(Ie.buffer),Fn.type=Fn.type||Fn.buffer+".dtype"),wn[_t]=Fn,Fn})}),Object.keys(At).forEach(function(ut){var We=At[ut];function _t(Ie,Je){var Oe=Ie.invoke(Je,We),It=Ie.shared,Zt=Ie.constants,wr=It.isBufferArgs,an=It.buffer;z.optional(function(){Ie.assert(Je,Oe+"&&(typeof "+Oe+'==="object"||typeof '+Oe+'==="function")&&('+wr+"("+Oe+")||"+an+".getBuffer("+Oe+")||"+an+".getBuffer("+Oe+".buffer)||"+wr+"("+Oe+'.buffer)||("constant" in '+Oe+"&&(typeof "+Oe+'.constant==="number"||'+It.isArrayLike+"("+Oe+".constant))))",'invalid dynamic attribute "'+ut+'"')});var on={isStream:Je.def(!1)},_n=new Ct;_n.state=ai,Object.keys(_n).forEach(function(Fn){on[Fn]=Je.def(""+_n[Fn])});var Qr=on.buffer,Bn=on.type;Je("if(",wr,"(",Oe,")){",on.isStream,"=true;",Qr,"=",an,".createStream(",Jf,",",Oe,");",Bn,"=",Qr,".dtype;","}else{",Qr,"=",an,".getBuffer(",Oe,");","if(",Qr,"){",Bn,"=",Qr,".dtype;",'}else if("constant" in ',Oe,"){",on.state,"=",Ti,";","if(typeof "+Oe+'.constant === "number"){',on[Si[0]],"=",Oe,".constant;",Si.slice(1).map(function(Fn){return on[Fn]}).join("="),"=0;","}else{",Si.map(function(Fn,Dn){return on[Fn]+"="+Oe+".constant.length>"+Dn+"?"+Oe+".constant["+Dn+"]:0;"}).join(""),"}}else{","if(",wr,"(",Oe,".buffer)){",Qr,"=",an,".createStream(",Jf,",",Oe,".buffer);","}else{",Qr,"=",an,".getBuffer(",Oe,".buffer);","}",Bn,'="type" in ',Oe,"?",Zt.glTypes,"[",Oe,".type]:",Qr,".dtype;",on.normalized,"=!!",Oe,".normalized;");function wn(Fn){Je(on[Fn],"=",Oe,".",Fn,"|0;")}return wn("size"),wn("offset"),wn("stride"),wn("divisor"),Je("}}"),Je.exit("if(",on.isStream,"){",an,".destroyStream(",Qr,");","}"),on}Wt[ut]=Er(We,_t)}),Wt}function Va(De){var xe=De.static,tt=De.dynamic,At={};return Object.keys(xe).forEach(function(Wt){var ut=xe[Wt];At[Wt]=Zo(function(We,_t){return typeof ut=="number"||typeof ut=="boolean"?""+ut:We.link(ut)})}),Object.keys(tt).forEach(function(Wt){var ut=tt[Wt];At[Wt]=Er(ut,function(We,_t){return We.invoke(_t,ut)})}),At}function ss(De,xe,tt,At,Wt){var ut=De.static,We=De.dynamic;z.optional(function(){var wn=[gu,ec,Cf,nu,Lo,Kc,tc,Th,_c,Hs].concat(qn);function Fn(Dn){Object.keys(Dn).forEach(function(kn){z.command(wn.indexOf(kn)>=0,'unknown parameter "'+kn+'"',Wt.commandStr)})}Fn(ut),Fn(We)});var _t=wi(De,xe),Ie=En(De,Wt),Je=di(De,Ie,Wt),Oe=no(De,Wt),It=co(De,Wt),Zt=Ui(De,Wt,_t);function wr(wn){var Fn=Je[wn];Fn&&(It[wn]=Fn)}wr(ru),wr(On(Qf));var an=Object.keys(It).length>0,on={framebuffer:Ie,draw:Oe,shader:Zt,state:It,dirty:an,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(on.profile=fn(De,Wt),on.uniforms=ji(tt,Wt),on.drawVAO=on.scopeVAO=Oe.vao,!on.drawVAO&&Zt.program&&!_t&&Xe.angle_instanced_arrays&&Oe.static.elements){var _n=!0,Qr=Zt.program.attributes.map(function(wn){var Fn=xe.static[wn];return _n=_n&&!!Fn,Fn});if(_n&&Qr.length>0){var Bn=Nr.getVAO(Nr.createVAO({attributes:Qr,elements:Oe.static.elements}));on.drawVAO=new Sa(null,null,null,function(wn,Fn){return wn.link(Bn)}),on.useVAO=!0}}return _t?on.useVAO=!0:on.attributes=hs(xe,Wt),on.context=Va(At,Wt),on}function Oo(De,xe,tt){var At=De.shared,Wt=At.context,ut=De.scope();Object.keys(tt).forEach(function(We){xe.save(Wt,"."+We);var _t=tt[We],Ie=_t.append(De,xe);Array.isArray(Ie)?ut(Wt,".",We,"=[",Ie.join(),"];"):ut(Wt,".",We,"=",Ie,";")}),xe(ut)}function Do(De,xe,tt,At){var Wt=De.shared,ut=Wt.gl,We=Wt.framebuffer,_t;rn&&(_t=xe.def(Wt.extensions,".webgl_draw_buffers"));var Ie=De.constants,Je=Ie.drawBuffer,Oe=Ie.backBuffer,It;tt?It=tt.append(De,xe):It=xe.def(We,".next"),At||xe("if(",It,"!==",We,".cur){"),xe("if(",It,"){",ut,".bindFramebuffer(",cd,",",It,".framebuffer);"),rn&&xe(_t,".drawBuffersWEBGL(",Je,"[",It,".colorAttachments.length]);"),xe("}else{",ut,".bindFramebuffer(",cd,",null);"),rn&&xe(_t,".drawBuffersWEBGL(",Oe,");"),xe("}",We,".cur=",It,";"),At||xe("}")}function Fo(De,xe,tt){var At=De.shared,Wt=At.gl,ut=De.current,We=De.next,_t=At.current,Ie=At.next,Je=De.cond(_t,".dirty");qn.forEach(function(Oe){var It=On(Oe);if(!(It in tt.state)){var Zt,wr;if(It in We){Zt=We[It],wr=ut[It];var an=et(Hr[It].length,function(_n){return Je.def(Zt,"[",_n,"]")});Je(De.cond(an.map(function(_n,Qr){return _n+"!=="+wr+"["+Qr+"]"}).join("||")).then(Wt,".",xr[It],"(",an,");",an.map(function(_n,Qr){return wr+"["+Qr+"]="+_n}).join(";"),";"))}else{Zt=Je.def(Ie,".",It);var on=De.cond(Zt,"!==",_t,".",It);Je(on),It in vr?on(De.cond(Zt).then(Wt,".enable(",vr[It],");").else(Wt,".disable(",vr[It],");"),_t,".",It,"=",Zt,";"):on(Wt,".",xr[It],"(",Zt,");",_t,".",It,"=",Zt,";")}}}),Object.keys(tt.state).length===0&&Je(_t,".dirty=false;"),xe(Je)}function As(De,xe,tt,At){var Wt=De.shared,ut=De.current,We=Wt.current,_t=Wt.gl;Sp(Object.keys(tt)).forEach(function(Ie){var Je=tt[Ie];if(!(At&&!At(Je))){var Oe=Je.append(De,xe);if(vr[Ie]){var It=vr[Ie];Cc(Je)?Oe?xe(_t,".enable(",It,");"):xe(_t,".disable(",It,");"):xe(De.cond(Oe).then(_t,".enable(",It,");").else(_t,".disable(",It,");")),xe(We,".",Ie,"=",Oe,";")}else if(mo(Oe)){var Zt=ut[Ie];xe(_t,".",xr[Ie],"(",Oe,");",Oe.map(function(wr,an){return Zt+"["+an+"]="+wr}).join(";"),";")}else xe(_t,".",xr[Ie],"(",Oe,");",We,".",Ie,"=",Oe,";")}})}function _o(De,xe){zr&&(De.instancing=xe.def(De.shared.extensions,".angle_instanced_arrays"))}function Mi(De,xe,tt,At,Wt){var ut=De.shared,We=De.stats,_t=ut.current,Ie=ut.timer,Je=tt.profile;function Oe(){var wn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return wn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var It,Zt;function wr(wn){It=xe.def(),wn(It,"=",Oe(),";"),typeof Wt=="string"?wn(We,".count+=",Wt,";"):wn(We,".count++;"),Fr&&(At?(Zt=xe.def(),wn(Zt,"=",Ie,".getNumPendingQueries();")):wn(Ie,".beginQuery(",We,");"))}function an(wn){wn(We,".cpuTime+=",Oe(),"-",It,";"),Fr&&(At?wn(Ie,".pushScopeStats(",Zt,",",Ie,".getNumPendingQueries(),",We,");"):wn(Ie,".endQuery();"))}function on(wn){var Fn=xe.def(_t,".profile");xe(_t,".profile=",wn,";"),xe.exit(_t,".profile=",Fn,";")}var _n;if(Je){if(Cc(Je)){Je.enable?(wr(xe),an(xe.exit),on("true")):on("false");return}_n=Je.append(De,xe),on(_n)}else _n=xe.def(_t,".profile");var Qr=De.block();wr(Qr),xe("if(",_n,"){",Qr,"}");var Bn=De.block();an(Bn),xe.exit("if(",_n,"){",Bn,"}")}function Jo(De,xe,tt,At,Wt){var ut=De.shared;function We(Ie){switch(Ie){case rc:case Rh:case Ec:return 2;case xc:case bc:case nh:return 3;case Tf:case Mf:case If:return 4;default:return 1}}function _t(Ie,Je,Oe){var It=ut.gl,Zt=xe.def(Ie,".location"),wr=xe.def(ut.attributes,"[",Zt,"]"),an=Oe.state,on=Oe.buffer,_n=[Oe.x,Oe.y,Oe.z,Oe.w],Qr=["buffer","normalized","offset","stride"];function Bn(){xe("if(!",wr,".buffer){",It,".enableVertexAttribArray(",Zt,");}");var Fn=Oe.type,Dn;if(Oe.size?Dn=xe.def(Oe.size,"||",Je):Dn=Je,xe("if(",wr,".type!==",Fn,"||",wr,".size!==",Dn,"||",Qr.map(function(ci){return wr+"."+ci+"!=="+Oe[ci]}).join("||"),"){",It,".bindBuffer(",Jf,",",on,".buffer);",It,".vertexAttribPointer(",[Zt,Dn,Fn,Oe.normalized,Oe.stride,Oe.offset],");",wr,".type=",Fn,";",wr,".size=",Dn,";",Qr.map(function(ci){return wr+"."+ci+"="+Oe[ci]+";"}).join(""),"}"),zr){var kn=Oe.divisor;xe("if(",wr,".divisor!==",kn,"){",De.instancing,".vertexAttribDivisorANGLE(",[Zt,kn],");",wr,".divisor=",kn,";}")}}function wn(){xe("if(",wr,".buffer){",It,".disableVertexAttribArray(",Zt,");",wr,".buffer=null;","}if(",Si.map(function(Fn,Dn){return wr+"."+Fn+"!=="+_n[Dn]}).join("||"),"){",It,".vertexAttrib4f(",Zt,",",_n,");",Si.map(function(Fn,Dn){return wr+"."+Fn+"="+_n[Dn]+";"}).join(""),"}")}an===ai?Bn():an===Ti?wn():(xe("if(",an,"===",ai,"){"),Bn(),xe("}else{"),wn(),xe("}"))}At.forEach(function(Ie){var Je=Ie.name,Oe=tt.attributes[Je],It;if(Oe){if(!Wt(Oe))return;It=Oe.append(De,xe)}else{if(!Wt(nc))return;var Zt=De.scopeAttrib(Je);z.optional(function(){De.assert(xe,Zt+".state","missing attribute "+Je)}),It={},Object.keys(new Ct).forEach(function(wr){It[wr]=xe.def(Zt,".",wr)})}_t(De.link(Ie),We(Ie.info.type),It)})}function la(De,xe,tt,At,Wt,ut){for(var We=De.shared,_t=We.gl,Ie,Je=0;Je<At.length;++Je){var Oe=At[Je],It=Oe.name,Zt=Oe.info.type,wr=tt.uniforms[It],an=De.link(Oe),on=an+".location",_n;if(wr){if(!Wt(wr))continue;if(Cc(wr)){var Qr=wr.value;if(z.command(Qr!==null&&typeof Qr!="undefined",'missing uniform "'+It+'"',De.commandStr),Zt===ih||Zt===kf){z.command(typeof Qr=="function"&&(Zt===ih&&(Qr._reglType==="texture2d"||Qr._reglType==="framebuffer")||Zt===kf&&(Qr._reglType==="textureCube"||Qr._reglType==="framebufferCube")),"invalid texture for uniform "+It,De.commandStr);var Bn=De.link(Qr._texture||Qr.color[0]._texture);xe(_t,".uniform1i(",on,",",Bn+".bind());"),xe.exit(Bn,".unbind();")}else if(Zt===ws||Zt===kl||Zt===Ns){z.optional(function(){z.command(mo(Qr),"invalid matrix for uniform "+It,De.commandStr),z.command(Zt===ws&&Qr.length===4||Zt===kl&&Qr.length===9||Zt===Ns&&Qr.length===16,"invalid length for matrix uniform "+It,De.commandStr)});var wn=De.global.def("new Float32Array(["+Array.prototype.slice.call(Qr)+"])"),Fn=2;Zt===kl?Fn=3:Zt===Ns&&(Fn=4),xe(_t,".uniformMatrix",Fn,"fv(",on,",false,",wn,");")}else{switch(Zt){case Lh:z.commandType(Qr,"number","uniform "+It,De.commandStr),Ie="1f";break;case rc:z.command(mo(Qr)&&Qr.length===2,"uniform "+It,De.commandStr),Ie="2f";break;case xc:z.command(mo(Qr)&&Qr.length===3,"uniform "+It,De.commandStr),Ie="3f";break;case Tf:z.command(mo(Qr)&&Qr.length===4,"uniform "+It,De.commandStr),Ie="4f";break;case ll:z.commandType(Qr,"boolean","uniform "+It,De.commandStr),Ie="1i";break;case rh:z.commandType(Qr,"number","uniform "+It,De.commandStr),Ie="1i";break;case Ec:z.command(mo(Qr)&&Qr.length===2,"uniform "+It,De.commandStr),Ie="2i";break;case Rh:z.command(mo(Qr)&&Qr.length===2,"uniform "+It,De.commandStr),Ie="2i";break;case nh:z.command(mo(Qr)&&Qr.length===3,"uniform "+It,De.commandStr),Ie="3i";break;case bc:z.command(mo(Qr)&&Qr.length===3,"uniform "+It,De.commandStr),Ie="3i";break;case If:z.command(mo(Qr)&&Qr.length===4,"uniform "+It,De.commandStr),Ie="4i";break;case Mf:z.command(mo(Qr)&&Qr.length===4,"uniform "+It,De.commandStr),Ie="4i";break}xe(_t,".uniform",Ie,"(",on,",",mo(Qr)?Array.prototype.slice.call(Qr):Qr,");")}continue}else _n=wr.append(De,xe)}else{if(!Wt(nc))continue;_n=xe.def(We.uniforms,"[",we.id(It),"]")}Zt===ih?(z(!Array.isArray(_n),"must specify a scalar prop for textures"),xe("if(",_n,"&&",_n,'._reglType==="framebuffer"){',_n,"=",_n,".color[0];","}")):Zt===kf&&(z(!Array.isArray(_n),"must specify a scalar prop for cube maps"),xe("if(",_n,"&&",_n,'._reglType==="framebufferCube"){',_n,"=",_n,".color[0];","}")),z.optional(function(){function Ts(ou,hl){De.assert(xe,ou,'bad data or missing for uniform "'+It+'".  '+hl)}function ku(ou){z(!Array.isArray(_n),"must not specify an array type for uniform"),Ts("typeof "+_n+'==="'+ou+'"',"invalid type, expected "+ou)}function au(ou,hl){Array.isArray(_n)?z(_n.length===ou,"must have length "+ou):Ts(We.isArrayLike+"("+_n+")&&"+_n+".length==="+ou,"invalid vector, should have length "+ou,De.commandStr)}function uh(ou){z(!Array.isArray(_n),"must not specify a value type"),Ts("typeof "+_n+'==="function"&&'+_n+'._reglType==="texture'+(ou===gp?"2d":"Cube")+'"',"invalid texture type",De.commandStr)}switch(Zt){case rh:ku("number");break;case Rh:au(2,"number");break;case bc:au(3,"number");break;case Mf:au(4,"number");break;case Lh:ku("number");break;case rc:au(2,"number");break;case xc:au(3,"number");break;case Tf:au(4,"number");break;case ll:ku("boolean");break;case Ec:au(2,"boolean");break;case nh:au(3,"boolean");break;case If:au(4,"boolean");break;case ws:au(4,"number");break;case kl:au(9,"number");break;case Ns:au(16,"number");break;case ih:uh(gp);break;case kf:uh(yp);break}});var Dn=1;switch(Zt){case ih:case kf:var kn=xe.def(_n,"._texture");xe(_t,".uniform1i(",on,",",kn,".bind());"),xe.exit(kn,".unbind();");continue;case rh:case ll:Ie="1i";break;case Rh:case Ec:Ie="2i",Dn=2;break;case bc:case nh:Ie="3i",Dn=3;break;case Mf:case If:Ie="4i",Dn=4;break;case Lh:Ie="1f";break;case rc:Ie="2f",Dn=2;break;case xc:Ie="3f",Dn=3;break;case Tf:Ie="4f",Dn=4;break;case ws:Ie="Matrix2fv";break;case kl:Ie="Matrix3fv";break;case Ns:Ie="Matrix4fv";break}if(Ie.charAt(0)==="M"){xe(_t,".uniform",Ie,"(",on,",");var ci=Math.pow(Zt-ws+2,2),ka=De.global.def("new Float32Array(",ci,")");Array.isArray(_n)?xe("false,(",et(ci,function(Ts){return ka+"["+Ts+"]="+_n[Ts]}),",",ka,")"):xe("false,(Array.isArray(",_n,")||",_n," instanceof Float32Array)?",_n,":(",et(ci,function(Ts){return ka+"["+Ts+"]="+_n+"["+Ts+"]"}),",",ka,")"),xe(");")}else if(Dn>1){for(var ds=[],ja=[],pa=0;pa<Dn;++pa)Array.isArray(_n)?ja.push(_n[pa]):ja.push(xe.def(_n+"["+pa+"]")),ut&&ds.push(xe.def());ut&&xe("if(!",De.batchId,"||",ds.map(function(Ts,ku){return Ts+"!=="+ja[ku]}).join("||"),"){",ds.map(function(Ts,ku){return Ts+"="+ja[ku]+";"}).join("")),xe(_t,".uniform",Ie,"(",on,",",ja.join(","),");"),ut&&xe("}")}else{if(z(!Array.isArray(_n),"uniform value must not be an array"),ut){var $u=xe.def();xe("if(!",De.batchId,"||",$u,"!==",_n,"){",$u,"=",_n,";")}xe(_t,".uniform",Ie,"(",on,",",_n,");"),ut&&xe("}")}}}function ps(De,xe,tt,At){var Wt=De.shared,ut=Wt.gl,We=Wt.draw,_t=At.draw;function Ie(){var Dn=_t.elements,kn,ci=xe;return Dn?((Dn.contextDep&&At.contextDynamic||Dn.propDep)&&(ci=tt),kn=Dn.append(De,ci),_t.elementsActive&&ci("if("+kn+")"+ut+".bindBuffer("+vp+","+kn+".buffer.buffer);")):(kn=ci.def(),ci(kn,"=",We,".",nu,";","if(",kn,"){",ut,".bindBuffer(",vp,",",kn,".buffer.buffer);}","else if(",Wt.vao,".currentVAO){",kn,"=",De.shared.elements+".getElements("+Wt.vao,".currentVAO.elements);",Cr?"":"if("+kn+")"+ut+".bindBuffer("+vp+","+kn+".buffer.buffer);","}")),kn}function Je(){var Dn=_t.count,kn,ci=xe;return Dn?((Dn.contextDep&&At.contextDynamic||Dn.propDep)&&(ci=tt),kn=Dn.append(De,ci),z.optional(function(){Dn.MISSING&&De.assert(xe,"false","missing vertex count"),Dn.DYNAMIC&&De.assert(ci,kn+">=0","missing vertex count")})):(kn=ci.def(We,".",tc),z.optional(function(){De.assert(ci,kn+">=0","missing vertex count")})),kn}var Oe=Ie();function It(Dn){var kn=_t[Dn];return kn?kn.contextDep&&At.contextDynamic||kn.propDep?kn.append(De,tt):kn.append(De,xe):xe.def(We,".",Dn)}var Zt=It(Lo),wr=It(Kc),an=Je();if(typeof an=="number"){if(an===0)return}else tt("if(",an,"){"),tt.exit("}");var on,_n;zr&&(on=It(Th),_n=De.instancing);var Qr=Oe+".type",Bn=_t.elements&&Cc(_t.elements)&&!_t.vaoActive;function wn(){function Dn(){tt(_n,".drawElementsInstancedANGLE(",[Zt,an,Qr,wr+"<<(("+Qr+"-"+mi+")>>1)",on],");")}function kn(){tt(_n,".drawArraysInstancedANGLE(",[Zt,wr,an,on],");")}Oe&&Oe!=="null"?Bn?Dn():(tt("if(",Oe,"){"),Dn(),tt("}else{"),kn(),tt("}")):kn()}function Fn(){function Dn(){tt(ut+".drawElements("+[Zt,an,Qr,wr+"<<(("+Qr+"-"+mi+")>>1)"]+");")}function kn(){tt(ut+".drawArrays("+[Zt,wr,an]+");")}Oe&&Oe!=="null"?Bn?Dn():(tt("if(",Oe,"){"),Dn(),tt("}else{"),kn(),tt("}")):kn()}zr&&(typeof on!="number"||on>=0)?typeof on=="string"?(tt("if(",on,">0){"),wn(),tt("}else if(",on,"<0){"),Fn(),tt("}")):wn():Fn()}function _i(De,xe,tt,At,Wt){var ut=gi(),We=ut.proc("body",Wt);return z.optional(function(){ut.commandStr=xe.commandStr,ut.command=ut.link(xe.commandStr)}),zr&&(ut.instancing=We.def(ut.shared.extensions,".angle_instanced_arrays")),De(ut,We,tt,At),ut.compile().body}function Gi(De,xe,tt,At){_o(De,xe),tt.useVAO?tt.drawVAO?xe(De.shared.vao,".setVAO(",tt.drawVAO.append(De,xe),");"):xe(De.shared.vao,".setVAO(",De.shared.vao,".targetVAO);"):(xe(De.shared.vao,".setVAO(null);"),Jo(De,xe,tt,At.attributes,function(){return!0})),la(De,xe,tt,At.uniforms,function(){return!0},!1),ps(De,xe,xe,tt)}function ma(De,xe){var tt=De.proc("draw",1);_o(De,tt),Oo(De,tt,xe.context),Do(De,tt,xe.framebuffer),Fo(De,tt,xe),As(De,tt,xe.state),Mi(De,tt,xe,!1,!0);var At=xe.shader.progVar.append(De,tt);if(tt(De.shared.gl,".useProgram(",At,".program);"),xe.shader.program)Gi(De,tt,xe,xe.shader.program);else{tt(De.shared.vao,".setVAO(null);");var Wt=De.global.def("{}"),ut=tt.def(At,".id"),We=tt.def(Wt,"[",ut,"]");tt(De.cond(We).then(We,".call(this,a0);").else(We,"=",Wt,"[",ut,"]=",De.link(function(_t){return _i(Gi,De,xe,_t,1)}),"(",At,");",We,".call(this,a0);"))}Object.keys(xe.state).length>0&&tt(De.shared.current,".dirty=true;"),De.shared.vao&&tt(De.shared.vao,".setVAO(null);")}function Bo(De,xe,tt,At){De.batchId="a1",_o(De,xe);function Wt(){return!0}Jo(De,xe,tt,At.attributes,Wt),la(De,xe,tt,At.uniforms,Wt,!1),ps(De,xe,xe,tt)}function Iu(De,xe,tt,At){_o(De,xe);var Wt=tt.contextDep,ut=xe.def(),We="a0",_t="a1",Ie=xe.def();De.shared.props=Ie,De.batchId=ut;var Je=De.scope(),Oe=De.scope();xe(Je.entry,"for(",ut,"=0;",ut,"<",_t,";++",ut,"){",Ie,"=",We,"[",ut,"];",Oe,"}",Je.exit);function It(Qr){return Qr.contextDep&&Wt||Qr.propDep}function Zt(Qr){return!It(Qr)}if(tt.needsContext&&Oo(De,Oe,tt.context),tt.needsFramebuffer&&Do(De,Oe,tt.framebuffer),As(De,Oe,tt.state,It),tt.profile&&It(tt.profile)&&Mi(De,Oe,tt,!1,!0),At)tt.useVAO?tt.drawVAO?It(tt.drawVAO)?Oe(De.shared.vao,".setVAO(",tt.drawVAO.append(De,Oe),");"):Je(De.shared.vao,".setVAO(",tt.drawVAO.append(De,Je),");"):Je(De.shared.vao,".setVAO(",De.shared.vao,".targetVAO);"):(Je(De.shared.vao,".setVAO(null);"),Jo(De,Je,tt,At.attributes,Zt),Jo(De,Oe,tt,At.attributes,It)),la(De,Je,tt,At.uniforms,Zt,!1),la(De,Oe,tt,At.uniforms,It,!0),ps(De,Je,Oe,tt);else{var wr=De.global.def("{}"),an=tt.shader.progVar.append(De,Oe),on=Oe.def(an,".id"),_n=Oe.def(wr,"[",on,"]");Oe(De.shared.gl,".useProgram(",an,".program);","if(!",_n,"){",_n,"=",wr,"[",on,"]=",De.link(function(Qr){return _i(Bo,De,tt,Qr,2)}),"(",an,");}",_n,".call(this,a0[",ut,"],",ut,");")}}function Ne(De,xe){var tt=De.proc("batch",2);De.batchId="0",_o(De,tt);var At=!1,Wt=!0;Object.keys(xe.context).forEach(function(wr){At=At||xe.context[wr].propDep}),At||(Oo(De,tt,xe.context),Wt=!1);var ut=xe.framebuffer,We=!1;ut?(ut.propDep?At=We=!0:ut.contextDep&&At&&(We=!0),We||Do(De,tt,ut)):Do(De,tt,null),xe.state.viewport&&xe.state.viewport.propDep&&(At=!0);function _t(wr){return wr.contextDep&&At||wr.propDep}Fo(De,tt,xe),As(De,tt,xe.state,function(wr){return!_t(wr)}),(!xe.profile||!_t(xe.profile))&&Mi(De,tt,xe,!1,"a1"),xe.contextDep=At,xe.needsContext=Wt,xe.needsFramebuffer=We;var Ie=xe.shader.progVar;if(Ie.contextDep&&At||Ie.propDep)Iu(De,tt,xe,null);else{var Je=Ie.append(De,tt);if(tt(De.shared.gl,".useProgram(",Je,".program);"),xe.shader.program)Iu(De,tt,xe,xe.shader.program);else{tt(De.shared.vao,".setVAO(null);");var Oe=De.global.def("{}"),It=tt.def(Je,".id"),Zt=tt.def(Oe,"[",It,"]");tt(De.cond(Zt).then(Zt,".call(this,a0,a1);").else(Zt,"=",Oe,"[",It,"]=",De.link(function(wr){return _i(Iu,De,xe,wr,2)}),"(",Je,");",Zt,".call(this,a0,a1);"))}}Object.keys(xe.state).length>0&&tt(De.shared.current,".dirty=true;"),De.shared.vao&&tt(De.shared.vao,".setVAO(null);")}function tr(De,xe){var tt=De.proc("scope",3);De.batchId="a2";var At=De.shared,Wt=At.current;Oo(De,tt,xe.context),xe.framebuffer&&xe.framebuffer.append(De,tt),Sp(Object.keys(xe.state)).forEach(function(We){var _t=xe.state[We],Ie=_t.append(De,tt);mo(Ie)?Ie.forEach(function(Je,Oe){tt.set(De.next[We],"["+Oe+"]",Je)}):tt.set(At.next,"."+We,Ie)}),Mi(De,tt,xe,!0,!0),[nu,Kc,tc,Th,Lo].forEach(function(We){var _t=xe.draw[We];!_t||tt.set(At.draw,"."+We,""+_t.append(De,tt))}),Object.keys(xe.uniforms).forEach(function(We){var _t=xe.uniforms[We].append(De,tt);Array.isArray(_t)&&(_t="["+_t.join()+"]"),tt.set(At.uniforms,"["+we.id(We)+"]",_t)}),Object.keys(xe.attributes).forEach(function(We){var _t=xe.attributes[We].append(De,tt),Ie=De.scopeAttrib(We);Object.keys(new Ct).forEach(function(Je){tt.set(Ie,"."+Je,_t[Je])})}),xe.scopeVAO&&tt.set(At.vao,".targetVAO",xe.scopeVAO.append(De,tt));function ut(We){var _t=xe.shader[We];_t&&tt.set(At.shader,"."+We,_t.append(De,tt))}ut(ec),ut(Cf),Object.keys(xe.state).length>0&&(tt(Wt,".dirty=true;"),tt.exit(Wt,".dirty=true;")),tt("a1(",De.shared.context,",a0,",De.batchId,");")}function zt(De){if(!(typeof De!="object"||mo(De))){for(var xe=Object.keys(De),tt=0;tt<xe.length;++tt)if(en.isDynamic(De[xe[tt]]))return!0;return!1}}function Tn(De,xe,tt){var At=xe.static[tt];if(!At||!zt(At))return;var Wt=De.global,ut=Object.keys(At),We=!1,_t=!1,Ie=!1,Je=De.global.def("{}");ut.forEach(function(It){var Zt=At[It];if(en.isDynamic(Zt)){typeof Zt=="function"&&(Zt=At[It]=en.unbox(Zt));var wr=Er(Zt,null);We=We||wr.thisDep,Ie=Ie||wr.propDep,_t=_t||wr.contextDep}else{switch(Wt(Je,".",It,"="),typeof Zt){case"number":Wt(Zt);break;case"string":Wt('"',Zt,'"');break;case"object":Array.isArray(Zt)&&Wt("[",Zt.join(),"]");break;default:Wt(De.link(Zt));break}Wt(";")}});function Oe(It,Zt){ut.forEach(function(wr){var an=At[wr];if(!!en.isDynamic(an)){var on=It.invoke(Zt,an);Zt(Je,".",wr,"=",on,";")}})}xe.dynamic[tt]=new en.DynamicVariable(Ko,{thisDep:We,contextDep:_t,propDep:Ie,ref:Je,append:Oe}),delete xe.static[tt]}function Zi(De,xe,tt,At,Wt){var ut=gi();ut.stats=ut.link(Wt),Object.keys(xe.static).forEach(function(_t){Tn(ut,xe,_t)}),dp.forEach(function(_t){Tn(ut,De,_t)});var We=ss(De,xe,tt,At,ut);return ma(ut,We),tr(ut,We),Ne(ut,We),y(ut.compile(),{destroy:function(){We.shader.program.destroy()}})}return{next:vn,current:Hr,procs:function(){var De=gi(),xe=De.proc("poll"),tt=De.proc("refresh"),At=De.block();xe(At),tt(At);var Wt=De.shared,ut=Wt.gl,We=Wt.next,_t=Wt.current;At(_t,".dirty=false;"),Do(De,xe),Do(De,tt,null,!0);var Ie;zr&&(Ie=De.link(zr)),Xe.oes_vertex_array_object&&tt(De.link(Xe.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Je=0;Je<Kt.maxAttributes;++Je){var Oe=tt.def(Wt.attributes,"[",Je,"]"),It=De.cond(Oe,".buffer");It.then(ut,".enableVertexAttribArray(",Je,");",ut,".bindBuffer(",Jf,",",Oe,".buffer.buffer);",ut,".vertexAttribPointer(",Je,",",Oe,".size,",Oe,".type,",Oe,".normalized,",Oe,".stride,",Oe,".offset);").else(ut,".disableVertexAttribArray(",Je,");",ut,".vertexAttrib4f(",Je,",",Oe,".x,",Oe,".y,",Oe,".z,",Oe,".w);",Oe,".buffer=null;"),tt(It),zr&&tt(Ie,".vertexAttribDivisorANGLE(",Je,",",Oe,".divisor);")}return tt(De.shared.vao,".currentVAO=null;",De.shared.vao,".setVAO(",De.shared.vao,".targetVAO);"),Object.keys(vr).forEach(function(Zt){var wr=vr[Zt],an=At.def(We,".",Zt),on=De.block();on("if(",an,"){",ut,".enable(",wr,")}else{",ut,".disable(",wr,")}",_t,".",Zt,"=",an,";"),tt(on),xe("if(",an,"!==",_t,".",Zt,"){",on,"}")}),Object.keys(xr).forEach(function(Zt){var wr=xr[Zt],an=Hr[Zt],on,_n,Qr=De.block();if(Qr(ut,".",wr,"("),mo(an)){var Bn=an.length;on=De.global.def(We,".",Zt),_n=De.global.def(_t,".",Zt),Qr(et(Bn,function(wn){return on+"["+wn+"]"}),");",et(Bn,function(wn){return _n+"["+wn+"]="+on+"["+wn+"];"}).join("")),xe("if(",et(Bn,function(wn){return on+"["+wn+"]!=="+_n+"["+wn+"]"}).join("||"),"){",Qr,"}")}else on=At.def(We,".",Zt),_n=At.def(_t,".",Zt),Qr(on,");",_t,".",Zt,"=",on,";"),xe("if(",on,"!==",_n,"){",Qr,"}");tt(Qr)}),De.compile()}(),compile:Zi}}function hd(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var qd=34918,Kd=34919,Cp=35007,pd=function(Z,we){if(!we.ext_disjoint_timer_query)return null;var Xe=[];function Kt(){return Xe.pop()||we.ext_disjoint_timer_query.createQueryEXT()}function br(zr){Xe.push(zr)}var $t=[];function mr(zr){var rn=Kt();we.ext_disjoint_timer_query.beginQueryEXT(Cp,rn),$t.push(rn),Fr($t.length-1,$t.length,zr)}function Ar(){we.ext_disjoint_timer_query.endQueryEXT(Cp)}function Rr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Nr=[];function Gr(){return Nr.pop()||new Rr}function Wr(zr){Nr.push(zr)}var un=[];function Fr(zr,rn,Cr){var Hr=Gr();Hr.startQueryIndex=zr,Hr.endQueryIndex=rn,Hr.sum=0,Hr.stats=Cr,un.push(Hr)}var Vr=[],Ct=[];function rr(){var zr,rn,Cr=$t.length;if(Cr!==0){Ct.length=Math.max(Ct.length,Cr+1),Vr.length=Math.max(Vr.length,Cr+1),Vr[0]=0,Ct[0]=0;var Hr=0;for(zr=0,rn=0;rn<$t.length;++rn){var vn=$t[rn];we.ext_disjoint_timer_query.getQueryObjectEXT(vn,Kd)?(Hr+=we.ext_disjoint_timer_query.getQueryObjectEXT(vn,qd),br(vn)):$t[zr++]=vn,Vr[rn+1]=Hr,Ct[rn+1]=zr}for($t.length=zr,zr=0,rn=0;rn<un.length;++rn){var qn=un[rn],vr=qn.startQueryIndex,xr=qn.endQueryIndex;qn.sum+=Vr[xr]-Vr[vr];var On=Ct[vr],Kr=Ct[xr];Kr===On?(qn.stats.gpuTime+=qn.sum/1e6,Wr(qn)):(qn.startQueryIndex=On,qn.endQueryIndex=Kr,un[zr++]=qn)}un.length=zr}}return{beginQuery:mr,endQuery:Ar,pushScopeStats:Fr,update:rr,getNumPendingQueries:function(){return $t.length},clear:function(){Xe.push.apply(Xe,$t);for(var zr=0;zr<Xe.length;zr++)we.ext_disjoint_timer_query.deleteQueryEXT(Xe[zr]);$t.length=0,Xe.length=0},restore:function(){$t.length=0,Xe.length=0}}},Lv=16384,wc=256,dd=1024,wp=34962,Rf="webglcontextlost",Za="webglcontextrestored",Ap=1,Pl=2,Of=3;function Tp(Z,we){for(var Xe=0;Xe<Z.length;++Xe)if(Z[Xe]===we)return Xe;return-1}function Rv(Z){var we=Ce(Z);if(!we)return null;var Xe=we.gl,Kt=Xe.getContextAttributes(),br=Xe.isContextLost(),$t=Ze(Xe,we);if(!$t)return null;var mr=Aa(),Ar=hd(),Rr=$t.extensions,Nr=pd(Xe,Rr),Gr=ra(),Wr=Xe.drawingBufferWidth,un=Xe.drawingBufferHeight,Fr={tick:0,time:0,viewportWidth:Wr,viewportHeight:un,framebufferWidth:Wr,framebufferHeight:un,drawingBufferWidth:Wr,drawingBufferHeight:un,pixelRatio:we.pixelRatio},Vr={},Ct={elements:null,primitive:4,count:-1,offset:0,instances:-1},rr=Ll(Xe,Rr),zr=U(Xe,Ar,we,Hr),rn=yl(Xe,Rr,zr,Ar),Cr=Dt(Xe,Rr,rr,Ar,zr,rn,Ct);function Hr(_i){return Cr.destroyBuffer(_i)}var vn=tn(Xe,mr,Ar,we),qn=Es(Xe,Rr,rr,function(){On.procs.poll()},Fr,Ar,we),vr=Wl(Xe,Rr,rr,Ar,we),xr=je(Xe,Rr,rr,qn,vr,Ar),On=fd(Xe,mr,Rr,rr,zr,rn,qn,xr,Vr,Cr,vn,Ct,Fr,Nr,we),Kr=ei(Xe,xr,On.procs.poll,Fr,Kt,Rr,rr),Ur=On.next,cn=Xe.canvas,mn=[],Ai=[],gi=[],fn=[we.onDestroy],En=null;function di(){if(mn.length===0){Nr&&Nr.update(),En=null;return}En=pi.next(di),_o();for(var _i=mn.length-1;_i>=0;--_i){var Gi=mn[_i];Gi&&Gi(Fr,null,0)}Xe.flush(),Nr&&Nr.update()}function wi(){!En&&mn.length>0&&(En=pi.next(di))}function Ui(){En&&(pi.cancel(di),En=null)}function no(_i){_i.preventDefault(),br=!0,Ui(),Ai.forEach(function(Gi){Gi()})}function co(_i){Xe.getError(),br=!1,$t.restore(),vn.restore(),zr.restore(),qn.restore(),vr.restore(),xr.restore(),Cr.restore(),Nr&&Nr.restore(),On.procs.refresh(),wi(),gi.forEach(function(Gi){Gi()})}var ji=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!ji&&cn&&(cn.addEventListener(Rf,no,!1),cn.addEventListener(Za,co,!1));function hs(){mn.length=0,Ui(),!ji&&cn&&(cn.removeEventListener(Rf,no),cn.removeEventListener(Za,co)),vn.clear(),xr.clear(),vr.clear(),Cr.clear(),qn.clear(),rn.clear(),zr.clear(),Nr&&Nr.clear(),fn.forEach(function(_i){_i()})}function Va(_i){z(!!_i,"invalid args to regl({...})"),z.type(_i,"object","invalid args to regl({...})");function Gi(ut){var We=y({},ut);delete We.uniforms,delete We.attributes,delete We.context,delete We.vao,"stencil"in We&&We.stencil.op&&(We.stencil.opBack=We.stencil.opFront=We.stencil.op,delete We.stencil.op);function _t(Ie){if(Ie in We){var Je=We[Ie];delete We[Ie],Object.keys(Je).forEach(function(Oe){We[Ie+"."+Oe]=Je[Oe]})}}return _t("blend"),_t("depth"),_t("cull"),_t("stencil"),_t("polygonOffset"),_t("scissor"),_t("sample"),"vao"in ut&&(We.vao=ut.vao),We}function ma(ut,We){var _t={},Ie={};return Object.keys(ut).forEach(function(Je){var Oe=ut[Je];if(en.isDynamic(Oe)){Ie[Je]=en.unbox(Oe,Je);return}else if(We&&Array.isArray(Oe)){for(var It=0;It<Oe.length;++It)if(en.isDynamic(Oe[It])){Ie[Je]=en.unbox(Oe,Je);return}}_t[Je]=Oe}),{dynamic:Ie,static:_t}}var Bo=ma(_i.context||{},!0),Iu=ma(_i.uniforms||{},!0),Ne=ma(_i.attributes||{},!1),tr=ma(Gi(_i),!1),zt={gpuTime:0,cpuTime:0,count:0},Tn=On.compile(tr,Ne,Iu,Bo,zt),Zi=Tn.draw,De=Tn.batch,xe=Tn.scope,tt=[];function At(ut){for(;tt.length<ut;)tt.push(null);return tt}function Wt(ut,We){var _t;if(br&&z.raise("context lost"),typeof ut=="function")return xe.call(this,null,ut,0);if(typeof We=="function")if(typeof ut=="number")for(_t=0;_t<ut;++_t)xe.call(this,null,We,_t);else if(Array.isArray(ut))for(_t=0;_t<ut.length;++_t)xe.call(this,ut[_t],We,_t);else return xe.call(this,ut,We,0);else if(typeof ut=="number"){if(ut>0)return De.call(this,At(ut|0),ut|0)}else if(Array.isArray(ut)){if(ut.length)return De.call(this,ut,ut.length)}else return Zi.call(this,ut)}return y(Wt,{stats:zt,destroy:function(){Tn.destroy()}})}var ss=xr.setFBO=Va({framebuffer:en.define.call(null,Ap,"framebuffer")});function Oo(_i,Gi){var ma=0;On.procs.poll();var Bo=Gi.color;Bo&&(Xe.clearColor(+Bo[0]||0,+Bo[1]||0,+Bo[2]||0,+Bo[3]||0),ma|=Lv),"depth"in Gi&&(Xe.clearDepth(+Gi.depth),ma|=wc),"stencil"in Gi&&(Xe.clearStencil(Gi.stencil|0),ma|=dd),z(!!ma,"called regl.clear with no buffer specified"),Xe.clear(ma)}function Do(_i){if(z(typeof _i=="object"&&_i,"regl.clear() takes an object as input"),"framebuffer"in _i)if(_i.framebuffer&&_i.framebuffer_reglType==="framebufferCube")for(var Gi=0;Gi<6;++Gi)ss(y({framebuffer:_i.framebuffer.faces[Gi]},_i),Oo);else ss(_i,Oo);else Oo(null,_i)}function Fo(_i){z.type(_i,"function","regl.frame() callback must be a function"),mn.push(_i);function Gi(){var ma=Tp(mn,_i);z(ma>=0,"cannot cancel a frame twice");function Bo(){var Iu=Tp(mn,Bo);mn[Iu]=mn[mn.length-1],mn.length-=1,mn.length<=0&&Ui()}mn[ma]=Bo}return wi(),{cancel:Gi}}function As(){var _i=Ur.viewport,Gi=Ur.scissor_box;_i[0]=_i[1]=Gi[0]=Gi[1]=0,Fr.viewportWidth=Fr.framebufferWidth=Fr.drawingBufferWidth=_i[2]=Gi[2]=Xe.drawingBufferWidth,Fr.viewportHeight=Fr.framebufferHeight=Fr.drawingBufferHeight=_i[3]=Gi[3]=Xe.drawingBufferHeight}function _o(){Fr.tick+=1,Fr.time=Jo(),As(),On.procs.poll()}function Mi(){qn.refresh(),As(),On.procs.refresh(),Nr&&Nr.update()}function Jo(){return(ra()-Gr)/1e3}Mi();function la(_i,Gi){z.type(Gi,"function","listener callback must be a function");var ma;switch(_i){case"frame":return Fo(Gi);case"lost":ma=Ai;break;case"restore":ma=gi;break;case"destroy":ma=fn;break;default:z.raise("invalid event, must be one of frame,lost,restore,destroy")}return ma.push(Gi),{cancel:function(){for(var Bo=0;Bo<ma.length;++Bo)if(ma[Bo]===Gi){ma[Bo]=ma[ma.length-1],ma.pop();return}}}}var ps=y(Va,{clear:Do,prop:en.define.bind(null,Ap),context:en.define.bind(null,Pl),this:en.define.bind(null,Of),draw:Va({}),buffer:function(_i){return zr.create(_i,wp,!1,!1)},elements:function(_i){return rn.create(_i,!1)},texture:qn.create2D,cube:qn.createCube,renderbuffer:vr.create,framebuffer:xr.create,framebufferCube:xr.createCube,vao:Cr.createVAO,attributes:Kt,frame:Fo,on:la,limits:rr,hasExtension:function(_i){return rr.extensions.indexOf(_i.toLowerCase())>=0},read:Kr,destroy:hs,_gl:Xe,_refresh:Mi,poll:function(){_o(),Nr&&Nr.update()},now:Jo,stats:Ar});return we.onDone(null,ps),ps}return Rv})},68982:function(nn){nn.exports=ye;function ye(fe,Le){Le||(Le=document);var J=Le.head||Le.getElementsByTagName("head")[0];if(!J){J=Le.createElement("head");var y=Le.body||Le.getElementsByTagName("body")[0];y?y.parentNode.insertBefore(J,y):Le.documentElement.appendChild(J)}var Ae=Le.createElement("style");return Ae.type="text/css",Ae.styleSheet?Ae.styleSheet.cssText=fe:Ae.appendChild(Le.createTextNode(fe)),J.appendChild(Ae),Ae}},6158:function(nn){(function(ye,fe){nn.exports=fe()})(this,function(){"use strict";var ye,fe,Le;function J(y,Ae){if(!ye)ye=Ae;else if(!fe)fe=Ae;else{var T="var sharedChunk = {}; ("+ye+")(sharedChunk); ("+fe+")(sharedChunk);",ce={};ye(ce),Le=Ae(ce),typeof window!="undefined"&&(Le.workerUrl=window.URL.createObjectURL(new Blob([T],{type:"text/javascript"})))}}return J(["exports"],function(y){"use strict";function Ae(a,s){return a(s={exports:{}},s.exports),s.exports}var T=ce;function ce(a,s,l,v){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(v-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=v,this.p2x=l,this.p2y=v}ce.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},ce.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},ce.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},ce.prototype.solveCurveX=function(a,s){var l,v,_,E,w;for(s===void 0&&(s=1e-6),_=a,w=0;w<8;w++){if(E=this.sampleCurveX(_)-a,Math.abs(E)<s)return _;var L=this.sampleCurveDerivativeX(_);if(Math.abs(L)<1e-6)break;_-=E/L}if((_=a)<(l=0))return l;if(_>(v=1))return v;for(;l<v;){if(E=this.sampleCurveX(_),Math.abs(E-a)<s)return _;a>E?l=_:v=_,_=.5*(v-l)+l}return _},ce.prototype.solve=function(a,s){return this.sampleCurveY(this.solveCurveX(a,s))};var pe=Fe;function Fe(a,s){this.x=a,this.y=s}Fe.prototype={clone:function(){return new Fe(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,s){return this.clone()._rotateAround(a,s)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var s=a.x-this.x,l=a.y-this.y;return s*s+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,s){return Math.atan2(this.x*s-this.y*a,this.x*a+this.y*s)},_matMult:function(a){var s=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=s,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var s=Math.cos(a),l=Math.sin(a),v=l*this.x+s*this.y;return this.x=s*this.x-l*this.y,this.y=v,this},_rotateAround:function(a,s){var l=Math.cos(a),v=Math.sin(a),_=s.y+v*(this.x-s.x)+l*(this.y-s.y);return this.x=s.x+l*(this.x-s.x)-v*(this.y-s.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Fe.convert=function(a){return a instanceof Fe?a:Array.isArray(a)?new Fe(a[0],a[1]):a};var _e=typeof self!="undefined"?self:{},Ge=Math.pow(2,53)-1;function ot(a,s,l,v){var _=new T(a,s,l,v);return function(E){return _.solve(E)}}var ft=ot(.25,.1,.25,1);function kt(a,s,l){return Math.min(l,Math.max(s,a))}function ar(a,s,l){var v=l-s,_=((a-s)%v+v)%v+s;return _===s?l:_}function xt(a){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];for(var v=0,_=s;v<_.length;v+=1){var E=_[v];for(var w in E)a[w]=E[w]}return a}var Jt=1;function Gt(){return Jt++}function wt(){return function a(s){return s?(s^16*Math.random()>>s/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Bt(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function gr(a,s){a.forEach(function(l){s[l]&&(s[l]=s[l].bind(s))})}function K(a,s){return a.indexOf(s,a.length-s.length)!==-1}function ur(a,s,l){var v={};for(var _ in a)v[_]=s.call(l||this,a[_],_,a);return v}function Tt(a,s,l){var v={};for(var _ in a)s.call(l||this,a[_],_,a)&&(v[_]=a[_]);return v}function ht(a){return Array.isArray(a)?a.map(ht):typeof a=="object"&&a?ur(a,ht):a}var Ot={};function pt(a){Ot[a]||(typeof console!="undefined"&&console.warn(a),Ot[a]=!0)}function lr(a,s,l){return(l.y-a.y)*(s.x-a.x)>(s.y-a.y)*(l.x-a.x)}function Br(a){for(var s=0,l=0,v=a.length,_=v-1,E=void 0,w=void 0;l<v;_=l++)s+=((w=a[_]).x-(E=a[l]).x)*(E.y+w.y);return s}function q(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function ge(a){var s={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(v,_,E,w){var L=E||w;return s[_]=!L||L.toLowerCase(),""}),s["max-age"]){var l=parseInt(s["max-age"],10);isNaN(l)?delete s["max-age"]:s["max-age"]=l}return s}var Q=null;function Me(a){if(Q==null){var s=a.navigator?a.navigator.userAgent:null;Q=!!a.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Q}function ee(a){try{var s=_e[a];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch(l){return!1}}var oe,bt,Nt,jt,Qt=_e.performance&&_e.performance.now?_e.performance.now.bind(_e.performance):Date.now.bind(Date),ln=_e.requestAnimationFrame||_e.mozRequestAnimationFrame||_e.webkitRequestAnimationFrame||_e.msRequestAnimationFrame,Dr=_e.cancelAnimationFrame||_e.mozCancelAnimationFrame||_e.webkitCancelAnimationFrame||_e.msCancelAnimationFrame,oi={now:Qt,frame:function(a){var s=ln(a);return{cancel:function(){return Dr(s)}}},getImageData:function(a,s){s===void 0&&(s=0);var l=_e.document.createElement("canvas"),v=l.getContext("2d");if(!v)throw new Error("failed to create canvas 2d context");return l.width=a.width,l.height=a.height,v.drawImage(a,0,0,a.width,a.height),v.getImageData(-s,-s,a.width+2*s,a.height+2*s)},resolveURL:function(a){return oe||(oe=_e.document.createElement("a")),oe.href=a,oe.href},hardwareConcurrency:_e.navigator&&_e.navigator.hardwareConcurrency||4,get devicePixelRatio(){return _e.devicePixelRatio},get prefersReducedMotion(){return!!_e.matchMedia&&(bt==null&&(bt=_e.matchMedia("(prefers-reduced-motion: reduce)")),bt.matches)}},Zn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Vn={supported:!1,testSupport:function(a){!Xi&&jt&&(Ci?fi(a):Nt=a)}},Xi=!1,Ci=!1;function fi(a){var s=a.createTexture();a.bindTexture(a.TEXTURE_2D,s);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,jt),a.isContextLost())return;Vn.supported=!0}catch(l){}a.deleteTexture(s),Xi=!0}_e.document&&((jt=_e.document.createElement("img")).onload=function(){Nt&&fi(Nt),Nt=null,Ci=!0},jt.onerror=function(){Xi=!0,Nt=null},jt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Hi="01",Ni=function(a,s){this._transformRequestFn=a,this._customAccessToken=s,this._createSkuToken()};function hi(a){return a.indexOf("mapbox:")===0}Ni.prototype._createSkuToken=function(){var a=function(){for(var s="",l=0;l<10;l++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Hi,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},Ni.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Ni.prototype.transformRequest=function(a,s){return this._transformRequestFn&&this._transformRequestFn(a,s)||{url:a}},Ni.prototype.normalizeStyleURL=function(a,s){if(!hi(a))return a;var l=Ha(a);return l.path="/styles/v1"+l.path,this._makeAPIURL(l,this._customAccessToken||s)},Ni.prototype.normalizeGlyphsURL=function(a,s){if(!hi(a))return a;var l=Ha(a);return l.path="/fonts/v1"+l.path,this._makeAPIURL(l,this._customAccessToken||s)},Ni.prototype.normalizeSourceURL=function(a,s){if(!hi(a))return a;var l=Ha(a);return l.path="/v4/"+l.authority+".json",l.params.push("secure"),this._makeAPIURL(l,this._customAccessToken||s)},Ni.prototype.normalizeSpriteURL=function(a,s,l,v){var _=Ha(a);return hi(a)?(_.path="/styles/v1"+_.path+"/sprite"+s+l,this._makeAPIURL(_,this._customAccessToken||v)):(_.path+=""+s+l,wa(_))},Ni.prototype.normalizeTileURL=function(a,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!hi(a))return a;var l=Ha(a);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,(oi.devicePixelRatio>=2||s===512?"@2x":"")+(Vn.supported?".webp":"$1")),l.path=l.path.replace(/^.+\/v4\//,"/"),l.path="/v4"+l.path;var v=this._customAccessToken||function(_){for(var E=0,w=_;E<w.length;E+=1){var L=w[E].match(/^access_token=(.*)$/);if(L)return L[1]}return null}(l.params)||Zn.ACCESS_TOKEN;return Zn.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&l.params.push("sku="+this._skuToken),this._makeAPIURL(l,v)},Ni.prototype.canonicalizeTileURL=function(a,s){var l=Ha(a);if(!l.path.match(/(^\/v4\/)/)||!l.path.match(/\.[\w]+$/))return a;var v="mapbox://tiles/";v+=l.path.replace("/v4/","");var _=l.params;return s&&(_=_.filter(function(E){return!E.match(/^access_token=/)})),_.length&&(v+="?"+_.join("&")),v},Ni.prototype.canonicalizeTileset=function(a,s){for(var l=!!s&&hi(s),v=[],_=0,E=a.tiles||[];_<E.length;_+=1){var w=E[_];ri(w)?v.push(this.canonicalizeTileURL(w,l)):v.push(w)}return v},Ni.prototype._makeAPIURL=function(a,s){var l="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",v=Ha(Zn.API_URL);if(a.protocol=v.protocol,a.authority=v.authority,a.protocol==="http"){var _=a.params.indexOf("secure");_>=0&&a.params.splice(_,1)}if(v.path!=="/"&&(a.path=""+v.path+a.path),!Zn.REQUIRE_ACCESS_TOKEN)return wa(a);if(!(s=s||Zn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+l);if(s[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+l);return a.params=a.params.filter(function(E){return E.indexOf("access_token")===-1}),a.params.push("access_token="+s),wa(a)};var Xn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ri(a){return Xn.test(a)}var po=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ha(a){var s=a.match(po);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function wa(a){var s=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+s}function Et(a){if(!a)return null;var s=a.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(decodeURIComponent(_e.atob(s[1]).split("").map(function(l){return"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(l){return null}}var me=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};me.prototype.getStorageKey=function(a){var s,l=Et(Zn.ACCESS_TOKEN);return s=l&&l.u?_e.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,function(v,_){return String.fromCharCode(Number("0x"+_))})):Zn.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+s:"mapbox.eventData:"+s},me.prototype.fetchEventData=function(){var a=ee("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(a)try{var v=_e.localStorage.getItem(s);v&&(this.eventData=JSON.parse(v));var _=_e.localStorage.getItem(l);_&&(this.anonId=_)}catch(E){pt("Unable to read from LocalStorage")}},me.prototype.saveEventData=function(){var a=ee("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(a)try{_e.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&_e.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(v){pt("Unable to write to LocalStorage")}},me.prototype.processRequests=function(a){},me.prototype.postEvent=function(a,s,l,v){var _=this;if(Zn.EVENTS_URL){var E=Ha(Zn.EVENTS_URL);E.params.push("access_token="+(v||Zn.ACCESS_TOKEN||""));var w={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:Hi,userId:this.anonId},L=s?xt(w,s):w,B={url:wa(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([L])};this.pendingRequest=Ki(B,function(V){_.pendingRequest=null,l(V),_.saveEventData(),_.processRequests(v)})}},me.prototype.queueRequest=function(a,s){this.queue.push(a),this.processRequests(s)};var se,Se,z=function(a){function s(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postMapLoadEvent=function(l,v,_,E){this.skuToken=_,(Zn.EVENTS_URL&&E||Zn.ACCESS_TOKEN&&Array.isArray(l)&&l.some(function(w){return hi(w)||ri(w)}))&&this.queueRequest({id:v,timestamp:Date.now()},E)},s.prototype.processRequests=function(l){var v=this;if(!this.pendingRequest&&this.queue.length!==0){var _=this.queue.shift(),E=_.id,w=_.timestamp;E&&this.success[E]||(this.anonId||this.fetchEventData(),Bt(this.anonId)||(this.anonId=wt()),this.postEvent(w,{skuToken:this.skuToken},function(L){L||E&&(v.success[E]=!0)},l))}},s}(me),qe=new(function(a){function s(l){a.call(this,"appUserTurnstile"),this._customAccessToken=l}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postTurnstileEvent=function(l,v){Zn.EVENTS_URL&&Zn.ACCESS_TOKEN&&Array.isArray(l)&&l.some(function(_){return hi(_)||ri(_)})&&this.queueRequest(Date.now(),v)},s.prototype.processRequests=function(l){var v=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var _=Et(Zn.ACCESS_TOKEN),E=_?_.u:Zn.ACCESS_TOKEN,w=E!==this.eventData.tokenU;Bt(this.anonId)||(this.anonId=wt(),w=!0);var L=this.queue.shift();if(this.eventData.lastSuccess){var B=new Date(this.eventData.lastSuccess),V=new Date(L),W=(L-this.eventData.lastSuccess)/864e5;w=w||W>=1||W<-1||B.getDate()!==V.getDate()}else w=!0;if(!w)return this.processRequests();this.postEvent(L,{"enabled.telemetry":!1},function($){$||(v.eventData.lastSuccess=L,v.eventData.tokenU=E)},l)}},s}(me)),qt=qe.postTurnstileEvent.bind(qe),Or=new z,Ye=Or.postMapLoadEvent.bind(Or),Mt=500,pr=50;function Mr(){_e.caches&&!se&&(se=_e.caches.open("mapbox-tiles"))}function Zr(a){var s=a.indexOf("?");return s<0?a:a.slice(0,s)}var qr,jn=1/0;function Nn(){return qr==null&&(qr=_e.OffscreenCanvas&&new _e.OffscreenCanvas(1,1).getContext("2d")&&typeof _e.createImageBitmap=="function"),qr}var en={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(en);var pi=function(a){function s(l,v,_){v===401&&ri(_)&&(l+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,l),this.status=v,this.url=_,this.name=this.constructor.name,this.message=l}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},s}(Error),si=q()?function(){return self.worker&&self.worker.referrer}:function(){return(_e.location.protocol==="blob:"?_e.parent:_e).location.href},ra,Aa,va=function(a,s){if(!(/^file:/.test(l=a.url)||/^file:/.test(si())&&!/^\w+:/.test(l))){if(_e.fetch&&_e.Request&&_e.AbortController&&_e.Request.prototype.hasOwnProperty("signal"))return function(v,_){var E,w=new _e.AbortController,L=new _e.Request(v.url,{method:v.method||"GET",body:v.body,credentials:v.credentials,headers:v.headers,referrer:si(),signal:w.signal}),B=!1,V=!1,W=(E=L.url).indexOf("sku=")>0&&ri(E);v.type==="json"&&L.headers.set("Accept","application/json");var $=function(ve,Ue,Ve){if(!V){if(ve&&ve.message!=="SecurityError"&&pt(ve),Ue&&Ve)return le(Ue);var st=Date.now();_e.fetch(L).then(function(Qe){if(Qe.ok){var St=W?Qe.clone():null;return le(Qe,St,st)}return _(new pi(Qe.statusText,Qe.status,v.url))}).catch(function(Qe){Qe.code!==20&&_(new Error(Qe.message))})}},le=function(ve,Ue,Ve){(v.type==="arrayBuffer"?ve.arrayBuffer():v.type==="json"?ve.json():ve.text()).then(function(st){V||(Ue&&Ve&&function(Qe,St,Vt){if(Mr(),se){var ir={status:St.status,statusText:St.statusText,headers:new _e.Headers};St.headers.forEach(function(Sr,Xr){return ir.headers.set(Xr,Sr)});var sr=ge(St.headers.get("Cache-Control")||"");sr["no-store"]||(sr["max-age"]&&ir.headers.set("Expires",new Date(Vt+1e3*sr["max-age"]).toUTCString()),new Date(ir.headers.get("Expires")).getTime()-Vt<42e4||function(Sr,Xr){if(Se===void 0)try{new Response(new ReadableStream),Se=!0}catch(hn){Se=!1}Se?Xr(Sr.body):Sr.blob().then(Xr)}(St,function(Sr){var Xr=new _e.Response(Sr,ir);Mr(),se&&se.then(function(hn){return hn.put(Zr(Qe.url),Xr)}).catch(function(hn){return pt(hn.message)})}))}}(L,Ue,Ve),B=!0,_(null,st,ve.headers.get("Cache-Control"),ve.headers.get("Expires")))}).catch(function(st){V||_(new Error(st.message))})};return W?function(ve,Ue){if(Mr(),!se)return Ue(null);var Ve=Zr(ve.url);se.then(function(st){st.match(Ve).then(function(Qe){var St=function(Vt){if(!Vt)return!1;var ir=new Date(Vt.headers.get("Expires")||0),sr=ge(Vt.headers.get("Cache-Control")||"");return ir>Date.now()&&!sr["no-cache"]}(Qe);st.delete(Ve),St&&st.put(Ve,Qe.clone()),Ue(null,Qe,St)}).catch(Ue)}).catch(Ue)}(L,$):$(null,null),{cancel:function(){V=!0,B||w.abort()}}}(a,s);if(q()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,s,void 0,!0)}var l;return function(v,_){var E=new _e.XMLHttpRequest;for(var w in E.open(v.method||"GET",v.url,!0),v.type==="arrayBuffer"&&(E.responseType="arraybuffer"),v.headers)E.setRequestHeader(w,v.headers[w]);return v.type==="json"&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials=v.credentials==="include",E.onerror=function(){_(new Error(E.statusText))},E.onload=function(){if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){var L=E.response;if(v.type==="json")try{L=JSON.parse(E.response)}catch(B){return _(B)}_(null,L,E.getResponseHeader("Cache-Control"),E.getResponseHeader("Expires"))}else _(new pi(E.statusText,E.status,v.url))},E.send(v.body),{cancel:function(){return E.abort()}}}(a,s)},xa=function(a,s){return va(xt(a,{type:"arrayBuffer"}),s)},Ki=function(a,s){return va(xt(a,{method:"POST"}),s)},Y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ra=[],Aa=0;var ie=function(a,s){if(Vn.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Aa>=Zn.MAX_PARALLEL_IMAGE_REQUESTS){var l={requestParameters:a,callback:s,cancelled:!1,cancel:function(){this.cancelled=!0}};return ra.push(l),l}Aa++;var v=!1,_=function(){if(!v)for(v=!0,Aa--;ra.length&&Aa<Zn.MAX_PARALLEL_IMAGE_REQUESTS;){var w=ra.shift();w.cancelled||(w.cancel=ie(w.requestParameters,w.callback).cancel)}},E=xa(a,function(w,L,B,V){_(),w?s(w):L&&(Nn()?function(W,$){var le=new _e.Blob([new Uint8Array(W)],{type:"image/png"});_e.createImageBitmap(le).then(function(ve){$(null,ve)}).catch(function(ve){$(new Error("Could not load image because of "+ve.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(L,s):function(W,$,le,ve){var Ue=new _e.Image,Ve=_e.URL;Ue.onload=function(){$(null,Ue),Ve.revokeObjectURL(Ue.src),Ue.onload=null,_e.requestAnimationFrame(function(){Ue.src=Y})},Ue.onerror=function(){return $(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var st=new _e.Blob([new Uint8Array(W)],{type:"image/png"});Ue.cacheControl=le,Ue.expires=ve,Ue.src=W.byteLength?Ve.createObjectURL(st):Y}(L,s,B,V))});return{cancel:function(){E.cancel(),_()}}};function de(a,s,l){l[a]&&l[a].indexOf(s)!==-1||(l[a]=l[a]||[],l[a].push(s))}function Ce(a,s,l){if(l&&l[a]){var v=l[a].indexOf(s);v!==-1&&l[a].splice(v,1)}}var Ze=function(a,s){s===void 0&&(s={}),xt(this,s),this.type=a},et=function(a){function s(l,v){v===void 0&&(v={}),a.call(this,"error",xt({error:l},v))}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Ze),dt=function(){};dt.prototype.on=function(a,s){return this._listeners=this._listeners||{},de(a,s,this._listeners),this},dt.prototype.off=function(a,s){return Ce(a,s,this._listeners),Ce(a,s,this._oneTimeListeners),this},dt.prototype.once=function(a,s){return this._oneTimeListeners=this._oneTimeListeners||{},de(a,s,this._oneTimeListeners),this},dt.prototype.fire=function(a,s){typeof a=="string"&&(a=new Ze(a,s||{}));var l=a.type;if(this.listens(l)){a.target=this;for(var v=0,_=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];v<_.length;v+=1)_[v].call(this,a);for(var E=0,w=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];E<w.length;E+=1){var L=w[E];Ce(l,L,this._oneTimeListeners),L.call(this,a)}var B=this._eventedParent;B&&(xt(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),B.fire(a))}else a instanceof et&&console.error(a.error);return this},dt.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},dt.prototype.setEventedParent=function(a,s){return this._eventedParent=a,this._eventedParentData=s,this};var be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},He=function(a,s,l,v){this.message=(a?a+": ":"")+l,v&&(this.identifier=v),s!=null&&s.__line__&&(this.line=s.__line__)};function Rt(a){var s=a.value;return s?[new He(a.key,s,"constants have been deprecated as of v8")]:[]}function kr(a){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];for(var v=0,_=s;v<_.length;v+=1){var E=_[v];for(var w in E)a[w]=E[w]}return a}function Xt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function er(a){if(Array.isArray(a))return a.map(er);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var s={};for(var l in a)s[l]=er(a[l]);return s}return Xt(a)}var Pr=function(a){function s(l,v){a.call(this,v),this.message=v,this.key=l}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Error),Ln=function(a,s){s===void 0&&(s=[]),this.parent=a,this.bindings={};for(var l=0,v=s;l<v.length;l+=1){var _=v[l];this.bindings[_[0]]=_[1]}};Ln.prototype.concat=function(a){return new Ln(this,a)},Ln.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},Ln.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var An={kind:"null"},Ht={kind:"number"},xn={kind:"string"},sn={kind:"boolean"},pn={kind:"color"},bi={kind:"object"},yn={kind:"value"},Pi={kind:"collator"},aa={kind:"formatted"},vt={kind:"resolvedImage"};function yt(a,s){return{kind:"array",itemType:a,N:s}}function Ii(a){if(a.kind==="array"){var s=Ii(a.itemType);return typeof a.N=="number"?"array<"+s+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+s+">"}return a.kind}var ui=[An,Ht,xn,sn,pn,aa,bi,yt(yn),vt];function Qi(a,s){if(s.kind==="error")return null;if(a.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Qi(a.itemType,s.itemType))&&(typeof a.N!="number"||a.N===s.N))return null}else{if(a.kind===s.kind)return null;if(a.kind==="value"){for(var l=0,v=ui;l<v.length;l+=1)if(!Qi(v[l],s))return null}}return"Expected "+Ii(a)+" but found "+Ii(s)+" instead."}function Ji(a,s){return s.some(function(l){return l.kind===a.kind})}function oa(a,s){return s.some(function(l){return l==="null"?a===null:l==="array"?Array.isArray(a):l==="object"?a&&!Array.isArray(a)&&typeof a=="object":l===typeof a})}var Ri=Ae(function(a,s){var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function v(L){return(L=Math.round(L))<0?0:L>255?255:L}function _(L){return v(L[L.length-1]==="%"?parseFloat(L)/100*255:parseInt(L))}function E(L){return(B=L[L.length-1]==="%"?parseFloat(L)/100:parseFloat(L))<0?0:B>1?1:B;var B}function w(L,B,V){return V<0?V+=1:V>1&&(V-=1),6*V<1?L+(B-L)*V*6:2*V<1?B:3*V<2?L+(B-L)*(2/3-V)*6:L}try{s.parseCSSColor=function(L){var B,V=L.replace(/ /g,"").toLowerCase();if(V in l)return l[V].slice();if(V[0]==="#")return V.length===4?(B=parseInt(V.substr(1),16))>=0&&B<=4095?[(3840&B)>>4|(3840&B)>>8,240&B|(240&B)>>4,15&B|(15&B)<<4,1]:null:V.length===7&&(B=parseInt(V.substr(1),16))>=0&&B<=16777215?[(16711680&B)>>16,(65280&B)>>8,255&B,1]:null;var W=V.indexOf("("),$=V.indexOf(")");if(W!==-1&&$+1===V.length){var le=V.substr(0,W),ve=V.substr(W+1,$-(W+1)).split(","),Ue=1;switch(le){case"rgba":if(ve.length!==4)return null;Ue=E(ve.pop());case"rgb":return ve.length!==3?null:[_(ve[0]),_(ve[1]),_(ve[2]),Ue];case"hsla":if(ve.length!==4)return null;Ue=E(ve.pop());case"hsl":if(ve.length!==3)return null;var Ve=(parseFloat(ve[0])%360+360)%360/360,st=E(ve[1]),Qe=E(ve[2]),St=Qe<=.5?Qe*(st+1):Qe+st-Qe*st,Vt=2*Qe-St;return[v(255*w(Vt,St,Ve+1/3)),v(255*w(Vt,St,Ve)),v(255*w(Vt,St,Ve-1/3)),Ue];default:return null}}return null}}catch(L){}}).parseCSSColor,hr=function(a,s,l,v){v===void 0&&(v=1),this.r=a,this.g=s,this.b=l,this.a=v};hr.parse=function(a){if(a){if(a instanceof hr)return a;if(typeof a=="string"){var s=Ri(a);if(s)return new hr(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3])}}},hr.prototype.toString=function(){var a=this.toArray(),s=a[1],l=a[2],v=a[3];return"rgba("+Math.round(a[0])+","+Math.round(s)+","+Math.round(l)+","+v+")"},hr.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},hr.black=new hr(0,0,0,1),hr.white=new hr(1,1,1,1),hr.transparent=new hr(0,0,0,0),hr.red=new hr(1,0,0,1);var _r=function(a,s,l){this.sensitivity=a?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};_r.prototype.compare=function(a,s){return this.collator.compare(a,s)},_r.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var at=function(a,s,l,v,_){this.text=a,this.image=s,this.scale=l,this.fontStack=v,this.textColor=_},Ta=function(a){this.sections=a};Ta.fromString=function(a){return new Ta([new at(a,null,null,null,null)])},Ta.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},Ta.factory=function(a){return a instanceof Ta?a:Ta.fromString(a)},Ta.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},Ta.prototype.serialize=function(){for(var a=["format"],s=0,l=this.sections;s<l.length;s+=1){var v=l[s];if(v.image)a.push(["image",v.image.name]);else{a.push(v.text);var _={};v.fontStack&&(_["text-font"]=["literal",v.fontStack.split(",")]),v.scale&&(_["font-scale"]=v.scale),v.textColor&&(_["text-color"]=["rgba"].concat(v.textColor.toArray())),a.push(_)}}return a};var $e=function(a){this.name=a.name,this.available=a.available};function ks(a,s,l,v){return typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof l=="number"&&l>=0&&l<=255?v===void 0||typeof v=="number"&&v>=0&&v<=1?null:"Invalid rgba value ["+[a,s,l,v].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof v=="number"?[a,s,l,v]:[a,s,l]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ls(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof hr||a instanceof _r||a instanceof Ta||a instanceof $e)return!0;if(Array.isArray(a)){for(var s=0,l=a;s<l.length;s+=1)if(!ls(l[s]))return!1;return!0}if(typeof a=="object"){for(var v in a)if(!ls(a[v]))return!1;return!0}return!1}function ia(a){if(a===null)return An;if(typeof a=="string")return xn;if(typeof a=="boolean")return sn;if(typeof a=="number")return Ht;if(a instanceof hr)return pn;if(a instanceof _r)return Pi;if(a instanceof Ta)return aa;if(a instanceof $e)return vt;if(Array.isArray(a)){for(var s,l=a.length,v=0,_=a;v<_.length;v+=1){var E=ia(_[v]);if(s){if(s===E)continue;s=yn;break}s=E}return yt(s||yn,l)}return bi}function Us(a){var s=typeof a;return a===null?"":s==="string"||s==="number"||s==="boolean"?String(a):a instanceof hr||a instanceof Ta||a instanceof $e?a.toString():JSON.stringify(a)}$e.prototype.toString=function(){return this.name},$e.fromString=function(a){return a?new $e({name:a,available:!1}):null},$e.prototype.serialize=function(){return["image",this.name]};var Ja=function(a,s){this.type=a,this.value=s};Ja.parse=function(a,s){if(a.length!==2)return s.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!ls(a[1]))return s.error("invalid value");var l=a[1],v=ia(l),_=s.expectedType;return v.kind!=="array"||v.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(v=_),new Ja(v,l)},Ja.prototype.evaluate=function(){return this.value},Ja.prototype.eachChild=function(){},Ja.prototype.outputDefined=function(){return!0},Ja.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof hr?["rgba"].concat(this.value.toArray()):this.value instanceof Ta?this.value.serialize():this.value};var Wa=function(a){this.name="ExpressionEvaluationError",this.message=a};Wa.prototype.toJSON=function(){return this.message};var eo={string:xn,number:Ht,boolean:sn,object:bi},sa=function(a,s){this.type=a,this.args=s};sa.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var l,v=1,_=a[0];if(_==="array"){var E,w;if(a.length>2){var L=a[1];if(typeof L!="string"||!(L in eo)||L==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);E=eo[L],v++}else E=yn;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return s.error('The length argument to "array" must be a positive integer literal',2);w=a[2],v++}l=yt(E,w)}else l=eo[_];for(var B=[];v<a.length;v++){var V=s.parse(a[v],v,yn);if(!V)return null;B.push(V)}return new sa(l,B)},sa.prototype.evaluate=function(a){for(var s=0;s<this.args.length;s++){var l=this.args[s].evaluate(a);if(!Qi(this.type,ia(l)))return l;if(s===this.args.length-1)throw new Wa("Expected value to be of type "+Ii(this.type)+", but found "+Ii(ia(l))+" instead.")}return null},sa.prototype.eachChild=function(a){this.args.forEach(a)},sa.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},sa.prototype.serialize=function(){var a=this.type,s=[a.kind];if(a.kind==="array"){var l=a.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){s.push(l.kind);var v=a.N;(typeof v=="number"||this.args.length>1)&&s.push(v)}}return s.concat(this.args.map(function(_){return _.serialize()}))};var Xo=function(a){this.type=aa,this.sections=a};Xo.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var l=a[1];if(!Array.isArray(l)&&typeof l=="object")return s.error("First argument must be an image or text section.");for(var v=[],_=!1,E=1;E<=a.length-1;++E){var w=a[E];if(_&&typeof w=="object"&&!Array.isArray(w)){_=!1;var L=null;if(w["font-scale"]&&!(L=s.parse(w["font-scale"],1,Ht)))return null;var B=null;if(w["text-font"]&&!(B=s.parse(w["text-font"],1,yt(xn))))return null;var V=null;if(w["text-color"]&&!(V=s.parse(w["text-color"],1,pn)))return null;var W=v[v.length-1];W.scale=L,W.font=B,W.textColor=V}else{var $=s.parse(a[E],1,yn);if(!$)return null;var le=$.type.kind;if(le!=="string"&&le!=="value"&&le!=="null"&&le!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,v.push({content:$,scale:null,font:null,textColor:null})}}return new Xo(v)},Xo.prototype.evaluate=function(a){return new Ta(this.sections.map(function(s){var l=s.content.evaluate(a);return ia(l)===vt?new at("",l,null,null,null):new at(Us(l),null,s.scale?s.scale.evaluate(a):null,s.font?s.font.evaluate(a).join(","):null,s.textColor?s.textColor.evaluate(a):null)}))},Xo.prototype.eachChild=function(a){for(var s=0,l=this.sections;s<l.length;s+=1){var v=l[s];a(v.content),v.scale&&a(v.scale),v.font&&a(v.font),v.textColor&&a(v.textColor)}},Xo.prototype.outputDefined=function(){return!1},Xo.prototype.serialize=function(){for(var a=["format"],s=0,l=this.sections;s<l.length;s+=1){var v=l[s];a.push(v.content.serialize());var _={};v.scale&&(_["font-scale"]=v.scale.serialize()),v.font&&(_["text-font"]=v.font.serialize()),v.textColor&&(_["text-color"]=v.textColor.serialize()),a.push(_)}return a};var rs=function(a){this.type=vt,this.input=a};rs.parse=function(a,s){if(a.length!==2)return s.error("Expected two arguments.");var l=s.parse(a[1],1,xn);return l?new rs(l):s.error("No image name provided.")},rs.prototype.evaluate=function(a){var s=this.input.evaluate(a),l=$e.fromString(s);return l&&a.availableImages&&(l.available=a.availableImages.indexOf(s)>-1),l},rs.prototype.eachChild=function(a){a(this.input)},rs.prototype.outputDefined=function(){return!1},rs.prototype.serialize=function(){return["image",this.input.serialize()]};var bu={"to-boolean":sn,"to-color":pn,"to-number":Ht,"to-string":xn},To=function(a,s){this.type=a,this.args=s};To.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var l=a[0];if((l==="to-boolean"||l==="to-string")&&a.length!==2)return s.error("Expected one argument.");for(var v=bu[l],_=[],E=1;E<a.length;E++){var w=s.parse(a[E],E,yn);if(!w)return null;_.push(w)}return new To(v,_)},To.prototype.evaluate=function(a){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(a));if(this.type.kind==="color"){for(var s,l,v=0,_=this.args;v<_.length;v+=1){if(l=null,(s=_[v].evaluate(a))instanceof hr)return s;if(typeof s=="string"){var E=a.parseColor(s);if(E)return E}else if(Array.isArray(s)&&!(l=s.length<3||s.length>4?"Invalid rbga value "+JSON.stringify(s)+": expected an array containing either three or four numeric values.":ks(s[0],s[1],s[2],s[3])))return new hr(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Wa(l||"Could not parse color from value '"+(typeof s=="string"?s:String(JSON.stringify(s)))+"'")}if(this.type.kind==="number"){for(var w=null,L=0,B=this.args;L<B.length;L+=1){if((w=B[L].evaluate(a))===null)return 0;var V=Number(w);if(!isNaN(V))return V}throw new Wa("Could not convert "+JSON.stringify(w)+" to number.")}return this.type.kind==="formatted"?Ta.fromString(Us(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?$e.fromString(Us(this.args[0].evaluate(a))):Us(this.args[0].evaluate(a))},To.prototype.eachChild=function(a){this.args.forEach(a)},To.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},To.prototype.serialize=function(){if(this.type.kind==="formatted")return new Xo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new rs(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(s){a.push(s.serialize())}),a};var Mo=["Unknown","Point","LineString","Polygon"],fa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};fa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},fa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Mo[this.feature.type]:this.feature.type:null},fa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},fa.prototype.canonicalID=function(){return this.canonical},fa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},fa.prototype.parseColor=function(a){var s=this._parseColorCache[a];return s||(s=this._parseColorCache[a]=hr.parse(a)),s};var to=function(a,s,l,v){this.name=a,this.type=s,this._evaluate=l,this.args=v};to.prototype.evaluate=function(a){return this._evaluate(a,this.args)},to.prototype.eachChild=function(a){this.args.forEach(a)},to.prototype.outputDefined=function(){return!1},to.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},to.parse=function(a,s){var l,v=a[0],_=to.definitions[v];if(!_)return s.error('Unknown expression "'+v+'". If you wanted a literal array, use ["literal", [...]].',0);for(var E=Array.isArray(_)?_[0]:_.type,w=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,L=w.filter(function(ni){var Pn=ni[0];return!Array.isArray(Pn)||Pn.length===a.length-1}),B=null,V=0,W=L;V<W.length;V+=1){var $=W[V],le=$[0],ve=$[1];B=new qs(s.registry,s.path,null,s.scope);for(var Ue=[],Ve=!1,st=1;st<a.length;st++){var Qe=a[st],St=Array.isArray(le)?le[st-1]:le.type,Vt=B.parse(Qe,1+Ue.length,St);if(!Vt){Ve=!0;break}Ue.push(Vt)}if(!Ve)if(Array.isArray(le)&&le.length!==Ue.length)B.error("Expected "+le.length+" arguments, but found "+Ue.length+" instead.");else{for(var ir=0;ir<Ue.length;ir++){var sr=Array.isArray(le)?le[ir]:le.type,Sr=Ue[ir];B.concat(ir+1).checkSubtype(sr,Sr.type)}if(B.errors.length===0)return new to(v,E,ve,Ue)}}if(L.length===1)(l=s.errors).push.apply(l,B.errors);else{for(var Xr=(L.length?L:w).map(function(ni){var Pn;return Pn=ni[0],Array.isArray(Pn)?"("+Pn.map(Ii).join(", ")+")":"("+Ii(Pn.type)+"...)"}).join(" | "),hn=[],Kn=1;Kn<a.length;Kn++){var Mn=s.parse(a[Kn],1+hn.length);if(!Mn)return null;hn.push(Ii(Mn.type))}s.error("Expected arguments of type "+Xr+", but found ("+hn.join(", ")+") instead.")}return null},to.register=function(a,s){for(var l in to.definitions=s,s)a[l]=to};var Yo=function(a,s,l){this.type=Pi,this.locale=l,this.caseSensitive=a,this.diacriticSensitive=s};function qa(a,s){a[0]=Math.min(a[0],s[0]),a[1]=Math.min(a[1],s[1]),a[2]=Math.max(a[2],s[0]),a[3]=Math.max(a[3],s[1])}function $s(a,s){return!(a[0]<=s[0]||a[2]>=s[2]||a[1]<=s[1]||a[3]>=s[3])}function Ll(a,s){var l=(180+a[0])/360,v=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,_=Math.pow(2,s.z);return[Math.round(l*_*8192),Math.round(v*_*8192)]}function ns(a,s,l){return s[1]>a[1]!=l[1]>a[1]&&a[0]<(l[0]-s[0])*(a[1]-s[1])/(l[1]-s[1])+s[0]}function he(a,s){for(var l,v,_,E,w,L,B,V=!1,W=0,$=s.length;W<$;W++)for(var le=s[W],ve=0,Ue=le.length;ve<Ue-1;ve++){if((E=(l=a)[0]-(v=le[ve])[0])*(B=l[1]-(_=le[ve+1])[1])-(L=l[0]-_[0])*(w=l[1]-v[1])==0&&E*L<=0&&w*B<=0)return!1;ns(a,le[ve],le[ve+1])&&(V=!V)}return V}function Pe(a,s){for(var l=0;l<s.length;l++)if(he(a,s[l]))return!0;return!1}function ct(a,s,l,v){var _=v[0]-l[0],E=v[1]-l[1],w=(a[0]-l[0])*E-_*(a[1]-l[1]),L=(s[0]-l[0])*E-_*(s[1]-l[1]);return w>0&&L<0||w<0&&L>0}function Yt(a,s,l){for(var v=0,_=l;v<_.length;v+=1)for(var E=_[v],w=0;w<E.length-1;++w)if(($=[(W=E[w+1])[0]-(V=E[w])[0],W[1]-V[1]])[0]*(le=[(B=s)[0]-(L=a)[0],B[1]-L[1]])[1]-$[1]*le[0]!=0&&ct(L,B,V,W)&&ct(V,W,L,B))return!0;var L,B,V,W,$,le;return!1}function Yr(a,s){for(var l=0;l<a.length;++l)if(!he(a[l],s))return!1;for(var v=0;v<a.length-1;++v)if(Yt(a[v],a[v+1],s))return!1;return!0}function Gn(a,s){for(var l=0;l<s.length;l++)if(Yr(a,s[l]))return!0;return!1}function Oi(a,s,l){for(var v=[],_=0;_<a.length;_++){for(var E=[],w=0;w<a[_].length;w++){var L=Ll(a[_][w],l);qa(s,L),E.push(L)}v.push(E)}return v}function uo(a,s,l){for(var v=[],_=0;_<a.length;_++){var E=Oi(a[_],s,l);v.push(E)}return v}function Na(a,s,l,v){if(a[0]<l[0]||a[0]>l[2]){var _=.5*v,E=a[0]-l[0]>_?-v:l[0]-a[0]>_?v:0;E===0&&(E=a[0]-l[2]>_?-v:l[2]-a[0]>_?v:0),a[0]+=E}qa(s,a)}function Ka(a,s,l,v){for(var _=8192*Math.pow(2,v.z),E=[8192*v.x,8192*v.y],w=[],L=0,B=a;L<B.length;L+=1)for(var V=0,W=B[L];V<W.length;V+=1){var $=W[V],le=[$.x+E[0],$.y+E[1]];Na(le,s,l,_),w.push(le)}return w}function is(a,s,l,v){for(var _,E=8192*Math.pow(2,v.z),w=[8192*v.x,8192*v.y],L=[],B=0,V=a;B<V.length;B+=1){for(var W=[],$=0,le=V[B];$<le.length;$+=1){var ve=le[$],Ue=[ve.x+w[0],ve.y+w[1]];qa(s,Ue),W.push(Ue)}L.push(W)}if(s[2]-s[0]<=E/2){(_=s)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(var Ve=0,st=L;Ve<st.length;Ve+=1)for(var Qe=0,St=st[Ve];Qe<St.length;Qe+=1)Na(St[Qe],s,l,E)}return L}Yo.parse=function(a,s){if(a.length!==2)return s.error("Expected one argument.");var l=a[1];if(typeof l!="object"||Array.isArray(l))return s.error("Collator options argument must be an object.");var v=s.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,sn);if(!v)return null;var _=s.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,sn);if(!_)return null;var E=null;return l.locale&&!(E=s.parse(l.locale,1,xn))?null:new Yo(v,_,E)},Yo.prototype.evaluate=function(a){return new _r(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},Yo.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},Yo.prototype.outputDefined=function(){return!1},Yo.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var Uo=function(a,s){this.type=sn,this.geojson=a,this.geometries=s};function vo(a){if(a instanceof to&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Uo)return!1;var s=!0;return a.eachChild(function(l){s&&!vo(l)&&(s=!1)}),s}function Ps(a){if(a instanceof to&&a.name==="feature-state")return!1;var s=!0;return a.eachChild(function(l){s&&!Ps(l)&&(s=!1)}),s}function Ls(a,s){if(a instanceof to&&s.indexOf(a.name)>=0)return!1;var l=!0;return a.eachChild(function(v){l&&!Ls(v,s)&&(l=!1)}),l}Uo.parse=function(a,s){if(a.length!==2)return s.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(ls(a[1])){var l=a[1];if(l.type==="FeatureCollection")for(var v=0;v<l.features.length;++v){var _=l.features[v].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Uo(l,l.features[v].geometry)}else if(l.type==="Feature"){var E=l.geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new Uo(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Uo(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Uo.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(s,l){var v=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],E=s.canonicalID();if(l.type==="Polygon"){var w=Oi(l.coordinates,_,E),L=Ka(s.geometry(),v,_,E);if(!$s(v,_))return!1;for(var B=0,V=L;B<V.length;B+=1)if(!he(V[B],w))return!1}if(l.type==="MultiPolygon"){var W=uo(l.coordinates,_,E),$=Ka(s.geometry(),v,_,E);if(!$s(v,_))return!1;for(var le=0,ve=$;le<ve.length;le+=1)if(!Pe(ve[le],W))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(s,l){var v=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],E=s.canonicalID();if(l.type==="Polygon"){var w=Oi(l.coordinates,_,E),L=is(s.geometry(),v,_,E);if(!$s(v,_))return!1;for(var B=0,V=L;B<V.length;B+=1)if(!Yr(V[B],w))return!1}if(l.type==="MultiPolygon"){var W=uo(l.coordinates,_,E),$=is(s.geometry(),v,_,E);if(!$s(v,_))return!1;for(var le=0,ve=$;le<ve.length;le+=1)if(!Gn(ve[le],W))return!1}return!0}(a,this.geometries)}return!1},Uo.prototype.eachChild=function(){},Uo.prototype.outputDefined=function(){return!0},Uo.prototype.serialize=function(){return["within",this.geojson]};var Rs=function(a,s){this.type=s.type,this.name=a,this.boundExpression=s};Rs.parse=function(a,s){if(a.length!==2||typeof a[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");var l=a[1];return s.scope.has(l)?new Rs(l,s.scope.get(l)):s.error('Unknown variable "'+l+'". Make sure "'+l+'" has been bound in an enclosing "let" expression before using it.',1)},Rs.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},Rs.prototype.eachChild=function(){},Rs.prototype.outputDefined=function(){return!1},Rs.prototype.serialize=function(){return["var",this.name]};var qs=function(a,s,l,v,_){s===void 0&&(s=[]),v===void 0&&(v=new Ln),_===void 0&&(_=[]),this.registry=a,this.path=s,this.key=s.map(function(E){return"["+E+"]"}).join(""),this.scope=v,this.errors=_,this.expectedType=l};function uu(a,s){for(var l,v=a.length-1,_=0,E=v,w=0;_<=E;)if((l=a[w=Math.floor((_+E)/2)])<=s){if(w===v||s<a[w+1])return w;_=w+1}else{if(!(l>s))throw new Wa("Input is not a number.");E=w-1}return 0}qs.prototype.parse=function(a,s,l,v,_){return _===void 0&&(_={}),s?this.concat(s,l,v)._parse(a,_):this._parse(a,_)},qs.prototype._parse=function(a,s){function l(V,W,$){return $==="assert"?new sa(W,[V]):$==="coerce"?new To(W,[V]):V}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var v=a[0];if(typeof v!="string")return this.error("Expression name must be a string, but found "+typeof v+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var _=this.registry[v];if(_){var E=_.parse(a,this);if(!E)return null;if(this.expectedType){var w=this.expectedType,L=E.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||L.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||L.kind!=="value"&&L.kind!=="string"){if(this.checkSubtype(w,L))return null}else E=l(E,w,s.typeAnnotation||"coerce");else E=l(E,w,s.typeAnnotation||"assert")}if(!(E instanceof Ja)&&E.type.kind!=="resolvedImage"&&function V(W){if(W instanceof Rs)return V(W.boundExpression);if(W instanceof to&&W.name==="error"||W instanceof Yo||W instanceof Uo)return!1;var $=W instanceof To||W instanceof sa,le=!0;return W.eachChild(function(ve){le=$?le&&V(ve):le&&ve instanceof Ja}),!!le&&vo(W)&&Ls(W,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(E)){var B=new fa;try{E=new Ja(E.type,E.evaluate(B))}catch(V){return this.error(V.message),null}}return E}return this.error('Unknown expression "'+v+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},qs.prototype.concat=function(a,s,l){var v=typeof a=="number"?this.path.concat(a):this.path,_=l?this.scope.concat(l):this.scope;return new qs(this.registry,v,s||null,_,this.errors)},qs.prototype.error=function(a){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];var v=""+this.key+s.map(function(_){return"["+_+"]"}).join("");this.errors.push(new Pr(v,a))},qs.prototype.checkSubtype=function(a,s){var l=Qi(a,s);return l&&this.error(l),l};var gs=function(a,s,l){this.type=a,this.input=s,this.labels=[],this.outputs=[];for(var v=0,_=l;v<_.length;v+=1){var E=_[v],w=E[1];this.labels.push(E[0]),this.outputs.push(w)}};function zi(a,s,l){return a*(1-l)+s*l}gs.parse=function(a,s){if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");var l=s.parse(a[1],1,Ht);if(!l)return null;var v=[],_=null;s.expectedType&&s.expectedType.kind!=="value"&&(_=s.expectedType);for(var E=1;E<a.length;E+=2){var w=E===1?-1/0:a[E],L=a[E+1],B=E,V=E+1;if(typeof w!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(v.length&&v[v.length-1][0]>=w)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);var W=s.parse(L,V,_);if(!W)return null;_=_||W.type,v.push([w,W])}return new gs(_,l,v)},gs.prototype.evaluate=function(a){var s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(a);var v=this.input.evaluate(a);if(v<=s[0])return l[0].evaluate(a);var _=s.length;return v>=s[_-1]?l[_-1].evaluate(a):l[uu(s,v)].evaluate(a)},gs.prototype.eachChild=function(a){a(this.input);for(var s=0,l=this.outputs;s<l.length;s+=1)a(l[s])},gs.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},gs.prototype.serialize=function(){for(var a=["step",this.input.serialize()],s=0;s<this.labels.length;s++)s>0&&a.push(this.labels[s]),a.push(this.outputs[s].serialize());return a};var Pa=Object.freeze({__proto__:null,number:zi,color:function(a,s,l){return new hr(zi(a.r,s.r,l),zi(a.g,s.g,l),zi(a.b,s.b,l),zi(a.a,s.a,l))},array:function(a,s,l){return a.map(function(v,_){return zi(v,s[_],l)})}}),Nc=6/29*3*(6/29),cf=Math.PI/180,Os=180/Math.PI;function ff(a){return a>.008856451679035631?Math.pow(a,1/3):a/Nc+4/29}function ml(a){return a>6/29?a*a*a:Nc*(a-4/29)}function el(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Ks(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Rl(a){var s=Ks(a.r),l=Ks(a.g),v=Ks(a.b),_=ff((.4124564*s+.3575761*l+.1804375*v)/.95047),E=ff((.2126729*s+.7151522*l+.072175*v)/1);return{l:116*E-16,a:500*(_-E),b:200*(E-ff((.0193339*s+.119192*l+.9503041*v)/1.08883)),alpha:a.a}}function x(a){var s=(a.l+16)/116,l=isNaN(a.a)?s:s+a.a/500,v=isNaN(a.b)?s:s-a.b/200;return s=1*ml(s),l=.95047*ml(l),v=1.08883*ml(v),new hr(el(3.2404542*l-1.5371385*s-.4985314*v),el(-.969266*l+1.8760108*s+.041556*v),el(.0556434*l-.2040259*s+1.0572252*v),a.alpha)}function I(a,s,l){var v=s-a;return a+l*(v>180||v<-180?v-360*Math.round(v/360):v)}var U={forward:Rl,reverse:x,interpolate:function(a,s,l){return{l:zi(a.l,s.l,l),a:zi(a.a,s.a,l),b:zi(a.b,s.b,l),alpha:zi(a.alpha,s.alpha,l)}}},R={forward:function(a){var s=Rl(a),l=s.l,v=s.a,_=s.b,E=Math.atan2(_,v)*Os;return{h:E<0?E+360:E,c:Math.sqrt(v*v+_*_),l,alpha:a.a}},reverse:function(a){var s=a.h*cf,l=a.c;return x({l:a.l,a:Math.cos(s)*l,b:Math.sin(s)*l,alpha:a.alpha})},interpolate:function(a,s,l){return{h:I(a.h,s.h,l),c:zi(a.c,s.c,l),l:zi(a.l,s.l,l),alpha:zi(a.alpha,s.alpha,l)}}},ne=Object.freeze({__proto__:null,lab:U,hcl:R}),ke=function(a,s,l,v,_){this.type=a,this.operator=s,this.interpolation=l,this.input=v,this.labels=[],this.outputs=[];for(var E=0,w=_;E<w.length;E+=1){var L=w[E],B=L[1];this.labels.push(L[0]),this.outputs.push(B)}};function it(a,s,l,v){var _=v-l,E=a-l;return _===0?0:s===1?E/_:(Math.pow(s,E)-1)/(Math.pow(s,_)-1)}ke.interpolationFactor=function(a,s,l,v){var _=0;if(a.name==="exponential")_=it(s,a.base,l,v);else if(a.name==="linear")_=it(s,1,l,v);else if(a.name==="cubic-bezier"){var E=a.controlPoints;_=new T(E[0],E[1],E[2],E[3]).solve(it(s,1,l,v))}return _},ke.parse=function(a,s){var l=a[0],v=a[1],_=a[2],E=a.slice(3);if(!Array.isArray(v)||v.length===0)return s.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){var w=v[1];if(typeof w!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:w}}else{if(v[0]!=="cubic-bezier")return s.error("Unknown interpolation type "+String(v[0]),1,0);var L=v.slice(1);if(L.length!==4||L.some(function(st){return typeof st!="number"||st<0||st>1}))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:L}}if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(!(_=s.parse(_,2,Ht)))return null;var B=[],V=null;l==="interpolate-hcl"||l==="interpolate-lab"?V=pn:s.expectedType&&s.expectedType.kind!=="value"&&(V=s.expectedType);for(var W=0;W<E.length;W+=2){var $=E[W],le=E[W+1],ve=W+3,Ue=W+4;if(typeof $!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ve);if(B.length&&B[B.length-1][0]>=$)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ve);var Ve=s.parse(le,Ue,V);if(!Ve)return null;V=V||Ve.type,B.push([$,Ve])}return V.kind==="number"||V.kind==="color"||V.kind==="array"&&V.itemType.kind==="number"&&typeof V.N=="number"?new ke(V,l,v,_,B):s.error("Type "+Ii(V)+" is not interpolatable.")},ke.prototype.evaluate=function(a){var s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(a);var v=this.input.evaluate(a);if(v<=s[0])return l[0].evaluate(a);var _=s.length;if(v>=s[_-1])return l[_-1].evaluate(a);var E=uu(s,v),w=ke.interpolationFactor(this.interpolation,v,s[E],s[E+1]),L=l[E].evaluate(a),B=l[E+1].evaluate(a);return this.operator==="interpolate"?Pa[this.type.kind.toLowerCase()](L,B,w):this.operator==="interpolate-hcl"?R.reverse(R.interpolate(R.forward(L),R.forward(B),w)):U.reverse(U.interpolate(U.forward(L),U.forward(B),w))},ke.prototype.eachChild=function(a){a(this.input);for(var s=0,l=this.outputs;s<l.length;s+=1)a(l[s])},ke.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},ke.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var s=[this.operator,a,this.input.serialize()],l=0;l<this.labels.length;l++)s.push(this.labels[l],this.outputs[l].serialize());return s};var Pt=function(a,s){this.type=a,this.args=s};Pt.parse=function(a,s){if(a.length<2)return s.error("Expectected at least one argument.");var l=null,v=s.expectedType;v&&v.kind!=="value"&&(l=v);for(var _=[],E=0,w=a.slice(1);E<w.length;E+=1){var L=s.parse(w[E],1+_.length,l,void 0,{typeAnnotation:"omit"});if(!L)return null;l=l||L.type,_.push(L)}var B=v&&_.some(function(V){return Qi(v,V.type)});return new Pt(B?yn:l,_)},Pt.prototype.evaluate=function(a){for(var s,l=null,v=0,_=0,E=this.args;_<E.length&&(v++,(l=E[_].evaluate(a))&&l instanceof $e&&!l.available&&(s||(s=l.name),l=null,v===this.args.length&&(l=s)),l===null);_+=1);return l},Pt.prototype.eachChild=function(a){this.args.forEach(a)},Pt.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Pt.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Lt=function(a,s){this.type=s.type,this.bindings=[].concat(a),this.result=s};Lt.prototype.evaluate=function(a){return this.result.evaluate(a)},Lt.prototype.eachChild=function(a){for(var s=0,l=this.bindings;s<l.length;s+=1)a(l[s][1]);a(this.result)},Lt.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var l=[],v=1;v<a.length-1;v+=2){var _=a[v];if(typeof _!="string")return s.error("Expected string, but found "+typeof _+" instead.",v);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",v);var E=s.parse(a[v+1],v+1);if(!E)return null;l.push([_,E])}var w=s.parse(a[a.length-1],a.length-1,s.expectedType,l);return w?new Lt(l,w):null},Lt.prototype.outputDefined=function(){return this.result.outputDefined()},Lt.prototype.serialize=function(){for(var a=["let"],s=0,l=this.bindings;s<l.length;s+=1){var v=l[s];a.push(v[0],v[1].serialize())}return a.push(this.result.serialize()),a};var yr=function(a,s,l){this.type=a,this.index=s,this.input=l};yr.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var l=s.parse(a[1],1,Ht),v=s.parse(a[2],2,yt(s.expectedType||yn));return l&&v?new yr(v.type.itemType,l,v):null},yr.prototype.evaluate=function(a){var s=this.index.evaluate(a),l=this.input.evaluate(a);if(s<0)throw new Wa("Array index out of bounds: "+s+" < 0.");if(s>=l.length)throw new Wa("Array index out of bounds: "+s+" > "+(l.length-1)+".");if(s!==Math.floor(s))throw new Wa("Array index must be an integer, but found "+s+" instead.");return l[s]},yr.prototype.eachChild=function(a){a(this.index),a(this.input)},yr.prototype.outputDefined=function(){return!1},yr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Lr=function(a,s){this.type=sn,this.needle=a,this.haystack=s};Lr.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var l=s.parse(a[1],1,yn),v=s.parse(a[2],2,yn);return l&&v?Ji(l.type,[sn,xn,Ht,An,yn])?new Lr(l,v):s.error("Expected first argument to be of type boolean, string, number or null, but found "+Ii(l.type)+" instead"):null},Lr.prototype.evaluate=function(a){var s=this.needle.evaluate(a),l=this.haystack.evaluate(a);if(!l)return!1;if(!oa(s,["boolean","string","number","null"]))throw new Wa("Expected first argument to be of type boolean, string, number or null, but found "+Ii(ia(s))+" instead.");if(!oa(l,["string","array"]))throw new Wa("Expected second argument to be of type array or string, but found "+Ii(ia(l))+" instead.");return l.indexOf(s)>=0},Lr.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},Lr.prototype.outputDefined=function(){return!0},Lr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Hn=function(a,s,l){this.type=Ht,this.needle=a,this.haystack=s,this.fromIndex=l};Hn.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var l=s.parse(a[1],1,yn),v=s.parse(a[2],2,yn);if(!l||!v)return null;if(!Ji(l.type,[sn,xn,Ht,An,yn]))return s.error("Expected first argument to be of type boolean, string, number or null, but found "+Ii(l.type)+" instead");if(a.length===4){var _=s.parse(a[3],3,Ht);return _?new Hn(l,v,_):null}return new Hn(l,v)},Hn.prototype.evaluate=function(a){var s=this.needle.evaluate(a),l=this.haystack.evaluate(a);if(!oa(s,["boolean","string","number","null"]))throw new Wa("Expected first argument to be of type boolean, string, number or null, but found "+Ii(ia(s))+" instead.");if(!oa(l,["string","array"]))throw new Wa("Expected second argument to be of type array or string, but found "+Ii(ia(l))+" instead.");if(this.fromIndex){var v=this.fromIndex.evaluate(a);return l.indexOf(s,v)}return l.indexOf(s)},Hn.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},Hn.prototype.outputDefined=function(){return!1},Hn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Jn=function(a,s,l,v,_,E){this.inputType=a,this.type=s,this.input=l,this.cases=v,this.outputs=_,this.otherwise=E};Jn.parse=function(a,s){if(a.length<5)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return s.error("Expected an even number of arguments.");var l,v;s.expectedType&&s.expectedType.kind!=="value"&&(v=s.expectedType);for(var _={},E=[],w=2;w<a.length-1;w+=2){var L=a[w],B=a[w+1];Array.isArray(L)||(L=[L]);var V=s.concat(w);if(L.length===0)return V.error("Expected at least one branch label.");for(var W=0,$=L;W<$.length;W+=1){var le=$[W];if(typeof le!="number"&&typeof le!="string")return V.error("Branch labels must be numbers or strings.");if(typeof le=="number"&&Math.abs(le)>Number.MAX_SAFE_INTEGER)return V.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof le=="number"&&Math.floor(le)!==le)return V.error("Numeric branch labels must be integer values.");if(l){if(V.checkSubtype(l,ia(le)))return null}else l=ia(le);if(_[String(le)]!==void 0)return V.error("Branch labels must be unique.");_[String(le)]=E.length}var ve=s.parse(B,w,v);if(!ve)return null;v=v||ve.type,E.push(ve)}var Ue=s.parse(a[1],1,yn);if(!Ue)return null;var Ve=s.parse(a[a.length-1],a.length-1,v);return Ve?Ue.type.kind!=="value"&&s.concat(1).checkSubtype(l,Ue.type)?null:new Jn(l,v,Ue,_,E,Ve):null},Jn.prototype.evaluate=function(a){var s=this.input.evaluate(a);return(ia(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(a)},Jn.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},Jn.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},Jn.prototype.serialize=function(){for(var a=this,s=["match",this.input.serialize()],l=[],v={},_=0,E=Object.keys(this.cases).sort();_<E.length;_+=1){var w=E[_];($=v[this.cases[w]])===void 0?(v[this.cases[w]]=l.length,l.push([this.cases[w],[w]])):l[$][1].push(w)}for(var L=function(ve){return a.inputType.kind==="number"?Number(ve):ve},B=0,V=l;B<V.length;B+=1){var W=V[B],$=W[0],le=W[1];s.push(le.length===1?L(le[0]):le.map(L)),s.push(this.outputs[outputIndex$1].serialize())}return s.push(this.otherwise.serialize()),s};var vi=function(a,s,l){this.type=a,this.branches=s,this.otherwise=l};vi.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return s.error("Expected an odd number of arguments.");var l;s.expectedType&&s.expectedType.kind!=="value"&&(l=s.expectedType);for(var v=[],_=1;_<a.length-1;_+=2){var E=s.parse(a[_],_,sn);if(!E)return null;var w=s.parse(a[_+1],_+1,l);if(!w)return null;v.push([E,w]),l=l||w.type}var L=s.parse(a[a.length-1],a.length-1,l);return L?new vi(l,v,L):null},vi.prototype.evaluate=function(a){for(var s=0,l=this.branches;s<l.length;s+=1){var v=l[s],_=v[1];if(v[0].evaluate(a))return _.evaluate(a)}return this.otherwise.evaluate(a)},vi.prototype.eachChild=function(a){for(var s=0,l=this.branches;s<l.length;s+=1){var v=l[s],_=v[1];a(v[0]),a(_)}a(this.otherwise)},vi.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},vi.prototype.serialize=function(){var a=["case"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Yi=function(a,s,l,v){this.type=a,this.input=s,this.beginIndex=l,this.endIndex=v};function ba(a,s){return a==="=="||a==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Ra(a,s,l,v){return v.compare(s,l)===0}function $i(a,s,l){var v=a!=="=="&&a!=="!=";return function(){function _(E,w,L){this.type=sn,this.lhs=E,this.rhs=w,this.collator=L,this.hasUntypedArgument=E.type.kind==="value"||w.type.kind==="value"}return _.parse=function(E,w){if(E.length!==3&&E.length!==4)return w.error("Expected two or three arguments.");var L=E[0],B=w.parse(E[1],1,yn);if(!B)return null;if(!ba(L,B.type))return w.concat(1).error('"'+L+`" comparisons are not supported for type '`+Ii(B.type)+"'.");var V=w.parse(E[2],2,yn);if(!V)return null;if(!ba(L,V.type))return w.concat(2).error('"'+L+`" comparisons are not supported for type '`+Ii(V.type)+"'.");if(B.type.kind!==V.type.kind&&B.type.kind!=="value"&&V.type.kind!=="value")return w.error("Cannot compare types '"+Ii(B.type)+"' and '"+Ii(V.type)+"'.");v&&(B.type.kind==="value"&&V.type.kind!=="value"?B=new sa(V.type,[B]):B.type.kind!=="value"&&V.type.kind==="value"&&(V=new sa(B.type,[V])));var W=null;if(E.length===4){if(B.type.kind!=="string"&&V.type.kind!=="string"&&B.type.kind!=="value"&&V.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(!(W=w.parse(E[3],3,Pi)))return null}return new _(B,V,W)},_.prototype.evaluate=function(E){var w=this.lhs.evaluate(E),L=this.rhs.evaluate(E);if(v&&this.hasUntypedArgument){var B=ia(w),V=ia(L);if(B.kind!==V.kind||B.kind!=="string"&&B.kind!=="number")throw new Wa('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+B.kind+", "+V.kind+") instead.")}if(this.collator&&!v&&this.hasUntypedArgument){var W=ia(w),$=ia(L);if(W.kind!=="string"||$.kind!=="string")return s(E,w,L)}return this.collator?l(E,w,L,this.collator.evaluate(E)):s(E,w,L)},_.prototype.eachChild=function(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)},_.prototype.outputDefined=function(){return!0},_.prototype.serialize=function(){var E=[a];return this.eachChild(function(w){E.push(w.serialize())}),E},_}()}Yi.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var l=s.parse(a[1],1,yn),v=s.parse(a[2],2,Ht);if(!l||!v)return null;if(!Ji(l.type,[yt(yn),xn,yn]))return s.error("Expected first argument to be of type array or string, but found "+Ii(l.type)+" instead");if(a.length===4){var _=s.parse(a[3],3,Ht);return _?new Yi(l.type,l,v,_):null}return new Yi(l.type,l,v)},Yi.prototype.evaluate=function(a){var s=this.input.evaluate(a),l=this.beginIndex.evaluate(a);if(!oa(s,["string","array"]))throw new Wa("Expected first argument to be of type array or string, but found "+Ii(ia(s))+" instead.");if(this.endIndex){var v=this.endIndex.evaluate(a);return s.slice(l,v)}return s.slice(l)},Yi.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},Yi.prototype.outputDefined=function(){return!1},Yi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ys=$i("==",function(a,s,l){return s===l},Ra),lu=$i("!=",function(a,s,l){return s!==l},function(a,s,l,v){return!Ra(0,s,l,v)}),gl=$i("<",function(a,s,l){return s<l},function(a,s,l,v){return v.compare(s,l)<0}),hf=$i(">",function(a,s,l){return s>l},function(a,s,l,v){return v.compare(s,l)>0}),yl=$i("<=",function(a,s,l){return s<=l},function(a,s,l,v){return v.compare(s,l)<=0}),zc=$i(">=",function(a,s,l){return s>=l},function(a,s,l,v){return v.compare(s,l)>=0}),Fu=function(a,s,l,v,_){this.type=xn,this.number=a,this.locale=s,this.currency=l,this.minFractionDigits=v,this.maxFractionDigits=_};Fu.parse=function(a,s){if(a.length!==3)return s.error("Expected two arguments.");var l=s.parse(a[1],1,Ht);if(!l)return null;var v=a[2];if(typeof v!="object"||Array.isArray(v))return s.error("NumberFormat options argument must be an object.");var _=null;if(v.locale&&!(_=s.parse(v.locale,1,xn)))return null;var E=null;if(v.currency&&!(E=s.parse(v.currency,1,xn)))return null;var w=null;if(v["min-fraction-digits"]&&!(w=s.parse(v["min-fraction-digits"],1,Ht)))return null;var L=null;return v["max-fraction-digits"]&&!(L=s.parse(v["max-fraction-digits"],1,Ht))?null:new Fu(l,_,E,w,L)},Fu.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},Fu.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},Fu.prototype.outputDefined=function(){return!1},Fu.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var Bu=function(a){this.type=Ht,this.input=a};Bu.parse=function(a,s){if(a.length!==2)return s.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var l=s.parse(a[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?s.error("Expected argument of type string or array, but found "+Ii(l.type)+" instead."):new Bu(l):null},Bu.prototype.evaluate=function(a){var s=this.input.evaluate(a);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Wa("Expected value to be of type string or array, but found "+Ii(ia(s))+" instead.")},Bu.prototype.eachChild=function(a){a(this.input)},Bu.prototype.outputDefined=function(){return!1},Bu.prototype.serialize=function(){var a=["length"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Nu={"==":ys,"!=":lu,">":hf,"<":gl,">=":zc,"<=":yl,array:sa,at:yr,boolean:sa,case:vi,coalesce:Pt,collator:Yo,format:Xo,image:rs,in:Lr,"index-of":Hn,interpolate:ke,"interpolate-hcl":ke,"interpolate-lab":ke,length:Bu,let:Lt,literal:Ja,match:Jn,number:sa,"number-format":Fu,object:sa,slice:Yi,step:gs,string:sa,"to-boolean":To,"to-color":To,"to-number":To,"to-string":To,var:Rs,within:Uo};function mo(a,s){var l=s[0],v=s[1],_=s[2],E=s[3];l=l.evaluate(a),v=v.evaluate(a),_=_.evaluate(a);var w=E?E.evaluate(a):1,L=ks(l,v,_,w);if(L)throw new Wa(L);return new hr(l/255*w,v/255*w,_/255*w,w)}function Gf(a,s){return a in s}function Uc(a,s){var l=s[a];return l===void 0?null:l}function _s(a){return{type:a}}function pf(a){return{result:"success",value:a}}function tl(a){return{result:"error",value:a}}function Qs(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Hf(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Zs(a){return!!a.expression&&a.expression.interpolated}function Ma(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Ol(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function bh(a){return a}function zu(a,s,l){return a!==void 0?a:s!==void 0?s:l!==void 0?l:void 0}function Zc(a,s,l,v,_){return zu(typeof l===_?v[l]:void 0,a.default,s.default)}function fp(a,s,l){if(Ma(l)!=="number")return zu(a.default,s.default);var v=a.stops.length;if(v===1||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[v-1][0])return a.stops[v-1][1];var _=uu(a.stops.map(function(E){return E[0]}),l);return a.stops[_][1]}function hp(a,s,l){var v=a.base!==void 0?a.base:1;if(Ma(l)!=="number")return zu(a.default,s.default);var _=a.stops.length;if(_===1||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[_-1][0])return a.stops[_-1][1];var E=uu(a.stops.map(function($){return $[0]}),l),w=function($,le,ve,Ue){var Ve=Ue-ve,st=$-ve;return Ve===0?0:le===1?st/Ve:(Math.pow(le,st)-1)/(Math.pow(le,Ve)-1)}(l,v,a.stops[E][0],a.stops[E+1][0]),L=a.stops[E][1],B=a.stops[E+1][1],V=Pa[s.type]||bh;if(a.colorSpace&&a.colorSpace!=="rgb"){var W=ne[a.colorSpace];V=function($,le){return W.reverse(W.interpolate(W.forward($),W.forward(le),w))}}return typeof L.evaluate=="function"?{evaluate:function(){for(var $=[],le=arguments.length;le--;)$[le]=arguments[le];var ve=L.evaluate.apply(void 0,$),Ue=B.evaluate.apply(void 0,$);if(ve!==void 0&&Ue!==void 0)return V(ve,Ue,w)}}:V(L,B,w)}function Wf(a,s,l){return s.type==="color"?l=hr.parse(l):s.type==="formatted"?l=Ta.fromString(l.toString()):s.type==="resolvedImage"?l=$e.fromString(l.toString()):Ma(l)===s.type||s.type==="enum"&&s.values[l]||(l=void 0),zu(l,a.default,s.default)}to.register(Nu,{error:[{kind:"error"},[xn],function(a,s){throw new Wa(s[0].evaluate(a))}],typeof:[xn,[yn],function(a,s){return Ii(ia(s[0].evaluate(a)))}],"to-rgba":[yt(Ht,4),[pn],function(a,s){return s[0].evaluate(a).toArray()}],rgb:[pn,[Ht,Ht,Ht],mo],rgba:[pn,[Ht,Ht,Ht,Ht],mo],has:{type:sn,overloads:[[[xn],function(a,s){return Gf(s[0].evaluate(a),a.properties())}],[[xn,bi],function(a,s){var l=s[1];return Gf(s[0].evaluate(a),l.evaluate(a))}]]},get:{type:yn,overloads:[[[xn],function(a,s){return Uc(s[0].evaluate(a),a.properties())}],[[xn,bi],function(a,s){var l=s[1];return Uc(s[0].evaluate(a),l.evaluate(a))}]]},"feature-state":[yn,[xn],function(a,s){return Uc(s[0].evaluate(a),a.featureState||{})}],properties:[bi,[],function(a){return a.properties()}],"geometry-type":[xn,[],function(a){return a.geometryType()}],id:[yn,[],function(a){return a.id()}],zoom:[Ht,[],function(a){return a.globals.zoom}],"heatmap-density":[Ht,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[Ht,[],function(a){return a.globals.lineProgress||0}],accumulated:[yn,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[Ht,_s(Ht),function(a,s){for(var l=0,v=0,_=s;v<_.length;v+=1)l+=_[v].evaluate(a);return l}],"*":[Ht,_s(Ht),function(a,s){for(var l=1,v=0,_=s;v<_.length;v+=1)l*=_[v].evaluate(a);return l}],"-":{type:Ht,overloads:[[[Ht,Ht],function(a,s){var l=s[1];return s[0].evaluate(a)-l.evaluate(a)}],[[Ht],function(a,s){return-s[0].evaluate(a)}]]},"/":[Ht,[Ht,Ht],function(a,s){var l=s[1];return s[0].evaluate(a)/l.evaluate(a)}],"%":[Ht,[Ht,Ht],function(a,s){var l=s[1];return s[0].evaluate(a)%l.evaluate(a)}],ln2:[Ht,[],function(){return Math.LN2}],pi:[Ht,[],function(){return Math.PI}],e:[Ht,[],function(){return Math.E}],"^":[Ht,[Ht,Ht],function(a,s){var l=s[1];return Math.pow(s[0].evaluate(a),l.evaluate(a))}],sqrt:[Ht,[Ht],function(a,s){return Math.sqrt(s[0].evaluate(a))}],log10:[Ht,[Ht],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN10}],ln:[Ht,[Ht],function(a,s){return Math.log(s[0].evaluate(a))}],log2:[Ht,[Ht],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN2}],sin:[Ht,[Ht],function(a,s){return Math.sin(s[0].evaluate(a))}],cos:[Ht,[Ht],function(a,s){return Math.cos(s[0].evaluate(a))}],tan:[Ht,[Ht],function(a,s){return Math.tan(s[0].evaluate(a))}],asin:[Ht,[Ht],function(a,s){return Math.asin(s[0].evaluate(a))}],acos:[Ht,[Ht],function(a,s){return Math.acos(s[0].evaluate(a))}],atan:[Ht,[Ht],function(a,s){return Math.atan(s[0].evaluate(a))}],min:[Ht,_s(Ht),function(a,s){return Math.min.apply(Math,s.map(function(l){return l.evaluate(a)}))}],max:[Ht,_s(Ht),function(a,s){return Math.max.apply(Math,s.map(function(l){return l.evaluate(a)}))}],abs:[Ht,[Ht],function(a,s){return Math.abs(s[0].evaluate(a))}],round:[Ht,[Ht],function(a,s){var l=s[0].evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[Ht,[Ht],function(a,s){return Math.floor(s[0].evaluate(a))}],ceil:[Ht,[Ht],function(a,s){return Math.ceil(s[0].evaluate(a))}],"filter-==":[sn,[xn,yn],function(a,s){var l=s[0],v=s[1];return a.properties()[l.value]===v.value}],"filter-id-==":[sn,[yn],function(a,s){var l=s[0];return a.id()===l.value}],"filter-type-==":[sn,[xn],function(a,s){var l=s[0];return a.geometryType()===l.value}],"filter-<":[sn,[xn,yn],function(a,s){var l=s[0],v=s[1],_=a.properties()[l.value],E=v.value;return typeof _==typeof E&&_<E}],"filter-id-<":[sn,[yn],function(a,s){var l=s[0],v=a.id(),_=l.value;return typeof v==typeof _&&v<_}],"filter->":[sn,[xn,yn],function(a,s){var l=s[0],v=s[1],_=a.properties()[l.value],E=v.value;return typeof _==typeof E&&_>E}],"filter-id->":[sn,[yn],function(a,s){var l=s[0],v=a.id(),_=l.value;return typeof v==typeof _&&v>_}],"filter-<=":[sn,[xn,yn],function(a,s){var l=s[0],v=s[1],_=a.properties()[l.value],E=v.value;return typeof _==typeof E&&_<=E}],"filter-id-<=":[sn,[yn],function(a,s){var l=s[0],v=a.id(),_=l.value;return typeof v==typeof _&&v<=_}],"filter->=":[sn,[xn,yn],function(a,s){var l=s[0],v=s[1],_=a.properties()[l.value],E=v.value;return typeof _==typeof E&&_>=E}],"filter-id->=":[sn,[yn],function(a,s){var l=s[0],v=a.id(),_=l.value;return typeof v==typeof _&&v>=_}],"filter-has":[sn,[yn],function(a,s){return s[0].value in a.properties()}],"filter-has-id":[sn,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[sn,[yt(xn)],function(a,s){return s[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[sn,[yt(yn)],function(a,s){return s[0].value.indexOf(a.id())>=0}],"filter-in-small":[sn,[xn,yt(yn)],function(a,s){var l=s[0];return s[1].value.indexOf(a.properties()[l.value])>=0}],"filter-in-large":[sn,[xn,yt(yn)],function(a,s){var l=s[0],v=s[1];return function(_,E,w,L){for(;w<=L;){var B=w+L>>1;if(E[B]===_)return!0;E[B]>_?L=B-1:w=B+1}return!1}(a.properties()[l.value],v.value,0,v.value.length-1)}],all:{type:sn,overloads:[[[sn,sn],function(a,s){var l=s[1];return s[0].evaluate(a)&&l.evaluate(a)}],[_s(sn),function(a,s){for(var l=0,v=s;l<v.length;l+=1)if(!v[l].evaluate(a))return!1;return!0}]]},any:{type:sn,overloads:[[[sn,sn],function(a,s){var l=s[1];return s[0].evaluate(a)||l.evaluate(a)}],[_s(sn),function(a,s){for(var l=0,v=s;l<v.length;l+=1)if(v[l].evaluate(a))return!0;return!1}]]},"!":[sn,[sn],function(a,s){return!s[0].evaluate(a)}],"is-supported-script":[sn,[xn],function(a,s){var l=a.globals&&a.globals.isSupportedScript;return!l||l(s[0].evaluate(a))}],upcase:[xn,[xn],function(a,s){return s[0].evaluate(a).toUpperCase()}],downcase:[xn,[xn],function(a,s){return s[0].evaluate(a).toLowerCase()}],concat:[xn,_s(yn),function(a,s){return s.map(function(l){return Us(l.evaluate(a))}).join("")}],"resolved-locale":[xn,[Pi],function(a,s){return s[0].evaluate(a).resolvedLocale()}]});var Vc=function(a,s){this.expression=a,this._warningHistory={},this._evaluator=new fa,this._defaultValue=s?function(l){return l.type==="color"&&Ol(l.default)?new hr(0,0,0,0):l.type==="color"?hr.parse(l.default)||null:l.default===void 0?null:l.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null};function lc(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Nu}function Dl(a,s){var l=new qs(Nu,[],s?function(_){var E={color:pn,string:xn,number:Ht,enum:xn,boolean:sn,formatted:aa,resolvedImage:vt};return _.type==="array"?yt(E[_.value]||yn,_.length):E[_.type]}(s):void 0),v=l.parse(a,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return v?pf(new Vc(v,s)):tl(l.errors)}Vc.prototype.evaluateWithoutErrorHandling=function(a,s,l,v,_,E){return this._evaluator.globals=a,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=v,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)},Vc.prototype.evaluate=function(a,s,l,v,_,E){this._evaluator.globals=a,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=v,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=E||null;try{var w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Wa("Expected value to be one of "+Object.keys(this._enumValues).map(function(L){return JSON.stringify(L)}).join(", ")+", but found "+JSON.stringify(w)+" instead.");return w}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console!="undefined"&&console.warn(L.message)),this._defaultValue}};var Fl=function(a,s){this.kind=a,this._styleExpression=s,this.isStateDependent=a!=="constant"&&!Ps(s.expression)};Fl.prototype.evaluateWithoutErrorHandling=function(a,s,l,v,_,E){return this._styleExpression.evaluateWithoutErrorHandling(a,s,l,v,_,E)},Fl.prototype.evaluate=function(a,s,l,v,_,E){return this._styleExpression.evaluate(a,s,l,v,_,E)};var _l=function(a,s,l,v){this.kind=a,this.zoomStops=l,this._styleExpression=s,this.isStateDependent=a!=="camera"&&!Ps(s.expression),this.interpolationType=v};function xl(a,s){if((a=Dl(a,s)).result==="error")return a;var l=a.value.expression,v=vo(l);if(!v&&!Qs(s))return tl([new Pr("","data expressions not supported")]);var _=Ls(l,["zoom"]);if(!_&&!Hf(s))return tl([new Pr("","zoom expressions not supported")]);var E=function w(L){var B=null;if(L instanceof Lt)B=w(L.result);else if(L instanceof Pt)for(var V=0,W=L.args;V<W.length&&!(B=w(W[V]));V+=1);else(L instanceof gs||L instanceof ke)&&L.input instanceof to&&L.input.name==="zoom"&&(B=L);return B instanceof Pr||L.eachChild(function($){var le=w($);le instanceof Pr?B=le:!B&&le?B=new Pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):B&&le&&B!==le&&(B=new Pr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),B}(l);return E||_?E instanceof Pr?tl([E]):E instanceof ke&&!Zs(s)?tl([new Pr("",'"interpolate" expressions cannot be used with this property')]):pf(E?new _l(v?"camera":"composite",a.value,E.labels,E instanceof ke?E.interpolation:void 0):new Fl(v?"constant":"source",a.value)):tl([new Pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}_l.prototype.evaluateWithoutErrorHandling=function(a,s,l,v,_,E){return this._styleExpression.evaluateWithoutErrorHandling(a,s,l,v,_,E)},_l.prototype.evaluate=function(a,s,l,v,_,E){return this._styleExpression.evaluate(a,s,l,v,_,E)},_l.prototype.interpolationFactor=function(a,s,l){return this.interpolationType?ke.interpolationFactor(this.interpolationType,a,s,l):0};var bl=function(a,s){this._parameters=a,this._specification=s,kr(this,function l(v,_){var E,w,L,B=_.type==="color",V=v.stops&&typeof v.stops[0][0]=="object",W=V||!(V||v.property!==void 0),$=v.type||(Zs(_)?"exponential":"interval");if(B&&((v=kr({},v)).stops&&(v.stops=v.stops.map(function(Mn){return[Mn[0],hr.parse(Mn[1])]})),v.default=hr.parse(v.default?v.default:_.default)),v.colorSpace&&v.colorSpace!=="rgb"&&!ne[v.colorSpace])throw new Error("Unknown color space: "+v.colorSpace);if($==="exponential")E=hp;else if($==="interval")E=fp;else if($==="categorical"){E=Zc,w=Object.create(null);for(var le=0,ve=v.stops;le<ve.length;le+=1){var Ue=ve[le];w[Ue[0]]=Ue[1]}L=typeof v.stops[0][0]}else{if($!=="identity")throw new Error('Unknown function type "'+$+'"');E=Wf}if(V){for(var Ve={},st=[],Qe=0;Qe<v.stops.length;Qe++){var St=v.stops[Qe],Vt=St[0].zoom;Ve[Vt]===void 0&&(Ve[Vt]={zoom:Vt,type:v.type,property:v.property,default:v.default,stops:[]},st.push(Vt)),Ve[Vt].stops.push([St[0].value,St[1]])}for(var ir=[],sr=0,Sr=st;sr<Sr.length;sr+=1){var Xr=Sr[sr];ir.push([Ve[Xr].zoom,l(Ve[Xr],_)])}var hn={name:"linear"};return{kind:"composite",interpolationType:hn,interpolationFactor:ke.interpolationFactor.bind(void 0,hn),zoomStops:ir.map(function(Mn){return Mn[0]}),evaluate:function(Mn,ni){var Pn=Mn.zoom;return hp({stops:ir,base:v.base},_,Pn).evaluate(Pn,ni)}}}if(W){var Kn=$==="exponential"?{name:"exponential",base:v.base!==void 0?v.base:1}:null;return{kind:"camera",interpolationType:Kn,interpolationFactor:ke.interpolationFactor.bind(void 0,Kn),zoomStops:v.stops.map(function(Mn){return Mn[0]}),evaluate:function(Mn){return E(v,_,Mn.zoom,w,L)}}}return{kind:"source",evaluate:function(Mn,ni){var Pn=ni&&ni.properties?ni.properties[v.property]:void 0;return Pn===void 0?zu(v.default,_.default):E(v,_,Pn,w,L)}}}(this._parameters,this._specification))};function Js(a){var s=a.key,l=a.value,v=a.valueSpec||{},_=a.objectElementValidators||{},E=a.style,w=a.styleSpec,L=[],B=Ma(l);if(B!=="object")return[new He(s,l,"object expected, "+B+" found")];for(var V in l){var W=V.split(".")[0],$=v[W]||v["*"],le=void 0;if(_[W])le=_[W];else if(v[W])le=qi;else if(_["*"])le=_["*"];else{if(!v["*"]){L.push(new He(s,l[V],'unknown property "'+V+'"'));continue}le=qi}L=L.concat(le({key:(s&&s+".")+V,value:l[V],valueSpec:$,style:E,styleSpec:w,object:l,objectKey:V},l))}for(var ve in v)_[ve]||v[ve].required&&v[ve].default===void 0&&l[ve]===void 0&&L.push(new He(s,l,'missing required property "'+ve+'"'));return L}function df(a){var s=a.value,l=a.valueSpec,v=a.style,_=a.styleSpec,E=a.key,w=a.arrayElementValidator||qi;if(Ma(s)!=="array")return[new He(E,s,"array expected, "+Ma(s)+" found")];if(l.length&&s.length!==l.length)return[new He(E,s,"array length "+l.length+" expected, length "+s.length+" found")];if(l["min-length"]&&s.length<l["min-length"])return[new He(E,s,"array length at least "+l["min-length"]+" expected, length "+s.length+" found")];var L={type:l.value,values:l.values};_.$version<7&&(L.function=l.function),Ma(l.value)==="object"&&(L=l.value);for(var B=[],V=0;V<s.length;V++)B=B.concat(w({array:s,arrayIndex:V,value:s[V],valueSpec:L,style:v,styleSpec:_,key:E+"["+V+"]"}));return B}function vf(a){var s=a.key,l=a.value,v=a.valueSpec,_=Ma(l);return _==="number"&&l!=l&&(_="NaN"),_!=="number"?[new He(s,l,"number expected, "+_+" found")]:"minimum"in v&&l<v.minimum?[new He(s,l,l+" is less than the minimum value "+v.minimum)]:"maximum"in v&&l>v.maximum?[new He(s,l,l+" is greater than the maximum value "+v.maximum)]:[]}function Bl(a){var s,l,v,_=a.valueSpec,E=Xt(a.value.type),w={},L=E!=="categorical"&&a.value.property===void 0,B=!L,V=Ma(a.value.stops)==="array"&&Ma(a.value.stops[0])==="array"&&Ma(a.value.stops[0][0])==="object",W=Js({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(ve){if(E==="identity")return[new He(ve.key,ve.value,'identity function may not have a "stops" property')];var Ue=[],Ve=ve.value;return Ue=Ue.concat(df({key:ve.key,value:Ve,valueSpec:ve.valueSpec,style:ve.style,styleSpec:ve.styleSpec,arrayElementValidator:$})),Ma(Ve)==="array"&&Ve.length===0&&Ue.push(new He(ve.key,Ve,"array must have at least one stop")),Ue},default:function(ve){return qi({key:ve.key,value:ve.value,valueSpec:_,style:ve.style,styleSpec:ve.styleSpec})}}});return E==="identity"&&L&&W.push(new He(a.key,a.value,'missing required property "property"')),E==="identity"||a.value.stops||W.push(new He(a.key,a.value,'missing required property "stops"')),E==="exponential"&&a.valueSpec.expression&&!Zs(a.valueSpec)&&W.push(new He(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(B&&!Qs(a.valueSpec)?W.push(new He(a.key,a.value,"property functions not supported")):L&&!Hf(a.valueSpec)&&W.push(new He(a.key,a.value,"zoom functions not supported"))),E!=="categorical"&&!V||a.value.property!==void 0||W.push(new He(a.key,a.value,'"property" property is required')),W;function $(ve){var Ue=[],Ve=ve.value,st=ve.key;if(Ma(Ve)!=="array")return[new He(st,Ve,"array expected, "+Ma(Ve)+" found")];if(Ve.length!==2)return[new He(st,Ve,"array length 2 expected, length "+Ve.length+" found")];if(V){if(Ma(Ve[0])!=="object")return[new He(st,Ve,"object expected, "+Ma(Ve[0])+" found")];if(Ve[0].zoom===void 0)return[new He(st,Ve,"object stop key must have zoom")];if(Ve[0].value===void 0)return[new He(st,Ve,"object stop key must have value")];if(v&&v>Xt(Ve[0].zoom))return[new He(st,Ve[0].zoom,"stop zoom values must appear in ascending order")];Xt(Ve[0].zoom)!==v&&(v=Xt(Ve[0].zoom),l=void 0,w={}),Ue=Ue.concat(Js({key:st+"[0]",value:Ve[0],valueSpec:{zoom:{}},style:ve.style,styleSpec:ve.styleSpec,objectElementValidators:{zoom:vf,value:le}}))}else Ue=Ue.concat(le({key:st+"[0]",value:Ve[0],valueSpec:{},style:ve.style,styleSpec:ve.styleSpec},Ve));return lc(er(Ve[1]))?Ue.concat([new He(st+"[1]",Ve[1],"expressions are not allowed in function stops.")]):Ue.concat(qi({key:st+"[1]",value:Ve[1],valueSpec:_,style:ve.style,styleSpec:ve.styleSpec}))}function le(ve,Ue){var Ve=Ma(ve.value),st=Xt(ve.value),Qe=ve.value!==null?ve.value:Ue;if(s){if(Ve!==s)return[new He(ve.key,Qe,Ve+" stop domain type must match previous stop domain type "+s)]}else s=Ve;if(Ve!=="number"&&Ve!=="string"&&Ve!=="boolean")return[new He(ve.key,Qe,"stop domain value must be a number, string, or boolean")];if(Ve!=="number"&&E!=="categorical"){var St="number expected, "+Ve+" found";return Qs(_)&&E===void 0&&(St+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new He(ve.key,Qe,St)]}return E!=="categorical"||Ve!=="number"||isFinite(st)&&Math.floor(st)===st?E!=="categorical"&&Ve==="number"&&l!==void 0&&st<l?[new He(ve.key,Qe,"stop domain values must appear in ascending order")]:(l=st,E==="categorical"&&st in w?[new He(ve.key,Qe,"stop domain values must be unique")]:(w[st]=!0,[])):[new He(ve.key,Qe,"integer expected, found "+st)]}}function El(a){var s=(a.expressionContext==="property"?xl:Dl)(er(a.value),a.valueSpec);if(s.result==="error")return s.value.map(function(v){return new He(""+a.key+v.key,a.value,v.message)});var l=s.value.expression||s.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!l.outputDefined())return[new He(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Ps(l))return[new He(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Ps(l))return[new He(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Ls(l,["zoom","feature-state"]))return[new He(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!vo(l))return[new He(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function cc(a){var s=a.key,l=a.value,v=a.valueSpec,_=[];return Array.isArray(v.values)?v.values.indexOf(Xt(l))===-1&&_.push(new He(s,l,"expected one of ["+v.values.join(", ")+"], "+JSON.stringify(l)+" found")):Object.keys(v.values).indexOf(Xt(l))===-1&&_.push(new He(s,l,"expected one of ["+Object.keys(v.values).join(", ")+"], "+JSON.stringify(l)+" found")),_}function jc(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var s=0,l=a.slice(1);s<l.length;s+=1){var v=l[s];if(!jc(v)&&typeof v!="boolean")return!1}return!0;default:return!0}}bl.deserialize=function(a){return new bl(a._parameters,a._specification)},bl.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var fc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function mf(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};jc(a)||(a=gf(a));var s=Dl(a,fc);if(s.result==="error")throw new Error(s.value.map(function(l){return l.key+": "+l.message}).join(", "));return{filter:function(l,v,_){return s.value.evaluate(l,v,{},_)},needGeometry:function l(v){if(!Array.isArray(v))return!1;if(v[0]==="within")return!0;for(var _=1;_<v.length;_++)if(l(v[_]))return!0;return!1}(a)}}function pp(a,s){return a<s?-1:a>s?1:0}function gf(a){if(!a)return!0;var s,l=a[0];return a.length<=1?l!=="any":l==="=="?Sl(a[1],a[2],"=="):l==="!="?Uu(Sl(a[1],a[2],"==")):l==="<"||l===">"||l==="<="||l===">="?Sl(a[1],a[2],l):l==="any"?(s=a.slice(1),["any"].concat(s.map(gf))):l==="all"?["all"].concat(a.slice(1).map(gf)):l==="none"?["all"].concat(a.slice(1).map(gf).map(Uu)):l==="in"?yf(a[1],a.slice(2)):l==="!in"?Uu(yf(a[1],a.slice(2))):l==="has"?Xf(a[1]):l==="!has"?Uu(Xf(a[1])):l!=="within"||a}function Sl(a,s,l){switch(a){case"$type":return["filter-type-"+l,s];case"$id":return["filter-id-"+l,s];default:return["filter-"+l,a,s]}}function yf(a,s){if(s.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(function(l){return typeof l!=typeof s[0]})?["filter-in-large",a,["literal",s.sort(pp)]]:["filter-in-small",a,["literal",s]]}}function Xf(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Uu(a){return["!",a]}function Eh(a){return jc(er(a.value))?El(kr({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function s(l){var v=l.value,_=l.key;if(Ma(v)!=="array")return[new He(_,v,"array expected, "+Ma(v)+" found")];var E,w=l.styleSpec,L=[];if(v.length<1)return[new He(_,v,"filter array must have at least 1 element")];switch(L=L.concat(cc({key:_+"[0]",value:v[0],valueSpec:w.filter_operator,style:l.style,styleSpec:l.styleSpec})),Xt(v[0])){case"<":case"<=":case">":case">=":v.length>=2&&Xt(v[1])==="$type"&&L.push(new He(_,v,'"$type" cannot be use with operator "'+v[0]+'"'));case"==":case"!=":v.length!==3&&L.push(new He(_,v,'filter array for operator "'+v[0]+'" must have 3 elements'));case"in":case"!in":v.length>=2&&(E=Ma(v[1]))!=="string"&&L.push(new He(_+"[1]",v[1],"string expected, "+E+" found"));for(var B=2;B<v.length;B++)E=Ma(v[B]),Xt(v[1])==="$type"?L=L.concat(cc({key:_+"["+B+"]",value:v[B],valueSpec:w.geometry_type,style:l.style,styleSpec:l.styleSpec})):E!=="string"&&E!=="number"&&E!=="boolean"&&L.push(new He(_+"["+B+"]",v[B],"string, number, or boolean expected, "+E+" found"));break;case"any":case"all":case"none":for(var V=1;V<v.length;V++)L=L.concat(s({key:_+"["+V+"]",value:v[V],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":E=Ma(v[1]),v.length!==2?L.push(new He(_,v,'filter array for "'+v[0]+'" operator must have 2 elements')):E!=="string"&&L.push(new He(_+"[1]",v[1],"string expected, "+E+" found"));break;case"within":E=Ma(v[1]),v.length!==2?L.push(new He(_,v,'filter array for "'+v[0]+'" operator must have 2 elements')):E!=="object"&&L.push(new He(_+"[1]",v[1],"object expected, "+E+" found"))}return L}(a)}function Sh(a,s){var l=a.key,v=a.style,_=a.styleSpec,E=a.value,w=a.objectKey,L=_[s+"_"+a.layerType];if(!L)return[];var B=w.match(/^(.*)-transition$/);if(s==="paint"&&B&&L[B[1]]&&L[B[1]].transition)return qi({key:l,value:E,valueSpec:_.transition,style:v,styleSpec:_});var V,W=a.valueSpec||L[w];if(!W)return[new He(l,E,'unknown property "'+w+'"')];if(Ma(E)==="string"&&Qs(W)&&!W.tokens&&(V=/^{([^}]+)}$/.exec(E)))return[new He(l,E,'"'+w+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(V[1])+" }`.")];var $=[];return a.layerType==="symbol"&&(w==="text-field"&&v&&!v.glyphs&&$.push(new He(l,E,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Ol(er(E))&&Xt(E.type)==="identity"&&$.push(new He(l,E,'"text-font" does not support identity functions'))),$.concat(qi({key:a.key,value:E,valueSpec:W,style:v,styleSpec:_,expressionContext:"property",propertyType:s,propertyKey:w}))}function Ch(a){return Sh(a,"paint")}function Nl(a){return Sh(a,"layout")}function wh(a){var s=[],l=a.value,v=a.key,_=a.style,E=a.styleSpec;l.type||l.ref||s.push(new He(v,l,'either "type" or "ref" is required'));var w,L=Xt(l.type),B=Xt(l.ref);if(l.id)for(var V=Xt(l.id),W=0;W<a.arrayIndex;W++){var $=_.layers[W];Xt($.id)===V&&s.push(new He(v,l.id,'duplicate layer id "'+l.id+'", previously used at line '+$.id.__line__))}if("ref"in l)["type","source","source-layer","filter","layout"].forEach(function(Ue){Ue in l&&s.push(new He(v,l[Ue],'"'+Ue+'" is prohibited for ref layers'))}),_.layers.forEach(function(Ue){Xt(Ue.id)===B&&(w=Ue)}),w?w.ref?s.push(new He(v,l.ref,"ref cannot reference another ref layer")):L=Xt(w.type):s.push(new He(v,l.ref,'ref layer "'+B+'" not found'));else if(L!=="background")if(l.source){var le=_.sources&&_.sources[l.source],ve=le&&Xt(le.type);le?ve==="vector"&&L==="raster"?s.push(new He(v,l.source,'layer "'+l.id+'" requires a raster source')):ve==="raster"&&L!=="raster"?s.push(new He(v,l.source,'layer "'+l.id+'" requires a vector source')):ve!=="vector"||l["source-layer"]?ve==="raster-dem"&&L!=="hillshade"?s.push(new He(v,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="line"||!l.paint||!l.paint["line-gradient"]||ve==="geojson"&&le.lineMetrics||s.push(new He(v,l,'layer "'+l.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):s.push(new He(v,l,'layer "'+l.id+'" must specify a "source-layer"')):s.push(new He(v,l.source,'source "'+l.source+'" not found'))}else s.push(new He(v,l,'missing required property "source"'));return s=s.concat(Js({key:v,value:l,valueSpec:E.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return qi({key:v+".type",value:l.type,valueSpec:E.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"})},filter:Eh,layout:function(Ue){return Js({layer:l,key:Ue.key,value:Ue.value,style:Ue.style,styleSpec:Ue.styleSpec,objectElementValidators:{"*":function(Ve){return Nl(kr({layerType:L},Ve))}}})},paint:function(Ue){return Js({layer:l,key:Ue.key,value:Ue.value,style:Ue.style,styleSpec:Ue.styleSpec,objectElementValidators:{"*":function(Ve){return Ch(kr({layerType:L},Ve))}}})}}}))}function as(a){var s=a.value,l=a.key,v=Ma(s);return v!=="string"?[new He(l,s,"string expected, "+v+" found")]:[]}var Qa={promoteId:function(a){var s=a.key,l=a.value;if(Ma(l)==="string")return as({key:s,value:l});var v=[];for(var _ in l)v.push.apply(v,as({key:s+"."+_,value:l[_]}));return v}};function ha(a){var s=a.value,l=a.key,v=a.styleSpec,_=a.style;if(!s.type)return[new He(l,s,'"type" is required')];var E,w=Xt(s.type);switch(w){case"vector":case"raster":case"raster-dem":return Js({key:l,value:s,valueSpec:v["source_"+w.replace("-","_")],style:a.style,styleSpec:v,objectElementValidators:Qa});case"geojson":if(E=Js({key:l,value:s,valueSpec:v.source_geojson,style:_,styleSpec:v,objectElementValidators:Qa}),s.cluster)for(var L in s.clusterProperties){var B=s.clusterProperties[L],V=B[0],W=typeof V=="string"?[V,["accumulated"],["get",L]]:V;E.push.apply(E,El({key:l+"."+L+".map",value:B[1],expressionContext:"cluster-map"})),E.push.apply(E,El({key:l+"."+L+".reduce",value:W,expressionContext:"cluster-reduce"}))}return E;case"video":return Js({key:l,value:s,valueSpec:v.source_video,style:_,styleSpec:v});case"image":return Js({key:l,value:s,valueSpec:v.source_image,style:_,styleSpec:v});case"canvas":return[new He(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return cc({key:l+".type",value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,styleSpec:v})}}function zl(a){var s=a.value,l=a.styleSpec,v=l.light,_=a.style,E=[],w=Ma(s);if(s===void 0)return E;if(w!=="object")return E.concat([new He("light",s,"object expected, "+w+" found")]);for(var L in s){var B=L.match(/^(.*)-transition$/);E=E.concat(B&&v[B[1]]&&v[B[1]].transition?qi({key:L,value:s[L],valueSpec:l.transition,style:_,styleSpec:l}):v[L]?qi({key:L,value:s[L],valueSpec:v[L],style:_,styleSpec:l}):[new He(L,s[L],'unknown property "'+L+'"')])}return E}var rl={"*":function(){return[]},array:df,boolean:function(a){var s=a.value,l=a.key,v=Ma(s);return v!=="boolean"?[new He(l,s,"boolean expected, "+v+" found")]:[]},number:vf,color:function(a){var s=a.key,l=a.value,v=Ma(l);return v!=="string"?[new He(s,l,"color expected, "+v+" found")]:Ri(l)===null?[new He(s,l,'color expected, "'+l+'" found')]:[]},constants:Rt,enum:cc,filter:Eh,function:Bl,layer:wh,object:Js,source:ha,light:zl,string:as,formatted:function(a){return as(a).length===0?[]:El(a)},resolvedImage:function(a){return as(a).length===0?[]:El(a)}};function qi(a){var s=a.value,l=a.valueSpec,v=a.styleSpec;return l.expression&&Ol(Xt(s))?Bl(a):l.expression&&lc(er(s))?El(a):l.type&&rl[l.type]?rl[l.type](a):Js(kr({},a,{valueSpec:l.type?v[l.type]:l}))}function Oa(a){var s=a.value,l=a.key,v=as(a);return v.length||(s.indexOf("{fontstack}")===-1&&v.push(new He(l,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&v.push(new He(l,s,'"glyphs" url must include a "{range}" token'))),v}function Fs(a,s){s===void 0&&(s=be);var l=[];return l=l.concat(qi({key:"",value:a,valueSpec:s.$root,styleSpec:s,style:a,objectElementValidators:{glyphs:Oa,"*":function(){return[]}}})),a.constants&&(l=l.concat(Rt({key:"constants",value:a.constants,style:a,styleSpec:s}))),Gc(l)}function Gc(a){return[].concat(a).sort(function(s,l){return s.line-l.line})}function Ia(a){return function(){for(var s=[],l=arguments.length;l--;)s[l]=arguments[l];return Gc(a.apply(this,s))}}Fs.source=Ia(ha),Fs.light=Ia(zl),Fs.layer=Ia(wh),Fs.filter=Ia(Eh),Fs.paintProperty=Ia(Ch),Fs.layoutProperty=Ia(Nl);var Zu=Fs,Ul=Zu.light,Hc=Zu.paintProperty,Wc=Zu.layoutProperty;function hc(a,s){var l=!1;if(s&&s.length)for(var v=0,_=s;v<_.length;v+=1)a.fire(new et(new Error(_[v].message))),l=!0;return l}var Eu=Io;function Io(a,s,l){var v=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var _=new Int32Array(this.arrayBuffer);a=_[0],this.d=(s=_[1])+2*(l=_[2]);for(var E=0;E<this.d*this.d;E++){var w=_[3+E],L=_[3+E+1];v.push(w===L?null:_.subarray(w,L))}var B=_[3+v.length+1];this.keys=_.subarray(_[3+v.length],B),this.bboxes=_.subarray(B),this.insert=this._insertReadonly}else{this.d=s+2*l;for(var V=0;V<this.d*this.d;V++)v.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=a,this.padding=l,this.scale=s/a,this.uid=0;var W=l/s*a;this.min=-W,this.max=a+W}Io.prototype.insert=function(a,s,l,v,_){this._forEachCell(s,l,v,_,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(v),this.bboxes.push(_)},Io.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Io.prototype._insertCell=function(a,s,l,v,_,E){this.cells[_].push(E)},Io.prototype.query=function(a,s,l,v,_){var E=this.min,w=this.max;if(a<=E&&s<=E&&w<=l&&w<=v&&!_)return Array.prototype.slice.call(this.keys);var L=[];return this._forEachCell(a,s,l,v,this._queryCell,L,{},_),L},Io.prototype._queryCell=function(a,s,l,v,_,E,w,L){var B=this.cells[_];if(B!==null)for(var V=this.keys,W=this.bboxes,$=0;$<B.length;$++){var le=B[$];if(w[le]===void 0){var ve=4*le;(L?L(W[ve+0],W[ve+1],W[ve+2],W[ve+3]):a<=W[ve+2]&&s<=W[ve+3]&&l>=W[ve+0]&&v>=W[ve+1])?(w[le]=!0,E.push(V[le])):w[le]=!1}}},Io.prototype._forEachCell=function(a,s,l,v,_,E,w,L){for(var B=this._convertToCellCoord(a),V=this._convertToCellCoord(s),W=this._convertToCellCoord(l),$=this._convertToCellCoord(v),le=B;le<=W;le++)for(var ve=V;ve<=$;ve++){var Ue=this.d*ve+le;if((!L||L(this._convertFromCellCoord(le),this._convertFromCellCoord(ve),this._convertFromCellCoord(le+1),this._convertFromCellCoord(ve+1)))&&_.call(this,a,s,l,v,Ue,E,w,L))return}},Io.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Io.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Io.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,s=3+this.cells.length+1+1,l=0,v=0;v<this.cells.length;v++)l+=this.cells[v].length;var _=new Int32Array(s+l+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var E=s,w=0;w<a.length;w++){var L=a[w];_[3+w]=E,_.set(L,E),E+=L.length}return _[3+a.length]=E,_.set(this.keys,E),_[3+a.length+1]=E+=this.keys.length,_.set(this.bboxes,E),E+=this.bboxes.length,_.buffer};var pc=_e.ImageData,Zl=_e.ImageBitmap,ko={};function Rn(a,s,l){l===void 0&&(l={}),Object.defineProperty(s,"_classRegistryKey",{value:a,writeable:!1}),ko[a]={klass:s,omit:l.omit||[],shallow:l.shallow||[]}}for(var lo in Rn("Object",Object),Eu.serialize=function(a,s){var l=a.toArrayBuffer();return s&&s.push(l),{buffer:l}},Eu.deserialize=function(a){return new Eu(a.buffer)},Rn("Grid",Eu),Rn("Color",hr),Rn("Error",Error),Rn("ResolvedImage",$e),Rn("StylePropertyFunction",bl),Rn("StyleExpression",Vc,{omit:["_evaluator"]}),Rn("ZoomDependentExpression",_l),Rn("ZoomConstantExpression",Fl),Rn("CompoundExpression",to,{omit:["_evaluate"]}),Nu)Nu[lo]._classRegistryKey||Rn("Expression_"+lo,Nu[lo]);function Da(a){return a&&typeof ArrayBuffer!="undefined"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Vl(a){return Zl&&a instanceof Zl}function cu(a,s){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Da(a)||Vl(a))return s&&s.push(a),a;if(ArrayBuffer.isView(a)){var l=a;return s&&s.push(l.buffer),l}if(a instanceof pc)return s&&s.push(a.data.buffer),a;if(Array.isArray(a)){for(var v=[],_=0,E=a;_<E.length;_+=1)v.push(cu(E[_],s));return v}if(typeof a=="object"){var w=a.constructor,L=w._classRegistryKey;if(!L)throw new Error("can't serialize object of unregistered class");var B=w.serialize?w.serialize(a,s):{};if(!w.serialize){for(var V in a)if(a.hasOwnProperty(V)&&!(ko[L].omit.indexOf(V)>=0)){var W=a[V];B[V]=ko[L].shallow.indexOf(V)>=0?W:cu(W,s)}a instanceof Error&&(B.message=a.message)}if(B.$name)throw new Error("$name property is reserved for worker serialization logic.");return L!=="Object"&&(B.$name=L),B}throw new Error("can't serialize object of type "+typeof a)}function Ds(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Da(a)||Vl(a)||ArrayBuffer.isView(a)||a instanceof pc)return a;if(Array.isArray(a))return a.map(Ds);if(typeof a=="object"){var s=a.$name||"Object",l=ko[s].klass;if(!l)throw new Error("can't deserialize unregistered class "+s);if(l.deserialize)return l.deserialize(a);for(var v=Object.create(l.prototype),_=0,E=Object.keys(a);_<E.length;_+=1){var w=E[_];if(w!=="$name"){var L=a[w];v[w]=ko[s].shallow.indexOf(w)>=0?L:Ds(L)}}return v}throw new Error("can't deserialize object of type "+typeof a)}var _f=function(){this.first=!0};_f.prototype.update=function(a,s){var l=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=l,!0))};var dn={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function dc(a){for(var s=0,l=a;s<l.length;s+=1)if(vc(l[s].charCodeAt(0)))return!0;return!1}function vc(a){return!(a!==746&&a!==747&&(a<4352||!(dn["Bopomofo Extended"](a)||dn.Bopomofo(a)||dn["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||dn["CJK Compatibility Ideographs"](a)||dn["CJK Compatibility"](a)||dn["CJK Radicals Supplement"](a)||dn["CJK Strokes"](a)||!(!dn["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||dn["CJK Unified Ideographs Extension A"](a)||dn["CJK Unified Ideographs"](a)||dn["Enclosed CJK Letters and Months"](a)||dn["Hangul Compatibility Jamo"](a)||dn["Hangul Jamo Extended-A"](a)||dn["Hangul Jamo Extended-B"](a)||dn["Hangul Jamo"](a)||dn["Hangul Syllables"](a)||dn.Hiragana(a)||dn["Ideographic Description Characters"](a)||dn.Kanbun(a)||dn["Kangxi Radicals"](a)||dn["Katakana Phonetic Extensions"](a)||dn.Katakana(a)&&a!==12540||!(!dn["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!dn["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||dn["Unified Canadian Aboriginal Syllabics"](a)||dn["Unified Canadian Aboriginal Syllabics Extended"](a)||dn["Vertical Forms"](a)||dn["Yijing Hexagram Symbols"](a)||dn["Yi Syllables"](a)||dn["Yi Radicals"](a))))}function Cl(a){return!(vc(a)||function(s){return!!(dn["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||dn["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||dn["Letterlike Symbols"](s)||dn["Number Forms"](s)||dn["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||dn["Control Pictures"](s)&&s!==9251||dn["Optical Character Recognition"](s)||dn["Enclosed Alphanumerics"](s)||dn["Geometric Shapes"](s)||dn["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||dn["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||dn["CJK Symbols and Punctuation"](s)||dn.Katakana(s)||dn["Private Use Area"](s)||dn["CJK Compatibility Forms"](s)||dn["Small Form Variants"](s)||dn["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(a))}function za(a){return a>=1424&&a<=2303||dn["Arabic Presentation Forms-A"](a)||dn["Arabic Presentation Forms-B"](a)}function Bs(a,s){return!(!s&&za(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||dn.Khmer(a))}function Xc(a){for(var s=0,l=a;s<l.length;s+=1)if(za(l[s].charCodeAt(0)))return!0;return!1}var xs=null,bs="unavailable",Vu=null,Ah=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(bs="error"),xs&&xs(a)};function xf(){Yf.fire(new Ze("pluginStateChange",{pluginStatus:bs,pluginURL:Vu}))}var Yf=new dt,$f=function(){return bs},Vs=function(){if(bs!=="deferred"||!Vu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");bs="loading",xf(),Vu&&xa({url:Vu},function(a){a?Ah(a):(bs="loaded",xf())})},eu={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return bs==="loaded"||eu.applyArabicShaping!=null},isLoading:function(){return bs==="loading"},setState:function(a){bs=a.pluginStatus,Vu=a.pluginURL},isParsed:function(){return eu.applyArabicShaping!=null&&eu.processBidirectionalText!=null&&eu.processStyledBidirectionalText!=null},getPluginURL:function(){return Vu}},Di=function(a,s){this.zoom=a,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new _f,this.transition={})};Di.prototype.isSupportedScript=function(a){return function(s,l){for(var v=0,_=s;v<_.length;v+=1)if(!Bs(_[v].charCodeAt(0),l))return!1;return!0}(a,eu.isLoaded())},Di.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Di.prototype.getCrossfadeParameters=function(){var a=this.zoom,s=a-Math.floor(a),l=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}};var Su=function(a,s){this.property=a,this.value=s,this.expression=function(l,v){if(Ol(l))return new bl(l,v);if(lc(l)){var _=xl(l,v);if(_.result==="error")throw new Error(_.value.map(function(w){return w.key+": "+w.message}).join(", "));return _.value}var E=l;return typeof l=="string"&&v.type==="color"&&(E=hr.parse(l)),{kind:"constant",evaluate:function(){return E}}}(s===void 0?a.specification.default:s,a.specification)};Su.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Su.prototype.possiblyEvaluate=function(a,s,l){return this.property.possiblyEvaluate(this,a,s,l)};var js=function(a){this.property=a,this.value=new Su(a,void 0)};js.prototype.transitioned=function(a,s){return new ju(this.property,this.value,s,xt({},a.transition,this.transition),a.now)},js.prototype.untransitioned=function(){return new ju(this.property,this.value,null,{},0)};var cs=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};cs.prototype.getValue=function(a){return ht(this._values[a].value.value)},cs.prototype.setValue=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new js(this._values[a].property)),this._values[a].value=new Su(this._values[a].property,s===null?void 0:ht(s))},cs.prototype.getTransition=function(a){return ht(this._values[a].transition)},cs.prototype.setTransition=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new js(this._values[a].property)),this._values[a].transition=ht(s)||void 0},cs.prototype.serialize=function(){for(var a={},s=0,l=Object.keys(this._values);s<l.length;s+=1){var v=l[s],_=this.getValue(v);_!==void 0&&(a[v]=_);var E=this.getTransition(v);E!==void 0&&(a[v+"-transition"]=E)}return a},cs.prototype.transitioned=function(a,s){for(var l=new jl(this._properties),v=0,_=Object.keys(this._values);v<_.length;v+=1){var E=_[v];l._values[E]=this._values[E].transitioned(a,s._values[E])}return l},cs.prototype.untransitioned=function(){for(var a=new jl(this._properties),s=0,l=Object.keys(this._values);s<l.length;s+=1){var v=l[s];a._values[v]=this._values[v].untransitioned()}return a};var ju=function(a,s,l,v,_){this.property=a,this.value=s,this.begin=_+v.delay||0,this.end=this.begin+v.duration||0,a.specification.transition&&(v.delay||v.duration)&&(this.prior=l)};ju.prototype.possiblyEvaluate=function(a,s,l){var v=a.now||0,_=this.value.possiblyEvaluate(a,s,l),E=this.prior;if(E){if(v>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(v<this.begin)return E.possiblyEvaluate(a,s,l);var w=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(a,s,l),_,function(L){if(L<=0)return 0;if(L>=1)return 1;var B=L*L,V=B*L;return 4*(L<.5?V:3*(L-B)+V-.75)}(w))}return _};var jl=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};jl.prototype.possiblyEvaluate=function(a,s,l){for(var v=new fu(this._properties),_=0,E=Object.keys(this._values);_<E.length;_+=1){var w=E[_];v._values[w]=this._values[w].possiblyEvaluate(a,s,l)}return v},jl.prototype.hasTransition=function(){for(var a=0,s=Object.keys(this._values);a<s.length;a+=1)if(this._values[s[a]].prior)return!0;return!1};var tu=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};tu.prototype.getValue=function(a){return ht(this._values[a].value)},tu.prototype.setValue=function(a,s){this._values[a]=new Su(this._values[a].property,s===null?void 0:ht(s))},tu.prototype.serialize=function(){for(var a={},s=0,l=Object.keys(this._values);s<l.length;s+=1){var v=l[s],_=this.getValue(v);_!==void 0&&(a[v]=_)}return a},tu.prototype.possiblyEvaluate=function(a,s,l){for(var v=new fu(this._properties),_=0,E=Object.keys(this._values);_<E.length;_+=1){var w=E[_];v._values[w]=this._values[w].possiblyEvaluate(a,s,l)}return v};var Es=function(a,s,l){this.property=a,this.value=s,this.parameters=l};Es.prototype.isConstant=function(){return this.value.kind==="constant"},Es.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},Es.prototype.evaluate=function(a,s,l,v){return this.property.evaluate(this.value,this.parameters,a,s,l,v)};var fu=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};fu.prototype.get=function(a){return this._values[a]};var Yn=function(a){this.specification=a};Yn.prototype.possiblyEvaluate=function(a,s){return a.expression.evaluate(s)},Yn.prototype.interpolate=function(a,s,l){var v=Pa[this.specification.type];return v?v(a,s,l):a};var zn=function(a,s){this.specification=a,this.overrides=s};zn.prototype.possiblyEvaluate=function(a,s,l,v){return new Es(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(s,null,{},l,v)}:a.expression,s)},zn.prototype.interpolate=function(a,s,l){if(a.value.kind!=="constant"||s.value.kind!=="constant")return a;if(a.value.value===void 0||s.value.value===void 0)return new Es(this,{kind:"constant",value:void 0},a.parameters);var v=Pa[this.specification.type];return v?new Es(this,{kind:"constant",value:v(a.value.value,s.value.value,l)},a.parameters):a},zn.prototype.evaluate=function(a,s,l,v,_,E){return a.kind==="constant"?a.value:a.evaluate(s,l,v,_,E)};var Gl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(l,v,_,E){if(l.value===void 0)return new Es(this,{kind:"constant",value:void 0},v);if(l.expression.kind==="constant"){var w=l.expression.evaluate(v,null,{},_,E),L=l.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,B=this._calculate(L,L,L,v);return new Es(this,{kind:"constant",value:B},v)}if(l.expression.kind==="camera"){var V=this._calculate(l.expression.evaluate({zoom:v.zoom-1}),l.expression.evaluate({zoom:v.zoom}),l.expression.evaluate({zoom:v.zoom+1}),v);return new Es(this,{kind:"constant",value:V},v)}return new Es(this,l.expression,v)},s.prototype.evaluate=function(l,v,_,E,w,L){if(l.kind==="source"){var B=l.evaluate(v,_,E,w,L);return this._calculate(B,B,B,v)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(v.zoom)-1},_,E),l.evaluate({zoom:Math.floor(v.zoom)},_,E),l.evaluate({zoom:Math.floor(v.zoom)+1},_,E),v):l.value},s.prototype._calculate=function(l,v,_,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:l,to:v}:{from:_,to:v}},s.prototype.interpolate=function(l){return l},s}(zn),$o=function(a){this.specification=a};$o.prototype.possiblyEvaluate=function(a,s,l,v){if(a.value!==void 0){if(a.expression.kind==="constant"){var _=a.expression.evaluate(s,null,{},l,v);return this._calculate(_,_,_,s)}return this._calculate(a.expression.evaluate(new Di(Math.floor(s.zoom-1),s)),a.expression.evaluate(new Di(Math.floor(s.zoom),s)),a.expression.evaluate(new Di(Math.floor(s.zoom+1),s)),s)}},$o.prototype._calculate=function(a,s,l,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:a,to:s}:{from:l,to:s}},$o.prototype.interpolate=function(a){return a};var hu=function(a){this.specification=a};hu.prototype.possiblyEvaluate=function(a,s,l,v){return!!a.expression.evaluate(s,null,{},l,v)},hu.prototype.interpolate=function(){return!1};var qo=function(a){for(var s in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var l=a[s];l.specification.overridable&&this.overridableProperties.push(s);var v=this.defaultPropertyValues[s]=new Su(l,void 0),_=this.defaultTransitionablePropertyValues[s]=new js(l);this.defaultTransitioningPropertyValues[s]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=v.possiblyEvaluate({})}};Rn("DataDrivenProperty",zn),Rn("DataConstantProperty",Yn),Rn("CrossFadedDataDrivenProperty",Gl),Rn("CrossFadedProperty",$o),Rn("ColorRampProperty",hu);var Gu=function(a){function s(l,v){if(a.call(this),this.id=l.id,this.type=l.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},l.type!=="custom"&&(this.metadata=(l=l).metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),v.layout&&(this._unevaluatedLayout=new tu(v.layout)),v.paint)){for(var _ in this._transitionablePaint=new cs(v.paint),l.paint)this.setPaintProperty(_,l.paint[_],{validate:!1});for(var E in l.layout)this.setLayoutProperty(E,l.layout[E],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fu(v.paint)}}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},s.prototype.getLayoutProperty=function(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)},s.prototype.setLayoutProperty=function(l,v,_){_===void 0&&(_={}),v!=null&&this._validate(Wc,"layers."+this.id+".layout."+l,l,v,_)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,v):this.visibility=v)},s.prototype.getPaintProperty=function(l){return K(l,"-transition")?this._transitionablePaint.getTransition(l.slice(0,-"-transition".length)):this._transitionablePaint.getValue(l)},s.prototype.setPaintProperty=function(l,v,_){if(_===void 0&&(_={}),v!=null&&this._validate(Hc,"layers."+this.id+".paint."+l,l,v,_))return!1;if(K(l,"-transition"))return this._transitionablePaint.setTransition(l.slice(0,-"-transition".length),v||void 0),!1;var E=this._transitionablePaint._values[l],w=E.property.specification["property-type"]==="cross-faded-data-driven",L=E.value.isDataDriven(),B=E.value;this._transitionablePaint.setValue(l,v),this._handleSpecialPaintPropertyUpdate(l);var V=this._transitionablePaint._values[l].value;return V.isDataDriven()||L||w||this._handleOverridablePaintPropertyUpdate(l,B,V)},s.prototype._handleSpecialPaintPropertyUpdate=function(l){},s.prototype._handleOverridablePaintPropertyUpdate=function(l,v,_){return!1},s.prototype.isHidden=function(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"},s.prototype.updateTransitions=function(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)},s.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},s.prototype.recalculate=function(l,v){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,v)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,v)},s.prototype.serialize=function(){var l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Tt(l,function(v,_){return!(v===void 0||_==="layout"&&!Object.keys(v).length||_==="paint"&&!Object.keys(v).length)})},s.prototype._validate=function(l,v,_,E,w){return w===void 0&&(w={}),(!w||w.validate!==!1)&&hc(this,l.call(Zu,{key:v,layerType:this.type,objectKey:_,value:E,styleSpec:be,style:{glyphs:!0,sprite:!0}}))},s.prototype.is3D=function(){return!1},s.prototype.isTileClipped=function(){return!1},s.prototype.hasOffscreenPass=function(){return!1},s.prototype.resize=function(){},s.prototype.isStateDependent=function(){for(var l in this.paint._values){var v=this.paint.get(l);if(v instanceof Es&&Qs(v.property.specification)&&(v.value.kind==="source"||v.value.kind==="composite")&&v.value.isStateDependent)return!0}return!1},s}(dt),Yc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Hl=function(a,s){this._structArray=a,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ea=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ua(a,s){s===void 0&&(s=1);var l=0,v=0;return{members:a.map(function(_){var E=Yc[_.type].BYTES_PER_ELEMENT,w=l=qf(l,Math.max(s,E)),L=_.components||1;return v=Math.max(v,E),l+=E*L,{name:_.name,type:_.type,components:L,offset:w}}),size:qf(l,Math.max(v,s)),alignment:s}}function qf(a,s){return Math.ceil(a/s)*s}Ea.serialize=function(a,s){return a._trim(),s&&(a.isTransferred=!0,s.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},Ea.deserialize=function(a){var s=Object.create(this.prototype);return s.arrayBuffer=a.arrayBuffer,s.length=a.length,s.capacity=a.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s},Ea.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ea.prototype.clear=function(){this.length=0},Ea.prototype.resize=function(a){this.reserve(a),this.length=a},Ea.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}},Ea.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Wl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v){var _=this.length;return this.resize(_+1),this.emplace(_,l,v)},s.prototype.emplace=function(l,v,_){var E=2*l;return this.int16[E+0]=v,this.int16[E+1]=_,l},s}(Ea);Wl.prototype.bytesPerElement=4,Rn("StructArrayLayout2i4",Wl);var Xa=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,_,E){var w=this.length;return this.resize(w+1),this.emplace(w,l,v,_,E)},s.prototype.emplace=function(l,v,_,E,w){var L=4*l;return this.int16[L+0]=v,this.int16[L+1]=_,this.int16[L+2]=E,this.int16[L+3]=w,l},s}(Ea);Xa.prototype.bytesPerElement=8,Rn("StructArrayLayout4i8",Xa);var Hu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,_,E,w,L){var B=this.length;return this.resize(B+1),this.emplace(B,l,v,_,E,w,L)},s.prototype.emplace=function(l,v,_,E,w,L,B){var V=6*l;return this.int16[V+0]=v,this.int16[V+1]=_,this.int16[V+2]=E,this.int16[V+3]=w,this.int16[V+4]=L,this.int16[V+5]=B,l},s}(Ea);Hu.prototype.bytesPerElement=12,Rn("StructArrayLayout2i4i12",Hu);var os=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,_,E,w,L){var B=this.length;return this.resize(B+1),this.emplace(B,l,v,_,E,w,L)},s.prototype.emplace=function(l,v,_,E,w,L,B){var V=4*l,W=8*l;return this.int16[V+0]=v,this.int16[V+1]=_,this.uint8[W+4]=E,this.uint8[W+5]=w,this.uint8[W+6]=L,this.uint8[W+7]=B,l},s}(Ea);os.prototype.bytesPerElement=8,Rn("StructArrayLayout2i4ub8",os);var wl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v){var _=this.length;return this.resize(_+1),this.emplace(_,l,v)},s.prototype.emplace=function(l,v,_){var E=2*l;return this.float32[E+0]=v,this.float32[E+1]=_,l},s}(Ea);wl.prototype.bytesPerElement=8,Rn("StructArrayLayout2f8",wl);var Cu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,_,E,w,L,B,V,W,$){var le=this.length;return this.resize(le+1),this.emplace(le,l,v,_,E,w,L,B,V,W,$)},s.prototype.emplace=function(l,v,_,E,w,L,B,V,W,$,le){var ve=10*l;return this.uint16[ve+0]=v,this.uint16[ve+1]=_,this.uint16[ve+2]=E,this.uint16[ve+3]=w,this.uint16[ve+4]=L,this.uint16[ve+5]=B,this.uint16[ve+6]=V,this.uint16[ve+7]=W,this.uint16[ve+8]=$,this.uint16[ve+9]=le,l},s}(Ea);Cu.prototype.bytesPerElement=20,Rn("StructArrayLayout10ui20",Cu);var bf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,_,E,w,L,B,V,W,$,le,ve){var Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,l,v,_,E,w,L,B,V,W,$,le,ve)},s.prototype.emplace=function(l,v,_,E,w,L,B,V,W,$,le,ve,Ue){var Ve=12*l;return this.int16[Ve+0]=v,this.int16[Ve+1]=_,this.int16[Ve+2]=E,this.int16[Ve+3]=w,this.uint16[Ve+4]=L,this.uint16[Ve+5]=B,this.uint16[Ve+6]=V,this.uint16[Ve+7]=W,this.int16[Ve+8]=$,this.int16[Ve+9]=le,this.int16[Ve+10]=ve,this.int16[Ve+11]=Ue,l},s}(Ea);bf.prototype.bytesPerElement=24,Rn("StructArrayLayout4i4ui4i24",bf);var pu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,_){var E=this.length;return this.resize(E+1),this.emplace(E,l,v,_)},s.prototype.emplace=function(l,v,_,E){var w=3*l;return this.float32[w+0]=v,this.float32[w+1]=_,this.float32[w+2]=E,l},s}(Ea);pu.prototype.bytesPerElement=12,Rn("StructArrayLayout3f12",pu);var Al=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var v=this.length;return this.resize(v+1),this.emplace(v,l)},s.prototype.emplace=function(l,v){return this.uint32[1*l+0]=v,l},s}(Ea);Al.prototype.bytesPerElement=4,Rn("StructArrayLayout1ul4",Al);var Xl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,_,E,w,L,B,V,W){var $=this.length;return this.resize($+1),this.emplace($,l,v,_,E,w,L,B,V,W)},s.prototype.emplace=function(l,v,_,E,w,L,B,V,W,$){var le=10*l,ve=5*l;return this.int16[le+0]=v,this.int16[le+1]=_,this.int16[le+2]=E,this.int16[le+3]=w,this.int16[le+4]=L,this.int16[le+5]=B,this.uint32[ve+3]=V,this.uint16[le+8]=W,this.uint16[le+9]=$,l},s}(Ea);Xl.prototype.bytesPerElement=20,Rn("StructArrayLayout6i1ul2ui20",Xl);var Yl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,_,E,w,L){var B=this.length;return this.resize(B+1),this.emplace(B,l,v,_,E,w,L)},s.prototype.emplace=function(l,v,_,E,w,L,B){var V=6*l;return this.int16[V+0]=v,this.int16[V+1]=_,this.int16[V+2]=E,this.int16[V+3]=w,this.int16[V+4]=L,this.int16[V+5]=B,l},s}(Ea);Yl.prototype.bytesPerElement=12,Rn("StructArrayLayout2i2i2i12",Yl);var Tl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,_,E,w){var L=this.length;return this.resize(L+1),this.emplace(L,l,v,_,E,w)},s.prototype.emplace=function(l,v,_,E,w,L){var B=4*l,V=8*l;return this.float32[B+0]=v,this.float32[B+1]=_,this.float32[B+2]=E,this.int16[V+6]=w,this.int16[V+7]=L,l},s}(Ea);Tl.prototype.bytesPerElement=16,Rn("StructArrayLayout2f1f2i16",Tl);var Kf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,_,E){var w=this.length;return this.resize(w+1),this.emplace(w,l,v,_,E)},s.prototype.emplace=function(l,v,_,E,w){var L=12*l,B=3*l;return this.uint8[L+0]=v,this.uint8[L+1]=_,this.float32[B+1]=E,this.float32[B+2]=w,l},s}(Ea);Kf.prototype.bytesPerElement=12,Rn("StructArrayLayout2ub2f12",Kf);var nl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,_){var E=this.length;return this.resize(E+1),this.emplace(E,l,v,_)},s.prototype.emplace=function(l,v,_,E){var w=3*l;return this.uint16[w+0]=v,this.uint16[w+1]=_,this.uint16[w+2]=E,l},s}(Ea);nl.prototype.bytesPerElement=6,Rn("StructArrayLayout3ui6",nl);var $l=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,_,E,w,L,B,V,W,$,le,ve,Ue,Ve,st,Qe,St){var Vt=this.length;return this.resize(Vt+1),this.emplace(Vt,l,v,_,E,w,L,B,V,W,$,le,ve,Ue,Ve,st,Qe,St)},s.prototype.emplace=function(l,v,_,E,w,L,B,V,W,$,le,ve,Ue,Ve,st,Qe,St,Vt){var ir=24*l,sr=12*l,Sr=48*l;return this.int16[ir+0]=v,this.int16[ir+1]=_,this.uint16[ir+2]=E,this.uint16[ir+3]=w,this.uint32[sr+2]=L,this.uint32[sr+3]=B,this.uint32[sr+4]=V,this.uint16[ir+10]=W,this.uint16[ir+11]=$,this.uint16[ir+12]=le,this.float32[sr+7]=ve,this.float32[sr+8]=Ue,this.uint8[Sr+36]=Ve,this.uint8[Sr+37]=st,this.uint8[Sr+38]=Qe,this.uint32[sr+10]=St,this.int16[ir+22]=Vt,l},s}(Ea);$l.prototype.bytesPerElement=48,Rn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",$l);var Ef=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,_,E,w,L,B,V,W,$,le,ve,Ue,Ve,st,Qe,St,Vt,ir,sr,Sr,Xr,hn,Kn,Mn,ni,Pn,Bi){var yi=this.length;return this.resize(yi+1),this.emplace(yi,l,v,_,E,w,L,B,V,W,$,le,ve,Ue,Ve,st,Qe,St,Vt,ir,sr,Sr,Xr,hn,Kn,Mn,ni,Pn,Bi)},s.prototype.emplace=function(l,v,_,E,w,L,B,V,W,$,le,ve,Ue,Ve,st,Qe,St,Vt,ir,sr,Sr,Xr,hn,Kn,Mn,ni,Pn,Bi,yi){var Wn=34*l,Wi=17*l;return this.int16[Wn+0]=v,this.int16[Wn+1]=_,this.int16[Wn+2]=E,this.int16[Wn+3]=w,this.int16[Wn+4]=L,this.int16[Wn+5]=B,this.int16[Wn+6]=V,this.int16[Wn+7]=W,this.uint16[Wn+8]=$,this.uint16[Wn+9]=le,this.uint16[Wn+10]=ve,this.uint16[Wn+11]=Ue,this.uint16[Wn+12]=Ve,this.uint16[Wn+13]=st,this.uint16[Wn+14]=Qe,this.uint16[Wn+15]=St,this.uint16[Wn+16]=Vt,this.uint16[Wn+17]=ir,this.uint16[Wn+18]=sr,this.uint16[Wn+19]=Sr,this.uint16[Wn+20]=Xr,this.uint16[Wn+21]=hn,this.uint16[Wn+22]=Kn,this.uint32[Wi+12]=Mn,this.float32[Wi+13]=ni,this.float32[Wi+14]=Pn,this.float32[Wi+15]=Bi,this.float32[Wi+16]=yi,l},s}(Ea);Ef.prototype.bytesPerElement=68,Rn("StructArrayLayout8i15ui1ul4f68",Ef);var ql=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var v=this.length;return this.resize(v+1),this.emplace(v,l)},s.prototype.emplace=function(l,v){return this.float32[1*l+0]=v,l},s}(Ea);ql.prototype.bytesPerElement=4,Rn("StructArrayLayout1f4",ql);var go=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,_){var E=this.length;return this.resize(E+1),this.emplace(E,l,v,_)},s.prototype.emplace=function(l,v,_,E){var w=3*l;return this.int16[w+0]=v,this.int16[w+1]=_,this.int16[w+2]=E,l},s}(Ea);go.prototype.bytesPerElement=6,Rn("StructArrayLayout3i6",go);var Sf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,_){var E=this.length;return this.resize(E+1),this.emplace(E,l,v,_)},s.prototype.emplace=function(l,v,_,E){var w=4*l;return this.uint32[2*l+0]=v,this.uint16[w+2]=_,this.uint16[w+3]=E,l},s}(Ea);Sf.prototype.bytesPerElement=8,Rn("StructArrayLayout1ul2ui8",Sf);var $c=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v){var _=this.length;return this.resize(_+1),this.emplace(_,l,v)},s.prototype.emplace=function(l,v,_){var E=2*l;return this.uint16[E+0]=v,this.uint16[E+1]=_,l},s}(Ea);$c.prototype.bytesPerElement=4,Rn("StructArrayLayout2ui4",$c);var Ml=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var v=this.length;return this.resize(v+1),this.emplace(v,l)},s.prototype.emplace=function(l,v){return this.uint16[1*l+0]=v,l},s}(Ea);Ml.prototype.bytesPerElement=2,Rn("StructArrayLayout1ui2",Ml);var qc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,_,E){var w=this.length;return this.resize(w+1),this.emplace(w,l,v,_,E)},s.prototype.emplace=function(l,v,_,E,w){var L=4*l;return this.float32[L+0]=v,this.float32[L+1]=_,this.float32[L+2]=E,this.float32[L+3]=w,l},s}(Ea);qc.prototype.bytesPerElement=16,Rn("StructArrayLayout4f16",qc);var f=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var l={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return l.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},l.x1.get=function(){return this._structArray.int16[this._pos2+2]},l.y1.get=function(){return this._structArray.int16[this._pos2+3]},l.x2.get=function(){return this._structArray.int16[this._pos2+4]},l.y2.get=function(){return this._structArray.int16[this._pos2+5]},l.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},l.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},l.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},l.anchorPoint.get=function(){return new pe(this.anchorPointX,this.anchorPointY)},Object.defineProperties(s.prototype,l),s}(Hl);f.prototype.size=20;var d=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(l){return new f(this,l)},s}(Xl);Rn("CollisionBoxArray",d);var h=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var l={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return l.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},l.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},l.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},l.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},l.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},l.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},l.segment.get=function(){return this._structArray.uint16[this._pos2+10]},l.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},l.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},l.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},l.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},l.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},l.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},l.placedOrientation.set=function(v){this._structArray.uint8[this._pos1+37]=v},l.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},l.hidden.set=function(v){this._structArray.uint8[this._pos1+38]=v},l.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},l.crossTileID.set=function(v){this._structArray.uint32[this._pos4+10]=v},l.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(s.prototype,l),s}(Hl);h.prototype.size=48;var g=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(l){return new h(this,l)},s}($l);Rn("PlacedSymbolArray",g);var S=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var l={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return l.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},l.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},l.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},l.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},l.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},l.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},l.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},l.key.get=function(){return this._structArray.uint16[this._pos2+8]},l.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},l.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},l.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},l.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},l.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},l.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},l.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},l.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},l.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},l.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},l.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},l.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},l.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},l.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},l.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},l.crossTileID.set=function(v){this._structArray.uint32[this._pos4+12]=v},l.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},l.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},l.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},l.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(s.prototype,l),s}(Hl);S.prototype.size=68;var M=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(l){return new S(this,l)},s}(Ef);Rn("SymbolInstanceArray",M);var k=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getoffsetX=function(l){return this.float32[1*l+0]},s}(ql);Rn("GlyphOffsetArray",k);var F=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getx=function(l){return this.int16[3*l+0]},s.prototype.gety=function(l){return this.int16[3*l+1]},s.prototype.gettileUnitDistanceFromAnchor=function(l){return this.int16[3*l+2]},s}(go);Rn("SymbolLineVertexArray",F);var G=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var l={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return l.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},l.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},l.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(s.prototype,l),s}(Hl);G.prototype.size=8;var X=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(l){return new G(this,l)},s}(Sf);Rn("FeatureIndexArray",X);var ue=Ua([{name:"a_pos",components:2,type:"Int16"}],4).members,Ee=function(a){a===void 0&&(a=[]),this.segments=a};function te(a,s){return 256*(a=kt(Math.floor(a),0,255))+kt(Math.floor(s),0,255)}Ee.prototype.prepareSegment=function(a,s,l,v){var _=this.segments[this.segments.length-1];return a>Ee.MAX_VERTEX_ARRAY_LENGTH&&pt("Max vertices per segment is "+Ee.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!_||_.vertexLength+a>Ee.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==v)&&(_={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},v!==void 0&&(_.sortKey=v),this.segments.push(_)),_},Ee.prototype.get=function(){return this.segments},Ee.prototype.destroy=function(){for(var a=0,s=this.segments;a<s.length;a+=1){var l=s[a];for(var v in l.vaos)l.vaos[v].destroy()}},Ee.simpleSegment=function(a,s,l,v){return new Ee([{vertexOffset:a,primitiveOffset:s,vertexLength:l,primitiveLength:v,vaos:{},sortKey:0}])},Ee.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Rn("SegmentVector",Ee);var je=Ua([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ze=Ae(function(a){a.exports=function(s,l){var v,_,E,w,L,B,V,W;for(_=s.length-(v=3&s.length),E=l,L=3432918353,B=461845907,W=0;W<_;)V=255&s.charCodeAt(W)|(255&s.charCodeAt(++W))<<8|(255&s.charCodeAt(++W))<<16|(255&s.charCodeAt(++W))<<24,++W,E=27492+(65535&(w=5*(65535&(E=(E^=V=(65535&(V=(V=(65535&V)*L+(((V>>>16)*L&65535)<<16)&4294967295)<<15|V>>>17))*B+(((V>>>16)*B&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(V=0,v){case 3:V^=(255&s.charCodeAt(W+2))<<16;case 2:V^=(255&s.charCodeAt(W+1))<<8;case 1:E^=V=(65535&(V=(V=(65535&(V^=255&s.charCodeAt(W)))*L+(((V>>>16)*L&65535)<<16)&4294967295)<<15|V>>>17))*B+(((V>>>16)*B&65535)<<16)&4294967295}return E^=s.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}}),nt=Ae(function(a){a.exports=function(s,l){for(var v,_=s.length,E=l^_,w=0;_>=4;)v=1540483477*(65535&(v=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(v>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(v=1540483477*(65535&(v^=v>>>24))+((1540483477*(v>>>16)&65535)<<16)),_-=4,++w;switch(_){case 3:E^=(255&s.charCodeAt(w+2))<<16;case 2:E^=(255&s.charCodeAt(w+1))<<8;case 1:E=1540483477*(65535&(E^=255&s.charCodeAt(w)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}}),Be=ze,rt=nt;Be.murmur3=ze,Be.murmur2=rt;var mt=function(){this.ids=[],this.positions=[],this.indexed=!1};mt.prototype.add=function(a,s,l,v){this.ids.push(fr(a)),this.positions.push(s,l,v)},mt.prototype.getPositions=function(a){for(var s=fr(a),l=0,v=this.ids.length-1;l<v;){var _=l+v>>1;this.ids[_]>=s?v=_:l=_+1}for(var E=[];this.ids[l]===s;)E.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return E},mt.serialize=function(a,s){var l=new Float64Array(a.ids),v=new Uint32Array(a.positions);return function _(E,w,L,B){for(;L<B;){for(var V=E[L+B>>1],W=L-1,$=B+1;;){do W++;while(E[W]<V);do $--;while(E[$]>V);if(W>=$)break;nr(E,W,$),nr(w,3*W,3*$),nr(w,3*W+1,3*$+1),nr(w,3*W+2,3*$+2)}$-L<B-$?(_(E,w,L,$),L=$+1):(_(E,w,$+1,B),B=$)}}(l,v,0,l.length-1),s&&s.push(l.buffer,v.buffer),{ids:l,positions:v}},mt.deserialize=function(a){var s=new mt;return s.ids=a.ids,s.positions=a.positions,s.indexed=!0,s};var Dt=Math.pow(2,53)-1;function fr(a){var s=+a;return!isNaN(s)&&s<=Dt?s:Be(String(a))}function nr(a,s,l){var v=a[s];a[s]=a[l],a[l]=v}Rn("FeaturePositionMap",mt);var dr=function(a,s){this.gl=a.gl,this.location=s},Ir=function(a){function s(l,v){a.call(this,l,v),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))},s}(dr),tn=function(a){function s(l,v){a.call(this,l,v),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))},s}(dr),$r=function(a){function s(l,v){a.call(this,l,v),this.current=[0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))},s}(dr),bn=function(a){function s(l,v){a.call(this,l,v),this.current=[0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))},s}(dr),Qn=function(a){function s(l,v){a.call(this,l,v),this.current=[0,0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))},s}(dr),$n=function(a){function s(l,v){a.call(this,l,v),this.current=hr.transparent}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))},s}(dr),ei=new Float32Array(16),Fi=function(a){function s(l,v){a.call(this,l,v),this.current=ei}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(var v=1;v<16;v++)if(l[v]!==this.current[v]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}},s}(dr);function Cn(a){return[te(255*a.r,255*a.g),te(255*a.b,255*a.a)]}var Ei=function(a,s,l){this.value=a,this.uniformNames=s.map(function(v){return"u_"+v}),this.type=l};Ei.prototype.setUniform=function(a,s,l){a.set(l.constantOr(this.value))},Ei.prototype.getBinding=function(a,s,l){return this.type==="color"?new $n(a,s):new tn(a,s)};var Si=function(a,s){this.uniformNames=s.map(function(l){return"u_"+l}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Si.prototype.setConstantPatternPositions=function(a,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=a.tlbr},Si.prototype.setUniform=function(a,s,l,v){var _=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&a.set(_)},Si.prototype.getBinding=function(a,s,l){return l.substr(0,9)==="u_pattern"?new Qn(a,s):new tn(a,s)};var mi=function(a,s,l,v){this.expression=a,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(function(_){return{name:"a_"+_,type:"Float32",components:l==="color"?2:1,offset:0}}),this.paintVertexArray=new v};mi.prototype.populatePaintArray=function(a,s,l,v,_){var E=this.paintVertexArray.length,w=this.expression.evaluate(new Di(0),s,{},v,[],_);this.paintVertexArray.resize(a),this._setPaintValue(E,a,w)},mi.prototype.updatePaintArray=function(a,s,l,v){var _=this.expression.evaluate({zoom:0},l,v);this._setPaintValue(a,s,_)},mi.prototype._setPaintValue=function(a,s,l){if(this.type==="color")for(var v=Cn(l),_=a;_<s;_++)this.paintVertexArray.emplace(_,v[0],v[1]);else{for(var E=a;E<s;E++)this.paintVertexArray.emplace(E,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}},mi.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},mi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ai=function(a,s,l,v,_,E){this.expression=a,this.uniformNames=s.map(function(w){return"u_"+w+"_t"}),this.type=l,this.useIntegerZoom=v,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=s.map(function(w){return{name:"a_"+w,type:"Float32",components:l==="color"?4:2,offset:0}}),this.paintVertexArray=new E};ai.prototype.populatePaintArray=function(a,s,l,v,_){var E=this.expression.evaluate(new Di(this.zoom),s,{},v,[],_),w=this.expression.evaluate(new Di(this.zoom+1),s,{},v,[],_),L=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(L,a,E,w)},ai.prototype.updatePaintArray=function(a,s,l,v){var _=this.expression.evaluate({zoom:this.zoom},l,v),E=this.expression.evaluate({zoom:this.zoom+1},l,v);this._setPaintValue(a,s,_,E)},ai.prototype._setPaintValue=function(a,s,l,v){if(this.type==="color")for(var _=Cn(l),E=Cn(v),w=a;w<s;w++)this.paintVertexArray.emplace(w,_[0],_[1],E[0],E[1]);else{for(var L=a;L<s;L++)this.paintVertexArray.emplace(L,l,v);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(v))}},ai.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ai.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ai.prototype.setUniform=function(a,s){var l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,v=kt(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);a.set(v)},ai.prototype.getBinding=function(a,s,l){return new tn(a,s)};var Ti=function(a,s,l,v,_,E){this.expression=a,this.type=s,this.useIntegerZoom=l,this.zoom=v,this.layerId=E,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _};Ti.prototype.populatePaintArray=function(a,s,l){var v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(v,a,s.patterns&&s.patterns[this.layerId],l)},Ti.prototype.updatePaintArray=function(a,s,l,v,_){this._setPaintValues(a,s,l.patterns&&l.patterns[this.layerId],_)},Ti.prototype._setPaintValues=function(a,s,l,v){if(v&&l){var _=v[l.min],E=v[l.mid],w=v[l.max];if(_&&E&&w)for(var L=a;L<s;L++)this.zoomInPaintVertexArray.emplace(L,E.tl[0],E.tl[1],E.br[0],E.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],E.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,E.tl[0],E.tl[1],E.br[0],E.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],E.pixelRatio,w.pixelRatio)}},Ti.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,je.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,je.members,this.expression.isStateDependent))},Ti.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var li=function(a,s,l){this.binders={},this._buffers=[];var v=[];for(var _ in a.paint._values)if(l(_)){var E=a.paint.get(_);if(E instanceof Es&&Qs(E.property.specification)){var w=bo(_,a.type),L=E.value,B=E.property.specification.type,V=E.property.useIntegerZoom,W=E.property.specification["property-type"],$=W==="cross-faded"||W==="cross-faded-data-driven";if(L.kind==="constant")this.binders[_]=$?new Si(L.value,w):new Ei(L.value,w,B),v.push("/u_"+_);else if(L.kind==="source"||$){var le=ro(_,B,"source");this.binders[_]=$?new Ti(L,B,V,s,le,a.id):new mi(L,w,B,le),v.push("/a_"+_)}else{var ve=ro(_,B,"composite");this.binders[_]=new ai(L,w,B,V,s,ve),v.push("/z_"+_)}}}this.cacheKey=v.sort().join("")};li.prototype.getMaxValue=function(a){var s=this.binders[a];return s instanceof mi||s instanceof ai?s.maxValue:0},li.prototype.populatePaintArrays=function(a,s,l,v,_){for(var E in this.binders){var w=this.binders[E];(w instanceof mi||w instanceof ai||w instanceof Ti)&&w.populatePaintArray(a,s,l,v,_)}},li.prototype.setConstantPatternPositions=function(a,s){for(var l in this.binders){var v=this.binders[l];v instanceof Si&&v.setConstantPatternPositions(a,s)}},li.prototype.updatePaintArrays=function(a,s,l,v,_){var E=!1;for(var w in a)for(var L=0,B=s.getPositions(w);L<B.length;L+=1){var V=B[L],W=l.feature(V.index);for(var $ in this.binders){var le=this.binders[$];if((le instanceof mi||le instanceof ai||le instanceof Ti)&&le.expression.isStateDependent===!0){var ve=v.paint.get($);le.expression=ve.value,le.updatePaintArray(V.start,V.end,W,a[w],_),E=!0}}}return E},li.prototype.defines=function(){var a=[];for(var s in this.binders){var l=this.binders[s];(l instanceof Ei||l instanceof Si)&&a.push.apply(a,l.uniformNames.map(function(v){return"#define HAS_UNIFORM_"+v}))}return a},li.prototype.getBinderAttributes=function(){var a=[];for(var s in this.binders){var l=this.binders[s];if(l instanceof mi||l instanceof ai)for(var v=0;v<l.paintVertexAttributes.length;v++)a.push(l.paintVertexAttributes[v].name);else if(l instanceof Ti)for(var _=0;_<je.members.length;_++)a.push(je.members[_].name)}return a},li.prototype.getBinderUniforms=function(){var a=[];for(var s in this.binders){var l=this.binders[s];if(l instanceof Ei||l instanceof Si||l instanceof ai)for(var v=0,_=l.uniformNames;v<_.length;v+=1)a.push(_[v])}return a},li.prototype.getPaintVertexBuffers=function(){return this._buffers},li.prototype.getUniforms=function(a,s){var l=[];for(var v in this.binders){var _=this.binders[v];if(_ instanceof Ei||_ instanceof Si||_ instanceof ai)for(var E=0,w=_.uniformNames;E<w.length;E+=1){var L=w[E];if(s[L]){var B=_.getBinding(a,s[L],L);l.push({name:L,property:v,binding:B})}}}return l},li.prototype.setUniforms=function(a,s,l,v){for(var _=0,E=s;_<E.length;_+=1){var w=E[_],L=w.name,B=w.property;this.binders[B].setUniform(w.binding,v,l.get(B),L)}},li.prototype.updatePaintBuffers=function(a){for(var s in this._buffers=[],this.binders){var l=this.binders[s];if(a&&l instanceof Ti){var v=a.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(l instanceof mi||l instanceof ai)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}},li.prototype.upload=function(a){for(var s in this.binders){var l=this.binders[s];(l instanceof mi||l instanceof ai||l instanceof Ti)&&l.upload(a)}this.updatePaintBuffers()},li.prototype.destroy=function(){for(var a in this.binders){var s=this.binders[a];(s instanceof mi||s instanceof ai||s instanceof Ti)&&s.destroy()}};var ti=function(a,s,l){l===void 0&&(l=function(){return!0}),this.programConfigurations={};for(var v=0,_=a;v<_.length;v+=1){var E=_[v];this.programConfigurations[E.id]=new li(E,s,l)}this.needsUpload=!1,this._featureMap=new mt,this._bufferOffset=0};function bo(a,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(s+"-","").replace(/-/g,"_")]}function ro(a,s,l){var v={color:{source:wl,composite:qc},number:{source:ql,composite:wl}},_=function(E){return{"line-pattern":{source:Cu,composite:Cu},"fill-pattern":{source:Cu,composite:Cu},"fill-extrusion-pattern":{source:Cu,composite:Cu}}[E]}(a);return _&&_[l]||v[s][l]}ti.prototype.populatePaintArrays=function(a,s,l,v,_,E){for(var w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(a,s,v,_,E);s.id!==void 0&&this._featureMap.add(s.id,l,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},ti.prototype.updatePaintArrays=function(a,s,l,v){for(var _=0,E=l;_<E.length;_+=1){var w=E[_];this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(a,this._featureMap,s,w,v)||this.needsUpload}},ti.prototype.get=function(a){return this.programConfigurations[a]},ti.prototype.upload=function(a){if(this.needsUpload){for(var s in this.programConfigurations)this.programConfigurations[s].upload(a);this.needsUpload=!1}},ti.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},Rn("ConstantBinder",Ei),Rn("CrossFadedConstantBinder",Si),Rn("SourceExpressionBinder",mi),Rn("CrossFadedCompositeBinder",Ti),Rn("CompositeExpressionBinder",ai),Rn("ProgramConfiguration",li,{omit:["_buffers"]}),Rn("ProgramConfigurationSet",ti);var Ko=Math.pow(2,14)-1,Qo=-Ko-1;function Ya(a){for(var s=8192/a.extent,l=a.loadGeometry(),v=0;v<l.length;v++)for(var _=l[v],E=0;E<_.length;E++){var w=_[E],L=Math.round(w.x*s),B=Math.round(w.y*s);w.x=kt(L,Qo,Ko),w.y=kt(B,Qo,Ko),(L<w.x||L>w.x+1||B<w.y||B>w.y+1)&&pt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return l}function yo(a,s){return{type:a.type,id:a.id,properties:a.properties,geometry:s?Ya(a):[]}}function Eo(a,s,l,v,_){a.emplaceBack(2*s+(v+1)/2,2*l+(_+1)/2)}var fs=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Wl,this.indexArray=new nl,this.segments=new Ee,this.programConfigurations=new ti(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function il(a,s){for(var l=0;l<a.length;l++)if(vu(s,a[l]))return!0;for(var v=0;v<s.length;v++)if(vu(a,s[v]))return!0;return!!Kl(a,s)}function Ss(a,s,l){return!!vu(a,s)||!!al(s,a,l)}function wu(a,s){if(a.length===1)return gc(s,a[0]);for(var l=0;l<s.length;l++)for(var v=s[l],_=0;_<v.length;_++)if(vu(a,v[_]))return!0;for(var E=0;E<a.length;E++)if(gc(s,a[E]))return!0;for(var w=0;w<s.length;w++)if(Kl(a,s[w]))return!0;return!1}function du(a,s,l){if(a.length>1){if(Kl(a,s))return!0;for(var v=0;v<s.length;v++)if(al(s[v],a,l))return!0}for(var _=0;_<a.length;_++)if(al(a[_],s,l))return!0;return!1}function Kl(a,s){if(a.length===0||s.length===0)return!1;for(var l=0;l<a.length-1;l++)for(var v=a[l],_=a[l+1],E=0;E<s.length-1;E++)if(Il(v,_,s[E],s[E+1]))return!0;return!1}function Il(a,s,l,v){return lr(a,l,v)!==lr(s,l,v)&&lr(a,s,l)!==lr(a,s,v)}function al(a,s,l){var v=l*l;if(s.length===1)return a.distSqr(s[0])<v;for(var _=1;_<s.length;_++)if(mc(a,s[_-1],s[_])<v)return!0;return!1}function mc(a,s,l){var v=s.distSqr(l);if(v===0)return a.distSqr(s);var _=((a.x-s.x)*(l.x-s.x)+(a.y-s.y)*(l.y-s.y))/v;return a.distSqr(_<0?s:_>1?l:l.sub(s)._mult(_)._add(s))}function gc(a,s){for(var l,v,_,E=!1,w=0;w<a.length;w++)for(var L=0,B=(l=a[w]).length-1;L<l.length;B=L++)(v=l[L]).y>s.y!=(_=l[B]).y>s.y&&s.x<(_.x-v.x)*(s.y-v.y)/(_.y-v.y)+v.x&&(E=!E);return E}function vu(a,s){for(var l=!1,v=0,_=a.length-1;v<a.length;_=v++){var E=a[v],w=a[_];E.y>s.y!=w.y>s.y&&s.x<(w.x-E.x)*(s.y-E.y)/(w.y-E.y)+E.x&&(l=!l)}return l}function Ql(a,s,l){var v=l[0],_=l[2];if(a.x<v.x&&s.x<v.x||a.x>_.x&&s.x>_.x||a.y<v.y&&s.y<v.y||a.y>_.y&&s.y>_.y)return!1;var E=lr(a,s,l[0]);return E!==lr(a,s,l[1])||E!==lr(a,s,l[2])||E!==lr(a,s,l[3])}function Au(a,s,l){var v=s.paint.get(a).value;return v.kind==="constant"?v.value:l.programConfigurations.get(s.id).getMaxValue(a)}function Po(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Wu(a,s,l,v,_){if(!s[0]&&!s[1])return a;var E=pe.convert(s)._mult(_);l==="viewport"&&E._rotate(-v);for(var w=[],L=0;L<a.length;L++)w.push(a[L].sub(E));return w}fs.prototype.populate=function(a,s,l){var v=this.layers[0],_=[],E=null;v.type==="circle"&&(E=v.layout.get("circle-sort-key"));for(var w=0,L=a;w<L.length;w+=1){var B=L[w],V=B.feature,W=B.id,$=B.index,le=B.sourceLayerIndex,ve=this.layers[0]._featureFilter.needGeometry,Ue=yo(V,ve);if(this.layers[0]._featureFilter.filter(new Di(this.zoom),Ue,l)){var Ve=E?E.evaluate(Ue,{},l):void 0,st={id:W,properties:V.properties,type:V.type,sourceLayerIndex:le,index:$,geometry:ve?Ue.geometry:Ya(V),patterns:{},sortKey:Ve};_.push(st)}}E&&_.sort(function(hn,Kn){return hn.sortKey-Kn.sortKey});for(var Qe=0,St=_;Qe<St.length;Qe+=1){var Vt=St[Qe],ir=Vt.geometry,sr=Vt.index,Sr=Vt.sourceLayerIndex,Xr=a[sr].feature;this.addFeature(Vt,ir,sr,l),s.featureIndex.insert(Xr,ir,sr,Sr,this.index)}},fs.prototype.update=function(a,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,l)},fs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},fs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},fs.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,ue),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},fs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},fs.prototype.addFeature=function(a,s,l,v){for(var _=0,E=s;_<E.length;_+=1)for(var w=0,L=E[_];w<L.length;w+=1){var B=L[w],V=B.x,W=B.y;if(!(V<0||V>=8192||W<0||W>=8192)){var $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),le=$.vertexLength;Eo(this.layoutVertexArray,V,W,-1,-1),Eo(this.layoutVertexArray,V,W,1,-1),Eo(this.layoutVertexArray,V,W,1,1),Eo(this.layoutVertexArray,V,W,-1,1),this.indexArray.emplaceBack(le,le+1,le+2),this.indexArray.emplaceBack(le,le+3,le+2),$.vertexLength+=4,$.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,l,{},v)},Rn("CircleBucket",fs,{omit:["layers"]});var ol=new qo({"circle-sort-key":new zn(be.layout_circle["circle-sort-key"])}),mu={paint:new qo({"circle-radius":new zn(be.paint_circle["circle-radius"]),"circle-color":new zn(be.paint_circle["circle-color"]),"circle-blur":new zn(be.paint_circle["circle-blur"]),"circle-opacity":new zn(be.paint_circle["circle-opacity"]),"circle-translate":new Yn(be.paint_circle["circle-translate"]),"circle-translate-anchor":new Yn(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Yn(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Yn(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zn(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zn(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zn(be.paint_circle["circle-stroke-opacity"])}),layout:ol},ua=typeof Float32Array!="undefined"?Float32Array:Array;function Gs(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Cs(a,s,l){var v=s[0],_=s[1],E=s[2],w=s[3],L=s[4],B=s[5],V=s[6],W=s[7],$=s[8],le=s[9],ve=s[10],Ue=s[11],Ve=s[12],st=s[13],Qe=s[14],St=s[15],Vt=l[0],ir=l[1],sr=l[2],Sr=l[3];return a[0]=Vt*v+ir*L+sr*$+Sr*Ve,a[1]=Vt*_+ir*B+sr*le+Sr*st,a[2]=Vt*E+ir*V+sr*ve+Sr*Qe,a[3]=Vt*w+ir*W+sr*Ue+Sr*St,a[4]=(Vt=l[4])*v+(ir=l[5])*L+(sr=l[6])*$+(Sr=l[7])*Ve,a[5]=Vt*_+ir*B+sr*le+Sr*st,a[6]=Vt*E+ir*V+sr*ve+Sr*Qe,a[7]=Vt*w+ir*W+sr*Ue+Sr*St,a[8]=(Vt=l[8])*v+(ir=l[9])*L+(sr=l[10])*$+(Sr=l[11])*Ve,a[9]=Vt*_+ir*B+sr*le+Sr*st,a[10]=Vt*E+ir*V+sr*ve+Sr*Qe,a[11]=Vt*w+ir*W+sr*Ue+Sr*St,a[12]=(Vt=l[12])*v+(ir=l[13])*L+(sr=l[14])*$+(Sr=l[15])*Ve,a[13]=Vt*_+ir*B+sr*le+Sr*st,a[14]=Vt*E+ir*V+sr*ve+Sr*Qe,a[15]=Vt*w+ir*W+sr*Ue+Sr*St,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,s=0,l=arguments.length;l--;)s+=a[l]*a[l];return Math.sqrt(s)});var Xu,yc=Cs;function Jl(a,s,l){var v=s[0],_=s[1],E=s[2],w=s[3];return a[0]=l[0]*v+l[4]*_+l[8]*E+l[12]*w,a[1]=l[1]*v+l[5]*_+l[9]*E+l[13]*w,a[2]=l[2]*v+l[6]*_+l[10]*E+l[14]*w,a[3]=l[3]*v+l[7]*_+l[11]*E+l[15]*w,a}Xu=new ua(3),ua!=Float32Array&&(Xu[0]=0,Xu[1]=0,Xu[2]=0),function(){var a=new ua(4);ua!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var Qf=(function(){var a=new ua(2);ua!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function s(l){a.call(this,l,mu)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(l){return new fs(l)},s.prototype.queryRadius=function(l){var v=l;return Au("circle-radius",this,v)+Au("circle-stroke-width",this,v)+Po(this.paint.get("circle-translate"))},s.prototype.queryIntersectsFeature=function(l,v,_,E,w,L,B,V){for(var W=Wu(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),L.angle,B),$=this.paint.get("circle-radius").evaluate(v,_)+this.paint.get("circle-stroke-width").evaluate(v,_),le=this.paint.get("circle-pitch-alignment")==="map",ve=le?W:function(Xr,hn){return Xr.map(function(Kn){return ru(Kn,hn)})}(W,V),Ue=le?$*B:$,Ve=0,st=E;Ve<st.length;Ve+=1)for(var Qe=0,St=st[Ve];Qe<St.length;Qe+=1){var Vt=St[Qe],ir=le?Vt:ru(Vt,V),sr=Ue,Sr=Jl([],[Vt.x,Vt.y,0,1],V);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?sr*=Sr[3]/L.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(sr*=L.cameraToCenterDistance/Sr[3]),Ss(ve,ir,sr))return!0}return!1},s}(Gu));function ru(a,s){var l=Jl([],[a.x,a.y,0,1],s);return new pe(l[0]/l[3],l[1]/l[3])}var _c=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(fs);function gu(a,s,l,v){var _=s.width,E=s.height;if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==_*E*l)throw new RangeError("mismatched image size")}else v=new Uint8Array(_*E*l);return a.width=_,a.height=E,a.data=v,a}function ec(a,s,l){var v=s.width,_=s.height;if(v!==a.width||_!==a.height){var E=gu({},{width:v,height:_},l);Cf(a,E,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,v),height:Math.min(a.height,_)},l),a.width=v,a.height=_,a.data=E.data}}function Cf(a,s,l,v,_,E){if(_.width===0||_.height===0)return s;if(_.width>a.width||_.height>a.height||l.x>a.width-_.width||l.y>a.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>s.width||_.height>s.height||v.x>s.width-_.width||v.y>s.height-_.height)throw new RangeError("out of range destination coordinates for image copy");for(var w=a.data,L=s.data,B=0;B<_.height;B++)for(var V=((l.y+B)*a.width+l.x)*E,W=((v.y+B)*s.width+v.x)*E,$=0;$<_.width*E;$++)L[W+$]=w[V+$];return s}Rn("HeatmapBucket",_c,{omit:["layers"]});var nu=function(a,s){gu(this,a,1,s)};nu.prototype.resize=function(a){ec(this,a,1)},nu.prototype.clone=function(){return new nu({width:this.width,height:this.height},new Uint8Array(this.data))},nu.copy=function(a,s,l,v,_){Cf(a,s,l,v,_,1)};var Lo=function(a,s){gu(this,a,4,s)};Lo.prototype.resize=function(a){ec(this,a,4)},Lo.prototype.replace=function(a,s){s?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},Lo.prototype.clone=function(){return new Lo({width:this.width,height:this.height},new Uint8Array(this.data))},Lo.copy=function(a,s,l,v,_){Cf(a,s,l,v,_,4)},Rn("AlphaImage",nu),Rn("RGBAImage",Lo);var tc={paint:new qo({"heatmap-radius":new zn(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zn(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Yn(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new hu(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Yn(be.paint_heatmap["heatmap-opacity"])})};function Kc(a){var s={},l=a.resolution||256,v=a.clips?a.clips.length:1,_=a.image||new Lo({width:l,height:v}),E=function(Ue,Ve,st){s[a.evaluationKey]=st;var Qe=a.expression.evaluate(s);_.data[Ue+Ve+0]=Math.floor(255*Qe.r/Qe.a),_.data[Ue+Ve+1]=Math.floor(255*Qe.g/Qe.a),_.data[Ue+Ve+2]=Math.floor(255*Qe.b/Qe.a),_.data[Ue+Ve+3]=Math.floor(255*Qe.a)};if(a.clips)for(var w=0,L=0;w<v;++w,L+=4*l)for(var B=0,V=0;B<l;B++,V+=4){var W=B/(l-1),$=a.clips[w];E(L,V,$.start*(1-W)+$.end*W)}else for(var le=0,ve=0;le<l;le++,ve+=4)E(0,ve,le/(l-1));return _}var Th=function(a){function s(l){a.call(this,l,tc),this._updateColorRamp()}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(l){return new _c(l)},s.prototype._handleSpecialPaintPropertyUpdate=function(l){l==="heatmap-color"&&this._updateColorRamp()},s.prototype._updateColorRamp=function(){this.colorRamp=Kc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},s.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},s}(Gu),Hs={paint:new qo({"hillshade-illumination-direction":new Yn(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Yn(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Yn(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Yn(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Yn(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Yn(be.paint_hillshade["hillshade-accent-color"])})},jr=function(a){function s(l){a.call(this,l,Hs)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},s}(Gu),wf=Ua([{name:"a_pos",components:2,type:"Int16"}],4).members,Qc=sl,So=sl;function sl(a,s,l){l=l||2;var v,_,E,w,L,B,V,W=s&&s.length,$=W?s[0]*l:a.length,le=Jc(a,0,$,l,!0),ve=[];if(!le||le.next===le.prev)return ve;if(W&&(le=function(Ve,st,Qe,St){var Vt,ir,sr,Sr=[];for(Vt=0,ir=st.length;Vt<ir;Vt++)(sr=Jc(Ve,st[Vt]*St,Vt<ir-1?st[Vt+1]*St:Ve.length,St,!1))===sr.next&&(sr.steiner=!0),Sr.push($d(sr));for(Sr.sort(mp),Vt=0;Vt<Sr.length;Vt++)Mh(Sr[Vt],Qe),Qe=ul(Qe,Qe.next);return Qe}(a,s,le,l)),a.length>80*l){v=E=a[0],_=w=a[1];for(var Ue=l;Ue<$;Ue+=l)(L=a[Ue])<v&&(v=L),(B=a[Ue+1])<_&&(_=B),L>E&&(E=L),B>w&&(w=B);V=(V=Math.max(E-v,w-_))!==0?1/V:0}return Tu(le,ve,l,v,_,V),ve}function Jc(a,s,l,v,_){var E,w;if(_===rh(a,s,l,v)>0)for(E=s;E<l;E+=v)w=rc(E,a[E],a[E+1],w);else for(E=l-v;E>=s;E-=v)w=rc(E,a[E],a[E+1],w);return w&&Ih(w,w.next)&&(xc(w),w=w.next),w}function ul(a,s){if(!a)return a;s||(s=a);var l,v=a;do if(l=!1,v.steiner||!Ih(v,v.next)&&Ro(v.prev,v,v.next)!==0)v=v.next;else{if(xc(v),(v=s=v.prev)===v.next)break;l=!0}while(l||v!==s);return s}function Tu(a,s,l,v,_,E,w){if(a){!w&&E&&function(W,$,le,ve){var Ue=W;do Ue.z===null&&(Ue.z=yp(Ue.x,Ue.y,$,le,ve)),Ue.prevZ=Ue.prev,Ue.nextZ=Ue.next,Ue=Ue.next;while(Ue!==W);Ue.prevZ.nextZ=null,Ue.prevZ=null,function(Ve){var st,Qe,St,Vt,ir,sr,Sr,Xr,hn=1;do{for(Qe=Ve,Ve=null,ir=null,sr=0;Qe;){for(sr++,St=Qe,Sr=0,st=0;st<hn&&(Sr++,St=St.nextZ);st++);for(Xr=hn;Sr>0||Xr>0&&St;)Sr!==0&&(Xr===0||!St||Qe.z<=St.z)?(Vt=Qe,Qe=Qe.nextZ,Sr--):(Vt=St,St=St.nextZ,Xr--),ir?ir.nextZ=Vt:Ve=Vt,Vt.prevZ=ir,ir=Vt;Qe=St}ir.nextZ=null,hn*=2}while(sr>1)}(Ue)}(a,v,_,E);for(var L,B,V=a;a.prev!==a.next;)if(L=a.prev,B=a.next,E?dp(a,v,_,E):ef(a))s.push(L.i/l),s.push(a.i/l),s.push(B.i/l),xc(a),a=B.next,V=B.next;else if((a=B)===V){w?w===1?Tu(a=Jf(ul(a),s,l),s,l,v,_,E,2):w===2&&vp(a,s,l,v,_,E):Tu(ul(a),s,l,v,_,E,1);break}}}function ef(a){var s=a.prev,l=a,v=a.next;if(Ro(s,l,v)>=0)return!1;for(var _=a.next.next;_!==a.prev;){if(Af(s.x,s.y,l.x,l.y,v.x,v.y,_.x,_.y)&&Ro(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function dp(a,s,l,v){var _=a.prev,E=a,w=a.next;if(Ro(_,E,w)>=0)return!1;for(var L=_.x>E.x?_.x>w.x?_.x:w.x:E.x>w.x?E.x:w.x,B=_.y>E.y?_.y>w.y?_.y:w.y:E.y>w.y?E.y:w.y,V=yp(_.x<E.x?_.x<w.x?_.x:w.x:E.x<w.x?E.x:w.x,_.y<E.y?_.y<w.y?_.y:w.y:E.y<w.y?E.y:w.y,s,l,v),W=yp(L,B,s,l,v),$=a.prevZ,le=a.nextZ;$&&$.z>=V&&le&&le.z<=W;){if($!==a.prev&&$!==a.next&&Af(_.x,_.y,E.x,E.y,w.x,w.y,$.x,$.y)&&Ro($.prev,$,$.next)>=0||($=$.prevZ,le!==a.prev&&le!==a.next&&Af(_.x,_.y,E.x,E.y,w.x,w.y,le.x,le.y)&&Ro(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;$&&$.z>=V;){if($!==a.prev&&$!==a.next&&Af(_.x,_.y,E.x,E.y,w.x,w.y,$.x,$.y)&&Ro($.prev,$,$.next)>=0)return!1;$=$.prevZ}for(;le&&le.z<=W;){if(le!==a.prev&&le!==a.next&&Af(_.x,_.y,E.x,E.y,w.x,w.y,le.x,le.y)&&Ro(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function Jf(a,s,l){var v=a;do{var _=v.prev,E=v.next.next;!Ih(_,E)&&kh(_,v,v.next,E)&&th(_,E)&&th(E,_)&&(s.push(_.i/l),s.push(v.i/l),s.push(E.i/l),xc(v),xc(v.next),v=a=E),v=v.next}while(v!==a);return ul(v)}function vp(a,s,l,v,_,E){var w=a;do{for(var L=w.next.next;L!==w.prev;){if(w.i!==L.i&&ud(w,L)){var B=Lh(w,L);return w=ul(w,w.next),B=ul(B,B.next),Tu(w,s,l,v,_,E),void Tu(B,s,l,v,_,E)}L=L.next}w=w.next}while(w!==a)}function mp(a,s){return a.x-s.x}function Mh(a,s){if(s=function(v,_){var E,w=_,L=v.x,B=v.y,V=-1/0;do{if(B<=w.y&&B>=w.next.y&&w.next.y!==w.y){var W=w.x+(B-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(W<=L&&W>V){if(V=W,W===L){if(B===w.y)return w;if(B===w.next.y)return w.next}E=w.x<w.next.x?w:w.next}}w=w.next}while(w!==_);if(!E)return null;if(L===V)return E;var $,le=E,ve=E.x,Ue=E.y,Ve=1/0;w=E;do L>=w.x&&w.x>=ve&&L!==w.x&&Af(B<Ue?L:V,B,ve,Ue,B<Ue?V:L,B,w.x,w.y)&&($=Math.abs(B-w.y)/(L-w.x),th(w,v)&&($<Ve||$===Ve&&(w.x>E.x||w.x===E.x&&gp(E,w)))&&(E=w,Ve=$)),w=w.next;while(w!==le);return E}(a,s)){var l=Lh(s,a);ul(s,s.next),ul(l,l.next)}}function gp(a,s){return Ro(a.prev,a,s.prev)<0&&Ro(s.next,a,a.next)<0}function yp(a,s,l,v,_){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-l)*_)|a<<8))|a<<4))|a<<2))|a<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-v)*_)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function $d(a){var s=a,l=a;do(s.x<l.x||s.x===l.x&&s.y<l.y)&&(l=s),s=s.next;while(s!==a);return l}function Af(a,s,l,v,_,E,w,L){return(_-w)*(s-L)-(a-w)*(E-L)>=0&&(a-w)*(v-L)-(l-w)*(s-L)>=0&&(l-w)*(E-L)-(_-w)*(v-L)>=0}function ud(a,s){return a.next.i!==s.i&&a.prev.i!==s.i&&!function(l,v){var _=l;do{if(_.i!==l.i&&_.next.i!==l.i&&_.i!==v.i&&_.next.i!==v.i&&kh(_,_.next,l,v))return!0;_=_.next}while(_!==l);return!1}(a,s)&&(th(a,s)&&th(s,a)&&function(l,v){var _=l,E=!1,w=(l.x+v.x)/2,L=(l.y+v.y)/2;do _.y>L!=_.next.y>L&&_.next.y!==_.y&&w<(_.next.x-_.x)*(L-_.y)/(_.next.y-_.y)+_.x&&(E=!E),_=_.next;while(_!==l);return E}(a,s)&&(Ro(a.prev,a,s.prev)||Ro(a,s.prev,s))||Ih(a,s)&&Ro(a.prev,a,a.next)>0&&Ro(s.prev,s,s.next)>0)}function Ro(a,s,l){return(s.y-a.y)*(l.x-s.x)-(s.x-a.x)*(l.y-s.y)}function Ih(a,s){return a.x===s.x&&a.y===s.y}function kh(a,s,l,v){var _=Ph(Ro(a,s,l)),E=Ph(Ro(a,s,v)),w=Ph(Ro(l,v,a)),L=Ph(Ro(l,v,s));return _!==E&&w!==L||!(_!==0||!eh(a,l,s))||!(E!==0||!eh(a,v,s))||!(w!==0||!eh(l,a,v))||!(L!==0||!eh(l,s,v))}function eh(a,s,l){return s.x<=Math.max(a.x,l.x)&&s.x>=Math.min(a.x,l.x)&&s.y<=Math.max(a.y,l.y)&&s.y>=Math.min(a.y,l.y)}function Ph(a){return a>0?1:a<0?-1:0}function th(a,s){return Ro(a.prev,a,a.next)<0?Ro(a,s,a.next)>=0&&Ro(a,a.prev,s)>=0:Ro(a,s,a.prev)<0||Ro(a,a.next,s)<0}function Lh(a,s){var l=new Tf(a.i,a.x,a.y),v=new Tf(s.i,s.x,s.y),_=a.next,E=s.prev;return a.next=s,s.prev=a,l.next=_,_.prev=l,v.next=l,l.prev=v,E.next=v,v.prev=E,v}function rc(a,s,l,v){var _=new Tf(a,s,l);return v?(_.next=v.next,_.prev=v,v.next.prev=_,v.next=_):(_.prev=_,_.next=_),_}function xc(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Tf(a,s,l){this.i=a,this.x=s,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function rh(a,s,l,v){for(var _=0,E=s,w=l-v;E<l;E+=v)_+=(a[w]-a[E])*(a[E+1]+a[w+1]),w=E;return _}function Rh(a,s,l,v,_){(function E(w,L,B,V,W){for(;V>B;){if(V-B>600){var $=V-B+1,le=L-B+1,ve=Math.log($),Ue=.5*Math.exp(2*ve/3),Ve=.5*Math.sqrt(ve*Ue*($-Ue)/$)*(le-$/2<0?-1:1);E(w,L,Math.max(B,Math.floor(L-le*Ue/$+Ve)),Math.min(V,Math.floor(L+($-le)*Ue/$+Ve)),W)}var st=w[L],Qe=B,St=V;for(bc(w,B,L),W(w[V],st)>0&&bc(w,B,V);Qe<St;){for(bc(w,Qe,St),Qe++,St--;W(w[Qe],st)<0;)Qe++;for(;W(w[St],st)>0;)St--}W(w[B],st)===0?bc(w,B,St):bc(w,++St,V),St<=L&&(B=St+1),L<=St&&(V=St-1)}})(a,s,l||0,v||a.length-1,_||Mf)}function bc(a,s,l){var v=a[s];a[s]=a[l],a[l]=v}function Mf(a,s){return a<s?-1:a>s?1:0}function ll(a,s){var l=a.length;if(l<=1)return[a];for(var v,_,E=[],w=0;w<l;w++){var L=Br(a[w]);L!==0&&(a[w].area=Math.abs(L),_===void 0&&(_=L<0),_===L<0?(v&&E.push(v),v=[a[w]]):v.push(a[w]))}if(v&&E.push(v),s>1)for(var B=0;B<E.length;B++)E[B].length<=s||(Rh(E[B],s,1,E[B].length-1,Ec),E[B]=E[B].slice(0,s));return E}function Ec(a,s){return s.area-a.area}function nh(a,s,l){for(var v=l.patternDependencies,_=!1,E=0,w=s;E<w.length;E+=1){var L=w[E].paint.get(a+"-pattern");L.isConstant()||(_=!0);var B=L.constantOr(null);B&&(_=!0,v[B.to]=!0,v[B.from]=!0)}return _}function If(a,s,l,v,_){for(var E=_.patternDependencies,w=0,L=s;w<L.length;w+=1){var B=L[w],V=B.paint.get(a+"-pattern").value;if(V.kind!=="constant"){var W=V.evaluate({zoom:v-1},l,{},_.availableImages),$=V.evaluate({zoom:v},l,{},_.availableImages),le=V.evaluate({zoom:v+1},l,{},_.availableImages);$=$&&$.name?$.name:$,le=le&&le.name?le.name:le,E[W=W&&W.name?W.name:W]=!0,E[$]=!0,E[le]=!0,l.patterns[B.id]={min:W,mid:$,max:le}}}return l}sl.deviation=function(a,s,l,v){var _=s&&s.length,E=Math.abs(rh(a,0,_?s[0]*l:a.length,l));if(_)for(var w=0,L=s.length;w<L;w++)E-=Math.abs(rh(a,s[w]*l,w<L-1?s[w+1]*l:a.length,l));var B=0;for(w=0;w<v.length;w+=3){var V=v[w]*l,W=v[w+1]*l,$=v[w+2]*l;B+=Math.abs((a[V]-a[$])*(a[W+1]-a[V+1])-(a[V]-a[W])*(a[$+1]-a[V+1]))}return E===0&&B===0?0:Math.abs((B-E)/E)},sl.flatten=function(a){for(var s=a[0][0].length,l={vertices:[],holes:[],dimensions:s},v=0,_=0;_<a.length;_++){for(var E=0;E<a[_].length;E++)for(var w=0;w<s;w++)l.vertices.push(a[_][E][w]);_>0&&l.holes.push(v+=a[_-1].length)}return l},Qc.default=So;var ws=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Wl,this.indexArray=new nl,this.indexArray2=new $c,this.programConfigurations=new ti(a.layers,a.zoom),this.segments=new Ee,this.segments2=new Ee,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};ws.prototype.populate=function(a,s,l){this.hasPattern=nh("fill",this.layers,s);for(var v=this.layers[0].layout.get("fill-sort-key"),_=[],E=0,w=a;E<w.length;E+=1){var L=w[E],B=L.feature,V=L.id,W=L.index,$=L.sourceLayerIndex,le=this.layers[0]._featureFilter.needGeometry,ve=yo(B,le);if(this.layers[0]._featureFilter.filter(new Di(this.zoom),ve,l)){var Ue=v?v.evaluate(ve,{},l,s.availableImages):void 0,Ve={id:V,properties:B.properties,type:B.type,sourceLayerIndex:$,index:W,geometry:le?ve.geometry:Ya(B),patterns:{},sortKey:Ue};_.push(Ve)}}v&&_.sort(function(Xr,hn){return Xr.sortKey-hn.sortKey});for(var st=0,Qe=_;st<Qe.length;st+=1){var St=Qe[st],Vt=St.geometry,ir=St.index,sr=St.sourceLayerIndex;if(this.hasPattern){var Sr=If("fill",this.layers,St,this.zoom,s);this.patternFeatures.push(Sr)}else this.addFeature(St,Vt,ir,l,{});s.featureIndex.insert(a[ir].feature,Vt,ir,sr,this.index)}},ws.prototype.update=function(a,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,l)},ws.prototype.addFeatures=function(a,s,l){for(var v=0,_=this.patternFeatures;v<_.length;v+=1){var E=_[v];this.addFeature(E,E.geometry,E.index,s,l)}},ws.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ws.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ws.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,wf),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},ws.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ws.prototype.addFeature=function(a,s,l,v,_){for(var E=0,w=ll(s,500);E<w.length;E+=1){for(var L=w[E],B=0,V=0,W=L;V<W.length;V+=1)B+=W[V].length;for(var $=this.segments.prepareSegment(B,this.layoutVertexArray,this.indexArray),le=$.vertexLength,ve=[],Ue=[],Ve=0,st=L;Ve<st.length;Ve+=1){var Qe=st[Ve];if(Qe.length!==0){Qe!==L[0]&&Ue.push(ve.length/2);var St=this.segments2.prepareSegment(Qe.length,this.layoutVertexArray,this.indexArray2),Vt=St.vertexLength;this.layoutVertexArray.emplaceBack(Qe[0].x,Qe[0].y),this.indexArray2.emplaceBack(Vt+Qe.length-1,Vt),ve.push(Qe[0].x),ve.push(Qe[0].y);for(var ir=1;ir<Qe.length;ir++)this.layoutVertexArray.emplaceBack(Qe[ir].x,Qe[ir].y),this.indexArray2.emplaceBack(Vt+ir-1,Vt+ir),ve.push(Qe[ir].x),ve.push(Qe[ir].y);St.vertexLength+=Qe.length,St.primitiveLength+=Qe.length}}for(var sr=Qc(ve,Ue),Sr=0;Sr<sr.length;Sr+=3)this.indexArray.emplaceBack(le+sr[Sr],le+sr[Sr+1],le+sr[Sr+2]);$.vertexLength+=B,$.primitiveLength+=sr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,l,_,v)},Rn("FillBucket",ws,{omit:["layers","patternFeatures"]});var kl=new qo({"fill-sort-key":new zn(be.layout_fill["fill-sort-key"])}),Ns={paint:new qo({"fill-antialias":new Yn(be.paint_fill["fill-antialias"]),"fill-opacity":new zn(be.paint_fill["fill-opacity"]),"fill-color":new zn(be.paint_fill["fill-color"]),"fill-outline-color":new zn(be.paint_fill["fill-outline-color"]),"fill-translate":new Yn(be.paint_fill["fill-translate"]),"fill-translate-anchor":new Yn(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gl(be.paint_fill["fill-pattern"])}),layout:kl},ih=function(a){function s(l){a.call(this,l,Ns)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(l,v){a.prototype.recalculate.call(this,l,v);var _=this.paint._values["fill-outline-color"];_.value.kind==="constant"&&_.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},s.prototype.createBucket=function(l){return new ws(l)},s.prototype.queryRadius=function(){return Po(this.paint.get("fill-translate"))},s.prototype.queryIntersectsFeature=function(l,v,_,E,w,L,B){return wu(Wu(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),L.angle,B),E)},s.prototype.isTileClipped=function(){return!0},s}(Gu),kf=Ua([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,ah=Mu;function Mu(a,s,l,v,_){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=v,this._values=_,a.readFields(tf,this,s)}function tf(a,s,l){a==1?s.id=l.readVarint():a==2?function(v,_){for(var E=v.readVarint()+v.pos;v.pos<E;){var w=_._keys[v.readVarint()],L=_._values[v.readVarint()];_.properties[w]=L}}(l,s):a==3?s.type=l.readVarint():a==4&&(s._geometry=l.pos)}function ld(a){for(var s,l,v=0,_=0,E=a.length,w=E-1;_<E;w=_++)v+=((l=a[w]).x-(s=a[_]).x)*(s.y+l.y);return v}Mu.types=["Unknown","Point","LineString","Polygon"],Mu.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var s,l=a.readVarint()+a.pos,v=1,_=0,E=0,w=0,L=[];a.pos<l;){if(_<=0){var B=a.readVarint();v=7&B,_=B>>3}if(_--,v===1||v===2)E+=a.readSVarint(),w+=a.readSVarint(),v===1&&(s&&L.push(s),s=[]),s.push(new pe(E,w));else{if(v!==7)throw new Error("unknown command "+v);s&&s.push(s[0].clone())}}return s&&L.push(s),L},Mu.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var s=a.readVarint()+a.pos,l=1,v=0,_=0,E=0,w=1/0,L=-1/0,B=1/0,V=-1/0;a.pos<s;){if(v<=0){var W=a.readVarint();l=7&W,v=W>>3}if(v--,l===1||l===2)(_+=a.readSVarint())<w&&(w=_),_>L&&(L=_),(E+=a.readSVarint())<B&&(B=E),E>V&&(V=E);else if(l!==7)throw new Error("unknown command "+l)}return[w,B,L,V]},Mu.prototype.toGeoJSON=function(a,s,l){var v,_,E=this.extent*Math.pow(2,l),w=this.extent*a,L=this.extent*s,B=this.loadGeometry(),V=Mu.types[this.type];function W(ve){for(var Ue=0;Ue<ve.length;Ue++){var Ve=ve[Ue];ve[Ue]=[360*(Ve.x+w)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ve.y+L)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var $=[];for(v=0;v<B.length;v++)$[v]=B[v][0];W(B=$);break;case 2:for(v=0;v<B.length;v++)W(B[v]);break;case 3:for(B=function(ve){var Ue=ve.length;if(Ue<=1)return[ve];for(var Ve,st,Qe=[],St=0;St<Ue;St++){var Vt=ld(ve[St]);Vt!==0&&(st===void 0&&(st=Vt<0),st===Vt<0?(Ve&&Qe.push(Ve),Ve=[ve[St]]):Ve.push(ve[St]))}return Ve&&Qe.push(Ve),Qe}(B),v=0;v<B.length;v++)for(_=0;_<B[v].length;_++)W(B[v][_])}B.length===1?B=B[0]:V="Multi"+V;var le={type:"Feature",geometry:{type:V,coordinates:B},properties:this.properties};return"id"in this&&(le.id=this.id),le};var Oh=_p;function _p(a,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(xp,this,s),this.length=this._features.length}function xp(a,s,l){a===15?s.version=l.readVarint():a===1?s.name=l.readString():a===5?s.extent=l.readVarint():a===2?s._features.push(l.pos):a===3?s._keys.push(l.readString()):a===4&&s._values.push(function(v){for(var _=null,E=v.readVarint()+v.pos;v.pos<E;){var w=v.readVarint()>>3;_=w===1?v.readString():w===2?v.readFloat():w===3?v.readDouble():w===4?v.readVarint64():w===5?v.readVarint():w===6?v.readSVarint():w===7?v.readBoolean():null}return _}(l))}function oh(a,s,l){if(a===3){var v=new Oh(l,l.readVarint()+l.pos);v.length&&(s[v.name]=v)}}_p.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var s=this._pbf.readVarint()+this._pbf.pos;return new ah(this._pbf,s,this.extent,this._keys,this._values)};var Yu={VectorTile:function(a,s){this.layers=a.readFields(oh,{},s)},VectorTileFeature:ah,VectorTileLayer:Oh},bp=Yu.VectorTileFeature.types,Dh=Math.pow(2,13);function Pf(a,s,l,v,_,E,w,L){a.emplaceBack(s,l,2*Math.floor(v*Dh)+w,_*Dh*2,E*Dh*2,Math.round(L))}var cl=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Hu,this.indexArray=new nl,this.programConfigurations=new ti(a.layers,a.zoom),this.segments=new Ee,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function cd(a,s){return a.x===s.x&&(a.x<0||a.x>8192)||a.y===s.y&&(a.y<0||a.y>8192)}cl.prototype.populate=function(a,s,l){this.features=[],this.hasPattern=nh("fill-extrusion",this.layers,s);for(var v=0,_=a;v<_.length;v+=1){var E=_[v],w=E.feature,L=E.id,B=E.index,V=E.sourceLayerIndex,W=this.layers[0]._featureFilter.needGeometry,$=yo(w,W);if(this.layers[0]._featureFilter.filter(new Di(this.zoom),$,l)){var le={id:L,sourceLayerIndex:V,index:B,geometry:W?$.geometry:Ya(w),properties:w.properties,type:w.type,patterns:{}};this.hasPattern?this.features.push(If("fill-extrusion",this.layers,le,this.zoom,s)):this.addFeature(le,le.geometry,B,l,{}),s.featureIndex.insert(w,le.geometry,B,V,this.index,!0)}}},cl.prototype.addFeatures=function(a,s,l){for(var v=0,_=this.features;v<_.length;v+=1){var E=_[v];this.addFeature(E,E.geometry,E.index,s,l)}},cl.prototype.update=function(a,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,l)},cl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},cl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},cl.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,kf),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},cl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},cl.prototype.addFeature=function(a,s,l,v,_){for(var E=0,w=ll(s,500);E<w.length;E+=1){for(var L=w[E],B=0,V=0,W=L;V<W.length;V+=1)B+=W[V].length;for(var $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),le=0,ve=L;le<ve.length;le+=1){var Ue=ve[le];if(Ue.length!==0&&!((Wi=Ue).every(function(Li){return Li.x<0})||Wi.every(function(Li){return Li.x>8192})||Wi.every(function(Li){return Li.y<0})||Wi.every(function(Li){return Li.y>8192})))for(var Ve=0,st=0;st<Ue.length;st++){var Qe=Ue[st];if(st>=1){var St=Ue[st-1];if(!cd(Qe,St)){$.vertexLength+4>Ee.MAX_VERTEX_ARRAY_LENGTH&&($=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Vt=Qe.sub(St)._perp()._unit(),ir=St.dist(Qe);Ve+ir>32768&&(Ve=0),Pf(this.layoutVertexArray,Qe.x,Qe.y,Vt.x,Vt.y,0,0,Ve),Pf(this.layoutVertexArray,Qe.x,Qe.y,Vt.x,Vt.y,0,1,Ve),Pf(this.layoutVertexArray,St.x,St.y,Vt.x,Vt.y,0,0,Ve+=ir),Pf(this.layoutVertexArray,St.x,St.y,Vt.x,Vt.y,0,1,Ve);var sr=$.vertexLength;this.indexArray.emplaceBack(sr,sr+2,sr+1),this.indexArray.emplaceBack(sr+1,sr+2,sr+3),$.vertexLength+=4,$.primitiveLength+=2}}}}if($.vertexLength+B>Ee.MAX_VERTEX_ARRAY_LENGTH&&($=this.segments.prepareSegment(B,this.layoutVertexArray,this.indexArray)),bp[a.type]==="Polygon"){for(var Sr=[],Xr=[],hn=$.vertexLength,Kn=0,Mn=L;Kn<Mn.length;Kn+=1){var ni=Mn[Kn];if(ni.length!==0){ni!==L[0]&&Xr.push(Sr.length/2);for(var Pn=0;Pn<ni.length;Pn++){var Bi=ni[Pn];Pf(this.layoutVertexArray,Bi.x,Bi.y,0,0,1,1,0),Sr.push(Bi.x),Sr.push(Bi.y)}}}for(var yi=Qc(Sr,Xr),Wn=0;Wn<yi.length;Wn+=3)this.indexArray.emplaceBack(hn+yi[Wn],hn+yi[Wn+2],hn+yi[Wn+1]);$.primitiveLength+=yi.length/3,$.vertexLength+=B}}var Wi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,l,_,v)},Rn("FillExtrusionBucket",cl,{omit:["layers","features"]});var Ep={paint:new qo({"fill-extrusion-opacity":new Yn(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zn(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Yn(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Yn(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gl(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new zn(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zn(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Yn(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},fl=function(a){function s(l){a.call(this,l,Ep)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(l){return new cl(l)},s.prototype.queryRadius=function(){return Po(this.paint.get("fill-extrusion-translate"))},s.prototype.is3D=function(){return!0},s.prototype.queryIntersectsFeature=function(l,v,_,E,w,L,B,V){var W=Wu(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),L.angle,B),$=this.paint.get("fill-extrusion-height").evaluate(v,_),le=this.paint.get("fill-extrusion-base").evaluate(v,_),ve=function(Ve,st,Qe,St){for(var Vt=[],ir=0,sr=Ve;ir<sr.length;ir+=1){var Sr=sr[ir],Xr=[Sr.x,Sr.y,0,1];Jl(Xr,Xr,st),Vt.push(new pe(Xr[0]/Xr[3],Xr[1]/Xr[3]))}return Vt}(W,V),Ue=function(Ve,st,Qe,St){for(var Vt=[],ir=[],sr=St[8]*st,Sr=St[9]*st,Xr=St[10]*st,hn=St[11]*st,Kn=St[8]*Qe,Mn=St[9]*Qe,ni=St[10]*Qe,Pn=St[11]*Qe,Bi=0,yi=Ve;Bi<yi.length;Bi+=1){for(var Wn=[],Wi=[],Li=0,ca=yi[Bi];Li<ca.length;Li+=1){var ii=ca[Li],ga=ii.x,fo=ii.y,Co=St[0]*ga+St[4]*fo+St[12],wo=St[1]*ga+St[5]*fo+St[13],io=St[2]*ga+St[6]*fo+St[14],xo=St[3]*ga+St[7]*fo+St[15],vs=io+Xr,ms=xo+hn,Ws=Co+Kn,Is=wo+Mn,Xs=io+ni,jo=xo+Pn,No=new pe((Co+sr)/ms,(wo+Sr)/ms);No.z=vs/ms,Wn.push(No);var ea=new pe(Ws/jo,Is/jo);ea.z=Xs/jo,Wi.push(ea)}Vt.push(Wn),ir.push(Wi)}return[Vt,ir]}(E,le,$,V);return function(Ve,st,Qe){var St=1/0;wu(Qe,st)&&(St=rf(Qe,st[0]));for(var Vt=0;Vt<st.length;Vt++)for(var ir=st[Vt],sr=Ve[Vt],Sr=0;Sr<ir.length-1;Sr++){var Xr=ir[Sr],hn=[Xr,ir[Sr+1],sr[Sr+1],sr[Sr],Xr];il(Qe,hn)&&(St=Math.min(St,rf(Qe,hn)))}return St!==1/0&&St}(Ue[0],Ue[1],ve)},s}(Gu);function Lf(a,s){return a.x*s.x+a.y*s.y}function rf(a,s){if(a.length===1){for(var l,v=0,_=s[v++];!l||_.equals(l);)if(!(l=s[v++]))return 1/0;for(;v<s.length;v++){var E=s[v],w=a[0],L=l.sub(_),B=E.sub(_),V=w.sub(_),W=Lf(L,L),$=Lf(L,B),le=Lf(B,B),ve=Lf(V,L),Ue=Lf(V,B),Ve=W*le-$*$,st=(le*ve-$*Ue)/Ve,Qe=(W*Ue-$*ve)/Ve,St=_.z*(1-st-Qe)+l.z*st+E.z*Qe;if(isFinite(St))return St}return 1/0}for(var Vt=1/0,ir=0,sr=s;ir<sr.length;ir+=1)Vt=Math.min(Vt,sr[ir].z);return Vt}var Sc=Ua([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,iu=Ua([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,sh=Yu.VectorTileFeature.types,Fh=Math.cos(Math.PI/180*37.5),Sp=Math.pow(2,14)/.5,Sa=function(a){var s=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(l){return l.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(l){s.gradients[l.id]={}}),this.layoutVertexArray=new os,this.layoutVertexArray2=new wl,this.indexArray=new nl,this.programConfigurations=new ti(a.layers,a.zoom),this.segments=new Ee,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(l){return l.isStateDependent()}).map(function(l){return l.id})};Sa.prototype.populate=function(a,s,l){this.hasPattern=nh("line",this.layers,s);for(var v=this.layers[0].layout.get("line-sort-key"),_=[],E=0,w=a;E<w.length;E+=1){var L=w[E],B=L.feature,V=L.id,W=L.index,$=L.sourceLayerIndex,le=this.layers[0]._featureFilter.needGeometry,ve=yo(B,le);if(this.layers[0]._featureFilter.filter(new Di(this.zoom),ve,l)){var Ue=v?v.evaluate(ve,{},l):void 0,Ve={id:V,properties:B.properties,type:B.type,sourceLayerIndex:$,index:W,geometry:le?ve.geometry:Ya(B),patterns:{},sortKey:Ue};_.push(Ve)}}v&&_.sort(function(Xr,hn){return Xr.sortKey-hn.sortKey});for(var st=0,Qe=_;st<Qe.length;st+=1){var St=Qe[st],Vt=St.geometry,ir=St.index,sr=St.sourceLayerIndex;if(this.hasPattern){var Sr=If("line",this.layers,St,this.zoom,s);this.patternFeatures.push(Sr)}else this.addFeature(St,Vt,ir,l,{});s.featureIndex.insert(a[ir].feature,Vt,ir,sr,this.index)}},Sa.prototype.update=function(a,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,l)},Sa.prototype.addFeatures=function(a,s,l){for(var v=0,_=this.patternFeatures;v<_.length;v+=1){var E=_[v];this.addFeature(E,E.geometry,E.index,s,l)}},Sa.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Sa.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Sa.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,iu)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Sc),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Sa.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Sa.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},Sa.prototype.addFeature=function(a,s,l,v,_){var E=this.layers[0].layout,w=E.get("line-join").evaluate(a,{}),L=E.get("line-cap"),B=E.get("line-miter-limit"),V=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var W=0,$=s;W<$.length;W+=1)this.addLine($[W],a,w,L,B,V);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,l,_,v)},Sa.prototype.addLine=function(a,s,l,v,_,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var w=0;w<a.length-1;w++)this.totalDistance+=a[w].dist(a[w+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var L=sh[s.type]==="Polygon",B=a.length;B>=2&&a[B-1].equals(a[B-2]);)B--;for(var V=0;V<B-1&&a[V].equals(a[V+1]);)V++;if(!(B<(L?3:2))){l==="bevel"&&(_=1.05);var W,$=this.overscaling<=16?122880/(512*this.overscaling):0,le=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray),ve=void 0,Ue=void 0,Ve=void 0,st=void 0;this.e1=this.e2=-1,L&&(st=a[V].sub(W=a[B-2])._unit()._perp());for(var Qe=V;Qe<B;Qe++)if(!(Ue=Qe===B-1?L?a[V+1]:void 0:a[Qe+1])||!a[Qe].equals(Ue)){st&&(Ve=st),W&&(ve=W),W=a[Qe],st=Ue?Ue.sub(W)._unit()._perp():Ve;var St=(Ve=Ve||st).add(st);St.x===0&&St.y===0||St._unit();var Vt=Ve.x*st.x+Ve.y*st.y,ir=St.x*st.x+St.y*st.y,sr=ir!==0?1/ir:1/0,Sr=2*Math.sqrt(2-2*ir),Xr=ir<Fh&&ve&&Ue,hn=Ve.x*st.y-Ve.y*st.x>0;if(Xr&&Qe>V){var Kn=W.dist(ve);if(Kn>2*$){var Mn=W.sub(W.sub(ve)._mult($/Kn)._round());this.updateDistance(ve,Mn),this.addCurrentVertex(Mn,Ve,0,0,le),ve=Mn}}var ni=ve&&Ue,Pn=ni?l:L?"butt":v;if(ni&&Pn==="round"&&(sr<E?Pn="miter":sr<=2&&(Pn="fakeround")),Pn==="miter"&&sr>_&&(Pn="bevel"),Pn==="bevel"&&(sr>2&&(Pn="flipbevel"),sr<_&&(Pn="miter")),ve&&this.updateDistance(ve,W),Pn==="miter")St._mult(sr),this.addCurrentVertex(W,St,0,0,le);else if(Pn==="flipbevel"){if(sr>100)St=st.mult(-1);else{var Bi=sr*Ve.add(st).mag()/Ve.sub(st).mag();St._perp()._mult(Bi*(hn?-1:1))}this.addCurrentVertex(W,St,0,0,le),this.addCurrentVertex(W,St.mult(-1),0,0,le)}else if(Pn==="bevel"||Pn==="fakeround"){var yi=-Math.sqrt(sr*sr-1),Wn=hn?yi:0,Wi=hn?0:yi;if(ve&&this.addCurrentVertex(W,Ve,Wn,Wi,le),Pn==="fakeround")for(var Li=Math.round(180*Sr/Math.PI/20),ca=1;ca<Li;ca++){var ii=ca/Li;if(ii!==.5){var ga=ii-.5;ii+=ii*ga*(ii-1)*((1.0904+Vt*(Vt*(3.55645-1.43519*Vt)-3.2452))*ga*ga+(.848013+Vt*(.215638*Vt-1.06021)))}var fo=st.sub(Ve)._mult(ii)._add(Ve)._unit()._mult(hn?-1:1);this.addHalfVertex(W,fo.x,fo.y,!1,hn,0,le)}Ue&&this.addCurrentVertex(W,st,-Wn,-Wi,le)}else if(Pn==="butt")this.addCurrentVertex(W,St,0,0,le);else if(Pn==="square"){var Co=ve?1:-1;this.addCurrentVertex(W,St,Co,Co,le)}else Pn==="round"&&(ve&&(this.addCurrentVertex(W,Ve,0,0,le),this.addCurrentVertex(W,Ve,1,1,le,!0)),Ue&&(this.addCurrentVertex(W,st,-1,-1,le,!0),this.addCurrentVertex(W,st,0,0,le)));if(Xr&&Qe<B-1){var wo=W.dist(Ue);if(wo>2*$){var io=W.add(Ue.sub(W)._mult($/wo)._round());this.updateDistance(W,io),this.addCurrentVertex(io,st,0,0,le),W=io}}}}},Sa.prototype.addCurrentVertex=function(a,s,l,v,_,E){E===void 0&&(E=!1);var w=s.y*v-s.x,L=-s.y-s.x*v;this.addHalfVertex(a,s.x+s.y*l,s.y-s.x*l,E,!1,l,_),this.addHalfVertex(a,w,L,E,!0,-v,_),this.distance>Sp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,s,l,v,_,E))},Sa.prototype.addHalfVertex=function(a,s,l,v,_,E,w){var L=.5*(this.lineClips?this.scaledDistance*(Sp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(v?1:0),(a.y<<1)+(_?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(E===0?0:E<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var B=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,B),w.primitiveLength++),_?this.e2=B:this.e1=B},Sa.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Sa.prototype.updateDistance=function(a,s){this.distance+=a.dist(s),this.updateScaledDistance()},Rn("LineBucket",Sa,{omit:["layers","patternFeatures"]});var Cc=new qo({"line-cap":new Yn(be.layout_line["line-cap"]),"line-join":new zn(be.layout_line["line-join"]),"line-miter-limit":new Yn(be.layout_line["line-miter-limit"]),"line-round-limit":new Yn(be.layout_line["line-round-limit"]),"line-sort-key":new zn(be.layout_line["line-sort-key"])}),Zo={paint:new qo({"line-opacity":new zn(be.paint_line["line-opacity"]),"line-color":new zn(be.paint_line["line-color"]),"line-translate":new Yn(be.paint_line["line-translate"]),"line-translate-anchor":new Yn(be.paint_line["line-translate-anchor"]),"line-width":new zn(be.paint_line["line-width"]),"line-gap-width":new zn(be.paint_line["line-gap-width"]),"line-offset":new zn(be.paint_line["line-offset"]),"line-blur":new zn(be.paint_line["line-blur"]),"line-dasharray":new $o(be.paint_line["line-dasharray"]),"line-pattern":new Gl(be.paint_line["line-pattern"]),"line-gradient":new hu(be.paint_line["line-gradient"])}),layout:Cc},Er=new(function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(l,v){return v=new Di(Math.floor(v.zoom),{now:v.now,fadeDuration:v.fadeDuration,zoomHistory:v.zoomHistory,transition:v.transition}),a.prototype.possiblyEvaluate.call(this,l,v)},s.prototype.evaluate=function(l,v,_,E){return v=xt({},v,{zoom:Math.floor(v.zoom)}),a.prototype.evaluate.call(this,l,v,_,E)},s}(zn))(Zo.paint.properties["line-width"].specification);Er.useIntegerZoom=!0;var nc=function(a){function s(l){a.call(this,l,Zo),this.gradientVersion=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._handleSpecialPaintPropertyUpdate=function(l){l==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof gs,this.gradientVersion=(this.gradientVersion+1)%Ge)},s.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},s.prototype.recalculate=function(l,v){a.prototype.recalculate.call(this,l,v),this.paint._values["line-floorwidth"]=Er.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)},s.prototype.createBucket=function(l){return new Sa(l)},s.prototype.queryRadius=function(l){var v=l,_=fd(Au("line-width",this,v),Au("line-gap-width",this,v)),E=Au("line-offset",this,v);return _/2+Math.abs(E)+Po(this.paint.get("line-translate"))},s.prototype.queryIntersectsFeature=function(l,v,_,E,w,L,B){var V=Wu(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),L.angle,B),W=B/2*fd(this.paint.get("line-width").evaluate(v,_),this.paint.get("line-gap-width").evaluate(v,_)),$=this.paint.get("line-offset").evaluate(v,_);return $&&(E=function(le,ve){for(var Ue=[],Ve=new pe(0,0),st=0;st<le.length;st++){for(var Qe=le[st],St=[],Vt=0;Vt<Qe.length;Vt++){var ir=Qe[Vt],sr=Qe[Vt+1],Sr=Vt===0?Ve:ir.sub(Qe[Vt-1])._unit()._perp(),Xr=Vt===Qe.length-1?Ve:sr.sub(ir)._unit()._perp(),hn=Sr._add(Xr)._unit();hn._mult(1/(hn.x*Xr.x+hn.y*Xr.y)),St.push(hn._mult(ve)._add(ir))}Ue.push(St)}return Ue}(E,$*B)),function(le,ve,Ue){for(var Ve=0;Ve<ve.length;Ve++){var st=ve[Ve];if(le.length>=3){for(var Qe=0;Qe<st.length;Qe++)if(vu(le,st[Qe]))return!0}if(du(le,st,Ue))return!0}return!1}(V,E,W)},s.prototype.isTileClipped=function(){return!0},s}(Gu);function fd(a,s){return s>0?s+2*a:a}var hd=Ua([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),qd=Ua([{name:"a_projected_pos",components:3,type:"Float32"}],4),Kd=(Ua([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ua([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Cp=(Ua([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ua([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),pd=Ua([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Lv(a,s,l){return a.sections.forEach(function(v){v.text=function(_,E,w){var L=E.layout.get("text-transform").evaluate(w,{});return L==="uppercase"?_=_.toLocaleUpperCase():L==="lowercase"&&(_=_.toLocaleLowerCase()),eu.applyArabicShaping&&(_=eu.applyArabicShaping(_)),_}(v.text,s,l)}),a}Ua([{name:"triangle",components:3,type:"Uint16"}]),Ua([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ua([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ua([{type:"Float32",name:"offsetX"}]),Ua([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var wc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},dd=function(a,s,l,v,_){var E,w,L=8*_-v-1,B=(1<<L)-1,V=B>>1,W=-7,$=l?_-1:0,le=l?-1:1,ve=a[s+$];for($+=le,E=ve&(1<<-W)-1,ve>>=-W,W+=L;W>0;E=256*E+a[s+$],$+=le,W-=8);for(w=E&(1<<-W)-1,E>>=-W,W+=v;W>0;w=256*w+a[s+$],$+=le,W-=8);if(E===0)E=1-V;else{if(E===B)return w?NaN:1/0*(ve?-1:1);w+=Math.pow(2,v),E-=V}return(ve?-1:1)*w*Math.pow(2,E-v)},wp=function(a,s,l,v,_,E){var w,L,B,V=8*E-_-1,W=(1<<V)-1,$=W>>1,le=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,ve=v?0:E-1,Ue=v?1:-1,Ve=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(L=isNaN(s)?1:0,w=W):(w=Math.floor(Math.log(s)/Math.LN2),s*(B=Math.pow(2,-w))<1&&(w--,B*=2),(s+=w+$>=1?le/B:le*Math.pow(2,1-$))*B>=2&&(w++,B/=2),w+$>=W?(L=0,w=W):w+$>=1?(L=(s*B-1)*Math.pow(2,_),w+=$):(L=s*Math.pow(2,$-1)*Math.pow(2,_),w=0));_>=8;a[l+ve]=255&L,ve+=Ue,L/=256,_-=8);for(w=w<<_|L,V+=_;V>0;a[l+ve]=255&w,ve+=Ue,w/=256,V-=8);a[l+ve-Ue]|=128*Ve},Rf=Za;function Za(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Za.Varint=0,Za.Fixed64=1,Za.Bytes=2,Za.Fixed32=5;var Ap=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Pl(a){return a.type===Za.Bytes?a.readVarint()+a.pos:a.pos+1}function Of(a,s,l){return l?4294967296*s+(a>>>0):4294967296*(s>>>0)+(a>>>0)}function Tp(a,s,l){var v=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));l.realloc(v);for(var _=l.pos-1;_>=a;_--)l.buf[_+v]=l.buf[_]}function Rv(a,s){for(var l=0;l<a.length;l++)s.writeVarint(a[l])}function Z(a,s){for(var l=0;l<a.length;l++)s.writeSVarint(a[l])}function we(a,s){for(var l=0;l<a.length;l++)s.writeFloat(a[l])}function Xe(a,s){for(var l=0;l<a.length;l++)s.writeDouble(a[l])}function Kt(a,s){for(var l=0;l<a.length;l++)s.writeBoolean(a[l])}function br(a,s){for(var l=0;l<a.length;l++)s.writeFixed32(a[l])}function $t(a,s){for(var l=0;l<a.length;l++)s.writeSFixed32(a[l])}function mr(a,s){for(var l=0;l<a.length;l++)s.writeFixed64(a[l])}function Ar(a,s){for(var l=0;l<a.length;l++)s.writeSFixed64(a[l])}function Rr(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+16777216*a[s+3]}function Nr(a,s,l){a[l]=s,a[l+1]=s>>>8,a[l+2]=s>>>16,a[l+3]=s>>>24}function Gr(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+(a[s+3]<<24)}function Wr(a,s,l){a===1&&l.readMessage(un,s)}function un(a,s,l){if(a===3){var v=l.readMessage(Fr,{}),_=v.width,E=v.height,w=v.left,L=v.top,B=v.advance;s.push({id:v.id,bitmap:new nu({width:_+6,height:E+6},v.bitmap),metrics:{width:_,height:E,left:w,top:L,advance:B}})}}function Fr(a,s,l){a===1?s.id=l.readVarint():a===2?s.bitmap=l.readBytes():a===3?s.width=l.readVarint():a===4?s.height=l.readVarint():a===5?s.left=l.readSVarint():a===6?s.top=l.readSVarint():a===7&&(s.advance=l.readVarint())}function Vr(a){for(var s=0,l=0,v=0,_=a;v<_.length;v+=1){var E=_[v];s+=E.w*E.h,l=Math.max(l,E.w)}a.sort(function(Ve,st){return st.h-Ve.h});for(var w=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),l),h:1/0}],L=0,B=0,V=0,W=a;V<W.length;V+=1)for(var $=W[V],le=w.length-1;le>=0;le--){var ve=w[le];if(!($.w>ve.w||$.h>ve.h)){if($.x=ve.x,$.y=ve.y,B=Math.max(B,$.y+$.h),L=Math.max(L,$.x+$.w),$.w===ve.w&&$.h===ve.h){var Ue=w.pop();le<w.length&&(w[le]=Ue)}else $.h===ve.h?(ve.x+=$.w,ve.w-=$.w):$.w===ve.w?(ve.y+=$.h,ve.h-=$.h):(w.push({x:ve.x+$.w,y:ve.y,w:ve.w-$.w,h:$.h}),ve.y+=$.h,ve.h-=$.h);break}}return{w:L,h:B,fill:s/(L*B)||0}}Za.prototype={destroy:function(){this.buf=null},readFields:function(a,s,l){for(l=l||this.length;this.pos<l;){var v=this.readVarint(),_=v>>3,E=this.pos;this.type=7&v,a(_,s,this),this.pos===E&&this.skip(v)}return s},readMessage:function(a,s){return this.readFields(a,s,this.readVarint()+this.pos)},readFixed32:function(){var a=Rr(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Gr(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Rr(this.buf,this.pos)+4294967296*Rr(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=Rr(this.buf,this.pos)+4294967296*Gr(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=dd(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=dd(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var s,l,v=this.buf;return s=127&(l=v[this.pos++]),l<128?s:(s|=(127&(l=v[this.pos++]))<<7,l<128?s:(s|=(127&(l=v[this.pos++]))<<14,l<128?s:(s|=(127&(l=v[this.pos++]))<<21,l<128?s:function(_,E,w){var L,B,V=w.buf;if(L=(112&(B=V[w.pos++]))>>4,B<128||(L|=(127&(B=V[w.pos++]))<<3,B<128)||(L|=(127&(B=V[w.pos++]))<<10,B<128)||(L|=(127&(B=V[w.pos++]))<<17,B<128)||(L|=(127&(B=V[w.pos++]))<<24,B<128)||(L|=(1&(B=V[w.pos++]))<<31,B<128))return Of(_,L,E);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(l=v[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,s=this.pos;return this.pos=a,a-s>=12&&Ap?function(l,v,_){return Ap.decode(l.subarray(v,_))}(this.buf,s,a):function(l,v,_){for(var E="",w=v;w<_;){var L,B,V,W=l[w],$=null,le=W>239?4:W>223?3:W>191?2:1;if(w+le>_)break;le===1?W<128&&($=W):le===2?(192&(L=l[w+1]))==128&&($=(31&W)<<6|63&L)<=127&&($=null):le===3?(B=l[w+2],(192&(L=l[w+1]))==128&&(192&B)==128&&(($=(15&W)<<12|(63&L)<<6|63&B)<=2047||$>=55296&&$<=57343)&&($=null)):le===4&&(B=l[w+2],V=l[w+3],(192&(L=l[w+1]))==128&&(192&B)==128&&(192&V)==128&&(($=(15&W)<<18|(63&L)<<12|(63&B)<<6|63&V)<=65535||$>=1114112)&&($=null)),$===null?($=65533,le=1):$>65535&&($-=65536,E+=String.fromCharCode($>>>10&1023|55296),$=56320|1023&$),E+=String.fromCharCode($),w+=le}return E}(this.buf,s,a)},readBytes:function(){var a=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,a);return this.pos=a,s},readPackedVarint:function(a,s){if(this.type!==Za.Bytes)return a.push(this.readVarint(s));var l=Pl(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(s));return a},readPackedSVarint:function(a){if(this.type!==Za.Bytes)return a.push(this.readSVarint());var s=Pl(this);for(a=a||[];this.pos<s;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Za.Bytes)return a.push(this.readBoolean());var s=Pl(this);for(a=a||[];this.pos<s;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Za.Bytes)return a.push(this.readFloat());var s=Pl(this);for(a=a||[];this.pos<s;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Za.Bytes)return a.push(this.readDouble());var s=Pl(this);for(a=a||[];this.pos<s;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Za.Bytes)return a.push(this.readFixed32());var s=Pl(this);for(a=a||[];this.pos<s;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Za.Bytes)return a.push(this.readSFixed32());var s=Pl(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Za.Bytes)return a.push(this.readFixed64());var s=Pl(this);for(a=a||[];this.pos<s;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Za.Bytes)return a.push(this.readSFixed64());var s=Pl(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed64());return a},skip:function(a){var s=7&a;if(s===Za.Varint)for(;this.buf[this.pos++]>127;);else if(s===Za.Bytes)this.pos=this.readVarint()+this.pos;else if(s===Za.Fixed32)this.pos+=4;else{if(s!==Za.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(a,s){this.writeVarint(a<<3|s)},realloc:function(a){for(var s=this.length||16;s<this.pos+a;)s*=2;if(s!==this.length){var l=new Uint8Array(s);l.set(this.buf),this.buf=l,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Nr(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Nr(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Nr(this.buf,-1&a,this.pos),Nr(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Nr(this.buf,-1&a,this.pos),Nr(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(s,l){var v,_;if(s>=0?(v=s%4294967296|0,_=s/4294967296|0):(_=~(-s/4294967296),4294967295^(v=~(-s%4294967296))?v=v+1|0:(v=0,_=_+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(E,w,L){L.buf[L.pos++]=127&E|128,E>>>=7,L.buf[L.pos++]=127&E|128,E>>>=7,L.buf[L.pos++]=127&E|128,E>>>=7,L.buf[L.pos++]=127&E|128,L.buf[L.pos]=127&(E>>>=7)}(v,0,l),function(E,w){var L=(7&E)<<4;w.buf[w.pos++]|=L|((E>>>=3)?128:0),E&&(w.buf[w.pos++]=127&E|((E>>>=7)?128:0),E&&(w.buf[w.pos++]=127&E|((E>>>=7)?128:0),E&&(w.buf[w.pos++]=127&E|((E>>>=7)?128:0),E&&(w.buf[w.pos++]=127&E|((E>>>=7)?128:0),E&&(w.buf[w.pos++]=127&E)))))}(_,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var s=this.pos;this.pos=function(v,_,E){for(var w,L,B=0;B<_.length;B++){if((w=_.charCodeAt(B))>55295&&w<57344){if(!L){w>56319||B+1===_.length?(v[E++]=239,v[E++]=191,v[E++]=189):L=w;continue}if(w<56320){v[E++]=239,v[E++]=191,v[E++]=189,L=w;continue}w=L-55296<<10|w-56320|65536,L=null}else L&&(v[E++]=239,v[E++]=191,v[E++]=189,L=null);w<128?v[E++]=w:(w<2048?v[E++]=w>>6|192:(w<65536?v[E++]=w>>12|224:(v[E++]=w>>18|240,v[E++]=w>>12&63|128),v[E++]=w>>6&63|128),v[E++]=63&w|128)}return E}(this.buf,a,this.pos);var l=this.pos-s;l>=128&&Tp(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),wp(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),wp(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var s=a.length;this.writeVarint(s),this.realloc(s);for(var l=0;l<s;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,s){this.pos++;var l=this.pos;a(s,this);var v=this.pos-l;v>=128&&Tp(l,v,this),this.pos=l-1,this.writeVarint(v),this.pos+=v},writeMessage:function(a,s,l){this.writeTag(a,Za.Bytes),this.writeRawMessage(s,l)},writePackedVarint:function(a,s){s.length&&this.writeMessage(a,Rv,s)},writePackedSVarint:function(a,s){s.length&&this.writeMessage(a,Z,s)},writePackedBoolean:function(a,s){s.length&&this.writeMessage(a,Kt,s)},writePackedFloat:function(a,s){s.length&&this.writeMessage(a,we,s)},writePackedDouble:function(a,s){s.length&&this.writeMessage(a,Xe,s)},writePackedFixed32:function(a,s){s.length&&this.writeMessage(a,br,s)},writePackedSFixed32:function(a,s){s.length&&this.writeMessage(a,$t,s)},writePackedFixed64:function(a,s){s.length&&this.writeMessage(a,mr,s)},writePackedSFixed64:function(a,s){s.length&&this.writeMessage(a,Ar,s)},writeBytesField:function(a,s){this.writeTag(a,Za.Bytes),this.writeBytes(s)},writeFixed32Field:function(a,s){this.writeTag(a,Za.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(a,s){this.writeTag(a,Za.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(a,s){this.writeTag(a,Za.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(a,s){this.writeTag(a,Za.Fixed64),this.writeSFixed64(s)},writeVarintField:function(a,s){this.writeTag(a,Za.Varint),this.writeVarint(s)},writeSVarintField:function(a,s){this.writeTag(a,Za.Varint),this.writeSVarint(s)},writeStringField:function(a,s){this.writeTag(a,Za.Bytes),this.writeString(s)},writeFloatField:function(a,s){this.writeTag(a,Za.Fixed32),this.writeFloat(s)},writeDoubleField:function(a,s){this.writeTag(a,Za.Fixed64),this.writeDouble(s)},writeBooleanField:function(a,s){this.writeVarintField(a,Boolean(s))}};var Ct=function(a,s){var l=s.pixelRatio,v=s.version,_=s.stretchX,E=s.stretchY,w=s.content;this.paddedRect=a,this.pixelRatio=l,this.stretchX=_,this.stretchY=E,this.content=w,this.version=v},rr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};rr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},rr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},rr.tlbr.get=function(){return this.tl.concat(this.br)},rr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Ct.prototype,rr);var zr=function(a,s){var l={},v={};this.haveRenderCallbacks=[];var _=[];this.addImages(a,l,_),this.addImages(s,v,_);var E=Vr(_),w=new Lo({width:E.w||1,height:E.h||1});for(var L in a){var B=a[L],V=l[L].paddedRect;Lo.copy(B.data,w,{x:0,y:0},{x:V.x+1,y:V.y+1},B.data)}for(var W in s){var $=s[W],le=v[W].paddedRect,ve=le.x+1,Ue=le.y+1,Ve=$.data.width,st=$.data.height;Lo.copy($.data,w,{x:0,y:0},{x:ve,y:Ue},$.data),Lo.copy($.data,w,{x:0,y:st-1},{x:ve,y:Ue-1},{width:Ve,height:1}),Lo.copy($.data,w,{x:0,y:0},{x:ve,y:Ue+st},{width:Ve,height:1}),Lo.copy($.data,w,{x:Ve-1,y:0},{x:ve-1,y:Ue},{width:1,height:st}),Lo.copy($.data,w,{x:0,y:0},{x:ve+Ve,y:Ue},{width:1,height:st})}this.image=w,this.iconPositions=l,this.patternPositions=v};zr.prototype.addImages=function(a,s,l){for(var v in a){var _=a[v],E={x:0,y:0,w:_.data.width+2,h:_.data.height+2};l.push(E),s[v]=new Ct(E,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(v)}},zr.prototype.patchUpdatedImages=function(a,s){for(var l in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[l],a.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],a.getImage(l),s)},zr.prototype.patchUpdatedImage=function(a,s,l){if(a&&s&&a.version!==s.version){a.version=s.version;var v=a.tl;l.update(s.data,void 0,{x:v[0],y:v[1]})}},Rn("ImagePosition",Ct),Rn("ImageAtlas",zr);var rn={horizontal:1,vertical:2,horizontalOnly:3},Cr=function(){this.scale=1,this.fontStack="",this.imageName=null};Cr.forText=function(a,s){var l=new Cr;return l.scale=a||1,l.fontStack=s,l},Cr.forImage=function(a){var s=new Cr;return s.imageName=a,s};var Hr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function vn(a,s,l,v,_,E,w,L,B,V,W,$,le,ve,Ue,Ve){var st,Qe=Hr.fromFeature(a,_);$===rn.vertical&&Qe.verticalizePunctuation();var St=eu.processBidirectionalText,Vt=eu.processStyledBidirectionalText;if(St&&Qe.sections.length===1){st=[];for(var ir=0,sr=St(Qe.toString(),cn(Qe,V,E,s,v,ve,Ue));ir<sr.length;ir+=1){var Sr=sr[ir],Xr=new Hr;Xr.text=Sr,Xr.sections=Qe.sections;for(var hn=0;hn<Sr.length;hn++)Xr.sectionIndex.push(0);st.push(Xr)}}else if(Vt){st=[];for(var Kn=0,Mn=Vt(Qe.text,Qe.sectionIndex,cn(Qe,V,E,s,v,ve,Ue));Kn<Mn.length;Kn+=1){var ni=Mn[Kn],Pn=new Hr;Pn.text=ni[0],Pn.sectionIndex=ni[1],Pn.sections=Qe.sections,st.push(Pn)}}else st=function(Wn,Wi){for(var Li=[],ca=Wn.text,ii=0,ga=0,fo=Wi;ga<fo.length;ga+=1){var Co=fo[ga];Li.push(Wn.substring(ii,Co)),ii=Co}return ii<ca.length&&Li.push(Wn.substring(ii,ca.length)),Li}(Qe,cn(Qe,V,E,s,v,ve,Ue));var Bi=[],yi={positionedLines:Bi,text:Qe.toString(),top:W[1],bottom:W[1],left:W[0],right:W[0],writingMode:$,iconsInText:!1,verticalizable:!1};return function(Wn,Wi,Li,ca,ii,ga,fo,Co,wo,io,xo,vs){for(var ms=0,Ws=-17,Is=0,Xs=0,jo=Co==="right"?1:Co==="left"?0:.5,No=0,ea=0,Ga=ii;ea<Ga.length;ea+=1){var Fa=Ga[ea];Fa.trim();var da=Fa.getMaxScale(),su=24*(da-1),zs={positionedGlyphs:[],lineOffset:0};Wn.positionedLines[No]=zs;var ao=zs.positionedGlyphs,es=0;if(Fa.length()){for(var us=0;us<Fa.length();us++){var Ca=Fa.getSection(us),Jr=Fa.getSectionIndex(us),qu=Fa.getCharCode(us),Ft=0,Go=null,Tc=null,pl=null,Nh=24,Df=!(wo===rn.horizontal||!xo&&!vc(qu)||xo&&(qn[qu]||(of=qu,dn.Arabic(of)||dn["Arabic Supplement"](of)||dn["Arabic Extended-A"](of)||dn["Arabic Presentation Forms-A"](of)||dn["Arabic Presentation Forms-B"](of))));if(Ca.imageName){var Mc=ca[Ca.imageName];if(!Mc)continue;pl=Ca.imageName,Wn.iconsInText=Wn.iconsInText||!0,Tc=Mc.paddedRect;var af=Mc.displaySize;Ca.scale=24*Ca.scale/vs,Ft=su+(24-af[1]*Ca.scale),Nh=(Go={width:af[0],height:af[1],left:1,top:-3,advance:Df?af[1]:af[0]}).advance;var zh=Df?af[0]*Ca.scale-24*da:af[1]*Ca.scale-24*da;zh>0&&zh>es&&(es=zh)}else{var Mp=Li[Ca.fontStack],fh=Mp&&Mp[qu];if(fh&&fh.rect)Tc=fh.rect,Go=fh.metrics;else{var Uh=Wi[Ca.fontStack],Ip=Uh&&Uh[qu];if(!Ip)continue;Go=Ip.metrics}Ft=24*(da-Ca.scale)}Df?(Wn.verticalizable=!0,ao.push({glyph:qu,imageName:pl,x:ms,y:Ws+Ft,vertical:Df,scale:Ca.scale,fontStack:Ca.fontStack,sectionIndex:Jr,metrics:Go,rect:Tc}),ms+=Nh*Ca.scale+io):(ao.push({glyph:qu,imageName:pl,x:ms,y:Ws+Ft,vertical:Df,scale:Ca.scale,fontStack:Ca.fontStack,sectionIndex:Jr,metrics:Go,rect:Tc}),ms+=Go.advance*Ca.scale+io)}ao.length!==0&&(Is=Math.max(ms-io,Is),Ai(ao,0,ao.length-1,jo,es)),ms=0;var kp=ga*da+es;zs.lineOffset=Math.max(es,su),Ws+=kp,Xs=Math.max(kp,Xs),++No}else Ws+=ga,++No}var of,Zh=Ws- -17,Vh=mn(fo),Ff=Vh.horizontalAlign,jh=Vh.verticalAlign;(function(gd,yd,Pp,Lp,_d,Rp,Gh,Op,Dp){var Hh,Jd=(yd-Pp)*_d;Hh=Rp!==Gh?-Op*Lp- -17:(-Lp*Dp+.5)*Gh;for(var Wh=0,Xh=gd;Wh<Xh.length;Wh+=1)for(var Bf=0,Fp=Xh[Wh].positionedGlyphs;Bf<Fp.length;Bf+=1){var hh=Fp[Bf];hh.x+=Jd,hh.y+=Hh}})(Wn.positionedLines,jo,Ff,jh,Is,Xs,ga,Zh,ii.length),Wn.top+=-jh*Zh,Wn.bottom=Wn.top+Zh,Wn.left+=-Ff*Is,Wn.right=Wn.left+Is}(yi,s,l,v,st,w,L,B,$,V,le,Ve),!function(Wn){for(var Wi=0,Li=Wn;Wi<Li.length;Wi+=1)if(Li[Wi].positionedGlyphs.length!==0)return!1;return!0}(Bi)&&yi}Hr.fromFeature=function(a,s){for(var l=new Hr,v=0;v<a.sections.length;v++){var _=a.sections[v];_.image?l.addImageSection(_):l.addTextSection(_,s)}return l},Hr.prototype.length=function(){return this.text.length},Hr.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},Hr.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},Hr.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},Hr.prototype.verticalizePunctuation=function(){this.text=function(a){for(var s="",l=0;l<a.length;l++){var v=a.charCodeAt(l+1)||null,_=a.charCodeAt(l-1)||null;s+=v&&Cl(v)&&!wc[a[l+1]]||_&&Cl(_)&&!wc[a[l-1]]||!wc[a[l]]?a[l]:wc[a[l]]}return s}(this.text)},Hr.prototype.trim=function(){for(var a=0,s=0;s<this.text.length&&qn[this.text.charCodeAt(s)];s++)a++;for(var l=this.text.length,v=this.text.length-1;v>=0&&v>=a&&qn[this.text.charCodeAt(v)];v--)l--;this.text=this.text.substring(a,l),this.sectionIndex=this.sectionIndex.slice(a,l)},Hr.prototype.substring=function(a,s){var l=new Hr;return l.text=this.text.substring(a,s),l.sectionIndex=this.sectionIndex.slice(a,s),l.sections=this.sections,l},Hr.prototype.toString=function(){return this.text},Hr.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(s,l){return Math.max(s,a.sections[l].scale)},0)},Hr.prototype.addTextSection=function(a,s){this.text+=a.text,this.sections.push(Cr.forText(a.scale,a.fontStack||s));for(var l=this.sections.length-1,v=0;v<a.text.length;++v)this.sectionIndex.push(l)},Hr.prototype.addImageSection=function(a){var s=a.image?a.image.name:"";if(s.length!==0){var l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Cr.forImage(s)),this.sectionIndex.push(this.sections.length-1)):pt("Reached maximum number of images 6401")}else pt("Can't add FormattedSection with an empty image.")},Hr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var qn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},vr={};function xr(a,s,l,v,_,E){if(s.imageName){var w=v[s.imageName];return w?w.displaySize[0]*s.scale*24/E+_:0}var L=l[s.fontStack],B=L&&L[a];return B?B.metrics.advance*s.scale+_:0}function On(a,s,l,v){var _=Math.pow(a-s,2);return v?a<s?_/2:2*_:_+Math.abs(l)*l}function Kr(a,s,l){var v=0;return a===10&&(v-=1e4),l&&(v+=150),a!==40&&a!==65288||(v+=50),s!==41&&s!==65289||(v+=50),v}function Ur(a,s,l,v,_,E){for(var w=null,L=On(s,l,_,E),B=0,V=v;B<V.length;B+=1){var W=V[B],$=On(s-W.x,l,_,E)+W.badness;$<=L&&(w=W,L=$)}return{index:a,x:s,priorBreak:w,badness:L}}function cn(a,s,l,v,_,E,w){if(E!=="point")return[];if(!a)return[];for(var L,B=[],V=function(st,Qe,St,Vt,ir,sr){for(var Sr=0,Xr=0;Xr<st.length();Xr++){var hn=st.getSection(Xr);Sr+=xr(st.getCharCode(Xr),hn,Vt,ir,Qe,sr)}return Sr/Math.max(1,Math.ceil(Sr/St))}(a,s,l,v,_,w),W=a.text.indexOf("\u200B")>=0,$=0,le=0;le<a.length();le++){var ve=a.getSection(le),Ue=a.getCharCode(le);if(qn[Ue]||($+=xr(Ue,ve,v,_,s,w)),le<a.length()-1){var Ve=!((L=Ue)<11904||!(dn["Bopomofo Extended"](L)||dn.Bopomofo(L)||dn["CJK Compatibility Forms"](L)||dn["CJK Compatibility Ideographs"](L)||dn["CJK Compatibility"](L)||dn["CJK Radicals Supplement"](L)||dn["CJK Strokes"](L)||dn["CJK Symbols and Punctuation"](L)||dn["CJK Unified Ideographs Extension A"](L)||dn["CJK Unified Ideographs"](L)||dn["Enclosed CJK Letters and Months"](L)||dn["Halfwidth and Fullwidth Forms"](L)||dn.Hiragana(L)||dn["Ideographic Description Characters"](L)||dn["Kangxi Radicals"](L)||dn["Katakana Phonetic Extensions"](L)||dn.Katakana(L)||dn["Vertical Forms"](L)||dn["Yi Radicals"](L)||dn["Yi Syllables"](L)));(vr[Ue]||Ve||ve.imageName)&&B.push(Ur(le+1,$,V,B,Kr(Ue,a.getCharCode(le+1),Ve&&W),!1))}}return function st(Qe){return Qe?st(Qe.priorBreak).concat(Qe.index):[]}(Ur(a.length(),$,V,B,0,!0))}function mn(a){var s=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:s,verticalAlign:l}}function Ai(a,s,l,v,_){if(v||_)for(var E=a[l],w=(a[l].x+E.metrics.advance*E.scale)*v,L=s;L<=l;L++)a[L].x-=w,a[L].y+=_}function gi(a,s,l,v,_,E){var w,L=a.image;if(L.content){var B=L.content,V=L.pixelRatio||1;w=[B[0]/V,B[1]/V,L.displaySize[0]-B[2]/V,L.displaySize[1]-B[3]/V]}var W,$,le,ve,Ue=s.left*E,Ve=s.right*E;l==="width"||l==="both"?(ve=_[0]+Ue-v[3],$=_[0]+Ve+v[1]):$=(ve=_[0]+(Ue+Ve-L.displaySize[0])/2)+L.displaySize[0];var st=s.top*E,Qe=s.bottom*E;return l==="height"||l==="both"?(W=_[1]+st-v[0],le=_[1]+Qe+v[2]):le=(W=_[1]+(st+Qe-L.displaySize[1])/2)+L.displaySize[1],{image:L,top:W,right:$,bottom:le,left:ve,collisionPadding:w}}vr[10]=!0,vr[32]=!0,vr[38]=!0,vr[40]=!0,vr[41]=!0,vr[43]=!0,vr[45]=!0,vr[47]=!0,vr[173]=!0,vr[183]=!0,vr[8203]=!0,vr[8208]=!0,vr[8211]=!0,vr[8231]=!0;var fn=function(a){function s(l,v,_,E){a.call(this,l,v),this.angle=_,E!==void 0&&(this.segment=E)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.clone=function(){return new s(this.x,this.y,this.angle,this.segment)},s}(pe);function En(a,s){var l=s.expression;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Di(a+1))};if(l.kind==="source")return{kind:"source"};for(var v=l.zoomStops,_=l.interpolationType,E=0;E<v.length&&v[E]<=a;)E++;for(var w=E=Math.max(0,E-1);w<v.length&&v[w]<a+1;)w++;w=Math.min(v.length-1,w);var L=v[E],B=v[w];return l.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:B,interpolationType:_}:{kind:"camera",minZoom:L,maxZoom:B,minSize:l.evaluate(new Di(L)),maxSize:l.evaluate(new Di(B)),interpolationType:_}}function di(a,s,l){var v=s.uSize,_=l.lowerSize;return a.kind==="source"?_/128:a.kind==="composite"?zi(_/128,l.upperSize/128,s.uSizeT):v}function wi(a,s){var l=0,v=0;if(a.kind==="constant")v=a.layoutSize;else if(a.kind!=="source"){var _=a.interpolationType,E=_?kt(ke.interpolationFactor(_,s,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?v=zi(a.minSize,a.maxSize,E):l=E}return{uSizeT:l,uSize:v}}Rn("Anchor",fn);var Ui=Object.freeze({__proto__:null,getSizeData:En,evaluateSizeForFeature:di,evaluateSizeForZoom:wi,SIZE_PACK_FACTOR:128});function no(a,s,l,v,_){if(s.segment===void 0)return!0;for(var E=s,w=s.segment+1,L=0;L>-l/2;){if(--w<0)return!1;L-=a[w].dist(E),E=a[w]}L+=a[w].dist(a[w+1]),w++;for(var B=[],V=0;L<l/2;){var W=a[w],$=a[w+1];if(!$)return!1;var le=a[w-1].angleTo(W)-W.angleTo($);for(le=Math.abs((le+3*Math.PI)%(2*Math.PI)-Math.PI),B.push({distance:L,angleDelta:le}),V+=le;L-B[0].distance>v;)V-=B.shift().angleDelta;if(V>_)return!1;w++,L+=W.dist($)}return!0}function co(a){for(var s=0,l=0;l<a.length-1;l++)s+=a[l].dist(a[l+1]);return s}function ji(a,s,l){return a?.6*s*l:0}function hs(a,s){return Math.max(a?a.right-a.left:0,s?s.right-s.left:0)}function Va(a,s,l,v,_,E){for(var w=ji(l,_,E),L=hs(l,v)*E,B=0,V=co(a)/2,W=0;W<a.length-1;W++){var $=a[W],le=a[W+1],ve=$.dist(le);if(B+ve>V){var Ue=(V-B)/ve,Ve=zi($.x,le.x,Ue),st=zi($.y,le.y,Ue),Qe=new fn(Ve,st,le.angleTo($),W);return Qe._round(),!w||no(a,Qe,L,w,s)?Qe:void 0}B+=ve}}function ss(a,s,l,v,_,E,w,L,B){var V=ji(v,E,w),W=hs(v,_),$=W*w,le=a[0].x===0||a[0].x===B||a[0].y===0||a[0].y===B;return s-$<s/4&&(s=$+s/4),function ve(Ue,Ve,st,Qe,St,Vt,ir,sr,Sr){for(var Xr=Vt/2,hn=co(Ue),Kn=0,Mn=Ve-st,ni=[],Pn=0;Pn<Ue.length-1;Pn++){for(var Bi=Ue[Pn],yi=Ue[Pn+1],Wn=Bi.dist(yi),Wi=yi.angleTo(Bi);Mn+st<Kn+Wn;){var Li=((Mn+=st)-Kn)/Wn,ca=zi(Bi.x,yi.x,Li),ii=zi(Bi.y,yi.y,Li);if(ca>=0&&ca<Sr&&ii>=0&&ii<Sr&&Mn-Xr>=0&&Mn+Xr<=hn){var ga=new fn(ca,ii,Wi,Pn);ga._round(),Qe&&!no(Ue,ga,Vt,Qe,St)||ni.push(ga)}}Kn+=Wn}return sr||ni.length||ir||(ni=ve(Ue,Kn/2,st,Qe,St,Vt,ir,!0,Sr)),ni}(a,le?s/2*L%s:(W/2+2*E)*w*L%s,s,V,l,$,le,!1,B)}function Oo(a,s,l,v,_){for(var E=[],w=0;w<a.length;w++)for(var L=a[w],B=void 0,V=0;V<L.length-1;V++){var W=L[V],$=L[V+1];W.x<s&&$.x<s||(W.x<s?W=new pe(s,W.y+(s-W.x)/($.x-W.x)*($.y-W.y))._round():$.x<s&&($=new pe(s,W.y+(s-W.x)/($.x-W.x)*($.y-W.y))._round()),W.y<l&&$.y<l||(W.y<l?W=new pe(W.x+(l-W.y)/($.y-W.y)*($.x-W.x),l)._round():$.y<l&&($=new pe(W.x+(l-W.y)/($.y-W.y)*($.x-W.x),l)._round()),W.x>=v&&$.x>=v||(W.x>=v?W=new pe(v,W.y+(v-W.x)/($.x-W.x)*($.y-W.y))._round():$.x>=v&&($=new pe(v,W.y+(v-W.x)/($.x-W.x)*($.y-W.y))._round()),W.y>=_&&$.y>=_||(W.y>=_?W=new pe(W.x+(_-W.y)/($.y-W.y)*($.x-W.x),_)._round():$.y>=_&&($=new pe(W.x+(_-W.y)/($.y-W.y)*($.x-W.x),_)._round()),B&&W.equals(B[B.length-1])||E.push(B=[W]),B.push($)))))}return E}function Do(a,s,l,v){var _=[],E=a.image,w=E.pixelRatio,L=E.paddedRect.w-2,B=E.paddedRect.h-2,V=a.right-a.left,W=a.bottom-a.top,$=E.stretchX||[[0,L]],le=E.stretchY||[[0,B]],ve=function(ca,ii){return ca+ii[1]-ii[0]},Ue=$.reduce(ve,0),Ve=le.reduce(ve,0),st=L-Ue,Qe=B-Ve,St=0,Vt=Ue,ir=0,sr=Ve,Sr=0,Xr=st,hn=0,Kn=Qe;if(E.content&&v){var Mn=E.content;St=Fo($,0,Mn[0]),ir=Fo(le,0,Mn[1]),Vt=Fo($,Mn[0],Mn[2]),sr=Fo(le,Mn[1],Mn[3]),Sr=Mn[0]-St,hn=Mn[1]-ir,Xr=Mn[2]-Mn[0]-Vt,Kn=Mn[3]-Mn[1]-sr}var ni=function(ca,ii,ga,fo){var Co=_o(ca.stretch-St,Vt,V,a.left),wo=Mi(ca.fixed-Sr,Xr,ca.stretch,Ue),io=_o(ii.stretch-ir,sr,W,a.top),xo=Mi(ii.fixed-hn,Kn,ii.stretch,Ve),vs=_o(ga.stretch-St,Vt,V,a.left),ms=Mi(ga.fixed-Sr,Xr,ga.stretch,Ue),Ws=_o(fo.stretch-ir,sr,W,a.top),Is=Mi(fo.fixed-hn,Kn,fo.stretch,Ve),Xs=new pe(Co,io),jo=new pe(vs,io),No=new pe(vs,Ws),ea=new pe(Co,Ws),Ga=new pe(wo/w,xo/w),Fa=new pe(ms/w,Is/w),da=s*Math.PI/180;if(da){var su=Math.sin(da),zs=Math.cos(da),ao=[zs,-su,su,zs];Xs._matMult(ao),jo._matMult(ao),ea._matMult(ao),No._matMult(ao)}var es=ca.stretch+ca.fixed,us=ii.stretch+ii.fixed;return{tl:Xs,tr:jo,bl:ea,br:No,tex:{x:E.paddedRect.x+1+es,y:E.paddedRect.y+1+us,w:ga.stretch+ga.fixed-es,h:fo.stretch+fo.fixed-us},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ga,pixelOffsetBR:Fa,minFontScaleX:Xr/w/V,minFontScaleY:Kn/w/W,isSDF:l}};if(v&&(E.stretchX||E.stretchY))for(var Pn=As($,st,Ue),Bi=As(le,Qe,Ve),yi=0;yi<Pn.length-1;yi++)for(var Wn=Pn[yi],Wi=Pn[yi+1],Li=0;Li<Bi.length-1;Li++)_.push(ni(Wn,Bi[Li],Wi,Bi[Li+1]));else _.push(ni({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:B+1}));return _}function Fo(a,s,l){for(var v=0,_=0,E=a;_<E.length;_+=1){var w=E[_];v+=Math.max(s,Math.min(l,w[1]))-Math.max(s,Math.min(l,w[0]))}return v}function As(a,s,l){for(var v=[{fixed:-1,stretch:0}],_=0,E=a;_<E.length;_+=1){var w=E[_],L=w[0],B=w[1],V=v[v.length-1];v.push({fixed:L-V.stretch,stretch:V.stretch}),v.push({fixed:L-V.stretch,stretch:V.stretch+(B-L)})}return v.push({fixed:s+1,stretch:l}),v}function _o(a,s,l,v){return a/s*l+v}function Mi(a,s,l,v){return a-s*l/v}var Jo=function(a,s,l,v,_,E,w,L,B,V){if(this.boxStartIndex=a.length,B){var W=E.top,$=E.bottom,le=E.collisionPadding;le&&(W-=le[1],$+=le[3]);var ve=$-W;ve>0&&(ve=Math.max(10,ve),this.circleDiameter=ve)}else{var Ue=E.top*w-L,Ve=E.bottom*w+L,st=E.left*w-L,Qe=E.right*w+L,St=E.collisionPadding;if(St&&(st-=St[0]*w,Ue-=St[1]*w,Qe+=St[2]*w,Ve+=St[3]*w),V){var Vt=new pe(st,Ue),ir=new pe(Qe,Ue),sr=new pe(st,Ve),Sr=new pe(Qe,Ve),Xr=V*Math.PI/180;Vt._rotate(Xr),ir._rotate(Xr),sr._rotate(Xr),Sr._rotate(Xr),st=Math.min(Vt.x,ir.x,sr.x,Sr.x),Qe=Math.max(Vt.x,ir.x,sr.x,Sr.x),Ue=Math.min(Vt.y,ir.y,sr.y,Sr.y),Ve=Math.max(Vt.y,ir.y,sr.y,Sr.y)}a.emplaceBack(s.x,s.y,st,Ue,Qe,Ve,l,v,_)}this.boxEndIndex=a.length},la=function(a,s){if(a===void 0&&(a=[]),s===void 0&&(s=ps),this.data=a,this.length=this.data.length,this.compare=s,this.length>0)for(var l=(this.length>>1)-1;l>=0;l--)this._down(l)};function ps(a,s){return a<s?-1:a>s?1:0}function _i(a,s,l){s===void 0&&(s=1),l===void 0&&(l=!1);for(var v=1/0,_=1/0,E=-1/0,w=-1/0,L=a[0],B=0;B<L.length;B++){var V=L[B];(!B||V.x<v)&&(v=V.x),(!B||V.y<_)&&(_=V.y),(!B||V.x>E)&&(E=V.x),(!B||V.y>w)&&(w=V.y)}var W=Math.min(E-v,w-_),$=W/2,le=new la([],Gi);if(W===0)return new pe(v,_);for(var ve=v;ve<E;ve+=W)for(var Ue=_;Ue<w;Ue+=W)le.push(new ma(ve+$,Ue+$,$,a));for(var Ve=function(St){for(var Vt=0,ir=0,sr=0,Sr=St[0],Xr=0,hn=Sr.length,Kn=hn-1;Xr<hn;Kn=Xr++){var Mn=Sr[Xr],ni=Sr[Kn],Pn=Mn.x*ni.y-ni.x*Mn.y;ir+=(Mn.x+ni.x)*Pn,sr+=(Mn.y+ni.y)*Pn,Vt+=3*Pn}return new ma(ir/Vt,sr/Vt,0,St)}(a),st=le.length;le.length;){var Qe=le.pop();(Qe.d>Ve.d||!Ve.d)&&(Ve=Qe,l&&console.log("found best %d after %d probes",Math.round(1e4*Qe.d)/1e4,st)),Qe.max-Ve.d<=s||(le.push(new ma(Qe.p.x-($=Qe.h/2),Qe.p.y-$,$,a)),le.push(new ma(Qe.p.x+$,Qe.p.y-$,$,a)),le.push(new ma(Qe.p.x-$,Qe.p.y+$,$,a)),le.push(new ma(Qe.p.x+$,Qe.p.y+$,$,a)),st+=4)}return l&&(console.log("num probes: "+st),console.log("best distance: "+Ve.d)),Ve.p}function Gi(a,s){return s.max-a.max}function ma(a,s,l,v){this.p=new pe(a,s),this.h=l,this.d=function(_,E){for(var w=!1,L=1/0,B=0;B<E.length;B++)for(var V=E[B],W=0,$=V.length,le=$-1;W<$;le=W++){var ve=V[W],Ue=V[le];ve.y>_.y!=Ue.y>_.y&&_.x<(Ue.x-ve.x)*(_.y-ve.y)/(Ue.y-ve.y)+ve.x&&(w=!w),L=Math.min(L,mc(_,ve,Ue))}return(w?1:-1)*Math.sqrt(L)}(this.p,v),this.max=this.d+this.h*Math.SQRT2}la.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},la.prototype.pop=function(){if(this.length!==0){var a=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),a}},la.prototype.peek=function(){return this.data[0]},la.prototype._up=function(a){for(var s=this.data,l=this.compare,v=s[a];a>0;){var _=a-1>>1,E=s[_];if(l(v,E)>=0)break;s[a]=E,a=_}s[a]=v},la.prototype._down=function(a){for(var s=this.data,l=this.compare,v=this.length>>1,_=s[a];a<v;){var E=1+(a<<1),w=s[E],L=E+1;if(L<this.length&&l(s[L],w)<0&&(E=L,w=s[L]),l(w,_)>=0)break;s[a]=w,a=E}s[a]=_};var Bo=Number.POSITIVE_INFINITY;function Iu(a,s){return s[1]!==Bo?function(l,v,_){var E=0,w=0;switch(v=Math.abs(v),_=Math.abs(_),l){case"top-right":case"top-left":case"top":w=_-7;break;case"bottom-right":case"bottom-left":case"bottom":w=7-_}switch(l){case"top-right":case"bottom-right":case"right":E=-v;break;case"top-left":case"bottom-left":case"left":E=v}return[E,w]}(a,s[0],s[1]):function(l,v){var _=0,E=0;v<0&&(v=0);var w=v/Math.sqrt(2);switch(l){case"top-right":case"top-left":E=w-7;break;case"bottom-right":case"bottom-left":E=7-w;break;case"bottom":E=7-v;break;case"top":E=v-7}switch(l){case"top-right":case"bottom-right":_=-w;break;case"top-left":case"bottom-left":_=w;break;case"left":_=v;break;case"right":_=-v}return[_,E]}(a,s[0])}function Ne(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tr(a,s,l,v,_,E,w,L,B,V,W,$,le,ve,Ue){var Ve=function(ir,sr,Sr,Xr,hn,Kn,Mn,ni){for(var Pn=Xr.layout.get("text-rotate").evaluate(Kn,{})*Math.PI/180,Bi=[],yi=0,Wn=sr.positionedLines;yi<Wn.length;yi+=1)for(var Wi=Wn[yi],Li=0,ca=Wi.positionedGlyphs;Li<ca.length;Li+=1){var ii=ca[Li];if(ii.rect){var ga=ii.rect||{},fo=4,Co=!0,wo=1,io=0,xo=(hn||ni)&&ii.vertical,vs=ii.metrics.advance*ii.scale/2;if(ni&&sr.verticalizable&&(io=Wi.lineOffset/2-(ii.imageName?-(24-ii.metrics.width*ii.scale)/2:24*(ii.scale-1))),ii.imageName){var ms=Mn[ii.imageName];Co=ms.sdf,fo=1/(wo=ms.pixelRatio)}var Ws=hn?[ii.x+vs,ii.y]:[0,0],Is=hn?[0,0]:[ii.x+vs+Sr[0],ii.y+Sr[1]-io],Xs=[0,0];xo&&(Xs=Is,Is=[0,0]);var jo=(ii.metrics.left-fo)*ii.scale-vs+Is[0],No=(-ii.metrics.top-fo)*ii.scale+Is[1],ea=jo+ga.w*ii.scale/wo,Ga=No+ga.h*ii.scale/wo,Fa=new pe(jo,No),da=new pe(ea,No),su=new pe(jo,Ga),zs=new pe(ea,Ga);if(xo){var ao=new pe(-vs,vs- -17),es=-Math.PI/2,us=12-vs,Ca=new pe(22-us,-(ii.imageName?us:0)),Jr=new(Function.prototype.bind.apply(pe,[null].concat(Xs)));Fa._rotateAround(es,ao)._add(Ca)._add(Jr),da._rotateAround(es,ao)._add(Ca)._add(Jr),su._rotateAround(es,ao)._add(Ca)._add(Jr),zs._rotateAround(es,ao)._add(Ca)._add(Jr)}if(Pn){var qu=Math.sin(Pn),Ft=Math.cos(Pn),Go=[Ft,-qu,qu,Ft];Fa._matMult(Go),da._matMult(Go),su._matMult(Go),zs._matMult(Go)}var Tc=new pe(0,0),pl=new pe(0,0);Bi.push({tl:Fa,tr:da,bl:su,br:zs,tex:ga,writingMode:sr.writingMode,glyphOffset:Ws,sectionIndex:ii.sectionIndex,isSDF:Co,pixelOffsetTL:Tc,pixelOffsetBR:pl,minFontScaleX:0,minFontScaleY:0})}}return Bi}(0,l,L,_,E,w,v,a.allowVerticalPlacement),st=a.textSizeData,Qe=null;st.kind==="source"?(Qe=[128*_.layout.get("text-size").evaluate(w,{})])[0]>32640&&pt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):st.kind==="composite"&&((Qe=[128*ve.compositeTextSizes[0].evaluate(w,{},Ue),128*ve.compositeTextSizes[1].evaluate(w,{},Ue)])[0]>32640||Qe[1]>32640)&&pt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,Ve,Qe,L,E,w,V,s,B.lineStartIndex,B.lineLength,le,Ue);for(var St=0,Vt=W;St<Vt.length;St+=1)$[Vt[St]]=a.text.placedSymbolArray.length-1;return 4*Ve.length}function zt(a){for(var s in a)return a[s];return null}function Tn(a,s,l,v){var _=a.compareText;if(s in _){for(var E=_[s],w=E.length-1;w>=0;w--)if(v.dist(E[w])<l)return!0}else _[s]=[];return _[s].push(v),!1}var Zi=Yu.VectorTileFeature.types,De=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function xe(a,s,l,v,_,E,w,L,B,V,W,$,le){var ve=L?Math.min(32640,Math.round(L[0])):0,Ue=L?Math.min(32640,Math.round(L[1])):0;a.emplaceBack(s,l,Math.round(32*v),Math.round(32*_),E,w,(ve<<1)+(B?1:0),Ue,16*V,16*W,256*$,256*le)}function tt(a,s,l){a.emplaceBack(s.x,s.y,l),a.emplaceBack(s.x,s.y,l),a.emplaceBack(s.x,s.y,l),a.emplaceBack(s.x,s.y,l)}function At(a){for(var s=0,l=a.sections;s<l.length;s+=1)if(Xc(l[s].text))return!0;return!1}var Wt=function(a){this.layoutVertexArray=new bf,this.indexArray=new nl,this.programConfigurations=a,this.segments=new Ee,this.dynamicLayoutVertexArray=new pu,this.opacityVertexArray=new Al,this.placedSymbolArray=new g};Wt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Wt.prototype.upload=function(a,s,l,v){this.isEmpty()||(l&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,hd.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,qd.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,De,!0),this.opacityVertexBuffer.itemSize=1),(l||v)&&this.programConfigurations.upload(a))},Wt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Rn("SymbolBuffers",Wt);var ut=function(a,s,l){this.layoutVertexArray=new a,this.layoutAttributes=s,this.indexArray=new l,this.segments=new Ee,this.collisionVertexArray=new Kf};ut.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,Kd.members,!0)},ut.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Rn("CollisionBuffers",ut);var We=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(E){return E.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Gs([]),this.placementViewportMatrix=Gs([]);var s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=En(this.zoom,s["text-size"]),this.iconSizeData=En(this.zoom,s["icon-size"]);var l=this.layers[0].layout,v=l.get("symbol-sort-key"),_=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&v.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(function(E){return rn[E]})),this.stateDependentLayerIds=this.layers.filter(function(E){return E.isStateDependent()}).map(function(E){return E.id}),this.sourceID=a.sourceID};We.prototype.createArrays=function(){this.text=new Wt(new ti(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new Wt(new ti(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new k,this.lineVertexArray=new F,this.symbolInstances=new M},We.prototype.calculateGlyphDependencies=function(a,s,l,v,_){for(var E=0;E<a.length;E++)if(s[a.charCodeAt(E)]=!0,(l||v)&&_){var w=wc[a.charAt(E)];w&&(s[w.charCodeAt(0)]=!0)}},We.prototype.populate=function(a,s,l){var v=this.layers[0],_=v.layout,E=_.get("text-font"),w=_.get("text-field"),L=_.get("icon-image"),B=(w.value.kind!=="constant"||w.value.value instanceof Ta&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),V=L.value.kind!=="constant"||!!L.value.value||Object.keys(L.parameters).length>0,W=_.get("symbol-sort-key");if(this.features=[],B||V){for(var $=s.iconDependencies,le=s.glyphDependencies,ve=s.availableImages,Ue=new Di(this.zoom),Ve=0,st=a;Ve<st.length;Ve+=1){var Qe=st[Ve],St=Qe.feature,Vt=Qe.id,ir=Qe.index,sr=Qe.sourceLayerIndex,Sr=v._featureFilter.needGeometry,Xr=yo(St,Sr);if(v._featureFilter.filter(Ue,Xr,l)){Sr||(Xr.geometry=Ya(St));var hn=void 0;if(B){var Kn=v.getValueAndResolveTokens("text-field",Xr,l,ve),Mn=Ta.factory(Kn);At(Mn)&&(this.hasRTLText=!0),(!this.hasRTLText||$f()==="unavailable"||this.hasRTLText&&eu.isParsed())&&(hn=Lv(Mn,v,Xr))}var ni=void 0;if(V){var Pn=v.getValueAndResolveTokens("icon-image",Xr,l,ve);ni=Pn instanceof $e?Pn:$e.fromString(Pn)}if(hn||ni){var Bi=this.sortFeaturesByKey?W.evaluate(Xr,{},l):void 0;if(this.features.push({id:Vt,text:hn,icon:ni,index:ir,sourceLayerIndex:sr,geometry:Xr.geometry,properties:St.properties,type:Zi[St.type],sortKey:Bi}),ni&&($[ni.name]=!0),hn){var yi=E.evaluate(Xr,{},l).join(","),Wn=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(rn.vertical)>=0;for(var Wi=0,Li=hn.sections;Wi<Li.length;Wi+=1){var ca=Li[Wi];if(ca.image)$[ca.image.name]=!0;else{var ii=dc(hn.toString()),ga=ca.fontStack||yi,fo=le[ga]=le[ga]||{};this.calculateGlyphDependencies(ca.text,fo,Wn,this.allowVerticalPlacement,ii)}}}}}}_.get("symbol-placement")==="line"&&(this.features=function(Co){var wo={},io={},xo=[],vs=0;function ms(ao){xo.push(Co[ao]),vs++}function Ws(ao,es,us){var Ca=io[ao];return delete io[ao],io[es]=Ca,xo[Ca].geometry[0].pop(),xo[Ca].geometry[0]=xo[Ca].geometry[0].concat(us[0]),Ca}function Is(ao,es,us){var Ca=wo[es];return delete wo[es],wo[ao]=Ca,xo[Ca].geometry[0].shift(),xo[Ca].geometry[0]=us[0].concat(xo[Ca].geometry[0]),Ca}function Xs(ao,es,us){var Ca=us?es[0][es[0].length-1]:es[0][0];return ao+":"+Ca.x+":"+Ca.y}for(var jo=0;jo<Co.length;jo++){var No=Co[jo],ea=No.geometry,Ga=No.text?No.text.toString():null;if(Ga){var Fa=Xs(Ga,ea),da=Xs(Ga,ea,!0);if(Fa in io&&da in wo&&io[Fa]!==wo[da]){var su=Is(Fa,da,ea),zs=Ws(Fa,da,xo[su].geometry);delete wo[Fa],delete io[da],io[Xs(Ga,xo[zs].geometry,!0)]=zs,xo[su].geometry=null}else Fa in io?Ws(Fa,da,ea):da in wo?Is(Fa,da,ea):(ms(jo),wo[Fa]=vs-1,io[da]=vs-1)}else ms(jo)}return xo.filter(function(ao){return ao.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Co,wo){return Co.sortKey-wo.sortKey})}},We.prototype.update=function(a,s,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,s,this.layers,l),this.icon.programConfigurations.updatePaintArrays(a,s,this.layers,l))},We.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},We.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},We.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},We.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},We.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},We.prototype.addToLineVertexArray=function(a,s){var l=this.lineVertexArray.length;if(a.segment!==void 0){for(var v=a.dist(s[a.segment+1]),_=a.dist(s[a.segment]),E={},w=a.segment+1;w<s.length;w++)E[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:v},w<s.length-1&&(v+=s[w+1].dist(s[w]));for(var L=a.segment||0;L>=0;L--)E[L]={x:s[L].x,y:s[L].y,tileUnitDistanceFromAnchor:_},L>0&&(_+=s[L-1].dist(s[L]));for(var B=0;B<s.length;B++){var V=E[B];this.lineVertexArray.emplaceBack(V.x,V.y,V.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}},We.prototype.addSymbols=function(a,s,l,v,_,E,w,L,B,V,W,$){for(var le=a.indexArray,ve=a.layoutVertexArray,Ue=a.segments.prepareSegment(4*s.length,ve,le,this.canOverlap?E.sortKey:void 0),Ve=this.glyphOffsetArray.length,st=Ue.vertexLength,Qe=this.allowVerticalPlacement&&w===rn.vertical?Math.PI/2:0,St=E.text&&E.text.sections,Vt=0;Vt<s.length;Vt++){var ir=s[Vt],sr=ir.tl,Sr=ir.tr,Xr=ir.bl,hn=ir.br,Kn=ir.tex,Mn=ir.pixelOffsetTL,ni=ir.pixelOffsetBR,Pn=ir.minFontScaleX,Bi=ir.minFontScaleY,yi=ir.glyphOffset,Wn=ir.isSDF,Wi=ir.sectionIndex,Li=Ue.vertexLength,ca=yi[1];xe(ve,L.x,L.y,sr.x,ca+sr.y,Kn.x,Kn.y,l,Wn,Mn.x,Mn.y,Pn,Bi),xe(ve,L.x,L.y,Sr.x,ca+Sr.y,Kn.x+Kn.w,Kn.y,l,Wn,ni.x,Mn.y,Pn,Bi),xe(ve,L.x,L.y,Xr.x,ca+Xr.y,Kn.x,Kn.y+Kn.h,l,Wn,Mn.x,ni.y,Pn,Bi),xe(ve,L.x,L.y,hn.x,ca+hn.y,Kn.x+Kn.w,Kn.y+Kn.h,l,Wn,ni.x,ni.y,Pn,Bi),tt(a.dynamicLayoutVertexArray,L,Qe),le.emplaceBack(Li,Li+1,Li+2),le.emplaceBack(Li+1,Li+2,Li+3),Ue.vertexLength+=4,Ue.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(yi[0]),Vt!==s.length-1&&Wi===s[Vt+1].sectionIndex||a.programConfigurations.populatePaintArrays(ve.length,E,E.index,{},$,St&&St[Wi])}a.placedSymbolArray.emplaceBack(L.x,L.y,Ve,this.glyphOffsetArray.length-Ve,st,B,V,L.segment,l?l[0]:0,l?l[1]:0,v[0],v[1],w,0,!1,0,W)},We.prototype._addCollisionDebugVertex=function(a,s,l,v,_,E){return s.emplaceBack(0,0),a.emplaceBack(l.x,l.y,v,_,Math.round(E.x),Math.round(E.y))},We.prototype.addCollisionDebugVertices=function(a,s,l,v,_,E,w){var L=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),B=L.vertexLength,V=_.layoutVertexArray,W=_.collisionVertexArray,$=w.anchorX,le=w.anchorY;this._addCollisionDebugVertex(V,W,E,$,le,new pe(a,s)),this._addCollisionDebugVertex(V,W,E,$,le,new pe(l,s)),this._addCollisionDebugVertex(V,W,E,$,le,new pe(l,v)),this._addCollisionDebugVertex(V,W,E,$,le,new pe(a,v)),L.vertexLength+=4;var ve=_.indexArray;ve.emplaceBack(B,B+1),ve.emplaceBack(B+1,B+2),ve.emplaceBack(B+2,B+3),ve.emplaceBack(B+3,B),L.primitiveLength+=4},We.prototype.addDebugCollisionBoxes=function(a,s,l,v){for(var _=a;_<s;_++){var E=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,v?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,l)}},We.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ut(Yl,Cp.members,$c),this.iconCollisionBox=new ut(Yl,Cp.members,$c);for(var a=0;a<this.symbolInstances.length;a++){var s=this.symbolInstances.get(a);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}},We.prototype._deserializeCollisionBoxesForSymbol=function(a,s,l,v,_,E,w,L,B){for(var V={},W=s;W<l;W++){var $=a.get(W);V.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},V.textFeatureIndex=$.featureIndex;break}for(var le=v;le<_;le++){var ve=a.get(le);V.verticalTextBox={x1:ve.x1,y1:ve.y1,x2:ve.x2,y2:ve.y2,anchorPointX:ve.anchorPointX,anchorPointY:ve.anchorPointY},V.verticalTextFeatureIndex=ve.featureIndex;break}for(var Ue=E;Ue<w;Ue++){var Ve=a.get(Ue);V.iconBox={x1:Ve.x1,y1:Ve.y1,x2:Ve.x2,y2:Ve.y2,anchorPointX:Ve.anchorPointX,anchorPointY:Ve.anchorPointY},V.iconFeatureIndex=Ve.featureIndex;break}for(var st=L;st<B;st++){var Qe=a.get(st);V.verticalIconBox={x1:Qe.x1,y1:Qe.y1,x2:Qe.x2,y2:Qe.y2,anchorPointX:Qe.anchorPointX,anchorPointY:Qe.anchorPointY},V.verticalIconFeatureIndex=Qe.featureIndex;break}return V},We.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var s=0;s<this.symbolInstances.length;s++){var l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}},We.prototype.hasTextData=function(){return this.text.segments.get().length>0},We.prototype.hasIconData=function(){return this.icon.segments.get().length>0},We.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},We.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},We.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},We.prototype.addIndicesForPlacedSymbol=function(a,s){for(var l=a.placedSymbolArray.get(s),v=l.vertexStartIndex+4*l.numGlyphs,_=l.vertexStartIndex;_<v;_+=4)a.indexArray.emplaceBack(_,_+1,_+2),a.indexArray.emplaceBack(_+1,_+2,_+3)},We.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var s=Math.sin(a),l=Math.cos(a),v=[],_=[],E=[],w=0;w<this.symbolInstances.length;++w){E.push(w);var L=this.symbolInstances.get(w);v.push(0|Math.round(s*L.anchorX+l*L.anchorY)),_.push(L.featureIndex)}return E.sort(function(B,V){return v[B]-v[V]||_[V]-_[B]}),E},We.prototype.addToSortKeyRanges=function(a,s){var l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:a,symbolInstanceEnd:a+1})},We.prototype.sortFeatures=function(a){var s=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var l=0,v=this.symbolInstanceIndexes;l<v.length;l+=1){var _=this.symbolInstances.get(v[l]);this.featureSortOrder.push(_.featureIndex),[_.rightJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.leftJustifiedTextSymbolIndex].forEach(function(E,w,L){E>=0&&L.indexOf(E)===w&&s.addIndicesForPlacedSymbol(s.text,E)}),_.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,_.verticalPlacedTextSymbolIndex),_.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.placedIconSymbolIndex),_.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Rn("SymbolBucket",We,{omit:["layers","collisionBoxArray","features","compareText"]}),We.MAX_GLYPHS=65535,We.addDynamicAttributes=tt;var _t=new qo({"symbol-placement":new Yn(be.layout_symbol["symbol-placement"]),"symbol-spacing":new Yn(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Yn(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zn(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Yn(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Yn(be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Yn(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new Yn(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Yn(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new zn(be.layout_symbol["icon-size"]),"icon-text-fit":new Yn(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Yn(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new zn(be.layout_symbol["icon-image"]),"icon-rotate":new zn(be.layout_symbol["icon-rotate"]),"icon-padding":new Yn(be.layout_symbol["icon-padding"]),"icon-keep-upright":new Yn(be.layout_symbol["icon-keep-upright"]),"icon-offset":new zn(be.layout_symbol["icon-offset"]),"icon-anchor":new zn(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Yn(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Yn(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Yn(be.layout_symbol["text-rotation-alignment"]),"text-field":new zn(be.layout_symbol["text-field"]),"text-font":new zn(be.layout_symbol["text-font"]),"text-size":new zn(be.layout_symbol["text-size"]),"text-max-width":new zn(be.layout_symbol["text-max-width"]),"text-line-height":new Yn(be.layout_symbol["text-line-height"]),"text-letter-spacing":new zn(be.layout_symbol["text-letter-spacing"]),"text-justify":new zn(be.layout_symbol["text-justify"]),"text-radial-offset":new zn(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Yn(be.layout_symbol["text-variable-anchor"]),"text-anchor":new zn(be.layout_symbol["text-anchor"]),"text-max-angle":new Yn(be.layout_symbol["text-max-angle"]),"text-writing-mode":new Yn(be.layout_symbol["text-writing-mode"]),"text-rotate":new zn(be.layout_symbol["text-rotate"]),"text-padding":new Yn(be.layout_symbol["text-padding"]),"text-keep-upright":new Yn(be.layout_symbol["text-keep-upright"]),"text-transform":new zn(be.layout_symbol["text-transform"]),"text-offset":new zn(be.layout_symbol["text-offset"]),"text-allow-overlap":new Yn(be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Yn(be.layout_symbol["text-ignore-placement"]),"text-optional":new Yn(be.layout_symbol["text-optional"])}),Ie={paint:new qo({"icon-opacity":new zn(be.paint_symbol["icon-opacity"]),"icon-color":new zn(be.paint_symbol["icon-color"]),"icon-halo-color":new zn(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new zn(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zn(be.paint_symbol["icon-halo-blur"]),"icon-translate":new Yn(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new Yn(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new zn(be.paint_symbol["text-opacity"]),"text-color":new zn(be.paint_symbol["text-color"],{runtimeType:pn,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new zn(be.paint_symbol["text-halo-color"]),"text-halo-width":new zn(be.paint_symbol["text-halo-width"]),"text-halo-blur":new zn(be.paint_symbol["text-halo-blur"]),"text-translate":new Yn(be.paint_symbol["text-translate"]),"text-translate-anchor":new Yn(be.paint_symbol["text-translate-anchor"])}),layout:_t},Je=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:An,this.defaultValue=a};Je.prototype.evaluate=function(a){if(a.formattedSection){var s=this.defaultValue.property.overrides;if(s&&s.hasOverride(a.formattedSection))return s.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},Je.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},Je.prototype.outputDefined=function(){return!1},Je.prototype.serialize=function(){return null},Rn("FormatSectionOverride",Je,{omit:["defaultValue"]});var Oe=function(a){function s(l){a.call(this,l,Ie)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(l,v){if(a.prototype.recalculate.call(this,l,v),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var _=this.layout.get("text-writing-mode");if(_){for(var E=[],w=0,L=_;w<L.length;w+=1){var B=L[w];E.indexOf(B)<0&&E.push(B)}this.layout._values["text-writing-mode"]=E}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},s.prototype.getValueAndResolveTokens=function(l,v,_,E){var w=this.layout.get(l).evaluate(v,{},_,E),L=this._unevaluatedLayout._values[l];return L.isDataDriven()||lc(L.value)||!w?w:function(B,V){return V.replace(/{([^{}]+)}/g,function(W,$){return $ in B?String(B[$]):""})}(v.properties,w)},s.prototype.createBucket=function(l){return new We(l)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype._setPaintOverrides=function(){for(var l=0,v=Ie.paint.overridableProperties;l<v.length;l+=1){var _=v[l];if(s.hasPaintOverride(this.layout,_)){var E,w=this.paint.get(_),L=new Je(w),B=new Vc(L,w.property.specification);E=w.value.kind==="constant"||w.value.kind==="source"?new Fl("source",B):new _l("composite",B,w.value.zoomStops,w.value._interpolationType),this.paint._values[_]=new Es(w.property,E,w.parameters)}}},s.prototype._handleOverridablePaintPropertyUpdate=function(l,v,_){return!(!this.layout||v.isDataDriven()||_.isDataDriven())&&s.hasPaintOverride(this.layout,l)},s.hasPaintOverride=function(l,v){var _=l.get("text-field"),E=Ie.paint.properties[v],w=!1,L=function(W){for(var $=0,le=W;$<le.length;$+=1)if(E.overrides&&E.overrides.hasOverride(le[$]))return void(w=!0)};if(_.value.kind==="constant"&&_.value.value instanceof Ta)L(_.value.value.sections);else if(_.value.kind==="source"){var B=function(W){w||(W instanceof Ja&&ia(W.value)===aa?L(W.value.sections):W instanceof Xo?L(W.sections):W.eachChild(B))},V=_.value;V._styleExpression&&B(V._styleExpression.expression)}return w},s}(Gu),It={paint:new qo({"background-color":new Yn(be.paint_background["background-color"]),"background-pattern":new $o(be.paint_background["background-pattern"]),"background-opacity":new Yn(be.paint_background["background-opacity"])})},Zt=function(a){function s(l){a.call(this,l,It)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Gu),wr={paint:new qo({"raster-opacity":new Yn(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new Yn(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Yn(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Yn(be.paint_raster["raster-brightness-max"]),"raster-saturation":new Yn(be.paint_raster["raster-saturation"]),"raster-contrast":new Yn(be.paint_raster["raster-contrast"]),"raster-resampling":new Yn(be.paint_raster["raster-resampling"]),"raster-fade-duration":new Yn(be.paint_raster["raster-fade-duration"])})},an=function(a){function s(l){a.call(this,l,wr)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Gu),on=function(a){function s(l){a.call(this,l,{}),this.implementation=l}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},s.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},s.prototype.recalculate=function(){},s.prototype.updateTransitions=function(){},s.prototype.hasTransition=function(){},s.prototype.serialize=function(){},s.prototype.onAdd=function(l){this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},s.prototype.onRemove=function(l){this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},s}(Gu),_n={circle:Qf,heatmap:Th,hillshade:jr,fill:ih,"fill-extrusion":fl,line:nc,symbol:Oe,background:Zt,raster:an},Qr=_e.HTMLImageElement,Bn=_e.HTMLCanvasElement,wn=_e.HTMLVideoElement,Fn=_e.ImageData,Dn=_e.ImageBitmap,kn=function(a,s,l,v){this.context=a,this.format=l,this.texture=a.gl.createTexture(),this.update(s,v)};kn.prototype.update=function(a,s,l){var v=a.width,_=a.height,E=!(this.size&&this.size[0]===v&&this.size[1]===_||l),w=this.context,L=w.gl;if(this.useMipmap=Boolean(s&&s.useMipmap),L.bindTexture(L.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===L.RGBA&&(!s||s.premultiply!==!1)),E)this.size=[v,_],a instanceof Qr||a instanceof Bn||a instanceof wn||a instanceof Fn||Dn&&a instanceof Dn?L.texImage2D(L.TEXTURE_2D,0,this.format,this.format,L.UNSIGNED_BYTE,a):L.texImage2D(L.TEXTURE_2D,0,this.format,v,_,0,this.format,L.UNSIGNED_BYTE,a.data);else{var B=l||{x:0,y:0},V=B.x,W=B.y;a instanceof Qr||a instanceof Bn||a instanceof wn||a instanceof Fn||Dn&&a instanceof Dn?L.texSubImage2D(L.TEXTURE_2D,0,V,W,L.RGBA,L.UNSIGNED_BYTE,a):L.texSubImage2D(L.TEXTURE_2D,0,V,W,v,_,L.RGBA,L.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&L.generateMipmap(L.TEXTURE_2D)},kn.prototype.bind=function(a,s,l){var v=this.context.gl;v.bindTexture(v.TEXTURE_2D,this.texture),l!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=v.LINEAR),a!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,a),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,l||a),this.filter=a),s!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,s),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,s),this.wrap=s)},kn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},kn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var ci=function(a){var s=this;this._callback=a,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){s._triggered=!1,s._callback()})};ci.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},ci.prototype.remove=function(){delete this._channel,this._callback=function(){}};var ka=function(a,s,l){this.target=a,this.parent=s,this.mapId=l,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},gr(["receive","process"],this),this.invoker=new ci(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=q()?a:_e};function ds(a,s,l){var v=2*Math.PI*6378137/256/Math.pow(2,l);return[a*v-2*Math.PI*6378137/2,s*v-2*Math.PI*6378137/2]}ka.prototype.send=function(a,s,l,v,_){var E=this;_===void 0&&(_=!1);var w=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(this.callbacks[w]=l);var L=Me(this.globalScope)?void 0:[];return this.target.postMessage({id:w,type:a,hasCallback:!!l,targetMapId:v,mustQueue:_,sourceMapId:this.mapId,data:cu(s,L)},L),{cancel:function(){l&&delete E.callbacks[w],E.target.postMessage({id:w,type:"<cancel>",targetMapId:v,sourceMapId:E.mapId})}}},ka.prototype.receive=function(a){var s=a.data,l=s.id;if(l&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[l];var v=this.cancelCallbacks[l];delete this.cancelCallbacks[l],v&&v()}else q()||s.mustQueue?(this.tasks[l]=s,this.taskQueue.push(l),this.invoker.trigger()):this.processTask(l,s)},ka.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),s=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(a,s)}},ka.prototype.processTask=function(a,s){var l=this;if(s.type==="<response>"){var v=this.callbacks[a];delete this.callbacks[a],v&&(s.error?v(Ds(s.error)):v(null,Ds(s.data)))}else{var _=!1,E=Me(this.globalScope)?void 0:[],w=s.hasCallback?function(W,$){_=!0,delete l.cancelCallbacks[a],l.target.postMessage({id:a,type:"<response>",sourceMapId:l.mapId,error:W?cu(W):null,data:cu($,E)},E)}:function(W){_=!0},L=null,B=Ds(s.data);if(this.parent[s.type])L=this.parent[s.type](s.sourceMapId,B,w);else if(this.parent.getWorkerSource){var V=s.type.split(".");L=this.parent.getWorkerSource(s.sourceMapId,V[0],B.source)[V[1]](B,w)}else w(new Error("Could not find function "+s.type));!_&&L&&L.cancel&&(this.cancelCallbacks[a]=L.cancel)}},ka.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var ja=function(a,s){a&&(s?this.setSouthWest(a).setNorthEast(s):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};ja.prototype.setNorthEast=function(a){return this._ne=a instanceof pa?new pa(a.lng,a.lat):pa.convert(a),this},ja.prototype.setSouthWest=function(a){return this._sw=a instanceof pa?new pa(a.lng,a.lat):pa.convert(a),this},ja.prototype.extend=function(a){var s,l,v=this._sw,_=this._ne;if(a instanceof pa)s=a,l=a;else{if(!(a instanceof ja))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(ja.convert(a)):this.extend(pa.convert(a)):this;if(l=a._ne,!(s=a._sw)||!l)return this}return v||_?(v.lng=Math.min(s.lng,v.lng),v.lat=Math.min(s.lat,v.lat),_.lng=Math.max(l.lng,_.lng),_.lat=Math.max(l.lat,_.lat)):(this._sw=new pa(s.lng,s.lat),this._ne=new pa(l.lng,l.lat)),this},ja.prototype.getCenter=function(){return new pa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},ja.prototype.getSouthWest=function(){return this._sw},ja.prototype.getNorthEast=function(){return this._ne},ja.prototype.getNorthWest=function(){return new pa(this.getWest(),this.getNorth())},ja.prototype.getSouthEast=function(){return new pa(this.getEast(),this.getSouth())},ja.prototype.getWest=function(){return this._sw.lng},ja.prototype.getSouth=function(){return this._sw.lat},ja.prototype.getEast=function(){return this._ne.lng},ja.prototype.getNorth=function(){return this._ne.lat},ja.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},ja.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},ja.prototype.isEmpty=function(){return!(this._sw&&this._ne)},ja.prototype.contains=function(a){var s=pa.convert(a),l=s.lng,v=s.lat,_=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=v&&v<=this._ne.lat&&_},ja.convert=function(a){return!a||a instanceof ja?a:new ja(a)};var pa=function(a,s){if(isNaN(a)||isNaN(s))throw new Error("Invalid LngLat object: ("+a+", "+s+")");if(this.lng=+a,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};pa.prototype.wrap=function(){return new pa(ar(this.lng,-180,180),this.lat)},pa.prototype.toArray=function(){return[this.lng,this.lat]},pa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},pa.prototype.distanceTo=function(a){var s=Math.PI/180,l=this.lat*s,v=a.lat*s,_=Math.sin(l)*Math.sin(v)+Math.cos(l)*Math.cos(v)*Math.cos((a.lng-this.lng)*s);return 63710088e-1*Math.acos(Math.min(_,1))},pa.prototype.toBounds=function(a){a===void 0&&(a=0);var s=360*a/40075017,l=s/Math.cos(Math.PI/180*this.lat);return new ja(new pa(this.lng-l,this.lat-s),new pa(this.lng+l,this.lat+s))},pa.convert=function(a){if(a instanceof pa)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new pa(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new pa(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var $u=2*Math.PI*63710088e-1;function Ts(a){return $u*Math.cos(a*Math.PI/180)}function ku(a){return(180+a)/360}function au(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function uh(a,s){return a/Ts(s)}function ou(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var hl=function(a,s,l){l===void 0&&(l=0),this.x=+a,this.y=+s,this.z=+l};hl.fromLngLat=function(a,s){s===void 0&&(s=0);var l=pa.convert(a);return new hl(ku(l.lng),au(l.lat),uh(s,l.lat))},hl.prototype.toLngLat=function(){return new pa(360*this.x-180,ou(this.y))},hl.prototype.toAltitude=function(){return this.z*Ts(ou(this.y))},hl.prototype.meterInMercatorCoordinateUnits=function(){return 1/$u*(a=ou(this.y),1/Math.cos(a*Math.PI/180));var a};var ic=function(a,s,l){this.z=a,this.x=s,this.y=l,this.key=lh(0,a,a,s,l)};ic.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},ic.prototype.url=function(a,s){var l,v,_,E,w,L=(v=this.y,_=this.z,E=ds(256*(l=this.x),256*(v=Math.pow(2,_)-v-1),_),w=ds(256*(l+1),256*(v+1),_),E[0]+","+E[1]+","+w[0]+","+w[1]),B=function(V,W,$){for(var le,ve="",Ue=V;Ue>0;Ue--)ve+=(W&(le=1<<Ue-1)?1:0)+($&le?2:0);return ve}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",B).replace("{bbox-epsg-3857}",L)},ic.prototype.getTilePoint=function(a){var s=Math.pow(2,this.z);return new pe(8192*(a.x*s-this.x),8192*(a.y*s-this.y))},ic.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Pu=function(a,s){this.wrap=a,this.canonical=s,this.key=lh(a,s.z,s.z,s.x,s.y)},Vo=function(a,s,l,v,_){this.overscaledZ=a,this.wrap=s,this.canonical=new ic(l,+v,+_),this.key=lh(s,a,l,v,_)};function lh(a,s,l,v,_){(a*=2)<0&&(a=-1*a-1);var E=1<<l;return(E*E*a+E*_+v).toString(36)+l.toString(36)+s.toString(36)}Vo.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},Vo.prototype.scaledTo=function(a){var s=this.canonical.z-a;return a>this.canonical.z?new Vo(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vo(a,this.wrap,a,this.canonical.x>>s,this.canonical.y>>s)},Vo.prototype.calculateScaledKey=function(a,s){var l=this.canonical.z-a;return a>this.canonical.z?lh(this.wrap*+s,a,this.canonical.z,this.canonical.x,this.canonical.y):lh(this.wrap*+s,a,a,this.canonical.x>>l,this.canonical.y>>l)},Vo.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var s=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>s&&a.canonical.y===this.canonical.y>>s},Vo.prototype.children=function(a){if(this.overscaledZ>=a)return[new Vo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var s=this.canonical.z+1,l=2*this.canonical.x,v=2*this.canonical.y;return[new Vo(s,this.wrap,s,l,v),new Vo(s,this.wrap,s,l+1,v),new Vo(s,this.wrap,s,l,v+1),new Vo(s,this.wrap,s,l+1,v+1)]},Vo.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},Vo.prototype.wrapped=function(){return new Vo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Vo.prototype.unwrapTo=function(a){return new Vo(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},Vo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Vo.prototype.toUnwrapped=function(){return new Pu(this.wrap,this.canonical)},Vo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Vo.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new hl(a.x-this.wrap,a.y))},Rn("CanonicalTileID",ic),Rn("OverscaledTileID",Vo,{omit:["posMatrix"]});var yu=function(a,s,l){if(this.uid=a,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return pt('"'+l+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=s.height;var v=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=l||"mapbox";for(var _=0;_<v;_++)this.data[this._idx(-1,_)]=this.data[this._idx(0,_)],this.data[this._idx(v,_)]=this.data[this._idx(v-1,_)],this.data[this._idx(_,-1)]=this.data[this._idx(_,0)],this.data[this._idx(_,v)]=this.data[this._idx(_,v-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(v,-1)]=this.data[this._idx(v-1,0)],this.data[this._idx(-1,v)]=this.data[this._idx(0,v-1)],this.data[this._idx(v,v)]=this.data[this._idx(v-1,v-1)]};yu.prototype.get=function(a,s){var l=new Uint8Array(this.data.buffer),v=4*this._idx(a,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(l[v],l[v+1],l[v+2])},yu.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},yu.prototype._idx=function(a,s){if(a<-1||a>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(a+1)},yu.prototype._unpackMapbox=function(a,s,l){return(256*a*256+256*s+l)/10-1e4},yu.prototype._unpackTerrarium=function(a,s,l){return 256*a+s+l/256-32768},yu.prototype.getPixels=function(){return new Lo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},yu.prototype.backfillBorder=function(a,s,l){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var v=s*this.dim,_=s*this.dim+this.dim,E=l*this.dim,w=l*this.dim+this.dim;switch(s){case-1:v=_-1;break;case 1:_=v+1}switch(l){case-1:E=w-1;break;case 1:w=E+1}for(var L=-s*this.dim,B=-l*this.dim,V=E;V<w;V++)for(var W=v;W<_;W++)this.data[this._idx(W,V)]=a.data[this._idx(W+L,V+B)]},Rn("DEMData",yu);var vd=function(a){this._stringToNumber={},this._numberToString=[];for(var s=0;s<a.length;s++){var l=a[s];this._stringToNumber[l]=s,this._numberToString[s]=l}};vd.prototype.encode=function(a){return this._stringToNumber[a]},vd.prototype.decode=function(a){return this._numberToString[a]};var md=function(a,s,l,v,_){this.type="Feature",this._vectorTileFeature=a,a._z=s,a._x=l,a._y=v,this.properties=a.properties,this.id=_},Qd={geometry:{configurable:!0}};Qd.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Qd.geometry.set=function(a){this._geometry=a},md.prototype.toJSON=function(){var a={geometry:this.geometry};for(var s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(a[s]=this[s]);return a},Object.defineProperties(md.prototype,Qd);var ch=function(){this.state={},this.stateChanges={},this.deletedStates={}};ch.prototype.updateState=function(a,s,l){var v=String(s);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][v]=this.stateChanges[a][v]||{},xt(this.stateChanges[a][v],l),this.deletedStates[a]===null)for(var _ in this.deletedStates[a]={},this.state[a])_!==v&&(this.deletedStates[a][_]=null);else if(this.deletedStates[a]&&this.deletedStates[a][v]===null)for(var E in this.deletedStates[a][v]={},this.state[a][v])l[E]||(this.deletedStates[a][v][E]=null);else for(var w in l)this.deletedStates[a]&&this.deletedStates[a][v]&&this.deletedStates[a][v][w]===null&&delete this.deletedStates[a][v][w]},ch.prototype.removeFeatureState=function(a,s,l){if(this.deletedStates[a]!==null){var v=String(s);if(this.deletedStates[a]=this.deletedStates[a]||{},l&&s!==void 0)this.deletedStates[a][v]!==null&&(this.deletedStates[a][v]=this.deletedStates[a][v]||{},this.deletedStates[a][v][l]=null);else if(s!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][v])for(l in this.deletedStates[a][v]={},this.stateChanges[a][v])this.deletedStates[a][v][l]=null;else this.deletedStates[a][v]=null;else this.deletedStates[a]=null}},ch.prototype.getState=function(a,s){var l=String(s),v=xt({},(this.state[a]||{})[l],(this.stateChanges[a]||{})[l]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var _=this.deletedStates[a][s];if(_===null)return{};for(var E in _)delete v[E]}return v},ch.prototype.initializeTileState=function(a,s){a.setFeatureState(this.state,s)},ch.prototype.coalesceChanges=function(a,s){var l={};for(var v in this.stateChanges){this.state[v]=this.state[v]||{};var _={};for(var E in this.stateChanges[v])this.state[v][E]||(this.state[v][E]={}),xt(this.state[v][E],this.stateChanges[v][E]),_[E]=this.state[v][E];l[v]=_}for(var w in this.deletedStates){this.state[w]=this.state[w]||{};var L={};if(this.deletedStates[w]===null)for(var B in this.state[w])L[B]={},this.state[w][B]={};else for(var V in this.deletedStates[w]){if(this.deletedStates[w][V]===null)this.state[w][V]={};else for(var W=0,$=Object.keys(this.deletedStates[w][V]);W<$.length;W+=1)delete this.state[w][V][$[W]];L[V]=this.state[w][V]}l[w]=l[w]||{},xt(l[w],L)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(var le in a)a[le].setFeatureState(l,s)};var Ac=function(a,s){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Eu(8192,16,0),this.grid3D=new Eu(8192,16,0),this.featureIndexArray=new X,this.promoteId=s};function Bh(a,s,l,v,_){return ur(a,function(E,w){var L=s instanceof fu?s.get(w):null;return L&&L.evaluate?L.evaluate(l,v,_):L})}function Ov(a){for(var s=1/0,l=1/0,v=-1/0,_=-1/0,E=0,w=a;E<w.length;E+=1){var L=w[E];s=Math.min(s,L.x),l=Math.min(l,L.y),v=Math.max(v,L.x),_=Math.max(_,L.y)}return{minX:s,minY:l,maxX:v,maxY:_}}function G0(a,s){return s-a}Ac.prototype.insert=function(a,s,l,v,_,E){var w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,v,_);for(var L=E?this.grid3D:this.grid,B=0;B<s.length;B++){for(var V=s[B],W=[1/0,1/0,-1/0,-1/0],$=0;$<V.length;$++){var le=V[$];W[0]=Math.min(W[0],le.x),W[1]=Math.min(W[1],le.y),W[2]=Math.max(W[2],le.x),W[3]=Math.max(W[3],le.y)}W[0]<8192&&W[1]<8192&&W[2]>=0&&W[3]>=0&&L.insert(w,W[0],W[1],W[2],W[3])}},Ac.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Yu.VectorTile(new Rf(this.rawTileData)).layers,this.sourceLayerCoder=new vd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Ac.prototype.query=function(a,s,l,v){var _=this;this.loadVTLayers();for(var E=a.params||{},w=8192/a.tileSize/a.scale,L=mf(E.filter),B=a.queryGeometry,V=a.queryPadding*w,W=Ov(B),$=this.grid.query(W.minX-V,W.minY-V,W.maxX+V,W.maxY+V),le=Ov(a.cameraQueryGeometry),ve=this.grid3D.query(le.minX-V,le.minY-V,le.maxX+V,le.maxY+V,function(ir,sr,Sr,Xr){return function(hn,Kn,Mn,ni,Pn){for(var Bi=0,yi=hn;Bi<yi.length;Bi+=1){var Wn=yi[Bi];if(Kn<=Wn.x&&Mn<=Wn.y&&ni>=Wn.x&&Pn>=Wn.y)return!0}var Wi=[new pe(Kn,Mn),new pe(Kn,Pn),new pe(ni,Pn),new pe(ni,Mn)];if(hn.length>2){for(var Li=0,ca=Wi;Li<ca.length;Li+=1)if(vu(hn,ca[Li]))return!0}for(var ii=0;ii<hn.length-1;ii++)if(Ql(hn[ii],hn[ii+1],Wi))return!0;return!1}(a.cameraQueryGeometry,ir-V,sr-V,Sr+V,Xr+V)}),Ue=0,Ve=ve;Ue<Ve.length;Ue+=1)$.push(Ve[Ue]);$.sort(G0);for(var st,Qe={},St=function(ir){var sr=$[ir];if(sr!==st){st=sr;var Sr=_.featureIndexArray.get(sr),Xr=null;_.loadMatchingFeature(Qe,Sr.bucketIndex,Sr.sourceLayerIndex,Sr.featureIndex,L,E.layers,E.availableImages,s,l,v,function(hn,Kn,Mn){return Xr||(Xr=Ya(hn)),Kn.queryIntersectsFeature(B,hn,Mn,Xr,_.z,a.transform,w,a.pixelPosMatrix)})}},Vt=0;Vt<$.length;Vt++)St(Vt);return Qe},Ac.prototype.loadMatchingFeature=function(a,s,l,v,_,E,w,L,B,V,W){var $=this.bucketLayerIDs[s];if(!E||function(hn,Kn){for(var Mn=0;Mn<hn.length;Mn++)if(Kn.indexOf(hn[Mn])>=0)return!0;return!1}(E,$)){var le=this.sourceLayerCoder.decode(l),ve=this.vtLayers[le].feature(v);if(_.needGeometry){var Ue=yo(ve,!0);if(!_.filter(new Di(this.tileID.overscaledZ),Ue,this.tileID.canonical))return}else if(!_.filter(new Di(this.tileID.overscaledZ),ve))return;for(var Ve=this.getId(ve,le),st=0;st<$.length;st++){var Qe=$[st];if(!(E&&E.indexOf(Qe)<0)){var St=L[Qe];if(St){var Vt={};Ve!==void 0&&V&&(Vt=V.getState(St.sourceLayer||"_geojsonTileLayer",Ve));var ir=xt({},B[Qe]);ir.paint=Bh(ir.paint,St.paint,ve,Vt,w),ir.layout=Bh(ir.layout,St.layout,ve,Vt,w);var sr=!W||W(ve,St,Vt);if(sr){var Sr=new md(ve,this.z,this.x,this.y,Ve);Sr.layer=ir;var Xr=a[Qe];Xr===void 0&&(Xr=a[Qe]=[]),Xr.push({featureIndex:v,feature:Sr,intersectionZ:sr})}}}}}},Ac.prototype.lookupSymbolFeatures=function(a,s,l,v,_,E,w,L){var B={};this.loadVTLayers();for(var V=mf(_),W=0,$=a;W<$.length;W+=1)this.loadMatchingFeature(B,l,v,$[W],V,E,w,L,s);return B},Ac.prototype.hasLayer=function(a){for(var s=0,l=this.bucketLayerIDs;s<l.length;s+=1)for(var v=0,_=l[s];v<_.length;v+=1)if(a===_[v])return!0;return!1},Ac.prototype.getId=function(a,s){var l=a.id;return this.promoteId&&typeof(l=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]])=="boolean"&&(l=Number(l)),l},Rn("FeatureIndex",Ac,{omit:["rawTileData","sourceLayerCoder"]});var Ms=function(a,s){this.tileID=a,this.uid=Gt(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Ms.prototype.registerFadeDuration=function(a){var s=a+this.timeAdded;s<oi.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)},Ms.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Ms.prototype.loadVectorData=function(a,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var v in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(V,W){var $={};if(!W)return $;for(var le=function(){var Ve=Ue[ve],st=Ve.layerIds.map(function(Vt){return W.getLayer(Vt)}).filter(Boolean);if(st.length!==0){Ve.layers=st,Ve.stateDependentLayerIds&&(Ve.stateDependentLayers=Ve.stateDependentLayerIds.map(function(Vt){return st.filter(function(ir){return ir.id===Vt})[0]}));for(var Qe=0,St=st;Qe<St.length;Qe+=1)$[St[Qe].id]=Ve}},ve=0,Ue=V;ve<Ue.length;ve+=1)le();return $}(a.buckets,s.style),this.hasSymbolBuckets=!1,this.buckets){var _=this.buckets[v];if(_ instanceof We){if(this.hasSymbolBuckets=!0,!l)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var E in this.buckets){var w=this.buckets[E];if(w instanceof We&&w.hasRTLText){this.hasRTLText=!0,eu.isLoading()||eu.isLoaded()||$f()!=="deferred"||Vs();break}}for(var L in this.queryPadding=0,this.buckets){var B=this.buckets[L];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(L).queryRadius(B))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new d},Ms.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Ms.prototype.getBucket=function(a){return this.buckets[a.id]},Ms.prototype.upload=function(a){for(var s in this.buckets){var l=this.buckets[s];l.uploadPending()&&l.upload(a)}var v=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new kn(a,this.imageAtlas.image,v.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new kn(a,this.glyphAtlasImage,v.ALPHA),this.glyphAtlasImage=null)},Ms.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},Ms.prototype.queryRenderedFeatures=function(a,s,l,v,_,E,w,L,B,V){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:_,scale:E,tileSize:this.tileSize,pixelPosMatrix:V,transform:L,params:w,queryPadding:this.queryPadding*B},a,s,l):{}},Ms.prototype.querySourceFeatures=function(a,s){var l=this.latestFeatureIndex;if(l&&l.rawTileData){var v=l.loadVTLayers(),_=s?s.sourceLayer:"",E=v._geojsonTileLayer||v[_];if(E)for(var w=mf(s&&s.filter),L=this.tileID.canonical,B=L.z,V=L.x,W=L.y,$={z:B,x:V,y:W},le=0;le<E.length;le++){var ve=E.feature(le);if(w.needGeometry){var Ue=yo(ve,!0);if(!w.filter(new Di(this.tileID.overscaledZ),Ue,this.tileID.canonical))continue}else if(!w.filter(new Di(this.tileID.overscaledZ),ve))continue;var Ve=l.getId(ve,_),st=new md(ve,B,V,W,Ve);st.tile=$,a.push(st)}}},Ms.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Ms.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Ms.prototype.setExpiryData=function(a){var s=this.expirationTime;if(a.cacheControl){var l=ge(a.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var v=Date.now(),_=!1;if(this.expirationTime>v)_=!1;else if(s)if(this.expirationTime<s)_=!0;else{var E=this.expirationTime-s;E?this.expirationTime=v+Math.max(E,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Ms.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Ms.prototype.setFeatureState=function(a,s){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var l=this.latestFeatureIndex.loadVTLayers();for(var v in this.buckets)if(s.style.hasLayer(v)){var _=this.buckets[v],E=_.layers[0].sourceLayer||"_geojsonTileLayer",w=l[E],L=a[E];if(w&&L&&Object.keys(L).length!==0){_.update(L,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});var B=s&&s.style&&s.style.getLayer(v);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(_)))}}}},Ms.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Ms.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<oi.now()},Ms.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Ms.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=oi.now()+a},Ms.prototype.setDependencies=function(a,s){for(var l={},v=0,_=s;v<_.length;v+=1)l[_[v]]=!0;this.dependencies[a]=l},Ms.prototype.hasDependency=function(a,s){for(var l=0,v=a;l<v.length;l+=1){var _=this.dependencies[v[l]];if(_){for(var E=0,w=s;E<w.length;E+=1)if(_[w[E]])return!0}}return!1};var nf=_e.performance,Dv=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},nf.mark(this._marks.start)};Dv.prototype.finish=function(){nf.mark(this._marks.end);var a=nf.getEntriesByName(this._marks.measure);return a.length===0&&(nf.measure(this._marks.measure,this._marks.start,this._marks.end),a=nf.getEntriesByName(this._marks.measure),nf.clearMarks(this._marks.start),nf.clearMarks(this._marks.end),nf.clearMeasures(this._marks.measure)),a},y.Actor=ka,y.AlphaImage=nu,y.CanonicalTileID=ic,y.CollisionBoxArray=d,y.Color=hr,y.DEMData=yu,y.DataConstantProperty=Yn,y.DictionaryCoder=vd,y.EXTENT=8192,y.ErrorEvent=et,y.EvaluationParameters=Di,y.Event=Ze,y.Evented=dt,y.FeatureIndex=Ac,y.FillBucket=ws,y.FillExtrusionBucket=cl,y.ImageAtlas=zr,y.ImagePosition=Ct,y.LineBucket=Sa,y.LngLat=pa,y.LngLatBounds=ja,y.MercatorCoordinate=hl,y.ONE_EM=24,y.OverscaledTileID=Vo,y.Point=pe,y.Point$1=pe,y.Properties=qo,y.Protobuf=Rf,y.RGBAImage=Lo,y.RequestManager=Ni,y.RequestPerformance=Dv,y.ResourceType=en,y.SegmentVector=Ee,y.SourceFeatureState=ch,y.StructArrayLayout1ui2=Ml,y.StructArrayLayout2f1f2i16=Tl,y.StructArrayLayout2i4=Wl,y.StructArrayLayout3ui6=nl,y.StructArrayLayout4i8=Xa,y.SymbolBucket=We,y.Texture=kn,y.Tile=Ms,y.Transitionable=cs,y.Uniform1f=tn,y.Uniform1i=Ir,y.Uniform2f=$r,y.Uniform3f=bn,y.Uniform4f=Qn,y.UniformColor=$n,y.UniformMatrix4f=Fi,y.UnwrappedTileID=Pu,y.ValidationError=He,y.WritingMode=rn,y.ZoomHistory=_f,y.add=function(a,s,l){return a[0]=s[0]+l[0],a[1]=s[1]+l[1],a[2]=s[2]+l[2],a},y.addDynamicAttributes=tt,y.asyncAll=function(a,s,l){if(!a.length)return l(null,[]);var v=a.length,_=new Array(a.length),E=null;a.forEach(function(w,L){s(w,function(B,V){B&&(E=B),_[L]=V,--v==0&&l(E,_)})})},y.bezier=ot,y.bindAll=gr,y.browser=oi,y.cacheEntryPossiblyAdded=function(a){++jn>pr&&(a.getActor().send("enforceCacheSizeLimit",Mt),jn=0)},y.clamp=kt,y.clearTileCache=function(a){var s=_e.caches.delete("mapbox-tiles");a&&s.catch(a).then(function(){return a()})},y.clipLine=Oo,y.clone=function(a){var s=new ua(16);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],s[4]=a[4],s[5]=a[5],s[6]=a[6],s[7]=a[7],s[8]=a[8],s[9]=a[9],s[10]=a[10],s[11]=a[11],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15],s},y.clone$1=ht,y.clone$2=function(a){var s=new ua(3);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s},y.collisionCircleLayout=pd,y.config=Zn,y.create=function(){var a=new ua(16);return ua!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},y.create$1=function(){var a=new ua(9);return ua!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},y.create$2=function(){var a=new ua(4);return ua!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},y.createCommonjsModule=Ae,y.createExpression=Dl,y.createLayout=Ua,y.createStyleLayer=function(a){return a.type==="custom"?new on(a):new _n[a.type](a)},y.cross=function(a,s,l){var v=s[0],_=s[1],E=s[2],w=l[0],L=l[1],B=l[2];return a[0]=_*B-E*L,a[1]=E*w-v*B,a[2]=v*L-_*w,a},y.deepEqual=function a(s,l){if(Array.isArray(s)){if(!Array.isArray(l)||s.length!==l.length)return!1;for(var v=0;v<s.length;v++)if(!a(s[v],l[v]))return!1;return!0}if(typeof s=="object"&&s!==null&&l!==null){if(typeof l!="object"||Object.keys(s).length!==Object.keys(l).length)return!1;for(var _ in s)if(!a(s[_],l[_]))return!1;return!0}return s===l},y.dot=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]},y.dot$1=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]+a[3]*s[3]},y.ease=ft,y.emitValidationErrors=hc,y.endsWith=K,y.enforceCacheSizeLimit=function(a){Mr(),se&&se.then(function(s){s.keys().then(function(l){for(var v=0;v<l.length-a;v++)s.delete(l[v])})})},y.evaluateSizeForFeature=di,y.evaluateSizeForZoom=wi,y.evaluateVariableOffset=Iu,y.evented=Yf,y.extend=xt,y.featureFilter=mf,y.filterObject=Tt,y.fromRotation=function(a,s){var l=Math.sin(s),v=Math.cos(s);return a[0]=v,a[1]=l,a[2]=0,a[3]=-l,a[4]=v,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},y.getAnchorAlignment=mn,y.getAnchorJustification=Ne,y.getArrayBuffer=xa,y.getImage=ie,y.getJSON=function(a,s){return va(xt(a,{type:"json"}),s)},y.getRTLTextPluginStatus=$f,y.getReferrer=si,y.getVideo=function(a,s){var l,v,_=_e.document.createElement("video");_.muted=!0,_.onloadstart=function(){s(null,_)};for(var E=0;E<a.length;E++){var w=_e.document.createElement("source");l=a[E],v=void 0,(v=_e.document.createElement("a")).href=l,(v.protocol!==_e.document.location.protocol||v.host!==_e.document.location.host)&&(_.crossOrigin="Anonymous"),w.src=a[E],_.appendChild(w)}return{cancel:function(){}}},y.identity=Gs,y.invert=function(a,s){var l=s[0],v=s[1],_=s[2],E=s[3],w=s[4],L=s[5],B=s[6],V=s[7],W=s[8],$=s[9],le=s[10],ve=s[11],Ue=s[12],Ve=s[13],st=s[14],Qe=s[15],St=l*L-v*w,Vt=l*B-_*w,ir=l*V-E*w,sr=v*B-_*L,Sr=v*V-E*L,Xr=_*V-E*B,hn=W*Ve-$*Ue,Kn=W*st-le*Ue,Mn=W*Qe-ve*Ue,ni=$*st-le*Ve,Pn=$*Qe-ve*Ve,Bi=le*Qe-ve*st,yi=St*Bi-Vt*Pn+ir*ni+sr*Mn-Sr*Kn+Xr*hn;return yi?(a[0]=(L*Bi-B*Pn+V*ni)*(yi=1/yi),a[1]=(_*Pn-v*Bi-E*ni)*yi,a[2]=(Ve*Xr-st*Sr+Qe*sr)*yi,a[3]=(le*Sr-$*Xr-ve*sr)*yi,a[4]=(B*Mn-w*Bi-V*Kn)*yi,a[5]=(l*Bi-_*Mn+E*Kn)*yi,a[6]=(st*ir-Ue*Xr-Qe*Vt)*yi,a[7]=(W*Xr-le*ir+ve*Vt)*yi,a[8]=(w*Pn-L*Mn+V*hn)*yi,a[9]=(v*Mn-l*Pn-E*hn)*yi,a[10]=(Ue*Sr-Ve*ir+Qe*St)*yi,a[11]=($*ir-W*Sr-ve*St)*yi,a[12]=(L*Kn-w*ni-B*hn)*yi,a[13]=(l*ni-v*Kn+_*hn)*yi,a[14]=(Ve*Vt-Ue*sr-st*St)*yi,a[15]=(W*sr-$*Vt+le*St)*yi,a):null},y.isChar=dn,y.isMapboxURL=hi,y.keysDifference=function(a,s){var l=[];for(var v in a)v in s||l.push(v);return l},y.makeRequest=va,y.mapObject=ur,y.mercatorXfromLng=ku,y.mercatorYfromLat=au,y.mercatorZfromAltitude=uh,y.mul=yc,y.multiply=Cs,y.mvt=Yu,y.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},y.normalize=function(a,s){var l=s[0],v=s[1],_=s[2],E=l*l+v*v+_*_;return E>0&&(E=1/Math.sqrt(E)),a[0]=s[0]*E,a[1]=s[1]*E,a[2]=s[2]*E,a},y.number=zi,y.offscreenCanvasSupported=Nn,y.ortho=function(a,s,l,v,_,E,w){var L=1/(s-l),B=1/(v-_),V=1/(E-w);return a[0]=-2*L,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*B,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*V,a[11]=0,a[12]=(s+l)*L,a[13]=(_+v)*B,a[14]=(w+E)*V,a[15]=1,a},y.parseGlyphPBF=function(a){return new Rf(a).readFields(Wr,[])},y.pbf=Rf,y.performSymbolLayout=function(a,s,l,v,_,E,w){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var L=a.layers[0].layout,B=a.layers[0]._unevaluatedLayout._values,V={};if(a.textSizeData.kind==="composite"){var W=a.textSizeData,$=W.maxZoom;V.compositeTextSizes=[B["text-size"].possiblyEvaluate(new Di(W.minZoom),w),B["text-size"].possiblyEvaluate(new Di($),w)]}if(a.iconSizeData.kind==="composite"){var le=a.iconSizeData,ve=le.maxZoom;V.compositeIconSizes=[B["icon-size"].possiblyEvaluate(new Di(le.minZoom),w),B["icon-size"].possiblyEvaluate(new Di(ve),w)]}V.layoutTextSize=B["text-size"].possiblyEvaluate(new Di(a.zoom+1),w),V.layoutIconSize=B["icon-size"].possiblyEvaluate(new Di(a.zoom+1),w),V.textMaxSize=B["text-size"].possiblyEvaluate(new Di(18));for(var Ue=24*L.get("text-line-height"),Ve=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",st=L.get("text-keep-upright"),Qe=L.get("text-size"),St=function(){var sr=ir[Vt],Sr=L.get("text-font").evaluate(sr,{},w).join(","),Xr=Qe.evaluate(sr,{},w),hn=V.layoutTextSize.evaluate(sr,{},w),Kn=V.layoutIconSize.evaluate(sr,{},w),Mn={horizontal:{},vertical:void 0},ni=sr.text,Pn=[0,0];if(ni){var Bi=ni.toString(),yi=24*L.get("text-letter-spacing").evaluate(sr,{},w),Wn=function(ea){for(var Ga=0,Fa=ea;Ga<Fa.length;Ga+=1)if(da=Fa[Ga].charCodeAt(0),dn.Arabic(da)||dn["Arabic Supplement"](da)||dn["Arabic Extended-A"](da)||dn["Arabic Presentation Forms-A"](da)||dn["Arabic Presentation Forms-B"](da))return!1;var da;return!0}(Bi)?yi:0,Wi=L.get("text-anchor").evaluate(sr,{},w),Li=L.get("text-variable-anchor");if(!Li){var ca=L.get("text-radial-offset").evaluate(sr,{},w);Pn=ca?Iu(Wi,[24*ca,Bo]):L.get("text-offset").evaluate(sr,{},w).map(function(ea){return 24*ea})}var ii=Ve?"center":L.get("text-justify").evaluate(sr,{},w),ga=L.get("symbol-placement"),fo=ga==="point"?24*L.get("text-max-width").evaluate(sr,{},w):0,Co=function(){a.allowVerticalPlacement&&dc(Bi)&&(Mn.vertical=vn(ni,s,l,_,Sr,fo,Ue,Wi,"left",Wn,Pn,rn.vertical,!0,ga,hn,Xr))};if(!Ve&&Li){for(var wo=ii==="auto"?Li.map(function(ea){return Ne(ea)}):[ii],io=!1,xo=0;xo<wo.length;xo++){var vs=wo[xo];if(!Mn.horizontal[vs])if(io)Mn.horizontal[vs]=Mn.horizontal[0];else{var ms=vn(ni,s,l,_,Sr,fo,Ue,"center",vs,Wn,Pn,rn.horizontal,!1,ga,hn,Xr);ms&&(Mn.horizontal[vs]=ms,io=ms.positionedLines.length===1)}}Co()}else{ii==="auto"&&(ii=Ne(Wi));var Ws=vn(ni,s,l,_,Sr,fo,Ue,Wi,ii,Wn,Pn,rn.horizontal,!1,ga,hn,Xr);Ws&&(Mn.horizontal[ii]=Ws),Co(),dc(Bi)&&Ve&&st&&(Mn.vertical=vn(ni,s,l,_,Sr,fo,Ue,Wi,ii,Wn,Pn,rn.vertical,!1,ga,hn,Xr))}}var Is=void 0,Xs=!1;if(sr.icon&&sr.icon.name){var jo=v[sr.icon.name];jo&&(Is=function(ea,Ga,Fa){var da=mn(Fa),su=Ga[0]-ea.displaySize[0]*da.horizontalAlign,zs=Ga[1]-ea.displaySize[1]*da.verticalAlign;return{image:ea,top:zs,bottom:zs+ea.displaySize[1],left:su,right:su+ea.displaySize[0]}}(_[sr.icon.name],L.get("icon-offset").evaluate(sr,{},w),L.get("icon-anchor").evaluate(sr,{},w)),Xs=jo.sdf,a.sdfIcons===void 0?a.sdfIcons=jo.sdf:a.sdfIcons!==jo.sdf&&pt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(jo.pixelRatio!==a.pixelRatio||L.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var No=zt(Mn.horizontal)||Mn.vertical;a.iconsInText=!!No&&No.iconsInText,(No||Is)&&function(ea,Ga,Fa,da,su,zs,ao,es,us,Ca,Jr){var qu=zs.textMaxSize.evaluate(Ga,{});qu===void 0&&(qu=ao);var Ft,Go=ea.layers[0].layout,Tc=Go.get("icon-offset").evaluate(Ga,{},Jr),pl=zt(Fa.horizontal),Nh=ao/24,Df=ea.tilePixelRatio*Nh,Mc=ea.tilePixelRatio*qu/24,af=ea.tilePixelRatio*es,zh=ea.tilePixelRatio*Go.get("symbol-spacing"),Mp=Go.get("text-padding")*ea.tilePixelRatio,fh=Go.get("icon-padding")*ea.tilePixelRatio,Uh=Go.get("text-max-angle")/180*Math.PI,Ip=Go.get("text-rotation-alignment")==="map"&&Go.get("symbol-placement")!=="point",kp=Go.get("icon-rotation-alignment")==="map"&&Go.get("symbol-placement")!=="point",of=Go.get("symbol-placement"),Zh=zh/2,Vh=Go.get("icon-text-fit");da&&Vh!=="none"&&(ea.allowVerticalPlacement&&Fa.vertical&&(Ft=gi(da,Fa.vertical,Vh,Go.get("icon-text-fit-padding"),Tc,Nh)),pl&&(da=gi(da,pl,Vh,Go.get("icon-text-fit-padding"),Tc,Nh)));var Ff=function(Bp,Np){Np.x<0||Np.x>=8192||Np.y<0||Np.y>=8192||function(ki,Ho,Nv,Nf,Ed,zv,zp,Ic,ph,Up,Sd,Lu,kc,zf,Zp,dh,Yh,$h,tv,Uv,Ku,Cd,Zv,Pc,Vv){var jv,vh,mh,qh,Kh,Qh=ki.addToLineVertexArray(Ho,Nv),Gv=0,Hv=0,rv=0,wd=0,nv=-1,iv=-1,Lc={},Wv=Be(""),av=0,Ad=0;if(Ic._unevaluatedLayout.getValue("text-radial-offset")===void 0?(av=(jv=Ic.layout.get("text-offset").evaluate(Ku,{},Pc).map(function(Gp){return 24*Gp}))[0],Ad=jv[1]):(av=24*Ic.layout.get("text-radial-offset").evaluate(Ku,{},Pc),Ad=Bo),ki.allowVerticalPlacement&&Nf.vertical){var Xv=Ic.layout.get("text-rotate").evaluate(Ku,{},Pc)+90;qh=new Jo(ph,Ho,Up,Sd,Lu,Nf.vertical,kc,zf,Zp,Xv),zp&&(Kh=new Jo(ph,Ho,Up,Sd,Lu,zp,Yh,$h,Zp,Xv))}if(Ed){var ov=Ic.layout.get("icon-rotate").evaluate(Ku,{}),Yv=Ic.layout.get("icon-text-fit")!=="none",$v=Do(Ed,ov,Zv,Yv),Td=zp?Do(zp,ov,Zv,Yv):void 0;mh=new Jo(ph,Ho,Up,Sd,Lu,Ed,Yh,$h,!1,ov),Gv=4*$v.length;var qv=ki.iconSizeData,Vp=null;qv.kind==="source"?(Vp=[128*Ic.layout.get("icon-size").evaluate(Ku,{})])[0]>32640&&pt(ki.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):qv.kind==="composite"&&((Vp=[128*Cd.compositeIconSizes[0].evaluate(Ku,{},Pc),128*Cd.compositeIconSizes[1].evaluate(Ku,{},Pc)])[0]>32640||Vp[1]>32640)&&pt(ki.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),ki.addSymbols(ki.icon,$v,Vp,Uv,tv,Ku,!1,Ho,Qh.lineStartIndex,Qh.lineLength,-1,Pc),nv=ki.icon.placedSymbolArray.length-1,Td&&(Hv=4*Td.length,ki.addSymbols(ki.icon,Td,Vp,Uv,tv,Ku,rn.vertical,Ho,Qh.lineStartIndex,Qh.lineLength,-1,Pc),iv=ki.icon.placedSymbolArray.length-1)}for(var Kv in Nf.horizontal){var Jh=Nf.horizontal[Kv];if(!vh){Wv=Be(Jh.text);var H0=Ic.layout.get("text-rotate").evaluate(Ku,{},Pc);vh=new Jo(ph,Ho,Up,Sd,Lu,Jh,kc,zf,Zp,H0)}var Qv=Jh.positionedLines.length===1;if(rv+=tr(ki,Ho,Jh,zv,Ic,Zp,Ku,dh,Qh,Nf.vertical?rn.horizontal:rn.horizontalOnly,Qv?Object.keys(Nf.horizontal):[Kv],Lc,nv,Cd,Pc),Qv)break}Nf.vertical&&(wd+=tr(ki,Ho,Nf.vertical,zv,Ic,Zp,Ku,dh,Qh,rn.vertical,["vertical"],Lc,iv,Cd,Pc));var Jv=vh?vh.boxStartIndex:ki.collisionBoxArray.length,e0=vh?vh.boxEndIndex:ki.collisionBoxArray.length,W0=qh?qh.boxStartIndex:ki.collisionBoxArray.length,t0=qh?qh.boxEndIndex:ki.collisionBoxArray.length,r0=mh?mh.boxStartIndex:ki.collisionBoxArray.length,X0=mh?mh.boxEndIndex:ki.collisionBoxArray.length,Y0=Kh?Kh.boxStartIndex:ki.collisionBoxArray.length,n0=Kh?Kh.boxEndIndex:ki.collisionBoxArray.length,Rc=-1,jp=function(Gp,uv){return Gp&&Gp.circleDiameter?Math.max(Gp.circleDiameter,uv):uv};Rc=jp(vh,Rc),Rc=jp(qh,Rc),Rc=jp(mh,Rc);var sv=(Rc=jp(Kh,Rc))>-1?1:0;sv&&(Rc*=Vv/24),ki.glyphOffsetArray.length>=We.MAX_GLYPHS&&pt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ku.sortKey!==void 0&&ki.addToSortKeyRanges(ki.symbolInstances.length,Ku.sortKey),ki.symbolInstances.emplaceBack(Ho.x,Ho.y,Lc.right>=0?Lc.right:-1,Lc.center>=0?Lc.center:-1,Lc.left>=0?Lc.left:-1,Lc.vertical||-1,nv,iv,Wv,Jv,e0,W0,t0,r0,X0,Y0,n0,Up,rv,wd,Gv,Hv,sv,0,kc,av,Ad,Rc)}(ea,Np,Bp,Fa,da,su,Ft,ea.layers[0],ea.collisionBoxArray,Ga.index,Ga.sourceLayerIndex,ea.index,Df,Mp,Ip,us,af,fh,kp,Tc,Ga,zs,Ca,Jr,ao)};if(of==="line")for(var jh=0,gd=Oo(Ga.geometry,0,0,8192,8192);jh<gd.length;jh+=1)for(var yd=gd[jh],Pp=0,Lp=ss(yd,zh,Uh,Fa.vertical||pl,da,24,Mc,ea.overscaling,8192);Pp<Lp.length;Pp+=1){var _d=Lp[Pp];pl&&Tn(ea,pl.text,Zh,_d)||Ff(yd,_d)}else if(of==="line-center")for(var Rp=0,Gh=Ga.geometry;Rp<Gh.length;Rp+=1){var Op=Gh[Rp];if(Op.length>1){var Dp=Va(Op,Uh,Fa.vertical||pl,da,24,Mc);Dp&&Ff(Op,Dp)}}else if(Ga.type==="Polygon")for(var Hh=0,Jd=ll(Ga.geometry,0);Hh<Jd.length;Hh+=1){var Wh=Jd[Hh],Xh=_i(Wh,16);Ff(Wh[0],new fn(Xh.x,Xh.y,0))}else if(Ga.type==="LineString")for(var Bf=0,Fp=Ga.geometry;Bf<Fp.length;Bf+=1){var hh=Fp[Bf];Ff(hh,new fn(hh[0].x,hh[0].y,0))}else if(Ga.type==="Point")for(var xd=0,Fv=Ga.geometry;xd<Fv.length;xd+=1)for(var ev=0,Bv=Fv[xd];ev<Bv.length;ev+=1){var bd=Bv[ev];Ff([bd],new fn(bd.x,bd.y,0))}}(a,sr,Mn,Is,v,V,hn,Kn,Pn,Xs,w)},Vt=0,ir=a.features;Vt<ir.length;Vt+=1)St();E&&a.generateCollisionDebugBuffers()},y.perspective=function(a,s,l,v,_){var E,w=1/Math.tan(s/2);return a[0]=w/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=w,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,_!=null&&_!==1/0?(a[10]=(_+v)*(E=1/(v-_)),a[14]=2*_*v*E):(a[10]=-1,a[14]=-2*v),a},y.pick=function(a,s){for(var l={},v=0;v<s.length;v++){var _=s[v];_ in a&&(l[_]=a[_])}return l},y.plugin=eu,y.polygonIntersectsPolygon=il,y.postMapLoadEvent=Ye,y.postTurnstileEvent=qt,y.potpack=Vr,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=Rn,y.registerForPluginStateChange=function(a){return a({pluginStatus:bs,pluginURL:Vu}),Yf.on("pluginStateChange",a),a},y.renderColorRamp=Kc,y.rotate=function(a,s,l){var v=s[0],_=s[1],E=s[2],w=s[3],L=Math.sin(l),B=Math.cos(l);return a[0]=v*B+E*L,a[1]=_*B+w*L,a[2]=v*-L+E*B,a[3]=_*-L+w*B,a},y.rotateX=function(a,s,l){var v=Math.sin(l),_=Math.cos(l),E=s[4],w=s[5],L=s[6],B=s[7],V=s[8],W=s[9],$=s[10],le=s[11];return s!==a&&(a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=s[3],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[4]=E*_+V*v,a[5]=w*_+W*v,a[6]=L*_+$*v,a[7]=B*_+le*v,a[8]=V*_-E*v,a[9]=W*_-w*v,a[10]=$*_-L*v,a[11]=le*_-B*v,a},y.rotateZ=function(a,s,l){var v=Math.sin(l),_=Math.cos(l),E=s[0],w=s[1],L=s[2],B=s[3],V=s[4],W=s[5],$=s[6],le=s[7];return s!==a&&(a[8]=s[8],a[9]=s[9],a[10]=s[10],a[11]=s[11],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[0]=E*_+V*v,a[1]=w*_+W*v,a[2]=L*_+$*v,a[3]=B*_+le*v,a[4]=V*_-E*v,a[5]=W*_-w*v,a[6]=$*_-L*v,a[7]=le*_-B*v,a},y.scale=function(a,s,l){var v=l[0],_=l[1],E=l[2];return a[0]=s[0]*v,a[1]=s[1]*v,a[2]=s[2]*v,a[3]=s[3]*v,a[4]=s[4]*_,a[5]=s[5]*_,a[6]=s[6]*_,a[7]=s[7]*_,a[8]=s[8]*E,a[9]=s[9]*E,a[10]=s[10]*E,a[11]=s[11]*E,a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15],a},y.scale$1=function(a,s,l){return a[0]=s[0]*l,a[1]=s[1]*l,a[2]=s[2]*l,a[3]=s[3]*l,a},y.scale$2=function(a,s,l){return a[0]=s[0]*l,a[1]=s[1]*l,a[2]=s[2]*l,a},y.setCacheLimits=function(a,s){Mt=a,pr=s},y.setRTLTextPlugin=function(a,s,l){if(l===void 0&&(l=!1),bs==="deferred"||bs==="loading"||bs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Vu=oi.resolveURL(a),bs="deferred",xs=s,xf(),l||Vs()},y.sphericalToCartesian=function(a){var s=a[0],l=a[1],v=a[2];return l+=90,l*=Math.PI/180,v*=Math.PI/180,{x:s*Math.cos(l)*Math.sin(v),y:s*Math.sin(l)*Math.sin(v),z:s*Math.cos(v)}},y.sqrLen=function(a){var s=a[0],l=a[1];return s*s+l*l},y.styleSpec=be,y.sub=function(a,s,l){return a[0]=s[0]-l[0],a[1]=s[1]-l[1],a[2]=s[2]-l[2],a},y.symbolSize=Ui,y.transformMat3=function(a,s,l){var v=s[0],_=s[1],E=s[2];return a[0]=v*l[0]+_*l[3]+E*l[6],a[1]=v*l[1]+_*l[4]+E*l[7],a[2]=v*l[2]+_*l[5]+E*l[8],a},y.transformMat4=Jl,y.translate=function(a,s,l){var v,_,E,w,L,B,V,W,$,le,ve,Ue,Ve=l[0],st=l[1],Qe=l[2];return s===a?(a[12]=s[0]*Ve+s[4]*st+s[8]*Qe+s[12],a[13]=s[1]*Ve+s[5]*st+s[9]*Qe+s[13],a[14]=s[2]*Ve+s[6]*st+s[10]*Qe+s[14],a[15]=s[3]*Ve+s[7]*st+s[11]*Qe+s[15]):(_=s[1],E=s[2],w=s[3],L=s[4],B=s[5],V=s[6],W=s[7],$=s[8],le=s[9],ve=s[10],Ue=s[11],a[0]=v=s[0],a[1]=_,a[2]=E,a[3]=w,a[4]=L,a[5]=B,a[6]=V,a[7]=W,a[8]=$,a[9]=le,a[10]=ve,a[11]=Ue,a[12]=v*Ve+L*st+$*Qe+s[12],a[13]=_*Ve+B*st+le*Qe+s[13],a[14]=E*Ve+V*st+ve*Qe+s[14],a[15]=w*Ve+W*st+Ue*Qe+s[15]),a},y.triggerPluginCompletionEvent=Ah,y.uniqueId=Gt,y.validateCustomStyleLayer=function(a){var s=[],l=a.id;return l===void 0&&s.push({message:"layers."+l+': missing required property "id"'}),a.render===void 0&&s.push({message:"layers."+l+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&s.push({message:"layers."+l+': property "renderingMode" must be either "2d" or "3d"'}),s},y.validateLight=Ul,y.validateStyle=Zu,y.values=function(a){var s=[];for(var l in a)s.push(a[l]);return s},y.vectorTile=Yu,y.version="1.13.2",y.warnOnce=pt,y.webpSupported=Vn,y.window=_e,y.wrap=ar}),J(["./shared"],function(y){"use strict";function Ae(Y){var ie=typeof Y;if(ie==="number"||ie==="boolean"||ie==="string"||Y==null)return JSON.stringify(Y);if(Array.isArray(Y)){for(var de="[",Ce=0,Ze=Y;Ce<Ze.length;Ce+=1)de+=Ae(Ze[Ce])+",";return de+"]"}for(var et=Object.keys(Y).sort(),dt="{",be=0;be<et.length;be++)dt+=JSON.stringify(et[be])+":"+Ae(Y[et[be]])+",";return dt+"}"}function T(Y){for(var ie="",de=0,Ce=y.refProperties;de<Ce.length;de+=1)ie+="/"+Ae(Y[Ce[de]]);return ie}var ce=function(Y){this.keyCache={},Y&&this.replace(Y)};ce.prototype.replace=function(Y){this._layerConfigs={},this._layers={},this.update(Y,[])},ce.prototype.update=function(Y,ie){for(var de=this,Ce=0,Ze=Y;Ce<Ze.length;Ce+=1){var et=Ze[Ce];this._layerConfigs[et.id]=et;var dt=this._layers[et.id]=y.createStyleLayer(et);dt._featureFilter=y.featureFilter(dt.filter),this.keyCache[et.id]&&delete this.keyCache[et.id]}for(var be=0,He=ie;be<He.length;be+=1){var Rt=He[be];delete this.keyCache[Rt],delete this._layerConfigs[Rt],delete this._layers[Rt]}this.familiesBySource={};for(var kr=0,Xt=function(sn,pn){for(var bi={},yn=0;yn<sn.length;yn++){var Pi=pn&&pn[sn[yn].id]||T(sn[yn]);pn&&(pn[sn[yn].id]=Pi);var aa=bi[Pi];aa||(aa=bi[Pi]=[]),aa.push(sn[yn])}var vt=[];for(var yt in bi)vt.push(bi[yt]);return vt}(y.values(this._layerConfigs),this.keyCache);kr<Xt.length;kr+=1){var er=Xt[kr].map(function(sn){return de._layers[sn.id]}),Pr=er[0];if(Pr.visibility!=="none"){var Ln=Pr.source||"",An=this.familiesBySource[Ln];An||(An=this.familiesBySource[Ln]={});var Ht=Pr.sourceLayer||"_geojsonTileLayer",xn=An[Ht];xn||(xn=An[Ht]=[]),xn.push(er)}}};var pe=function(Y){var ie={},de=[];for(var Ce in Y){var Ze=Y[Ce],et=ie[Ce]={};for(var dt in Ze){var be=Ze[+dt];if(be&&be.bitmap.width!==0&&be.bitmap.height!==0){var He={x:0,y:0,w:be.bitmap.width+2,h:be.bitmap.height+2};de.push(He),et[dt]={rect:He,metrics:be.metrics}}}}var Rt=y.potpack(de),kr=new y.AlphaImage({width:Rt.w||1,height:Rt.h||1});for(var Xt in Y){var er=Y[Xt];for(var Pr in er){var Ln=er[+Pr];if(Ln&&Ln.bitmap.width!==0&&Ln.bitmap.height!==0){var An=ie[Xt][Pr].rect;y.AlphaImage.copy(Ln.bitmap,kr,{x:0,y:0},{x:An.x+1,y:An.y+1},Ln.bitmap)}}}this.image=kr,this.positions=ie};y.register("GlyphAtlas",pe);var Fe=function(Y){this.tileID=new y.OverscaledTileID(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.uid=Y.uid,this.zoom=Y.zoom,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.returnDependencies=!!Y.returnDependencies,this.promoteId=Y.promoteId};function _e(Y,ie,de){for(var Ce=new y.EvaluationParameters(ie),Ze=0,et=Y;Ze<et.length;Ze+=1)et[Ze].recalculate(Ce,de)}function Ge(Y,ie){var de=y.getArrayBuffer(Y.request,function(Ce,Ze,et,dt){Ce?ie(Ce):Ze&&ie(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(Ze)),rawData:Ze,cacheControl:et,expires:dt})});return function(){de.cancel(),ie()}}Fe.prototype.parse=function(Y,ie,de,Ce,Ze){var et=this;this.status="parsing",this.data=Y,this.collisionBoxArray=new y.CollisionBoxArray;var dt=new y.DictionaryCoder(Object.keys(Y.layers).sort()),be=new y.FeatureIndex(this.tileID,this.promoteId);be.bucketLayerIDs=[];var He,Rt,kr,Xt,er={},Pr={featureIndex:be,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:de},Ln=ie.familiesBySource[this.source];for(var An in Ln){var Ht=Y.layers[An];if(Ht){Ht.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+An+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var xn=dt.encode(An),sn=[],pn=0;pn<Ht.length;pn++){var bi=Ht.feature(pn),yn=be.getId(bi,An);sn.push({feature:bi,id:yn,index:pn,sourceLayerIndex:xn})}for(var Pi=0,aa=Ln[An];Pi<aa.length;Pi+=1){var vt=aa[Pi],yt=vt[0];yt.minzoom&&this.zoom<Math.floor(yt.minzoom)||yt.maxzoom&&this.zoom>=yt.maxzoom||yt.visibility!=="none"&&(_e(vt,this.zoom,de),(er[yt.id]=yt.createBucket({index:be.bucketLayerIDs.length,layers:vt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:xn,sourceID:this.source})).populate(sn,Pr,this.tileID.canonical),be.bucketLayerIDs.push(vt.map(function(oa){return oa.id})))}}}var Ii=y.mapObject(Pr.glyphDependencies,function(oa){return Object.keys(oa).map(Number)});Object.keys(Ii).length?Ce.send("getGlyphs",{uid:this.uid,stacks:Ii},function(oa,Ri){He||(He=oa,Rt=Ri,Ji.call(et))}):Rt={};var ui=Object.keys(Pr.iconDependencies);ui.length?Ce.send("getImages",{icons:ui,source:this.source,tileID:this.tileID,type:"icons"},function(oa,Ri){He||(He=oa,kr=Ri,Ji.call(et))}):kr={};var Qi=Object.keys(Pr.patternDependencies);function Ji(){if(He)return Ze(He);if(Rt&&kr&&Xt){var oa=new pe(Rt),Ri=new y.ImageAtlas(kr,Xt);for(var hr in er){var _r=er[hr];_r instanceof y.SymbolBucket?(_e(_r.layers,this.zoom,de),y.performSymbolLayout(_r,Rt,oa.positions,kr,Ri.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):_r.hasPattern&&(_r instanceof y.LineBucket||_r instanceof y.FillBucket||_r instanceof y.FillExtrusionBucket)&&(_e(_r.layers,this.zoom,de),_r.addFeatures(Pr,this.tileID.canonical,Ri.patternPositions))}this.status="done",Ze(null,{buckets:y.values(er).filter(function(at){return!at.isEmpty()}),featureIndex:be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:oa.image,imageAtlas:Ri,glyphMap:this.returnDependencies?Rt:null,iconMap:this.returnDependencies?kr:null,glyphPositions:this.returnDependencies?oa.positions:null})}}Qi.length?Ce.send("getImages",{icons:Qi,source:this.source,tileID:this.tileID,type:"patterns"},function(oa,Ri){He||(He=oa,Xt=Ri,Ji.call(et))}):Xt={},Ji.call(this)};var ot=function(Y,ie,de,Ce){this.actor=Y,this.layerIndex=ie,this.availableImages=de,this.loadVectorData=Ce||Ge,this.loading={},this.loaded={}};ot.prototype.loadTile=function(Y,ie){var de=this,Ce=Y.uid;this.loading||(this.loading={});var Ze=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new y.RequestPerformance(Y.request),et=this.loading[Ce]=new Fe(Y);et.abort=this.loadVectorData(Y,function(dt,be){if(delete de.loading[Ce],dt||!be)return et.status="done",de.loaded[Ce]=et,ie(dt);var He=be.rawData,Rt={};be.expires&&(Rt.expires=be.expires),be.cacheControl&&(Rt.cacheControl=be.cacheControl);var kr={};if(Ze){var Xt=Ze.finish();Xt&&(kr.resourceTiming=JSON.parse(JSON.stringify(Xt)))}et.vectorTile=be.vectorTile,et.parse(be.vectorTile,de.layerIndex,de.availableImages,de.actor,function(er,Pr){if(er||!Pr)return ie(er);ie(null,y.extend({rawTileData:He.slice(0)},Pr,Rt,kr))}),de.loaded=de.loaded||{},de.loaded[Ce]=et})},ot.prototype.reloadTile=function(Y,ie){var de=this,Ce=this.loaded,Ze=Y.uid,et=this;if(Ce&&Ce[Ze]){var dt=Ce[Ze];dt.showCollisionBoxes=Y.showCollisionBoxes;var be=function(He,Rt){var kr=dt.reloadCallback;kr&&(delete dt.reloadCallback,dt.parse(dt.vectorTile,et.layerIndex,de.availableImages,et.actor,kr)),ie(He,Rt)};dt.status==="parsing"?dt.reloadCallback=be:dt.status==="done"&&(dt.vectorTile?dt.parse(dt.vectorTile,this.layerIndex,this.availableImages,this.actor,be):be())}},ot.prototype.abortTile=function(Y,ie){var de=this.loading,Ce=Y.uid;de&&de[Ce]&&de[Ce].abort&&(de[Ce].abort(),delete de[Ce]),ie()},ot.prototype.removeTile=function(Y,ie){var de=this.loaded,Ce=Y.uid;de&&de[Ce]&&delete de[Ce],ie()};var ft=y.window.ImageBitmap,kt=function(){this.loaded={}};function ar(Y,ie){if(Y.length!==0){xt(Y[0],ie);for(var de=1;de<Y.length;de++)xt(Y[de],!ie)}}function xt(Y,ie){for(var de=0,Ce=0,Ze=Y.length,et=Ze-1;Ce<Ze;et=Ce++)de+=(Y[Ce][0]-Y[et][0])*(Y[et][1]+Y[Ce][1]);de>=0!=!!ie&&Y.reverse()}kt.prototype.loadTile=function(Y,ie){var de=Y.uid,Ce=Y.encoding,Ze=Y.rawImageData,et=ft&&Ze instanceof ft?this.getImageData(Ze):Ze,dt=new y.DEMData(de,et,Ce);this.loaded=this.loaded||{},this.loaded[de]=dt,ie(null,dt)},kt.prototype.getImageData=function(Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);var ie=this.offscreenCanvasContext.getImageData(-1,-1,Y.width+2,Y.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:ie.width,height:ie.height},ie.data)},kt.prototype.removeTile=function(Y){var ie=this.loaded,de=Y.uid;ie&&ie[de]&&delete ie[de]};var Jt=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,Gt=function(Y){this._feature=Y,this.extent=y.EXTENT,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))};Gt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var Y=[],ie=0,de=this._feature.geometry;ie<de.length;ie+=1){var Ce=de[ie];Y.push([new y.Point$1(Ce[0],Ce[1])])}return Y}for(var Ze=[],et=0,dt=this._feature.geometry;et<dt.length;et+=1){for(var be=[],He=0,Rt=dt[et];He<Rt.length;He+=1){var kr=Rt[He];be.push(new y.Point$1(kr[0],kr[1]))}Ze.push(be)}return Ze},Gt.prototype.toGeoJSON=function(Y,ie,de){return Jt.call(this,Y,ie,de)};var wt=function(Y){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=Y.length,this._features=Y};wt.prototype.feature=function(Y){return new Gt(this._features[Y])};var Bt=y.vectorTile.VectorTileFeature,gr=K;function K(Y,ie){this.options=ie||{},this.features=Y,this.length=Y.length}function ur(Y,ie){this.id=typeof Y.id=="number"?Y.id:void 0,this.type=Y.type,this.rawGeometry=Y.type===1?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=ie||4096}K.prototype.feature=function(Y){return new ur(this.features[Y],this.options.extent)},ur.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var ie=0;ie<Y.length;ie++){for(var de=Y[ie],Ce=[],Ze=0;Ze<de.length;Ze++)Ce.push(new y.Point$1(de[Ze][0],de[Ze][1]));this.geometry.push(Ce)}return this.geometry},ur.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,ie=1/0,de=-1/0,Ce=1/0,Ze=-1/0,et=0;et<Y.length;et++)for(var dt=Y[et],be=0;be<dt.length;be++){var He=dt[be];ie=Math.min(ie,He.x),de=Math.max(de,He.x),Ce=Math.min(Ce,He.y),Ze=Math.max(Ze,He.y)}return[ie,Ce,de,Ze]},ur.prototype.toGeoJSON=Bt.prototype.toGeoJSON;var Tt=Ot,ht=gr;function Ot(Y){var ie=new y.pbf;return function(de,Ce){for(var Ze in de.layers)Ce.writeMessage(3,pt,de.layers[Ze])}(Y,ie),ie.finish()}function pt(Y,ie){var de;ie.writeVarintField(15,Y.version||1),ie.writeStringField(1,Y.name||""),ie.writeVarintField(5,Y.extent||4096);var Ce={keys:[],values:[],keycache:{},valuecache:{}};for(de=0;de<Y.length;de++)Ce.feature=Y.feature(de),ie.writeMessage(2,lr,Ce);var Ze=Ce.keys;for(de=0;de<Ze.length;de++)ie.writeStringField(3,Ze[de]);var et=Ce.values;for(de=0;de<et.length;de++)ie.writeMessage(4,Me,et[de])}function lr(Y,ie){var de=Y.feature;de.id!==void 0&&ie.writeVarintField(1,de.id),ie.writeMessage(2,Br,Y),ie.writeVarintField(3,de.type),ie.writeMessage(4,Q,de)}function Br(Y,ie){var de=Y.feature,Ce=Y.keys,Ze=Y.values,et=Y.keycache,dt=Y.valuecache;for(var be in de.properties){var He=et[be];He===void 0&&(Ce.push(be),et[be]=He=Ce.length-1),ie.writeVarint(He);var Rt=de.properties[be],kr=typeof Rt;kr!=="string"&&kr!=="boolean"&&kr!=="number"&&(Rt=JSON.stringify(Rt));var Xt=kr+":"+Rt,er=dt[Xt];er===void 0&&(Ze.push(Rt),dt[Xt]=er=Ze.length-1),ie.writeVarint(er)}}function q(Y,ie){return(ie<<3)+(7&Y)}function ge(Y){return Y<<1^Y>>31}function Q(Y,ie){for(var de=Y.loadGeometry(),Ce=Y.type,Ze=0,et=0,dt=de.length,be=0;be<dt;be++){var He=de[be],Rt=1;Ce===1&&(Rt=He.length),ie.writeVarint(q(1,Rt));for(var kr=Ce===3?He.length-1:He.length,Xt=0;Xt<kr;Xt++){Xt===1&&Ce!==1&&ie.writeVarint(q(2,kr-1));var er=He[Xt].x-Ze,Pr=He[Xt].y-et;ie.writeVarint(ge(er)),ie.writeVarint(ge(Pr)),Ze+=er,et+=Pr}Ce===3&&ie.writeVarint(q(7,1))}}function Me(Y,ie){var de=typeof Y;de==="string"?ie.writeStringField(1,Y):de==="boolean"?ie.writeBooleanField(7,Y):de==="number"&&(Y%1!=0?ie.writeDoubleField(3,Y):Y<0?ie.writeSVarintField(6,Y):ie.writeVarintField(5,Y))}function ee(Y,ie,de,Ce){oe(Y,de,Ce),oe(ie,2*de,2*Ce),oe(ie,2*de+1,2*Ce+1)}function oe(Y,ie,de){var Ce=Y[ie];Y[ie]=Y[de],Y[de]=Ce}function bt(Y,ie,de,Ce){var Ze=Y-de,et=ie-Ce;return Ze*Ze+et*et}Tt.fromVectorTileJs=Ot,Tt.fromGeojsonVt=function(Y,ie){ie=ie||{};var de={};for(var Ce in Y)de[Ce]=new gr(Y[Ce].features,ie),de[Ce].name=Ce,de[Ce].version=ie.version,de[Ce].extent=ie.extent;return Ot({layers:de})},Tt.GeoJSONWrapper=ht;var Nt=function(Y){return Y[0]},jt=function(Y){return Y[1]},Qt=function(Y,ie,de,Ce,Ze){ie===void 0&&(ie=Nt),de===void 0&&(de=jt),Ce===void 0&&(Ce=64),Ze===void 0&&(Ze=Float64Array),this.nodeSize=Ce,this.points=Y;for(var et=Y.length<65536?Uint16Array:Uint32Array,dt=this.ids=new et(Y.length),be=this.coords=new Ze(2*Y.length),He=0;He<Y.length;He++)dt[He]=He,be[2*He]=ie(Y[He]),be[2*He+1]=de(Y[He]);(function Rt(kr,Xt,er,Pr,Ln,An){if(!(Ln-Pr<=er)){var Ht=Pr+Ln>>1;(function xn(sn,pn,bi,yn,Pi,aa){for(;Pi>yn;){if(Pi-yn>600){var vt=Pi-yn+1,yt=bi-yn+1,Ii=Math.log(vt),ui=.5*Math.exp(2*Ii/3),Qi=.5*Math.sqrt(Ii*ui*(vt-ui)/vt)*(yt-vt/2<0?-1:1);xn(sn,pn,bi,Math.max(yn,Math.floor(bi-yt*ui/vt+Qi)),Math.min(Pi,Math.floor(bi+(vt-yt)*ui/vt+Qi)),aa)}var Ji=pn[2*bi+aa],oa=yn,Ri=Pi;for(ee(sn,pn,yn,bi),pn[2*Pi+aa]>Ji&&ee(sn,pn,yn,Pi);oa<Ri;){for(ee(sn,pn,oa,Ri),oa++,Ri--;pn[2*oa+aa]<Ji;)oa++;for(;pn[2*Ri+aa]>Ji;)Ri--}pn[2*yn+aa]===Ji?ee(sn,pn,yn,Ri):ee(sn,pn,++Ri,Pi),Ri<=bi&&(yn=Ri+1),bi<=Ri&&(Pi=Ri-1)}})(kr,Xt,Ht,Pr,Ln,An%2),Rt(kr,Xt,er,Pr,Ht-1,An+1),Rt(kr,Xt,er,Ht+1,Ln,An+1)}})(dt,be,Ce,0,dt.length-1,0)};Qt.prototype.range=function(Y,ie,de,Ce){return function(Ze,et,dt,be,He,Rt,kr){for(var Xt,er,Pr=[0,Ze.length-1,0],Ln=[];Pr.length;){var An=Pr.pop(),Ht=Pr.pop(),xn=Pr.pop();if(Ht-xn<=kr)for(var sn=xn;sn<=Ht;sn++)er=et[2*sn+1],(Xt=et[2*sn])>=dt&&Xt<=He&&er>=be&&er<=Rt&&Ln.push(Ze[sn]);else{var pn=Math.floor((xn+Ht)/2);er=et[2*pn+1],(Xt=et[2*pn])>=dt&&Xt<=He&&er>=be&&er<=Rt&&Ln.push(Ze[pn]);var bi=(An+1)%2;(An===0?dt<=Xt:be<=er)&&(Pr.push(xn),Pr.push(pn-1),Pr.push(bi)),(An===0?He>=Xt:Rt>=er)&&(Pr.push(pn+1),Pr.push(Ht),Pr.push(bi))}}return Ln}(this.ids,this.coords,Y,ie,de,Ce,this.nodeSize)},Qt.prototype.within=function(Y,ie,de){return function(Ce,Ze,et,dt,be,He){for(var Rt=[0,Ce.length-1,0],kr=[],Xt=be*be;Rt.length;){var er=Rt.pop(),Pr=Rt.pop(),Ln=Rt.pop();if(Pr-Ln<=He)for(var An=Ln;An<=Pr;An++)bt(Ze[2*An],Ze[2*An+1],et,dt)<=Xt&&kr.push(Ce[An]);else{var Ht=Math.floor((Ln+Pr)/2),xn=Ze[2*Ht],sn=Ze[2*Ht+1];bt(xn,sn,et,dt)<=Xt&&kr.push(Ce[Ht]);var pn=(er+1)%2;(er===0?et-be<=xn:dt-be<=sn)&&(Rt.push(Ln),Rt.push(Ht-1),Rt.push(pn)),(er===0?et+be>=xn:dt+be>=sn)&&(Rt.push(Ht+1),Rt.push(Pr),Rt.push(pn))}}return kr}(this.ids,this.coords,Y,ie,de,this.nodeSize)};var ln={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Y){return Y}},Dr=function(Y){this.options=Hi(Object.create(ln),Y),this.trees=new Array(this.options.maxZoom+1)};function oi(Y,ie,de,Ce,Ze){return{x:Y,y:ie,zoom:1/0,id:de,parentId:-1,numPoints:Ce,properties:Ze}}function Zn(Y,ie){var de=Y.geometry.coordinates,Ce=de[1];return{x:Ci(de[0]),y:fi(Ce),zoom:1/0,index:ie,parentId:-1}}function Vn(Y){return{type:"Feature",id:Y.id,properties:Xi(Y),geometry:{type:"Point",coordinates:[(Ce=Y.x,360*(Ce-.5)),(ie=Y.y,de=(180-360*ie)*Math.PI/180,360*Math.atan(Math.exp(de))/Math.PI-90)]}};var ie,de,Ce}function Xi(Y){var ie=Y.numPoints,de=ie>=1e4?Math.round(ie/1e3)+"k":ie>=1e3?Math.round(ie/100)/10+"k":ie;return Hi(Hi({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:ie,point_count_abbreviated:de})}function Ci(Y){return Y/360+.5}function fi(Y){var ie=Math.sin(Y*Math.PI/180),de=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return de<0?0:de>1?1:de}function Hi(Y,ie){for(var de in ie)Y[de]=ie[de];return Y}function Ni(Y){return Y.x}function hi(Y){return Y.y}function Xn(Y,ie,de,Ce,Ze,et){var dt=Ze-de,be=et-Ce;if(dt!==0||be!==0){var He=((Y-de)*dt+(ie-Ce)*be)/(dt*dt+be*be);He>1?(de=Ze,Ce=et):He>0&&(de+=dt*He,Ce+=be*He)}return(dt=Y-de)*dt+(be=ie-Ce)*be}function ri(Y,ie,de,Ce){var Ze={id:Y===void 0?null:Y,type:ie,geometry:de,tags:Ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(et){var dt=et.geometry,be=et.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")po(et,dt);else if(be==="Polygon"||be==="MultiLineString")for(var He=0;He<dt.length;He++)po(et,dt[He]);else if(be==="MultiPolygon")for(He=0;He<dt.length;He++)for(var Rt=0;Rt<dt[He].length;Rt++)po(et,dt[He][Rt])}(Ze),Ze}function po(Y,ie){for(var de=0;de<ie.length;de+=3)Y.minX=Math.min(Y.minX,ie[de]),Y.minY=Math.min(Y.minY,ie[de+1]),Y.maxX=Math.max(Y.maxX,ie[de]),Y.maxY=Math.max(Y.maxY,ie[de+1])}function Ha(Y,ie,de,Ce){if(ie.geometry){var Ze=ie.geometry.coordinates,et=ie.geometry.type,dt=Math.pow(de.tolerance/((1<<de.maxZoom)*de.extent),2),be=[],He=ie.id;if(de.promoteId?He=ie.properties[de.promoteId]:de.generateId&&(He=Ce||0),et==="Point")wa(Ze,be);else if(et==="MultiPoint")for(var Rt=0;Rt<Ze.length;Rt++)wa(Ze[Rt],be);else if(et==="LineString")Et(Ze,be,dt,!1);else if(et==="MultiLineString"){if(de.lineMetrics){for(Rt=0;Rt<Ze.length;Rt++)Et(Ze[Rt],be=[],dt,!1),Y.push(ri(He,"LineString",be,ie.properties));return}me(Ze,be,dt,!1)}else if(et==="Polygon")me(Ze,be,dt,!0);else{if(et!=="MultiPolygon"){if(et==="GeometryCollection"){for(Rt=0;Rt<ie.geometry.geometries.length;Rt++)Ha(Y,{id:He,geometry:ie.geometry.geometries[Rt],properties:ie.properties},de,Ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Rt=0;Rt<Ze.length;Rt++){var kr=[];me(Ze[Rt],kr,dt,!0),be.push(kr)}}Y.push(ri(He,et,be,ie.properties))}}function wa(Y,ie){ie.push(se(Y[0])),ie.push(Se(Y[1])),ie.push(0)}function Et(Y,ie,de,Ce){for(var Ze,et,dt=0,be=0;be<Y.length;be++){var He=se(Y[be][0]),Rt=Se(Y[be][1]);ie.push(He),ie.push(Rt),ie.push(0),be>0&&(dt+=Ce?(Ze*Rt-He*et)/2:Math.sqrt(Math.pow(He-Ze,2)+Math.pow(Rt-et,2))),Ze=He,et=Rt}var kr=ie.length-3;ie[2]=1,function Xt(er,Pr,Ln,An){for(var Ht,xn=An,sn=Ln-Pr>>1,pn=Ln-Pr,bi=er[Pr],yn=er[Pr+1],Pi=er[Ln],aa=er[Ln+1],vt=Pr+3;vt<Ln;vt+=3){var yt=Xn(er[vt],er[vt+1],bi,yn,Pi,aa);if(yt>xn)Ht=vt,xn=yt;else if(yt===xn){var Ii=Math.abs(vt-sn);Ii<pn&&(Ht=vt,pn=Ii)}}xn>An&&(Ht-Pr>3&&Xt(er,Pr,Ht,An),er[Ht+2]=xn,Ln-Ht>3&&Xt(er,Ht,Ln,An))}(ie,0,kr,de),ie[kr+2]=1,ie.size=Math.abs(dt),ie.start=0,ie.end=ie.size}function me(Y,ie,de,Ce){for(var Ze=0;Ze<Y.length;Ze++){var et=[];Et(Y[Ze],et,de,Ce),ie.push(et)}}function se(Y){return Y/360+.5}function Se(Y){var ie=Math.sin(Y*Math.PI/180),de=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return de<0?0:de>1?1:de}function z(Y,ie,de,Ce,Ze,et,dt,be){if(Ce/=ie,et>=(de/=ie)&&dt<Ce)return Y;if(dt<de||et>=Ce)return null;for(var He=[],Rt=0;Rt<Y.length;Rt++){var kr=Y[Rt],Xt=kr.geometry,er=kr.type,Pr=Ze===0?kr.minX:kr.minY,Ln=Ze===0?kr.maxX:kr.maxY;if(Pr>=de&&Ln<Ce)He.push(kr);else if(!(Ln<de||Pr>=Ce)){var An=[];if(er==="Point"||er==="MultiPoint")qe(Xt,An,de,Ce,Ze);else if(er==="LineString")qt(Xt,An,de,Ce,Ze,!1,be.lineMetrics);else if(er==="MultiLineString")Ye(Xt,An,de,Ce,Ze,!1);else if(er==="Polygon")Ye(Xt,An,de,Ce,Ze,!0);else if(er==="MultiPolygon")for(var Ht=0;Ht<Xt.length;Ht++){var xn=[];Ye(Xt[Ht],xn,de,Ce,Ze,!0),xn.length&&An.push(xn)}if(An.length){if(be.lineMetrics&&er==="LineString"){for(Ht=0;Ht<An.length;Ht++)He.push(ri(kr.id,er,An[Ht],kr.tags));continue}er!=="LineString"&&er!=="MultiLineString"||(An.length===1?(er="LineString",An=An[0]):er="MultiLineString"),er!=="Point"&&er!=="MultiPoint"||(er=An.length===3?"Point":"MultiPoint"),He.push(ri(kr.id,er,An,kr.tags))}}}return He.length?He:null}function qe(Y,ie,de,Ce,Ze){for(var et=0;et<Y.length;et+=3){var dt=Y[et+Ze];dt>=de&&dt<=Ce&&(ie.push(Y[et]),ie.push(Y[et+1]),ie.push(Y[et+2]))}}function qt(Y,ie,de,Ce,Ze,et,dt){for(var be,He,Rt=Or(Y),kr=Ze===0?pr:Mr,Xt=Y.start,er=0;er<Y.length-3;er+=3){var Pr=Y[er],Ln=Y[er+1],An=Y[er+2],Ht=Y[er+3],xn=Y[er+4],sn=Ze===0?Pr:Ln,pn=Ze===0?Ht:xn,bi=!1;dt&&(be=Math.sqrt(Math.pow(Pr-Ht,2)+Math.pow(Ln-xn,2))),sn<de?pn>de&&(He=kr(Rt,Pr,Ln,Ht,xn,de),dt&&(Rt.start=Xt+be*He)):sn>Ce?pn<Ce&&(He=kr(Rt,Pr,Ln,Ht,xn,Ce),dt&&(Rt.start=Xt+be*He)):Mt(Rt,Pr,Ln,An),pn<de&&sn>=de&&(He=kr(Rt,Pr,Ln,Ht,xn,de),bi=!0),pn>Ce&&sn<=Ce&&(He=kr(Rt,Pr,Ln,Ht,xn,Ce),bi=!0),!et&&bi&&(dt&&(Rt.end=Xt+be*He),ie.push(Rt),Rt=Or(Y)),dt&&(Xt+=be)}var yn=Y.length-3;Pr=Y[yn],Ln=Y[yn+1],An=Y[yn+2],(sn=Ze===0?Pr:Ln)>=de&&sn<=Ce&&Mt(Rt,Pr,Ln,An),yn=Rt.length-3,et&&yn>=3&&(Rt[yn]!==Rt[0]||Rt[yn+1]!==Rt[1])&&Mt(Rt,Rt[0],Rt[1],Rt[2]),Rt.length&&ie.push(Rt)}function Or(Y){var ie=[];return ie.size=Y.size,ie.start=Y.start,ie.end=Y.end,ie}function Ye(Y,ie,de,Ce,Ze,et){for(var dt=0;dt<Y.length;dt++)qt(Y[dt],ie,de,Ce,Ze,et,!1)}function Mt(Y,ie,de,Ce){Y.push(ie),Y.push(de),Y.push(Ce)}function pr(Y,ie,de,Ce,Ze,et){var dt=(et-ie)/(Ce-ie);return Y.push(et),Y.push(de+(Ze-de)*dt),Y.push(1),dt}function Mr(Y,ie,de,Ce,Ze,et){var dt=(et-de)/(Ze-de);return Y.push(ie+(Ce-ie)*dt),Y.push(et),Y.push(1),dt}function Zr(Y,ie){for(var de=[],Ce=0;Ce<Y.length;Ce++){var Ze,et=Y[Ce],dt=et.type;if(dt==="Point"||dt==="MultiPoint"||dt==="LineString")Ze=qr(et.geometry,ie);else if(dt==="MultiLineString"||dt==="Polygon"){Ze=[];for(var be=0;be<et.geometry.length;be++)Ze.push(qr(et.geometry[be],ie))}else if(dt==="MultiPolygon")for(Ze=[],be=0;be<et.geometry.length;be++){for(var He=[],Rt=0;Rt<et.geometry[be].length;Rt++)He.push(qr(et.geometry[be][Rt],ie));Ze.push(He)}de.push(ri(et.id,dt,Ze,et.tags))}return de}function qr(Y,ie){var de=[];de.size=Y.size,Y.start!==void 0&&(de.start=Y.start,de.end=Y.end);for(var Ce=0;Ce<Y.length;Ce+=3)de.push(Y[Ce]+ie,Y[Ce+1],Y[Ce+2]);return de}function jn(Y,ie){if(Y.transformed)return Y;var de,Ce,Ze,et=1<<Y.z,dt=Y.x,be=Y.y;for(de=0;de<Y.features.length;de++){var He=Y.features[de],Rt=He.geometry,kr=He.type;if(He.geometry=[],kr===1)for(Ce=0;Ce<Rt.length;Ce+=2)He.geometry.push(Nn(Rt[Ce],Rt[Ce+1],ie,et,dt,be));else for(Ce=0;Ce<Rt.length;Ce++){var Xt=[];for(Ze=0;Ze<Rt[Ce].length;Ze+=2)Xt.push(Nn(Rt[Ce][Ze],Rt[Ce][Ze+1],ie,et,dt,be));He.geometry.push(Xt)}}return Y.transformed=!0,Y}function Nn(Y,ie,de,Ce,Ze,et){return[Math.round(de*(Y*Ce-Ze)),Math.round(de*(ie*Ce-et))]}function en(Y,ie,de,Ce,Ze){for(var et=ie===Ze.maxZoom?0:Ze.tolerance/((1<<ie)*Ze.extent),dt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:de,y:Ce,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},be=0;be<Y.length;be++){dt.numFeatures++,pi(dt,Y[be],et,Ze);var He=Y[be].minX,Rt=Y[be].minY,kr=Y[be].maxX,Xt=Y[be].maxY;He<dt.minX&&(dt.minX=He),Rt<dt.minY&&(dt.minY=Rt),kr>dt.maxX&&(dt.maxX=kr),Xt>dt.maxY&&(dt.maxY=Xt)}return dt}function pi(Y,ie,de,Ce){var Ze=ie.geometry,et=ie.type,dt=[];if(et==="Point"||et==="MultiPoint")for(var be=0;be<Ze.length;be+=3)dt.push(Ze[be]),dt.push(Ze[be+1]),Y.numPoints++,Y.numSimplified++;else if(et==="LineString")si(dt,Ze,Y,de,!1,!1);else if(et==="MultiLineString"||et==="Polygon")for(be=0;be<Ze.length;be++)si(dt,Ze[be],Y,de,et==="Polygon",be===0);else if(et==="MultiPolygon")for(var He=0;He<Ze.length;He++){var Rt=Ze[He];for(be=0;be<Rt.length;be++)si(dt,Rt[be],Y,de,!0,be===0)}if(dt.length){var kr=ie.tags||null;if(et==="LineString"&&Ce.lineMetrics){for(var Xt in kr={},ie.tags)kr[Xt]=ie.tags[Xt];kr.mapbox_clip_start=Ze.start/Ze.size,kr.mapbox_clip_end=Ze.end/Ze.size}var er={geometry:dt,type:et==="Polygon"||et==="MultiPolygon"?3:et==="LineString"||et==="MultiLineString"?2:1,tags:kr};ie.id!==null&&(er.id=ie.id),Y.features.push(er)}}function si(Y,ie,de,Ce,Ze,et){var dt=Ce*Ce;if(Ce>0&&ie.size<(Ze?dt:Ce))de.numPoints+=ie.length/3;else{for(var be=[],He=0;He<ie.length;He+=3)(Ce===0||ie[He+2]>dt)&&(de.numSimplified++,be.push(ie[He]),be.push(ie[He+1])),de.numPoints++;Ze&&function(Rt,kr){for(var Xt=0,er=0,Pr=Rt.length,Ln=Pr-2;er<Pr;Ln=er,er+=2)Xt+=(Rt[er]-Rt[Ln])*(Rt[er+1]+Rt[Ln+1]);if(Xt>0===kr)for(er=0,Pr=Rt.length;er<Pr/2;er+=2){var An=Rt[er],Ht=Rt[er+1];Rt[er]=Rt[Pr-2-er],Rt[er+1]=Rt[Pr-1-er],Rt[Pr-2-er]=An,Rt[Pr-1-er]=Ht}}(be,et),Y.push(be)}}function ra(Y,ie){var de=(ie=this.options=function(Ze,et){for(var dt in et)Ze[dt]=et[dt];return Ze}(Object.create(this.options),ie)).debug;if(de&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ce=function(Ze,et){var dt=[];if(Ze.type==="FeatureCollection")for(var be=0;be<Ze.features.length;be++)Ha(dt,Ze.features[be],et,be);else Ha(dt,Ze.type==="Feature"?Ze:{geometry:Ze},et);return dt}(Y,ie);this.tiles={},this.tileCoords=[],de&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Ce=function(Ze,et){var dt=et.buffer/et.extent,be=Ze,He=z(Ze,1,-1-dt,dt,0,-1,2,et),Rt=z(Ze,1,1-dt,2+dt,0,-1,2,et);return(He||Rt)&&(be=z(Ze,1,-dt,1+dt,0,-1,2,et)||[],He&&(be=Zr(He,1).concat(be)),Rt&&(be=be.concat(Zr(Rt,-1)))),be}(Ce,ie)).length&&this.splitTile(Ce,0,0,0),de&&(Ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Aa(Y,ie,de){return 32*((1<<Y)*de+ie)+Y}function va(Y,ie){var de=Y.tileID.canonical;if(!this._geoJSONIndex)return ie(null,null);var Ce=this._geoJSONIndex.getTile(de.z,de.x,de.y);if(!Ce)return ie(null,null);var Ze=new wt(Ce.features),et=Tt(Ze);et.byteOffset===0&&et.byteLength===et.buffer.byteLength||(et=new Uint8Array(et)),ie(null,{vectorTile:Ze,rawData:et.buffer})}Dr.prototype.load=function(Y){var ie=this.options,de=ie.log,Ce=ie.minZoom,Ze=ie.maxZoom,et=ie.nodeSize;de&&console.time("total time");var dt="prepare "+Y.length+" points";de&&console.time(dt),this.points=Y;for(var be=[],He=0;He<Y.length;He++)Y[He].geometry&&be.push(Zn(Y[He],He));this.trees[Ze+1]=new Qt(be,Ni,hi,et,Float32Array),de&&console.timeEnd(dt);for(var Rt=Ze;Rt>=Ce;Rt--){var kr=+Date.now();be=this._cluster(be,Rt),this.trees[Rt]=new Qt(be,Ni,hi,et,Float32Array),de&&console.log("z%d: %d clusters in %dms",Rt,be.length,+Date.now()-kr)}return de&&console.timeEnd("total time"),this},Dr.prototype.getClusters=function(Y,ie){var de=((Y[0]+180)%360+360)%360-180,Ce=Math.max(-90,Math.min(90,Y[1])),Ze=Y[2]===180?180:((Y[2]+180)%360+360)%360-180,et=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)de=-180,Ze=180;else if(de>Ze){var dt=this.getClusters([de,Ce,180,et],ie),be=this.getClusters([-180,Ce,Ze,et],ie);return dt.concat(be)}for(var He=this.trees[this._limitZoom(ie)],Rt=[],kr=0,Xt=He.range(Ci(de),fi(et),Ci(Ze),fi(Ce));kr<Xt.length;kr+=1){var er=He.points[Xt[kr]];Rt.push(er.numPoints?Vn(er):this.points[er.index])}return Rt},Dr.prototype.getChildren=function(Y){var ie=this._getOriginId(Y),de=this._getOriginZoom(Y),Ce="No cluster with the specified id.",Ze=this.trees[de];if(!Ze)throw new Error(Ce);var et=Ze.points[ie];if(!et)throw new Error(Ce);for(var dt=this.options.radius/(this.options.extent*Math.pow(2,de-1)),be=[],He=0,Rt=Ze.within(et.x,et.y,dt);He<Rt.length;He+=1){var kr=Ze.points[Rt[He]];kr.parentId===Y&&be.push(kr.numPoints?Vn(kr):this.points[kr.index])}if(be.length===0)throw new Error(Ce);return be},Dr.prototype.getLeaves=function(Y,ie,de){var Ce=[];return this._appendLeaves(Ce,Y,ie=ie||10,de=de||0,0),Ce},Dr.prototype.getTile=function(Y,ie,de){var Ce=this.trees[this._limitZoom(Y)],Ze=Math.pow(2,Y),et=this.options,dt=et.radius/et.extent,be=(de-dt)/Ze,He=(de+1+dt)/Ze,Rt={features:[]};return this._addTileFeatures(Ce.range((ie-dt)/Ze,be,(ie+1+dt)/Ze,He),Ce.points,ie,de,Ze,Rt),ie===0&&this._addTileFeatures(Ce.range(1-dt/Ze,be,1,He),Ce.points,Ze,de,Ze,Rt),ie===Ze-1&&this._addTileFeatures(Ce.range(0,be,dt/Ze,He),Ce.points,-1,de,Ze,Rt),Rt.features.length?Rt:null},Dr.prototype.getClusterExpansionZoom=function(Y){for(var ie=this._getOriginZoom(Y)-1;ie<=this.options.maxZoom;){var de=this.getChildren(Y);if(ie++,de.length!==1)break;Y=de[0].properties.cluster_id}return ie},Dr.prototype._appendLeaves=function(Y,ie,de,Ce,Ze){for(var et=0,dt=this.getChildren(ie);et<dt.length;et+=1){var be=dt[et],He=be.properties;if(He&&He.cluster?Ze+He.point_count<=Ce?Ze+=He.point_count:Ze=this._appendLeaves(Y,He.cluster_id,de,Ce,Ze):Ze<Ce?Ze++:Y.push(be),Y.length===de)break}return Ze},Dr.prototype._addTileFeatures=function(Y,ie,de,Ce,Ze,et){for(var dt=0,be=Y;dt<be.length;dt+=1){var He=ie[be[dt]],Rt=He.numPoints,kr={type:1,geometry:[[Math.round(this.options.extent*(He.x*Ze-de)),Math.round(this.options.extent*(He.y*Ze-Ce))]],tags:Rt?Xi(He):this.points[He.index].properties},Xt=void 0;Rt?Xt=He.id:this.options.generateId?Xt=He.index:this.points[He.index].id&&(Xt=this.points[He.index].id),Xt!==void 0&&(kr.id=Xt),et.features.push(kr)}},Dr.prototype._limitZoom=function(Y){return Math.max(this.options.minZoom,Math.min(+Y,this.options.maxZoom+1))},Dr.prototype._cluster=function(Y,ie){for(var de=[],Ce=this.options,Ze=Ce.reduce,et=Ce.minPoints,dt=Ce.radius/(Ce.extent*Math.pow(2,ie)),be=0;be<Y.length;be++){var He=Y[be];if(!(He.zoom<=ie)){He.zoom=ie;for(var Rt=this.trees[ie+1],kr=Rt.within(He.x,He.y,dt),Xt=He.numPoints||1,er=Xt,Pr=0,Ln=kr;Pr<Ln.length;Pr+=1){var An=Rt.points[Ln[Pr]];An.zoom>ie&&(er+=An.numPoints||1)}if(er>=et){for(var Ht=He.x*Xt,xn=He.y*Xt,sn=Ze&&Xt>1?this._map(He,!0):null,pn=(be<<5)+(ie+1)+this.points.length,bi=0,yn=kr;bi<yn.length;bi+=1){var Pi=Rt.points[yn[bi]];if(!(Pi.zoom<=ie)){Pi.zoom=ie;var aa=Pi.numPoints||1;Ht+=Pi.x*aa,xn+=Pi.y*aa,Pi.parentId=pn,Ze&&(sn||(sn=this._map(He,!0)),Ze(sn,this._map(Pi)))}}He.parentId=pn,de.push(oi(Ht/er,xn/er,pn,er,sn))}else if(de.push(He),er>1)for(var vt=0,yt=kr;vt<yt.length;vt+=1){var Ii=Rt.points[yt[vt]];Ii.zoom<=ie||(Ii.zoom=ie,de.push(Ii))}}}return de},Dr.prototype._getOriginId=function(Y){return Y-this.points.length>>5},Dr.prototype._getOriginZoom=function(Y){return(Y-this.points.length)%32},Dr.prototype._map=function(Y,ie){if(Y.numPoints)return ie?Hi({},Y.properties):Y.properties;var de=this.points[Y.index].properties,Ce=this.options.map(de);return ie&&Ce===de?Hi({},Ce):Ce},ra.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ra.prototype.splitTile=function(Y,ie,de,Ce,Ze,et,dt){for(var be=[Y,ie,de,Ce],He=this.options,Rt=He.debug;be.length;){Ce=be.pop(),de=be.pop(),ie=be.pop(),Y=be.pop();var kr=1<<ie,Xt=Aa(ie,de,Ce),er=this.tiles[Xt];if(!er&&(Rt>1&&console.time("creation"),er=this.tiles[Xt]=en(Y,ie,de,Ce,He),this.tileCoords.push({z:ie,x:de,y:Ce}),Rt)){Rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,de,Ce,er.numFeatures,er.numPoints,er.numSimplified),console.timeEnd("creation"));var Pr="z"+ie;this.stats[Pr]=(this.stats[Pr]||0)+1,this.total++}if(er.source=Y,Ze){if(ie===He.maxZoom||ie===Ze)continue;var Ln=1<<Ze-ie;if(de!==Math.floor(et/Ln)||Ce!==Math.floor(dt/Ln))continue}else if(ie===He.indexMaxZoom||er.numPoints<=He.indexMaxPoints)continue;if(er.source=null,Y.length!==0){Rt>1&&console.time("clipping");var An,Ht,xn,sn,pn,bi,yn=.5*He.buffer/He.extent,Pi=.5-yn,aa=.5+yn,vt=1+yn;An=Ht=xn=sn=null,pn=z(Y,kr,de-yn,de+aa,0,er.minX,er.maxX,He),bi=z(Y,kr,de+Pi,de+vt,0,er.minX,er.maxX,He),Y=null,pn&&(An=z(pn,kr,Ce-yn,Ce+aa,1,er.minY,er.maxY,He),Ht=z(pn,kr,Ce+Pi,Ce+vt,1,er.minY,er.maxY,He),pn=null),bi&&(xn=z(bi,kr,Ce-yn,Ce+aa,1,er.minY,er.maxY,He),sn=z(bi,kr,Ce+Pi,Ce+vt,1,er.minY,er.maxY,He),bi=null),Rt>1&&console.timeEnd("clipping"),be.push(An||[],ie+1,2*de,2*Ce),be.push(Ht||[],ie+1,2*de,2*Ce+1),be.push(xn||[],ie+1,2*de+1,2*Ce),be.push(sn||[],ie+1,2*de+1,2*Ce+1)}}},ra.prototype.getTile=function(Y,ie,de){var Ce=this.options,Ze=Ce.extent,et=Ce.debug;if(Y<0||Y>24)return null;var dt=1<<Y,be=Aa(Y,ie=(ie%dt+dt)%dt,de);if(this.tiles[be])return jn(this.tiles[be],Ze);et>1&&console.log("drilling down to z%d-%d-%d",Y,ie,de);for(var He,Rt=Y,kr=ie,Xt=de;!He&&Rt>0;)Rt--,kr=Math.floor(kr/2),Xt=Math.floor(Xt/2),He=this.tiles[Aa(Rt,kr,Xt)];return He&&He.source?(et>1&&console.log("found parent tile z%d-%d-%d",Rt,kr,Xt),et>1&&console.time("drilling down"),this.splitTile(He.source,Rt,kr,Xt,Y,ie,de),et>1&&console.timeEnd("drilling down"),this.tiles[be]?jn(this.tiles[be],Ze):null):null};var xa=function(Y){function ie(de,Ce,Ze,et){Y.call(this,de,Ce,Ze,va),et&&(this.loadGeoJSON=et)}return Y&&(ie.__proto__=Y),(ie.prototype=Object.create(Y&&Y.prototype)).constructor=ie,ie.prototype.loadData=function(de,Ce){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=Ce,this._pendingLoadDataParams=de,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ie.prototype._loadData=function(){var de=this;if(this._pendingCallback&&this._pendingLoadDataParams){var Ce=this._pendingCallback,Ze=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var et=!!(Ze&&Ze.request&&Ze.request.collectResourceTiming)&&new y.RequestPerformance(Ze.request);this.loadGeoJSON(Ze,function(dt,be){if(dt||!be)return Ce(dt);if(typeof be!="object")return Ce(new Error("Input data given to '"+Ze.source+"' is not a valid GeoJSON object."));(function er(Pr,Ln){var An,Ht=Pr&&Pr.type;if(Ht==="FeatureCollection")for(An=0;An<Pr.features.length;An++)er(Pr.features[An],Ln);else if(Ht==="GeometryCollection")for(An=0;An<Pr.geometries.length;An++)er(Pr.geometries[An],Ln);else if(Ht==="Feature")er(Pr.geometry,Ln);else if(Ht==="Polygon")ar(Pr.coordinates,Ln);else if(Ht==="MultiPolygon")for(An=0;An<Pr.coordinates.length;An++)ar(Pr.coordinates[An],Ln);return Pr})(be,!0);try{if(Ze.filter){var He=y.createExpression(Ze.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(He.result==="error")throw new Error(He.value.map(function(er){return er.key+": "+er.message}).join(", "));var Rt=be.features.filter(function(er){return He.value.evaluate({zoom:0},er)});be={type:"FeatureCollection",features:Rt}}de._geoJSONIndex=Ze.cluster?new Dr(function(er){var Pr=er.superclusterOptions,Ln=er.clusterProperties;if(!Ln||!Pr)return Pr;for(var An={},Ht={},xn={accumulated:null,zoom:0},sn={properties:null},pn=Object.keys(Ln),bi=0,yn=pn;bi<yn.length;bi+=1){var Pi=yn[bi],aa=Ln[Pi],vt=aa[0],yt=y.createExpression(aa[1]),Ii=y.createExpression(typeof vt=="string"?[vt,["accumulated"],["get",Pi]]:vt);An[Pi]=yt.value,Ht[Pi]=Ii.value}return Pr.map=function(ui){sn.properties=ui;for(var Qi={},Ji=0,oa=pn;Ji<oa.length;Ji+=1){var Ri=oa[Ji];Qi[Ri]=An[Ri].evaluate(xn,sn)}return Qi},Pr.reduce=function(ui,Qi){sn.properties=Qi;for(var Ji=0,oa=pn;Ji<oa.length;Ji+=1){var Ri=oa[Ji];xn.accumulated=ui[Ri],ui[Ri]=Ht[Ri].evaluate(xn,sn)}},Pr}(Ze)).load(be.features):function(er,Pr){return new ra(er,Pr)}(be,Ze.geojsonVtOptions)}catch(er){return Ce(er)}de.loaded={};var kr={};if(et){var Xt=et.finish();Xt&&(kr.resourceTiming={},kr.resourceTiming[Ze.source]=JSON.parse(JSON.stringify(Xt)))}Ce(null,kr)})}},ie.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ie.prototype.reloadTile=function(de,Ce){var Ze=this.loaded;return Ze&&Ze[de.uid]?Y.prototype.reloadTile.call(this,de,Ce):this.loadTile(de,Ce)},ie.prototype.loadGeoJSON=function(de,Ce){if(de.request)y.getJSON(de.request,Ce);else{if(typeof de.data!="string")return Ce(new Error("Input data given to '"+de.source+"' is not a valid GeoJSON object."));try{return Ce(null,JSON.parse(de.data))}catch(Ze){return Ce(new Error("Input data given to '"+de.source+"' is not a valid GeoJSON object."))}}},ie.prototype.removeSource=function(de,Ce){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Ce()},ie.prototype.getClusterExpansionZoom=function(de,Ce){try{Ce(null,this._geoJSONIndex.getClusterExpansionZoom(de.clusterId))}catch(Ze){Ce(Ze)}},ie.prototype.getClusterChildren=function(de,Ce){try{Ce(null,this._geoJSONIndex.getChildren(de.clusterId))}catch(Ze){Ce(Ze)}},ie.prototype.getClusterLeaves=function(de,Ce){try{Ce(null,this._geoJSONIndex.getLeaves(de.clusterId,de.limit,de.offset))}catch(Ze){Ce(Ze)}},ie}(ot),Ki=function(Y){var ie=this;this.self=Y,this.actor=new y.Actor(Y,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ot,geojson:xa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(de,Ce){if(ie.workerSourceTypes[de])throw new Error('Worker source with name "'+de+'" already registered.');ie.workerSourceTypes[de]=Ce},this.self.registerRTLTextPlugin=function(de){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=de.applyArabicShaping,y.plugin.processBidirectionalText=de.processBidirectionalText,y.plugin.processStyledBidirectionalText=de.processStyledBidirectionalText}};return Ki.prototype.setReferrer=function(Y,ie){this.referrer=ie},Ki.prototype.setImages=function(Y,ie,de){for(var Ce in this.availableImages[Y]=ie,this.workerSources[Y]){var Ze=this.workerSources[Y][Ce];for(var et in Ze)Ze[et].availableImages=ie}de()},Ki.prototype.setLayers=function(Y,ie,de){this.getLayerIndex(Y).replace(ie),de()},Ki.prototype.updateLayers=function(Y,ie,de){this.getLayerIndex(Y).update(ie.layers,ie.removedIds),de()},Ki.prototype.loadTile=function(Y,ie,de){this.getWorkerSource(Y,ie.type,ie.source).loadTile(ie,de)},Ki.prototype.loadDEMTile=function(Y,ie,de){this.getDEMWorkerSource(Y,ie.source).loadTile(ie,de)},Ki.prototype.reloadTile=function(Y,ie,de){this.getWorkerSource(Y,ie.type,ie.source).reloadTile(ie,de)},Ki.prototype.abortTile=function(Y,ie,de){this.getWorkerSource(Y,ie.type,ie.source).abortTile(ie,de)},Ki.prototype.removeTile=function(Y,ie,de){this.getWorkerSource(Y,ie.type,ie.source).removeTile(ie,de)},Ki.prototype.removeDEMTile=function(Y,ie){this.getDEMWorkerSource(Y,ie.source).removeTile(ie)},Ki.prototype.removeSource=function(Y,ie,de){if(this.workerSources[Y]&&this.workerSources[Y][ie.type]&&this.workerSources[Y][ie.type][ie.source]){var Ce=this.workerSources[Y][ie.type][ie.source];delete this.workerSources[Y][ie.type][ie.source],Ce.removeSource!==void 0?Ce.removeSource(ie,de):de()}},Ki.prototype.loadWorkerSource=function(Y,ie,de){try{this.self.importScripts(ie.url),de()}catch(Ce){de(Ce.toString())}},Ki.prototype.syncRTLPluginState=function(Y,ie,de){try{y.plugin.setState(ie);var Ce=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&Ce!=null){this.self.importScripts(Ce);var Ze=y.plugin.isParsed();de(Ze?void 0:new Error("RTL Text Plugin failed to import scripts from "+Ce),Ze)}}catch(et){de(et.toString())}},Ki.prototype.getAvailableImages=function(Y){var ie=this.availableImages[Y];return ie||(ie=[]),ie},Ki.prototype.getLayerIndex=function(Y){var ie=this.layerIndexes[Y];return ie||(ie=this.layerIndexes[Y]=new ce),ie},Ki.prototype.getWorkerSource=function(Y,ie,de){var Ce=this;return this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][ie]||(this.workerSources[Y][ie]={}),this.workerSources[Y][ie][de]||(this.workerSources[Y][ie][de]=new this.workerSourceTypes[ie]({send:function(Ze,et,dt){Ce.actor.send(Ze,et,dt,Y)}},this.getLayerIndex(Y),this.getAvailableImages(Y))),this.workerSources[Y][ie][de]},Ki.prototype.getDEMWorkerSource=function(Y,ie){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][ie]||(this.demWorkerSources[Y][ie]=new kt),this.demWorkerSources[Y][ie]},Ki.prototype.enforceCacheSizeLimit=function(Y,ie){y.enforceCacheSizeLimit(ie)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ki(self)),Ki}),J(["./shared"],function(y){"use strict";var Ae=y.createCommonjsModule(function(f){function d(S){return!h(S)}function h(S){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var k,F,G=new Blob([""],{type:"text/javascript"}),X=URL.createObjectURL(G);try{F=new Worker(X),k=!0}catch(ue){k=!1}return F&&F.terminate(),URL.revokeObjectURL(X),k}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var k=document.createElement("canvas");k.width=k.height=1;var F=k.getContext("2d");if(!F)return!1;var G=F.getImageData(0,0,1,1);return G&&G.width===k.width}()?(g[M=S&&S.failIfMajorPerformanceCaveat]===void 0&&(g[M]=function(k){var F=function(X){var ue=document.createElement("canvas"),Ee=Object.create(d.webGLContextAttributes);return Ee.failIfMajorPerformanceCaveat=X,ue.probablySupportsContext?ue.probablySupportsContext("webgl",Ee)||ue.probablySupportsContext("experimental-webgl",Ee):ue.supportsContext?ue.supportsContext("webgl",Ee)||ue.supportsContext("experimental-webgl",Ee):ue.getContext("webgl",Ee)||ue.getContext("experimental-webgl",Ee)}(k);if(!F)return!1;var G=F.createShader(F.VERTEX_SHADER);return!(!G||F.isContextLost())&&(F.shaderSource(G,"void main() {}"),F.compileShader(G),F.getShaderParameter(G,F.COMPILE_STATUS)===!0)}(M)),g[M]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var M}f.exports?f.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d,window.mapboxgl.notSupportedReason=h);var g={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),T={create:function(f,d,h){var g=y.window.document.createElement(f);return d!==void 0&&(g.className=d),h&&h.appendChild(g),g},createNS:function(f,d){return y.window.document.createElementNS(f,d)}},ce=y.window.document&&y.window.document.documentElement.style;function pe(f){if(!ce)return f[0];for(var d=0;d<f.length;d++)if(f[d]in ce)return f[d];return f[0]}var Fe,_e=pe(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);T.disableDrag=function(){ce&&_e&&(Fe=ce[_e],ce[_e]="none")},T.enableDrag=function(){ce&&_e&&(ce[_e]=Fe)};var Ge=pe(["transform","WebkitTransform"]);T.setTransform=function(f,d){f.style[Ge]=d};var ot=!1;try{var ft=Object.defineProperty({},"passive",{get:function(){ot=!0}});y.window.addEventListener("test",ft,ft),y.window.removeEventListener("test",ft,ft)}catch(f){ot=!1}T.addEventListener=function(f,d,h,g){g===void 0&&(g={}),f.addEventListener(d,h,"passive"in g&&ot?g:g.capture)},T.removeEventListener=function(f,d,h,g){g===void 0&&(g={}),f.removeEventListener(d,h,"passive"in g&&ot?g:g.capture)};var kt=function(f){f.preventDefault(),f.stopPropagation(),y.window.removeEventListener("click",kt,!0)};function ar(f){var d=f.userImage;return!!(d&&d.render&&d.render())&&(f.data.replace(new Uint8Array(d.data.buffer)),!0)}T.suppressClick=function(){y.window.addEventListener("click",kt,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",kt,!0)},0)},T.mousePos=function(f,d){var h=f.getBoundingClientRect();return new y.Point(d.clientX-h.left-f.clientLeft,d.clientY-h.top-f.clientTop)},T.touchPos=function(f,d){for(var h=f.getBoundingClientRect(),g=[],S=0;S<d.length;S++)g.push(new y.Point(d[S].clientX-h.left-f.clientLeft,d[S].clientY-h.top-f.clientTop));return g},T.mouseButton=function(f){return y.window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button},T.remove=function(f){f.parentNode&&f.parentNode.removeChild(f)};var xt=function(f){function d(){f.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(h){if(this.loaded!==h&&(this.loaded=h,h)){for(var g=0,S=this.requestors;g<S.length;g+=1){var M=S[g];this._notify(M.ids,M.callback)}this.requestors=[]}},d.prototype.getImage=function(h){return this.images[h]},d.prototype.addImage=function(h,g){this._validate(h,g)&&(this.images[h]=g)},d.prototype._validate=function(h,g){var S=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchX" value'))),S=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchY" value'))),S=!1),this._validateContent(g.content,g)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "content" value'))),S=!1),S},d.prototype._validateStretch=function(h,g){if(!h)return!0;for(var S=0,M=0,k=h;M<k.length;M+=1){var F=k[M];if(F[0]<S||F[1]<F[0]||g<F[1])return!1;S=F[1]}return!0},d.prototype._validateContent=function(h,g){return!(h&&(h.length!==4||h[0]<0||g.data.width<h[0]||h[1]<0||g.data.height<h[1]||h[2]<0||g.data.width<h[2]||h[3]<0||g.data.height<h[3]||h[2]<h[0]||h[3]<h[1]))},d.prototype.updateImage=function(h,g){g.version=this.images[h].version+1,this.images[h]=g,this.updatedImages[h]=!0},d.prototype.removeImage=function(h){var g=this.images[h];delete this.images[h],delete this.patterns[h],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(h,g){var S=!0;if(!this.isLoaded())for(var M=0,k=h;M<k.length;M+=1)this.images[k[M]]||(S=!1);this.isLoaded()||S?this._notify(h,g):this.requestors.push({ids:h,callback:g})},d.prototype._notify=function(h,g){for(var S={},M=0,k=h;M<k.length;M+=1){var F=k[M];this.images[F]||this.fire(new y.Event("styleimagemissing",{id:F}));var G=this.images[F];G?S[F]={data:G.data.clone(),pixelRatio:G.pixelRatio,sdf:G.sdf,version:G.version,stretchX:G.stretchX,stretchY:G.stretchY,content:G.content,hasRenderCallback:Boolean(G.userImage&&G.userImage.render)}:y.warnOnce('Image "'+F+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,S)},d.prototype.getPixelSize=function(){var h=this.atlasImage;return{width:h.width,height:h.height}},d.prototype.getPattern=function(h){var g=this.patterns[h],S=this.getImage(h);if(!S)return null;if(g&&g.position.version===S.version)return g.position;if(g)g.position.version=S.version;else{var M={w:S.data.width+2,h:S.data.height+2,x:0,y:0},k=new y.ImagePosition(M,S);this.patterns[h]={bin:M,position:k}}return this._updatePatternAtlas(),this.patterns[h].position},d.prototype.bind=function(h){var g=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(h,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var h=[];for(var g in this.patterns)h.push(this.patterns[g].bin);var S=y.potpack(h),M=S.w,k=S.h,F=this.atlasImage;for(var G in F.resize({width:M||1,height:k||1}),this.patterns){var X=this.patterns[G].bin,ue=X.x+1,Ee=X.y+1,te=this.images[G].data,je=te.width,ze=te.height;y.RGBAImage.copy(te,F,{x:0,y:0},{x:ue,y:Ee},{width:je,height:ze}),y.RGBAImage.copy(te,F,{x:0,y:ze-1},{x:ue,y:Ee-1},{width:je,height:1}),y.RGBAImage.copy(te,F,{x:0,y:0},{x:ue,y:Ee+ze},{width:je,height:1}),y.RGBAImage.copy(te,F,{x:je-1,y:0},{x:ue-1,y:Ee},{width:1,height:ze}),y.RGBAImage.copy(te,F,{x:0,y:0},{x:ue+je,y:Ee},{width:1,height:ze})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(h){for(var g=0,S=h;g<S.length;g+=1){var M=S[g];if(!this.callbackDispatchedThisFrame[M]){this.callbackDispatchedThisFrame[M]=!0;var k=this.images[M];ar(k)&&this.updateImage(M,k)}}},d}(y.Evented),Jt=Bt,Gt=Bt,wt=1e20;function Bt(f,d,h,g,S,M){this.fontSize=f||24,this.buffer=d===void 0?3:d,this.cutoff=g||.25,this.fontFamily=S||"sans-serif",this.fontWeight=M||"normal",this.radius=h||8;var k=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=k,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(k*k),this.gridInner=new Float64Array(k*k),this.f=new Float64Array(k),this.d=new Float64Array(k),this.z=new Float64Array(k+1),this.v=new Int16Array(k),this.middle=Math.round(k/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function gr(f,d,h,g,S,M,k){for(var F=0;F<d;F++){for(var G=0;G<h;G++)g[G]=f[G*d+F];for(K(g,S,M,k,h),G=0;G<h;G++)f[G*d+F]=S[G]}for(G=0;G<h;G++){for(F=0;F<d;F++)g[F]=f[G*d+F];for(K(g,S,M,k,d),F=0;F<d;F++)f[G*d+F]=Math.sqrt(S[F])}}function K(f,d,h,g,S){h[0]=0,g[0]=-wt,g[1]=+wt;for(var M=1,k=0;M<S;M++){for(var F=(f[M]+M*M-(f[h[k]]+h[k]*h[k]))/(2*M-2*h[k]);F<=g[k];)k--,F=(f[M]+M*M-(f[h[k]]+h[k]*h[k]))/(2*M-2*h[k]);h[++k]=M,g[k]=F,g[k+1]=+wt}for(M=0,k=0;M<S;M++){for(;g[k+1]<M;)k++;d[M]=(M-h[k])*(M-h[k])+f[h[k]]}}Bt.prototype.draw=function(f){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(f,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),h=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var S=d.data[4*g+3]/255;this.gridOuter[g]=S===1?0:S===0?wt:Math.pow(Math.max(0,.5-S),2),this.gridInner[g]=S===1?wt:S===0?0:Math.pow(Math.max(0,S-.5),2)}for(gr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),gr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)h[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return h},Jt.default=Gt;var ur=function(f,d){this.requestManager=f,this.localIdeographFontFamily=d,this.entries={}};ur.prototype.setURL=function(f){this.url=f},ur.prototype.getGlyphs=function(f,d){var h=this,g=[];for(var S in f)for(var M=0,k=f[S];M<k.length;M+=1)g.push({stack:S,id:k[M]});y.asyncAll(g,function(F,G){var X=F.stack,ue=F.id,Ee=h.entries[X];Ee||(Ee=h.entries[X]={glyphs:{},requests:{},ranges:{}});var te=Ee.glyphs[ue];if(te===void 0){if(te=h._tinySDF(Ee,X,ue))return Ee.glyphs[ue]=te,void G(null,{stack:X,id:ue,glyph:te});var je=Math.floor(ue/256);if(256*je>65535)G(new Error("glyphs > 65535 not supported"));else if(Ee.ranges[je])G(null,{stack:X,id:ue,glyph:te});else{var ze=Ee.requests[je];ze||(ze=Ee.requests[je]=[],ur.loadGlyphRange(X,je,h.url,h.requestManager,function(nt,Be){if(Be){for(var rt in Be)h._doesCharSupportLocalGlyph(+rt)||(Ee.glyphs[+rt]=Be[+rt]);Ee.ranges[je]=!0}for(var mt=0,Dt=ze;mt<Dt.length;mt+=1)(0,Dt[mt])(nt,Be);delete Ee.requests[je]})),ze.push(function(nt,Be){nt?G(nt):Be&&G(null,{stack:X,id:ue,glyph:Be[ue]||null})})}}else G(null,{stack:X,id:ue,glyph:te})},function(F,G){if(F)d(F);else if(G){for(var X={},ue=0,Ee=G;ue<Ee.length;ue+=1){var te=Ee[ue],je=te.stack,ze=te.id,nt=te.glyph;(X[je]||(X[je]={}))[ze]=nt&&{id:nt.id,bitmap:nt.bitmap.clone(),metrics:nt.metrics}}d(null,X)}})},ur.prototype._doesCharSupportLocalGlyph=function(f){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](f)||y.isChar["Hangul Syllables"](f)||y.isChar.Hiragana(f)||y.isChar.Katakana(f))},ur.prototype._tinySDF=function(f,d,h){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(h)){var S=f.tinySDF;if(!S){var M="400";/bold/i.test(d)?M="900":/medium/i.test(d)?M="500":/light/i.test(d)&&(M="200"),S=f.tinySDF=new ur.TinySDF(24,3,8,.25,g,M)}return{id:h,bitmap:new y.AlphaImage({width:30,height:30},S.draw(String.fromCharCode(h))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},ur.loadGlyphRange=function(f,d,h,g,S){var M=256*d,k=M+255,F=g.transformRequest(g.normalizeGlyphsURL(h).replace("{fontstack}",f).replace("{range}",M+"-"+k),y.ResourceType.Glyphs);y.getArrayBuffer(F,function(G,X){if(G)S(G);else if(X){for(var ue={},Ee=0,te=y.parseGlyphPBF(X);Ee<te.length;Ee+=1){var je=te[Ee];ue[je.id]=je}S(null,ue)}})},ur.TinySDF=Jt;var Tt=function(){this.specification=y.styleSpec.light.position};Tt.prototype.possiblyEvaluate=function(f,d){return y.sphericalToCartesian(f.expression.evaluate(d))},Tt.prototype.interpolate=function(f,d,h){return{x:y.number(f.x,d.x,h),y:y.number(f.y,d.y,h),z:y.number(f.z,d.z,h)}};var ht=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new Tt,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),Ot=function(f){function d(h){f.call(this),this._transitionable=new y.Transitionable(ht),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(h,g){if(g===void 0&&(g={}),!this._validate(y.validateLight,h,g))for(var S in h){var M=h[S];y.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-"-transition".length),M):this._transitionable.setValue(S,M)}},d.prototype.updateTransitions=function(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(h){this.properties=this._transitioning.possiblyEvaluate(h)},d.prototype._validate=function(h,g,S){return(!S||S.validate!==!1)&&y.emitValidationErrors(this,h.call(y.validateStyle,y.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},d}(y.Evented),pt=function(f,d){this.width=f,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};pt.prototype.getDash=function(f,d){var h=f.join(",")+String(d);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(f,d)),this.dashEntry[h]},pt.prototype.getDashRanges=function(f,d,h){var g=[],S=f.length%2==1?-f[f.length-1]*h:0,M=f[0]*h,k=!0;g.push({left:S,right:M,isDash:k,zeroLength:f[0]===0});for(var F=f[0],G=1;G<f.length;G++){var X=f[G];g.push({left:S=F*h,right:M=(F+=X)*h,isDash:k=!k,zeroLength:X===0})}return g},pt.prototype.addRoundDash=function(f,d,h){for(var g=d/2,S=-h;S<=h;S++)for(var M=this.width*(this.nextRow+h+S),k=0,F=f[k],G=0;G<this.width;G++){G/F.right>1&&(F=f[++k]);var X=Math.abs(G-F.left),ue=Math.abs(G-F.right),Ee=Math.min(X,ue),te=void 0,je=S/h*(g+1);if(F.isDash){var ze=g-Math.abs(je);te=Math.sqrt(Ee*Ee+ze*ze)}else te=g-Math.sqrt(Ee*Ee+je*je);this.data[M+G]=Math.max(0,Math.min(255,te+128))}},pt.prototype.addRegularDash=function(f){for(var d=f.length-1;d>=0;--d){var h=f[d],g=f[d+1];h.zeroLength?f.splice(d,1):g&&g.isDash===h.isDash&&(g.left=h.left,f.splice(d,1))}var S=f[0],M=f[f.length-1];S.isDash===M.isDash&&(S.left=M.left-this.width,M.right=S.right+this.width);for(var k=this.width*this.nextRow,F=0,G=f[F],X=0;X<this.width;X++){X/G.right>1&&(G=f[++F]);var ue=Math.abs(X-G.left),Ee=Math.abs(X-G.right),te=Math.min(ue,Ee);this.data[k+X]=Math.max(0,Math.min(255,(G.isDash?te:-te)+128))}},pt.prototype.addDash=function(f,d){var h=d?7:0,g=2*h+1;if(this.nextRow+g>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var S=0,M=0;M<f.length;M++)S+=f[M];if(S!==0){var k=this.width/S,F=this.getDashRanges(f,this.width,k);d?this.addRoundDash(F,k,h):this.addRegularDash(F)}var G={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:S};return this.nextRow+=g,this.dirty=!0,G},pt.prototype.bind=function(f){var d=f.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var lr=function f(d,h){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var g=this.workerPool.acquire(this.id),S=0;S<g.length;S++){var M=new f.Actor(g[S],h,this.id);M.name="Worker "+S,this.actors.push(M)}};function Br(f,d,h){var g=function(S,M){if(S)return h(S);if(M){var k=y.pick(y.extend(M,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(k.vectorLayers=M.vector_layers,k.vectorLayerIds=k.vectorLayers.map(function(F){return F.id})),k.tiles=d.canonicalizeTileset(k,f.url),h(null,k)}};return f.url?y.getJSON(d.transformRequest(d.normalizeSourceURL(f.url),y.ResourceType.Source),g):y.browser.frame(function(){return g(null,f)})}lr.prototype.broadcast=function(f,d,h){y.asyncAll(this.actors,function(g,S){g.send(f,d,S)},h=h||function(){})},lr.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},lr.prototype.remove=function(){this.actors.forEach(function(f){f.remove()}),this.actors=[],this.workerPool.release(this.id)},lr.Actor=y.Actor;var q=function(f,d,h){this.bounds=y.LngLatBounds.convert(this.validateBounds(f)),this.minzoom=d||0,this.maxzoom=h||24};q.prototype.validateBounds=function(f){return Array.isArray(f)&&f.length===4?[Math.max(-180,f[0]),Math.max(-90,f[1]),Math.min(180,f[2]),Math.min(90,f[3])]:[-180,-90,180,90]},q.prototype.contains=function(f){var d=Math.pow(2,f.z),h=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*d),g=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*d),S=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*d),M=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*d);return f.x>=h&&f.x<S&&f.y>=g&&f.y<M};var ge=function(f){function d(h,g,S,M){if(f.call(this),this.id=h,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(g,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(M)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Br(this._options,this.map._requestManager,function(g,S){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new y.ErrorEvent(g)):S&&(y.extend(h,S),S.bounds&&(h.tileBounds=new q(S.bounds,h.minzoom,h.maxzoom)),y.postTurnstileEvent(S.tiles,h.map._requestManager._customAccessToken),y.postMapLoadEvent(S.tiles,h.map._getMapId(),h.map._requestManager._skuToken,h.map._requestManager._customAccessToken),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setSourceProperty=function(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},d.prototype.setTiles=function(h){var g=this;return this.setSourceProperty(function(){g._options.tiles=h}),this},d.prototype.setUrl=function(h){var g=this;return this.setSourceProperty(function(){g.url=h,g._options.url=h}),this},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return y.extend({},this._options)},d.prototype.loadTile=function(h,g){var S=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),M={request:this.map._requestManager.transformRequest(S,y.ResourceType.Tile),uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function k(F,G){return delete h.request,h.aborted?g(null):F&&F.status!==404?g(F):(G&&G.resourceTiming&&(h.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&h.setExpiryData(G),h.loadVectorData(G,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}M.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired"?h.state==="loading"?h.reloadCallback=g:h.request=h.actor.send("reloadTile",M,k.bind(this)):(h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",M,k.bind(this)))},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d}(y.Evented),Q=function(f){function d(h,g,S,M){f.call(this),this.id=h,this.dispatcher=S,this.setEventedParent(M),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},g),y.extend(this,y.pick(g,["url","scheme","tileSize"]))}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Br(this._options,this.map._requestManager,function(g,S){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new y.ErrorEvent(g)):S&&(y.extend(h,S),S.bounds&&(h.tileBounds=new q(S.bounds,h.minzoom,h.maxzoom)),y.postTurnstileEvent(S.tiles),y.postMapLoadEvent(S.tiles,h.map._getMapId(),h.map._requestManager._skuToken),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return y.extend({},this._options)},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.loadTile=function(h,g){var S=this,M=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);h.request=y.getImage(this.map._requestManager.transformRequest(M,y.ResourceType.Tile),function(k,F){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(k)h.state="errored",g(k);else if(F){S.map._refreshExpiredTiles&&h.setExpiryData(F),delete F.cacheControl,delete F.expires;var G=S.map.painter.context,X=G.gl;h.texture=S.map.painter.getTileTexture(F.width),h.texture?h.texture.update(F,{useMipmap:!0}):(h.texture=new y.Texture(G,F,X.RGBA,{useMipmap:!0}),h.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),G.extTextureFilterAnisotropic&&X.texParameterf(X.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax)),h.state="loaded",y.cacheEntryPossiblyAdded(S.dispatcher),g(null)}})},d.prototype.abortTile=function(h,g){h.request&&(h.request.cancel(),delete h.request),g()},d.prototype.unloadTile=function(h,g){h.texture&&this.map.painter.saveTileTexture(h.texture),g()},d.prototype.hasTransition=function(){return!1},d}(y.Evented),Me=function(f){function d(h,g,S,M){f.call(this,h,g,S,M),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(h,g){var S=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function M(k,F){k&&(h.state="errored",g(k)),F&&(h.dem=F,h.needsHillshadePrepare=!0,h.state="loaded",g(null))}h.request=y.getImage(this.map._requestManager.transformRequest(S,y.ResourceType.Tile),function(k,F){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(k)h.state="errored",g(k);else if(F){this.map._refreshExpiredTiles&&h.setExpiryData(F),delete F.cacheControl,delete F.expires;var G=y.window.ImageBitmap&&F instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?F:y.browser.getImageData(F,1),X={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:G,encoding:this.encoding};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",X,M.bind(this)))}}.bind(this)),h.neighboringTiles=this._getNeighboringTiles(h.tileID)},d.prototype._getNeighboringTiles=function(h){var g=h.canonical,S=Math.pow(2,g.z),M=(g.x-1+S)%S,k=g.x===0?h.wrap-1:h.wrap,F=(g.x+1+S)%S,G=g.x+1===S?h.wrap+1:h.wrap,X={};return X[new y.OverscaledTileID(h.overscaledZ,k,g.z,M,g.y).key]={backfilled:!1},X[new y.OverscaledTileID(h.overscaledZ,G,g.z,F,g.y).key]={backfilled:!1},g.y>0&&(X[new y.OverscaledTileID(h.overscaledZ,k,g.z,M,g.y-1).key]={backfilled:!1},X[new y.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},X[new y.OverscaledTileID(h.overscaledZ,G,g.z,F,g.y-1).key]={backfilled:!1}),g.y+1<S&&(X[new y.OverscaledTileID(h.overscaledZ,k,g.z,M,g.y+1).key]={backfilled:!1},X[new y.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},X[new y.OverscaledTileID(h.overscaledZ,G,g.z,F,g.y+1).key]={backfilled:!1}),X},d.prototype.unloadTile=function(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded",h.actor&&h.actor.send("removeDEMTile",{uid:h.uid,source:this.id})},d}(Q),ee=function(f){function d(h,g,S,M){f.call(this),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(M),this._data=g.data,this._options=y.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var k=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*k,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*k,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:y.EXTENT,radius:(g.clusterRadius||50)*k,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new y.ErrorEvent(g));else{var S={dataType:"source",sourceDataType:"metadata"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(S.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new y.Event("data",S))}})},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setData=function(h){var g=this;return this._data=h,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(S){if(S)g.fire(new y.ErrorEvent(S));else{var M={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(M.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new y.Event("data",M))}}),this},d.prototype.getClusterExpansionZoom=function(h,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},g),this},d.prototype.getClusterChildren=function(h,g){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},g),this},d.prototype.getClusterLeaves=function(h,g,S,M){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:g,offset:S},M),this},d.prototype._updateWorkerData=function(h){var g=this;this._loaded=!1;var S=y.extend({},this.workerOptions),M=this._data;typeof M=="string"?(S.request=this.map._requestManager.transformRequest(y.browser.resolveURL(M),y.ResourceType.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(M),this.actor.send(this.type+".loadData",S,function(k,F){g._removed||F&&F.abandoned||(g._loaded=!0,F&&F.resourceTiming&&F.resourceTiming[g.id]&&(g._resourceTiming=F.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:S.source},null),h(k))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(h,g){var S=this,M=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(M,{type:this.type,uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(k,F){return delete h.request,h.unloadVectorData(),h.aborted?g(null):k?g(k):(h.loadVectorData(F,S.map.painter,M==="reloadTile"),g(null))})},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0},d.prototype.unloadTile=function(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d}(y.Evented),oe=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),bt=function(f){function d(h,g,S,M){f.call(this),this.id=h,this.dispatcher=S,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(M),this.options=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(h,g){var S=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(M,k){S._loaded=!0,M?S.fire(new y.ErrorEvent(M)):k&&(S.image=k,h&&(S.coordinates=h),g&&g(),S._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(h){var g=this;return this.image&&h.url?(this.options.url=h.url,this.load(h.coordinates,function(){g.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setCoordinates=function(h){var g=this;this.coordinates=h;var S=h.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(k){for(var F=1/0,G=1/0,X=-1/0,ue=-1/0,Ee=0,te=k;Ee<te.length;Ee+=1){var je=te[Ee];F=Math.min(F,je.x),G=Math.min(G,je.y),X=Math.max(X,je.x),ue=Math.max(ue,je.y)}var ze=Math.max(X-F,ue-G),nt=Math.max(0,Math.floor(-Math.log(ze)/Math.LN2)),Be=Math.pow(2,nt);return new y.CanonicalTileID(nt,Math.floor((F+X)/2*Be),Math.floor((G+ue)/2*Be))}(S),this.minzoom=this.maxzoom=this.tileID.z;var M=S.map(function(k){return g.tileID.getTilePoint(k)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(M[0].x,M[0].y,0,0),this._boundsArray.emplaceBack(M[1].x,M[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(M[3].x,M[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(M[2].x,M[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var h=this.map.painter.context,g=h.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,oe.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(h,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var M=this.tiles[S];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},d.prototype.loadTile=function(h,g){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},g(null)):(h.state="errored",g(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d}(y.Evented),Nt=function(f){function d(h,g,S,M){f.call(this,h,g,S,M),this.roundZoom=!0,this.type="video",this.options=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1;var g=this.options;this.urls=[];for(var S=0,M=g.urls;S<M.length;S+=1)this.urls.push(this.map._requestManager.transformRequest(M[S],y.ResourceType.Source).url);y.getVideo(this.urls,function(k,F){h._loaded=!0,k?h.fire(new y.ErrorEvent(k)):F&&(h.video=F,h.video.loop=!0,h.video.addEventListener("playing",function(){h.map.triggerRepaint()}),h.map&&h.video.play(),h._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(h){if(this.video){var g=this.video.seekable;h<g.start(0)||h>g.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=h}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var h=this.map.painter.context,g=h.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,oe.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(h,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var M=this.tiles[S];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d}(bt),jt=function(f){function d(h,g,S,M){f.call(this,h,g,S,M),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(k){return!Array.isArray(k)||k.length!==2||k.some(function(F){return typeof F!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,S=g.gl;for(var M in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,oe.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(g,this.canvas,S.RGBA,{premultiply:!0}),this.tiles){var k=this.tiles[M];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var h=0,g=[this.canvas.width,this.canvas.height];h<g.length;h+=1){var S=g[h];if(isNaN(S)||S<=0)return!0}return!1},d}(bt),Qt={vector:ge,raster:Q,"raster-dem":Me,geojson:ee,video:Nt,image:bt,canvas:jt};function ln(f,d){var h=y.identity([]);return y.translate(h,h,[1,1,0]),y.scale(h,h,[.5*f.width,.5*f.height,1]),y.multiply(h,h,f.calculatePosMatrix(d.toUnwrapped()))}function Dr(f,d,h,g,S,M){var k=function(nt,Be,rt){if(nt)for(var mt=0,Dt=nt;mt<Dt.length;mt+=1){var fr=Be[Dt[mt]];if(fr&&fr.source===rt&&fr.type==="fill-extrusion")return!0}else for(var nr in Be){var dr=Be[nr];if(dr.source===rt&&dr.type==="fill-extrusion")return!0}return!1}(S&&S.layers,d,f.id),F=M.maxPitchScaleFactor(),G=f.tilesIn(g,F,k);G.sort(oi);for(var X=[],ue=0,Ee=G;ue<Ee.length;ue+=1){var te=Ee[ue];X.push({wrappedTileID:te.tileID.wrapped().key,queryResults:te.tile.queryRenderedFeatures(d,h,f._state,te.queryGeometry,te.cameraQueryGeometry,te.scale,S,M,F,ln(f.transform,te.tileID))})}var je=function(nt){for(var Be={},rt={},mt=0,Dt=nt;mt<Dt.length;mt+=1){var fr=Dt[mt],nr=fr.queryResults,dr=fr.wrappedTileID,Ir=rt[dr]=rt[dr]||{};for(var tn in nr)for(var $r=nr[tn],bn=Ir[tn]=Ir[tn]||{},Qn=Be[tn]=Be[tn]||[],$n=0,ei=$r;$n<ei.length;$n+=1){var Fi=ei[$n];bn[Fi.featureIndex]||(bn[Fi.featureIndex]=!0,Qn.push(Fi))}}return Be}(X);for(var ze in je)je[ze].forEach(function(nt){var Be=nt.feature,rt=f.getFeatureState(Be.layer["source-layer"],Be.id);Be.source=Be.layer.source,Be.layer["source-layer"]&&(Be.sourceLayer=Be.layer["source-layer"]),Be.state=rt});return je}function oi(f,d){var h=f.tileID,g=d.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}var Zn=function(f,d){this.max=f,this.onRemove=d,this.reset()};Zn.prototype.reset=function(){for(var f in this.data)for(var d=0,h=this.data[f];d<h.length;d+=1){var g=h[d];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},Zn.prototype.add=function(f,d,h){var g=this,S=f.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);var M={value:d,timeout:void 0};if(h!==void 0&&(M.timeout=setTimeout(function(){g.remove(f,M)},h)),this.data[S].push(M),this.order.push(S),this.order.length>this.max){var k=this._getAndRemoveByKey(this.order[0]);k&&this.onRemove(k)}return this},Zn.prototype.has=function(f){return f.wrapped().key in this.data},Zn.prototype.getAndRemove=function(f){return this.has(f)?this._getAndRemoveByKey(f.wrapped().key):null},Zn.prototype._getAndRemoveByKey=function(f){var d=this.data[f].shift();return d.timeout&&clearTimeout(d.timeout),this.data[f].length===0&&delete this.data[f],this.order.splice(this.order.indexOf(f),1),d.value},Zn.prototype.getByKey=function(f){var d=this.data[f];return d?d[0].value:null},Zn.prototype.get=function(f){return this.has(f)?this.data[f.wrapped().key][0].value:null},Zn.prototype.remove=function(f,d){if(!this.has(f))return this;var h=f.wrapped().key,g=d===void 0?0:this.data[h].indexOf(d),S=this.data[h][g];return this.data[h].splice(g,1),S.timeout&&clearTimeout(S.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(S.value),this.order.splice(this.order.indexOf(h),1),this},Zn.prototype.setMaxSize=function(f){for(this.max=f;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},Zn.prototype.filter=function(f){var d=[];for(var h in this.data)for(var g=0,S=this.data[h];g<S.length;g+=1){var M=S[g];f(M.value)||d.push(M)}for(var k=0,F=d;k<F.length;k+=1){var G=F[k];this.remove(G.value.tileID,G)}};var Vn=function(f,d,h){this.context=f;var g=f.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),f.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Vn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Vn.prototype.updateData=function(f){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,f.arrayBuffer)},Vn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Xi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ci=function(f,d,h,g){this.length=d.length,this.attributes=h,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=f;var S=f.gl;this.buffer=S.createBuffer(),f.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Ci.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ci.prototype.updateData=function(f){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,f.arrayBuffer)},Ci.prototype.enableAttributes=function(f,d){for(var h=0;h<this.attributes.length;h++){var g=d.attributes[this.attributes[h].name];g!==void 0&&f.enableVertexAttribArray(g)}},Ci.prototype.setVertexAttribPointers=function(f,d,h){for(var g=0;g<this.attributes.length;g++){var S=this.attributes[g],M=d.attributes[S.name];M!==void 0&&f.vertexAttribPointer(M,S.components,f[Xi[S.type]],!1,this.itemSize,S.offset+this.itemSize*(h||0))}},Ci.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var fi=function(f){this.gl=f.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};fi.prototype.get=function(){return this.current},fi.prototype.set=function(f){},fi.prototype.getDefault=function(){return this.default},fi.prototype.setDefault=function(){this.set(this.default)};var Hi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return y.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(fi),Ni=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)},d}(fi),hi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)},d}(fi),Xn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(fi),ri=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)},d}(fi),po=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)},d}(fi),Ha=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(h){var g=this.current;(h.func!==g.func||h.ref!==g.ref||h.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)},d}(fi),wa=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)},d}(fi),Et=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=h,this.dirty=!1}},d}(fi),me=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)},d}(fi),se=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=h,this.dirty=!1}},d}(fi),Se=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)},d}(fi),z=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.BLEND):g.disable(g.BLEND),this.current=h,this.dirty=!1}},d}(fi),qe=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.ONE,h.ZERO]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)},d}(fi),qt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return y.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(fi),Or=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)},d}(fi),Ye=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=h,this.dirty=!1}},d}(fi),Mt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)},d}(fi),pr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)},d}(fi),Mr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)},d}(fi),Zr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)},d}(fi),qr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(fi),jn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,h),this.current=h,this.dirty=!1}},d}(fi),Nn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(fi),en=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,h),this.current=h,this.dirty=!1}},d}(fi),pi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}},d}(fi),si=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1},d}(fi),ra=function(f){function d(h){f.call(this,h),this.vao=h.extVertexArrayObject}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){this.vao&&(h!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(h),this.current=h,this.dirty=!1)},d}(fi),Aa=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}},d}(fi),va=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}},d}(fi),xa=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}},d}(fi),Ki=function(f){function d(h,g){f.call(this,h),this.context=h,this.parent=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d}(fi),Y=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}},d}(Ki),ie=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(Ki),de=function(f,d,h,g){this.context=f,this.width=d,this.height=h;var S=this.framebuffer=f.gl.createFramebuffer();this.colorAttachment=new Y(f,S),g&&(this.depthAttachment=new ie(f,S))};de.prototype.destroy=function(){var f=this.context.gl,d=this.colorAttachment.get();if(d&&f.deleteTexture(d),this.depthAttachment){var h=this.depthAttachment.get();h&&f.deleteRenderbuffer(h)}f.deleteFramebuffer(this.framebuffer)};var Ce=function(f,d,h){this.func=f,this.mask=d,this.range=h};Ce.ReadOnly=!1,Ce.ReadWrite=!0,Ce.disabled=new Ce(519,Ce.ReadOnly,[0,1]);var Ze=function(f,d,h,g,S,M){this.test=f,this.ref=d,this.mask=h,this.fail=g,this.depthFail=S,this.pass=M};Ze.disabled=new Ze({func:519,mask:0},0,0,7680,7680,7680);var et=function(f,d,h){this.blendFunction=f,this.blendColor=d,this.mask=h};et.disabled=new et(et.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),et.unblended=new et(et.Replace,y.Color.transparent,[!0,!0,!0,!0]),et.alphaBlended=new et([1,771],y.Color.transparent,[!0,!0,!0,!0]);var dt=function(f,d,h){this.enable=f,this.mode=d,this.frontFace=h};dt.disabled=new dt(!1,1029,2305),dt.backCCW=new dt(!0,1029,2305);var be=function(f){this.gl=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Hi(this),this.clearDepth=new Ni(this),this.clearStencil=new hi(this),this.colorMask=new Xn(this),this.depthMask=new ri(this),this.stencilMask=new po(this),this.stencilFunc=new Ha(this),this.stencilOp=new wa(this),this.stencilTest=new Et(this),this.depthRange=new me(this),this.depthTest=new se(this),this.depthFunc=new Se(this),this.blend=new z(this),this.blendFunc=new qe(this),this.blendColor=new qt(this),this.blendEquation=new Or(this),this.cullFace=new Ye(this),this.cullFaceSide=new Mt(this),this.frontFace=new pr(this),this.program=new Mr(this),this.activeTexture=new Zr(this),this.viewport=new qr(this),this.bindFramebuffer=new jn(this),this.bindRenderbuffer=new Nn(this),this.bindTexture=new en(this),this.bindVertexBuffer=new pi(this),this.bindElementBuffer=new si(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ra(this),this.pixelStoreUnpack=new Aa(this),this.pixelStoreUnpackPremultiplyAlpha=new va(this),this.pixelStoreUnpackFlipY=new xa(this),this.extTextureFilterAnisotropic=f.getExtension("EXT_texture_filter_anisotropic")||f.getExtension("MOZ_EXT_texture_filter_anisotropic")||f.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=f.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=f.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(f.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=f.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=f.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=f.getParameter(f.MAX_TEXTURE_SIZE)};be.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},be.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},be.prototype.createIndexBuffer=function(f,d){return new Vn(this,f,d)},be.prototype.createVertexBuffer=function(f,d,h){return new Ci(this,f,d,h)},be.prototype.createRenderbuffer=function(f,d,h){var g=this.gl,S=g.createRenderbuffer();return this.bindRenderbuffer.set(S),g.renderbufferStorage(g.RENDERBUFFER,f,d,h),this.bindRenderbuffer.set(null),S},be.prototype.createFramebuffer=function(f,d,h){return new de(this,f,d,h)},be.prototype.clear=function(f){var d=f.color,h=f.depth,g=this.gl,S=0;d&&(S|=g.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(S|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g.clear(S)},be.prototype.setCullFace=function(f){f.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(f.mode),this.frontFace.set(f.frontFace))},be.prototype.setDepthMode=function(f){f.func!==this.gl.ALWAYS||f.mask?(this.depthTest.set(!0),this.depthFunc.set(f.func),this.depthMask.set(f.mask),this.depthRange.set(f.range)):this.depthTest.set(!1)},be.prototype.setStencilMode=function(f){f.test.func!==this.gl.ALWAYS||f.mask?(this.stencilTest.set(!0),this.stencilMask.set(f.mask),this.stencilOp.set([f.fail,f.depthFail,f.pass]),this.stencilFunc.set({func:f.test.func,ref:f.ref,mask:f.test.mask})):this.stencilTest.set(!1)},be.prototype.setColorMode=function(f){y.deepEqual(f.blendFunction,et.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(f.blendFunction),this.blendColor.set(f.blendColor)),this.colorMask.set(f.mask)},be.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var He=function(f){function d(h,g,S){var M=this;f.call(this),this.id=h,this.dispatcher=S,this.on("data",function(k){k.dataType==="source"&&k.sourceDataType==="metadata"&&(M._sourceLoaded=!0),M._sourceLoaded&&!M._paused&&k.dataType==="source"&&k.sourceDataType==="content"&&(M.reload(),M.transform&&M.update(M.transform))}),this.on("error",function(){M._sourceErrored=!0}),this._source=function(k,F,G,X){var ue=new Qt[F.type](k,F,G,X);if(ue.id!==k)throw new Error("Expected Source id to be "+k+" instead of "+ue.id);return y.bindAll(["load","abort","unload","serialize","prepare"],ue),ue}(h,g,S,this),this._tiles={},this._cache=new Zn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){this.map=h,this._maxTileCacheSize=h?h._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(h)},d.prototype.onRemove=function(h){this._source&&this._source.onRemove&&this._source.onRemove(h)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var h in this._tiles){var g=this._tiles[h];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var h=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,h&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(h,g){return this._source.loadTile(h,g)},d.prototype._unloadTile=function(h){if(this._source.unloadTile)return this._source.unloadTile(h,function(){})},d.prototype._abortTile=function(h){if(this._source.abortTile)return this._source.abortTile(h,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(h){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var S=this._tiles[g];S.upload(h),S.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return y.values(this._tiles).map(function(h){return h.tileID}).sort(Rt).map(function(h){return h.key})},d.prototype.getRenderableIds=function(h){var g=this,S=[];for(var M in this._tiles)this._isIdRenderable(M,h)&&S.push(this._tiles[M]);return h?S.sort(function(k,F){var G=k.tileID,X=F.tileID,ue=new y.Point(G.canonical.x,G.canonical.y)._rotate(g.transform.angle),Ee=new y.Point(X.canonical.x,X.canonical.y)._rotate(g.transform.angle);return G.overscaledZ-X.overscaledZ||Ee.y-ue.y||Ee.x-ue.x}).map(function(k){return k.tileID.key}):S.map(function(k){return k.tileID}).sort(Rt).map(function(k){return k.key})},d.prototype.hasRenderableParent=function(h){var g=this.findLoadedParent(h,0);return!!g&&this._isIdRenderable(g.tileID.key)},d.prototype._isIdRenderable=function(h,g){return this._tiles[h]&&this._tiles[h].hasData()&&!this._coveredTiles[h]&&(g||!this._tiles[h].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var h in this._cache.reset(),this._tiles)this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")},d.prototype._reloadTile=function(h,g){var S=this._tiles[h];S&&(S.state!=="loading"&&(S.state=g),this._loadTile(S,this._tileLoaded.bind(this,S,h,g)))},d.prototype._tileLoaded=function(h,g,S,M){if(M)return h.state="errored",void(M.status!==404?this._source.fire(new y.ErrorEvent(M,{tile:h})):this.update(this.transform));h.timeAdded=y.browser.now(),S==="expired"&&(h.refreshedUponExpiration=!0),this._setTileReloadTimer(g,h),this.getSource().type==="raster-dem"&&h.dem&&this._backfillDEM(h),this._state.initializeTileState(h,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:h,coord:h.tileID}))},d.prototype._backfillDEM=function(h){for(var g=this.getRenderableIds(),S=0;S<g.length;S++){var M=g[S];if(h.neighboringTiles&&h.neighboringTiles[M]){var k=this.getTileByID(M);F(h,k),F(k,h)}}function F(G,X){G.needsHillshadePrepare=!0;var ue=X.tileID.canonical.x-G.tileID.canonical.x,Ee=X.tileID.canonical.y-G.tileID.canonical.y,te=Math.pow(2,G.tileID.canonical.z),je=X.tileID.key;ue===0&&Ee===0||Math.abs(Ee)>1||(Math.abs(ue)>1&&(Math.abs(ue+te)===1?ue+=te:Math.abs(ue-te)===1&&(ue-=te)),X.dem&&G.dem&&(G.dem.backfillBorder(X.dem,ue,Ee),G.neighboringTiles&&G.neighboringTiles[je]&&(G.neighboringTiles[je].backfilled=!0)))}},d.prototype.getTile=function(h){return this.getTileByID(h.key)},d.prototype.getTileByID=function(h){return this._tiles[h]},d.prototype._retainLoadedChildren=function(h,g,S,M){for(var k in this._tiles){var F=this._tiles[k];if(!(M[k]||!F.hasData()||F.tileID.overscaledZ<=g||F.tileID.overscaledZ>S)){for(var G=F.tileID;F&&F.tileID.overscaledZ>g+1;){var X=F.tileID.scaledTo(F.tileID.overscaledZ-1);(F=this._tiles[X.key])&&F.hasData()&&(G=X)}for(var ue=G;ue.overscaledZ>g;)if(h[(ue=ue.scaledTo(ue.overscaledZ-1)).key]){M[G.key]=G;break}}}},d.prototype.findLoadedParent=function(h,g){if(h.key in this._loadedParentTiles){var S=this._loadedParentTiles[h.key];return S&&S.tileID.overscaledZ>=g?S:null}for(var M=h.overscaledZ-1;M>=g;M--){var k=h.scaledTo(M),F=this._getLoadedTile(k);if(F)return F}},d.prototype._getLoadedTile=function(h){var g=this._tiles[h.key];return g&&g.hasData()?g:this._cache.getByKey(h.wrapped().key)},d.prototype.updateCacheSize=function(h){var g=Math.ceil(h.width/this._source.tileSize)+1,S=Math.ceil(h.height/this._source.tileSize)+1,M=Math.floor(g*S*5),k=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,M):M;this._cache.setMaxSize(k)},d.prototype.handleWrapJump=function(h){var g=Math.round((h-(this._prevLng===void 0?h:this._prevLng))/360);if(this._prevLng=h,g){var S={};for(var M in this._tiles){var k=this._tiles[M];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+g),S[k.tileID.key]=k}for(var F in this._tiles=S,this._timers)clearTimeout(this._timers[F]),delete this._timers[F];for(var G in this._tiles)this._setTileReloadTimer(G,this._tiles[G])}},d.prototype.update=function(h){var g=this;if(this.transform=h,this._sourceLoaded&&!this._paused){var S;this.updateCacheSize(h),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?S=h.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Ir){return new y.OverscaledTileID(Ir.canonical.z,Ir.wrap,Ir.canonical.z,Ir.canonical.x,Ir.canonical.y)}):(S=h.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(S=S.filter(function(Ir){return g._source.hasTile(Ir)}))):S=[];var M=h.coveringZoomLevel(this._source),k=Math.max(M-d.maxOverzooming,this._source.minzoom),F=Math.max(M+d.maxUnderzooming,this._source.minzoom),G=this._updateRetainedTiles(S,M);if(kr(this._source.type)){for(var X={},ue={},Ee=0,te=Object.keys(G);Ee<te.length;Ee+=1){var je=te[Ee],ze=G[je],nt=this._tiles[je];if(nt&&!(nt.fadeEndTime&&nt.fadeEndTime<=y.browser.now())){var Be=this.findLoadedParent(ze,k);Be&&(this._addTile(Be.tileID),X[Be.tileID.key]=Be.tileID),ue[je]=ze}}for(var rt in this._retainLoadedChildren(ue,M,F,G),X)G[rt]||(this._coveredTiles[rt]=!0,G[rt]=X[rt])}for(var mt in G)this._tiles[mt].clearFadeHold();for(var Dt=0,fr=y.keysDifference(this._tiles,G);Dt<fr.length;Dt+=1){var nr=fr[Dt],dr=this._tiles[nr];dr.hasSymbolBuckets&&!dr.holdingForFade()?dr.setHoldDuration(this.map._fadeDuration):dr.hasSymbolBuckets&&!dr.symbolFadeFinished()||this._removeTile(nr)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var h in this._tiles)this._tiles[h].holdingForFade()&&this._removeTile(h)},d.prototype._updateRetainedTiles=function(h,g){for(var S={},M={},k=Math.max(g-d.maxOverzooming,this._source.minzoom),F=Math.max(g+d.maxUnderzooming,this._source.minzoom),G={},X=0,ue=h;X<ue.length;X+=1){var Ee=ue[X],te=this._addTile(Ee);S[Ee.key]=Ee,te.hasData()||g<this._source.maxzoom&&(G[Ee.key]=Ee)}this._retainLoadedChildren(G,g,F,S);for(var je=0,ze=h;je<ze.length;je+=1){var nt=ze[je],Be=this._tiles[nt.key];if(!Be.hasData()){if(g+1>this._source.maxzoom){var rt=nt.children(this._source.maxzoom)[0],mt=this.getTile(rt);if(mt&&mt.hasData()){S[rt.key]=rt;continue}}else{var Dt=nt.children(this._source.maxzoom);if(S[Dt[0].key]&&S[Dt[1].key]&&S[Dt[2].key]&&S[Dt[3].key])continue}for(var fr=Be.wasRequested(),nr=nt.overscaledZ-1;nr>=k;--nr){var dr=nt.scaledTo(nr);if(M[dr.key]||(M[dr.key]=!0,!(Be=this.getTile(dr))&&fr&&(Be=this._addTile(dr)),Be&&(S[dr.key]=dr,fr=Be.wasRequested(),Be.hasData())))break}}}return S},d.prototype._updateLoadedParentTileCache=function(){for(var h in this._loadedParentTiles={},this._tiles){for(var g=[],S=void 0,M=this._tiles[h].tileID;M.overscaledZ>0;){if(M.key in this._loadedParentTiles){S=this._loadedParentTiles[M.key];break}g.push(M.key);var k=M.scaledTo(M.overscaledZ-1);if(S=this._getLoadedTile(k))break;M=k}for(var F=0,G=g;F<G.length;F+=1)this._loadedParentTiles[G[F]]=S}},d.prototype._addTile=function(h){var g=this._tiles[h.key];if(g)return g;(g=this._cache.getAndRemove(h))&&(this._setTileReloadTimer(h.key,g),g.tileID=h,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[h.key]&&(clearTimeout(this._cacheTimers[h.key]),delete this._cacheTimers[h.key],this._setTileReloadTimer(h.key,g)));var S=Boolean(g);return S||(g=new y.Tile(h,this._source.tileSize*h.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,h.key,g.state))),g?(g.uses++,this._tiles[h.key]=g,S||this._source.fire(new y.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},d.prototype._setTileReloadTimer=function(h,g){var S=this;h in this._timers&&(clearTimeout(this._timers[h]),delete this._timers[h]);var M=g.getExpiryTimeout();M&&(this._timers[h]=setTimeout(function(){S._reloadTile(h,"expired"),delete S._timers[h]},M))},d.prototype._removeTile=function(h){var g=this._tiles[h];g&&(g.uses--,delete this._tiles[h],this._timers[h]&&(clearTimeout(this._timers[h]),delete this._timers[h]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},d.prototype.clearTiles=function(){for(var h in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(h);this._cache.reset()},d.prototype.tilesIn=function(h,g,S){var M=this,k=[],F=this.transform;if(!F)return k;for(var G=S?F.getCameraQueryGeometry(h):h,X=h.map(function(nr){return F.pointCoordinate(nr)}),ue=G.map(function(nr){return F.pointCoordinate(nr)}),Ee=this.getIds(),te=1/0,je=1/0,ze=-1/0,nt=-1/0,Be=0,rt=ue;Be<rt.length;Be+=1){var mt=rt[Be];te=Math.min(te,mt.x),je=Math.min(je,mt.y),ze=Math.max(ze,mt.x),nt=Math.max(nt,mt.y)}for(var Dt=function(nr){var dr=M._tiles[Ee[nr]];if(!dr.holdingForFade()){var Ir=dr.tileID,tn=Math.pow(2,F.zoom-dr.tileID.overscaledZ),$r=g*dr.queryPadding*y.EXTENT/dr.tileSize/tn,bn=[Ir.getTilePoint(new y.MercatorCoordinate(te,je)),Ir.getTilePoint(new y.MercatorCoordinate(ze,nt))];if(bn[0].x-$r<y.EXTENT&&bn[0].y-$r<y.EXTENT&&bn[1].x+$r>=0&&bn[1].y+$r>=0){var Qn=X.map(function(ei){return Ir.getTilePoint(ei)}),$n=ue.map(function(ei){return Ir.getTilePoint(ei)});k.push({tile:dr,tileID:Ir,queryGeometry:Qn,cameraQueryGeometry:$n,scale:tn})}}},fr=0;fr<Ee.length;fr++)Dt(fr);return k},d.prototype.getVisibleCoordinates=function(h){for(var g=this,S=this.getRenderableIds(h).map(function(G){return g._tiles[G].tileID}),M=0,k=S;M<k.length;M+=1){var F=k[M];F.posMatrix=this.transform.calculatePosMatrix(F.toUnwrapped())}return S},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(kr(this._source.type))for(var h in this._tiles){var g=this._tiles[h];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=y.browser.now())return!0}return!1},d.prototype.setFeatureState=function(h,g,S){this._state.updateState(h=h||"_geojsonTileLayer",g,S)},d.prototype.removeFeatureState=function(h,g,S){this._state.removeFeatureState(h=h||"_geojsonTileLayer",g,S)},d.prototype.getFeatureState=function(h,g){return this._state.getState(h=h||"_geojsonTileLayer",g)},d.prototype.setDependencies=function(h,g,S){var M=this._tiles[h];M&&M.setDependencies(g,S)},d.prototype.reloadTilesForDependencies=function(h,g){for(var S in this._tiles)this._tiles[S].hasDependency(h,g)&&this._reloadTile(S,"reloading");this._cache.filter(function(M){return!M.hasDependency(h,g)})},d}(y.Evented);function Rt(f,d){var h=Math.abs(2*f.wrap)-+(f.wrap<0),g=Math.abs(2*d.wrap)-+(d.wrap<0);return f.overscaledZ-d.overscaledZ||g-h||d.canonical.y-f.canonical.y||d.canonical.x-f.canonical.x}function kr(f){return f==="raster"||f==="image"||f==="video"}function Xt(){return new y.window.Worker(qc.workerUrl)}He.maxOverzooming=10,He.maxUnderzooming=3;var er="mapboxgl_preloaded_worker_pool",Pr=function(){this.active={}};Pr.prototype.acquire=function(f){if(!this.workers)for(this.workers=[];this.workers.length<Pr.workerCount;)this.workers.push(new Xt);return this.active[f]=!0,this.workers.slice()},Pr.prototype.release=function(f){delete this.active[f],this.numActive()===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)},Pr.prototype.isPreloaded=function(){return!!this.active[er]},Pr.prototype.numActive=function(){return Object.keys(this.active).length};var Ln,An=Math.floor(y.browser.hardwareConcurrency/2);function Ht(){return Ln||(Ln=new Pr),Ln}function xn(f,d){var h={};for(var g in f)g!=="ref"&&(h[g]=f[g]);return y.refProperties.forEach(function(S){S in d&&(h[S]=d[S])}),h}function sn(f){f=f.slice();for(var d=Object.create(null),h=0;h<f.length;h++)d[f[h].id]=f[h];for(var g=0;g<f.length;g++)"ref"in f[g]&&(f[g]=xn(f[g],d[f[g].ref]));return f}Pr.workerCount=Math.max(Math.min(An,6),1);var pn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function bi(f,d,h){h.push({command:pn.addSource,args:[f,d[f]]})}function yn(f,d,h){d.push({command:pn.removeSource,args:[f]}),h[f]=!0}function Pi(f,d,h,g){yn(f,h,g),bi(f,d,h)}function aa(f,d,h){var g;for(g in f[h])if(f[h].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(f[h][g],d[h][g]))return!1;for(g in d[h])if(d[h].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(f[h][g],d[h][g]))return!1;return!0}function vt(f,d,h,g,S,M){var k;for(k in d=d||{},f=f||{})f.hasOwnProperty(k)&&(y.deepEqual(f[k],d[k])||h.push({command:M,args:[g,k,d[k],S]}));for(k in d)d.hasOwnProperty(k)&&!f.hasOwnProperty(k)&&(y.deepEqual(f[k],d[k])||h.push({command:M,args:[g,k,d[k],S]}))}function yt(f){return f.id}function Ii(f,d){return f[d.id]=d,f}var ui=function(f,d){this.reset(f,d)};ui.prototype.reset=function(f,d){this.points=f||[],this._distances=[0];for(var h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ui.prototype.lerp=function(f){if(this.points.length===1)return this.points[0];f=y.clamp(f,0,1);for(var d=1,h=this._distances[d],g=f*this.paddedLength+this.padding;h<g&&d<this._distances.length;)h=this._distances[++d];var S=d-1,M=this._distances[S],k=h-M,F=k>0?(g-M)/k:0;return this.points[S].mult(1-F).add(this.points[d].mult(F))};var Qi=function(f,d,h){var g=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(f/h),this.yCellCount=Math.ceil(d/h);for(var M=0;M<this.xCellCount*this.yCellCount;M++)g.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=f,this.height=d,this.xScale=this.xCellCount/f,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0};function Ji(f,d,h,g,S){var M=y.create();return d?(y.scale(M,M,[1/S,1/S,1]),h||y.rotateZ(M,M,g.angle)):y.multiply(M,g.labelPlaneMatrix,f),M}function oa(f,d,h,g,S){if(d){var M=y.clone(f);return y.scale(M,M,[S,S,1]),h||y.rotateZ(M,M,-g.angle),M}return g.glCoordMatrix}function Ri(f,d){var h=[f.x,f.y,0,1];Wa(h,h,d);var g=h[3];return{point:new y.Point(h[0]/g,h[1]/g),signedDistanceFromCamera:g}}function hr(f,d){return .5+f/d*.5}function _r(f,d){var h=f[0]/f[3],g=f[1]/f[3];return h>=-d[0]&&h<=d[0]&&g>=-d[1]&&g<=d[1]}function at(f,d,h,g,S,M,k,F){var G=g?f.textSizeData:f.iconSizeData,X=y.evaluateSizeForZoom(G,h.transform.zoom),ue=[256/h.width*2+1,256/h.height*2+1],Ee=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Ee.clear();for(var te=f.lineVertexArray,je=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,ze=h.transform.width/h.transform.height,nt=!1,Be=0;Be<je.length;Be++){var rt=je.get(Be);if(rt.hidden||rt.writingMode===y.WritingMode.vertical&&!nt)Ja(rt.numGlyphs,Ee);else{nt=!1;var mt=[rt.anchorX,rt.anchorY,0,1];if(y.transformMat4(mt,mt,d),_r(mt,ue)){var Dt=hr(h.transform.cameraToCenterDistance,mt[3]),fr=y.evaluateSizeForFeature(G,X,rt),nr=k?fr/Dt:fr*Dt,dr=new y.Point(rt.anchorX,rt.anchorY),Ir=Ri(dr,S).point,tn={},$r=ks(rt,nr,!1,F,d,S,M,f.glyphOffsetArray,te,Ee,Ir,dr,tn,ze);nt=$r.useVertical,($r.notEnoughRoom||nt||$r.needsFlipping&&ks(rt,nr,!0,F,d,S,M,f.glyphOffsetArray,te,Ee,Ir,dr,tn,ze).notEnoughRoom)&&Ja(rt.numGlyphs,Ee)}else Ja(rt.numGlyphs,Ee)}}g?f.text.dynamicLayoutVertexBuffer.updateData(Ee):f.icon.dynamicLayoutVertexBuffer.updateData(Ee)}function Ta(f,d,h,g,S,M,k,F,G,X,ue){var Ee=F.glyphStartIndex+F.numGlyphs,te=F.lineStartIndex,je=F.lineStartIndex+F.lineLength,ze=d.getoffsetX(F.glyphStartIndex),nt=d.getoffsetX(Ee-1),Be=ia(f*ze,h,g,S,M,k,F.segment,te,je,G,X,ue);if(!Be)return null;var rt=ia(f*nt,h,g,S,M,k,F.segment,te,je,G,X,ue);return rt?{first:Be,last:rt}:null}function $e(f,d,h,g){return f===y.WritingMode.horizontal&&Math.abs(h.y-d.y)>Math.abs(h.x-d.x)*g?{useVertical:!0}:(f===y.WritingMode.vertical?d.y<h.y:d.x>h.x)?{needsFlipping:!0}:null}function ks(f,d,h,g,S,M,k,F,G,X,ue,Ee,te,je){var ze,nt=d/24,Be=f.lineOffsetX*nt,rt=f.lineOffsetY*nt;if(f.numGlyphs>1){var mt=f.glyphStartIndex+f.numGlyphs,Dt=f.lineStartIndex,fr=f.lineStartIndex+f.lineLength,nr=Ta(nt,F,Be,rt,h,ue,Ee,f,G,M,te);if(!nr)return{notEnoughRoom:!0};var dr=Ri(nr.first.point,k).point,Ir=Ri(nr.last.point,k).point;if(g&&!h){var tn=$e(f.writingMode,dr,Ir,je);if(tn)return tn}ze=[nr.first];for(var $r=f.glyphStartIndex+1;$r<mt-1;$r++)ze.push(ia(nt*F.getoffsetX($r),Be,rt,h,ue,Ee,f.segment,Dt,fr,G,M,te));ze.push(nr.last)}else{if(g&&!h){var bn=Ri(Ee,S).point,Qn=f.lineStartIndex+f.segment+1,$n=new y.Point(G.getx(Qn),G.gety(Qn)),ei=Ri($n,S),Fi=ei.signedDistanceFromCamera>0?ei.point:ls(Ee,$n,bn,1,S),Cn=$e(f.writingMode,bn,Fi,je);if(Cn)return Cn}var Ei=ia(nt*F.getoffsetX(f.glyphStartIndex),Be,rt,h,ue,Ee,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,G,M,te);if(!Ei)return{notEnoughRoom:!0};ze=[Ei]}for(var Si=0,mi=ze;Si<mi.length;Si+=1){var ai=mi[Si];y.addDynamicAttributes(X,ai.point,ai.angle)}return{}}function ls(f,d,h,g,S){var M=Ri(f.add(f.sub(d)._unit()),S).point,k=h.sub(M);return h.add(k._mult(g/k.mag()))}function ia(f,d,h,g,S,M,k,F,G,X,ue,Ee){var te=g?f-d:f+d,je=te>0?1:-1,ze=0;g&&(je*=-1,ze=Math.PI),je<0&&(ze+=Math.PI);for(var nt=je>0?F+k:F+k+1,Be=S,rt=S,mt=0,Dt=0,fr=Math.abs(te),nr=[];mt+Dt<=fr;){if((nt+=je)<F||nt>=G)return null;if(rt=Be,nr.push(Be),(Be=Ee[nt])===void 0){var dr=new y.Point(X.getx(nt),X.gety(nt)),Ir=Ri(dr,ue);if(Ir.signedDistanceFromCamera>0)Be=Ee[nt]=Ir.point;else{var tn=nt-je;Be=ls(mt===0?M:new y.Point(X.getx(tn),X.gety(tn)),dr,rt,fr-mt+1,ue)}}mt+=Dt,Dt=rt.dist(Be)}var $r=(fr-mt)/Dt,bn=Be.sub(rt),Qn=bn.mult($r)._add(rt);Qn._add(bn._unit()._perp()._mult(h*je));var $n=ze+Math.atan2(Be.y-rt.y,Be.x-rt.x);return nr.push(Qn),{point:Qn,angle:$n,path:nr}}Qi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Qi.prototype.insert=function(f,d,h,g,S){this._forEachCell(d,h,g,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(f),this.bboxes.push(d),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(S)},Qi.prototype.insertCircle=function(f,d,h,g){this._forEachCell(d-g,h-g,d+g,h+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(f),this.circles.push(d),this.circles.push(h),this.circles.push(g)},Qi.prototype._insertBoxCell=function(f,d,h,g,S,M){this.boxCells[S].push(M)},Qi.prototype._insertCircleCell=function(f,d,h,g,S,M){this.circleCells[S].push(M)},Qi.prototype._query=function(f,d,h,g,S,M){if(h<0||f>this.width||g<0||d>this.height)return!S&&[];var k=[];if(f<=0&&d<=0&&this.width<=h&&this.height<=g){if(S)return!0;for(var F=0;F<this.boxKeys.length;F++)k.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(var G=0;G<this.circleKeys.length;G++){var X=this.circles[3*G],ue=this.circles[3*G+1],Ee=this.circles[3*G+2];k.push({key:this.circleKeys[G],x1:X-Ee,y1:ue-Ee,x2:X+Ee,y2:ue+Ee})}return M?k.filter(M):k}return this._forEachCell(f,d,h,g,this._queryCell,k,{hitTest:S,seenUids:{box:{},circle:{}}},M),S?k.length>0:k},Qi.prototype._queryCircle=function(f,d,h,g,S){var M=f-h,k=f+h,F=d-h,G=d+h;if(k<0||M>this.width||G<0||F>this.height)return!g&&[];var X=[];return this._forEachCell(M,F,k,G,this._queryCellCircle,X,{hitTest:g,circle:{x:f,y:d,radius:h},seenUids:{box:{},circle:{}}},S),g?X.length>0:X},Qi.prototype.query=function(f,d,h,g,S){return this._query(f,d,h,g,!1,S)},Qi.prototype.hitTest=function(f,d,h,g,S){return this._query(f,d,h,g,!0,S)},Qi.prototype.hitTestCircle=function(f,d,h,g){return this._queryCircle(f,d,h,!0,g)},Qi.prototype._queryCell=function(f,d,h,g,S,M,k,F){var G=k.seenUids,X=this.boxCells[S];if(X!==null)for(var ue=this.bboxes,Ee=0,te=X;Ee<te.length;Ee+=1){var je=te[Ee];if(!G.box[je]){G.box[je]=!0;var ze=4*je;if(f<=ue[ze+2]&&d<=ue[ze+3]&&h>=ue[ze+0]&&g>=ue[ze+1]&&(!F||F(this.boxKeys[je]))){if(k.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[je],x1:ue[ze],y1:ue[ze+1],x2:ue[ze+2],y2:ue[ze+3]})}}}var nt=this.circleCells[S];if(nt!==null)for(var Be=this.circles,rt=0,mt=nt;rt<mt.length;rt+=1){var Dt=mt[rt];if(!G.circle[Dt]){G.circle[Dt]=!0;var fr=3*Dt;if(this._circleAndRectCollide(Be[fr],Be[fr+1],Be[fr+2],f,d,h,g)&&(!F||F(this.circleKeys[Dt]))){if(k.hitTest)return M.push(!0),!0;var nr=Be[fr],dr=Be[fr+1],Ir=Be[fr+2];M.push({key:this.circleKeys[Dt],x1:nr-Ir,y1:dr-Ir,x2:nr+Ir,y2:dr+Ir})}}}},Qi.prototype._queryCellCircle=function(f,d,h,g,S,M,k,F){var G=k.circle,X=k.seenUids,ue=this.boxCells[S];if(ue!==null)for(var Ee=this.bboxes,te=0,je=ue;te<je.length;te+=1){var ze=je[te];if(!X.box[ze]){X.box[ze]=!0;var nt=4*ze;if(this._circleAndRectCollide(G.x,G.y,G.radius,Ee[nt+0],Ee[nt+1],Ee[nt+2],Ee[nt+3])&&(!F||F(this.boxKeys[ze])))return M.push(!0),!0}}var Be=this.circleCells[S];if(Be!==null)for(var rt=this.circles,mt=0,Dt=Be;mt<Dt.length;mt+=1){var fr=Dt[mt];if(!X.circle[fr]){X.circle[fr]=!0;var nr=3*fr;if(this._circlesCollide(rt[nr],rt[nr+1],rt[nr+2],G.x,G.y,G.radius)&&(!F||F(this.circleKeys[fr])))return M.push(!0),!0}}},Qi.prototype._forEachCell=function(f,d,h,g,S,M,k,F){for(var G=this._convertToXCellCoord(f),X=this._convertToYCellCoord(d),ue=this._convertToXCellCoord(h),Ee=this._convertToYCellCoord(g),te=G;te<=ue;te++)for(var je=X;je<=Ee;je++)if(S.call(this,f,d,h,g,this.xCellCount*je+te,M,k,F))return},Qi.prototype._convertToXCellCoord=function(f){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(f*this.xScale)))},Qi.prototype._convertToYCellCoord=function(f){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(f*this.yScale)))},Qi.prototype._circlesCollide=function(f,d,h,g,S,M){var k=g-f,F=S-d,G=h+M;return G*G>k*k+F*F},Qi.prototype._circleAndRectCollide=function(f,d,h,g,S,M,k){var F=(M-g)/2,G=Math.abs(f-(g+F));if(G>F+h)return!1;var X=(k-S)/2,ue=Math.abs(d-(S+X));if(ue>X+h)return!1;if(G<=F||ue<=X)return!0;var Ee=G-F,te=ue-X;return Ee*Ee+te*te<=h*h};var Us=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ja(f,d){for(var h=0;h<f;h++){var g=d.length;d.resize(g+4),d.float32.set(Us,3*g)}}function Wa(f,d,h){var g=d[0],S=d[1];return f[0]=h[0]*g+h[4]*S+h[12],f[1]=h[1]*g+h[5]*S+h[13],f[3]=h[3]*g+h[7]*S+h[15],f}var eo=function(f,d,h){d===void 0&&(d=new Qi(f.width+200,f.height+200,25)),h===void 0&&(h=new Qi(f.width+200,f.height+200,25)),this.transform=f,this.grid=d,this.ignoredGrid=h,this.pitchfactor=Math.cos(f._pitch)*f.cameraToCenterDistance,this.screenRightBoundary=f.width+100,this.screenBottomBoundary=f.height+100,this.gridRightBoundary=f.width+200,this.gridBottomBoundary=f.height+200};function sa(f,d,h){return d*(y.EXTENT/(f.tileSize*Math.pow(2,h-f.tileID.overscaledZ)))}eo.prototype.placeCollisionBox=function(f,d,h,g,S){var M=this.projectAndGetPerspectiveRatio(g,f.anchorPointX,f.anchorPointY),k=h*M.perspectiveRatio,F=f.x1*k+M.point.x,G=f.y1*k+M.point.y,X=f.x2*k+M.point.x,ue=f.y2*k+M.point.y;return!this.isInsideGrid(F,G,X,ue)||!d&&this.grid.hitTest(F,G,X,ue,S)?{box:[],offscreen:!1}:{box:[F,G,X,ue],offscreen:this.isOffscreen(F,G,X,ue)}},eo.prototype.placeCollisionCircles=function(f,d,h,g,S,M,k,F,G,X,ue,Ee,te){var je=[],ze=new y.Point(d.anchorX,d.anchorY),nt=Ri(ze,M),Be=hr(this.transform.cameraToCenterDistance,nt.signedDistanceFromCamera),rt=(X?S/Be:S*Be)/y.ONE_EM,mt=Ri(ze,k).point,Dt=Ta(rt,g,d.lineOffsetX*rt,d.lineOffsetY*rt,!1,mt,ze,d,h,k,{}),fr=!1,nr=!1,dr=!0;if(Dt){for(var Ir=.5*Ee*Be+te,tn=new y.Point(-100,-100),$r=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),bn=new ui,Qn=Dt.first,$n=Dt.last,ei=[],Fi=Qn.path.length-1;Fi>=1;Fi--)ei.push(Qn.path[Fi]);for(var Cn=1;Cn<$n.path.length;Cn++)ei.push($n.path[Cn]);var Ei=2.5*Ir;if(F){var Si=ei.map(function(du){return Ri(du,F)});ei=Si.some(function(du){return du.signedDistanceFromCamera<=0})?[]:Si.map(function(du){return du.point})}var mi=[];if(ei.length>0){for(var ai=ei[0].clone(),Ti=ei[0].clone(),li=1;li<ei.length;li++)ai.x=Math.min(ai.x,ei[li].x),ai.y=Math.min(ai.y,ei[li].y),Ti.x=Math.max(Ti.x,ei[li].x),Ti.y=Math.max(Ti.y,ei[li].y);mi=ai.x>=tn.x&&Ti.x<=$r.x&&ai.y>=tn.y&&Ti.y<=$r.y?[ei]:Ti.x<tn.x||ai.x>$r.x||Ti.y<tn.y||ai.y>$r.y?[]:y.clipLine([ei],tn.x,tn.y,$r.x,$r.y)}for(var ti=0,bo=mi;ti<bo.length;ti+=1){var ro;bn.reset(bo[ti],.25*Ir),ro=bn.length<=.5*Ir?1:Math.ceil(bn.paddedLength/Ei)+1;for(var Ko=0;Ko<ro;Ko++){var Qo=Ko/Math.max(ro-1,1),Ya=bn.lerp(Qo),yo=Ya.x+100,Eo=Ya.y+100;je.push(yo,Eo,Ir,0);var fs=yo-Ir,il=Eo-Ir,Ss=yo+Ir,wu=Eo+Ir;if(dr=dr&&this.isOffscreen(fs,il,Ss,wu),nr=nr||this.isInsideGrid(fs,il,Ss,wu),!f&&this.grid.hitTestCircle(yo,Eo,Ir,ue)&&(fr=!0,!G))return{circles:[],offscreen:!1,collisionDetected:fr}}}}return{circles:!G&&fr||!nr?[]:je,offscreen:dr,collisionDetected:fr}},eo.prototype.queryRenderedSymbols=function(f){if(f.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],h=1/0,g=1/0,S=-1/0,M=-1/0,k=0,F=f;k<F.length;k+=1){var G=F[k],X=new y.Point(G.x+100,G.y+100);h=Math.min(h,X.x),g=Math.min(g,X.y),S=Math.max(S,X.x),M=Math.max(M,X.y),d.push(X)}for(var ue={},Ee={},te=0,je=this.grid.query(h,g,S,M).concat(this.ignoredGrid.query(h,g,S,M));te<je.length;te+=1){var ze=je[te],nt=ze.key;if(ue[nt.bucketInstanceId]===void 0&&(ue[nt.bucketInstanceId]={}),!ue[nt.bucketInstanceId][nt.featureIndex]){var Be=[new y.Point(ze.x1,ze.y1),new y.Point(ze.x2,ze.y1),new y.Point(ze.x2,ze.y2),new y.Point(ze.x1,ze.y2)];y.polygonIntersectsPolygon(d,Be)&&(ue[nt.bucketInstanceId][nt.featureIndex]=!0,Ee[nt.bucketInstanceId]===void 0&&(Ee[nt.bucketInstanceId]=[]),Ee[nt.bucketInstanceId].push(nt.featureIndex))}}return Ee},eo.prototype.insertCollisionBox=function(f,d,h,g,S){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:S},f[0],f[1],f[2],f[3])},eo.prototype.insertCollisionCircles=function(f,d,h,g,S){for(var M=d?this.ignoredGrid:this.grid,k={bucketInstanceId:h,featureIndex:g,collisionGroupID:S},F=0;F<f.length;F+=4)M.insertCircle(k,f[F],f[F+1],f[F+2])},eo.prototype.projectAndGetPerspectiveRatio=function(f,d,h){var g=[d,h,0,1];return Wa(g,g,f),{point:new y.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},eo.prototype.isOffscreen=function(f,d,h,g){return h<100||f>=this.screenRightBoundary||g<100||d>this.screenBottomBoundary},eo.prototype.isInsideGrid=function(f,d,h,g){return h>=0&&f<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary},eo.prototype.getViewportMatrix=function(){var f=y.identity([]);return y.translate(f,f,[-100,-100,0]),f};var Xo=function(f,d,h,g){this.opacity=f?Math.max(0,Math.min(1,f.opacity+(f.placed?d:-d))):g&&h?1:0,this.placed=h};Xo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var rs=function(f,d,h,g,S){this.text=new Xo(f?f.text:null,d,h,S),this.icon=new Xo(f?f.icon:null,d,g,S)};rs.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var bu=function(f,d,h){this.text=f,this.icon=d,this.skipFade=h},To=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},Mo=function(f,d,h,g,S){this.bucketInstanceId=f,this.featureIndex=d,this.sourceLayerIndex=h,this.bucketIndex=g,this.tileID=S},fa=function(f){this.crossSourceCollisions=f,this.maxGroupID=0,this.collisionGroups={}};function to(f,d,h,g,S){var M=y.getAnchorAlignment(f),k=-(M.horizontalAlign-.5)*d,F=-(M.verticalAlign-.5)*h,G=y.evaluateVariableOffset(f,g);return new y.Point(k+G[0]*S,F+G[1]*S)}function Yo(f,d,h,g,S,M){var k=f.x1,F=f.x2,G=f.y1,X=f.y2,ue=f.anchorPointX,Ee=f.anchorPointY,te=new y.Point(d,h);return g&&te._rotate(S?M:-M),{x1:k+te.x,y1:G+te.y,x2:F+te.x,y2:X+te.y,anchorPointX:ue,anchorPointY:Ee}}fa.prototype.get=function(f){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[f]){var d=++this.maxGroupID;this.collisionGroups[f]={ID:d,predicate:function(h){return h.collisionGroupID===d}}}return this.collisionGroups[f]};var qa=function(f,d,h,g){this.transform=f.clone(),this.collisionIndex=new eo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new fa(h),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function $s(f,d,h,g,S){f.emplaceBack(d?1:0,h?1:0,g||0,S||0),f.emplaceBack(d?1:0,h?1:0,g||0,S||0),f.emplaceBack(d?1:0,h?1:0,g||0,S||0),f.emplaceBack(d?1:0,h?1:0,g||0,S||0)}qa.prototype.getBucketParts=function(f,d,h,g){var S=h.getBucket(d),M=h.latestFeatureIndex;if(S&&M&&d.id===S.layerIds[0]){var k=h.collisionBoxArray,F=S.layers[0].layout,G=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),X=h.tileSize/y.EXTENT,ue=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),Ee=F.get("text-pitch-alignment")==="map",te=F.get("text-rotation-alignment")==="map",je=sa(h,1,this.transform.zoom),ze=Ji(ue,Ee,te,this.transform,je),nt=null;if(Ee){var Be=oa(ue,Ee,te,this.transform,je);nt=y.multiply([],this.transform.labelPlaneMatrix,Be)}this.retainedQueryData[S.bucketInstanceId]=new Mo(S.bucketInstanceId,M,S.sourceLayerIndex,S.index,h.tileID);var rt={bucket:S,layout:F,posMatrix:ue,textLabelPlaneMatrix:ze,labelToScreenMatrix:nt,scale:G,textPixelRatio:X,holdingForFade:h.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(g)for(var mt=0,Dt=S.sortKeyRanges;mt<Dt.length;mt+=1){var fr=Dt[mt];f.push({sortKey:fr.sortKey,symbolInstanceStart:fr.symbolInstanceStart,symbolInstanceEnd:fr.symbolInstanceEnd,parameters:rt})}else f.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:rt})}},qa.prototype.attemptAnchorPlacement=function(f,d,h,g,S,M,k,F,G,X,ue,Ee,te,je,ze){var nt,Be=[Ee.textOffset0,Ee.textOffset1],rt=to(f,h,g,Be,S),mt=this.collisionIndex.placeCollisionBox(Yo(d,rt.x,rt.y,M,k,this.transform.angle),ue,F,G,X.predicate);if(!ze||this.collisionIndex.placeCollisionBox(Yo(ze,rt.x,rt.y,M,k,this.transform.angle),ue,F,G,X.predicate).box.length!==0)return mt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Ee.crossTileID]&&this.prevPlacement.placements[Ee.crossTileID]&&this.prevPlacement.placements[Ee.crossTileID].text&&(nt=this.prevPlacement.variableOffsets[Ee.crossTileID].anchor),this.variableOffsets[Ee.crossTileID]={textOffset:Be,width:h,height:g,anchor:f,textBoxScale:S,prevAnchor:nt},this.markUsedJustification(te,f,Ee,je),te.allowVerticalPlacement&&(this.markUsedOrientation(te,je,Ee),this.placedOrientations[Ee.crossTileID]=je),{shift:rt,placedGlyphBoxes:mt}):void 0},qa.prototype.placeLayerBucketPart=function(f,d,h){var g=this,S=f.parameters,M=S.bucket,k=S.layout,F=S.posMatrix,G=S.textLabelPlaneMatrix,X=S.labelToScreenMatrix,ue=S.textPixelRatio,Ee=S.holdingForFade,te=S.collisionBoxArray,je=S.partiallyEvaluatedTextSize,ze=S.collisionGroup,nt=k.get("text-optional"),Be=k.get("icon-optional"),rt=k.get("text-allow-overlap"),mt=k.get("icon-allow-overlap"),Dt=k.get("text-rotation-alignment")==="map",fr=k.get("text-pitch-alignment")==="map",nr=k.get("icon-text-fit")!=="none",dr=k.get("symbol-z-order")==="viewport-y",Ir=rt&&(mt||!M.hasIconData()||Be),tn=mt&&(rt||!M.hasTextData()||nt);!M.collisionArrays&&te&&M.deserializeCollisionBoxes(te);var $r=function(Cn,Ei){if(!d[Cn.crossTileID])if(Ee)g.placements[Cn.crossTileID]=new bu(!1,!1,!1);else{var Si,mi=!1,ai=!1,Ti=!0,li=null,ti={box:null,offscreen:null},bo={box:null,offscreen:null},ro=null,Ko=null,Qo=0,Ya=0,yo=0;Ei.textFeatureIndex?Qo=Ei.textFeatureIndex:Cn.useRuntimeCollisionCircles&&(Qo=Cn.featureIndex),Ei.verticalTextFeatureIndex&&(Ya=Ei.verticalTextFeatureIndex);var Eo=Ei.textBox;if(Eo){var fs=function(ua){var Gs=y.WritingMode.horizontal;if(M.allowVerticalPlacement&&!ua&&g.prevPlacement){var Cs=g.prevPlacement.placedOrientations[Cn.crossTileID];Cs&&(g.placedOrientations[Cn.crossTileID]=Cs,g.markUsedOrientation(M,Gs=Cs,Cn))}return Gs},il=function(ua,Gs){if(M.allowVerticalPlacement&&Cn.numVerticalGlyphVertices>0&&Ei.verticalTextBox)for(var Cs=0,Xu=M.writingModes;Cs<Xu.length&&(Xu[Cs]===y.WritingMode.vertical?(ti=Gs(),bo=ti):ti=ua(),!(ti&&ti.box&&ti.box.length));Cs+=1);else ti=ua()};if(k.get("text-variable-anchor")){var Ss=k.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[Cn.crossTileID]){var wu=g.prevPlacement.variableOffsets[Cn.crossTileID];Ss.indexOf(wu.anchor)>0&&(Ss=Ss.filter(function(ua){return ua!==wu.anchor})).unshift(wu.anchor)}var du=function(ua,Gs,Cs){for(var Xu=ua.x2-ua.x1,yc=ua.y2-ua.y1,Jl=Cn.textBoxScale,Qf=nr&&!mt?Gs:null,ru={box:[],offscreen:!1},_c=rt?2*Ss.length:Ss.length,gu=0;gu<_c;++gu){var ec=g.attemptAnchorPlacement(Ss[gu%Ss.length],ua,Xu,yc,Jl,Dt,fr,ue,F,ze,gu>=Ss.length,Cn,M,Cs,Qf);if(ec&&(ru=ec.placedGlyphBoxes)&&ru.box&&ru.box.length){mi=!0,li=ec.shift;break}}return ru};il(function(){return du(Eo,Ei.iconBox,y.WritingMode.horizontal)},function(){var ua=Ei.verticalTextBox;return M.allowVerticalPlacement&&!(ti&&ti.box&&ti.box.length)&&Cn.numVerticalGlyphVertices>0&&ua?du(ua,Ei.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),ti&&(mi=ti.box,Ti=ti.offscreen);var Kl=fs(ti&&ti.box);if(!mi&&g.prevPlacement){var Il=g.prevPlacement.variableOffsets[Cn.crossTileID];Il&&(g.variableOffsets[Cn.crossTileID]=Il,g.markUsedJustification(M,Il.anchor,Cn,Kl))}}else{var al=function(ua,Gs){var Cs=g.collisionIndex.placeCollisionBox(ua,rt,ue,F,ze.predicate);return Cs&&Cs.box&&Cs.box.length&&(g.markUsedOrientation(M,Gs,Cn),g.placedOrientations[Cn.crossTileID]=Gs),Cs};il(function(){return al(Eo,y.WritingMode.horizontal)},function(){var ua=Ei.verticalTextBox;return M.allowVerticalPlacement&&Cn.numVerticalGlyphVertices>0&&ua?al(ua,y.WritingMode.vertical):{box:null,offscreen:null}}),fs(ti&&ti.box&&ti.box.length)}}if(mi=(Si=ti)&&Si.box&&Si.box.length>0,Ti=Si&&Si.offscreen,Cn.useRuntimeCollisionCircles){var mc=M.text.placedSymbolArray.get(Cn.centerJustifiedTextSymbolIndex),gc=y.evaluateSizeForFeature(M.textSizeData,je,mc),vu=k.get("text-padding");ro=g.collisionIndex.placeCollisionCircles(rt,mc,M.lineVertexArray,M.glyphOffsetArray,gc,F,G,X,h,fr,ze.predicate,Cn.collisionCircleDiameter,vu),mi=rt||ro.circles.length>0&&!ro.collisionDetected,Ti=Ti&&ro.offscreen}if(Ei.iconFeatureIndex&&(yo=Ei.iconFeatureIndex),Ei.iconBox){var Ql=function(ua){var Gs=nr&&li?Yo(ua,li.x,li.y,Dt,fr,g.transform.angle):ua;return g.collisionIndex.placeCollisionBox(Gs,mt,ue,F,ze.predicate)};ai=bo&&bo.box&&bo.box.length&&Ei.verticalIconBox?(Ko=Ql(Ei.verticalIconBox)).box.length>0:(Ko=Ql(Ei.iconBox)).box.length>0,Ti=Ti&&Ko.offscreen}var Au=nt||Cn.numHorizontalGlyphVertices===0&&Cn.numVerticalGlyphVertices===0,Po=Be||Cn.numIconVertices===0;if(Au||Po?Po?Au||(ai=ai&&mi):mi=ai&&mi:ai=mi=ai&&mi,mi&&Si&&Si.box&&g.collisionIndex.insertCollisionBox(Si.box,k.get("text-ignore-placement"),M.bucketInstanceId,bo&&bo.box&&Ya?Ya:Qo,ze.ID),ai&&Ko&&g.collisionIndex.insertCollisionBox(Ko.box,k.get("icon-ignore-placement"),M.bucketInstanceId,yo,ze.ID),ro&&(mi&&g.collisionIndex.insertCollisionCircles(ro.circles,k.get("text-ignore-placement"),M.bucketInstanceId,Qo,ze.ID),h)){var Wu=M.bucketInstanceId,ol=g.collisionCircleArrays[Wu];ol===void 0&&(ol=g.collisionCircleArrays[Wu]=new To);for(var mu=0;mu<ro.circles.length;mu+=4)ol.circles.push(ro.circles[mu+0]),ol.circles.push(ro.circles[mu+1]),ol.circles.push(ro.circles[mu+2]),ol.circles.push(ro.collisionDetected?1:0)}g.placements[Cn.crossTileID]=new bu(mi||Ir,ai||tn,Ti||M.justReloaded),d[Cn.crossTileID]=!0}};if(dr)for(var bn=M.getSortedSymbolIndexes(this.transform.angle),Qn=bn.length-1;Qn>=0;--Qn){var $n=bn[Qn];$r(M.symbolInstances.get($n),M.collisionArrays[$n])}else for(var ei=f.symbolInstanceStart;ei<f.symbolInstanceEnd;ei++)$r(M.symbolInstances.get(ei),M.collisionArrays[ei]);if(h&&M.bucketInstanceId in this.collisionCircleArrays){var Fi=this.collisionCircleArrays[M.bucketInstanceId];y.invert(Fi.invProjMatrix,F),Fi.viewportMatrix=this.collisionIndex.getViewportMatrix()}M.justReloaded=!1},qa.prototype.markUsedJustification=function(f,d,h,g){var S;S=g===y.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(d)];for(var M=0,k=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];M<k.length;M+=1){var F=k[M];F>=0&&(f.text.placedSymbolArray.get(F).crossTileID=S>=0&&F!==S?0:h.crossTileID)}},qa.prototype.markUsedOrientation=function(f,d,h){for(var g=d===y.WritingMode.horizontal||d===y.WritingMode.horizontalOnly?d:0,S=d===y.WritingMode.vertical?d:0,M=0,k=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];M<k.length;M+=1)f.text.placedSymbolArray.get(k[M]).placedOrientation=g;h.verticalPlacedTextSymbolIndex&&(f.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=S)},qa.prototype.commit=function(f){this.commitTime=f,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,h=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var g=d?d.symbolFadeChange(f):1,S=d?d.opacities:{},M=d?d.variableOffsets:{},k=d?d.placedOrientations:{};for(var F in this.placements){var G=this.placements[F],X=S[F];X?(this.opacities[F]=new rs(X,g,G.text,G.icon),h=h||G.text!==X.text.placed||G.icon!==X.icon.placed):(this.opacities[F]=new rs(null,g,G.text,G.icon,G.skipFade),h=h||G.text||G.icon)}for(var ue in S){var Ee=S[ue];if(!this.opacities[ue]){var te=new rs(Ee,g,!1,!1);te.isHidden()||(this.opacities[ue]=te,h=h||Ee.text.placed||Ee.icon.placed)}}for(var je in M)this.variableOffsets[je]||!this.opacities[je]||this.opacities[je].isHidden()||(this.variableOffsets[je]=M[je]);for(var ze in k)this.placedOrientations[ze]||!this.opacities[ze]||this.opacities[ze].isHidden()||(this.placedOrientations[ze]=k[ze]);h?this.lastPlacementChangeTime=f:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:f)},qa.prototype.updateLayerOpacities=function(f,d){for(var h={},g=0,S=d;g<S.length;g+=1){var M=S[g],k=M.getBucket(f);k&&M.latestFeatureIndex&&f.id===k.layerIds[0]&&this.updateBucketOpacities(k,h,M.collisionBoxArray)}},qa.prototype.updateBucketOpacities=function(f,d,h){var g=this;f.hasTextData()&&f.text.opacityVertexArray.clear(),f.hasIconData()&&f.icon.opacityVertexArray.clear(),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexArray.clear(),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexArray.clear();var S=f.layers[0].layout,M=new rs(null,0,!1,!1,!0),k=S.get("text-allow-overlap"),F=S.get("icon-allow-overlap"),G=S.get("text-variable-anchor"),X=S.get("text-rotation-alignment")==="map",ue=S.get("text-pitch-alignment")==="map",Ee=S.get("icon-text-fit")!=="none",te=new rs(null,0,k&&(F||!f.hasIconData()||S.get("icon-optional")),F&&(k||!f.hasTextData()||S.get("text-optional")),!0);!f.collisionArrays&&h&&(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData())&&f.deserializeCollisionBoxes(h);for(var je=function(rt,mt,Dt){for(var fr=0;fr<mt/4;fr++)rt.opacityVertexArray.emplaceBack(Dt)},ze=function(rt){var mt=f.symbolInstances.get(rt),Dt=mt.numHorizontalGlyphVertices,fr=mt.numVerticalGlyphVertices,nr=mt.crossTileID,dr=g.opacities[nr];d[nr]?dr=M:dr||(g.opacities[nr]=dr=te),d[nr]=!0;var Ir=mt.numIconVertices>0,tn=g.placedOrientations[mt.crossTileID],$r=tn===y.WritingMode.vertical,bn=tn===y.WritingMode.horizontal||tn===y.WritingMode.horizontalOnly;if(Dt>0||fr>0){var Qn=Gn(dr.text);je(f.text,Dt,$r?Oi:Qn),je(f.text,fr,bn?Oi:Qn);var $n=dr.text.isHidden();[mt.rightJustifiedTextSymbolIndex,mt.centerJustifiedTextSymbolIndex,mt.leftJustifiedTextSymbolIndex].forEach(function(ti){ti>=0&&(f.text.placedSymbolArray.get(ti).hidden=$n||$r?1:0)}),mt.verticalPlacedTextSymbolIndex>=0&&(f.text.placedSymbolArray.get(mt.verticalPlacedTextSymbolIndex).hidden=$n||bn?1:0);var ei=g.variableOffsets[mt.crossTileID];ei&&g.markUsedJustification(f,ei.anchor,mt,tn);var Fi=g.placedOrientations[mt.crossTileID];Fi&&(g.markUsedJustification(f,"left",mt,Fi),g.markUsedOrientation(f,Fi,mt))}if(Ir){var Cn=Gn(dr.icon),Ei=!(Ee&&mt.verticalPlacedIconSymbolIndex&&$r);mt.placedIconSymbolIndex>=0&&(je(f.icon,mt.numIconVertices,Ei?Cn:Oi),f.icon.placedSymbolArray.get(mt.placedIconSymbolIndex).hidden=dr.icon.isHidden()),mt.verticalPlacedIconSymbolIndex>=0&&(je(f.icon,mt.numVerticalIconVertices,Ei?Oi:Cn),f.icon.placedSymbolArray.get(mt.verticalPlacedIconSymbolIndex).hidden=dr.icon.isHidden())}if(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData()){var Si=f.collisionArrays[rt];if(Si){var mi=new y.Point(0,0);if(Si.textBox||Si.verticalTextBox){var ai=!0;if(G){var Ti=g.variableOffsets[nr];Ti?(mi=to(Ti.anchor,Ti.width,Ti.height,Ti.textOffset,Ti.textBoxScale),X&&mi._rotate(ue?g.transform.angle:-g.transform.angle)):ai=!1}Si.textBox&&$s(f.textCollisionBox.collisionVertexArray,dr.text.placed,!ai||$r,mi.x,mi.y),Si.verticalTextBox&&$s(f.textCollisionBox.collisionVertexArray,dr.text.placed,!ai||bn,mi.x,mi.y)}var li=Boolean(!bn&&Si.verticalIconBox);Si.iconBox&&$s(f.iconCollisionBox.collisionVertexArray,dr.icon.placed,li,Ee?mi.x:0,Ee?mi.y:0),Si.verticalIconBox&&$s(f.iconCollisionBox.collisionVertexArray,dr.icon.placed,!li,Ee?mi.x:0,Ee?mi.y:0)}}},nt=0;nt<f.symbolInstances.length;nt++)ze(nt);if(f.sortFeatures(this.transform.angle),this.retainedQueryData[f.bucketInstanceId]&&(this.retainedQueryData[f.bucketInstanceId].featureSortOrder=f.featureSortOrder),f.hasTextData()&&f.text.opacityVertexBuffer&&f.text.opacityVertexBuffer.updateData(f.text.opacityVertexArray),f.hasIconData()&&f.icon.opacityVertexBuffer&&f.icon.opacityVertexBuffer.updateData(f.icon.opacityVertexArray),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexBuffer&&f.iconCollisionBox.collisionVertexBuffer.updateData(f.iconCollisionBox.collisionVertexArray),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexBuffer&&f.textCollisionBox.collisionVertexBuffer.updateData(f.textCollisionBox.collisionVertexArray),f.bucketInstanceId in this.collisionCircleArrays){var Be=this.collisionCircleArrays[f.bucketInstanceId];f.placementInvProjMatrix=Be.invProjMatrix,f.placementViewportMatrix=Be.viewportMatrix,f.collisionCircleArray=Be.circles,delete this.collisionCircleArrays[f.bucketInstanceId]}},qa.prototype.symbolFadeChange=function(f){return this.fadeDuration===0?1:(f-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},qa.prototype.zoomAdjustment=function(f){return Math.max(0,(this.transform.zoom-f)/1.5)},qa.prototype.hasTransitions=function(f){return this.stale||f-this.lastPlacementChangeTime<this.fadeDuration},qa.prototype.stillRecent=function(f,d){var h=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*h>f},qa.prototype.setStale=function(){this.stale=!0};var Ll=Math.pow(2,25),ns=Math.pow(2,24),he=Math.pow(2,17),Pe=Math.pow(2,16),ct=Math.pow(2,9),Yt=Math.pow(2,8),Yr=Math.pow(2,1);function Gn(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;var d=f.placed?1:0,h=Math.floor(127*f.opacity);return h*Ll+d*ns+h*he+d*Pe+h*ct+d*Yt+h*Yr+d}var Oi=0,uo=function(f){this._sortAcrossTiles=f.layout.get("symbol-z-order")!=="viewport-y"&&f.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};uo.prototype.continuePlacement=function(f,d,h,g,S){for(var M=this._bucketParts;this._currentTileIndex<f.length;)if(d.getBucketParts(M,g,f[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort(function(k,F){return k.sortKey-F.sortKey}));this._currentPartIndex<M.length;)if(d.placeLayerBucketPart(M[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,S())return!0;return!1};var Na=function(f,d,h,g,S,M,k){this.placement=new qa(f,S,M,k),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1};Na.prototype.isDone=function(){return this._done},Na.prototype.continuePlacement=function(f,d,h){for(var g=this,S=y.browser.now(),M=function(){var G=y.browser.now()-S;return!g._forceFullPlacement&&G>2};this._currentPlacementIndex>=0;){var k=d[f[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=F)&&(!k.maxzoom||k.maxzoom>F)){if(this._inProgressLayer||(this._inProgressLayer=new uo(k)),this._inProgressLayer.continuePlacement(h[k.source],this.placement,this._showCollisionBoxes,k,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Na.prototype.commit=function(f){return this.placement.commit(f),this.placement};var Ka=512/y.EXTENT/2,is=function(f,d,h){this.tileID=f,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(var g=0;g<d.length;g++){var S=d.get(g),M=S.key;this.indexedSymbolInstances[M]||(this.indexedSymbolInstances[M]=[]),this.indexedSymbolInstances[M].push({crossTileID:S.crossTileID,coord:this.getScaledCoordinates(S,f)})}};is.prototype.getScaledCoordinates=function(f,d){var h=Ka/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*y.EXTENT+f.anchorX)*h),y:Math.floor((d.canonical.y*y.EXTENT+f.anchorY)*h)}},is.prototype.findMatches=function(f,d,h){for(var g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),S=0;S<f.length;S++){var M=f.get(S);if(!M.crossTileID){var k=this.indexedSymbolInstances[M.key];if(k)for(var F=this.getScaledCoordinates(M,d),G=0,X=k;G<X.length;G+=1){var ue=X[G];if(Math.abs(ue.coord.x-F.x)<=g&&Math.abs(ue.coord.y-F.y)<=g&&!h[ue.crossTileID]){h[ue.crossTileID]=!0,M.crossTileID=ue.crossTileID;break}}}}};var Uo=function(){this.maxCrossTileID=0};Uo.prototype.generate=function(){return++this.maxCrossTileID};var vo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};vo.prototype.handleWrapJump=function(f){var d=Math.round((f-this.lng)/360);if(d!==0)for(var h in this.indexes){var g=this.indexes[h],S={};for(var M in g){var k=g[M];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+d),S[k.tileID.key]=k}this.indexes[h]=S}this.lng=f},vo.prototype.addBucket=function(f,d,h){if(this.indexes[f.overscaledZ]&&this.indexes[f.overscaledZ][f.key]){if(this.indexes[f.overscaledZ][f.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(f.overscaledZ,this.indexes[f.overscaledZ][f.key])}for(var g=0;g<d.symbolInstances.length;g++)d.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[f.overscaledZ]||(this.usedCrossTileIDs[f.overscaledZ]={});var S=this.usedCrossTileIDs[f.overscaledZ];for(var M in this.indexes){var k=this.indexes[M];if(Number(M)>f.overscaledZ)for(var F in k){var G=k[F];G.tileID.isChildOf(f)&&G.findMatches(d.symbolInstances,f,S)}else{var X=k[f.scaledTo(Number(M)).key];X&&X.findMatches(d.symbolInstances,f,S)}}for(var ue=0;ue<d.symbolInstances.length;ue++){var Ee=d.symbolInstances.get(ue);Ee.crossTileID||(Ee.crossTileID=h.generate(),S[Ee.crossTileID]=!0)}return this.indexes[f.overscaledZ]===void 0&&(this.indexes[f.overscaledZ]={}),this.indexes[f.overscaledZ][f.key]=new is(f,d.symbolInstances,d.bucketInstanceId),!0},vo.prototype.removeBucketCrossTileIDs=function(f,d){for(var h in d.indexedSymbolInstances)for(var g=0,S=d.indexedSymbolInstances[h];g<S.length;g+=1)delete this.usedCrossTileIDs[f][S[g].crossTileID]},vo.prototype.removeStaleBuckets=function(f){var d=!1;for(var h in this.indexes){var g=this.indexes[h];for(var S in g)f[g[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,g[S]),delete g[S],d=!0)}return d};var Ps=function(){this.layerIndexes={},this.crossTileIDs=new Uo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Ps.prototype.addLayer=function(f,d,h){var g=this.layerIndexes[f.id];g===void 0&&(g=this.layerIndexes[f.id]=new vo);var S=!1,M={};g.handleWrapJump(h);for(var k=0,F=d;k<F.length;k+=1){var G=F[k],X=G.getBucket(f);X&&f.id===X.layerIds[0]&&(X.bucketInstanceId||(X.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(G.tileID,X,this.crossTileIDs)&&(S=!0),M[X.bucketInstanceId]=!0)}return g.removeStaleBuckets(M)&&(S=!0),S},Ps.prototype.pruneUnusedLayers=function(f){var d={};for(var h in f.forEach(function(g){d[g]=!0}),this.layerIndexes)d[h]||delete this.layerIndexes[h]};var Ls=function(f,d){return y.emitValidationErrors(f,d&&d.filter(function(h){return h.identifier!=="source.canvas"}))},Rs=y.pick(pn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),qs=y.pick(pn,["setCenter","setZoom","setBearing","setPitch"]),uu=function(){var f={},d=y.styleSpec.$version;for(var h in y.styleSpec.$root){var g,S=y.styleSpec.$root[h];S.required&&(g=h==="version"?d:S.type==="array"?[]:{})!=null&&(f[h]=g)}return f}(),gs=function(f){function d(h,g){var S=this;g===void 0&&(g={}),f.call(this),this.map=h,this.dispatcher=new lr(Ht(),this),this.imageManager=new xt,this.imageManager.setEventedParent(this),this.glyphManager=new ur(h._requestManager,g.localIdeographFontFamily),this.lineAtlas=new pt(256,512),this.crossTileSymbolIndex=new Ps,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var M=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(k){M.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:k.pluginStatus,pluginURL:k.pluginURL},function(F,G){if(y.triggerPluginCompletionEvent(F),G&&G.every(function(ue){return ue}))for(var X in M.sourceCaches)M.sourceCaches[X].reload()})}),this.on("data",function(k){if(k.dataType==="source"&&k.sourceDataType==="metadata"){var F=S.sourceCaches[k.sourceId];if(F){var G=F.getSource();if(G&&G.vectorLayerIds)for(var X in S._layers){var ue=S._layers[X];ue.source===G.id&&S._validateLayer(ue)}}}})}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.loadURL=function(h,g){var S=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var M=typeof g.validate=="boolean"?g.validate:!y.isMapboxURL(h);h=this.map._requestManager.normalizeStyleURL(h,g.accessToken);var k=this.map._requestManager.transformRequest(h,y.ResourceType.Style);this._request=y.getJSON(k,function(F,G){S._request=null,F?S.fire(new y.ErrorEvent(F)):G&&S._load(G,M)})},d.prototype.loadJSON=function(h,g){var S=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){S._request=null,S._load(h,g.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(uu,!1)},d.prototype._load=function(h,g){if(!g||!Ls(this,y.validateStyle(h))){for(var S in this._loaded=!0,this.stylesheet=h,h.sources)this.addSource(S,h.sources[S],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs);var M=sn(this.stylesheet.layers);this._order=M.map(function(X){return X.id}),this._layers={},this._serializedLayers={};for(var k=0,F=M;k<F.length;k+=1){var G=F[k];(G=y.createStyleLayer(G)).setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G,this._serializedLayers[G.id]=G.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ot(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},d.prototype._loadSprite=function(h){var g=this;this._spriteRequest=function(S,M,k){var F,G,X,ue=y.browser.devicePixelRatio>1?"@2x":"",Ee=y.getJSON(M.transformRequest(M.normalizeSpriteURL(S,ue,".json"),y.ResourceType.SpriteJSON),function(ze,nt){Ee=null,X||(X=ze,F=nt,je())}),te=y.getImage(M.transformRequest(M.normalizeSpriteURL(S,ue,".png"),y.ResourceType.SpriteImage),function(ze,nt){te=null,X||(X=ze,G=nt,je())});function je(){if(X)k(X);else if(F&&G){var ze=y.browser.getImageData(G),nt={};for(var Be in F){var rt=F[Be],mt=rt.width,Dt=rt.height,fr=rt.x,nr=rt.y,dr=rt.sdf,Ir=rt.pixelRatio,tn=rt.stretchX,$r=rt.stretchY,bn=rt.content,Qn=new y.RGBAImage({width:mt,height:Dt});y.RGBAImage.copy(ze,Qn,{x:fr,y:nr},{x:0,y:0},{width:mt,height:Dt}),nt[Be]={data:Qn,pixelRatio:Ir,sdf:dr,stretchX:tn,stretchY:$r,content:bn}}k(null,nt)}}return{cancel:function(){Ee&&(Ee.cancel(),Ee=null),te&&(te.cancel(),te=null)}}}(h,this.map._requestManager,function(S,M){if(g._spriteRequest=null,S)g.fire(new y.ErrorEvent(S));else if(M)for(var k in M)g.imageManager.addImage(k,M[k]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new y.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(h){var g=this.sourceCaches[h.source];if(g){var S=h.sourceLayer;if(S){var M=g.getSource();(M.type==="geojson"||M.vectorLayerIds&&M.vectorLayerIds.indexOf(S)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+S+'" does not exist on source "'+M.id+'" as specified by style layer "'+h.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var h in this.sourceCaches)if(!this.sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(h){for(var g=[],S=0,M=h;S<M.length;S+=1){var k=this._layers[M[S]];k.type!=="custom"&&g.push(k.serialize())}return g},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(h){if(this._loaded){var g=this._changed;if(this._changed){var S=Object.keys(this._updatedLayers),M=Object.keys(this._removedLayers);for(var k in(S.length||M.length)&&this._updateWorkerLayers(S,M),this._updatedSources){var F=this._updatedSources[k];F==="reload"?this._reloadSource(k):F==="clear"&&this._clearSource(k)}for(var G in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[G].updateTransitions(h);this.light.updateTransitions(h),this._resetUpdates()}var X={};for(var ue in this.sourceCaches){var Ee=this.sourceCaches[ue];X[ue]=Ee.used,Ee.used=!1}for(var te=0,je=this._order;te<je.length;te+=1){var ze=this._layers[je[te]];ze.recalculate(h,this._availableImages),!ze.isHidden(h.zoom)&&ze.source&&(this.sourceCaches[ze.source].used=!0)}for(var nt in X){var Be=this.sourceCaches[nt];X[nt]!==Be.used&&Be.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:nt}))}this.light.recalculate(h),this.z=h.zoom,g&&this.fire(new y.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var h=Object.keys(this._changedImages);if(h.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}},d.prototype._updateWorkerLayers=function(h,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(h),removedIds:g})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(h){var g=this;if(this._checkLoaded(),Ls(this,y.validateStyle(h)))return!1;(h=y.clone$1(h)).layers=sn(h.layers);var S=function(k,F){if(!k)return[{command:pn.setStyle,args:[F]}];var G=[];try{if(!y.deepEqual(k.version,F.version))return[{command:pn.setStyle,args:[F]}];y.deepEqual(k.center,F.center)||G.push({command:pn.setCenter,args:[F.center]}),y.deepEqual(k.zoom,F.zoom)||G.push({command:pn.setZoom,args:[F.zoom]}),y.deepEqual(k.bearing,F.bearing)||G.push({command:pn.setBearing,args:[F.bearing]}),y.deepEqual(k.pitch,F.pitch)||G.push({command:pn.setPitch,args:[F.pitch]}),y.deepEqual(k.sprite,F.sprite)||G.push({command:pn.setSprite,args:[F.sprite]}),y.deepEqual(k.glyphs,F.glyphs)||G.push({command:pn.setGlyphs,args:[F.glyphs]}),y.deepEqual(k.transition,F.transition)||G.push({command:pn.setTransition,args:[F.transition]}),y.deepEqual(k.light,F.light)||G.push({command:pn.setLight,args:[F.light]});var X={},ue=[];(function(te,je,ze,nt){var Be;for(Be in je=je||{},te=te||{})te.hasOwnProperty(Be)&&(je.hasOwnProperty(Be)||yn(Be,ze,nt));for(Be in je)je.hasOwnProperty(Be)&&(te.hasOwnProperty(Be)?y.deepEqual(te[Be],je[Be])||(te[Be].type==="geojson"&&je[Be].type==="geojson"&&aa(te,je,Be)?ze.push({command:pn.setGeoJSONSourceData,args:[Be,je[Be].data]}):Pi(Be,je,ze,nt)):bi(Be,je,ze))})(k.sources,F.sources,ue,X);var Ee=[];k.layers&&k.layers.forEach(function(te){X[te.source]?G.push({command:pn.removeLayer,args:[te.id]}):Ee.push(te)}),G=G.concat(ue),function(te,je,ze){je=je||[];var nt,Be,rt,mt,Dt,fr,nr,dr=(te=te||[]).map(yt),Ir=je.map(yt),tn=te.reduce(Ii,{}),$r=je.reduce(Ii,{}),bn=dr.slice(),Qn=Object.create(null);for(nt=0,Be=0;nt<dr.length;nt++)$r.hasOwnProperty(rt=dr[nt])?Be++:(ze.push({command:pn.removeLayer,args:[rt]}),bn.splice(bn.indexOf(rt,Be),1));for(nt=0,Be=0;nt<Ir.length;nt++)bn[bn.length-1-nt]!==(rt=Ir[Ir.length-1-nt])&&(tn.hasOwnProperty(rt)?(ze.push({command:pn.removeLayer,args:[rt]}),bn.splice(bn.lastIndexOf(rt,bn.length-Be),1)):Be++,ze.push({command:pn.addLayer,args:[$r[rt],fr=bn[bn.length-nt]]}),bn.splice(bn.length-nt,0,rt),Qn[rt]=!0);for(nt=0;nt<Ir.length;nt++)if(mt=tn[rt=Ir[nt]],Dt=$r[rt],!Qn[rt]&&!y.deepEqual(mt,Dt))if(y.deepEqual(mt.source,Dt.source)&&y.deepEqual(mt["source-layer"],Dt["source-layer"])&&y.deepEqual(mt.type,Dt.type)){for(nr in vt(mt.layout,Dt.layout,ze,rt,null,pn.setLayoutProperty),vt(mt.paint,Dt.paint,ze,rt,null,pn.setPaintProperty),y.deepEqual(mt.filter,Dt.filter)||ze.push({command:pn.setFilter,args:[rt,Dt.filter]}),y.deepEqual(mt.minzoom,Dt.minzoom)&&y.deepEqual(mt.maxzoom,Dt.maxzoom)||ze.push({command:pn.setLayerZoomRange,args:[rt,Dt.minzoom,Dt.maxzoom]}),mt)mt.hasOwnProperty(nr)&&nr!=="layout"&&nr!=="paint"&&nr!=="filter"&&nr!=="metadata"&&nr!=="minzoom"&&nr!=="maxzoom"&&(nr.indexOf("paint.")===0?vt(mt[nr],Dt[nr],ze,rt,nr.slice(6),pn.setPaintProperty):y.deepEqual(mt[nr],Dt[nr])||ze.push({command:pn.setLayerProperty,args:[rt,nr,Dt[nr]]}));for(nr in Dt)Dt.hasOwnProperty(nr)&&!mt.hasOwnProperty(nr)&&nr!=="layout"&&nr!=="paint"&&nr!=="filter"&&nr!=="metadata"&&nr!=="minzoom"&&nr!=="maxzoom"&&(nr.indexOf("paint.")===0?vt(mt[nr],Dt[nr],ze,rt,nr.slice(6),pn.setPaintProperty):y.deepEqual(mt[nr],Dt[nr])||ze.push({command:pn.setLayerProperty,args:[rt,nr,Dt[nr]]}))}else ze.push({command:pn.removeLayer,args:[rt]}),fr=bn[bn.lastIndexOf(rt)+1],ze.push({command:pn.addLayer,args:[Dt,fr]})}(Ee,F.layers,G)}catch(te){console.warn("Unable to compute style diff:",te),G=[{command:pn.setStyle,args:[F]}]}return G}(this.serialize(),h).filter(function(k){return!(k.command in qs)});if(S.length===0)return!1;var M=S.filter(function(k){return!(k.command in Rs)});if(M.length>0)throw new Error("Unimplemented: "+M.map(function(k){return k.command}).join(", ")+".");return S.forEach(function(k){k.command!=="setTransition"&&g[k.command].apply(g,k.args)}),this.stylesheet=h,!0},d.prototype.addImage=function(h,g){if(this.getImage(h))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(h,g),this._afterImageUpdated(h)},d.prototype.updateImage=function(h,g){this.imageManager.updateImage(h,g)},d.prototype.getImage=function(h){return this.imageManager.getImage(h)},d.prototype.removeImage=function(h){if(!this.getImage(h))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(h),this._afterImageUpdated(h)},d.prototype._afterImageUpdated=function(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(h,g,S){var M=this;if(S===void 0&&(S={}),this._checkLoaded(),this.sourceCaches[h]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(y.validateStyle.source,"sources."+h,g,null,S))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var k=this.sourceCaches[h]=new He(h,g,this.dispatcher);k.style=this,k.setEventedParent(this,function(){return{isSourceLoaded:M.loaded(),source:k.serialize(),sourceId:h}}),k.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(h){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===h)return this.fire(new y.ErrorEvent(new Error('Source "'+h+'" cannot be removed while layer "'+g+'" is using it.')));var S=this.sourceCaches[h];delete this.sourceCaches[h],delete this._updatedSources[h],S.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:h})),S.setEventedParent(null),S.clearTiles(),S.onRemove&&S.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(h,g){this._checkLoaded(),this.sourceCaches[h].getSource().setData(g),this._changed=!0},d.prototype.getSource=function(h){return this.sourceCaches[h]&&this.sourceCaches[h].getSource()},d.prototype.addLayer=function(h,g,S){S===void 0&&(S={}),this._checkLoaded();var M=h.id;if(this.getLayer(M))this.fire(new y.ErrorEvent(new Error('Layer with id "'+M+'" already exists on this map')));else{var k;if(h.type==="custom"){if(Ls(this,y.validateCustomStyleLayer(h)))return;k=y.createStyleLayer(h)}else{if(typeof h.source=="object"&&(this.addSource(M,h.source),h=y.clone$1(h),h=y.extend(h,{source:M})),this._validate(y.validateStyle.layer,"layers."+M,h,{arrayIndex:-1},S))return;k=y.createStyleLayer(h),this._validateLayer(k),k.setEventedParent(this,{layer:{id:M}}),this._serializedLayers[k.id]=k.serialize()}var F=g?this._order.indexOf(g):this._order.length;if(g&&F===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(F,0,M),this._layerOrderChanged=!0,this._layers[M]=k,this._removedLayers[M]&&k.source&&k.type!=="custom"){var G=this._removedLayers[M];delete this._removedLayers[M],G.type!==k.type?this._updatedSources[k.source]="clear":(this._updatedSources[k.source]="reload",this.sourceCaches[k.source].pause())}this._updateLayer(k),k.onAdd&&k.onAdd(this.map)}}},d.prototype.moveLayer=function(h,g){if(this._checkLoaded(),this._changed=!0,this._layers[h]){if(h!==g){var S=this._order.indexOf(h);this._order.splice(S,1);var M=g?this._order.indexOf(g):this._order.length;g&&M===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(M,0,h),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(h){this._checkLoaded();var g=this._layers[h];if(g){g.setEventedParent(null);var S=this._order.indexOf(h);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=g,delete this._layers[h],delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],g.onRemove&&g.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(h){return this._layers[h]},d.prototype.hasLayer=function(h){return h in this._layers},d.prototype.setLayerZoomRange=function(h,g,S){this._checkLoaded();var M=this.getLayer(h);M?M.minzoom===g&&M.maxzoom===S||(g!=null&&(M.minzoom=g),S!=null&&(M.maxzoom=S),this._updateLayer(M)):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(h,g,S){S===void 0&&(S={}),this._checkLoaded();var M=this.getLayer(h);if(M){if(!y.deepEqual(M.filter,g))return g==null?(M.filter=void 0,void this._updateLayer(M)):void(this._validate(y.validateStyle.filter,"layers."+M.id+".filter",g,null,S)||(M.filter=y.clone$1(g),this._updateLayer(M)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(h){return y.clone$1(this.getLayer(h).filter)},d.prototype.setLayoutProperty=function(h,g,S,M){M===void 0&&(M={}),this._checkLoaded();var k=this.getLayer(h);k?y.deepEqual(k.getLayoutProperty(g),S)||(k.setLayoutProperty(g,S,M),this._updateLayer(k)):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(h,g){var S=this.getLayer(h);if(S)return S.getLayoutProperty(g);this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(h,g,S,M){M===void 0&&(M={}),this._checkLoaded();var k=this.getLayer(h);k?y.deepEqual(k.getPaintProperty(g),S)||(k.setPaintProperty(g,S,M)&&this._updateLayer(k),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(h,g){return this.getLayer(h).getPaintProperty(g)},d.prototype.setFeatureState=function(h,g){this._checkLoaded();var S=h.source,M=h.sourceLayer,k=this.sourceCaches[S];if(k!==void 0){var F=k.getSource().type;F==="geojson"&&M?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):F!=="vector"||M?(h.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),k.setFeatureState(M,h.id,g)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(h,g){this._checkLoaded();var S=h.source,M=this.sourceCaches[S];if(M!==void 0){var k=M.getSource().type,F=k==="vector"?h.sourceLayer:void 0;k!=="vector"||F?g&&typeof h.id!="string"&&typeof h.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):M.removeFeatureState(F,h.id,g):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(h){this._checkLoaded();var g=h.source,S=h.sourceLayer,M=this.sourceCaches[g];if(M!==void 0){if(M.getSource().type!=="vector"||S)return h.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),M.getFeatureState(S,h.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(h){return h.serialize()}),layers:this._serializeLayers(this._order)},function(h){return h!==void 0})},d.prototype._updateLayer=function(h){this._updatedLayers[h.id]=!0,h.source&&!this._updatedSources[h.source]&&this.sourceCaches[h.source].getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(h){for(var g=this,S=function(tn){return g._layers[tn].type==="fill-extrusion"},M={},k=[],F=this._order.length-1;F>=0;F--){var G=this._order[F];if(S(G)){M[G]=F;for(var X=0,ue=h;X<ue.length;X+=1){var Ee=ue[X][G];if(Ee)for(var te=0,je=Ee;te<je.length;te+=1)k.push(je[te])}}}k.sort(function(tn,$r){return $r.intersectionZ-tn.intersectionZ});for(var ze=[],nt=this._order.length-1;nt>=0;nt--){var Be=this._order[nt];if(S(Be))for(var rt=k.length-1;rt>=0;rt--){var mt=k[rt].feature;if(M[mt.layer.id]<nt)break;ze.push(mt),k.pop()}else for(var Dt=0,fr=h;Dt<fr.length;Dt+=1){var nr=fr[Dt][Be];if(nr)for(var dr=0,Ir=nr;dr<Ir.length;dr+=1)ze.push(Ir[dr].feature)}}return ze},d.prototype.queryRenderedFeatures=function(h,g,S){g&&g.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var M={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var k=0,F=g.layers;k<F.length;k+=1){var G=F[k],X=this._layers[G];if(!X)return this.fire(new y.ErrorEvent(new Error("The layer '"+G+"' does not exist in the map's style and cannot be queried for features."))),[];M[X.source]=!0}}var ue=[];for(var Ee in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!M[Ee]||ue.push(Dr(this.sourceCaches[Ee],this._layers,this._serializedLayers,h,g,S));return this.placement&&ue.push(function(te,je,ze,nt,Be,rt,mt){for(var Dt={},fr=rt.queryRenderedSymbols(nt),nr=[],dr=0,Ir=Object.keys(fr).map(Number);dr<Ir.length;dr+=1)nr.push(mt[Ir[dr]]);nr.sort(oi);for(var tn=function(){var ei=bn[$r],Fi=ei.featureIndex.lookupSymbolFeatures(fr[ei.bucketInstanceId],je,ei.bucketIndex,ei.sourceLayerIndex,Be.filter,Be.layers,Be.availableImages,te);for(var Cn in Fi){var Ei=Dt[Cn]=Dt[Cn]||[],Si=Fi[Cn];Si.sort(function(Ti,li){var ti=ei.featureSortOrder;if(ti){var bo=ti.indexOf(Ti.featureIndex);return ti.indexOf(li.featureIndex)-bo}return li.featureIndex-Ti.featureIndex});for(var mi=0,ai=Si;mi<ai.length;mi+=1)Ei.push(ai[mi])}},$r=0,bn=nr;$r<bn.length;$r+=1)tn();var Qn=function(ei){Dt[ei].forEach(function(Fi){var Cn=Fi.feature,Ei=ze[te[ei].source].getFeatureState(Cn.layer["source-layer"],Cn.id);Cn.source=Cn.layer.source,Cn.layer["source-layer"]&&(Cn.sourceLayer=Cn.layer["source-layer"]),Cn.state=Ei})};for(var $n in Dt)Qn($n);return Dt}(this._layers,this._serializedLayers,this.sourceCaches,h,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ue)},d.prototype.querySourceFeatures=function(h,g){g&&g.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var S=this.sourceCaches[h];return S?function(M,k){for(var F=M.getRenderableIds().map(function(je){return M.getTileByID(je)}),G=[],X={},ue=0;ue<F.length;ue++){var Ee=F[ue],te=Ee.tileID.canonical.key;X[te]||(X[te]=!0,Ee.querySourceFeatures(G,k))}return G}(S,g):[]},d.prototype.addSourceType=function(h,g,S){return d.getSourceType(h)?S(new Error('A source type called "'+h+'" already exists.')):(d.setSourceType(h,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:g.workerSourceURL},S):S(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(h,g){g===void 0&&(g={}),this._checkLoaded();var S=this.light.getLight(),M=!1;for(var k in h)if(!y.deepEqual(h[k],S[k])){M=!0;break}if(M){var F={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(h,g),this.light.updateTransitions(F)}},d.prototype._validate=function(h,g,S,M,k){return k===void 0&&(k={}),(!k||k.validate!==!1)&&Ls(this,h.call(y.validateStyle,y.extend({key:g,style:this.serialize(),value:S,styleSpec:y.styleSpec},M)))},d.prototype._remove=function(){for(var h in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[h].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(h){this.sourceCaches[h].clearTiles()},d.prototype._reloadSource=function(h){this.sourceCaches[h].resume(),this.sourceCaches[h].reload()},d.prototype._updateSources=function(h){for(var g in this.sourceCaches)this.sourceCaches[g].update(h)},d.prototype._generateCollisionBoxes=function(){for(var h in this.sourceCaches)this._reloadSource(h)},d.prototype._updatePlacement=function(h,g,S,M,k){k===void 0&&(k=!1);for(var F=!1,G=!1,X={},ue=0,Ee=this._order;ue<Ee.length;ue+=1){var te=this._layers[Ee[ue]];if(te.type==="symbol"){if(!X[te.source]){var je=this.sourceCaches[te.source];X[te.source]=je.getRenderableIds(!0).map(function(mt){return je.getTileByID(mt)}).sort(function(mt,Dt){return Dt.tileID.overscaledZ-mt.tileID.overscaledZ||(mt.tileID.isLessThan(Dt.tileID)?-1:1)})}var ze=this.crossTileSymbolIndex.addLayer(te,X[te.source],h.center.lng);F=F||ze}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((k=k||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),h.zoom))&&(this.pauseablePlacement=new Na(h,this._order,k,g,S,M,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,X),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),G=!0),F&&this.pauseablePlacement.placement.setStale()),G||F)for(var nt=0,Be=this._order;nt<Be.length;nt+=1){var rt=this._layers[Be[nt]];rt.type==="symbol"&&this.placement.updateLayerOpacities(rt,X[rt.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var h in this.sourceCaches)this.sourceCaches[h].releaseSymbolFadeTiles()},d.prototype.getImages=function(h,g,S){this.imageManager.getImages(g.icons,S),this._updateTilesForChangedImages();var M=this.sourceCaches[g.source];M&&M.setDependencies(g.tileID.key,g.type,g.icons)},d.prototype.getGlyphs=function(h,g,S){this.glyphManager.getGlyphs(g.stacks,S)},d.prototype.getResource=function(h,g,S){return y.makeRequest(g,S)},d}(y.Evented);gs.getSourceType=function(f){return Qt[f]},gs.setSourceType=function(f,d){Qt[f]=d},gs.registerForPluginStateChange=y.registerForPluginStateChange;var zi=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),Pa=$i(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Nc=$i(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),cf=$i(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Os=$i(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),ff=$i("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ml=$i(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),el=$i(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ks=$i("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Rl=$i("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),x=$i("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),I=$i(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),U=$i(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),R=$i(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ne=$i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),ke=$i(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),it=$i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Pt=$i(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Lt=$i(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),yr=$i(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Lr=$i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Hn=$i(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Jn=$i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),vi=$i(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Yi=$i(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ba=$i(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ra=$i(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function $i(f,d){var h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=d.match(/attribute ([\w]+) ([\w]+)/g),S=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),k=M?M.concat(S):S,F={};return{fragmentSource:f=f.replace(h,function(G,X,ue,Ee,te){return F[te]=!0,X==="define"?`
#ifndef HAS_UNIFORM_u_`+te+`
varying `+ue+" "+Ee+" "+te+`;
#else
uniform `+ue+" "+Ee+" u_"+te+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+te+`
    `+ue+" "+Ee+" "+te+" = u_"+te+`;
#endif
`}),vertexSource:d=d.replace(h,function(G,X,ue,Ee,te){var je=Ee==="float"?"vec2":"vec4",ze=te.match(/color/)?"color":je;return F[te]?X==="define"?`
#ifndef HAS_UNIFORM_u_`+te+`
uniform lowp float u_`+te+`_t;
attribute `+ue+" "+je+" a_"+te+`;
varying `+ue+" "+Ee+" "+te+`;
#else
uniform `+ue+" "+Ee+" u_"+te+`;
#endif
`:ze==="vec4"?`
#ifndef HAS_UNIFORM_u_`+te+`
    `+te+" = a_"+te+`;
#else
    `+ue+" "+Ee+" "+te+" = u_"+te+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+te+`
    `+te+" = unpack_mix_"+ze+"(a_"+te+", u_"+te+`_t);
#else
    `+ue+" "+Ee+" "+te+" = u_"+te+`;
#endif
`:X==="define"?`
#ifndef HAS_UNIFORM_u_`+te+`
uniform lowp float u_`+te+`_t;
attribute `+ue+" "+je+" a_"+te+`;
#else
uniform `+ue+" "+Ee+" u_"+te+`;
#endif
`:ze==="vec4"?`
#ifndef HAS_UNIFORM_u_`+te+`
    `+ue+" "+Ee+" "+te+" = a_"+te+`;
#else
    `+ue+" "+Ee+" "+te+" = u_"+te+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+te+`
    `+ue+" "+Ee+" "+te+" = unpack_mix_"+ze+"(a_"+te+", u_"+te+`_t);
#else
    `+ue+" "+Ee+" "+te+" = u_"+te+`;
#endif
`}),staticAttributes:g,staticUniforms:k}}var ys=Object.freeze({__proto__:null,prelude:Pa,background:Nc,backgroundPattern:cf,circle:Os,clippingMask:ff,heatmap:ml,heatmapTexture:el,collisionBox:Ks,collisionCircle:Rl,debug:x,fill:I,fillOutline:U,fillOutlinePattern:R,fillPattern:ne,fillExtrusion:ke,fillExtrusionPattern:it,hillshadePrepare:Pt,hillshade:Lt,line:yr,lineGradient:Lr,linePattern:Hn,lineSDF:Jn,raster:vi,symbolIcon:Yi,symbolSDF:ba,symbolTextAndIcon:Ra}),lu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function gl(f){for(var d=[],h=0;h<f.length;h++)if(f[h]!==null){var g=f[h].split(" ");d.push(g.pop())}return d}lu.prototype.bind=function(f,d,h,g,S,M,k,F){this.context=f;for(var G=this.boundPaintVertexBuffers.length!==g.length,X=0;!G&&X<g.length;X++)this.boundPaintVertexBuffers[X]!==g[X]&&(G=!0);f.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===h&&!G&&this.boundIndexBuffer===S&&this.boundVertexOffset===M&&this.boundDynamicVertexBuffer===k&&this.boundDynamicVertexBuffer2===F?(f.bindVertexArrayOES.set(this.vao),k&&k.bind(),S&&S.dynamicDraw&&S.bind(),F&&F.bind()):this.freshBind(d,h,g,S,M,k,F)},lu.prototype.freshBind=function(f,d,h,g,S,M,k){var F,G=f.numAttributes,X=this.context,ue=X.gl;if(X.extVertexArrayObject)this.vao&&this.destroy(),this.vao=X.extVertexArrayObject.createVertexArrayOES(),X.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=f,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=g,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=k;else{F=X.currentNumAttributes||0;for(var Ee=G;Ee<F;Ee++)ue.disableVertexAttribArray(Ee)}d.enableAttributes(ue,f);for(var te=0,je=h;te<je.length;te+=1)je[te].enableAttributes(ue,f);M&&M.enableAttributes(ue,f),k&&k.enableAttributes(ue,f),d.bind(),d.setVertexAttribPointers(ue,f,S);for(var ze=0,nt=h;ze<nt.length;ze+=1){var Be=nt[ze];Be.bind(),Be.setVertexAttribPointers(ue,f,S)}M&&(M.bind(),M.setVertexAttribPointers(ue,f,S)),g&&g.bind(),k&&(k.bind(),k.setVertexAttribPointers(ue,f,S)),X.currentNumAttributes=G},lu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var hf=function(f,d,h,g,S,M){var k=f.gl;this.program=k.createProgram();for(var F=gl(h.staticAttributes),G=g?g.getBinderAttributes():[],X=F.concat(G),ue=h.staticUniforms?gl(h.staticUniforms):[],Ee=g?g.getBinderUniforms():[],te=[],je=0,ze=ue.concat(Ee);je<ze.length;je+=1){var nt=ze[je];te.indexOf(nt)<0&&te.push(nt)}var Be=g?g.defines():[];M&&Be.push("#define OVERDRAW_INSPECTOR;");var rt=Be.concat(Pa.fragmentSource,h.fragmentSource).join(`
`),mt=Be.concat(Pa.vertexSource,h.vertexSource).join(`
`),Dt=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(Dt,rt),k.compileShader(Dt),k.attachShader(this.program,Dt);var fr=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(fr,mt),k.compileShader(fr),k.attachShader(this.program,fr),this.attributes={};var nr={};this.numAttributes=X.length;for(var dr=0;dr<this.numAttributes;dr++)X[dr]&&(k.bindAttribLocation(this.program,dr,X[dr]),this.attributes[X[dr]]=dr);k.linkProgram(this.program),k.deleteShader(fr),k.deleteShader(Dt);for(var Ir=0;Ir<te.length;Ir++){var tn=te[Ir];if(tn&&!nr[tn]){var $r=k.getUniformLocation(this.program,tn);$r&&(nr[tn]=$r)}}this.fixedUniforms=S(f,nr),this.binderUniforms=g?g.getUniforms(f,nr):[]}}};function yl(f,d,h){var g=1/sa(h,1,d.transform.tileZoom),S=Math.pow(2,h.tileID.overscaledZ),M=h.tileSize*Math.pow(2,d.transform.tileZoom)/S,k=M*(h.tileID.canonical.x+h.tileID.wrap*S),F=M*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[g,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[k>>16,F>>16],u_pixel_coord_lower:[65535&k,65535&F]}}hf.prototype.draw=function(f,d,h,g,S,M,k,F,G,X,ue,Ee,te,je,ze,nt){var Be,rt=f.gl;if(!this.failedToCreate){for(var mt in f.program.set(this.program),f.setDepthMode(h),f.setStencilMode(g),f.setColorMode(S),f.setCullFace(M),this.fixedUniforms)this.fixedUniforms[mt].set(k[mt]);je&&je.setUniforms(f,this.binderUniforms,Ee,{zoom:te});for(var Dt=(Be={},Be[rt.LINES]=2,Be[rt.TRIANGLES]=3,Be[rt.LINE_STRIP]=1,Be)[d],fr=0,nr=ue.get();fr<nr.length;fr+=1){var dr=nr[fr],Ir=dr.vaos||(dr.vaos={});(Ir[F]||(Ir[F]=new lu)).bind(f,this,G,je?je.getPaintVertexBuffers():[],X,dr.vertexOffset,ze,nt),rt.drawElements(d,dr.primitiveLength*Dt,rt.UNSIGNED_SHORT,dr.primitiveOffset*Dt*2)}}};var zc=function(f,d,h,g){var S=d.style.light,M=S.properties.get("position"),k=[M.x,M.y,M.z],F=y.create$1();S.properties.get("anchor")==="viewport"&&y.fromRotation(F,-d.transform.angle),y.transformMat3(k,k,F);var G=S.properties.get("color");return{u_matrix:f,u_lightpos:k,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[G.r,G.g,G.b],u_vertical_gradient:+h,u_opacity:g}},Fu=function(f,d,h,g,S,M,k){return y.extend(zc(f,d,h,g),yl(M,d,k),{u_height_factor:-Math.pow(2,S.overscaledZ)/k.tileSize/8})},Bu=function(f){return{u_matrix:f}},Nu=function(f,d,h,g){return y.extend(Bu(f),yl(h,d,g))},mo=function(f,d){return{u_matrix:f,u_world:d}},Gf=function(f,d,h,g,S){return y.extend(Nu(f,d,h,g),{u_world:S})},Uc=function(f,d,h,g){var S,M,k=f.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var F=sa(h,1,k.zoom);S=!0,M=[F,F]}else S=!1,M=k.pixelsToGLUnits;return{u_camera_to_center_distance:k.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(d.posMatrix,h,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:M}},_s=function(f,d,h){var g=sa(h,1,d.zoom),S=Math.pow(2,d.zoom-h.tileID.overscaledZ),M=h.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:d.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[d.pixelsToGLUnits[0]/(g*S),d.pixelsToGLUnits[1]/(g*S)],u_overscale_factor:M}},pf=function(f,d,h){return{u_matrix:f,u_inv_matrix:d,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}},tl=function(f,d,h){return h===void 0&&(h=1),{u_matrix:f,u_color:d,u_overlay:0,u_overlay_scale:h}},Qs=function(f){return{u_matrix:f}},Hf=function(f,d,h,g){return{u_matrix:f,u_extrude_scale:sa(d,1,h),u_intensity:g}},Zs=function(f,d,h){var g=f.transform;return{u_matrix:Zc(f,d,h),u_ratio:1/sa(d,1,g.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Ma=function(f,d,h,g){return y.extend(Zs(f,d,h),{u_image:0,u_image_height:g})},Ol=function(f,d,h,g){var S=f.transform,M=zu(d,S);return{u_matrix:Zc(f,d,h),u_texsize:d.imageAtlasTexture.size,u_ratio:1/sa(d,1,S.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[M,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},bh=function(f,d,h,g,S){var M=f.lineAtlas,k=zu(d,f.transform),F=h.layout.get("line-cap")==="round",G=M.getDash(g.from,F),X=M.getDash(g.to,F),ue=G.width*S.fromScale,Ee=X.width*S.toScale;return y.extend(Zs(f,d,h),{u_patternscale_a:[k/ue,-G.height/2],u_patternscale_b:[k/Ee,-X.height/2],u_sdfgamma:M.width/(256*Math.min(ue,Ee)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:X.y,u_mix:S.t})};function zu(f,d){return 1/sa(f,1,d.tileZoom)}function Zc(f,d,h){return f.translatePosMatrix(d.tileID.posMatrix,d,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}var fp=function(f,d,h,g,S){return{u_matrix:f,u_tl_parent:d,u_scale_parent:h,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(k=S.paint.get("raster-saturation"),k>0?1-1/(1.001-k):-k),u_contrast_factor:(M=S.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:hp(S.paint.get("raster-hue-rotate"))};var M,k};function hp(f){f*=Math.PI/180;var d=Math.sin(f),h=Math.cos(f);return[(2*h+1)/3,(-Math.sqrt(3)*d-h+1)/3,(Math.sqrt(3)*d-h+1)/3]}var Wf,Vc=function(f,d,h,g,S,M,k,F,G,X){var ue=S.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:ue.cameraToCenterDistance,u_pitch:ue.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:ue.width/ue.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:k,u_coord_matrix:F,u_is_text:+G,u_pitch_with_map:+g,u_texsize:X,u_texture:0}},lc=function(f,d,h,g,S,M,k,F,G,X,ue){var Ee=S.transform;return y.extend(Vc(f,d,h,g,S,M,k,F,G,X),{u_gamma_scale:g?Math.cos(Ee._pitch)*Ee.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+ue})},Dl=function(f,d,h,g,S,M,k,F,G,X){return y.extend(lc(f,d,h,g,S,M,k,F,!0,G,!0),{u_texsize_icon:X,u_texture_icon:1})},Fl=function(f,d,h){return{u_matrix:f,u_opacity:d,u_color:h}},_l=function(f,d,h,g,S,M){return y.extend(function(k,F,G,X){var ue=G.imageManager.getPattern(k.from.toString()),Ee=G.imageManager.getPattern(k.to.toString()),te=G.imageManager.getPixelSize(),je=te.width,ze=te.height,nt=Math.pow(2,X.tileID.overscaledZ),Be=X.tileSize*Math.pow(2,G.transform.tileZoom)/nt,rt=Be*(X.tileID.canonical.x+X.tileID.wrap*nt),mt=Be*X.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ue.tl,u_pattern_br_a:ue.br,u_pattern_tl_b:Ee.tl,u_pattern_br_b:Ee.br,u_texsize:[je,ze],u_mix:F.t,u_pattern_size_a:ue.displaySize,u_pattern_size_b:Ee.displaySize,u_scale_a:F.fromScale,u_scale_b:F.toScale,u_tile_units_to_pixels:1/sa(X,1,G.transform.tileZoom),u_pixel_coord_upper:[rt>>16,mt>>16],u_pixel_coord_lower:[65535&rt,65535&mt]}}(g,M,h,S),{u_matrix:f,u_opacity:d})},xl={fillExtrusion:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_lightpos:new y.Uniform3f(f,d.u_lightpos),u_lightintensity:new y.Uniform1f(f,d.u_lightintensity),u_lightcolor:new y.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,d.u_vertical_gradient),u_opacity:new y.Uniform1f(f,d.u_opacity)}},fillExtrusionPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_lightpos:new y.Uniform3f(f,d.u_lightpos),u_lightintensity:new y.Uniform1f(f,d.u_lightintensity),u_lightcolor:new y.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,d.u_vertical_gradient),u_height_factor:new y.Uniform1f(f,d.u_height_factor),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade),u_opacity:new y.Uniform1f(f,d.u_opacity)}},fill:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},fillPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},fillOutline:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world)}},fillOutlinePattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},circle:function(f,d){return{u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(f,d.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(f,d.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},collisionBox:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(f,d.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(f,d.u_extrude_scale),u_overscale_factor:new y.Uniform1f(f,d.u_overscale_factor)}},collisionCircle:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_inv_matrix:new y.UniformMatrix4f(f,d.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(f,d.u_viewport_size)}},debug:function(f,d){return{u_color:new y.UniformColor(f,d.u_color),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_overlay:new y.Uniform1i(f,d.u_overlay),u_overlay_scale:new y.Uniform1f(f,d.u_overlay_scale)}},clippingMask:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},heatmap:function(f,d){return{u_extrude_scale:new y.Uniform1f(f,d.u_extrude_scale),u_intensity:new y.Uniform1f(f,d.u_intensity),u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},heatmapTexture:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world),u_image:new y.Uniform1i(f,d.u_image),u_color_ramp:new y.Uniform1i(f,d.u_color_ramp),u_opacity:new y.Uniform1f(f,d.u_opacity)}},hillshade:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_latrange:new y.Uniform2f(f,d.u_latrange),u_light:new y.Uniform2f(f,d.u_light),u_shadow:new y.UniformColor(f,d.u_shadow),u_highlight:new y.UniformColor(f,d.u_highlight),u_accent:new y.UniformColor(f,d.u_accent)}},hillshadePrepare:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_dimension:new y.Uniform2f(f,d.u_dimension),u_zoom:new y.Uniform1f(f,d.u_zoom),u_unpack:new y.Uniform4f(f,d.u_unpack)}},line:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels)}},lineGradient:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_image:new y.Uniform1i(f,d.u_image),u_image_height:new y.Uniform1f(f,d.u_image_height)}},linePattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_texsize:new y.Uniform2f(f,d.u_texsize),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_image:new y.Uniform1i(f,d.u_image),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},lineSDF:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(f,d.u_patternscale_a),u_patternscale_b:new y.Uniform2f(f,d.u_patternscale_b),u_sdfgamma:new y.Uniform1f(f,d.u_sdfgamma),u_image:new y.Uniform1i(f,d.u_image),u_tex_y_a:new y.Uniform1f(f,d.u_tex_y_a),u_tex_y_b:new y.Uniform1f(f,d.u_tex_y_b),u_mix:new y.Uniform1f(f,d.u_mix)}},raster:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_tl_parent:new y.Uniform2f(f,d.u_tl_parent),u_scale_parent:new y.Uniform1f(f,d.u_scale_parent),u_buffer_scale:new y.Uniform1f(f,d.u_buffer_scale),u_fade_t:new y.Uniform1f(f,d.u_fade_t),u_opacity:new y.Uniform1f(f,d.u_opacity),u_image0:new y.Uniform1i(f,d.u_image0),u_image1:new y.Uniform1i(f,d.u_image1),u_brightness_low:new y.Uniform1f(f,d.u_brightness_low),u_brightness_high:new y.Uniform1f(f,d.u_brightness_high),u_saturation_factor:new y.Uniform1f(f,d.u_saturation_factor),u_contrast_factor:new y.Uniform1f(f,d.u_contrast_factor),u_spin_weights:new y.Uniform3f(f,d.u_spin_weights)}},symbolIcon:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texture:new y.Uniform1i(f,d.u_texture)}},symbolSDF:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texture:new y.Uniform1i(f,d.u_texture),u_gamma_scale:new y.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,d.u_is_halo)}},symbolTextAndIcon:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texsize_icon:new y.Uniform2f(f,d.u_texsize_icon),u_texture:new y.Uniform1i(f,d.u_texture),u_texture_icon:new y.Uniform1i(f,d.u_texture_icon),u_gamma_scale:new y.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,d.u_is_halo)}},background:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_opacity:new y.Uniform1f(f,d.u_opacity),u_color:new y.UniformColor(f,d.u_color)}},backgroundPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_opacity:new y.Uniform1f(f,d.u_opacity),u_image:new y.Uniform1i(f,d.u_image),u_pattern_tl_a:new y.Uniform2f(f,d.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(f,d.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(f,d.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(f,d.u_pattern_br_b),u_texsize:new y.Uniform2f(f,d.u_texsize),u_mix:new y.Uniform1f(f,d.u_mix),u_pattern_size_a:new y.Uniform2f(f,d.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(f,d.u_pattern_size_b),u_scale_a:new y.Uniform1f(f,d.u_scale_a),u_scale_b:new y.Uniform1f(f,d.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(f,d.u_tile_units_to_pixels)}}};function bl(f,d,h,g,S,M,k){for(var F=f.context,G=F.gl,X=f.useProgram("collisionBox"),ue=[],Ee=0,te=0,je=0;je<g.length;je++){var ze=g[je],nt=d.getTile(ze),Be=nt.getBucket(h);if(Be){var rt=ze.posMatrix;S[0]===0&&S[1]===0||(rt=f.translatePosMatrix(ze.posMatrix,nt,S,M));var mt=k?Be.textCollisionBox:Be.iconCollisionBox,Dt=Be.collisionCircleArray;if(Dt.length>0){var fr=y.create(),nr=rt;y.mul(fr,Be.placementInvProjMatrix,f.transform.glCoordMatrix),y.mul(fr,fr,Be.placementViewportMatrix),ue.push({circleArray:Dt,circleOffset:te,transform:nr,invTransform:fr}),te=Ee+=Dt.length/4}mt&&X.draw(F,G.LINES,Ce.disabled,Ze.disabled,f.colorModeForRenderPass(),dt.disabled,_s(rt,f.transform,nt),h.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,null,f.transform.zoom,null,null,mt.collisionVertexBuffer)}}if(k&&ue.length){var dr=f.useProgram("collisionCircle"),Ir=new y.StructArrayLayout2f1f2i16;Ir.resize(4*Ee),Ir._trim();for(var tn=0,$r=0,bn=ue;$r<bn.length;$r+=1)for(var Qn=bn[$r],$n=0;$n<Qn.circleArray.length/4;$n++){var ei=4*$n,Fi=Qn.circleArray[ei+0],Cn=Qn.circleArray[ei+1],Ei=Qn.circleArray[ei+2],Si=Qn.circleArray[ei+3];Ir.emplace(tn++,Fi,Cn,Ei,Si,0),Ir.emplace(tn++,Fi,Cn,Ei,Si,1),Ir.emplace(tn++,Fi,Cn,Ei,Si,2),Ir.emplace(tn++,Fi,Cn,Ei,Si,3)}(!Wf||Wf.length<2*Ee)&&(Wf=function(ro){var Ko=2*ro,Qo=new y.StructArrayLayout3ui6;Qo.resize(Ko),Qo._trim();for(var Ya=0;Ya<Ko;Ya++){var yo=6*Ya;Qo.uint16[yo+0]=4*Ya+0,Qo.uint16[yo+1]=4*Ya+1,Qo.uint16[yo+2]=4*Ya+2,Qo.uint16[yo+3]=4*Ya+2,Qo.uint16[yo+4]=4*Ya+3,Qo.uint16[yo+5]=4*Ya+0}return Qo}(Ee));for(var mi=F.createIndexBuffer(Wf,!0),ai=F.createVertexBuffer(Ir,y.collisionCircleLayout.members,!0),Ti=0,li=ue;Ti<li.length;Ti+=1){var ti=li[Ti],bo=pf(ti.transform,ti.invTransform,f.transform);dr.draw(F,G.TRIANGLES,Ce.disabled,Ze.disabled,f.colorModeForRenderPass(),dt.disabled,bo,h.id,ai,mi,y.SegmentVector.simpleSegment(0,2*ti.circleOffset,ti.circleArray.length,ti.circleArray.length/2),null,f.transform.zoom,null,null,null)}ai.destroy(),mi.destroy()}}var Js=y.identity(new Float32Array(16));function df(f,d,h,g,S,M){var k=y.getAnchorAlignment(f),F=-(k.horizontalAlign-.5)*d,G=-(k.verticalAlign-.5)*h,X=y.evaluateVariableOffset(f,g);return new y.Point((F/S+X[0])*M,(G/S+X[1])*M)}function vf(f,d,h,g,S,M,k,F,G,X,ue){var Ee=f.text.placedSymbolArray,te=f.text.dynamicLayoutVertexArray,je=f.icon.dynamicLayoutVertexArray,ze={};te.clear();for(var nt=0;nt<Ee.length;nt++){var Be=Ee.get(nt),rt=Be.hidden||!Be.crossTileID||f.allowVerticalPlacement&&!Be.placedOrientation?null:g[Be.crossTileID];if(rt){var mt=new y.Point(Be.anchorX,Be.anchorY),Dt=Ri(mt,h?F:k),fr=hr(M.cameraToCenterDistance,Dt.signedDistanceFromCamera),nr=S.evaluateSizeForFeature(f.textSizeData,X,Be)*fr/y.ONE_EM;h&&(nr*=f.tilePixelRatio/G);for(var dr=df(rt.anchor,rt.width,rt.height,rt.textOffset,rt.textBoxScale,nr),Ir=h?Ri(mt.add(dr),k).point:Dt.point.add(d?dr.rotate(-M.angle):dr),tn=f.allowVerticalPlacement&&Be.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,$r=0;$r<Be.numGlyphs;$r++)y.addDynamicAttributes(te,Ir,tn);ue&&Be.associatedIconIndex>=0&&(ze[Be.associatedIconIndex]={shiftedAnchor:Ir,angle:tn})}else Ja(Be.numGlyphs,te)}if(ue){je.clear();for(var bn=f.icon.placedSymbolArray,Qn=0;Qn<bn.length;Qn++){var $n=bn.get(Qn);if($n.hidden)Ja($n.numGlyphs,je);else{var ei=ze[Qn];if(ei)for(var Fi=0;Fi<$n.numGlyphs;Fi++)y.addDynamicAttributes(je,ei.shiftedAnchor,ei.angle);else Ja($n.numGlyphs,je)}}f.icon.dynamicLayoutVertexBuffer.updateData(je)}f.text.dynamicLayoutVertexBuffer.updateData(te)}function Bl(f,d,h){return h.iconsInText&&d?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function El(f,d,h,g,S,M,k,F,G,X,ue,Ee){for(var te=f.context,je=te.gl,ze=f.transform,nt=F==="map",Be=G==="map",rt=nt&&h.layout.get("symbol-placement")!=="point",mt=nt&&!Be&&!rt,Dt=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,fr=!1,nr=f.depthModeForSublayer(0,Ce.ReadOnly),dr=h.layout.get("text-variable-anchor"),Ir=[],tn=0,$r=g;tn<$r.length;tn+=1){var bn=$r[tn],Qn=d.getTile(bn),$n=Qn.getBucket(h);if($n){var ei=S?$n.text:$n.icon;if(ei&&ei.segments.get().length){var Fi=ei.programConfigurations.get(h.id),Cn=S||$n.sdfIcons,Ei=S?$n.textSizeData:$n.iconSizeData,Si=Be||ze.pitch!==0,mi=f.useProgram(Bl(Cn,S,$n),Fi),ai=y.evaluateSizeForZoom(Ei,ze.zoom),Ti=void 0,li=[0,0],ti=void 0,bo=void 0,ro=null,Ko=void 0;if(S)ti=Qn.glyphAtlasTexture,bo=je.LINEAR,Ti=Qn.glyphAtlasTexture.size,$n.iconsInText&&(li=Qn.imageAtlasTexture.size,ro=Qn.imageAtlasTexture,Ko=Si||f.options.rotating||f.options.zooming||Ei.kind==="composite"||Ei.kind==="camera"?je.LINEAR:je.NEAREST);else{var Qo=h.layout.get("icon-size").constantOr(0)!==1||$n.iconsNeedLinear;ti=Qn.imageAtlasTexture,bo=Cn||f.options.rotating||f.options.zooming||Qo||Si?je.LINEAR:je.NEAREST,Ti=Qn.imageAtlasTexture.size}var Ya=sa(Qn,1,f.transform.zoom),yo=Ji(bn.posMatrix,Be,nt,f.transform,Ya),Eo=oa(bn.posMatrix,Be,nt,f.transform,Ya),fs=dr&&$n.hasTextData(),il=h.layout.get("icon-text-fit")!=="none"&&fs&&$n.hasIconData();rt&&at($n,bn.posMatrix,f,S,yo,Eo,Be,X);var Ss=f.translatePosMatrix(bn.posMatrix,Qn,M,k),wu=rt||S&&dr||il?Js:yo,du=f.translatePosMatrix(Eo,Qn,M,k,!0),Kl=Cn&&h.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Il={program:mi,buffers:ei,uniformValues:Cn?$n.iconsInText?Dl(Ei.kind,ai,mt,Be,f,Ss,wu,du,Ti,li):lc(Ei.kind,ai,mt,Be,f,Ss,wu,du,S,Ti,!0):Vc(Ei.kind,ai,mt,Be,f,Ss,wu,du,S,Ti),atlasTexture:ti,atlasTextureIcon:ro,atlasInterpolation:bo,atlasInterpolationIcon:Ko,isSDF:Cn,hasHalo:Kl};if(Dt&&$n.canOverlap){fr=!0;for(var al=0,mc=ei.segments.get();al<mc.length;al+=1){var gc=mc[al];Ir.push({segments:new y.SegmentVector([gc]),sortKey:gc.sortKey,state:Il})}}else Ir.push({segments:ei.segments,sortKey:0,state:Il})}}}fr&&Ir.sort(function(ol,mu){return ol.sortKey-mu.sortKey});for(var vu=0,Ql=Ir;vu<Ql.length;vu+=1){var Au=Ql[vu],Po=Au.state;if(te.activeTexture.set(je.TEXTURE0),Po.atlasTexture.bind(Po.atlasInterpolation,je.CLAMP_TO_EDGE),Po.atlasTextureIcon&&(te.activeTexture.set(je.TEXTURE1),Po.atlasTextureIcon&&Po.atlasTextureIcon.bind(Po.atlasInterpolationIcon,je.CLAMP_TO_EDGE)),Po.isSDF){var Wu=Po.uniformValues;Po.hasHalo&&(Wu.u_is_halo=1,cc(Po.buffers,Au.segments,h,f,Po.program,nr,ue,Ee,Wu)),Wu.u_is_halo=0}cc(Po.buffers,Au.segments,h,f,Po.program,nr,ue,Ee,Po.uniformValues)}}function cc(f,d,h,g,S,M,k,F,G){var X=g.context;S.draw(X,X.gl.TRIANGLES,M,k,F,dt.disabled,G,h.id,f.layoutVertexBuffer,f.indexBuffer,d,h.paint,g.transform.zoom,f.programConfigurations.get(h.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function jc(f,d,h,g,S,M,k){var F,G,X,ue,Ee,te=f.context.gl,je=h.paint.get("fill-pattern"),ze=je&&je.constantOr(1),nt=h.getCrossfadeParameters();k?(G=ze&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=te.LINES):(G=ze?"fillPattern":"fill",F=te.TRIANGLES);for(var Be=0,rt=g;Be<rt.length;Be+=1){var mt=rt[Be],Dt=d.getTile(mt);if(!ze||Dt.patternsLoaded()){var fr=Dt.getBucket(h);if(fr){var nr=fr.programConfigurations.get(h.id),dr=f.useProgram(G,nr);ze&&(f.context.activeTexture.set(te.TEXTURE0),Dt.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),nr.updatePaintBuffers(nt));var Ir=je.constantOr(null);if(Ir&&Dt.imageAtlas){var tn=Dt.imageAtlas,$r=tn.patternPositions[Ir.to.toString()],bn=tn.patternPositions[Ir.from.toString()];$r&&bn&&nr.setConstantPatternPositions($r,bn)}var Qn=f.translatePosMatrix(mt.posMatrix,Dt,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(k){ue=fr.indexBuffer2,Ee=fr.segments2;var $n=[te.drawingBufferWidth,te.drawingBufferHeight];X=G==="fillOutlinePattern"&&ze?Gf(Qn,f,nt,Dt,$n):mo(Qn,$n)}else ue=fr.indexBuffer,Ee=fr.segments,X=ze?Nu(Qn,f,nt,Dt):Bu(Qn);dr.draw(f.context,F,S,f.stencilModeForClipping(mt),M,dt.disabled,X,h.id,fr.layoutVertexBuffer,ue,Ee,h.paint,f.transform.zoom,nr)}}}}function fc(f,d,h,g,S,M,k){for(var F=f.context,G=F.gl,X=h.paint.get("fill-extrusion-pattern"),ue=X.constantOr(1),Ee=h.getCrossfadeParameters(),te=h.paint.get("fill-extrusion-opacity"),je=0,ze=g;je<ze.length;je+=1){var nt=ze[je],Be=d.getTile(nt),rt=Be.getBucket(h);if(rt){var mt=rt.programConfigurations.get(h.id),Dt=f.useProgram(ue?"fillExtrusionPattern":"fillExtrusion",mt);ue&&(f.context.activeTexture.set(G.TEXTURE0),Be.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),mt.updatePaintBuffers(Ee));var fr=X.constantOr(null);if(fr&&Be.imageAtlas){var nr=Be.imageAtlas,dr=nr.patternPositions[fr.to.toString()],Ir=nr.patternPositions[fr.from.toString()];dr&&Ir&&mt.setConstantPatternPositions(dr,Ir)}var tn=f.translatePosMatrix(nt.posMatrix,Be,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),$r=h.paint.get("fill-extrusion-vertical-gradient"),bn=ue?Fu(tn,f,$r,te,nt,Ee,Be):zc(tn,f,$r,te);Dt.draw(F,F.gl.TRIANGLES,S,M,k,dt.backCCW,bn,h.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,h.paint,f.transform.zoom,mt)}}}function mf(f,d,h,g,S,M){var k=f.context,F=k.gl,G=d.fbo;if(G){var X=f.useProgram("hillshade");k.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,G.colorAttachment.get());var ue=function(Ee,te,je){var ze=je.paint.get("hillshade-shadow-color"),nt=je.paint.get("hillshade-highlight-color"),Be=je.paint.get("hillshade-accent-color"),rt=je.paint.get("hillshade-illumination-direction")*(Math.PI/180);je.paint.get("hillshade-illumination-anchor")==="viewport"&&(rt-=Ee.transform.angle);var mt,Dt,fr,nr=!Ee.options.moving;return{u_matrix:Ee.transform.calculatePosMatrix(te.tileID.toUnwrapped(),nr),u_image:0,u_latrange:(mt=te.tileID,Dt=Math.pow(2,mt.canonical.z),fr=mt.canonical.y,[new y.MercatorCoordinate(0,fr/Dt).toLngLat().lat,new y.MercatorCoordinate(0,(fr+1)/Dt).toLngLat().lat]),u_light:[je.paint.get("hillshade-exaggeration"),rt],u_shadow:ze,u_highlight:nt,u_accent:Be}}(f,d,h);X.draw(k,F.TRIANGLES,g,S,M,dt.disabled,ue,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}}function pp(f,d,h,g,S,M){var k=f.context,F=k.gl,G=d.dem;if(G&&G.data){var X=G.dim,ue=G.stride,Ee=G.getPixels();if(k.activeTexture.set(F.TEXTURE1),k.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||f.getTileTexture(ue),d.demTexture){var te=d.demTexture;te.update(Ee,{premultiply:!1}),te.bind(F.NEAREST,F.CLAMP_TO_EDGE)}else d.demTexture=new y.Texture(k,Ee,F.RGBA,{premultiply:!1}),d.demTexture.bind(F.NEAREST,F.CLAMP_TO_EDGE);k.activeTexture.set(F.TEXTURE0);var je=d.fbo;if(!je){var ze=new y.Texture(k,{width:X,height:X,data:null},F.RGBA);ze.bind(F.LINEAR,F.CLAMP_TO_EDGE),(je=d.fbo=k.createFramebuffer(X,X,!0)).colorAttachment.set(ze.texture)}k.bindFramebuffer.set(je.framebuffer),k.viewport.set([0,0,X,X]),f.useProgram("hillshadePrepare").draw(k,F.TRIANGLES,g,S,M,dt.disabled,function(nt,Be){var rt=Be.stride,mt=y.create();return y.ortho(mt,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(mt,mt,[0,-y.EXTENT,0]),{u_matrix:mt,u_image:1,u_dimension:[rt,rt],u_zoom:nt.overscaledZ,u_unpack:Be.getUnpackVector()}}(d.tileID,G),h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function gf(f,d,h,g,S){var M=g.paint.get("raster-fade-duration");if(M>0){var k=y.browser.now(),F=(k-f.timeAdded)/M,G=d?(k-d.timeAdded)/M:-1,X=h.getSource(),ue=S.coveringZoomLevel({tileSize:X.tileSize,roundZoom:X.roundZoom}),Ee=!d||Math.abs(d.tileID.overscaledZ-ue)>Math.abs(f.tileID.overscaledZ-ue),te=Ee&&f.refreshedUponExpiration?1:y.clamp(Ee?F:1-G,0,1);return f.refreshedUponExpiration&&F>=1&&(f.refreshedUponExpiration=!1),d?{opacity:1,mix:1-te}:{opacity:te,mix:0}}return{opacity:1,mix:0}}var Sl=new y.Color(1,0,0,1),yf=new y.Color(0,1,0,1),Xf=new y.Color(0,0,1,1),Uu=new y.Color(1,0,1,1),Eh=new y.Color(0,1,1,1);function Sh(f,d,h,g){Nl(f,0,d+h/2,f.transform.width,h,g)}function Ch(f,d,h,g){Nl(f,d-h/2,0,h,f.transform.height,g)}function Nl(f,d,h,g,S,M){var k=f.context,F=k.gl;F.enable(F.SCISSOR_TEST),F.scissor(d*y.browser.devicePixelRatio,h*y.browser.devicePixelRatio,g*y.browser.devicePixelRatio,S*y.browser.devicePixelRatio),k.clear({color:M}),F.disable(F.SCISSOR_TEST)}function wh(f,d,h){var g=f.context,S=g.gl,M=h.posMatrix,k=f.useProgram("debug"),F=Ce.disabled,G=Ze.disabled,X=f.colorModeForRenderPass();g.activeTexture.set(S.TEXTURE0),f.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),k.draw(g,S.LINE_STRIP,F,G,X,dt.disabled,tl(M,y.Color.red),"$debug",f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments);var ue=d.getTileByID(h.key).latestRawTileData,Ee=Math.floor((ue&&ue.byteLength||0)/1024),te=d.getTile(h).tileSize,je=512/Math.min(te,512)*(h.overscaledZ/f.transform.zoom)*.5,ze=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ze+=" => "+h.overscaledZ),function(nt,Be){nt.initDebugOverlayCanvas();var rt=nt.debugOverlayCanvas,mt=nt.context.gl,Dt=nt.debugOverlayCanvas.getContext("2d");Dt.clearRect(0,0,rt.width,rt.height),Dt.shadowColor="white",Dt.shadowBlur=2,Dt.lineWidth=1.5,Dt.strokeStyle="white",Dt.textBaseline="top",Dt.font="bold 36px Open Sans, sans-serif",Dt.fillText(Be,5,5),Dt.strokeText(Be,5,5),nt.debugOverlayTexture.update(rt),nt.debugOverlayTexture.bind(mt.LINEAR,mt.CLAMP_TO_EDGE)}(f,ze+" "+Ee+"kb"),k.draw(g,S.TRIANGLES,F,G,et.alphaBlended,dt.disabled,tl(M,y.Color.transparent,je),"$debug",f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}var as={symbol:function(f,d,h,g,S){if(f.renderPass==="translucent"){var M=Ze.disabled,k=f.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(F,G,X,ue,Ee,te,je){for(var ze=G.transform,nt=Ee==="map",Be=te==="map",rt=0,mt=F;rt<mt.length;rt+=1){var Dt=mt[rt],fr=ue.getTile(Dt),nr=fr.getBucket(X);if(nr&&nr.text&&nr.text.segments.get().length){var dr=y.evaluateSizeForZoom(nr.textSizeData,ze.zoom),Ir=sa(fr,1,G.transform.zoom),tn=Ji(Dt.posMatrix,Be,nt,G.transform,Ir),$r=X.layout.get("icon-text-fit")!=="none"&&nr.hasIconData();if(dr){var bn=Math.pow(2,ze.zoom-fr.tileID.overscaledZ);vf(nr,nt,Be,je,y.symbolSize,ze,tn,Dt.posMatrix,bn,dr,$r)}}}}(g,f,h,d,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),S),h.paint.get("icon-opacity").constantOr(1)!==0&&El(f,d,h,g,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),M,k),h.paint.get("text-opacity").constantOr(1)!==0&&El(f,d,h,g,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),M,k),d.map.showCollisionBoxes&&(bl(f,d,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),bl(f,d,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))}},circle:function(f,d,h,g){if(f.renderPass==="translucent"){var S=h.paint.get("circle-opacity"),M=h.paint.get("circle-stroke-width"),k=h.paint.get("circle-stroke-opacity"),F=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)!==0||M.constantOr(1)!==0&&k.constantOr(1)!==0){for(var G=f.context,X=G.gl,ue=f.depthModeForSublayer(0,Ce.ReadOnly),Ee=Ze.disabled,te=f.colorModeForRenderPass(),je=[],ze=0;ze<g.length;ze++){var nt=g[ze],Be=d.getTile(nt),rt=Be.getBucket(h);if(rt){var mt=rt.programConfigurations.get(h.id),Dt={programConfiguration:mt,program:f.useProgram("circle",mt),layoutVertexBuffer:rt.layoutVertexBuffer,indexBuffer:rt.indexBuffer,uniformValues:Uc(f,nt,Be,h)};if(F)for(var fr=0,nr=rt.segments.get();fr<nr.length;fr+=1){var dr=nr[fr];je.push({segments:new y.SegmentVector([dr]),sortKey:dr.sortKey,state:Dt})}else je.push({segments:rt.segments,sortKey:0,state:Dt})}}F&&je.sort(function(Qn,$n){return Qn.sortKey-$n.sortKey});for(var Ir=0,tn=je;Ir<tn.length;Ir+=1){var $r=tn[Ir],bn=$r.state;bn.program.draw(G,X.TRIANGLES,ue,Ee,te,dt.disabled,bn.uniformValues,h.id,bn.layoutVertexBuffer,bn.indexBuffer,$r.segments,h.paint,f.transform.zoom,bn.programConfiguration)}}}},heatmap:function(f,d,h,g){if(h.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){var S=f.context,M=S.gl,k=Ze.disabled,F=new et([M.ONE,M.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(je,ze,nt){var Be=je.gl;je.activeTexture.set(Be.TEXTURE1),je.viewport.set([0,0,ze.width/4,ze.height/4]);var rt=nt.heatmapFbo;if(rt)Be.bindTexture(Be.TEXTURE_2D,rt.colorAttachment.get()),je.bindFramebuffer.set(rt.framebuffer);else{var mt=Be.createTexture();Be.bindTexture(Be.TEXTURE_2D,mt),Be.texParameteri(Be.TEXTURE_2D,Be.TEXTURE_WRAP_S,Be.CLAMP_TO_EDGE),Be.texParameteri(Be.TEXTURE_2D,Be.TEXTURE_WRAP_T,Be.CLAMP_TO_EDGE),Be.texParameteri(Be.TEXTURE_2D,Be.TEXTURE_MIN_FILTER,Be.LINEAR),Be.texParameteri(Be.TEXTURE_2D,Be.TEXTURE_MAG_FILTER,Be.LINEAR),rt=nt.heatmapFbo=je.createFramebuffer(ze.width/4,ze.height/4,!1),function(Dt,fr,nr,dr){var Ir=Dt.gl;Ir.texImage2D(Ir.TEXTURE_2D,0,Ir.RGBA,fr.width/4,fr.height/4,0,Ir.RGBA,Dt.extRenderToTextureHalfFloat?Dt.extTextureHalfFloat.HALF_FLOAT_OES:Ir.UNSIGNED_BYTE,null),dr.colorAttachment.set(nr)}(je,ze,mt,rt)}})(S,f,h),S.clear({color:y.Color.transparent});for(var G=0;G<g.length;G++){var X=g[G];if(!d.hasRenderableParent(X)){var ue=d.getTile(X),Ee=ue.getBucket(h);if(Ee){var te=Ee.programConfigurations.get(h.id);f.useProgram("heatmap",te).draw(S,M.TRIANGLES,Ce.disabled,k,F,dt.disabled,Hf(X.posMatrix,ue,f.transform.zoom,h.paint.get("heatmap-intensity")),h.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,h.paint,f.transform.zoom,te)}}}S.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(je,ze){var nt=je.context,Be=nt.gl,rt=ze.heatmapFbo;if(rt){nt.activeTexture.set(Be.TEXTURE0),Be.bindTexture(Be.TEXTURE_2D,rt.colorAttachment.get()),nt.activeTexture.set(Be.TEXTURE1);var mt=ze.colorRampTexture;mt||(mt=ze.colorRampTexture=new y.Texture(nt,ze.colorRamp,Be.RGBA)),mt.bind(Be.LINEAR,Be.CLAMP_TO_EDGE),je.useProgram("heatmapTexture").draw(nt,Be.TRIANGLES,Ce.disabled,Ze.disabled,je.colorModeForRenderPass(),dt.disabled,function(Dt,fr,nr,dr){var Ir=y.create();y.ortho(Ir,0,Dt.width,Dt.height,0,0,1);var tn=Dt.context.gl;return{u_matrix:Ir,u_world:[tn.drawingBufferWidth,tn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:fr.paint.get("heatmap-opacity")}}(je,ze),ze.id,je.viewportBuffer,je.quadTriangleIndexBuffer,je.viewportSegments,ze.paint,je.transform.zoom)}}(f,h))},line:function(f,d,h,g){if(f.renderPass==="translucent"){var S=h.paint.get("line-opacity"),M=h.paint.get("line-width");if(S.constantOr(1)!==0&&M.constantOr(1)!==0)for(var k=f.depthModeForSublayer(0,Ce.ReadOnly),F=f.colorModeForRenderPass(),G=h.paint.get("line-dasharray"),X=h.paint.get("line-pattern"),ue=X.constantOr(1),Ee=h.paint.get("line-gradient"),te=h.getCrossfadeParameters(),je=ue?"linePattern":G?"lineSDF":Ee?"lineGradient":"line",ze=f.context,nt=ze.gl,Be=!0,rt=0,mt=g;rt<mt.length;rt+=1){var Dt=mt[rt],fr=d.getTile(Dt);if(!ue||fr.patternsLoaded()){var nr=fr.getBucket(h);if(nr){var dr=nr.programConfigurations.get(h.id),Ir=f.context.program.get(),tn=f.useProgram(je,dr),$r=Be||tn.program!==Ir,bn=X.constantOr(null);if(bn&&fr.imageAtlas){var Qn=fr.imageAtlas,$n=Qn.patternPositions[bn.to.toString()],ei=Qn.patternPositions[bn.from.toString()];$n&&ei&&dr.setConstantPatternPositions($n,ei)}var Fi=ue?Ol(f,fr,h,te):G?bh(f,fr,h,G,te):Ee?Ma(f,fr,h,nr.lineClipsArray.length):Zs(f,fr,h);if(ue)ze.activeTexture.set(nt.TEXTURE0),fr.imageAtlasTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE),dr.updatePaintBuffers(te);else if(G&&($r||f.lineAtlas.dirty))ze.activeTexture.set(nt.TEXTURE0),f.lineAtlas.bind(ze);else if(Ee){var Cn=nr.gradients[h.id],Ei=Cn.texture;if(h.gradientVersion!==Cn.version){var Si=256;if(h.stepInterpolant){var mi=d.getSource().maxzoom,ai=Dt.canonical.z===mi?Math.ceil(1<<f.transform.maxZoom-Dt.canonical.z):1;Si=y.clamp(y.nextPowerOfTwo(nr.maxLineLength/y.EXTENT*1024*ai),256,ze.maxTextureSize)}Cn.gradient=y.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Si,image:Cn.gradient||void 0,clips:nr.lineClipsArray}),Cn.texture?Cn.texture.update(Cn.gradient):Cn.texture=new y.Texture(ze,Cn.gradient,nt.RGBA),Cn.version=h.gradientVersion,Ei=Cn.texture}ze.activeTexture.set(nt.TEXTURE0),Ei.bind(h.stepInterpolant?nt.NEAREST:nt.LINEAR,nt.CLAMP_TO_EDGE)}tn.draw(ze,nt.TRIANGLES,k,f.stencilModeForClipping(Dt),F,dt.disabled,Fi,h.id,nr.layoutVertexBuffer,nr.indexBuffer,nr.segments,h.paint,f.transform.zoom,dr,nr.layoutVertexBuffer2),Be=!1}}}}},fill:function(f,d,h,g){var S=h.paint.get("fill-color"),M=h.paint.get("fill-opacity");if(M.constantOr(1)!==0){var k=f.colorModeForRenderPass(),F=h.paint.get("fill-pattern"),G=f.opaquePassEnabledForLayer()&&!F.constantOr(1)&&S.constantOr(y.Color.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===G){var X=f.depthModeForSublayer(1,f.renderPass==="opaque"?Ce.ReadWrite:Ce.ReadOnly);jc(f,d,h,g,X,k,!1)}if(f.renderPass==="translucent"&&h.paint.get("fill-antialias")){var ue=f.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,Ce.ReadOnly);jc(f,d,h,g,ue,k,!0)}}},"fill-extrusion":function(f,d,h,g){var S=h.paint.get("fill-extrusion-opacity");if(S!==0&&f.renderPass==="translucent"){var M=new Ce(f.context.gl.LEQUAL,Ce.ReadWrite,f.depthRangeFor3D);if(S!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))fc(f,d,h,g,M,Ze.disabled,et.disabled),fc(f,d,h,g,M,f.stencilModeFor3D(),f.colorModeForRenderPass());else{var k=f.colorModeForRenderPass();fc(f,d,h,g,M,Ze.disabled,k)}}},hillshade:function(f,d,h,g){if(f.renderPass==="offscreen"||f.renderPass==="translucent"){for(var S=f.context,M=f.depthModeForSublayer(0,Ce.ReadOnly),k=f.colorModeForRenderPass(),F=f.renderPass==="translucent"?f.stencilConfigForOverlap(g):[{},g],G=F[0],X=0,ue=F[1];X<ue.length;X+=1){var Ee=ue[X],te=d.getTile(Ee);te.needsHillshadePrepare&&f.renderPass==="offscreen"?pp(f,te,h,M,Ze.disabled,k):f.renderPass==="translucent"&&mf(f,te,h,M,G[Ee.overscaledZ],k)}S.viewport.set([0,0,f.width,f.height])}},raster:function(f,d,h,g){if(f.renderPass==="translucent"&&h.paint.get("raster-opacity")!==0&&g.length)for(var S=f.context,M=S.gl,k=d.getSource(),F=f.useProgram("raster"),G=f.colorModeForRenderPass(),X=k instanceof bt?[{},g]:f.stencilConfigForOverlap(g),ue=X[0],Ee=X[1],te=Ee[Ee.length-1].overscaledZ,je=!f.options.moving,ze=0,nt=Ee;ze<nt.length;ze+=1){var Be=nt[ze],rt=f.depthModeForSublayer(Be.overscaledZ-te,h.paint.get("raster-opacity")===1?Ce.ReadWrite:Ce.ReadOnly,M.LESS),mt=d.getTile(Be),Dt=f.transform.calculatePosMatrix(Be.toUnwrapped(),je);mt.registerFadeDuration(h.paint.get("raster-fade-duration"));var fr=d.findLoadedParent(Be,0),nr=gf(mt,fr,d,h,f.transform),dr=void 0,Ir=void 0,tn=h.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;S.activeTexture.set(M.TEXTURE0),mt.texture.bind(tn,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(M.TEXTURE1),fr?(fr.texture.bind(tn,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),dr=Math.pow(2,fr.tileID.overscaledZ-mt.tileID.overscaledZ),Ir=[mt.tileID.canonical.x*dr%1,mt.tileID.canonical.y*dr%1]):mt.texture.bind(tn,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST);var $r=fp(Dt,Ir||[0,0],dr||1,nr,h);k instanceof bt?F.draw(S,M.TRIANGLES,rt,Ze.disabled,G,dt.disabled,$r,h.id,k.boundsBuffer,f.quadTriangleIndexBuffer,k.boundsSegments):F.draw(S,M.TRIANGLES,rt,ue[Be.overscaledZ],G,dt.disabled,$r,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}},background:function(f,d,h){var g=h.paint.get("background-color"),S=h.paint.get("background-opacity");if(S!==0){var M=f.context,k=M.gl,F=f.transform,G=F.tileSize,X=h.paint.get("background-pattern");if(!f.isPatternMissing(X)){var ue=!X&&g.a===1&&S===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass===ue){var Ee=Ze.disabled,te=f.depthModeForSublayer(0,ue==="opaque"?Ce.ReadWrite:Ce.ReadOnly),je=f.colorModeForRenderPass(),ze=f.useProgram(X?"backgroundPattern":"background"),nt=F.coveringTiles({tileSize:G});X&&(M.activeTexture.set(k.TEXTURE0),f.imageManager.bind(f.context));for(var Be=h.getCrossfadeParameters(),rt=0,mt=nt;rt<mt.length;rt+=1){var Dt=mt[rt],fr=f.transform.calculatePosMatrix(Dt.toUnwrapped()),nr=X?_l(fr,S,f,X,{tileID:Dt,tileSize:G},Be):Fl(fr,S,g);ze.draw(M,k.TRIANGLES,te,Ee,je,dt.disabled,nr,h.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}}}},debug:function(f,d,h){for(var g=0;g<h.length;g++)wh(f,d,h[g])},custom:function(f,d,h){var g=f.context,S=h.implementation;if(f.renderPass==="offscreen"){var M=S.prerender;M&&(f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),M.call(S,g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),g.setStencilMode(Ze.disabled);var k=S.renderingMode==="3d"?new Ce(f.context.gl.LEQUAL,Ce.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Ce.ReadOnly);g.setDepthMode(k),S.render(g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState(),g.bindFramebuffer.set(null)}}},Qa=function(f,d){this.context=new be(f),this.transform=d,this._tileTextures={},this.setup(),this.numSublayers=He.maxUnderzooming+He.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ps,this.gpuTimers={}};Qa.prototype.resize=function(f,d){if(this.width=f*y.browser.devicePixelRatio,this.height=d*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var h=0,g=this.style._order;h<g.length;h+=1)this.style._layers[g[h]].resize()},Qa.prototype.setup=function(){var f=this.context,d=new y.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(y.EXTENT,0),d.emplaceBack(0,y.EXTENT),d.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=f.createVertexBuffer(d,zi.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var h=new y.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(y.EXTENT,0),h.emplaceBack(0,y.EXTENT),h.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=f.createVertexBuffer(h,zi.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var g=new y.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(y.EXTENT,0,y.EXTENT,0),g.emplaceBack(0,y.EXTENT,0,y.EXTENT),g.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=f.createVertexBuffer(g,oe.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var S=new y.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=f.createVertexBuffer(S,zi.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var M=new y.StructArrayLayout1ui2;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=f.createIndexBuffer(M);var k=new y.StructArrayLayout3ui6;k.emplaceBack(0,1,2),k.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=f.createIndexBuffer(k),this.emptyTexture=new y.Texture(f,{width:1,height:1,data:new Uint8Array([0,0,0,0])},f.gl.RGBA);var F=this.context.gl;this.stencilClearMode=new Ze({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO)},Qa.prototype.clearStencil=function(){var f=this.context,d=f.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var h=y.create();y.ortho(h,0,this.width,this.height,0,0,1),y.scale(h,h,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(f,d.TRIANGLES,Ce.disabled,this.stencilClearMode,et.disabled,dt.disabled,Qs(h),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Qa.prototype._renderTileClippingMasks=function(f,d){if(this.currentStencilSource!==f.source&&f.isTileClipped()&&d&&d.length){this.currentStencilSource=f.source;var h=this.context,g=h.gl;this.nextStencilID+d.length>256&&this.clearStencil(),h.setColorMode(et.disabled),h.setDepthMode(Ce.disabled);var S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var M=0,k=d;M<k.length;M+=1){var F=k[M],G=this._tileClippingMaskIDs[F.key]=this.nextStencilID++;S.draw(h,g.TRIANGLES,Ce.disabled,new Ze({func:g.ALWAYS,mask:0},G,255,g.KEEP,g.KEEP,g.REPLACE),et.disabled,dt.disabled,Qs(F.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Qa.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var f=this.nextStencilID++,d=this.context.gl;return new Ze({func:d.NOTEQUAL,mask:255},f,255,d.KEEP,d.KEEP,d.REPLACE)},Qa.prototype.stencilModeForClipping=function(f){var d=this.context.gl;return new Ze({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[f.key],0,d.KEEP,d.KEEP,d.REPLACE)},Qa.prototype.stencilConfigForOverlap=function(f){var d,h=this.context.gl,g=f.sort(function(G,X){return X.overscaledZ-G.overscaledZ}),S=g[g.length-1].overscaledZ,M=g[0].overscaledZ-S+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();for(var k={},F=0;F<M;F++)k[F+S]=new Ze({func:h.GEQUAL,mask:255},F+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=M,[k,g]}return[(d={},d[S]=Ze.disabled,d),g]},Qa.prototype.colorModeForRenderPass=function(){var f=this.context.gl;return this._showOverdrawInspector?new et([f.CONSTANT_COLOR,f.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?et.unblended:et.alphaBlended},Qa.prototype.depthModeForSublayer=function(f,d,h){if(!this.opaquePassEnabledForLayer())return Ce.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+f)*this.depthEpsilon;return new Ce(h||this.context.gl.LEQUAL,d,[g,g])},Qa.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Qa.prototype.render=function(f,d){var h=this;this.style=f,this.options=d,this.lineAtlas=f.lineAtlas,this.imageManager=f.imageManager,this.glyphManager=f.glyphManager,this.symbolFadeChange=f.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var g=this.style._order,S=this.style.sourceCaches;for(var M in S){var k=S[M];k.used&&k.prepare(this.context)}var F,G,X={},ue={},Ee={};for(var te in S){var je=S[te];X[te]=je.getVisibleCoordinates(),ue[te]=X[te].slice().reverse(),Ee[te]=je.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var ze=0;ze<g.length;ze++)if(this.style._layers[g[ze]].is3D()){this.opaquePassCutoff=ze;break}this.renderPass="offscreen";for(var nt=0,Be=g;nt<Be.length;nt+=1){var rt=this.style._layers[Be[nt]];if(rt.hasOffscreenPass()&&!rt.isHidden(this.transform.zoom)){var mt=ue[rt.source];(rt.type==="custom"||mt.length)&&this.renderLayer(this,S[rt.source],rt,mt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(f._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var Dt=this.style._layers[g[this.currentLayer]],fr=S[Dt.source],nr=X[Dt.source];this._renderTileClippingMasks(Dt,nr),this.renderLayer(this,fr,Dt,nr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var dr=this.style._layers[g[this.currentLayer]],Ir=S[dr.source],tn=(dr.type==="symbol"?Ee:ue)[dr.source];this._renderTileClippingMasks(dr,X[dr.source]),this.renderLayer(this,Ir,dr,tn)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function($r){$r.source&&!$r.isHidden(h.transform.zoom)&&($r.source!==(G&&G.id)&&(G=h.style.sourceCaches[$r.source]),(!F||F.getSource().maxzoom<G.getSource().maxzoom)&&(F=G))}),F&&as.debug(this,F,F.getVisibleCoordinates())),this.options.showPadding&&function($r){var bn=$r.transform.padding;Sh($r,$r.transform.height-(bn.top||0),3,Sl),Sh($r,bn.bottom||0,3,yf),Ch($r,bn.left||0,3,Xf),Ch($r,$r.transform.width-(bn.right||0),3,Uu);var Qn=$r.transform.centerPoint;(function($n,ei,Fi,Cn){Nl($n,ei-1,Fi-10,2,20,Cn),Nl($n,ei-10,Fi-1,20,2,Cn)})($r,Qn.x,$r.transform.height-Qn.y,Eh)}(this),this.context.setDefault()},Qa.prototype.renderLayer=function(f,d,h,g){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||g.length)&&(this.id=h.id,this.gpuTimingStart(h),as[h.type](f,d,h,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},Qa.prototype.gpuTimingStart=function(f){if(this.options.gpuTiming){var d=this.context.extTimerQuery,h=this.gpuTimers[f.id];h||(h=this.gpuTimers[f.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),h.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,h.query)}},Qa.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var f=this.context.extTimerQuery;f.endQueryEXT(f.TIME_ELAPSED_EXT)}},Qa.prototype.collectGpuTimers=function(){var f=this.gpuTimers;return this.gpuTimers={},f},Qa.prototype.queryGpuTimers=function(f){var d={};for(var h in f){var g=f[h],S=this.context.extTimerQuery,M=S.getQueryObjectEXT(g.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(g.query),d[h]=M}return d},Qa.prototype.translatePosMatrix=function(f,d,h,g,S){if(!h[0]&&!h[1])return f;var M=S?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(M){var k=Math.sin(M),F=Math.cos(M);h=[h[0]*F-h[1]*k,h[0]*k+h[1]*F]}var G=[S?h[0]:sa(d,h[0],this.transform.zoom),S?h[1]:sa(d,h[1],this.transform.zoom),0],X=new Float32Array(16);return y.translate(X,f,G),X},Qa.prototype.saveTileTexture=function(f){var d=this._tileTextures[f.size[0]];d?d.push(f):this._tileTextures[f.size[0]]=[f]},Qa.prototype.getTileTexture=function(f){var d=this._tileTextures[f];return d&&d.length>0?d.pop():null},Qa.prototype.isPatternMissing=function(f){if(!f)return!1;if(!f.from||!f.to)return!0;var d=this.imageManager.getPattern(f.from.toString()),h=this.imageManager.getPattern(f.to.toString());return!d||!h},Qa.prototype.useProgram=function(f,d){this.cache=this.cache||{};var h=""+f+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[h]||(this.cache[h]=new hf(this.context,f,ys[f],d,xl[f],this._showOverdrawInspector)),this.cache[h]},Qa.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Qa.prototype.setBaseState=function(){var f=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(f.FUNC_ADD)},Qa.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Qa.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var ha=function(f,d){this.points=f,this.planes=d};ha.fromInvProjectionMatrix=function(f,d,h){var g=Math.pow(2,h),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(k){return y.transformMat4([],k,f)}).map(function(k){return y.scale$1([],k,1/k[3]/d*g)}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(k){var F=y.sub([],S[k[0]],S[k[1]]),G=y.sub([],S[k[2]],S[k[1]]),X=y.normalize([],y.cross([],F,G)),ue=-y.dot(X,S[k[1]]);return X.concat(ue)});return new ha(S,M)};var zl=function(f,d){this.min=f,this.max=d,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};zl.prototype.quadrant=function(f){for(var d=[f%2==0,f<2],h=y.clone$2(this.min),g=y.clone$2(this.max),S=0;S<d.length;S++)h[S]=d[S]?this.min[S]:this.center[S],g[S]=d[S]?this.center[S]:this.max[S];return g[2]=this.max[2],new zl(h,g)},zl.prototype.distanceX=function(f){return Math.max(Math.min(this.max[0],f[0]),this.min[0])-f[0]},zl.prototype.distanceY=function(f){return Math.max(Math.min(this.max[1],f[1]),this.min[1])-f[1]},zl.prototype.intersects=function(f){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],h=!0,g=0;g<f.planes.length;g++){for(var S=f.planes[g],M=0,k=0;k<d.length;k++)M+=y.dot$1(S,d[k])>=0;if(M===0)return 0;M!==d.length&&(h=!1)}if(h)return 2;for(var F=0;F<3;F++){for(var G=Number.MAX_VALUE,X=-Number.MAX_VALUE,ue=0;ue<f.points.length;ue++){var Ee=f.points[ue][F]-this.min[F];G=Math.min(G,Ee),X=Math.max(X,Ee)}if(X<0||G>this.max[F]-this.min[F])return 0}return 1};var rl=function(f,d,h,g){if(f===void 0&&(f=0),d===void 0&&(d=0),h===void 0&&(h=0),g===void 0&&(g=0),isNaN(f)||f<0||isNaN(d)||d<0||isNaN(h)||h<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=f,this.bottom=d,this.left=h,this.right=g};rl.prototype.interpolate=function(f,d,h){return d.top!=null&&f.top!=null&&(this.top=y.number(f.top,d.top,h)),d.bottom!=null&&f.bottom!=null&&(this.bottom=y.number(f.bottom,d.bottom,h)),d.left!=null&&f.left!=null&&(this.left=y.number(f.left,d.left,h)),d.right!=null&&f.right!=null&&(this.right=y.number(f.right,d.right,h)),this},rl.prototype.getCenter=function(f,d){var h=y.clamp((this.left+f-this.right)/2,0,f),g=y.clamp((this.top+d-this.bottom)/2,0,d);return new y.Point(h,g)},rl.prototype.equals=function(f){return this.top===f.top&&this.bottom===f.bottom&&this.left===f.left&&this.right===f.right},rl.prototype.clone=function(){return new rl(this.top,this.bottom,this.left,this.right)},rl.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var qi=function(f,d,h,g,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||S,this._minZoom=f||0,this._maxZoom=d||22,this._minPitch=h==null?0:h,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new rl,this._posMatrixCache={},this._alignedPosMatrixCache={}},Oa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};qi.prototype.clone=function(){var f=new qi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return f.tileSize=this.tileSize,f.latRange=this.latRange,f.width=this.width,f.height=this.height,f._center=this._center,f.zoom=this.zoom,f.angle=this.angle,f._fov=this._fov,f._pitch=this._pitch,f._unmodified=this._unmodified,f._edgeInsets=this._edgeInsets.clone(),f._calcMatrices(),f},Oa.minZoom.get=function(){return this._minZoom},Oa.minZoom.set=function(f){this._minZoom!==f&&(this._minZoom=f,this.zoom=Math.max(this.zoom,f))},Oa.maxZoom.get=function(){return this._maxZoom},Oa.maxZoom.set=function(f){this._maxZoom!==f&&(this._maxZoom=f,this.zoom=Math.min(this.zoom,f))},Oa.minPitch.get=function(){return this._minPitch},Oa.minPitch.set=function(f){this._minPitch!==f&&(this._minPitch=f,this.pitch=Math.max(this.pitch,f))},Oa.maxPitch.get=function(){return this._maxPitch},Oa.maxPitch.set=function(f){this._maxPitch!==f&&(this._maxPitch=f,this.pitch=Math.min(this.pitch,f))},Oa.renderWorldCopies.get=function(){return this._renderWorldCopies},Oa.renderWorldCopies.set=function(f){f===void 0?f=!0:f===null&&(f=!1),this._renderWorldCopies=f},Oa.worldSize.get=function(){return this.tileSize*this.scale},Oa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Oa.size.get=function(){return new y.Point(this.width,this.height)},Oa.bearing.get=function(){return-this.angle/Math.PI*180},Oa.bearing.set=function(f){var d=-y.wrap(f,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Oa.pitch.get=function(){return this._pitch/Math.PI*180},Oa.pitch.set=function(f){var d=y.clamp(f,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},Oa.fov.get=function(){return this._fov/Math.PI*180},Oa.fov.set=function(f){f=Math.max(.01,Math.min(60,f)),this._fov!==f&&(this._unmodified=!1,this._fov=f/180*Math.PI,this._calcMatrices())},Oa.zoom.get=function(){return this._zoom},Oa.zoom.set=function(f){var d=Math.min(Math.max(f,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},Oa.center.get=function(){return this._center},Oa.center.set=function(f){f.lat===this._center.lat&&f.lng===this._center.lng||(this._unmodified=!1,this._center=f,this._constrain(),this._calcMatrices())},Oa.padding.get=function(){return this._edgeInsets.toJSON()},Oa.padding.set=function(f){this._edgeInsets.equals(f)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,f,1),this._calcMatrices())},Oa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},qi.prototype.isPaddingEqual=function(f){return this._edgeInsets.equals(f)},qi.prototype.interpolatePadding=function(f,d,h){this._unmodified=!1,this._edgeInsets.interpolate(f,d,h),this._constrain(),this._calcMatrices()},qi.prototype.coveringZoomLevel=function(f){var d=(f.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/f.tileSize));return Math.max(0,d)},qi.prototype.getVisibleUnwrappedCoordinates=function(f){var d=[new y.UnwrappedTileID(0,f)];if(this._renderWorldCopies)for(var h=this.pointCoordinate(new y.Point(0,0)),g=this.pointCoordinate(new y.Point(this.width,0)),S=this.pointCoordinate(new y.Point(this.width,this.height)),M=this.pointCoordinate(new y.Point(0,this.height)),k=Math.floor(Math.min(h.x,g.x,S.x,M.x)),F=Math.floor(Math.max(h.x,g.x,S.x,M.x)),G=k-1;G<=F+1;G++)G!==0&&d.push(new y.UnwrappedTileID(G,f));return d},qi.prototype.coveringTiles=function(f){var d=this.coveringZoomLevel(f),h=d;if(f.minzoom!==void 0&&d<f.minzoom)return[];f.maxzoom!==void 0&&d>f.maxzoom&&(d=f.maxzoom);var g=y.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,d),M=[S*g.x,S*g.y,0],k=ha.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),F=f.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(F=d);var G=function($r){return{aabb:new zl([$r*S,0,0],[($r+1)*S,S,0]),zoom:0,x:0,y:0,wrap:$r,fullyVisible:!1}},X=[],ue=[],Ee=d,te=f.reparseOverscaled?h:d;if(this._renderWorldCopies)for(var je=1;je<=3;je++)X.push(G(-je)),X.push(G(je));for(X.push(G(0));X.length>0;){var ze=X.pop(),nt=ze.x,Be=ze.y,rt=ze.fullyVisible;if(!rt){var mt=ze.aabb.intersects(k);if(mt===0)continue;rt=mt===2}var Dt=ze.aabb.distanceX(M),fr=ze.aabb.distanceY(M),nr=Math.max(Math.abs(Dt),Math.abs(fr));if(ze.zoom===Ee||nr>3+(1<<Ee-ze.zoom)-2&&ze.zoom>=F)ue.push({tileID:new y.OverscaledTileID(ze.zoom===Ee?te:ze.zoom,ze.wrap,ze.zoom,nt,Be),distanceSq:y.sqrLen([M[0]-.5-nt,M[1]-.5-Be])});else for(var dr=0;dr<4;dr++){var Ir=(nt<<1)+dr%2,tn=(Be<<1)+(dr>>1);X.push({aabb:ze.aabb.quadrant(dr),zoom:ze.zoom+1,x:Ir,y:tn,wrap:ze.wrap,fullyVisible:rt})}}return ue.sort(function($r,bn){return $r.distanceSq-bn.distanceSq}).map(function($r){return $r.tileID})},qi.prototype.resize=function(f,d){this.width=f,this.height=d,this.pixelsToGLUnits=[2/f,-2/d],this._constrain(),this._calcMatrices()},Oa.unmodified.get=function(){return this._unmodified},qi.prototype.zoomScale=function(f){return Math.pow(2,f)},qi.prototype.scaleZoom=function(f){return Math.log(f)/Math.LN2},qi.prototype.project=function(f){var d=y.clamp(f.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(f.lng)*this.worldSize,y.mercatorYfromLat(d)*this.worldSize)},qi.prototype.unproject=function(f){return new y.MercatorCoordinate(f.x/this.worldSize,f.y/this.worldSize).toLngLat()},Oa.point.get=function(){return this.project(this.center)},qi.prototype.setLocationAtPoint=function(f,d){var h=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(f),M=new y.MercatorCoordinate(S.x-(h.x-g.x),S.y-(h.y-g.y));this.center=this.coordinateLocation(M),this._renderWorldCopies&&(this.center=this.center.wrap())},qi.prototype.locationPoint=function(f){return this.coordinatePoint(this.locationCoordinate(f))},qi.prototype.pointLocation=function(f){return this.coordinateLocation(this.pointCoordinate(f))},qi.prototype.locationCoordinate=function(f){return y.MercatorCoordinate.fromLngLat(f)},qi.prototype.coordinateLocation=function(f){return f.toLngLat()},qi.prototype.pointCoordinate=function(f){var d=[f.x,f.y,0,1],h=[f.x,f.y,1,1];y.transformMat4(d,d,this.pixelMatrixInverse),y.transformMat4(h,h,this.pixelMatrixInverse);var g=d[3],S=h[3],M=d[1]/g,k=h[1]/S,F=d[2]/g,G=h[2]/S,X=F===G?0:(0-F)/(G-F);return new y.MercatorCoordinate(y.number(d[0]/g,h[0]/S,X)/this.worldSize,y.number(M,k,X)/this.worldSize)},qi.prototype.coordinatePoint=function(f){var d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return y.transformMat4(d,d,this.pixelMatrix),new y.Point(d[0]/d[3],d[1]/d[3])},qi.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},qi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},qi.prototype.setMaxBounds=function(f){f?(this.lngRange=[f.getWest(),f.getEast()],this.latRange=[f.getSouth(),f.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},qi.prototype.calculatePosMatrix=function(f,d){d===void 0&&(d=!1);var h=f.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[h])return g[h];var S=f.canonical,M=this.worldSize/this.zoomScale(S.z),k=S.x+Math.pow(2,S.z)*f.wrap,F=y.identity(new Float64Array(16));return y.translate(F,F,[k*M,S.y*M,0]),y.scale(F,F,[M/y.EXTENT,M/y.EXTENT,1]),y.multiply(F,d?this.alignedProjMatrix:this.projMatrix,F),g[h]=new Float32Array(F),g[h]},qi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},qi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var f,d,h,g,S=-90,M=90,k=-180,F=180,G=this.size,X=this._unmodified;if(this.latRange){var ue=this.latRange;S=y.mercatorYfromLat(ue[1])*this.worldSize,f=(M=y.mercatorYfromLat(ue[0])*this.worldSize)-S<G.y?G.y/(M-S):0}if(this.lngRange){var Ee=this.lngRange;k=y.mercatorXfromLng(Ee[0])*this.worldSize,d=(F=y.mercatorXfromLng(Ee[1])*this.worldSize)-k<G.x?G.x/(F-k):0}var te=this.point,je=Math.max(d||0,f||0);if(je)return this.center=this.unproject(new y.Point(d?(F+k)/2:te.x,f?(M+S)/2:te.y)),this.zoom+=this.scaleZoom(je),this._unmodified=X,void(this._constraining=!1);if(this.latRange){var ze=te.y,nt=G.y/2;ze-nt<S&&(g=S+nt),ze+nt>M&&(g=M-nt)}if(this.lngRange){var Be=te.x,rt=G.x/2;Be-rt<k&&(h=k+rt),Be+rt>F&&(h=F-rt)}h===void 0&&g===void 0||(this.center=this.unproject(new y.Point(h!==void 0?h:te.x,g!==void 0?g:te.y))),this._unmodified=X,this._constraining=!1}},qi.prototype._calcMatrices=function(){if(this.height){var f=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var d=Math.PI/2+this._pitch,h=this._fov*(.5+f.y/this.height),g=Math.sin(h)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-d-h,.01,Math.PI-.01)),S=this.point,M=S.x,k=S.y,F=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),G=this.height/50,X=new Float64Array(16);y.perspective(X,this._fov,this.width/this.height,G,F),X[8]=2*-f.x/this.width,X[9]=2*f.y/this.height,y.scale(X,X,[1,-1,1]),y.translate(X,X,[0,0,-this.cameraToCenterDistance]),y.rotateX(X,X,this._pitch),y.rotateZ(X,X,this.angle),y.translate(X,X,[-M,-k,0]),this.mercatorMatrix=y.scale([],X,[this.worldSize,this.worldSize,this.worldSize]),y.scale(X,X,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=X,this.invProjMatrix=y.invert([],this.projMatrix);var ue=this.width%2/2,Ee=this.height%2/2,te=Math.cos(this.angle),je=Math.sin(this.angle),ze=M-Math.round(M)+te*ue+je*Ee,nt=k-Math.round(k)+te*Ee+je*ue,Be=new Float64Array(X);if(y.translate(Be,Be,[ze>.5?ze-1:ze,nt>.5?nt-1:nt,0]),this.alignedProjMatrix=Be,X=y.create(),y.scale(X,X,[this.width/2,-this.height/2,1]),y.translate(X,X,[1,-1,0]),this.labelPlaneMatrix=X,X=y.create(),y.scale(X,X,[1,-1,1]),y.translate(X,X,[-1,-1,0]),y.scale(X,X,[2/this.width,2/this.height,1]),this.glCoordMatrix=X,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(X=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=X,this._posMatrixCache={},this._alignedPosMatrixCache={}}},qi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var f=this.pointCoordinate(new y.Point(0,0)),d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return y.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},qi.prototype.getCameraPoint=function(){var f=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,f))},qi.prototype.getCameraQueryGeometry=function(f){var d=this.getCameraPoint();if(f.length===1)return[f[0],d];for(var h=d.x,g=d.y,S=d.x,M=d.y,k=0,F=f;k<F.length;k+=1){var G=F[k];h=Math.min(h,G.x),g=Math.min(g,G.y),S=Math.max(S,G.x),M=Math.max(M,G.y)}return[new y.Point(h,g),new y.Point(S,g),new y.Point(S,M),new y.Point(h,M),new y.Point(h,g)]},Object.defineProperties(qi.prototype,Oa);var Fs=function(f){var d,h,g,S;this._hashName=f&&encodeURIComponent(f),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(d=this._updateHashUnthrottled.bind(this),h=!1,g=null,S=function(){g=null,h&&(d(),g=setTimeout(S,300),h=!1)},function(){return h=!0,g||S(),g})};Fs.prototype.addTo=function(f){return this._map=f,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Fs.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Fs.prototype.getHashString=function(f){var d=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,g=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,g),M=Math.round(d.lng*S)/S,k=Math.round(d.lat*S)/S,F=this._map.getBearing(),G=this._map.getPitch(),X="";if(X+=f?"/"+M+"/"+k+"/"+h:h+"/"+k+"/"+M,(F||G)&&(X+="/"+Math.round(10*F)/10),G&&(X+="/"+Math.round(G)),this._hashName){var ue=this._hashName,Ee=!1,te=y.window.location.hash.slice(1).split("&").map(function(je){var ze=je.split("=")[0];return ze===ue?(Ee=!0,ze+"="+X):je}).filter(function(je){return je});return Ee||te.push(ue+"="+X),"#"+te.join("&")}return"#"+X},Fs.prototype._getCurrentHash=function(){var f,d=this,h=y.window.location.hash.replace("#","");return this._hashName?(h.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===d._hashName&&(f=g)}),(f&&f[1]||"").split("/")):h.split("/")},Fs.prototype._onHashChange=function(){var f=this._getCurrentHash();if(f.length>=3&&!f.some(function(h){return isNaN(h)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:d,pitch:+(f[4]||0)}),!0}return!1},Fs.prototype._updateHashUnthrottled=function(){var f=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,f)}catch(d){}};var Gc={linearity:.3,easing:y.bezier(0,0,.3,1)},Ia=y.extend({deceleration:2500,maxSpeed:1400},Gc),Zu=y.extend({deceleration:20,maxSpeed:1400},Gc),Ul=y.extend({deceleration:1e3,maxSpeed:360},Gc),Hc=y.extend({deceleration:1e3,maxSpeed:90},Gc),Wc=function(f){this._map=f,this.clear()};function hc(f,d){(!f.duration||f.duration<d.duration)&&(f.duration=d.duration,f.easing=d.easing)}function Eu(f,d,h){var g=h.maxSpeed,S=h.linearity,M=h.deceleration,k=y.clamp(f*S/(d/1e3),-g,g),F=Math.abs(k)/(M*S);return{easing:h.easing,duration:1e3*F,amount:k*(F/2)}}Wc.prototype.clear=function(){this._inertiaBuffer=[]},Wc.prototype.record=function(f){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:f})},Wc.prototype._drainInertiaBuffer=function(){for(var f=this._inertiaBuffer,d=y.browser.now();f.length>0&&d-f[0].time>160;)f.shift()},Wc.prototype._onMoveEnd=function(f){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var d={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},h=0,g=this._inertiaBuffer;h<g.length;h+=1){var S=g[h].settings;d.zoom+=S.zoomDelta||0,d.bearing+=S.bearingDelta||0,d.pitch+=S.pitchDelta||0,S.panDelta&&d.pan._add(S.panDelta),S.around&&(d.around=S.around),S.pinchAround&&(d.pinchAround=S.pinchAround)}var M=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,k={};if(d.pan.mag()){var F=Eu(d.pan.mag(),M,y.extend({},Ia,f||{}));k.offset=d.pan.mult(F.amount/d.pan.mag()),k.center=this._map.transform.center,hc(k,F)}if(d.zoom){var G=Eu(d.zoom,M,Zu);k.zoom=this._map.transform.zoom+G.amount,hc(k,G)}if(d.bearing){var X=Eu(d.bearing,M,Ul);k.bearing=this._map.transform.bearing+y.clamp(X.amount,-179,179),hc(k,X)}if(d.pitch){var ue=Eu(d.pitch,M,Hc);k.pitch=this._map.transform.pitch+ue.amount,hc(k,ue)}if(k.zoom||k.bearing){var Ee=d.pinchAround===void 0?d.around:d.pinchAround;k.around=Ee?this._map.unproject(Ee):this._map.getCenter()}return this.clear(),y.extend(k,{noMoveStart:!0})}};var Io=function(f){function d(g,S,M,k){k===void 0&&(k={});var F=T.mousePos(S.getCanvasContainer(),M),G=S.unproject(F);f.call(this,g,y.extend({point:F,lngLat:G,originalEvent:M},k)),this._defaultPrevented=!1,this.target=S}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),pc=function(f){function d(g,S,M){var k=g==="touchend"?M.changedTouches:M.touches,F=T.touchPos(S.getCanvasContainer(),k),G=F.map(function(Ee){return S.unproject(Ee)}),X=F.reduce(function(Ee,te,je,ze){return Ee.add(te.div(ze.length))},new y.Point(0,0)),ue=S.unproject(X);f.call(this,g,{points:F,point:X,lngLats:G,lngLat:ue,originalEvent:M}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),Zl=function(f){function d(g,S,M){f.call(this,g,{originalEvent:M}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),ko=function(f,d){this._map=f,this._clickTolerance=d.clickTolerance};ko.prototype.reset=function(){delete this._mousedownPos},ko.prototype.wheel=function(f){return this._firePreventable(new Zl(f.type,this._map,f))},ko.prototype.mousedown=function(f,d){return this._mousedownPos=d,this._firePreventable(new Io(f.type,this._map,f))},ko.prototype.mouseup=function(f){this._map.fire(new Io(f.type,this._map,f))},ko.prototype.click=function(f,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Io(f.type,this._map,f))},ko.prototype.dblclick=function(f){return this._firePreventable(new Io(f.type,this._map,f))},ko.prototype.mouseover=function(f){this._map.fire(new Io(f.type,this._map,f))},ko.prototype.mouseout=function(f){this._map.fire(new Io(f.type,this._map,f))},ko.prototype.touchstart=function(f){return this._firePreventable(new pc(f.type,this._map,f))},ko.prototype.touchmove=function(f){this._map.fire(new pc(f.type,this._map,f))},ko.prototype.touchend=function(f){this._map.fire(new pc(f.type,this._map,f))},ko.prototype.touchcancel=function(f){this._map.fire(new pc(f.type,this._map,f))},ko.prototype._firePreventable=function(f){if(this._map.fire(f),f.defaultPrevented)return{}},ko.prototype.isEnabled=function(){return!0},ko.prototype.isActive=function(){return!1},ko.prototype.enable=function(){},ko.prototype.disable=function(){};var Rn=function(f){this._map=f};Rn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Rn.prototype.mousemove=function(f){this._map.fire(new Io(f.type,this._map,f))},Rn.prototype.mousedown=function(){this._delayContextMenu=!0},Rn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Io("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Rn.prototype.contextmenu=function(f){this._delayContextMenu?this._contextMenuEvent=f:this._map.fire(new Io(f.type,this._map,f)),this._map.listens("contextmenu")&&f.preventDefault()},Rn.prototype.isEnabled=function(){return!0},Rn.prototype.isActive=function(){return!1},Rn.prototype.enable=function(){},Rn.prototype.disable=function(){};var lo=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._container=f.getContainer(),this._clickTolerance=d.clickTolerance||1};function Da(f,d){for(var h={},g=0;g<f.length;g++)h[f[g].identifier]=d[g];return h}lo.prototype.isEnabled=function(){return!!this._enabled},lo.prototype.isActive=function(){return!!this._active},lo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},lo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},lo.prototype.mousedown=function(f,d){this.isEnabled()&&f.shiftKey&&f.button===0&&(T.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)},lo.prototype.mousemoveWindow=function(f,d){if(this._active){var h=d;if(!(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=h,this._box||(this._box=T.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",f));var S=Math.min(g.x,h.x),M=Math.max(g.x,h.x),k=Math.min(g.y,h.y),F=Math.max(g.y,h.y);T.setTransform(this._box,"translate("+S+"px,"+k+"px)"),this._box.style.width=M-S+"px",this._box.style.height=F-k+"px"}}},lo.prototype.mouseupWindow=function(f,d){var h=this;if(this._active&&f.button===0){var g=this._startPos,S=d;if(this.reset(),T.suppressClick(),g.x!==S.x||g.y!==S.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:f})),{cameraAnimation:function(M){return M.fitScreenCoordinates(g,S,h._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",f)}},lo.prototype.keydown=function(f){this._active&&f.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",f))},lo.prototype.blur=function(){this.reset()},lo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(T.remove(this._box),this._box=null),T.enableDrag(),delete this._startPos,delete this._lastPos},lo.prototype._fireEvent=function(f,d){return this._map.fire(new y.Event(f,{originalEvent:d}))};var Vl=function(f){this.reset(),this.numTouches=f.numTouches};Vl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Vl.prototype.touchstart=function(f,d,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=f.timeStamp),h.length===this.numTouches&&(this.centroid=function(g){for(var S=new y.Point(0,0),M=0,k=g;M<k.length;M+=1)S._add(k[M]);return S.div(g.length)}(d),this.touches=Da(h,d)))},Vl.prototype.touchmove=function(f,d,h){if(!this.aborted&&this.centroid){var g=Da(h,d);for(var S in this.touches){var M=g[S];(!M||M.dist(this.touches[S])>30)&&(this.aborted=!0)}}},Vl.prototype.touchend=function(f,d,h){if((!this.centroid||f.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var cu=function(f){this.singleTap=new Vl(f),this.numTaps=f.numTaps,this.reset()};cu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},cu.prototype.touchstart=function(f,d,h){this.singleTap.touchstart(f,d,h)},cu.prototype.touchmove=function(f,d,h){this.singleTap.touchmove(f,d,h)},cu.prototype.touchend=function(f,d,h){var g=this.singleTap.touchend(f,d,h);if(g){var S=f.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(g)<30;if(S&&M||this.reset(),this.count++,this.lastTime=f.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var Ds=function(){this._zoomIn=new cu({numTouches:1,numTaps:2}),this._zoomOut=new cu({numTouches:2,numTaps:1}),this.reset()};Ds.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ds.prototype.touchstart=function(f,d,h){this._zoomIn.touchstart(f,d,h),this._zoomOut.touchstart(f,d,h)},Ds.prototype.touchmove=function(f,d,h){this._zoomIn.touchmove(f,d,h),this._zoomOut.touchmove(f,d,h)},Ds.prototype.touchend=function(f,d,h){var g=this,S=this._zoomIn.touchend(f,d,h),M=this._zoomOut.touchend(f,d,h);return S?(this._active=!0,f.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(k){return k.easeTo({duration:300,zoom:k.getZoom()+1,around:k.unproject(S)},{originalEvent:f})}}):M?(this._active=!0,f.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(k){return k.easeTo({duration:300,zoom:k.getZoom()-1,around:k.unproject(M)},{originalEvent:f})}}):void 0},Ds.prototype.touchcancel=function(){this.reset()},Ds.prototype.enable=function(){this._enabled=!0},Ds.prototype.disable=function(){this._enabled=!1,this.reset()},Ds.prototype.isEnabled=function(){return this._enabled},Ds.prototype.isActive=function(){return this._active};var _f={0:1,2:2},dn=function(f){this.reset(),this._clickTolerance=f.clickTolerance||1};dn.prototype.blur=function(){this.reset()},dn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},dn.prototype._correctButton=function(f,d){return!1},dn.prototype._move=function(f,d){return{}},dn.prototype.mousedown=function(f,d){if(!this._lastPoint){var h=T.mouseButton(f);this._correctButton(f,h)&&(this._lastPoint=d,this._eventButton=h)}},dn.prototype.mousemoveWindow=function(f,d){var h=this._lastPoint;if(h){if(f.preventDefault(),function(g,S){var M=_f[S];return g.buttons===void 0||(g.buttons&M)!==M}(f,this._eventButton))this.reset();else if(this._moved||!(d.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(h,d)}},dn.prototype.mouseupWindow=function(f){this._lastPoint&&T.mouseButton(f)===this._eventButton&&(this._moved&&T.suppressClick(),this.reset())},dn.prototype.enable=function(){this._enabled=!0},dn.prototype.disable=function(){this._enabled=!1,this.reset()},dn.prototype.isEnabled=function(){return this._enabled},dn.prototype.isActive=function(){return this._active};var dc=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.mousedown=function(h,g){f.prototype.mousedown.call(this,h,g),this._lastPoint&&(this._active=!0)},d.prototype._correctButton=function(h,g){return g===0&&!h.ctrlKey},d.prototype._move=function(h,g){return{around:g,panDelta:g.sub(h)}},d}(dn),vc=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var S=.8*(g.x-h.x);if(S)return this._active=!0,{bearingDelta:S}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(dn),Cl=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var S=-.5*(g.y-h.y);if(S)return this._active=!0,{pitchDelta:S}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(dn),za=function(f){this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset()};za.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},za.prototype.touchstart=function(f,d,h){return this._calculateTransform(f,d,h)},za.prototype.touchmove=function(f,d,h){if(this._active&&!(h.length<this._minTouches))return f.preventDefault(),this._calculateTransform(f,d,h)},za.prototype.touchend=function(f,d,h){this._calculateTransform(f,d,h),this._active&&h.length<this._minTouches&&this.reset()},za.prototype.touchcancel=function(){this.reset()},za.prototype._calculateTransform=function(f,d,h){h.length>0&&(this._active=!0);var g=Da(h,d),S=new y.Point(0,0),M=new y.Point(0,0),k=0;for(var F in g){var G=g[F],X=this._touches[F];X&&(S._add(G),M._add(G.sub(X)),k++,g[F]=G)}if(this._touches=g,!(k<this._minTouches)&&M.mag()){var ue=M.div(k);if(this._sum._add(ue),!(this._sum.mag()<this._clickTolerance))return{around:S.div(k),panDelta:ue}}},za.prototype.enable=function(){this._enabled=!0},za.prototype.disable=function(){this._enabled=!1,this.reset()},za.prototype.isEnabled=function(){return this._enabled},za.prototype.isActive=function(){return this._active};var Bs=function(){this.reset()};function Xc(f,d,h){for(var g=0;g<f.length;g++)if(f[g].identifier===h)return d[g]}function xs(f,d){return Math.log(f/d)/Math.LN2}Bs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Bs.prototype._start=function(f){},Bs.prototype._move=function(f,d,h){return{}},Bs.prototype.touchstart=function(f,d,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([d[0],d[1]]))},Bs.prototype.touchmove=function(f,d,h){if(this._firstTwoTouches){f.preventDefault();var g=this._firstTwoTouches,S=g[1],M=Xc(h,d,g[0]),k=Xc(h,d,S);if(M&&k){var F=this._aroundCenter?null:M.add(k).div(2);return this._move([M,k],F,f)}}},Bs.prototype.touchend=function(f,d,h){if(this._firstTwoTouches){var g=this._firstTwoTouches,S=g[1],M=Xc(h,d,g[0]),k=Xc(h,d,S);M&&k||(this._active&&T.suppressClick(),this.reset())}},Bs.prototype.touchcancel=function(){this.reset()},Bs.prototype.enable=function(f){this._enabled=!0,this._aroundCenter=!!f&&f.around==="center"},Bs.prototype.disable=function(){this._enabled=!1,this.reset()},Bs.prototype.isEnabled=function(){return this._enabled},Bs.prototype.isActive=function(){return this._active};var bs=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._distance,delete this._startDistance},d.prototype._start=function(h){this._startDistance=this._distance=h[0].dist(h[1])},d.prototype._move=function(h,g){var S=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(xs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xs(this._distance,S),pinchAround:g}},d}(Bs);function Vu(f,d){return 180*f.angleWith(d)/Math.PI}var Ah=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},d.prototype._start=function(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])},d.prototype._move=function(h,g){var S=this._vector;if(this._vector=h[0].sub(h[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Vu(this._vector,S),pinchAround:g}},d.prototype._isBelowThreshold=function(h){this._minDiameter=Math.min(this._minDiameter,h.mag());var g=25/(Math.PI*this._minDiameter)*360,S=Vu(h,this._startVector);return Math.abs(S)<g},d}(Bs);function xf(f){return Math.abs(f.y)>Math.abs(f.x)}var Yf=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},d.prototype._start=function(h){this._lastPoints=h,xf(h[0].sub(h[1]))&&(this._valid=!1)},d.prototype._move=function(h,g,S){var M=h[0].sub(this._lastPoints[0]),k=h[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(M,k,S.timeStamp),this._valid)return this._lastPoints=h,this._active=!0,{pitchDelta:(M.y+k.y)/2*-.5}},d.prototype.gestureBeginsVertically=function(h,g,S){if(this._valid!==void 0)return this._valid;var M=h.mag()>=2,k=g.mag()>=2;if(M||k){if(!M||!k)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;var F=h.y>0==g.y>0;return xf(h)&&xf(g)&&F}},d}(Bs),$f={panStep:100,bearingStep:15,pitchStep:10},Vs=function(){var f=$f;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1};function eu(f){return f*(2-f)}Vs.prototype.blur=function(){this.reset()},Vs.prototype.reset=function(){this._active=!1},Vs.prototype.keydown=function(f){var d=this;if(!(f.altKey||f.ctrlKey||f.metaKey)){var h=0,g=0,S=0,M=0,k=0;switch(f.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:f.shiftKey?g=-1:(f.preventDefault(),M=-1);break;case 39:f.shiftKey?g=1:(f.preventDefault(),M=1);break;case 38:f.shiftKey?S=1:(f.preventDefault(),k=-1);break;case 40:f.shiftKey?S=-1:(f.preventDefault(),k=1);break;default:return}return this._rotationDisabled&&(g=0,S=0),{cameraAnimation:function(F){var G=F.getZoom();F.easeTo({duration:300,easeId:"keyboardHandler",easing:eu,zoom:h?Math.round(G)+h*(f.shiftKey?2:1):G,bearing:F.getBearing()+g*d._bearingStep,pitch:F.getPitch()+S*d._pitchStep,offset:[-M*d._panStep,-k*d._panStep],center:F.getCenter()},{originalEvent:f})}}}},Vs.prototype.enable=function(){this._enabled=!0},Vs.prototype.disable=function(){this._enabled=!1,this.reset()},Vs.prototype.isEnabled=function(){return this._enabled},Vs.prototype.isActive=function(){return this._active},Vs.prototype.disableRotation=function(){this._rotationDisabled=!0},Vs.prototype.enableRotation=function(){this._rotationDisabled=!1};var Di=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};Di.prototype.setZoomRate=function(f){this._defaultZoomRate=f},Di.prototype.setWheelZoomRate=function(f){this._wheelZoomRate=f},Di.prototype.isEnabled=function(){return!!this._enabled},Di.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Di.prototype.isZooming=function(){return!!this._zooming},Di.prototype.enable=function(f){this.isEnabled()||(this._enabled=!0,this._aroundCenter=f&&f.around==="center")},Di.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Di.prototype.wheel=function(f){if(this.isEnabled()){var d=f.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*f.deltaY:f.deltaY,h=y.browser.now(),g=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,f)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),f.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=f,this._delta-=d,this._active||this._start(f)),f.preventDefault()}},Di.prototype._onTimeout=function(f){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},Di.prototype._start=function(f){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var d=T.mousePos(this._el,f);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Di.prototype.renderFrame=function(){var f=this;if(this._frameId&&(this._frameId=null,this.isActive())){var d=this._map.transform;if(this._delta!==0){var h=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*h)));this._delta<0&&g!==0&&(g=1/g);var S=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(S*g))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var M,k=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,F=this._startZoom,G=this._easing,X=!1;if(this._type==="wheel"&&F&&G){var ue=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),Ee=G(ue);M=y.number(F,k,Ee),ue<1?this._frameId||(this._frameId=!0):X=!0}else M=k,X=!0;return this._active=!0,X&&(this._active=!1,this._finishTimeout=setTimeout(function(){f._zooming=!1,f._handler._triggerRenderFrame(),delete f._targetZoom,delete f._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!X,zoomDelta:M-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Di.prototype._smoothOutEasing=function(f){var d=y.ease;if(this._prevEase){var h=this._prevEase,g=(y.browser.now()-h.start)/h.duration,S=h.easing(g+.01)-h.easing(g),M=.27/Math.sqrt(S*S+1e-4)*.01,k=Math.sqrt(.0729-M*M);d=y.bezier(M,k,.25,1)}return this._prevEase={start:y.browser.now(),duration:f,easing:d},d},Di.prototype.blur=function(){this.reset()},Di.prototype.reset=function(){this._active=!1};var Su=function(f,d){this._clickZoom=f,this._tapZoom=d};Su.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Su.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Su.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Su.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var js=function(){this.reset()};js.prototype.reset=function(){this._active=!1},js.prototype.blur=function(){this.reset()},js.prototype.dblclick=function(f,d){return f.preventDefault(),{cameraAnimation:function(h){h.easeTo({duration:300,zoom:h.getZoom()+(f.shiftKey?-1:1),around:h.unproject(d)},{originalEvent:f})}}},js.prototype.enable=function(){this._enabled=!0},js.prototype.disable=function(){this._enabled=!1,this.reset()},js.prototype.isEnabled=function(){return this._enabled},js.prototype.isActive=function(){return this._active};var cs=function(){this._tap=new cu({numTouches:1,numTaps:1}),this.reset()};cs.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},cs.prototype.touchstart=function(f,d,h){this._swipePoint||(this._tapTime&&f.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=d[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(f,d,h))},cs.prototype.touchmove=function(f,d,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;var g=d[0],S=g.y-this._swipePoint.y;return this._swipePoint=g,f.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(f,d,h)},cs.prototype.touchend=function(f,d,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(f,d,h)&&(this._tapTime=f.timeStamp)},cs.prototype.touchcancel=function(){this.reset()},cs.prototype.enable=function(){this._enabled=!0},cs.prototype.disable=function(){this._enabled=!1,this.reset()},cs.prototype.isEnabled=function(){return this._enabled},cs.prototype.isActive=function(){return this._active};var ju=function(f,d,h){this._el=f,this._mousePan=d,this._touchPan=h};ju.prototype.enable=function(f){this._inertiaOptions=f||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},ju.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},ju.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},ju.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var jl=function(f,d,h){this._pitchWithRotate=f.pitchWithRotate,this._mouseRotate=d,this._mousePitch=h};jl.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},jl.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},jl.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},jl.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var tu=function(f,d,h,g){this._el=f,this._touchZoom=d,this._touchRotate=h,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};tu.prototype.enable=function(f){this._touchZoom.enable(f),this._rotationDisabled||this._touchRotate.enable(f),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},tu.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},tu.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},tu.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},tu.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},tu.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Es=function(f){return f.zoom||f.drag||f.pitch||f.rotate},fu=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d}(y.Event);function Yn(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}var zn=function(f,d){this._map=f,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Wc(f),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),y.bindAll(["handleEvent","handleWindowEvent"],this);var h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[y.window,"blur",void 0]];for(var g=0,S=this._listeners;g<S.length;g+=1){var M=S[g],k=M[0];T.addEventListener(k,M[1],k===y.window.document?this.handleWindowEvent:this.handleEvent,M[2])}};zn.prototype.destroy=function(){for(var f=0,d=this._listeners;f<d.length;f+=1){var h=d[f],g=h[0];T.removeEventListener(g,h[1],g===y.window.document?this.handleWindowEvent:this.handleEvent,h[2])}},zn.prototype._addDefaultHandlers=function(f){var d=this._map,h=d.getCanvasContainer();this._add("mapEvent",new ko(d,f));var g=d.boxZoom=new lo(d,f);this._add("boxZoom",g);var S=new Ds,M=new js;d.doubleClickZoom=new Su(M,S),this._add("tapZoom",S),this._add("clickZoom",M);var k=new cs;this._add("tapDragZoom",k);var F=d.touchPitch=new Yf;this._add("touchPitch",F);var G=new vc(f),X=new Cl(f);d.dragRotate=new jl(f,G,X),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]);var ue=new dc(f),Ee=new za(f);d.dragPan=new ju(h,ue,Ee),this._add("mousePan",ue),this._add("touchPan",Ee,["touchZoom","touchRotate"]);var te=new Ah,je=new bs;d.touchZoomRotate=new tu(h,je,te,k),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",je,["touchPan","touchRotate"]);var ze=d.scrollZoom=new Di(d,this);this._add("scrollZoom",ze,["mousePan"]);var nt=d.keyboard=new Vs;this._add("keyboard",nt),this._add("blockableMapEvent",new Rn(d));for(var Be=0,rt=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Be<rt.length;Be+=1){var mt=rt[Be];f.interactive&&f[mt]&&d[mt].enable(f[mt])}},zn.prototype._add=function(f,d,h){this._handlers.push({handlerName:f,handler:d,allowed:h}),this._handlersById[f]=d},zn.prototype.stop=function(f){if(!this._updatingCamera){for(var d=0,h=this._handlers;d<h.length;d+=1)h[d].handler.reset();this._inertia.clear(),this._fireEvents({},{},f),this._changes=[]}},zn.prototype.isActive=function(){for(var f=0,d=this._handlers;f<d.length;f+=1)if(d[f].handler.isActive())return!0;return!1},zn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},zn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},zn.prototype.isMoving=function(){return Boolean(Es(this._eventsInProgress))||this.isZooming()},zn.prototype._blockedByActive=function(f,d,h){for(var g in f)if(g!==h&&(!d||d.indexOf(g)<0))return!0;return!1},zn.prototype.handleWindowEvent=function(f){this.handleEvent(f,f.type+"Window")},zn.prototype._getMapTouches=function(f){for(var d=[],h=0,g=f;h<g.length;h+=1){var S=g[h];this._el.contains(S.target)&&d.push(S)}return d},zn.prototype.handleEvent=function(f,d){this._updatingCamera=!0;for(var h=f.type==="renderFrame"?void 0:f,g={needsRenderFrame:!1},S={},M={},k=f.touches?this._getMapTouches(f.touches):void 0,F=k?T.touchPos(this._el,k):T.mousePos(this._el,f),G=0,X=this._handlers;G<X.length;G+=1){var ue=X[G],Ee=ue.handlerName,te=ue.handler,je=ue.allowed;if(te.isEnabled()){var ze=void 0;this._blockedByActive(M,je,Ee)?te.reset():te[d||f.type]&&(ze=te[d||f.type](f,F,k),this.mergeHandlerResult(g,S,ze,Ee,h),ze&&ze.needsRenderFrame&&this._triggerRenderFrame()),(ze||te.isActive())&&(M[Ee]=te)}}var nt={};for(var Be in this._previousActiveHandlers)M[Be]||(nt[Be]=h);this._previousActiveHandlers=M,(Object.keys(nt).length||Yn(g))&&(this._changes.push([g,S,nt]),this._triggerRenderFrame()),(Object.keys(M).length||Yn(g))&&this._map._stop(!0),this._updatingCamera=!1;var rt=g.cameraAnimation;rt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],rt(this._map))},zn.prototype.mergeHandlerResult=function(f,d,h,g,S){if(h){y.extend(f,h);var M={handlerName:g,originalEvent:h.originalEvent||S};h.zoomDelta!==void 0&&(d.zoom=M),h.panDelta!==void 0&&(d.drag=M),h.pitchDelta!==void 0&&(d.pitch=M),h.bearingDelta!==void 0&&(d.rotate=M)}},zn.prototype._applyChanges=function(){for(var f={},d={},h={},g=0,S=this._changes;g<S.length;g+=1){var M=S[g],k=M[0],F=M[1],G=M[2];k.panDelta&&(f.panDelta=(f.panDelta||new y.Point(0,0))._add(k.panDelta)),k.zoomDelta&&(f.zoomDelta=(f.zoomDelta||0)+k.zoomDelta),k.bearingDelta&&(f.bearingDelta=(f.bearingDelta||0)+k.bearingDelta),k.pitchDelta&&(f.pitchDelta=(f.pitchDelta||0)+k.pitchDelta),k.around!==void 0&&(f.around=k.around),k.pinchAround!==void 0&&(f.pinchAround=k.pinchAround),k.noInertia&&(f.noInertia=k.noInertia),y.extend(d,F),y.extend(h,G)}this._updateMapTransform(f,d,h),this._changes=[]},zn.prototype._updateMapTransform=function(f,d,h){var g=this._map,S=g.transform;if(!Yn(f))return this._fireEvents(d,h,!0);var M=f.panDelta,k=f.zoomDelta,F=f.bearingDelta,G=f.pitchDelta,X=f.around,ue=f.pinchAround;ue!==void 0&&(X=ue),g._stop(!0),X=X||g.transform.centerPoint;var Ee=S.pointLocation(M?X.sub(M):X);F&&(S.bearing+=F),G&&(S.pitch+=G),k&&(S.zoom+=k),S.setLocationAtPoint(Ee,X),this._map._update(),f.noInertia||this._inertia.record(f),this._fireEvents(d,h,!0)},zn.prototype._fireEvents=function(f,d,h){var g=this,S=Es(this._eventsInProgress),M=Es(f),k={};for(var F in f)this._eventsInProgress[F]||(k[F+"start"]=f[F].originalEvent),this._eventsInProgress[F]=f[F];for(var G in!S&&M&&this._fireEvent("movestart",M.originalEvent),k)this._fireEvent(G,k[G]);for(var X in M&&this._fireEvent("move",M.originalEvent),f)this._fireEvent(X,f[X].originalEvent);var ue,Ee={};for(var te in this._eventsInProgress){var je=this._eventsInProgress[te],ze=je.handlerName,nt=je.originalEvent;this._handlersById[ze].isActive()||(delete this._eventsInProgress[te],Ee[te+"end"]=ue=d[ze]||nt)}for(var Be in Ee)this._fireEvent(Be,Ee[Be]);var rt=Es(this._eventsInProgress);if(h&&(S||M)&&!rt){this._updatingCamera=!0;var mt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Dt=function(fr){return fr!==0&&-g._bearingSnap<fr&&fr<g._bearingSnap};mt?(Dt(mt.bearing||this._map.getBearing())&&(mt.bearing=0),this._map.easeTo(mt,{originalEvent:ue})):(this._map.fire(new y.Event("moveend",{originalEvent:ue})),Dt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},zn.prototype._fireEvent=function(f,d){this._map.fire(new y.Event(f,d?{originalEvent:d}:{}))},zn.prototype._requestFrame=function(){var f=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(d){delete f._frameId,f.handleEvent(new fu("renderFrame",{timeStamp:d})),f._applyChanges()})},zn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Gl=function(f){function d(h,g){f.call(this),this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=g.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(h,g){return this.jumpTo({center:h},g)},d.prototype.panBy=function(h,g,S){return h=y.Point.convert(h).mult(-1),this.panTo(this.transform.center,y.extend({offset:h},g),S)},d.prototype.panTo=function(h,g,S){return this.easeTo(y.extend({center:h},g),S)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(h,g){return this.jumpTo({zoom:h},g),this},d.prototype.zoomTo=function(h,g,S){return this.easeTo(y.extend({zoom:h},g),S)},d.prototype.zoomIn=function(h,g){return this.zoomTo(this.getZoom()+1,h,g),this},d.prototype.zoomOut=function(h,g){return this.zoomTo(this.getZoom()-1,h,g),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(h,g){return this.jumpTo({bearing:h},g),this},d.prototype.getPadding=function(){return this.transform.padding},d.prototype.setPadding=function(h,g){return this.jumpTo({padding:h},g),this},d.prototype.rotateTo=function(h,g,S){return this.easeTo(y.extend({bearing:h},g),S)},d.prototype.resetNorth=function(h,g){return this.rotateTo(0,y.extend({duration:1e3},h),g),this},d.prototype.resetNorthPitch=function(h,g){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},h),g),this},d.prototype.snapToNorth=function(h,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,g):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(h,g){return this.jumpTo({pitch:h},g),this},d.prototype.cameraForBounds=function(h,g){h=y.LngLatBounds.convert(h);var S=g&&g.bearing||0;return this._cameraForBoxAndBearing(h.getNorthWest(),h.getSouthEast(),S,g)},d.prototype._cameraForBoxAndBearing=function(h,g,S,M){var k={top:0,bottom:0,right:0,left:0};if(typeof(M=y.extend({padding:k,offset:[0,0],maxZoom:this.transform.maxZoom},M)).padding=="number"){var F=M.padding;M.padding={top:F,bottom:F,right:F,left:F}}M.padding=y.extend(k,M.padding);var G=this.transform,X=G.padding,ue=G.project(y.LngLat.convert(h)),Ee=G.project(y.LngLat.convert(g)),te=ue.rotate(-S*Math.PI/180),je=Ee.rotate(-S*Math.PI/180),ze=new y.Point(Math.max(te.x,je.x),Math.max(te.y,je.y)),nt=new y.Point(Math.min(te.x,je.x),Math.min(te.y,je.y)),Be=ze.sub(nt),rt=(G.width-(X.left+X.right+M.padding.left+M.padding.right))/Be.x,mt=(G.height-(X.top+X.bottom+M.padding.top+M.padding.bottom))/Be.y;if(!(mt<0||rt<0)){var Dt=Math.min(G.scaleZoom(G.scale*Math.min(rt,mt)),M.maxZoom),fr=typeof M.offset.x=="number"?new y.Point(M.offset.x,M.offset.y):y.Point.convert(M.offset),nr=new y.Point((M.padding.left-M.padding.right)/2,(M.padding.top-M.padding.bottom)/2).rotate(S*Math.PI/180),dr=fr.add(nr).mult(G.scale/G.zoomScale(Dt));return{center:G.unproject(ue.add(Ee).div(2).sub(dr)),zoom:Dt,bearing:S}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},d.prototype.fitBounds=function(h,g,S){return this._fitInternal(this.cameraForBounds(h,g),g,S)},d.prototype.fitScreenCoordinates=function(h,g,S,M,k){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(h)),this.transform.pointLocation(y.Point.convert(g)),S,M),M,k)},d.prototype._fitInternal=function(h,g,S){return h?(delete(g=y.extend(h,g)).padding,g.linear?this.easeTo(g,S):this.flyTo(g,S)):this},d.prototype.jumpTo=function(h,g){this.stop();var S=this.transform,M=!1,k=!1,F=!1;return"zoom"in h&&S.zoom!==+h.zoom&&(M=!0,S.zoom=+h.zoom),h.center!==void 0&&(S.center=y.LngLat.convert(h.center)),"bearing"in h&&S.bearing!==+h.bearing&&(k=!0,S.bearing=+h.bearing),"pitch"in h&&S.pitch!==+h.pitch&&(F=!0,S.pitch=+h.pitch),h.padding==null||S.isPaddingEqual(h.padding)||(S.padding=h.padding),this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),M&&this.fire(new y.Event("zoomstart",g)).fire(new y.Event("zoom",g)).fire(new y.Event("zoomend",g)),k&&this.fire(new y.Event("rotatestart",g)).fire(new y.Event("rotate",g)).fire(new y.Event("rotateend",g)),F&&this.fire(new y.Event("pitchstart",g)).fire(new y.Event("pitch",g)).fire(new y.Event("pitchend",g)),this.fire(new y.Event("moveend",g))},d.prototype.easeTo=function(h,g){var S=this;this._stop(!1,h.easeId),((h=y.extend({offset:[0,0],duration:500,easing:y.ease},h)).animate===!1||!h.essential&&y.browser.prefersReducedMotion)&&(h.duration=0);var M=this.transform,k=this.getZoom(),F=this.getBearing(),G=this.getPitch(),X=this.getPadding(),ue="zoom"in h?+h.zoom:k,Ee="bearing"in h?this._normalizeBearing(h.bearing,F):F,te="pitch"in h?+h.pitch:G,je="padding"in h?h.padding:M.padding,ze=y.Point.convert(h.offset),nt=M.centerPoint.add(ze),Be=M.pointLocation(nt),rt=y.LngLat.convert(h.center||Be);this._normalizeCenter(rt);var mt,Dt,fr=M.project(Be),nr=M.project(rt).sub(fr),dr=M.zoomScale(ue-k);h.around&&(mt=y.LngLat.convert(h.around),Dt=M.locationPoint(mt));var Ir={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ue!==k,this._rotating=this._rotating||F!==Ee,this._pitching=this._pitching||te!==G,this._padding=!M.isPaddingEqual(je),this._easeId=h.easeId,this._prepareEase(g,h.noMoveStart,Ir),this._ease(function(tn){if(S._zooming&&(M.zoom=y.number(k,ue,tn)),S._rotating&&(M.bearing=y.number(F,Ee,tn)),S._pitching&&(M.pitch=y.number(G,te,tn)),S._padding&&(M.interpolatePadding(X,je,tn),nt=M.centerPoint.add(ze)),mt)M.setLocationAtPoint(mt,Dt);else{var $r=M.zoomScale(M.zoom-k),bn=ue>k?Math.min(2,dr):Math.max(.5,dr),Qn=Math.pow(bn,1-tn),$n=M.unproject(fr.add(nr.mult(tn*Qn)).mult($r));M.setLocationAtPoint(M.renderWorldCopies?$n.wrap():$n,nt)}S._fireMoveEvents(g)},function(tn){S._afterEase(g,tn)},h),this},d.prototype._prepareEase=function(h,g,S){S===void 0&&(S={}),this._moving=!0,g||S.moving||this.fire(new y.Event("movestart",h)),this._zooming&&!S.zooming&&this.fire(new y.Event("zoomstart",h)),this._rotating&&!S.rotating&&this.fire(new y.Event("rotatestart",h)),this._pitching&&!S.pitching&&this.fire(new y.Event("pitchstart",h))},d.prototype._fireMoveEvents=function(h){this.fire(new y.Event("move",h)),this._zooming&&this.fire(new y.Event("zoom",h)),this._rotating&&this.fire(new y.Event("rotate",h)),this._pitching&&this.fire(new y.Event("pitch",h))},d.prototype._afterEase=function(h,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var S=this._zooming,M=this._rotating,k=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new y.Event("zoomend",h)),M&&this.fire(new y.Event("rotateend",h)),k&&this.fire(new y.Event("pitchend",h)),this.fire(new y.Event("moveend",h))}},d.prototype.flyTo=function(h,g){var S=this;if(!h.essential&&y.browser.prefersReducedMotion){var M=y.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(M,g)}this.stop(),h=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},h);var k=this.transform,F=this.getZoom(),G=this.getBearing(),X=this.getPitch(),ue=this.getPadding(),Ee="zoom"in h?y.clamp(+h.zoom,k.minZoom,k.maxZoom):F,te="bearing"in h?this._normalizeBearing(h.bearing,G):G,je="pitch"in h?+h.pitch:X,ze="padding"in h?h.padding:k.padding,nt=k.zoomScale(Ee-F),Be=y.Point.convert(h.offset),rt=k.centerPoint.add(Be),mt=k.pointLocation(rt),Dt=y.LngLat.convert(h.center||mt);this._normalizeCenter(Dt);var fr=k.project(mt),nr=k.project(Dt).sub(fr),dr=h.curve,Ir=Math.max(k.width,k.height),tn=Ir/nt,$r=nr.mag();if("minZoom"in h){var bn=y.clamp(Math.min(h.minZoom,F,Ee),k.minZoom,k.maxZoom),Qn=Ir/k.zoomScale(bn-F);dr=Math.sqrt(Qn/$r*2)}var $n=dr*dr;function ei(li){var ti=(tn*tn-Ir*Ir+(li?-1:1)*$n*$n*$r*$r)/(2*(li?tn:Ir)*$n*$r);return Math.log(Math.sqrt(ti*ti+1)-ti)}function Fi(li){return(Math.exp(li)-Math.exp(-li))/2}function Cn(li){return(Math.exp(li)+Math.exp(-li))/2}var Ei=ei(0),Si=function(li){return Cn(Ei)/Cn(Ei+dr*li)},mi=function(li){return Ir*((Cn(Ei)*(Fi(ti=Ei+dr*li)/Cn(ti))-Fi(Ei))/$n)/$r;var ti},ai=(ei(1)-Ei)/dr;if(Math.abs($r)<1e-6||!isFinite(ai)){if(Math.abs(Ir-tn)<1e-6)return this.easeTo(h,g);var Ti=tn<Ir?-1:1;ai=Math.abs(Math.log(tn/Ir))/dr,mi=function(){return 0},Si=function(li){return Math.exp(Ti*dr*li)}}return h.duration="duration"in h?+h.duration:1e3*ai/("screenSpeed"in h?+h.screenSpeed/dr:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0),this._zooming=!0,this._rotating=G!==te,this._pitching=je!==X,this._padding=!k.isPaddingEqual(ze),this._prepareEase(g,!1),this._ease(function(li){var ti=li*ai,bo=1/Si(ti);k.zoom=li===1?Ee:F+k.scaleZoom(bo),S._rotating&&(k.bearing=y.number(G,te,li)),S._pitching&&(k.pitch=y.number(X,je,li)),S._padding&&(k.interpolatePadding(ue,ze,li),rt=k.centerPoint.add(Be));var ro=li===1?Dt:k.unproject(fr.add(nr.mult(mi(ti))).mult(bo));k.setLocationAtPoint(k.renderWorldCopies?ro.wrap():ro,rt),S._fireMoveEvents(g)},function(){return S._afterEase(g)},h),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){return this._stop()},d.prototype._stop=function(h,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,g)}if(!h){var M=this.handlers;M&&M.stop(!1)}return this},d.prototype._ease=function(h,g,S){S.animate===!1||S.duration===0?(h(1),g()):(this._easeStart=y.browser.now(),this._easeOptions=S,this._onEaseFrame=h,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var h=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(h,g){h=y.wrap(h,-180,180);var S=Math.abs(h-g);return Math.abs(h-360-g)<S&&(h-=360),Math.abs(h+360-g)<S&&(h+=360),h},d.prototype._normalizeCenter=function(h){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var S=h.lng-g.center.lng;h.lng+=S>180?-360:S<-180?360:0}},d}(y.Evented),$o=function(f){f===void 0&&(f={}),this.options=f,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};$o.prototype.getDefaultPosition=function(){return"bottom-right"},$o.prototype.onAdd=function(f){var d=this.options&&this.options.compact;return this._map=f,this._container=T.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=T.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=T.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},$o.prototype.onRemove=function(){T.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},$o.prototype._setElementTitle=function(f,d){var h=this._map._getUIString("AttributionControl."+d);f.title=h,f.setAttribute("aria-label",h)},$o.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},$o.prototype._updateEditLink=function(){var f=this._editLink;f||(f=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(f){var h=d.reduce(function(g,S,M){return S.value&&(g+=S.key+"="+S.value+(M<d.length-1?"&":"")),g},"?");f.href=y.config.FEEDBACK_URL+"/"+h+(this._map._hash?this._map._hash.getHashString(!0):""),f.rel="noopener nofollow",this._setElementTitle(f,"MapFeedback")}},$o.prototype._updateData=function(f){!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},$o.prototype._updateAttributions=function(){if(this._map.style){var f=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?f=f.concat(this.options.customAttribution.map(function(F){return typeof F!="string"?"":F})):typeof this.options.customAttribution=="string"&&f.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var h=this._map.style.sourceCaches;for(var g in h){var S=h[g];if(S.used){var M=S.getSource();M.attribution&&f.indexOf(M.attribution)<0&&f.push(M.attribution)}}f.sort(function(F,G){return F.length-G.length});var k=(f=f.filter(function(F,G){for(var X=G+1;X<f.length;X++)if(f[X].indexOf(F)>=0)return!1;return!0})).join(" | ");k!==this._attribHTML&&(this._attribHTML=k,f.length?(this._innerContainer.innerHTML=k,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},$o.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var hu=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};hu.prototype.onAdd=function(f){this._map=f,this._container=T.create("div","mapboxgl-ctrl");var d=T.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},hu.prototype.onRemove=function(){T.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},hu.prototype.getDefaultPosition=function(){return"bottom-left"},hu.prototype._updateLogo=function(f){f&&f.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},hu.prototype._logoRequired=function(){if(this._map.style){var f=this._map.style.sourceCaches;for(var d in f)if(f[d].getSource().mapbox_logo)return!0;return!1}},hu.prototype._updateCompact=function(){var f=this._container.children;if(f.length){var d=f[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var qo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};qo.prototype.add=function(f){var d=++this._id;return this._queue.push({callback:f,id:d,cancelled:!1}),d},qo.prototype.remove=function(f){for(var d=this._currentlyRunning,h=0,g=d?this._queue.concat(d):this._queue;h<g.length;h+=1){var S=g[h];if(S.id===f)return void(S.cancelled=!0)}},qo.prototype.run=function(f){f===void 0&&(f=0);var d=this._currentlyRunning=this._queue;this._queue=[];for(var h=0,g=d;h<g.length;h+=1){var S=g[h];if(!S.cancelled&&(S.callback(f),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},qo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Gu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Yc=y.window.HTMLImageElement,Hl=y.window.HTMLElement,Ea=y.window.ImageBitmap,Ua={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},qf=function(f){function d(g){var S=this;if((g=y.extend({},Ua,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var M=new qi(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(f.call(this,M,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new qo,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},Gu,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new y.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=y.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof Hl))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return S._update(!1)}),this.on("moveend",function(){return S._update(!1)}),this.on("zoom",function(){return S._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new zn(this,g),this._hash=g.hash&&new Fs(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,y.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new $o({customAttribution:g.customAttribution})),this.addControl(new hu,g.logoPosition),this.on("style.load",function(){S.transform.unmodified&&S.jumpTo(S.style.stylesheet)}),this.on("data",function(k){S._update(k.dataType==="style"),S.fire(new y.Event(k.dataType+"data",k))}),this.on("dataloading",function(k){S.fire(new y.Event(k.dataType+"dataloading",k))})}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(g,S){if(S===void 0&&(S=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var M=g.onAdd(this);this._controls.push(g);var k=this._controlPositions[S];return S.indexOf("bottom")!==-1?k.insertBefore(M,k.firstChild):k.appendChild(M),this},d.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var S=this._controls.indexOf(g);return S>-1&&this._controls.splice(S,1),g.onRemove(this),this},d.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},d.prototype.resize=function(g){var S=this._containerDimensions(),M=S[0],k=S[1];if(M===this.transform.width&&k===this.transform.height)return this;this._resizeCanvas(M,k),this.transform.resize(M,k),this.painter.resize(M,k);var F=!this._moving;return F&&this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),this.fire(new y.Event("resize",g)),F&&this.fire(new y.Event("moveend",g)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(y.LngLatBounds.convert(g)),this._update()},d.prototype.setMinZoom=function(g){if((g=g==null?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(g){if((g=g==null?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(g){if((g=g==null?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(g){if((g=g==null?60:g)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},d.prototype.project=function(g){return this.transform.locationPoint(y.LngLat.convert(g))},d.prototype.unproject=function(g){return this.transform.pointLocation(y.Point.convert(g))},d.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},d.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},d.prototype._createDelegatedListener=function(g,S,M){var k,F=this;if(g==="mouseenter"||g==="mouseover"){var G=!1;return{layer:S,listener:M,delegates:{mousemove:function(ue){var Ee=F.getLayer(S)?F.queryRenderedFeatures(ue.point,{layers:[S]}):[];Ee.length?G||(G=!0,M.call(F,new Io(g,F,ue.originalEvent,{features:Ee}))):G=!1},mouseout:function(){G=!1}}}}if(g==="mouseleave"||g==="mouseout"){var X=!1;return{layer:S,listener:M,delegates:{mousemove:function(ue){(F.getLayer(S)?F.queryRenderedFeatures(ue.point,{layers:[S]}):[]).length?X=!0:X&&(X=!1,M.call(F,new Io(g,F,ue.originalEvent)))},mouseout:function(ue){X&&(X=!1,M.call(F,new Io(g,F,ue.originalEvent)))}}}}return{layer:S,listener:M,delegates:(k={},k[g]=function(ue){var Ee=F.getLayer(S)?F.queryRenderedFeatures(ue.point,{layers:[S]}):[];Ee.length&&(ue.features=Ee,M.call(F,ue),delete ue.features)},k)}},d.prototype.on=function(g,S,M){if(M===void 0)return f.prototype.on.call(this,g,S);var k=this._createDelegatedListener(g,S,M);for(var F in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(k),k.delegates)this.on(F,k.delegates[F]);return this},d.prototype.once=function(g,S,M){if(M===void 0)return f.prototype.once.call(this,g,S);var k=this._createDelegatedListener(g,S,M);for(var F in k.delegates)this.once(F,k.delegates[F]);return this},d.prototype.off=function(g,S,M){var k=this;return M===void 0?f.prototype.off.call(this,g,S):(this._delegatedListeners&&this._delegatedListeners[g]&&function(F){for(var G=F[g],X=0;X<G.length;X++){var ue=G[X];if(ue.layer===S&&ue.listener===M){for(var Ee in ue.delegates)k.off(Ee,ue.delegates[Ee]);return G.splice(X,1),k}}}(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(g,S){if(!this.style)return[];var M;if(S!==void 0||g===void 0||g instanceof y.Point||Array.isArray(g)||(S=g,g=void 0),S=S||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof g[0]=="number")M=[y.Point.convert(g)];else{var k=y.Point.convert(g[0]),F=y.Point.convert(g[1]);M=[k,new y.Point(F.x,k.y),F,new y.Point(k.x,F.y),k]}return this.style.queryRenderedFeatures(M,S,this.transform)},d.prototype.querySourceFeatures=function(g,S){return this.style.querySourceFeatures(g,S)},d.prototype.setStyle=function(g,S){return(S=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},S)).diff!==!1&&S.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,S),this):(this._localIdeographFontFamily=S.localIdeographFontFamily,this._updateStyle(g,S))},d.prototype._getUIString=function(g){var S=this._locale[g];if(S==null)throw new Error("Missing UI string '"+g+"'");return S},d.prototype._updateStyle=function(g,S){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new gs(this,S||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new gs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(g,S){var M=this;if(typeof g=="string"){var k=this._requestManager.normalizeStyleURL(g),F=this._requestManager.transformRequest(k,y.ResourceType.Style);y.getJSON(F,function(G,X){G?M.fire(new y.ErrorEvent(G)):X&&M._updateDiff(X,S)})}else typeof g=="object"&&this._updateDiff(g,S)},d.prototype._updateDiff=function(g,S){try{this.style.setState(g)&&this._update(!0)}catch(M){y.warnOnce("Unable to perform style diff: "+(M.message||M.error||M)+".  Rebuilding the style from scratch."),this._updateStyle(g,S)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(g,S){return this._lazyInitEmptyStyle(),this.style.addSource(g,S),this._update(!0)},d.prototype.isSourceLoaded=function(g){var S=this.style&&this.style.sourceCaches[g];if(S!==void 0)return S.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},d.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var S in g){var M=g[S]._tiles;for(var k in M){var F=M[k];if(F.state!=="loaded"&&F.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(g,S,M){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,S,M)},d.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},d.prototype.getSource=function(g){return this.style.getSource(g)},d.prototype.addImage=function(g,S,M){M===void 0&&(M={});var k=M.pixelRatio;k===void 0&&(k=1);var F=M.sdf;F===void 0&&(F=!1);var G=M.stretchX,X=M.stretchY,ue=M.content;if(this._lazyInitEmptyStyle(),S instanceof Yc||Ea&&S instanceof Ea){var Ee=y.browser.getImageData(S);this.style.addImage(g,{data:new y.RGBAImage({width:Ee.width,height:Ee.height},Ee.data),pixelRatio:k,stretchX:G,stretchY:X,content:ue,sdf:F,version:0})}else{if(S.width===void 0||S.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var te=S;this.style.addImage(g,{data:new y.RGBAImage({width:S.width,height:S.height},new Uint8Array(S.data)),pixelRatio:k,stretchX:G,stretchY:X,content:ue,sdf:F,version:0,userImage:te}),te.onAdd&&te.onAdd(this,g)}},d.prototype.updateImage=function(g,S){var M=this.style.getImage(g);if(!M)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var k=S instanceof Yc||Ea&&S instanceof Ea?y.browser.getImageData(S):S,F=k.width,G=k.height,X=k.data;return F===void 0||G===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):F!==M.data.width||G!==M.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(M.data.replace(X,!(S instanceof Yc||Ea&&S instanceof Ea)),void this.style.updateImage(g,M))},d.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(g){this.style.removeImage(g)},d.prototype.loadImage=function(g,S){y.getImage(this._requestManager.transformRequest(g,y.ResourceType.Image),S)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(g,S){return this._lazyInitEmptyStyle(),this.style.addLayer(g,S),this._update(!0)},d.prototype.moveLayer=function(g,S){return this.style.moveLayer(g,S),this._update(!0)},d.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},d.prototype.getLayer=function(g){return this.style.getLayer(g)},d.prototype.setLayerZoomRange=function(g,S,M){return this.style.setLayerZoomRange(g,S,M),this._update(!0)},d.prototype.setFilter=function(g,S,M){return M===void 0&&(M={}),this.style.setFilter(g,S,M),this._update(!0)},d.prototype.getFilter=function(g){return this.style.getFilter(g)},d.prototype.setPaintProperty=function(g,S,M,k){return k===void 0&&(k={}),this.style.setPaintProperty(g,S,M,k),this._update(!0)},d.prototype.getPaintProperty=function(g,S){return this.style.getPaintProperty(g,S)},d.prototype.setLayoutProperty=function(g,S,M,k){return k===void 0&&(k={}),this.style.setLayoutProperty(g,S,M,k),this._update(!0)},d.prototype.getLayoutProperty=function(g,S){return this.style.getLayoutProperty(g,S)},d.prototype.setLight=function(g,S){return S===void 0&&(S={}),this._lazyInitEmptyStyle(),this.style.setLight(g,S),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(g,S){return this.style.setFeatureState(g,S),this._update()},d.prototype.removeFeatureState=function(g,S){return this.style.removeFeatureState(g,S),this._update()},d.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var g=0,S=0;return this._container&&(g=this._container.clientWidth||400,S=this._container.clientHeight||300),[g,S]},d.prototype._detectMissingCSS=function(){y.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&y.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=T.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var S=this._canvasContainer=T.create("div","mapboxgl-canvas-container",g);this._interactive&&S.classList.add("mapboxgl-interactive"),this._canvas=T.create("canvas","mapboxgl-canvas",S),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var M=this._containerDimensions();this._resizeCanvas(M[0],M[1]);var k=this._controlContainer=T.create("div","mapboxgl-control-container",g),F=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(G){F[G]=T.create("div","mapboxgl-ctrl-"+G,k)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},d.prototype._resizeCanvas=function(g,S){var M=y.browser.devicePixelRatio||1;this._canvas.width=M*g,this._canvas.height=M*S,this._canvas.style.width=g+"px",this._canvas.style.height=S+"px"},d.prototype._setupPainter=function(){var g=y.extend({},Ae.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),S=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);S?(this.painter=new Qa(S,this.transform),y.webpSupported.testSupport(S)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:g}))},d.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:g}))},d.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},d.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},d.prototype._render=function(g){var S,M=this,k=0,F=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(S=F.createQueryEXT(),F.beginQueryEXT(F.TIME_ELAPSED_EXT,S),k=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var G=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var X=this.transform.zoom,ue=y.browser.now();this.style.zoomHistory.update(X,ue);var Ee=new y.EvaluationParameters(X,{now:ue,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),te=Ee.crossFadingFactor();te===1&&te===this._crossFadingFactor||(G=!0,this._crossFadingFactor=te),this.style.update(Ee)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||G)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var je=y.browser.now()-k;F.endQueryEXT(F.TIME_ELAPSED_EXT,S),setTimeout(function(){var Be=F.getQueryObjectEXT(S,F.QUERY_RESULT_EXT)/1e6;F.deleteQueryEXT(S),M.fire(new y.Event("gpu-timing-frame",{cpuTime:je,gpuTime:Be}))},50)}if(this.listens("gpu-timing-layer")){var ze=this.painter.collectGpuTimers();setTimeout(function(){var Be=M.painter.queryGpuTimers(ze);M.fire(new y.Event("gpu-timing-layer",{layerTimes:Be}))},50)}var nt=this._sourcesDirty||this._styleDirty||this._placementDirty;return nt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||nt||(this._fullyLoaded=!0),this}},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,S=this._controls;g<S.length;g+=1)S[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var M=this.painter.context.gl.getExtension("WEBGL_lose_context");M&&M.loseContext(),Wl(this._canvasContainer),Wl(this._controlContainer),Wl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},d.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(S){g._frame=null,g._render(S)}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},h.showTileBoundaries.get=function(){return!!this._showTileBoundaries},h.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},h.showPadding.get=function(){return!!this._showPadding},h.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},h.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},h.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},h.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},h.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},h.repaint.get=function(){return!!this._repaint},h.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},h.vertices.get=function(){return!!this._vertices},h.vertices.set=function(g){this._vertices=g,this._update()},d.prototype._setCacheLimits=function(g,S){y.setCacheLimits(g,S)},h.version.get=function(){return y.version},Object.defineProperties(d.prototype,h),d}(Gl);function Wl(f){f.parentNode&&f.parentNode.removeChild(f)}var Xa={showCompass:!0,showZoom:!0,visualizePitch:!1},Hu=function(f){var d=this;this.options=y.extend({},Xa,f),this._container=T.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(h){return h.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(h){return d._map.zoomIn({},{originalEvent:h})}),T.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(h){return d._map.zoomOut({},{originalEvent:h})}),T.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(h){d.options.visualizePitch?d._map.resetNorthPitch({},{originalEvent:h}):d._map.resetNorth({},{originalEvent:h})}),this._compassIcon=T.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Hu.prototype._updateZoomButtons=function(){var f=this._map.getZoom(),d=f===this._map.getMaxZoom(),h=f===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},Hu.prototype._rotateCompassArrow=function(){var f=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=f},Hu.prototype.onAdd=function(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new os(this._map,this._compass,this.options.visualizePitch)),this._container},Hu.prototype.onRemove=function(){T.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Hu.prototype._createButton=function(f,d){var h=T.create("button",f,this._container);return h.type="button",h.addEventListener("click",d),h},Hu.prototype._setButtonTitle=function(f,d){var h=this._map._getUIString("NavigationControl."+d);f.title=h,f.setAttribute("aria-label",h)};var os=function(f,d,h){h===void 0&&(h=!1),this._clickTolerance=10,this.element=d,this.mouseRotate=new vc({clickTolerance:f.dragRotate._mouseRotate._clickTolerance}),this.map=f,h&&(this.mousePitch=new Cl({clickTolerance:f.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),T.addEventListener(d,"mousedown",this.mousedown),T.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),T.addEventListener(d,"touchmove",this.touchmove),T.addEventListener(d,"touchend",this.touchend),T.addEventListener(d,"touchcancel",this.reset)};function wl(f,d,h){if(f=new y.LngLat(f.lng,f.lat),d){var g=new y.LngLat(f.lng-360,f.lat),S=new y.LngLat(f.lng+360,f.lat),M=h.locationPoint(f).distSqr(d);h.locationPoint(g).distSqr(d)<M?f=g:h.locationPoint(S).distSqr(d)<M&&(f=S)}for(;Math.abs(f.lng-h.center.lng)>180;){var k=h.locationPoint(f);if(k.x>=0&&k.y>=0&&k.x<=h.width&&k.y<=h.height)break;f.lng>h.center.lng?f.lng-=360:f.lng+=360}return f}os.prototype.down=function(f,d){this.mouseRotate.mousedown(f,d),this.mousePitch&&this.mousePitch.mousedown(f,d),T.disableDrag()},os.prototype.move=function(f,d){var h=this.map,g=this.mouseRotate.mousemoveWindow(f,d);if(g&&g.bearingDelta&&h.setBearing(h.getBearing()+g.bearingDelta),this.mousePitch){var S=this.mousePitch.mousemoveWindow(f,d);S&&S.pitchDelta&&h.setPitch(h.getPitch()+S.pitchDelta)}},os.prototype.off=function(){var f=this.element;T.removeEventListener(f,"mousedown",this.mousedown),T.removeEventListener(f,"touchstart",this.touchstart,{passive:!1}),T.removeEventListener(f,"touchmove",this.touchmove),T.removeEventListener(f,"touchend",this.touchend),T.removeEventListener(f,"touchcancel",this.reset),this.offTemp()},os.prototype.offTemp=function(){T.enableDrag(),T.removeEventListener(y.window,"mousemove",this.mousemove),T.removeEventListener(y.window,"mouseup",this.mouseup)},os.prototype.mousedown=function(f){this.down(y.extend({},f,{ctrlKey:!0,preventDefault:function(){return f.preventDefault()}}),T.mousePos(this.element,f)),T.addEventListener(y.window,"mousemove",this.mousemove),T.addEventListener(y.window,"mouseup",this.mouseup)},os.prototype.mousemove=function(f){this.move(f,T.mousePos(this.element,f))},os.prototype.mouseup=function(f){this.mouseRotate.mouseupWindow(f),this.mousePitch&&this.mousePitch.mouseupWindow(f),this.offTemp()},os.prototype.touchstart=function(f){f.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=T.touchPos(this.element,f.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return f.preventDefault()}},this._startPos))},os.prototype.touchmove=function(f){f.targetTouches.length!==1?this.reset():(this._lastPos=T.touchPos(this.element,f.targetTouches)[0],this.move({preventDefault:function(){return f.preventDefault()}},this._lastPos))},os.prototype.touchend=function(f){f.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},os.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Cu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function bf(f,d,h){var g=f.classList;for(var S in Cu)g.remove("mapboxgl-"+h+"-anchor-"+S);g.add("mapboxgl-"+h+"-anchor-"+d)}var pu,Al=function(f){function d(h,g){if(f.call(this),(h instanceof y.window.HTMLElement||g)&&(h=y.extend({element:h},g)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment!=="auto"?h.pitchAlignment:this._rotationAlignment,h&&h.element)this._element=h.element,this._offset=y.Point.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=T.create("div"),this._element.setAttribute("aria-label","Map marker");var S=T.createNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","41px"),S.setAttributeNS(null,"width","27px"),S.setAttributeNS(null,"viewBox","0 0 27 41");var M=T.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"stroke","none"),M.setAttributeNS(null,"stroke-width","1"),M.setAttributeNS(null,"fill","none"),M.setAttributeNS(null,"fill-rule","evenodd");var k=T.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill-rule","nonzero");var F=T.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(3.0, 29.0)"),F.setAttributeNS(null,"fill","#000000");for(var G=0,X=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];G<X.length;G+=1){var ue=X[G],Ee=T.createNS("http://www.w3.org/2000/svg","ellipse");Ee.setAttributeNS(null,"opacity","0.04"),Ee.setAttributeNS(null,"cx","10.5"),Ee.setAttributeNS(null,"cy","5.80029008"),Ee.setAttributeNS(null,"rx",ue.rx),Ee.setAttributeNS(null,"ry",ue.ry),F.appendChild(Ee)}var te=T.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"fill",this._color);var je=T.createNS("http://www.w3.org/2000/svg","path");je.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),te.appendChild(je);var ze=T.createNS("http://www.w3.org/2000/svg","g");ze.setAttributeNS(null,"opacity","0.25"),ze.setAttributeNS(null,"fill","#000000");var nt=T.createNS("http://www.w3.org/2000/svg","path");nt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ze.appendChild(nt);var Be=T.createNS("http://www.w3.org/2000/svg","g");Be.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Be.setAttributeNS(null,"fill","#FFFFFF");var rt=T.createNS("http://www.w3.org/2000/svg","g");rt.setAttributeNS(null,"transform","translate(8.0, 8.0)");var mt=T.createNS("http://www.w3.org/2000/svg","circle");mt.setAttributeNS(null,"fill","#000000"),mt.setAttributeNS(null,"opacity","0.25"),mt.setAttributeNS(null,"cx","5.5"),mt.setAttributeNS(null,"cy","5.5"),mt.setAttributeNS(null,"r","5.4999962");var Dt=T.createNS("http://www.w3.org/2000/svg","circle");Dt.setAttributeNS(null,"fill","#FFFFFF"),Dt.setAttributeNS(null,"cx","5.5"),Dt.setAttributeNS(null,"cy","5.5"),Dt.setAttributeNS(null,"r","5.4999962"),rt.appendChild(mt),rt.appendChild(Dt),k.appendChild(F),k.appendChild(te),k.appendChild(ze),k.appendChild(Be),k.appendChild(rt),S.appendChild(k),S.setAttributeNS(null,"height",41*this._scale+"px"),S.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(S),this._offset=y.Point.convert(h&&h.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(fr){fr.preventDefault()}),this._element.addEventListener("mousedown",function(fr){fr.preventDefault()}),bf(this._element,this._anchor,"marker"),this._popup=null}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._update),h.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),T.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=y.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=h,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(h){var g=h.code,S=h.charCode||h.keyCode;g!=="Space"&&g!=="Enter"&&S!==32&&S!==13||this.togglePopup()},d.prototype._onMapClick=function(h){var g=h.originalEvent.target,S=this._element;this._popup&&(g===S||S.contains(g))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var h=this._popup;return h?(h.isOpen()?h.remove():h.addTo(this._map),this):this},d.prototype._update=function(h){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=wl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S="rotateX("+this._map.getPitch()+"deg)"),h&&h.type!=="moveend"||(this._pos=this._pos.round()),T.setTransform(this._element,Cu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+S+" "+g)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(h){return this._offset=y.Point.convert(h),this._update(),this},d.prototype._onMove=function(h){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(h){this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(h){return this._draggable=!!h,this._map&&(h?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(h){return this._rotation=h||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(h){return this._rotationAlignment=h||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(h){return this._pitchAlignment=h&&h!=="auto"?h:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d}(y.Evented),Xl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Yl=0,Tl=!1,Kf=function(f){function d(h){f.call(this),this.options=y.extend({},Xl,h),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){var g;return this._map=h,this._container=T.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,pu!==void 0?g(pu):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(S){g(pu=S.state!=="denied")}):g(pu=!!y.window.navigator.geolocation),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),T.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Yl=0,Tl=!1},d.prototype._isOutOfMapMaxBounds=function(h){var g=this._map.getMaxBounds(),S=h.coords;return g&&(S.longitude<g.getWest()||S.longitude>g.getEast()||S.latitude<g.getSouth()||S.latitude>g.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",h)),this._finish()}},d.prototype._updateCamera=function(h){var g=new y.LngLat(h.coords.longitude,h.coords.latitude),S=h.coords.accuracy,M=this._map.getBearing(),k=y.extend({bearing:M},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(S),k,{geolocateSource:!0})},d.prototype._updateMarker=function(h){if(h){var g=new y.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var h=this._map._container.clientHeight/2,g=this._map.unproject([0,h]),S=this._map.unproject([1,h]),M=g.distanceTo(S),k=Math.ceil(2*this._accuracy/M);this._circleElement.style.width=k+"px",this._circleElement.style.height=k+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&Tl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",h)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(h){var g=this;if(this._container.addEventListener("contextmenu",function(k){return k.preventDefault()}),this._geolocateButton=T.create("button","mapboxgl-ctrl-geolocate",this._container),T.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",h===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{var M=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=M,this._geolocateButton.setAttribute("aria-label",M)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=T.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Al(this._dotElement),this._circleElement=T.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Al({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(k){k.geolocateSource||g._watchState!=="ACTIVE_LOCK"||k.originalEvent&&k.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new y.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Yl--,Tl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Yl>1?(h={maximumAge:6e5,timeout:0},Tl=!0):(h=this.options.positionOptions,Tl=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d}(y.Evented),nl={maxWidth:100,unit:"metric"},$l=function(f){this.options=y.extend({},nl,f),y.bindAll(["_onMove","setUnit"],this)};function Ef(f,d,h){var g=h&&h.maxWidth||100,S=f._container.clientHeight/2,M=f.unproject([0,S]),k=f.unproject([g,S]),F=M.distanceTo(k);if(h&&h.unit==="imperial"){var G=3.2808*F;G>5280?ql(d,g,G/5280,f._getUIString("ScaleControl.Miles")):ql(d,g,G,f._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?ql(d,g,F/1852,f._getUIString("ScaleControl.NauticalMiles")):F>=1e3?ql(d,g,F/1e3,f._getUIString("ScaleControl.Kilometers")):ql(d,g,F,f._getUIString("ScaleControl.Meters"))}function ql(f,d,h,g){var S,M,k,F=(S=h,(M=Math.pow(10,(""+Math.floor(S)).length-1))*(k=(k=S/M)>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(G){var X=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*X)/X}(k)));f.style.width=d*(F/h)+"px",f.innerHTML=F+"&nbsp;"+g}$l.prototype.getDefaultPosition=function(){return"bottom-left"},$l.prototype._onMove=function(){Ef(this._map,this._container,this.options)},$l.prototype.onAdd=function(f){return this._map=f,this._container=T.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},$l.prototype.onRemove=function(){T.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},$l.prototype.setUnit=function(f){this.options.unit=f,Ef(this._map,this._container,this.options)};var go=function(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof y.window.HTMLElement?this._container=f.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};go.prototype.onAdd=function(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=T.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},go.prototype.onRemove=function(){T.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},go.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},go.prototype._setupUI=function(){var f=this._fullscreenButton=T.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);T.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},go.prototype._updateTitle=function(){var f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f},go.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},go.prototype._isFullscreen=function(){return this._fullscreen},go.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},go.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Sf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},$c=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Ml=function(f){function d(h){f.call(this),this.options=y.extend(Object.create(Sf),h),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&T.remove(this._content),this._container&&(T.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=y.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(h){return this.setDOMContent(y.window.document.createTextNode(h))},d.prototype.setHTML=function(h){var g,S=y.window.document.createDocumentFragment(),M=y.window.document.createElement("body");for(M.innerHTML=h;g=M.firstChild;)S.appendChild(g);return this.setDOMContent(S)},d.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},d.prototype.setMaxWidth=function(h){return this.options.maxWidth=h,this._update(),this},d.prototype.setDOMContent=function(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=T.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this},d.prototype.addClassName=function(h){this._container&&this._container.classList.add(h)},d.prototype.removeClassName=function(h){this._container&&this._container.classList.remove(h)},d.prototype.setOffset=function(h){return this.options.offset=h,this._update(),this},d.prototype.toggleClassName=function(h){if(this._container)return this._container.classList.toggle(h)},d.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=T.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._onMouseUp=function(h){this._update(h.point)},d.prototype._onMouseMove=function(h){this._update(h.point)},d.prototype._onDrag=function(h){this._update(h.point)},d.prototype._update=function(h){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=T.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=T.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Ee){return g._container.classList.add(Ee)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=wl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h)){var S=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),M=this.options.anchor,k=function Ee(te){if(te){if(typeof te=="number"){var je=Math.round(Math.sqrt(.5*Math.pow(te,2)));return{center:new y.Point(0,0),top:new y.Point(0,te),"top-left":new y.Point(je,je),"top-right":new y.Point(-je,je),bottom:new y.Point(0,-te),"bottom-left":new y.Point(je,-je),"bottom-right":new y.Point(-je,-je),left:new y.Point(te,0),right:new y.Point(-te,0)}}if(te instanceof y.Point||Array.isArray(te)){var ze=y.Point.convert(te);return{center:ze,top:ze,"top-left":ze,"top-right":ze,bottom:ze,"bottom-left":ze,"bottom-right":ze,left:ze,right:ze}}return{center:y.Point.convert(te.center||[0,0]),top:y.Point.convert(te.top||[0,0]),"top-left":y.Point.convert(te["top-left"]||[0,0]),"top-right":y.Point.convert(te["top-right"]||[0,0]),bottom:y.Point.convert(te.bottom||[0,0]),"bottom-left":y.Point.convert(te["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(te["bottom-right"]||[0,0]),left:y.Point.convert(te.left||[0,0]),right:y.Point.convert(te.right||[0,0])}}return Ee(new y.Point(0,0))}(this.options.offset);if(!M){var F,G=this._container.offsetWidth,X=this._container.offsetHeight;F=S.y+k.bottom.y<X?["top"]:S.y>this._map.transform.height-X?["bottom"]:[],S.x<G/2?F.push("left"):S.x>this._map.transform.width-G/2&&F.push("right"),M=F.length===0?"bottom":F.join("-")}var ue=S.add(k[M]).round();T.setTransform(this._container,Cu[M]+" translate("+ue.x+"px,"+ue.y+"px)"),bf(this._container,M,"popup")}},d.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var h=this._container.querySelector($c);h&&h.focus()}},d.prototype._onClose=function(){this.remove()},d}(y.Evented),qc={version:y.version,supported:Ae,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:qf,NavigationControl:Hu,GeolocateControl:Kf,AttributionControl:$o,ScaleControl:$l,FullscreenControl:go,Popup:Ml,Marker:Al,Style:gs,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){Ht().acquire(er)},clearPrewarmedResources:function(){var f=Ln;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(er),Ln=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(f){y.config.ACCESS_TOKEN=f},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(f){y.config.API_URL=f},get workerCount(){return Pr.workerCount},set workerCount(f){Pr.workerCount=f},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){y.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage:function(f){y.clearTileCache(f)},workerUrl:""};return qc}),Le})},3614:function(nn,ye,fe){"use strict";nn.exports=J;var Le=fe(80645);function J(q){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(q)?q:new Uint8Array(q||0),this.pos=0,this.type=0,this.length=this.buf.length}J.Varint=0,J.Fixed64=1,J.Bytes=2,J.Fixed32=5;var y=(1<<16)*(1<<16),Ae=1/y,T=12,ce=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");J.prototype={destroy:function(){this.buf=null},readFields:function(q,ge,Q){for(Q=Q||this.length;this.pos<Q;){var Me=this.readVarint(),ee=Me>>3,oe=this.pos;this.type=Me&7,q(ee,ge,this),this.pos===oe&&this.skip(Me)}return ge},readMessage:function(q,ge){return this.readFields(q,ge,this.readVarint()+this.pos)},readFixed32:function(){var q=Tt(this.buf,this.pos);return this.pos+=4,q},readSFixed32:function(){var q=Ot(this.buf,this.pos);return this.pos+=4,q},readFixed64:function(){var q=Tt(this.buf,this.pos)+Tt(this.buf,this.pos+4)*y;return this.pos+=8,q},readSFixed64:function(){var q=Tt(this.buf,this.pos)+Ot(this.buf,this.pos+4)*y;return this.pos+=8,q},readFloat:function(){var q=Le.read(this.buf,this.pos,!0,23,4);return this.pos+=4,q},readDouble:function(){var q=Le.read(this.buf,this.pos,!0,52,8);return this.pos+=8,q},readVarint:function(q){var ge=this.buf,Q,Me;return Me=ge[this.pos++],Q=Me&127,Me<128||(Me=ge[this.pos++],Q|=(Me&127)<<7,Me<128)||(Me=ge[this.pos++],Q|=(Me&127)<<14,Me<128)||(Me=ge[this.pos++],Q|=(Me&127)<<21,Me<128)?Q:(Me=ge[this.pos],Q|=(Me&15)<<28,pe(Q,q,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var q=this.readVarint();return q%2==1?(q+1)/-2:q/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var q=this.readVarint()+this.pos,ge=this.pos;return this.pos=q,q-ge>=T&&ce?lr(this.buf,ge,q):pt(this.buf,ge,q)},readBytes:function(){var q=this.readVarint()+this.pos,ge=this.buf.subarray(this.pos,q);return this.pos=q,ge},readPackedVarint:function(q,ge){if(this.type!==J.Bytes)return q.push(this.readVarint(ge));var Q=Fe(this);for(q=q||[];this.pos<Q;)q.push(this.readVarint(ge));return q},readPackedSVarint:function(q){if(this.type!==J.Bytes)return q.push(this.readSVarint());var ge=Fe(this);for(q=q||[];this.pos<ge;)q.push(this.readSVarint());return q},readPackedBoolean:function(q){if(this.type!==J.Bytes)return q.push(this.readBoolean());var ge=Fe(this);for(q=q||[];this.pos<ge;)q.push(this.readBoolean());return q},readPackedFloat:function(q){if(this.type!==J.Bytes)return q.push(this.readFloat());var ge=Fe(this);for(q=q||[];this.pos<ge;)q.push(this.readFloat());return q},readPackedDouble:function(q){if(this.type!==J.Bytes)return q.push(this.readDouble());var ge=Fe(this);for(q=q||[];this.pos<ge;)q.push(this.readDouble());return q},readPackedFixed32:function(q){if(this.type!==J.Bytes)return q.push(this.readFixed32());var ge=Fe(this);for(q=q||[];this.pos<ge;)q.push(this.readFixed32());return q},readPackedSFixed32:function(q){if(this.type!==J.Bytes)return q.push(this.readSFixed32());var ge=Fe(this);for(q=q||[];this.pos<ge;)q.push(this.readSFixed32());return q},readPackedFixed64:function(q){if(this.type!==J.Bytes)return q.push(this.readFixed64());var ge=Fe(this);for(q=q||[];this.pos<ge;)q.push(this.readFixed64());return q},readPackedSFixed64:function(q){if(this.type!==J.Bytes)return q.push(this.readSFixed64());var ge=Fe(this);for(q=q||[];this.pos<ge;)q.push(this.readSFixed64());return q},skip:function(q){var ge=q&7;if(ge===J.Varint)for(;this.buf[this.pos++]>127;);else if(ge===J.Bytes)this.pos=this.readVarint()+this.pos;else if(ge===J.Fixed32)this.pos+=4;else if(ge===J.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+ge)},writeTag:function(q,ge){this.writeVarint(q<<3|ge)},realloc:function(q){for(var ge=this.length||16;ge<this.pos+q;)ge*=2;if(ge!==this.length){var Q=new Uint8Array(ge);Q.set(this.buf),this.buf=Q,this.length=ge}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(q){this.realloc(4),ht(this.buf,q,this.pos),this.pos+=4},writeSFixed32:function(q){this.realloc(4),ht(this.buf,q,this.pos),this.pos+=4},writeFixed64:function(q){this.realloc(8),ht(this.buf,q&-1,this.pos),ht(this.buf,Math.floor(q*Ae),this.pos+4),this.pos+=8},writeSFixed64:function(q){this.realloc(8),ht(this.buf,q&-1,this.pos),ht(this.buf,Math.floor(q*Ae),this.pos+4),this.pos+=8},writeVarint:function(q){if(q=+q||0,q>268435455||q<0){Ge(q,this);return}this.realloc(4),this.buf[this.pos++]=q&127|(q>127?128:0),!(q<=127)&&(this.buf[this.pos++]=(q>>>=7)&127|(q>127?128:0),!(q<=127)&&(this.buf[this.pos++]=(q>>>=7)&127|(q>127?128:0),!(q<=127)&&(this.buf[this.pos++]=q>>>7&127)))},writeSVarint:function(q){this.writeVarint(q<0?-q*2-1:q*2)},writeBoolean:function(q){this.writeVarint(Boolean(q))},writeString:function(q){q=String(q),this.realloc(q.length*4),this.pos++;var ge=this.pos;this.pos=Br(this.buf,q,this.pos);var Q=this.pos-ge;Q>=128&&kt(ge,Q,this),this.pos=ge-1,this.writeVarint(Q),this.pos+=Q},writeFloat:function(q){this.realloc(4),Le.write(this.buf,q,this.pos,!0,23,4),this.pos+=4},writeDouble:function(q){this.realloc(8),Le.write(this.buf,q,this.pos,!0,52,8),this.pos+=8},writeBytes:function(q){var ge=q.length;this.writeVarint(ge),this.realloc(ge);for(var Q=0;Q<ge;Q++)this.buf[this.pos++]=q[Q]},writeRawMessage:function(q,ge){this.pos++;var Q=this.pos;q(ge,this);var Me=this.pos-Q;Me>=128&&kt(Q,Me,this),this.pos=Q-1,this.writeVarint(Me),this.pos+=Me},writeMessage:function(q,ge,Q){this.writeTag(q,J.Bytes),this.writeRawMessage(ge,Q)},writePackedVarint:function(q,ge){ge.length&&this.writeMessage(q,ar,ge)},writePackedSVarint:function(q,ge){ge.length&&this.writeMessage(q,xt,ge)},writePackedBoolean:function(q,ge){ge.length&&this.writeMessage(q,wt,ge)},writePackedFloat:function(q,ge){ge.length&&this.writeMessage(q,Jt,ge)},writePackedDouble:function(q,ge){ge.length&&this.writeMessage(q,Gt,ge)},writePackedFixed32:function(q,ge){ge.length&&this.writeMessage(q,Bt,ge)},writePackedSFixed32:function(q,ge){ge.length&&this.writeMessage(q,gr,ge)},writePackedFixed64:function(q,ge){ge.length&&this.writeMessage(q,K,ge)},writePackedSFixed64:function(q,ge){ge.length&&this.writeMessage(q,ur,ge)},writeBytesField:function(q,ge){this.writeTag(q,J.Bytes),this.writeBytes(ge)},writeFixed32Field:function(q,ge){this.writeTag(q,J.Fixed32),this.writeFixed32(ge)},writeSFixed32Field:function(q,ge){this.writeTag(q,J.Fixed32),this.writeSFixed32(ge)},writeFixed64Field:function(q,ge){this.writeTag(q,J.Fixed64),this.writeFixed64(ge)},writeSFixed64Field:function(q,ge){this.writeTag(q,J.Fixed64),this.writeSFixed64(ge)},writeVarintField:function(q,ge){this.writeTag(q,J.Varint),this.writeVarint(ge)},writeSVarintField:function(q,ge){this.writeTag(q,J.Varint),this.writeSVarint(ge)},writeStringField:function(q,ge){this.writeTag(q,J.Bytes),this.writeString(ge)},writeFloatField:function(q,ge){this.writeTag(q,J.Fixed32),this.writeFloat(ge)},writeDoubleField:function(q,ge){this.writeTag(q,J.Fixed64),this.writeDouble(ge)},writeBooleanField:function(q,ge){this.writeVarintField(q,Boolean(ge))}};function pe(q,ge,Q){var Me=Q.buf,ee,oe;if(oe=Me[Q.pos++],ee=(oe&112)>>4,oe<128||(oe=Me[Q.pos++],ee|=(oe&127)<<3,oe<128)||(oe=Me[Q.pos++],ee|=(oe&127)<<10,oe<128)||(oe=Me[Q.pos++],ee|=(oe&127)<<17,oe<128)||(oe=Me[Q.pos++],ee|=(oe&127)<<24,oe<128)||(oe=Me[Q.pos++],ee|=(oe&1)<<31,oe<128))return _e(q,ee,ge);throw new Error("Expected varint not more than 10 bytes")}function Fe(q){return q.type===J.Bytes?q.readVarint()+q.pos:q.pos+1}function _e(q,ge,Q){return Q?ge*4294967296+(q>>>0):(ge>>>0)*4294967296+(q>>>0)}function Ge(q,ge){var Q,Me;if(q>=0?(Q=q%4294967296|0,Me=q/4294967296|0):(Q=~(-q%4294967296),Me=~(-q/4294967296),Q^4294967295?Q=Q+1|0:(Q=0,Me=Me+1|0)),q>=18446744073709552e3||q<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ge.realloc(10),ot(Q,Me,ge),ft(Me,ge)}function ot(q,ge,Q){Q.buf[Q.pos++]=q&127|128,q>>>=7,Q.buf[Q.pos++]=q&127|128,q>>>=7,Q.buf[Q.pos++]=q&127|128,q>>>=7,Q.buf[Q.pos++]=q&127|128,q>>>=7,Q.buf[Q.pos]=q&127}function ft(q,ge){var Q=(q&7)<<4;ge.buf[ge.pos++]|=Q|((q>>>=3)?128:0),!!q&&(ge.buf[ge.pos++]=q&127|((q>>>=7)?128:0),!!q&&(ge.buf[ge.pos++]=q&127|((q>>>=7)?128:0),!!q&&(ge.buf[ge.pos++]=q&127|((q>>>=7)?128:0),!!q&&(ge.buf[ge.pos++]=q&127|((q>>>=7)?128:0),!!q&&(ge.buf[ge.pos++]=q&127)))))}function kt(q,ge,Q){var Me=ge<=16383?1:ge<=2097151?2:ge<=268435455?3:Math.floor(Math.log(ge)/(Math.LN2*7));Q.realloc(Me);for(var ee=Q.pos-1;ee>=q;ee--)Q.buf[ee+Me]=Q.buf[ee]}function ar(q,ge){for(var Q=0;Q<q.length;Q++)ge.writeVarint(q[Q])}function xt(q,ge){for(var Q=0;Q<q.length;Q++)ge.writeSVarint(q[Q])}function Jt(q,ge){for(var Q=0;Q<q.length;Q++)ge.writeFloat(q[Q])}function Gt(q,ge){for(var Q=0;Q<q.length;Q++)ge.writeDouble(q[Q])}function wt(q,ge){for(var Q=0;Q<q.length;Q++)ge.writeBoolean(q[Q])}function Bt(q,ge){for(var Q=0;Q<q.length;Q++)ge.writeFixed32(q[Q])}function gr(q,ge){for(var Q=0;Q<q.length;Q++)ge.writeSFixed32(q[Q])}function K(q,ge){for(var Q=0;Q<q.length;Q++)ge.writeFixed64(q[Q])}function ur(q,ge){for(var Q=0;Q<q.length;Q++)ge.writeSFixed64(q[Q])}function Tt(q,ge){return(q[ge]|q[ge+1]<<8|q[ge+2]<<16)+q[ge+3]*16777216}function ht(q,ge,Q){q[Q]=ge,q[Q+1]=ge>>>8,q[Q+2]=ge>>>16,q[Q+3]=ge>>>24}function Ot(q,ge){return(q[ge]|q[ge+1]<<8|q[ge+2]<<16)+(q[ge+3]<<24)}function pt(q,ge,Q){for(var Me="",ee=ge;ee<Q;){var oe=q[ee],bt=null,Nt=oe>239?4:oe>223?3:oe>191?2:1;if(ee+Nt>Q)break;var jt,Qt,ln;Nt===1?oe<128&&(bt=oe):Nt===2?(jt=q[ee+1],(jt&192)==128&&(bt=(oe&31)<<6|jt&63,bt<=127&&(bt=null))):Nt===3?(jt=q[ee+1],Qt=q[ee+2],(jt&192)==128&&(Qt&192)==128&&(bt=(oe&15)<<12|(jt&63)<<6|Qt&63,(bt<=2047||bt>=55296&&bt<=57343)&&(bt=null))):Nt===4&&(jt=q[ee+1],Qt=q[ee+2],ln=q[ee+3],(jt&192)==128&&(Qt&192)==128&&(ln&192)==128&&(bt=(oe&15)<<18|(jt&63)<<12|(Qt&63)<<6|ln&63,(bt<=65535||bt>=1114112)&&(bt=null))),bt===null?(bt=65533,Nt=1):bt>65535&&(bt-=65536,Me+=String.fromCharCode(bt>>>10&1023|55296),bt=56320|bt&1023),Me+=String.fromCharCode(bt),ee+=Nt}return Me}function lr(q,ge,Q){return ce.decode(q.subarray(ge,Q))}function Br(q,ge,Q){for(var Me=0,ee,oe;Me<ge.length;Me++){if(ee=ge.charCodeAt(Me),ee>55295&&ee<57344)if(oe)if(ee<56320){q[Q++]=239,q[Q++]=191,q[Q++]=189,oe=ee;continue}else ee=oe-55296<<10|ee-56320|65536,oe=null;else{ee>56319||Me+1===ge.length?(q[Q++]=239,q[Q++]=191,q[Q++]=189):oe=ee;continue}else oe&&(q[Q++]=239,q[Q++]=191,q[Q++]=189,oe=null);ee<128?q[Q++]=ee:(ee<2048?q[Q++]=ee>>6|192:(ee<65536?q[Q++]=ee>>12|224:(q[Q++]=ee>>18|240,q[Q++]=ee>>12&63|128),q[Q++]=ee>>6&63|128),q[Q++]=ee&63|128)}return Q}},32676:function(nn,ye,fe){var Le=fe(34155);(function(J,y){nn.exports=y()})(this,function(){"use strict";function J(Et,me){if(!(Et instanceof me))throw new TypeError("Cannot call a class as a function")}function y(Et,me){for(var se=0;se<me.length;se++){var Se=me[se];Se.enumerable=Se.enumerable||!1,Se.configurable=!0,"value"in Se&&(Se.writable=!0),Object.defineProperty(Et,Se.key,Se)}}function Ae(Et,me,se){return me&&y(Et.prototype,me),se&&y(Et,se),Et}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var T=function(){function Et(me,se){this.next=null,this.key=me,this.data=se,this.left=null,this.right=null}return Et}();function ce(Et,me){return Et>me?1:Et<me?-1:0}function pe(Et,me,se){for(var Se=new T(null,null),z=Se,qe=Se;;){var qt=se(Et,me.key);if(qt<0){if(me.left===null)break;if(se(Et,me.left.key)<0){var Or=me.left;if(me.left=Or.right,Or.right=me,me=Or,me.left===null)break}qe.left=me,qe=me,me=me.left}else if(qt>0){if(me.right===null)break;if(se(Et,me.right.key)>0){var Or=me.right;if(me.right=Or.left,Or.left=me,me=Or,me.right===null)break}z.right=me,z=me,me=me.right}else break}return z.right=me.left,qe.left=me.right,me.left=Se.right,me.right=Se.left,me}function Fe(Et,me,se,Se){var z=new T(Et,me);if(se===null)return z.left=z.right=null,z;se=pe(Et,se,Se);var qe=Se(Et,se.key);return qe<0?(z.left=se.left,z.right=se,se.left=null):qe>=0&&(z.right=se.right,z.left=se,se.right=null),z}function _e(Et,me,se){var Se=null,z=null;if(me){me=pe(Et,me,se);var qe=se(me.key,Et);qe===0?(Se=me.left,z=me.right):qe<0?(z=me.right,me.right=null,Se=me):(Se=me.left,me.left=null,z=me)}return{left:Se,right:z}}function Ge(Et,me,se){return me===null?Et:(Et===null||(me=pe(Et.key,me,se),me.left=Et),me)}function ot(Et,me,se,Se,z){if(Et){Se(""+me+(se?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+z(Et)+`
`);var qe=me+(se?"    ":"\u2502   ");Et.left&&ot(Et.left,qe,!1,Se,z),Et.right&&ot(Et.right,qe,!0,Se,z)}}var ft=function(){function Et(me){me===void 0&&(me=ce),this._root=null,this._size=0,this._comparator=me}return Et.prototype.insert=function(me,se){return this._size++,this._root=Fe(me,se,this._root,this._comparator)},Et.prototype.add=function(me,se){var Se=new T(me,se);this._root===null&&(Se.left=Se.right=null,this._size++,this._root=Se);var z=this._comparator,qe=pe(me,this._root,z),qt=z(me,qe.key);return qt===0?this._root=qe:(qt<0?(Se.left=qe.left,Se.right=qe,qe.left=null):qt>0&&(Se.right=qe.right,Se.left=qe,qe.right=null),this._size++,this._root=Se),this._root},Et.prototype.remove=function(me){this._root=this._remove(me,this._root,this._comparator)},Et.prototype._remove=function(me,se,Se){var z;if(se===null)return null;se=pe(me,se,Se);var qe=Se(me,se.key);return qe===0?(se.left===null?z=se.right:(z=pe(me,se.left,Se),z.right=se.right),this._size--,z):se},Et.prototype.pop=function(){var me=this._root;if(me){for(;me.left;)me=me.left;return this._root=pe(me.key,this._root,this._comparator),this._root=this._remove(me.key,this._root,this._comparator),{key:me.key,data:me.data}}return null},Et.prototype.findStatic=function(me){for(var se=this._root,Se=this._comparator;se;){var z=Se(me,se.key);if(z===0)return se;z<0?se=se.left:se=se.right}return null},Et.prototype.find=function(me){return this._root&&(this._root=pe(me,this._root,this._comparator),this._comparator(me,this._root.key)!==0)?null:this._root},Et.prototype.contains=function(me){for(var se=this._root,Se=this._comparator;se;){var z=Se(me,se.key);if(z===0)return!0;z<0?se=se.left:se=se.right}return!1},Et.prototype.forEach=function(me,se){for(var Se=this._root,z=[],qe=!1;!qe;)Se!==null?(z.push(Se),Se=Se.left):z.length!==0?(Se=z.pop(),me.call(se,Se),Se=Se.right):qe=!0;return this},Et.prototype.range=function(me,se,Se,z){for(var qe=[],qt=this._comparator,Or=this._root,Ye;qe.length!==0||Or;)if(Or)qe.push(Or),Or=Or.left;else{if(Or=qe.pop(),Ye=qt(Or.key,se),Ye>0)break;if(qt(Or.key,me)>=0&&Se.call(z,Or))return this;Or=Or.right}return this},Et.prototype.keys=function(){var me=[];return this.forEach(function(se){var Se=se.key;return me.push(Se)}),me},Et.prototype.values=function(){var me=[];return this.forEach(function(se){var Se=se.data;return me.push(Se)}),me},Et.prototype.min=function(){return this._root?this.minNode(this._root).key:null},Et.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},Et.prototype.minNode=function(me){if(me===void 0&&(me=this._root),me)for(;me.left;)me=me.left;return me},Et.prototype.maxNode=function(me){if(me===void 0&&(me=this._root),me)for(;me.right;)me=me.right;return me},Et.prototype.at=function(me){for(var se=this._root,Se=!1,z=0,qe=[];!Se;)if(se)qe.push(se),se=se.left;else if(qe.length>0){if(se=qe.pop(),z===me)return se;z++,se=se.right}else Se=!0;return null},Et.prototype.next=function(me){var se=this._root,Se=null;if(me.right){for(Se=me.right;Se.left;)Se=Se.left;return Se}for(var z=this._comparator;se;){var qe=z(me.key,se.key);if(qe===0)break;qe<0?(Se=se,se=se.left):se=se.right}return Se},Et.prototype.prev=function(me){var se=this._root,Se=null;if(me.left!==null){for(Se=me.left;Se.right;)Se=Se.right;return Se}for(var z=this._comparator;se;){var qe=z(me.key,se.key);if(qe===0)break;qe<0?se=se.left:(Se=se,se=se.right)}return Se},Et.prototype.clear=function(){return this._root=null,this._size=0,this},Et.prototype.toList=function(){return xt(this._root)},Et.prototype.load=function(me,se,Se){se===void 0&&(se=[]),Se===void 0&&(Se=!1);var z=me.length,qe=this._comparator;if(Se&&wt(me,se,0,z-1,qe),this._root===null)this._root=kt(me,se,0,z),this._size=z;else{var qt=Gt(this.toList(),ar(me,se),qe);z=this._size+z,this._root=Jt({head:qt},0,z)}return this},Et.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(Et.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(Et.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Et.prototype.toString=function(me){me===void 0&&(me=function(z){return String(z.key)});var se=[];return ot(this._root,"",!0,function(Se){return se.push(Se)},me),se.join("")},Et.prototype.update=function(me,se,Se){var z=this._comparator,qe=_e(me,this._root,z),qt=qe.left,Or=qe.right;z(me,se)<0?Or=Fe(se,Se,Or,z):qt=Fe(se,Se,qt,z),this._root=Ge(qt,Or,z)},Et.prototype.split=function(me){return _e(me,this._root,this._comparator)},Et}();function kt(Et,me,se,Se){var z=Se-se;if(z>0){var qe=se+Math.floor(z/2),qt=Et[qe],Or=me[qe],Ye=new T(qt,Or);return Ye.left=kt(Et,me,se,qe),Ye.right=kt(Et,me,qe+1,Se),Ye}return null}function ar(Et,me){for(var se=new T(null,null),Se=se,z=0;z<Et.length;z++)Se=Se.next=new T(Et[z],me[z]);return Se.next=null,se.next}function xt(Et){for(var me=Et,se=[],Se=!1,z=new T(null,null),qe=z;!Se;)me?(se.push(me),me=me.left):se.length>0?(me=qe=qe.next=se.pop(),me=me.right):Se=!0;return qe.next=null,z.next}function Jt(Et,me,se){var Se=se-me;if(Se>0){var z=me+Math.floor(Se/2),qe=Jt(Et,me,z),qt=Et.head;return qt.left=qe,Et.head=Et.head.next,qt.right=Jt(Et,z+1,se),qt}return null}function Gt(Et,me,se){for(var Se=new T(null,null),z=Se,qe=Et,qt=me;qe!==null&&qt!==null;)se(qe.key,qt.key)<0?(z.next=qe,qe=qe.next):(z.next=qt,qt=qt.next),z=z.next;return qe!==null?z.next=qe:qt!==null&&(z.next=qt),Se.next}function wt(Et,me,se,Se,z){if(!(se>=Se)){for(var qe=Et[se+Se>>1],qt=se-1,Or=Se+1;;){do qt++;while(z(Et[qt],qe)<0);do Or--;while(z(Et[Or],qe)>0);if(qt>=Or)break;var Ye=Et[qt];Et[qt]=Et[Or],Et[Or]=Ye,Ye=me[qt],me[qt]=me[Or],me[Or]=Ye}wt(Et,me,se,Or,z),wt(Et,me,Or+1,Se,z)}}var Bt=function(me,se){return me.ll.x<=se.x&&se.x<=me.ur.x&&me.ll.y<=se.y&&se.y<=me.ur.y},gr=function(me,se){if(se.ur.x<me.ll.x||me.ur.x<se.ll.x||se.ur.y<me.ll.y||me.ur.y<se.ll.y)return null;var Se=me.ll.x<se.ll.x?se.ll.x:me.ll.x,z=me.ur.x<se.ur.x?me.ur.x:se.ur.x,qe=me.ll.y<se.ll.y?se.ll.y:me.ll.y,qt=me.ur.y<se.ur.y?me.ur.y:se.ur.y;return{ll:{x:Se,y:qe},ur:{x:z,y:qt}}},K=Number.EPSILON;K===void 0&&(K=Math.pow(2,-52));var ur=K*K,Tt=function(me,se){if(-K<me&&me<K&&-K<se&&se<K)return 0;var Se=me-se;return Se*Se<ur*me*se?0:me<se?-1:1},ht=function(){function Et(){J(this,Et),this.reset()}return Ae(Et,[{key:"reset",value:function(){this.xRounder=new Ot,this.yRounder=new Ot}},{key:"round",value:function(se,Se){return{x:this.xRounder.round(se),y:this.yRounder.round(Se)}}}]),Et}(),Ot=function(){function Et(){J(this,Et),this.tree=new ft,this.round(0)}return Ae(Et,[{key:"round",value:function(se){var Se=this.tree.add(se),z=this.tree.prev(Se);if(z!==null&&Tt(Se.key,z.key)===0)return this.tree.remove(se),z.key;var qe=this.tree.next(Se);return qe!==null&&Tt(Se.key,qe.key)===0?(this.tree.remove(se),qe.key):se}}]),Et}(),pt=new ht,lr=function(me,se){return me.x*se.y-me.y*se.x},Br=function(me,se){return me.x*se.x+me.y*se.y},q=function(me,se,Se){var z={x:se.x-me.x,y:se.y-me.y},qe={x:Se.x-me.x,y:Se.y-me.y},qt=lr(z,qe);return Tt(qt,0)},ge=function(me){return Math.sqrt(Br(me,me))},Q=function(me,se,Se){var z={x:se.x-me.x,y:se.y-me.y},qe={x:Se.x-me.x,y:Se.y-me.y};return lr(qe,z)/ge(qe)/ge(z)},Me=function(me,se,Se){var z={x:se.x-me.x,y:se.y-me.y},qe={x:Se.x-me.x,y:Se.y-me.y};return Br(qe,z)/ge(qe)/ge(z)},ee=function(me,se,Se){return se.y===0?null:{x:me.x+se.x/se.y*(Se-me.y),y:Se}},oe=function(me,se,Se){return se.x===0?null:{x:Se,y:me.y+se.y/se.x*(Se-me.x)}},bt=function(me,se,Se,z){if(se.x===0)return oe(Se,z,me.x);if(z.x===0)return oe(me,se,Se.x);if(se.y===0)return ee(Se,z,me.y);if(z.y===0)return ee(me,se,Se.y);var qe=lr(se,z);if(qe==0)return null;var qt={x:Se.x-me.x,y:Se.y-me.y},Or=lr(qt,se)/qe,Ye=lr(qt,z)/qe,Mt=me.x+Ye*se.x,pr=Se.x+Or*z.x,Mr=me.y+Ye*se.y,Zr=Se.y+Or*z.y,qr=(Mt+pr)/2,jn=(Mr+Zr)/2;return{x:qr,y:jn}},Nt=function(){Ae(Et,null,[{key:"compare",value:function(se,Se){var z=Et.comparePoints(se.point,Se.point);return z!==0?z:(se.point!==Se.point&&se.link(Se),se.isLeft!==Se.isLeft?se.isLeft?1:-1:Qt.compare(se.segment,Se.segment))}},{key:"comparePoints",value:function(se,Se){return se.x<Se.x?-1:se.x>Se.x?1:se.y<Se.y?-1:se.y>Se.y?1:0}}]);function Et(me,se){J(this,Et),me.events===void 0?me.events=[this]:me.events.push(this),this.point=me,this.isLeft=se}return Ae(Et,[{key:"link",value:function(se){if(se.point===this.point)throw new Error("Tried to link already linked events");for(var Se=se.point.events,z=0,qe=Se.length;z<qe;z++){var qt=Se[z];this.point.events.push(qt),qt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var se=this.point.events.length,Se=0;Se<se;Se++){var z=this.point.events[Se];if(z.segment.consumedBy===void 0)for(var qe=Se+1;qe<se;qe++){var qt=this.point.events[qe];qt.consumedBy===void 0&&z.otherSE.point.events===qt.otherSE.point.events&&z.segment.consume(qt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var se=[],Se=0,z=this.point.events.length;Se<z;Se++){var qe=this.point.events[Se];qe!==this&&!qe.segment.ringOut&&qe.segment.isInResult()&&se.push(qe)}return se}},{key:"getLeftmostComparator",value:function(se){var Se=this,z=new Map,qe=function(Or){var Ye=Or.otherSE;z.set(Or,{sine:Q(Se.point,se.point,Ye.point),cosine:Me(Se.point,se.point,Ye.point)})};return function(qt,Or){z.has(qt)||qe(qt),z.has(Or)||qe(Or);var Ye=z.get(qt),Mt=Ye.sine,pr=Ye.cosine,Mr=z.get(Or),Zr=Mr.sine,qr=Mr.cosine;return Mt>=0&&Zr>=0?pr<qr?1:pr>qr?-1:0:Mt<0&&Zr<0?pr<qr?-1:pr>qr?1:0:Zr<Mt?-1:Zr>Mt?1:0}}}]),Et}(),jt=0,Qt=function(){Ae(Et,null,[{key:"compare",value:function(se,Se){var z=se.leftSE.point.x,qe=Se.leftSE.point.x,qt=se.rightSE.point.x,Or=Se.rightSE.point.x;if(Or<z)return 1;if(qt<qe)return-1;var Ye=se.leftSE.point.y,Mt=Se.leftSE.point.y,pr=se.rightSE.point.y,Mr=Se.rightSE.point.y;if(z<qe){if(Mt<Ye&&Mt<pr)return 1;if(Mt>Ye&&Mt>pr)return-1;var Zr=se.comparePoint(Se.leftSE.point);if(Zr<0)return 1;if(Zr>0)return-1;var qr=Se.comparePoint(se.rightSE.point);return qr!==0?qr:-1}if(z>qe){if(Ye<Mt&&Ye<Mr)return-1;if(Ye>Mt&&Ye>Mr)return 1;var jn=Se.comparePoint(se.leftSE.point);if(jn!==0)return jn;var Nn=se.comparePoint(Se.rightSE.point);return Nn<0?1:Nn>0?-1:1}if(Ye<Mt)return-1;if(Ye>Mt)return 1;if(qt<Or){var en=Se.comparePoint(se.rightSE.point);if(en!==0)return en}if(qt>Or){var pi=se.comparePoint(Se.rightSE.point);if(pi<0)return 1;if(pi>0)return-1}if(qt!==Or){var si=pr-Ye,ra=qt-z,Aa=Mr-Mt,va=Or-qe;if(si>ra&&Aa<va)return 1;if(si<ra&&Aa>va)return-1}return qt>Or?1:qt<Or||pr<Mr?-1:pr>Mr?1:se.id<Se.id?-1:se.id>Se.id?1:0}}]);function Et(me,se,Se,z){J(this,Et),this.id=++jt,this.leftSE=me,me.segment=this,me.otherSE=se,this.rightSE=se,se.segment=this,se.otherSE=me,this.rings=Se,this.windings=z}return Ae(Et,[{key:"replaceRightSE",value:function(se){this.rightSE=se,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var se=this.leftSE.point.y,Se=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:se<Se?se:Se},ur:{x:this.rightSE.point.x,y:se>Se?se:Se}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(se){return se.x===this.leftSE.point.x&&se.y===this.leftSE.point.y||se.x===this.rightSE.point.x&&se.y===this.rightSE.point.y}},{key:"comparePoint",value:function(se){if(this.isAnEndpoint(se))return 0;var Se=this.leftSE.point,z=this.rightSE.point,qe=this.vector();if(Se.x===z.x)return se.x===Se.x?0:se.x<Se.x?1:-1;var qt=(se.y-Se.y)/qe.y,Or=Se.x+qt*qe.x;if(se.x===Or)return 0;var Ye=(se.x-Se.x)/qe.x,Mt=Se.y+Ye*qe.y;return se.y===Mt?0:se.y<Mt?-1:1}},{key:"getIntersection",value:function(se){var Se=this.bbox(),z=se.bbox(),qe=gr(Se,z);if(qe===null)return null;var qt=this.leftSE.point,Or=this.rightSE.point,Ye=se.leftSE.point,Mt=se.rightSE.point,pr=Bt(Se,Ye)&&this.comparePoint(Ye)===0,Mr=Bt(z,qt)&&se.comparePoint(qt)===0,Zr=Bt(Se,Mt)&&this.comparePoint(Mt)===0,qr=Bt(z,Or)&&se.comparePoint(Or)===0;if(Mr&&pr)return qr&&!Zr?Or:!qr&&Zr?Mt:null;if(Mr)return Zr&&qt.x===Mt.x&&qt.y===Mt.y?null:qt;if(pr)return qr&&Or.x===Ye.x&&Or.y===Ye.y?null:Ye;if(qr&&Zr)return null;if(qr)return Or;if(Zr)return Mt;var jn=bt(qt,this.vector(),Ye,se.vector());return jn===null||!Bt(qe,jn)?null:pt.round(jn.x,jn.y)}},{key:"split",value:function(se){var Se=[],z=se.events!==void 0,qe=new Nt(se,!0),qt=new Nt(se,!1),Or=this.rightSE;this.replaceRightSE(qt),Se.push(qt),Se.push(qe);var Ye=new Et(qe,Or,this.rings.slice(),this.windings.slice());return Nt.comparePoints(Ye.leftSE.point,Ye.rightSE.point)>0&&Ye.swapEvents(),Nt.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),z&&(qe.checkForConsuming(),qt.checkForConsuming()),Se}},{key:"swapEvents",value:function(){var se=this.rightSE;this.rightSE=this.leftSE,this.leftSE=se,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var Se=0,z=this.windings.length;Se<z;Se++)this.windings[Se]*=-1}},{key:"consume",value:function(se){for(var Se=this,z=se;Se.consumedBy;)Se=Se.consumedBy;for(;z.consumedBy;)z=z.consumedBy;var qe=Et.compare(Se,z);if(qe!==0){if(qe>0){var qt=Se;Se=z,z=qt}if(Se.prev===z){var Or=Se;Se=z,z=Or}for(var Ye=0,Mt=z.rings.length;Ye<Mt;Ye++){var pr=z.rings[Ye],Mr=z.windings[Ye],Zr=Se.rings.indexOf(pr);Zr===-1?(Se.rings.push(pr),Se.windings.push(Mr)):Se.windings[Zr]+=Mr}z.rings=null,z.windings=null,z.consumedBy=Se,z.leftSE.consumedBy=Se.leftSE,z.rightSE.consumedBy=Se.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var se=this.prev.consumedBy||this.prev;this._beforeState=se.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var se=this.beforeState();this._afterState={rings:se.rings.slice(0),windings:se.windings.slice(0),multiPolys:[]};for(var Se=this._afterState.rings,z=this._afterState.windings,qe=this._afterState.multiPolys,qt=0,Or=this.rings.length;qt<Or;qt++){var Ye=this.rings[qt],Mt=this.windings[qt],pr=Se.indexOf(Ye);pr===-1?(Se.push(Ye),z.push(Mt)):z[pr]+=Mt}for(var Mr=[],Zr=[],qr=0,jn=Se.length;qr<jn;qr++)if(z[qr]!==0){var Nn=Se[qr],en=Nn.poly;if(Zr.indexOf(en)===-1)if(Nn.isExterior)Mr.push(en);else{Zr.indexOf(en)===-1&&Zr.push(en);var pi=Mr.indexOf(Nn.poly);pi!==-1&&Mr.splice(pi,1)}}for(var si=0,ra=Mr.length;si<ra;si++){var Aa=Mr[si].multiPoly;qe.indexOf(Aa)===-1&&qe.push(Aa)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var se=this.beforeState().multiPolys,Se=this.afterState().multiPolys;switch(hi.type){case"union":{var z=se.length===0,qe=Se.length===0;this._isInResult=z!==qe;break}case"intersection":{var qt,Or;se.length<Se.length?(qt=se.length,Or=Se.length):(qt=Se.length,Or=se.length),this._isInResult=Or===hi.numMultiPolys&&qt<Or;break}case"xor":{var Ye=Math.abs(se.length-Se.length);this._isInResult=Ye%2==1;break}case"difference":{var Mt=function(Mr){return Mr.length===1&&Mr[0].isSubject};this._isInResult=Mt(se)!==Mt(Se);break}default:throw new Error("Unrecognized operation type found ".concat(hi.type))}return this._isInResult}}],[{key:"fromRing",value:function(se,Se,z){var qe,qt,Or,Ye=Nt.comparePoints(se,Se);if(Ye<0)qe=se,qt=Se,Or=1;else if(Ye>0)qe=Se,qt=se,Or=-1;else throw new Error("Tried to create degenerate segment at [".concat(se.x,", ").concat(se.y,"]"));var Mt=new Nt(qe,!0),pr=new Nt(qt,!1);return new Et(Mt,pr,[z],[Or])}}]),Et}(),ln=function(){function Et(me,se,Se){if(J(this,Et),!Array.isArray(me)||me.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=se,this.isExterior=Se,this.segments=[],typeof me[0][0]!="number"||typeof me[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var z=pt.round(me[0][0],me[0][1]);this.bbox={ll:{x:z.x,y:z.y},ur:{x:z.x,y:z.y}};for(var qe=z,qt=1,Or=me.length;qt<Or;qt++){if(typeof me[qt][0]!="number"||typeof me[qt][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Ye=pt.round(me[qt][0],me[qt][1]);Ye.x===qe.x&&Ye.y===qe.y||(this.segments.push(Qt.fromRing(qe,Ye,this)),Ye.x<this.bbox.ll.x&&(this.bbox.ll.x=Ye.x),Ye.y<this.bbox.ll.y&&(this.bbox.ll.y=Ye.y),Ye.x>this.bbox.ur.x&&(this.bbox.ur.x=Ye.x),Ye.y>this.bbox.ur.y&&(this.bbox.ur.y=Ye.y),qe=Ye)}(z.x!==qe.x||z.y!==qe.y)&&this.segments.push(Qt.fromRing(qe,z,this))}return Ae(Et,[{key:"getSweepEvents",value:function(){for(var se=[],Se=0,z=this.segments.length;Se<z;Se++){var qe=this.segments[Se];se.push(qe.leftSE),se.push(qe.rightSE)}return se}}]),Et}(),Dr=function(){function Et(me,se){if(J(this,Et),!Array.isArray(me))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ln(me[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var Se=1,z=me.length;Se<z;Se++){var qe=new ln(me[Se],this,!1);qe.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=qe.bbox.ll.x),qe.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=qe.bbox.ll.y),qe.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=qe.bbox.ur.x),qe.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=qe.bbox.ur.y),this.interiorRings.push(qe)}this.multiPoly=se}return Ae(Et,[{key:"getSweepEvents",value:function(){for(var se=this.exteriorRing.getSweepEvents(),Se=0,z=this.interiorRings.length;Se<z;Se++)for(var qe=this.interiorRings[Se].getSweepEvents(),qt=0,Or=qe.length;qt<Or;qt++)se.push(qe[qt]);return se}}]),Et}(),oi=function(){function Et(me,se){if(J(this,Et),!Array.isArray(me))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof me[0][0][0]=="number"&&(me=[me])}catch(qt){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var Se=0,z=me.length;Se<z;Se++){var qe=new Dr(me[Se],this);qe.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=qe.bbox.ll.x),qe.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=qe.bbox.ll.y),qe.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=qe.bbox.ur.x),qe.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=qe.bbox.ur.y),this.polys.push(qe)}this.isSubject=se}return Ae(Et,[{key:"getSweepEvents",value:function(){for(var se=[],Se=0,z=this.polys.length;Se<z;Se++)for(var qe=this.polys[Se].getSweepEvents(),qt=0,Or=qe.length;qt<Or;qt++)se.push(qe[qt]);return se}}]),Et}(),Zn=function(){Ae(Et,null,[{key:"factory",value:function(se){for(var Se=[],z=0,qe=se.length;z<qe;z++){var qt=se[z];if(!(!qt.isInResult()||qt.ringOut)){for(var Or=null,Ye=qt.leftSE,Mt=qt.rightSE,pr=[Ye],Mr=Ye.point,Zr=[];Or=Ye,Ye=Mt,pr.push(Ye),Ye.point!==Mr;)for(;;){var qr=Ye.getAvailableLinkedEvents();if(qr.length===0){var jn=pr[0].point,Nn=pr[pr.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(jn.x,",")+" ".concat(jn.y,"]. Last matching segment found ends at")+" [".concat(Nn.x,", ").concat(Nn.y,"]."))}if(qr.length===1){Mt=qr[0].otherSE;break}for(var en=null,pi=0,si=Zr.length;pi<si;pi++)if(Zr[pi].point===Ye.point){en=pi;break}if(en!==null){var ra=Zr.splice(en)[0],Aa=pr.splice(ra.index);Aa.unshift(Aa[0].otherSE),Se.push(new Et(Aa.reverse()));continue}Zr.push({index:pr.length,point:Ye.point});var va=Ye.getLeftmostComparator(Or);Mt=qr.sort(va)[0].otherSE;break}Se.push(new Et(pr))}}return Se}}]);function Et(me){J(this,Et),this.events=me;for(var se=0,Se=me.length;se<Se;se++)me[se].segment.ringOut=this;this.poly=null}return Ae(Et,[{key:"getGeom",value:function(){for(var se=this.events[0].point,Se=[se],z=1,qe=this.events.length-1;z<qe;z++){var qt=this.events[z].point,Or=this.events[z+1].point;q(qt,se,Or)!==0&&(Se.push(qt),se=qt)}if(Se.length===1)return null;var Ye=Se[0],Mt=Se[1];q(Ye,se,Mt)===0&&Se.shift(),Se.push(Se[0]);for(var pr=this.isExteriorRing()?1:-1,Mr=this.isExteriorRing()?0:Se.length-1,Zr=this.isExteriorRing()?Se.length:-1,qr=[],jn=Mr;jn!=Zr;jn+=pr)qr.push([Se[jn].x,Se[jn].y]);return qr}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var se=this.enclosingRing();this._isExteriorRing=se?!se.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var se=this.events[0],Se=1,z=this.events.length;Se<z;Se++){var qe=this.events[Se];Nt.compare(se,qe)>0&&(se=qe)}for(var qt=se.segment.prevInResult(),Or=qt?qt.prevInResult():null;;){if(!qt)return null;if(!Or)return qt.ringOut;if(Or.ringOut!==qt.ringOut)return Or.ringOut.enclosingRing()!==qt.ringOut?qt.ringOut:qt.ringOut.enclosingRing();qt=Or.prevInResult(),Or=qt?qt.prevInResult():null}}}]),Et}(),Vn=function(){function Et(me){J(this,Et),this.exteriorRing=me,me.poly=this,this.interiorRings=[]}return Ae(Et,[{key:"addInterior",value:function(se){this.interiorRings.push(se),se.poly=this}},{key:"getGeom",value:function(){var se=[this.exteriorRing.getGeom()];if(se[0]===null)return null;for(var Se=0,z=this.interiorRings.length;Se<z;Se++){var qe=this.interiorRings[Se].getGeom();qe!==null&&se.push(qe)}return se}}]),Et}(),Xi=function(){function Et(me){J(this,Et),this.rings=me,this.polys=this._composePolys(me)}return Ae(Et,[{key:"getGeom",value:function(){for(var se=[],Se=0,z=this.polys.length;Se<z;Se++){var qe=this.polys[Se].getGeom();qe!==null&&se.push(qe)}return se}},{key:"_composePolys",value:function(se){for(var Se=[],z=0,qe=se.length;z<qe;z++){var qt=se[z];if(!qt.poly)if(qt.isExteriorRing())Se.push(new Vn(qt));else{var Or=qt.enclosingRing();Or.poly||Se.push(new Vn(Or)),Or.poly.addInterior(qt)}}return Se}}]),Et}(),Ci=function(){function Et(me){var se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Qt.compare;J(this,Et),this.queue=me,this.tree=new ft(se),this.segments=[]}return Ae(Et,[{key:"process",value:function(se){var Se=se.segment,z=[];if(se.consumedBy)return se.isLeft?this.queue.remove(se.otherSE):this.tree.remove(Se),z;var qe=se.isLeft?this.tree.insert(Se):this.tree.find(Se);if(!qe)throw new Error("Unable to find segment #".concat(Se.id," ")+"[".concat(Se.leftSE.point.x,", ").concat(Se.leftSE.point.y,"] -> ")+"[".concat(Se.rightSE.point.x,", ").concat(Se.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var qt=qe,Or=qe,Ye=void 0,Mt=void 0;Ye===void 0;)qt=this.tree.prev(qt),qt===null?Ye=null:qt.key.consumedBy===void 0&&(Ye=qt.key);for(;Mt===void 0;)Or=this.tree.next(Or),Or===null?Mt=null:Or.key.consumedBy===void 0&&(Mt=Or.key);if(se.isLeft){var pr=null;if(Ye){var Mr=Ye.getIntersection(Se);if(Mr!==null&&(Se.isAnEndpoint(Mr)||(pr=Mr),!Ye.isAnEndpoint(Mr)))for(var Zr=this._splitSafely(Ye,Mr),qr=0,jn=Zr.length;qr<jn;qr++)z.push(Zr[qr])}var Nn=null;if(Mt){var en=Mt.getIntersection(Se);if(en!==null&&(Se.isAnEndpoint(en)||(Nn=en),!Mt.isAnEndpoint(en)))for(var pi=this._splitSafely(Mt,en),si=0,ra=pi.length;si<ra;si++)z.push(pi[si])}if(pr!==null||Nn!==null){var Aa=null;if(pr===null)Aa=Nn;else if(Nn===null)Aa=pr;else{var va=Nt.comparePoints(pr,Nn);Aa=va<=0?pr:Nn}this.queue.remove(Se.rightSE),z.push(Se.rightSE);for(var xa=Se.split(Aa),Ki=0,Y=xa.length;Ki<Y;Ki++)z.push(xa[Ki])}z.length>0?(this.tree.remove(Se),z.push(se)):(this.segments.push(Se),Se.prev=Ye)}else{if(Ye&&Mt){var ie=Ye.getIntersection(Mt);if(ie!==null){if(!Ye.isAnEndpoint(ie))for(var de=this._splitSafely(Ye,ie),Ce=0,Ze=de.length;Ce<Ze;Ce++)z.push(de[Ce]);if(!Mt.isAnEndpoint(ie))for(var et=this._splitSafely(Mt,ie),dt=0,be=et.length;dt<be;dt++)z.push(et[dt])}}this.tree.remove(Se)}return z}},{key:"_splitSafely",value:function(se,Se){this.tree.remove(se);var z=se.rightSE;this.queue.remove(z);var qe=se.split(Se);return qe.push(z),se.consumedBy===void 0&&this.tree.insert(se),qe}}]),Et}(),fi=typeof Le!="undefined"&&{UMI_ENV:"pre",REACT_APP_ENV:"pre",REACT_APP_PUBLIC_PATH:"/console/",REACT_APP_PREFIX_URL:"https://www.brandsz.cn"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Hi=typeof Le!="undefined"&&{UMI_ENV:"pre",REACT_APP_ENV:"pre",REACT_APP_PUBLIC_PATH:"/console/",REACT_APP_PREFIX_URL:"https://www.brandsz.cn"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Ni=function(){function Et(){J(this,Et)}return Ae(Et,[{key:"run",value:function(se,Se,z){hi.type=se,pt.reset();for(var qe=[new oi(Se,!0)],qt=0,Or=z.length;qt<Or;qt++)qe.push(new oi(z[qt],!1));if(hi.numMultiPolys=qe.length,hi.type==="difference")for(var Ye=qe[0],Mt=1;Mt<qe.length;)gr(qe[Mt].bbox,Ye.bbox)!==null?Mt++:qe.splice(Mt,1);if(hi.type==="intersection"){for(var pr=0,Mr=qe.length;pr<Mr;pr++)for(var Zr=qe[pr],qr=pr+1,jn=qe.length;qr<jn;qr++)if(gr(Zr.bbox,qe[qr].bbox)===null)return[]}for(var Nn=new ft(Nt.compare),en=0,pi=qe.length;en<pi;en++)for(var si=qe[en].getSweepEvents(),ra=0,Aa=si.length;ra<Aa;ra++)if(Nn.insert(si[ra]),Nn.size>fi)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var va=new Ci(Nn),xa=Nn.size,Ki=Nn.pop();Ki;){var Y=Ki.key;if(Nn.size===xa){var ie=Y.segment;throw new Error("Unable to pop() ".concat(Y.isLeft?"left":"right"," SweepEvent ")+"[".concat(Y.point.x,", ").concat(Y.point.y,"] from segment #").concat(ie.id," ")+"[".concat(ie.leftSE.point.x,", ").concat(ie.leftSE.point.y,"] -> ")+"[".concat(ie.rightSE.point.x,", ").concat(ie.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(Nn.size>fi)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(va.segments.length>Hi)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var de=va.process(Y),Ce=0,Ze=de.length;Ce<Ze;Ce++){var et=de[Ce];et.consumedBy===void 0&&Nn.insert(et)}xa=Nn.size,Ki=Nn.pop()}pt.reset();var dt=Zn.factory(va.segments),be=new Xi(dt);return be.getGeom()}}]),Et}(),hi=new Ni,Xn=function(me){for(var se=arguments.length,Se=new Array(se>1?se-1:0),z=1;z<se;z++)Se[z-1]=arguments[z];return hi.run("union",me,Se)},ri=function(me){for(var se=arguments.length,Se=new Array(se>1?se-1:0),z=1;z<se;z++)Se[z-1]=arguments[z];return hi.run("intersection",me,Se)},po=function(me){for(var se=arguments.length,Se=new Array(se>1?se-1:0),z=1;z<se;z++)Se[z-1]=arguments[z];return hi.run("xor",me,Se)},Ha=function(me){for(var se=arguments.length,Se=new Array(se>1?se-1:0),z=1;z<se;z++)Se[z-1]=arguments[z];return hi.run("difference",me,Se)},wa={union:Xn,intersection:ri,xor:po,difference:Ha};return wa})},28660:function(nn,ye,fe){var Le=fe(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var J;(function(y){(function(Ae){var T=typeof fe.g=="object"?fe.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ce=pe(y);typeof T.Reflect=="undefined"?T.Reflect=y:ce=pe(T.Reflect,ce),Ae(ce);function pe(Fe,_e){return function(Ge,ot){typeof Fe[Ge]!="function"&&Object.defineProperty(Fe,Ge,{configurable:!0,writable:!0,value:ot}),_e&&_e(Ge,ot)}}})(function(Ae){var T=Object.prototype.hasOwnProperty,ce=typeof Symbol=="function",pe=ce&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Fe=ce&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",_e=typeof Object.create=="function",Ge={__proto__:[]}instanceof Array,ot=!_e&&!Ge,ft={create:_e?function(){return Or(Object.create(null))}:Ge?function(){return Or({__proto__:null})}:function(){return Or({})},has:ot?function(Ye,Mt){return T.call(Ye,Mt)}:function(Ye,Mt){return Mt in Ye},get:ot?function(Ye,Mt){return T.call(Ye,Mt)?Ye[Mt]:void 0}:function(Ye,Mt){return Ye[Mt]}},kt=Object.getPrototypeOf(Function),ar=typeof Le=="object"&&{UMI_ENV:"pre",REACT_APP_ENV:"pre",REACT_APP_PUBLIC_PATH:"/console/",REACT_APP_PREFIX_URL:"https://www.brandsz.cn"}&&{UMI_ENV:"pre",REACT_APP_ENV:"pre",REACT_APP_PUBLIC_PATH:"/console/",REACT_APP_PREFIX_URL:"https://www.brandsz.cn"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",xt=!ar&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:z(),Jt=!ar&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:qe(),Gt=!ar&&typeof WeakMap=="function"?WeakMap:qt(),wt=new Gt;function Bt(Ye,Mt,pr,Mr){if(Dr(pr)){if(!hi(Ye))throw new TypeError;if(!ri(Mt))throw new TypeError;return q(Ye,Mt)}else{if(!hi(Ye))throw new TypeError;if(!Vn(Mt))throw new TypeError;if(!Vn(Mr)&&!Dr(Mr)&&!oi(Mr))throw new TypeError;return oi(Mr)&&(Mr=void 0),pr=Ni(pr),ge(Ye,Mt,pr,Mr)}}Ae("decorate",Bt);function gr(Ye,Mt){function pr(Mr,Zr){if(!Vn(Mr))throw new TypeError;if(!Dr(Zr)&&!po(Zr))throw new TypeError;Nt(Ye,Mt,Mr,Zr)}return pr}Ae("metadata",gr);function K(Ye,Mt,pr,Mr){if(!Vn(pr))throw new TypeError;return Dr(Mr)||(Mr=Ni(Mr)),Nt(Ye,Mt,pr,Mr)}Ae("defineMetadata",K);function ur(Ye,Mt,pr){if(!Vn(Mt))throw new TypeError;return Dr(pr)||(pr=Ni(pr)),Me(Ye,Mt,pr)}Ae("hasMetadata",ur);function Tt(Ye,Mt,pr){if(!Vn(Mt))throw new TypeError;return Dr(pr)||(pr=Ni(pr)),ee(Ye,Mt,pr)}Ae("hasOwnMetadata",Tt);function ht(Ye,Mt,pr){if(!Vn(Mt))throw new TypeError;return Dr(pr)||(pr=Ni(pr)),oe(Ye,Mt,pr)}Ae("getMetadata",ht);function Ot(Ye,Mt,pr){if(!Vn(Mt))throw new TypeError;return Dr(pr)||(pr=Ni(pr)),bt(Ye,Mt,pr)}Ae("getOwnMetadata",Ot);function pt(Ye,Mt){if(!Vn(Ye))throw new TypeError;return Dr(Mt)||(Mt=Ni(Mt)),jt(Ye,Mt)}Ae("getMetadataKeys",pt);function lr(Ye,Mt){if(!Vn(Ye))throw new TypeError;return Dr(Mt)||(Mt=Ni(Mt)),Qt(Ye,Mt)}Ae("getOwnMetadataKeys",lr);function Br(Ye,Mt,pr){if(!Vn(Mt))throw new TypeError;Dr(pr)||(pr=Ni(pr));var Mr=Q(Mt,pr,!1);if(Dr(Mr)||!Mr.delete(Ye))return!1;if(Mr.size>0)return!0;var Zr=wt.get(Mt);return Zr.delete(pr),Zr.size>0||wt.delete(Mt),!0}Ae("deleteMetadata",Br);function q(Ye,Mt){for(var pr=Ye.length-1;pr>=0;--pr){var Mr=Ye[pr],Zr=Mr(Mt);if(!Dr(Zr)&&!oi(Zr)){if(!ri(Zr))throw new TypeError;Mt=Zr}}return Mt}function ge(Ye,Mt,pr,Mr){for(var Zr=Ye.length-1;Zr>=0;--Zr){var qr=Ye[Zr],jn=qr(Mt,pr,Mr);if(!Dr(jn)&&!oi(jn)){if(!Vn(jn))throw new TypeError;Mr=jn}}return Mr}function Q(Ye,Mt,pr){var Mr=wt.get(Ye);if(Dr(Mr)){if(!pr)return;Mr=new xt,wt.set(Ye,Mr)}var Zr=Mr.get(Mt);if(Dr(Zr)){if(!pr)return;Zr=new xt,Mr.set(Mt,Zr)}return Zr}function Me(Ye,Mt,pr){var Mr=ee(Ye,Mt,pr);if(Mr)return!0;var Zr=Se(Mt);return oi(Zr)?!1:Me(Ye,Zr,pr)}function ee(Ye,Mt,pr){var Mr=Q(Mt,pr,!1);return Dr(Mr)?!1:fi(Mr.has(Ye))}function oe(Ye,Mt,pr){var Mr=ee(Ye,Mt,pr);if(Mr)return bt(Ye,Mt,pr);var Zr=Se(Mt);if(!oi(Zr))return oe(Ye,Zr,pr)}function bt(Ye,Mt,pr){var Mr=Q(Mt,pr,!1);if(!Dr(Mr))return Mr.get(Ye)}function Nt(Ye,Mt,pr,Mr){var Zr=Q(pr,Mr,!0);Zr.set(Ye,Mt)}function jt(Ye,Mt){var pr=Qt(Ye,Mt),Mr=Se(Ye);if(Mr===null)return pr;var Zr=jt(Mr,Mt);if(Zr.length<=0)return pr;if(pr.length<=0)return Zr;for(var qr=new Jt,jn=[],Nn=0,en=pr;Nn<en.length;Nn++){var pi=en[Nn],si=qr.has(pi);si||(qr.add(pi),jn.push(pi))}for(var ra=0,Aa=Zr;ra<Aa.length;ra++){var pi=Aa[ra],si=qr.has(pi);si||(qr.add(pi),jn.push(pi))}return jn}function Qt(Ye,Mt){var pr=[],Mr=Q(Ye,Mt,!1);if(Dr(Mr))return pr;for(var Zr=Mr.keys(),qr=wa(Zr),jn=0;;){var Nn=me(qr);if(!Nn)return pr.length=jn,pr;var en=Et(Nn);try{pr[jn]=en}catch(pi){try{se(qr)}finally{throw pi}}jn++}}function ln(Ye){if(Ye===null)return 1;switch(typeof Ye){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ye===null?1:6;default:return 6}}function Dr(Ye){return Ye===void 0}function oi(Ye){return Ye===null}function Zn(Ye){return typeof Ye=="symbol"}function Vn(Ye){return typeof Ye=="object"?Ye!==null:typeof Ye=="function"}function Xi(Ye,Mt){switch(ln(Ye)){case 0:return Ye;case 1:return Ye;case 2:return Ye;case 3:return Ye;case 4:return Ye;case 5:return Ye}var pr=Mt===3?"string":Mt===5?"number":"default",Mr=Ha(Ye,pe);if(Mr!==void 0){var Zr=Mr.call(Ye,pr);if(Vn(Zr))throw new TypeError;return Zr}return Ci(Ye,pr==="default"?"number":pr)}function Ci(Ye,Mt){if(Mt==="string"){var pr=Ye.toString;if(Xn(pr)){var Mr=pr.call(Ye);if(!Vn(Mr))return Mr}var Zr=Ye.valueOf;if(Xn(Zr)){var Mr=Zr.call(Ye);if(!Vn(Mr))return Mr}}else{var Zr=Ye.valueOf;if(Xn(Zr)){var Mr=Zr.call(Ye);if(!Vn(Mr))return Mr}var qr=Ye.toString;if(Xn(qr)){var Mr=qr.call(Ye);if(!Vn(Mr))return Mr}}throw new TypeError}function fi(Ye){return!!Ye}function Hi(Ye){return""+Ye}function Ni(Ye){var Mt=Xi(Ye,3);return Zn(Mt)?Mt:Hi(Mt)}function hi(Ye){return Array.isArray?Array.isArray(Ye):Ye instanceof Object?Ye instanceof Array:Object.prototype.toString.call(Ye)==="[object Array]"}function Xn(Ye){return typeof Ye=="function"}function ri(Ye){return typeof Ye=="function"}function po(Ye){switch(ln(Ye)){case 3:return!0;case 4:return!0;default:return!1}}function Ha(Ye,Mt){var pr=Ye[Mt];if(pr!=null){if(!Xn(pr))throw new TypeError;return pr}}function wa(Ye){var Mt=Ha(Ye,Fe);if(!Xn(Mt))throw new TypeError;var pr=Mt.call(Ye);if(!Vn(pr))throw new TypeError;return pr}function Et(Ye){return Ye.value}function me(Ye){var Mt=Ye.next();return Mt.done?!1:Mt}function se(Ye){var Mt=Ye.return;Mt&&Mt.call(Ye)}function Se(Ye){var Mt=Object.getPrototypeOf(Ye);if(typeof Ye!="function"||Ye===kt||Mt!==kt)return Mt;var pr=Ye.prototype,Mr=pr&&Object.getPrototypeOf(pr);if(Mr==null||Mr===Object.prototype)return Mt;var Zr=Mr.constructor;return typeof Zr!="function"||Zr===Ye?Mt:Zr}function z(){var Ye={},Mt=[],pr=function(){function jn(Nn,en,pi){this._index=0,this._keys=Nn,this._values=en,this._selector=pi}return jn.prototype["@@iterator"]=function(){return this},jn.prototype[Fe]=function(){return this},jn.prototype.next=function(){var Nn=this._index;if(Nn>=0&&Nn<this._keys.length){var en=this._selector(this._keys[Nn],this._values[Nn]);return Nn+1>=this._keys.length?(this._index=-1,this._keys=Mt,this._values=Mt):this._index++,{value:en,done:!1}}return{value:void 0,done:!0}},jn.prototype.throw=function(Nn){throw this._index>=0&&(this._index=-1,this._keys=Mt,this._values=Mt),Nn},jn.prototype.return=function(Nn){return this._index>=0&&(this._index=-1,this._keys=Mt,this._values=Mt),{value:Nn,done:!0}},jn}();return function(){function jn(){this._keys=[],this._values=[],this._cacheKey=Ye,this._cacheIndex=-2}return Object.defineProperty(jn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),jn.prototype.has=function(Nn){return this._find(Nn,!1)>=0},jn.prototype.get=function(Nn){var en=this._find(Nn,!1);return en>=0?this._values[en]:void 0},jn.prototype.set=function(Nn,en){var pi=this._find(Nn,!0);return this._values[pi]=en,this},jn.prototype.delete=function(Nn){var en=this._find(Nn,!1);if(en>=0){for(var pi=this._keys.length,si=en+1;si<pi;si++)this._keys[si-1]=this._keys[si],this._values[si-1]=this._values[si];return this._keys.length--,this._values.length--,Nn===this._cacheKey&&(this._cacheKey=Ye,this._cacheIndex=-2),!0}return!1},jn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ye,this._cacheIndex=-2},jn.prototype.keys=function(){return new pr(this._keys,this._values,Mr)},jn.prototype.values=function(){return new pr(this._keys,this._values,Zr)},jn.prototype.entries=function(){return new pr(this._keys,this._values,qr)},jn.prototype["@@iterator"]=function(){return this.entries()},jn.prototype[Fe]=function(){return this.entries()},jn.prototype._find=function(Nn,en){return this._cacheKey!==Nn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Nn)),this._cacheIndex<0&&en&&(this._cacheIndex=this._keys.length,this._keys.push(Nn),this._values.push(void 0)),this._cacheIndex},jn}();function Mr(jn,Nn){return jn}function Zr(jn,Nn){return Nn}function qr(jn,Nn){return[jn,Nn]}}function qe(){return function(){function Ye(){this._map=new xt}return Object.defineProperty(Ye.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ye.prototype.has=function(Mt){return this._map.has(Mt)},Ye.prototype.add=function(Mt){return this._map.set(Mt,Mt),this},Ye.prototype.delete=function(Mt){return this._map.delete(Mt)},Ye.prototype.clear=function(){this._map.clear()},Ye.prototype.keys=function(){return this._map.keys()},Ye.prototype.values=function(){return this._map.values()},Ye.prototype.entries=function(){return this._map.entries()},Ye.prototype["@@iterator"]=function(){return this.keys()},Ye.prototype[Fe]=function(){return this.keys()},Ye}()}function qt(){var Ye=16,Mt=ft.create(),pr=Mr();return function(){function en(){this._key=Mr()}return en.prototype.has=function(pi){var si=Zr(pi,!1);return si!==void 0?ft.has(si,this._key):!1},en.prototype.get=function(pi){var si=Zr(pi,!1);return si!==void 0?ft.get(si,this._key):void 0},en.prototype.set=function(pi,si){var ra=Zr(pi,!0);return ra[this._key]=si,this},en.prototype.delete=function(pi){var si=Zr(pi,!1);return si!==void 0?delete si[this._key]:!1},en.prototype.clear=function(){this._key=Mr()},en}();function Mr(){var en;do en="@@WeakMap@@"+Nn();while(ft.has(Mt,en));return Mt[en]=!0,en}function Zr(en,pi){if(!T.call(en,pr)){if(!pi)return;Object.defineProperty(en,pr,{value:ft.create()})}return en[pr]}function qr(en,pi){for(var si=0;si<pi;++si)en[si]=Math.random()*255|0;return en}function jn(en){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(en)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(en)):qr(new Uint8Array(en),en):qr(new Array(en),en)}function Nn(){var en=jn(Ye);en[6]=en[6]&79|64,en[8]=en[8]&191|128;for(var pi="",si=0;si<Ye;++si){var ra=en[si];(si===4||si===6||si===8)&&(pi+="-"),ra<16&&(pi+="0"),pi+=ra.toString(16).toLowerCase()}return pi}}function Or(Ye){return Ye.__=void 0,delete Ye.__,Ye}})})(J||(J={}))},69848:function(nn){(function(ye,fe){nn.exports=fe()})(this,function(){"use strict";function ye(Tt,ht,Ot,pt,lr,Br){if(!(lr-pt<=Ot)){var q=pt+lr>>1;fe(Tt,ht,q,pt,lr,Br%2),ye(Tt,ht,Ot,pt,q-1,Br+1),ye(Tt,ht,Ot,q+1,lr,Br+1)}}function fe(Tt,ht,Ot,pt,lr,Br){for(;lr>pt;){if(lr-pt>600){var q=lr-pt+1,ge=Ot-pt+1,Q=Math.log(q),Me=.5*Math.exp(2*Q/3),ee=.5*Math.sqrt(Q*Me*(q-Me)/q)*(ge-q/2<0?-1:1),oe=Math.max(pt,Math.floor(Ot-ge*Me/q+ee)),bt=Math.min(lr,Math.floor(Ot+(q-ge)*Me/q+ee));fe(Tt,ht,Ot,oe,bt,Br)}var Nt=ht[2*Ot+Br],jt=pt,Qt=lr;for(Le(Tt,ht,pt,Ot),ht[2*lr+Br]>Nt&&Le(Tt,ht,pt,lr);jt<Qt;){for(Le(Tt,ht,jt,Qt),jt++,Qt--;ht[2*jt+Br]<Nt;)jt++;for(;ht[2*Qt+Br]>Nt;)Qt--}ht[2*pt+Br]===Nt?Le(Tt,ht,pt,Qt):(Qt++,Le(Tt,ht,Qt,lr)),Qt<=Ot&&(pt=Qt+1),Ot<=Qt&&(lr=Qt-1)}}function Le(Tt,ht,Ot,pt){J(Tt,Ot,pt),J(ht,2*Ot,2*pt),J(ht,2*Ot+1,2*pt+1)}function J(Tt,ht,Ot){var pt=Tt[ht];Tt[ht]=Tt[Ot],Tt[Ot]=pt}function y(Tt,ht,Ot,pt,lr,Br,q){for(var ge=[0,Tt.length-1,0],Q=[],Me,ee;ge.length;){var oe=ge.pop(),bt=ge.pop(),Nt=ge.pop();if(bt-Nt<=q){for(var jt=Nt;jt<=bt;jt++)Me=ht[2*jt],ee=ht[2*jt+1],Me>=Ot&&Me<=lr&&ee>=pt&&ee<=Br&&Q.push(Tt[jt]);continue}var Qt=Math.floor((Nt+bt)/2);Me=ht[2*Qt],ee=ht[2*Qt+1],Me>=Ot&&Me<=lr&&ee>=pt&&ee<=Br&&Q.push(Tt[Qt]);var ln=(oe+1)%2;(oe===0?Ot<=Me:pt<=ee)&&(ge.push(Nt),ge.push(Qt-1),ge.push(ln)),(oe===0?lr>=Me:Br>=ee)&&(ge.push(Qt+1),ge.push(bt),ge.push(ln))}return Q}function Ae(Tt,ht,Ot,pt,lr,Br){for(var q=[0,Tt.length-1,0],ge=[],Q=lr*lr;q.length;){var Me=q.pop(),ee=q.pop(),oe=q.pop();if(ee-oe<=Br){for(var bt=oe;bt<=ee;bt++)T(ht[2*bt],ht[2*bt+1],Ot,pt)<=Q&&ge.push(Tt[bt]);continue}var Nt=Math.floor((oe+ee)/2),jt=ht[2*Nt],Qt=ht[2*Nt+1];T(jt,Qt,Ot,pt)<=Q&&ge.push(Tt[Nt]);var ln=(Me+1)%2;(Me===0?Ot-lr<=jt:pt-lr<=Qt)&&(q.push(oe),q.push(Nt-1),q.push(ln)),(Me===0?Ot+lr>=jt:pt+lr>=Qt)&&(q.push(Nt+1),q.push(ee),q.push(ln))}return ge}function T(Tt,ht,Ot,pt){var lr=Tt-Ot,Br=ht-pt;return lr*lr+Br*Br}var ce=function(Tt){return Tt[0]},pe=function(Tt){return Tt[1]},Fe=function(ht,Ot,pt,lr,Br){Ot===void 0&&(Ot=ce),pt===void 0&&(pt=pe),lr===void 0&&(lr=64),Br===void 0&&(Br=Float64Array),this.nodeSize=lr,this.points=ht;for(var q=ht.length<65536?Uint16Array:Uint32Array,ge=this.ids=new q(ht.length),Q=this.coords=new Br(ht.length*2),Me=0;Me<ht.length;Me++)ge[Me]=Me,Q[2*Me]=Ot(ht[Me]),Q[2*Me+1]=pt(ht[Me]);ye(ge,Q,lr,0,ge.length-1,0)};Fe.prototype.range=function(ht,Ot,pt,lr){return y(this.ids,this.coords,ht,Ot,pt,lr,this.nodeSize)},Fe.prototype.within=function(ht,Ot,pt){return Ae(this.ids,this.coords,ht,Ot,pt,this.nodeSize)};var _e={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Tt){return Tt}},Ge=Math.fround||function(Tt){return function(ht){return Tt[0]=+ht,Tt[0]}}(new Float32Array(1)),ot=function(ht){this.options=gr(Object.create(_e),ht),this.trees=new Array(this.options.maxZoom+1)};ot.prototype.load=function(ht){var Ot=this.options,pt=Ot.log,lr=Ot.minZoom,Br=Ot.maxZoom,q=Ot.nodeSize;pt&&console.time("total time");var ge="prepare "+ht.length+" points";pt&&console.time(ge),this.points=ht;for(var Q=[],Me=0;Me<ht.length;Me++)!ht[Me].geometry||Q.push(kt(ht[Me],Me));this.trees[Br+1]=new Fe(Q,K,ur,q,Float32Array),pt&&console.timeEnd(ge);for(var ee=Br;ee>=lr;ee--){var oe=+Date.now();Q=this._cluster(Q,ee),this.trees[ee]=new Fe(Q,K,ur,q,Float32Array),pt&&console.log("z%d: %d clusters in %dms",ee,Q.length,+Date.now()-oe)}return pt&&console.timeEnd("total time"),this},ot.prototype.getClusters=function(ht,Ot){var pt=((ht[0]+180)%360+360)%360-180,lr=Math.max(-90,Math.min(90,ht[1])),Br=ht[2]===180?180:((ht[2]+180)%360+360)%360-180,q=Math.max(-90,Math.min(90,ht[3]));if(ht[2]-ht[0]>=360)pt=-180,Br=180;else if(pt>Br){var ge=this.getClusters([pt,lr,180,q],Ot),Q=this.getClusters([-180,lr,Br,q],Ot);return ge.concat(Q)}for(var Me=this.trees[this._limitZoom(Ot)],ee=Me.range(Jt(pt),Gt(q),Jt(Br),Gt(lr)),oe=[],bt=0,Nt=ee;bt<Nt.length;bt+=1){var jt=Nt[bt],Qt=Me.points[jt];oe.push(Qt.numPoints?ar(Qt):this.points[Qt.index])}return oe},ot.prototype.getChildren=function(ht){var Ot=this._getOriginId(ht),pt=this._getOriginZoom(ht),lr="No cluster with the specified id.",Br=this.trees[pt];if(!Br)throw new Error(lr);var q=Br.points[Ot];if(!q)throw new Error(lr);for(var ge=this.options.radius/(this.options.extent*Math.pow(2,pt-1)),Q=Br.within(q.x,q.y,ge),Me=[],ee=0,oe=Q;ee<oe.length;ee+=1){var bt=oe[ee],Nt=Br.points[bt];Nt.parentId===ht&&Me.push(Nt.numPoints?ar(Nt):this.points[Nt.index])}if(Me.length===0)throw new Error(lr);return Me},ot.prototype.getLeaves=function(ht,Ot,pt){Ot=Ot||10,pt=pt||0;var lr=[];return this._appendLeaves(lr,ht,Ot,pt,0),lr},ot.prototype.getTile=function(ht,Ot,pt){var lr=this.trees[this._limitZoom(ht)],Br=Math.pow(2,ht),q=this.options,ge=q.extent,Q=q.radius,Me=Q/ge,ee=(pt-Me)/Br,oe=(pt+1+Me)/Br,bt={features:[]};return this._addTileFeatures(lr.range((Ot-Me)/Br,ee,(Ot+1+Me)/Br,oe),lr.points,Ot,pt,Br,bt),Ot===0&&this._addTileFeatures(lr.range(1-Me/Br,ee,1,oe),lr.points,Br,pt,Br,bt),Ot===Br-1&&this._addTileFeatures(lr.range(0,ee,Me/Br,oe),lr.points,-1,pt,Br,bt),bt.features.length?bt:null},ot.prototype.getClusterExpansionZoom=function(ht){for(var Ot=this._getOriginZoom(ht)-1;Ot<=this.options.maxZoom;){var pt=this.getChildren(ht);if(Ot++,pt.length!==1)break;ht=pt[0].properties.cluster_id}return Ot},ot.prototype._appendLeaves=function(ht,Ot,pt,lr,Br){for(var q=this.getChildren(Ot),ge=0,Q=q;ge<Q.length;ge+=1){var Me=Q[ge],ee=Me.properties;if(ee&&ee.cluster?Br+ee.point_count<=lr?Br+=ee.point_count:Br=this._appendLeaves(ht,ee.cluster_id,pt,lr,Br):Br<lr?Br++:ht.push(Me),ht.length===pt)break}return Br},ot.prototype._addTileFeatures=function(ht,Ot,pt,lr,Br,q){for(var ge=0,Q=ht;ge<Q.length;ge+=1){var Me=Q[ge],ee=Ot[Me],oe=ee.numPoints,bt=void 0,Nt=void 0,jt=void 0;if(oe)bt=xt(ee),Nt=ee.x,jt=ee.y;else{var Qt=this.points[ee.index];bt=Qt.properties,Nt=Jt(Qt.geometry.coordinates[0]),jt=Gt(Qt.geometry.coordinates[1])}var ln={type:1,geometry:[[Math.round(this.options.extent*(Nt*Br-pt)),Math.round(this.options.extent*(jt*Br-lr))]],tags:bt},Dr=void 0;oe?Dr=ee.id:this.options.generateId?Dr=ee.index:this.points[ee.index].id&&(Dr=this.points[ee.index].id),Dr!==void 0&&(ln.id=Dr),q.features.push(ln)}},ot.prototype._limitZoom=function(ht){return Math.max(this.options.minZoom,Math.min(Math.floor(+ht),this.options.maxZoom+1))},ot.prototype._cluster=function(ht,Ot){for(var pt=[],lr=this.options,Br=lr.radius,q=lr.extent,ge=lr.reduce,Q=lr.minPoints,Me=Br/(q*Math.pow(2,Ot)),ee=0;ee<ht.length;ee++){var oe=ht[ee];if(!(oe.zoom<=Ot)){oe.zoom=Ot;for(var bt=this.trees[Ot+1],Nt=bt.within(oe.x,oe.y,Me),jt=oe.numPoints||1,Qt=jt,ln=0,Dr=Nt;ln<Dr.length;ln+=1){var oi=Dr[ln],Zn=bt.points[oi];Zn.zoom>Ot&&(Qt+=Zn.numPoints||1)}if(Qt>jt&&Qt>=Q){for(var Vn=oe.x*jt,Xi=oe.y*jt,Ci=ge&&jt>1?this._map(oe,!0):null,fi=(ee<<5)+(Ot+1)+this.points.length,Hi=0,Ni=Nt;Hi<Ni.length;Hi+=1){var hi=Ni[Hi],Xn=bt.points[hi];if(!(Xn.zoom<=Ot)){Xn.zoom=Ot;var ri=Xn.numPoints||1;Vn+=Xn.x*ri,Xi+=Xn.y*ri,Xn.parentId=fi,ge&&(Ci||(Ci=this._map(oe,!0)),ge(Ci,this._map(Xn)))}}oe.parentId=fi,pt.push(ft(Vn/Qt,Xi/Qt,fi,Qt,Ci))}else if(pt.push(oe),Qt>1)for(var po=0,Ha=Nt;po<Ha.length;po+=1){var wa=Ha[po],Et=bt.points[wa];Et.zoom<=Ot||(Et.zoom=Ot,pt.push(Et))}}}return pt},ot.prototype._getOriginId=function(ht){return ht-this.points.length>>5},ot.prototype._getOriginZoom=function(ht){return(ht-this.points.length)%32},ot.prototype._map=function(ht,Ot){if(ht.numPoints)return Ot?gr({},ht.properties):ht.properties;var pt=this.points[ht.index].properties,lr=this.options.map(pt);return Ot&&lr===pt?gr({},lr):lr};function ft(Tt,ht,Ot,pt,lr){return{x:Ge(Tt),y:Ge(ht),zoom:Infinity,id:Ot,parentId:-1,numPoints:pt,properties:lr}}function kt(Tt,ht){var Ot=Tt.geometry.coordinates,pt=Ot[0],lr=Ot[1];return{x:Ge(Jt(pt)),y:Ge(Gt(lr)),zoom:Infinity,index:ht,parentId:-1}}function ar(Tt){return{type:"Feature",id:Tt.id,properties:xt(Tt),geometry:{type:"Point",coordinates:[wt(Tt.x),Bt(Tt.y)]}}}function xt(Tt){var ht=Tt.numPoints,Ot=ht>=1e4?Math.round(ht/1e3)+"k":ht>=1e3?Math.round(ht/100)/10+"k":ht;return gr(gr({},Tt.properties),{cluster:!0,cluster_id:Tt.id,point_count:ht,point_count_abbreviated:Ot})}function Jt(Tt){return Tt/360+.5}function Gt(Tt){var ht=Math.sin(Tt*Math.PI/180),Ot=.5-.25*Math.log((1+ht)/(1-ht))/Math.PI;return Ot<0?0:Ot>1?1:Ot}function wt(Tt){return(Tt-.5)*360}function Bt(Tt){var ht=(180-Tt*360)*Math.PI/180;return 360*Math.atan(Math.exp(ht))/Math.PI-90}function gr(Tt,ht){for(var Ot in ht)Tt[Ot]=ht[Ot];return Tt}function K(Tt){return Tt.x}function ur(Tt){return Tt.y}return ot})}}]);
